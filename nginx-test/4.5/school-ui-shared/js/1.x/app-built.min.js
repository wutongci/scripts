// Englishtown_Efekta_12_Shared_Library - 2018.44.1-1 @ 2019-01-15 11:18:40

!function(){var a=define;define=function(b,c,d){2===arguments.length&&(d=c,c=[]),a(b,["logger"].concat(c),function(a){if(a.log("Required dependency to troopjs 1x "+b),"function"==typeof d){var c=Array.prototype.slice.call(arguments,1);return d.apply(this,c)}return d})},define("school-ui-shared/enum/activity-event-type",{lngCompRetryTimesV1:1,lngCompRetryTimesV2:2,ASRMicSettingOnboarding:3,ASRMicSettingE13:4}),define("school-ui-shared/enum/ccl",{enableChangeUnit:"school.courseware.enableChangeUnit",enableChangeLevel:"school.courseware.enableChangeLevel",enableTTS:"school.courseware.e12.enableTTS",enableFloatingToolkit:"school.enable.floatingtoolkit",enablePCHtmlEpaper:"school.courseware.htmlepaper.pc.enable",enableSPINHtmlEpaper:"school.courseware.htmlepaper.spin.enable",asrSrvAddr:"school.AsrServerAddress",playerRules:"school.courseware.e12.playerRules"}),define("school-ui-shared/enum/course-type",{GeneralEnglish:"GE",BusinessEnglish:"BE",IndustryEnglish:"IND",IndustryEnglishB2B:"INDB2B",IndustryEnglishILS:"INDILS",TravelEnglish:"TRV",FoodEnglish:"FSE",HospitalityEnglish:"HE",SecurityEnglish:"SE",isGECourse:function(a){return this.GeneralEnglish===(""+a).toUpperCase()},isBECourse:function(a){return this.BusinessEnglish===(""+a).toUpperCase()},isSpinCourse:function(a){return!this.isGECourse(a)}}),define("school-ui-shared/enum/enroll-node-type",{course:1,level:2,unit:3,lesson:4,step:5,activity:6}),define("school-ui-shared/enum/enrollment-state",{isPrimary:1,isCurrent:2,isCurrentForCourseType:4,isEnrollable:8}),define("school-ui-shared/enum/feature-access-id",{"free self-study":1,"Bronze group chats":2,"Bronze private chats":3,"face to face study":4,"Silver group chats":5,"Silver private chats":6,"self-study no business course (not extendable)":7,"Free group chats":8,"Gold private chats":9,"Private lesson":10,"Group discussion":11,"Trainer for TOEIC":12,"Test for TOEIC (Red)":13,"Test for TOEIC (Green)":14,"Test for TOEIC (Blue)":15,"Trainer for TOEFL":16,"Test for TOEFL (Red)":17,"Test for TOEFL (Green)":18,"Test for TOEFL (Blue)":19,EFT:20,"self-study (extendable)":21,"Group discussion (unlimited)":22,"Personalize Language Aptitude Test Online":23,"Business Course (extendable)":24,"self-study no business course":25,"Trainer for TOEIC (Interstitial)":27,"Test for TOEIC (Blue Interstitial)":28,"Trainer for TOEFL (Interstitial)":29,"Test for TOEFL (Blue Interstitial)":30,"Group discussion upsell":31,"Writing class limited":32,"Writing class unlimited":33,"Etown Translator":34,"Business Course (not extendable)":35,"Personal Coaching":36,"SPIN Course":37,"English Corner":38,"self-study (B2B Homework)":39,"Industry English SPINs":40,"Travel SPINs":41,"Private Lesson 20":42,"Private Lesson 20 - Unit Move On":43,"GL Daily Delivery":44,"Check Point 20":45,"Check Point 20 (unlimited)":46,"Private Lesson 40 - Unit Move On":47,Camp:48,"Resume Correction":49}),define("school-ui-shared/enum/progress-state",{notStarted:0,onGoing:1,completed:2,hasPassed:4,isFinished:8}),define("school-ui-shared/enum/rating-source-type",{ASR_TYPING:"TP",ASR_SPEAKING:"SPK",ASR_SELECTION:"SLCT"}),define("school-ui-shared/enum/step-type",{movie:0,finalTask:1,vocabulary:2,vocabularyAndIntonnation:3,languageAndFocus:4,functions:5,grammar:6,pronunciation:7,reading:8,listening:9,speaking:10,writing:11}),define("school-ui-shared/module",["module"],function(a){return a}),define("school-ui-shared/tracker/base/mock-data",[],function(){return[{id:"tracking!e12_omniture",tracking:[{id:"tracking_item!001",regex:"^school/\\d+/\\d+/\\d+/\\d+/?$",props:{pageName:"School:Courseware:UnitMainMenu"},events:[{id:"tracking_events!001",click:[{id:"tracking_event_click!001",selector:" .ets-overview",props:{pageName:"School:Courseware:Test"}}]}]},{id:"tracking_item!003",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/\\d+/?$",props:{pageName:"School:Courseware:Lessons"}},{id:"tracking_item!004",behavior:[{id:"tracking_behaviors!001",name:"study/unit-overview/open",props:{pageName:"School:Courseware:UnitOverview"}}]},{id:"tracking_item!005",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/0",props:{pageName:"School:Courseware:UnitBox1"}}]},{id:"tracking_item!006",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/1",props:{pageName:"School:Courseware:UnitBox2"}}]},{id:"tracking_item!007",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/2",props:{pageName:"School:Courseware:UnitBox3"}}]},{id:"tracking_item!008",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/3",props:{pageName:"School:Courseware:UnitBox4"}}]},{id:"tracking_item!009",behavior:[{id:"tracking_behaviors!001",name:"study/change-course/expand",props:{pageName:"School:Courseware:EnglishCategories"}}]},{id:"tracking_item!010",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/\\d+/summary$",props:{pageName:"School:Courseware:ActivityResults"}}]},{id:"tracking!e12_etvt",tracking:[{id:"tracking_item!001",regex:"",props:{}}]}]}),define("school-ui-shared/tracker/base/main",["compose","troopjs-core/component/widget","troopjs-utils/deferred","./mock-data"],function(a,b,c,d){"use strict";function e(a){return{uri:a,behaviors:[]}}function f(a){var b=this;if(b._dfdTrackingInfo.isResolved())g.call(b,a.uri),h.call(b,a.behavior);else{a.uri&&m(e(uri));var c=m[m.length-1];a.behavior&&c.behaviors.push(a.behaviors)}}function g(a){if(a&&0!=a){var b,c=this,d=c._data.tracking;for(c[k]=a,b=d.length;b--;)d[b].props&&null!=d[b].regex&&new RegExp(d[b].regex).test(a)&&c[l](d[b],{uri:a})}}function h(a){if(a&&0!=a){var b,c,d,e=this,f=e._data.tracking,g=e[k];for(b=f.length;b--;)if((d=f[b].behavior)&&(!f[b].regex||new RegExp(f[b].regex).test(g)))for(c=d.length;c--;)d[c].props&&d[c].name==a&&e[l](d[c],{behavior:a})}}function i(a,b){var c=this;f.call(c,{uri:b}),c._dfdFirstRoute.resolve()}function j(a,b){var c=this,d=b.toString();b.name&&(d=b.name),c._dfdFirstRoute.done(function(){f.call(c,{behavior:d})})}var k="uri",l="_onSend",m=[];return b.extend(function(){var a=this;a._dfdTrackingInfo=a.getTracking().done(function(b){var c,d,e;for(a._data=b,d=0;d<m.length;d++)for(c=m[d],g.call(a,c.uri),e=0;e<c.behaviors.length;e++)h.call(a,c.behaviors[e]);m.length=0}),a._dfdFirstRoute=c()},{"sig/start":function(a,b){var c=this.$element[0].tagName.toUpperCase();if("BODY"!=c&&"HTML"!=c)throw"Tracker widget must be bound to top-most element";b&&b.resolve()},"hub:memory/route":i,"hub:memory/tracking/track":j,"dom/action":$.noop,"dom/action/track":function(a,b,c){this.publish("tracking/track",c)},getTracking:function(a){var b=c(),e="tracking!"+this.scope,f=!1;a&&b.then(a.resolve,a.reject);for(var g=d.length;g--;)if(d[g].id==e){b.resolve(d[g]),f=!0;break}return f||this.query("tracking!"+this.scope,b),b},_onSend:a.required})}),define("school-ui-shared/tracker/sandbox/main",["gollum"],function(a){"use strict";return new a({url:"/school/tracking/e12.aspx"})}),define("school-ui-shared/tracker/etvt/etvt",["../sandbox/main","troopjs-utils/deferred"],function(a,b){"use strict";return{send:function(b){a.exec(function(a){window.visitTrack&&window.visitTrack(a)},b)}}}),define("school-ui-shared/tracker/etvt/main",["./etvt","../base/main"],function(a,b){"use strict";return b.extend({scope:"e12_etvt",_onSend:function(b,c,d){c.uri&&(a.send(window.location.protocol+"//"+window.location.host+window.location.pathname+("/"===window.location.pathname.substr(window.location.pathname.length-1)?window.location.hash.replace("#",""):window.location.hash.replace("#","/"))+(window.location.search?window.location.search:"")),d&&d.resolve())}})}),define("school-ui-shared/tracker/omniture/omniture",["../sandbox/main","troopjs-utils/deferred"],function(a,b){"use strict";var c={},d=b();return a.exec(function(a){if(window.s)for(var b in window.s)a[b]=window.s[b]},c).then(d.resolve,d.reject),{send:function(b,e){d.done(function(){a.exec(function(a,b,c){var d=window.s;if(d&&window[a]){for(var e in d)d.hasOwnProperty(e)&&(e in c?d[e]=c[e]:delete d[e]);for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);window[a]()}},"E12_Tracking_Omniture_Send",b,c)})}}}),define("school-ui-shared/tracker/omniture/main",["./omniture","../base/main"],function(a,b){"use strict";return b.extend({scope:"e12_omniture",_onSend:function(b,c,d){a.send(b.props),d&&d.resolve()}})}),define("school-ui-shared/tracker/shared/gollum",["jquery"],function(a){"use strict";function b(b){var c=this;c.opts=b||d,c.ready=e();var f=function(){var b=a(document.createElement("iframe"));return b.attr("src",c.opts.url),b.hide(),b.appendTo(document.body),b}();c._$gollum=f,c._$gollum.bind("load",function(){f[0].contentWindow.__gollumArgs__=[],c.ready.resolve()})}var c="Gollum: Required argument is missing.",d={url:"about:blank"},e=a.Deferred;if(!e)throw"Gollum: jQuery does not implement Deferred() method.";var f=b.prototype;return f.load=function(a){if(!a)throw c;var b=this,d=e();return b.ready.done(function(){var b=this._$gollum[0].contentWindow,c=b.document,e=c.createElement("script");e.src=a,e.completed?d.resolve():e.onload=function(){d.resolve()},c.body.appendChild(e)}),d},f.exec=function(a){if(!a)throw c;var b=this,d=e(),f=a.toString(),g=Array.prototype.slice.call(arguments,1);return b.ready.done(function(){var a=b._$gollum[0].contentWindow;a.document;a.__gollumArgs__.push(Array.prototype.slice.call(g)),d.resolve(a.eval("("+f+").apply(this, this.__gollumArgs__.shift());"))}),d},b}),define("troopjs-requirejs/template!school-ui-shared/tts/legacy/tts.html",[],function(){return function(a){return"<input type='hidden' id='memberid4tts' value='"+a.memberId+"' />\n<input type='hidden' id='token4tts' value='"+a.token+"' />\n<input type='hidden' id='isnewcourseware4tts' value='true' />\n<input type='hidden' id='siteversion4tts' value='"+a.siteVersion+"' />"}}),define("school-ui-shared/utils/typeid-parser",["compose"],function(a){"use strict";var b=/^(?:(\w+)!)?!?([;\-\w]+)?/,c=/(?:(\w+)[!|;])?(\d+)$/;return a.create({parse:function(a){var c=b.exec(a);c||(c=["","",void 0]);var d={};return d.type=c[1]||"",d.id=c[2],d},parseLastType:function(a){var b=c.exec(a)||[];return{type:b[1],id:b[2]}},parseLastTypeAndId:function(a){var b=c.exec(a)||[];return b[1]+"!"+b[2]},parseType:function(a){return this.parse(a).type},parseId:function(a){return this.parse(a).id},parseTypeid:function(a){var b=this.parse(a);return b.type+"!"+b.id},isId:function(a){return(""+a).indexOf("!")>=0}})}),define("school-ui-shared/utils/query-builder",["compose","school-ui-shared/utils/typeid-parser"],function(a,b){"use strict";return a.create({buildProgressQuery:function(a,c,d){if(!a||!c)throw Error("invalid arguments, build progress query failed!");var e=b.parseId(a),f=b.parse(c),g="";if(d)for(d=parseInt(d,10),(isNaN(d)||d<0)&&(d=0);d-- >0;)g+=".children";return"progress!".concat([e,f.type,f.id].join(";"),g)},buildCCLQuery:function(a){if(!a)throw Error("invalid ccl variableName, build ccl query faild!");return'ccl!"'+a+'"'}})}),define("school-ui-shared/tts/legacy/main",["jquery","troopjs-ef/component/widget","template!./tts.html","school-ui-shared/enum/ccl","school-ui-shared/utils/query-builder","school-ui-shared/utils/typeid-parser"],function(a,b,c,d,e,f){"use strict";function g(){var a=this[n],b=a&&a[0]&&a[0].ownerDocument||{};return b.defaultView||b.parentWindow}function h(b,c,d,e){function f(a){a.ajax({type:"GET",url:i,dataType:"script",cache:!0}).always(function(){e&&e.resolve()})}b=b||".",c=c||"en";var h=this,i=b+"/translator/integration/Js4FloatingToolkit/?culture="+c+"&newcourseware=true&siteversion="+d+"&LE=e12-old",j=g.call(h);j===window?f(a):j&&j.require(["jquery"],function(a){f(a)})}function i(){function b(a){a(".tts-btn-close").trigger("mouseup")}var c=g.call(this);c===window?b(a):c&&c.require(["jquery"],function(a){b(a)})}function j(){function b(a,b){a(b).unbind(q).bind(q,c).unbind(r).bind(r,d)}function c(a){f=e(a)}function d(a){if(!f){var b=k(i);b&&(m(b),l(i))}}function e(a){var b=a.target,c=!!s[b.tagName];return!c||!0!==b.readOnly&&!0!==b.disabled||(c=!1),c}var f,h=this,i=g.call(h),j=i.document;i===window?b(a,j):i&&i.require(["jquery"],function(a){b(a,j)})}function k(b){b=b||window;var c=b.document,d=b.getSelection&&b.getSelection()||c.getSelection&&c.getSelection()||c.selection&&c.selection.createRange().text||"";return a.trim((""+d).replace(o,""))}function l(a){a=a||window;var b=a.document;a.getSelection?a.getSelection().removeAllRanges():b.getSelection?b.getSelection().removeAllRanges():b.selection&&b.selection.empty()}function m(a){a=a||"",a.length>p&&(a=a.substr(0,p));var b="/translator/?newcourseware=true&LE=e12-old-pop&searchText="+encodeURIComponent(a);window.parent.open(b,"Translator","height=740px,width=680px,top=0,left=0,toolbar=no,resizable=yes,location=no,status=no,scrollbars=yes").focus()}var n="$element",o=/\n|\r/g,p=1800,q="mousedown.legacy.tts",r="mouseup.legacy.tts",s={INPUT:1,TEXTAREA:1};return b.extend({"sig/stop":function(a,b){i.call(this),b&&b.resolve()},"hub:memory/context":function(b,g){if(g){var i,k=this;a.Deferred(function(a){var b=e.buildCCLQuery(d.enableFloatingToolkit);k.query(b,a)}).done(function(a){i="true"===(a||{}).value}).always(function(){if(i){var b={memberId:f.parseId((g.user||{}).id),cacheServer:g.cacheServer,siteVersion:g.siteVersion,token:""};a.Deferred(function(a){k.html(c,b,a)}).done(function(){h.call(k,g.cacheServer,g.cultureCode,g.siteVersion)})}else j.call(k)})}}})}),define("troopjs-requirejs/template!school-ui-shared/tts/tts.html",[],function(){return function(a){return'<div class="ets-ui-tts-small-box" data-action="show/box"></div>\n<div class="ets-ui-tts-box">\n    <div class="ets-ui-tts-close-btn" data-action="close/box"></div>\n    <div class="ets-ui-tts-main">\n        <div class="ets-ui-tts-hd">\n            <div class="ets-ui-tts-hd-listen ets-hidden"></div>\n            <div class="ets-ui-tts-tabs">\n                <div data-action="toggle/pin(index)" data-index="0" class="ets-ui-tts-tab ets-pin">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="1" class="ets-ui-tts-tab ets-translator ets-active">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="2" class="ets-ui-tts-tab ets-speech">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="3" class="ets-ui-tts-tab ets-settings">\n                    <div class="ets-ui-tts-tab-ico ets-last"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n            </div>\n        </div>\n        <div class="ets-ui-tts-bd ets-tab-1">\n            <div class="ets-ui-tts-bd-main">\n                <div class="ets-ui-tts-translator ets-loading" data-weave="school-ui-shared/tts/translator/main" data-enable-translator-detail="'+a.enableTranslatorDetail+'"></div>\n                <div class="ets-ui-tts-speech">\n                    <textarea class="ets-ui-tts-speech-input" data-action="click/input"></textarea>\n                    <div class="ets-ui-tts-speech-listen ets-hidden"></div>\n                    <div class="ets-ui-tts-speech-tip" data-weave="troopjs-ef/blurb/widget" data-blurb-id="165019" data-text-en="You could enter your content to listen the pronunciation, allow max 300 characters."></div>\n                </div>\n                <div class="ets-ui-tts-settings ets-hidden"></div>\n            </div>\n        </div>\n        <div class="ets-ui-tts-ft"></div>\n    </div>\n</div>\n<div id="ets-ui-tts-sound-sprite"></div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator.html",[],function(){return function(a){return'<div class="ets-ui-trans-small-box" data-action="open/translator">Translate</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/listen-panel.html",[],function(){return function(a){var b="",c=a||{},d=c.settings||{},e=c.isForSpeech;return b+='\n<div class="ets-ui-tts-listen-panel">\n    <div class="ets-ui-tts-listen-panel-bd">\n        <div class="ets-ui-tts-listen">\n            <a id="ets-ui-tts-listen-btn-'+(new Date).getTime()+'" data-action="listen/speech('+e+')" class="ets-ui-tts-listen-btn" href="javascript:void(0)"><span></span></a>\n        </div>\n        <div class="ets-ui-tts-speed" data-action="toggle/speed">\n            <div class="ets-ui-tts-speed-bd">\n                <span class="ets-ui-tts-speed-selected" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+(100===d.speed?167328:167329)+'"></span>\n                <ul class="ets-ui-tts-speed-options">\n                    <li data-action="select/speed(value)" data-value="100" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167328" data-text-en="Normal speed"></li>\n                    <li data-action="select/speed(value)" data-value="80" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167329" data-text-en="Slow speed"></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/settings.html",[],function(){return function(a){var b="",c=a||{},d=c.settings||{};return b+='\n<h4 data-weave="troopjs-ef/blurb/widget" data-blurb-id="167332" data-text-en="Voice"></h4>\n<div class="ets-ui-tts-settings-voice">\n    <input type="radio" name="ets-ui-tts-voice" value="101"'+(100!==d.speaker?" checked='checked'":"")+' id="ets-ui-tts-voice-male" />\n    <label for="ets-ui-tts-voice-male" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167334" data-text-en="Male"></label>\n    <input type="radio" name="ets-ui-tts-voice" value="100"'+(100===d.speaker?" checked='checked'":"")+' id="ets-ui-tts-voice-female" />\n    <label for="ets-ui-tts-voice-female" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167336" data-text-en="Female"></label>\n</div>\n<h4 data-weave="troopjs-ef/blurb/widget" data-blurb-id="167345" data-text-en="Display Mode"></h4>\n<div class="ets-ui-tts-settings-display">\n    <input type="checkbox" name="ets-ui-tts-auto-launch" id="ets-ui-tts-auto-launch"'+(d.autoLaunch?" checked='checked'":"")+' />\n    <label for="ets-ui-tts-auto-launch" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167348" data-text-en="Launch it automatically when a word is double-clicked"></label>\n</div>\n<a class="ets-ui-tts-save-btn" href="javascript:void(0)" data-action="save/settings">\n    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="167349" data-text-en="Save"></span>\n</a>\n<span class="ets-ui-tts-settings-msg ets-done" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167350" data-text-en="Saved successfully!"></span>\n<span class="ets-ui-tts-settings-msg ets-fail" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167351" data-text-en="Save failed, please try again!"></span>'}}),define("school-ui-shared/tts/text-helper",["compose"],function(a){"use strict";var b=/[A-Za-z0-9\+\\]+/,c={"~":1,"`":1,"!":1,"#":1,"^":1,"*":1,"(":1,")":1,_:1,"-":1,"[":1,"]":1,"{":1,"}":1,"|":1,";":1,":":1,"'":1,",":1,".":1,"<":1,">":1,"?":1,$:1,"%":1,"&":1,"@":1,"/":1,"=":1};return a.create({canTTS:function(a){return a=a||"",a.search(b)>=0||1===a.length&&!!c[a]}})}),define("school-ui-shared/tts/main",["jquery","troopjs-ef/component/widget","troopjs-ef/component/ef","troopjs-core/pubsub/hub","troopjs-utils/deferred","school-ui-shared/module","template!./tts.html","template!./translator.html","template!./listen-panel.html","template!./settings.html","school-ui-shared/enum/ccl","school-ui-shared/utils/query-builder","school-ui-shared/utils/typeid-parser","./text-helper","swfobject","jquery.ui","Cookies"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){var b=this;b[ca].addClass(Ia),b._isHidden=!0,b._isRendered=!1,b._isPinned=!1,b._isTranslatorTab=!0,b._text="",b._english="",a=a||e(),a.always(function(){t.call(b)}),s.call(b,a)}function s(a){var b=this;e(function(a){var c=[l.buildCCLQuery(k.enableFloatingToolkit),"student_translator_config!current","tts_member_settings!current"];b.query(c,a)}).done(function(c,d,f){if(b[ra]="true"===(c||{}).value,b[sa]=!0===(d||{}).enabled,b[ra])f&&(ob.speed=f.speed||ob.speed,ob.speaker=f.speaker||ob.speaker,ob.autoLaunch=0!==f.status);else{var g=u();g===ba?b.publish("ajax",{type:"GET",url:"/translator/Integration/GetAutoLaunchStatus"},e().done(function(a){pb.autoLaunch="true"===a})):pb.autoLaunch=g}a.resolve()}).fail(function(){a.reject()})}function t(){function b(a){var b=a.target,c=!!ua[b.tagName]||b.className===Ja;return!c||!0!==b.readOnly&&!0!==b.disabled||(c=!1),c}function c(b){return a(b.target).closest(Oa).length>0}function d(a){if(g=b(a),!h._isHidden&&!h._isTtsSmallBox){var d=c(a);d&&(g=!0),h._isPinned||d||P.call(h)}}function f(a){if(!g){var b=v();if(b)if(h._text=h._english=b,h[ra])e(function(a){x.call(h,a)}).always(function(){h._isPinned||C.call(h,a),O.call(h),R.call(h),$.call(h)});else{var c=u();c!==ba&&(pb.autoLaunch=c),pb.autoLaunch?(aa.call(h,!0),w()):e(function(a){x.call(h,a)}).always(function(){J.call(h),D.call(h,a),O.call(h)})}}}var g,h=this;a(document).unbind(da).bind(da,d).unbind(ea).bind(ea,f)}function u(){var a=q.get("Translator3_User_Preference"),b=a&&a.split("~");if(b&&b.length>=3)return"True"==b[2]}function v(){var b=window,c=b.document,d=b.getSelection&&b.getSelection()||c.getSelection&&c.getSelection()||c.selection&&c.selection.createRange().text||"";return a.trim((""+d).replace(ja,""))}function w(){var a=window,b=a.document;a.getSelection?a.getSelection().removeAllRanges():b.getSelection?b.getSelection().removeAllRanges():b.selection&&b.selection.empty()}function x(a){a=a||e();var b=this;if(b._isRendered)return void a.resolve();b._isRendered=!0,y.call(b,a)}function y(a){var b=this;a.done(function(){B.call(b)}),b[ra]?b.html(g({enableTranslatorDetail:b[sa]}),a.then(function(){b[ca].find(Ra).mouseenter(function(){b.publish("tracking/useraction",{"action.translateOverlay":"1"})})})):b[sa]&&b.html(h,a)}function z(a,b){b=b||e();var c=this;if(a){if(c._speechListenRendered)return void b.resolve();c._speechListenRendered=!0}else{if(c._headListenRendered)return void b.resolve();c._headListenRendered=!0}var d={isForSpeech:a,settings:ob},f=c[ca].find(a?cb:Ta);e(function(a){f.html(i(d)).find("*").weave(a)}).done(function(){f.removeClass(wa),b.resolve()}).fail(function(){a?c._speechListenRendered=!1:c._headListenRendered=!1,b.reject()})}function A(a){a=a||e();var b=this;if(b._settingsRendered)return void a.resolve();b._settingsRendered=!0;var c=b[ca].find(db);e(function(a){var b={settings:ob};c.html(j(b)).find("*").weave(a)}).done(function(){c.removeClass(wa),a.resolve()}).fail(function(){b._settingsRendered=!1,a.reject()})}function B(){var a=this;G.call(a),I.call(a),H.call(a),K.call(a),z.call(a,!1),L.call(a)}function C(b){var c=b.pageX,d=b.pageY,e=this,f=F.call(e),g=a(window),h=g.width(),i=g.height(),j=h-f.width,k=i-f.height,l=c+10,m=d-60;l>j&&(l=j),m<0?m=0:m>k&&(m=k);var n,o=e[ca];o.find(Ra).css({left:l,top:m}),e._isTtsSmallBox&&(n=o.find(Pa),n.css(E(n,b)))}function D(a){var b,c=this;c._isTransSmallBox&&(b=c[ca].find(Qa),b.css(E(b,a)))}function E(b,c){var d=c.pageX,e=c.pageY,f=a(window),g=f.width(),h=f.height(),i=g-b.width(),j=h-b.height(),k=d+20,l=e-10;return k>i&&(k=i),l<0?l=0:l>j&&(l=j),{left:k,top:l}}function F(){var a=this;if(!a._ttsBoxSize){var b=a[ca].find(Ra),c=b.find(Sa).outerHeight()+b.find($a).outerHeight()+b.find(hb).outerHeight()+10;a._ttsBoxSize={width:b.outerWidth()+10,height:c}}return a._ttsBoxSize}function G(){var a=this[ca],b=a.data("zIndex");b!==ba&&a.find(Pa+","+Ra).css("z-index",b)}function H(){function b(b,c){f=a(window).width()-e}function c(a,b){var c=b.position;f>0&&c.left>f&&(c.left=f)}var d=this,e=F.call(d).width+2,f=0;d[ca].find(Ra).draggable({handle:Sa,addClasses:!1,containment:"window",scroll:!1,scope:!1,disabled:!0,start:b,drag:c})}function I(a){var b=this;b._isTtsSmallBox=a===ba?!ob.autoLaunch:!!a,b[ca].removeClass(Ea).toggleClass(Ca,b._isTtsSmallBox)}function J(a){var b=this;b._isTransSmallBox=a===ba?!pb.autoLaunch:!!a,b[ca].removeClass(Ea).toggleClass(Da,b._isTransSmallBox)}function K(){if(o){var a="/_shared/school-ui-shared/"+f.config()["app-version"]["school-ui-shared"]+"/img/ets-ui-tts-sound-sprite.swf";o.embedSWF(a,pa,"0","0","9.0.0","#fff",{},{allowScriptAccess:"always"})}}function L(){var a=this,b=wb;e(function(b){M.call(a,b)}).always(function(){a[ca].find(Ua).find(Wa).attr(va,a._isPinned?b[rb]:b[qb]).end().find(Xa).attr(va,b[sb]).end().find(Ya).attr(va,b[tb]).end().find(Za).attr(va,b[ub])})}function M(b){b=b||e();var c=this;if(c[vb])return void b.resolve();c[vb]=!0;var d=wb;e(function(b){var e=[];a.each(d||!1,function(a,b){e.push(a)}),c.query(e,b)}).done(function(){a.each(arguments||!1,function(a,b){var c=b&&b.translation;c&&(d[b.id]=c)}),b.resolve()}).fail(function(){c[vb]=!1,b.reject()})}function N(){this[ca].find(ib).removeClass(Ba+ga+Aa)}function O(){var a=this;a._isHidden=!1,a[ca].show(),N.call(a),_.call(a)}function P(){var a=this;a._isHidden=!0,a._isPinned=!1,a[ca].hide(),Q.call(a,!1),a[ra]?I.call(a):J.call(a)}function Q(a){this[ca].find(Ra).toggleClass(Fa,a).draggable(a?"enable":"disable").find(Wa).attr(va,a?wb[rb]:wb[qb])}function R(){var a=this,b=a._text,c=a[ca];if(c.find(ab).val(b),!a._isTranslatorTab){var d=c.find(Xa);T.call(a,d,na)}}function S(a,b){var c=this;T.call(c,a,b);var d=xb[b];typeof d===ia&&d.apply(c,arguments)}function T(a,b){var c=this;c._isTranslatorTab=b===na,c[ca].find(Ta).toggle(c._isTranslatorTab).end().find(Va).removeClass(xa).end().find($a).removeClass(Na).addClass(oa+b),a.addClass(xa)}function U(a,b){a.toggleClass(za,b)}function V(a,b){ob.speed=a,this[ca].find(jb).text(b)}function W(b,c){if(!(b.hasClass(Aa)||b.hasClass(Ba)||b.hasClass(ya))){var d,e=this,f=e[ca],g=e._english;if(c&&(d=f.find(_a),g=a.trim(d.find(ab).val())),0===g.length||g.length>ob.maxTextLength)return void(d&&X.call(e,d,!0));if(!n.canTTS(g))if(g===ha)g=la;else{if(c)return void Y(b,!1);g=ma}var h=f.find(kb)[0];if(h&&h.loadSpeech){b.addClass(Aa);var i=b[0].id,j=ob.ttsUrl,k=[j+(j.indexOf("?")>=0?"&":"?")+"m="+e._member_id,"spk="+ob.speaker,"spd="+ob.speed,"t="+encodeURIComponent('"'+g+'"'),"p="+encodeURIComponent(location.href),"k="].join("&");h.loadSpeech(k,i,qa)}}}function X(a,b){var c=a.find(bb).stop(!0,!0).toggle(b);b&&c.delay(2e3).fadeOut(3e3)}function Y(a,b){a.toggleClass(ya,!b)}function Z(){var a=this,b=a[ca].find(db),c=function(a){b.find(gb+fa+(a?Ga:Ha)).stop(!0,!0).show().delay(2e3).fadeOut(a?1e3:3e3)},d=+b.find(eb).find("input:checked").val(),f=b.find(fb)[0].checked,g={speed:ob.speed,speaker:d,status:f?1:0};e(function(b){a.publish(lb,g,b)}).done(function(a){a=a&&(a[0]||a),a&&1===a.result?(ob.speaker=d,ob.autoLaunch=f,c(!0)):c(!1)}).fail(function(){c(!1)})}function $(){var a=this,b=function(a){return(""+a).replace(/['"\\]/g,"")||" "}(a._text);b.length>ob.maxTextLength&&(b=b.substr(0,ob.maxTextLength)),a._text=b,a[ta]=!1,e(function(c){a.publish(nb,b,a._cultureCode,c)}).done(function(){}).fail(function(){a[ta]=!0})}function _(){this.publish(mb)}function aa(a){var b=this,c=b._text||"";c.length>ka&&(c=c.substr(0,ka));var d="/translator/?newcourseware=true&LE=e12-new"+(a?"-pop":"")+"&searchText="+encodeURIComponent(c);window.open(d,"Translator","height=740px,width=680px,top=0,left=0,toolbar=no,resizable=yes,location=no,status=no,scrollbars=yes").focus()}var ba,ca="$element",da="mousedown.tts",ea="mouseup.tts",fa=".",ga=" ",ha='"',ia="function",ja=/\n|\r/g,ka=1800,la="double quotation",ma="Sorry! I can not recognize it.",na=1,oa="ets-tab-",pa="ets-ui-tts-sound-sprite",qa="_ttsSpeechCallback_"+(new Date).getTime(),ra="_enableFloatingToolkit",sa="_enableTranslator",ta="_isFailed",ua={INPUT:1,TEXTAREA:1},va="title",wa="ets-hidden",xa="ets-active",ya="ets-disabled",za="ets-expanded",Aa="ets-loading",Ba="ets-playing",Ca="ets-tts-small",Da="ets-trans-small",Ea=Ca+" "+Da,Fa="ets-pinned",Ga="ets-done",Ha="ets-fail",Ia="ets-ui-tts",Ja="ets-ui-tts-disabled",Ka=oa+"1",La=oa+"2",Ma=oa+"3",Na=Ka+ga+La+ga+Ma,Oa=fa+Ia,Pa=".ets-ui-tts-small-box",Qa=".ets-ui-trans-small-box",Ra=".ets-ui-tts-box",Sa=".ets-ui-tts-hd",Ta=".ets-ui-tts-hd-listen",Ua=".ets-ui-tts-tabs",Va=".ets-ui-tts-tab"+fa+xa,Wa=".ets-ui-tts-tab.ets-pin",Xa=".ets-ui-tts-tab.ets-translator",Ya=".ets-ui-tts-tab.ets-speech",Za=".ets-ui-tts-tab.ets-settings",$a=".ets-ui-tts-bd",_a=".ets-ui-tts-speech",ab=".ets-ui-tts-speech-input",bb=".ets-ui-tts-speech-tip",cb=".ets-ui-tts-speech-listen",db=".ets-ui-tts-settings",eb=".ets-ui-tts-settings-voice",fb="#ets-ui-tts-auto-launch",gb=".ets-ui-tts-settings-msg",hb=".ets-ui-tts-ft",ib=".ets-ui-tts-listen-btn",jb=".ets-ui-tts-speed-selected",kb="#"+pa,lb="school/tts/SaveMemberSettings",mb="tts/translator/reset",nb="tts/translator/translate",ob={speed:100,speaker:100,autoLaunch:!0,maxTextLength:300,ttsUrl:"/tts/tts.ashx?l=1"},pb={autoLaunch:!1},qb="blurb!163322",rb="blurb!163323",sb="blurb!163084",tb="blurb!163321",ub="blurb!167509",vb="_blurbLoaded",wb={};wb[qb]="PinDown",wb[rb]="PinUp",wb[sb]="Translator",wb[tb]="Speech",wb[ub]="Settings",wb["blurb!163324"]="We're sorry but there's been an error processing your request. Please try again later.";var xb=[0];return xb[1]=function(b,c){var d=this,e=d[ca],f=e.find(Ta).find(".ets-ui-tts-speed");U.call(d,f,!1),_.call(d);var g=a.trim(e.find(ab).val());""===g||d._text===g&&!d[ta]||(d._text=g,$.call(d))},xb[2]=function(a,b){var c=this,d=c[ca];c._isPinned||(c._isPinned=!0,Q.call(c,!0));var e=d.find(_a),f=e.find(".ets-ui-tts-speed");X.call(c,e,!1),U.call(c,f,!1),z.call(c,!0)},xb[3]=function(a,b){var c=this;A.call(c),function(){c[ca].find(gb).hide()}()},window[qa]={SpeechPlayingCallback:function(a){},SpeechLoadCompleteCallback:function(b){a("#"+b).removeClass(Aa).addClass(Ba)},SpeechStopCallback:function(b){a("#"+b).removeClass(Ba)},SpeechErrorCallback:function(b,c){a("#"+c).removeClass(Ba+ga+Aa)}},b.extend({"sig/start":function(a,b){r.call(this,b)},"hub:memory/context":function(a,b){if(b){var c=this;c._member_id=+m.parseId((b.user||{}).id),c._cultureCode=b.cultureCode}},"hub/tts/set/url":function(a,b){b&&(ob.ttsUrl=b)},"hub/tts/set/english":function(a,b){this._english=b||""},"hub/tts/get/translation/error":function(a,b){b&&b.resolve(wb["blurb!163324"])},"hub/tts/open/translator":function(a){aa.call(this)},"hub/tts/close/toolkit":function(a){P.call(this)},"dom/action.click":a.noop,"dom/action/show/box":function(a,b){I.call(this,!1)},"dom/action/open/translator":function(a){aa.call(this)},"dom/action/close/box":function(a,b){P.call(this)},"dom/action/toggle/pin":function(a,b){var c=this;c._isPinned=!c._isPinned,Q.call(c,c._isPinned)},"dom/action/switch/tab":function(b,c,d){var e=a(c.target);e.hasClass(xa)||S.call(this,e,d)},"dom/action/click/input":function(b,c){var d=a(c.target).closest(_a);X.call(this,d,!1),Y(d.find(ib),!0)},"dom/action/toggle/speed":function(b,c){var d=a(c.target);U.call(this,d)},"dom/action/select/speed":function(b,c,d){var e=a(c.target),f=this;V.call(f,d,e.text());var g=e.closest(".ets-ui-tts-speed");U.call(f,g,!1)},"dom/action/listen/speech":function(b,c,d){var e=this,f=a(c.target);W.call(e,f,d),e.publish("tracking/useraction",{"action.translatePlay":"1"})},"dom/action/save/settings":function(a,b){Z.call(this)}})}),define("school-ui-shared/tts/translator/lang-helper",["compose"],function(a){"use strict";var b={},c={};return b["es-CL"]="es",b["id-ID"]="id",b["ja-JP"]="ja",b["ko-KR"]="ko",b["pt-BR"]="pt",b["zh-CN"]="zh-CHS",b["zh-HK"]="zh-CHT",b["zh-TW"]="zh-CHT",b.ch="zh-CHT",b.cs="zh-CHS",b.ge="de",b.hk="zh-CHT",b.id="id",b.jp="ja",b.kr="ko",b.sp="es",b.pt="pt",c["es-CL"]="sp",c["id-ID"]="id",c["ja-JP"]="jp",c["ko-KR"]="kr",c["pt-BR"]="pt",
c["zh-CN"]="cs",c["zh-HK"]="ch",c["zh-TW"]="ch",a.create({getBingLangByCultureCode:function(a){return b[a]||a},getEFLangByCultureCode:function(a){return c[a]||a},getBingLangByEFLang:function(a){return b[a]||a}})}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/translator.html",[],function(){return function(a){return'<div class="ets-ui-tts-translating" data-weave="troopjs-ef/blurb/widget" data-blurb-id="44578" data-text-en="LOADING...Please wait"></div>\n<div class="ets-ui-tts-translation"></div>\n<div class="ets-ui-tts-translator-ft ets-none">\n    <div class="ets-ui-tts-notebook"></div>\n    <div class="ets-ui-tts-bing"></div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/translation.html",[],function(){return function(a){function b(a){d+='\n<li class="ets-ui-tts-word-pos">\n    <p>'+a.partOfSpeech+'</p>\n    <ul class="ets-ui-tts-word-sense">\n        ',c(a.definitions||[]),d+="\n    </ul>\n</li>\n"}function c(a){for(var b=0,c=a.length,e=f?c:c>0?1:0,h=c-e+1,i=0;i<e;i++){d+='\n<li class="ets-ui-tts-word-def">\n    ';for(var j=0;j<h;j++)d+="\n    "+a[b++]+g+"\n    ";d+="\n</li>\n"}}var d="",e=a||{},f=e.isEnglish,g=f?"":"; ",h=e.result||{};return d+='\n<h5 class="ets-ui-tts-translation-hd">\n    <p class="ets-ui-tts-word">'+h.wordText+"</p>\n    ",h.uk&&(d+='\n    <span class="ets-ui-tts-ipa-region">UK</span>\n    <span class="ets-ui-tts-ipa">/'+h.uk+"/</span>\n    "),d+="\n    ",h.us&&(d+='\n    <span class="ets-ui-tts-ipa-region">US</span>\n    <span class="ets-ui-tts-ipa">/'+h.us+"/</span>\n    "),d+='\n</h5>\n<ul class="ets-ui-tts-translation-bd'+(f?" ets-english":"")+'">\n    ',function(a){for(var c=a.length,d=0;d<c;d++)b(a[d])}(h.pos||[]),d+="\n</ul>\n\n",d+="\n\n",d+="\n\n"}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/notebook.html",[],function(){return function(a){var b,c="",d=a||{},e=d.wordGroups||[],f=e.length;c+="\n",d.enableTranslatorDetail&&(c+='<a class="ets-ui-tts-detail-btn" href="javascript:void(0)" data-action="open/translator" data-weave="troopjs-ef/blurb/widget" data-blurb-id="163088" data-text-en="Details"></a>'),c+='\n<div class="ets-ui-tts-wordgroup">\n    <span class="ets-ui-tts-notebook-tip" data-action="notebook/toggle/wordgroup">Add to My Notebook</span>\n    <ul class="ets-ui-tts-wordgroup-list">\n        <li class="ets-ui-tts-wordgroup-tip" data-action="notebook/toggle/wordgroup">Add to My Notebook</li>\n        ';for(var g=0;g<f;g++)b=e[g],c+='\n        <li data-action="notebook/add/word(wordGroupId)" data-word-group-id="'+b.wordGroup_id+'">'+b.wordGroupName+"</li>\n        ";return c+='\n    </ul>\n</div>\n<p class="ets-ui-tts-notebook-msg ets-done" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167354" data-text-en="Add success!"></p>\n<p class="ets-ui-tts-notebook-msg ets-fail" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167355" data-text-en="Add failure, please try again!"></p>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/bing.html",[],function(){return function(a){var b,c,d="",e=a,f=e.languageList,g=f.length;d+='\n<div class="ets-ui-tts-bing-logo">Powered by Microsoft<sup> &copy; </sup>Translator</div>\n<div class="ets-ui-tts-bing-lang">\n    <span class="ets-ui-tts-bing-tip" data-action="bing/toggle/lang" data-weave="troopjs-ef/blurb/widget" data-blurb-id="163091" data-text-en="Translate to"></span>\n    <ul class="ets-ui-tts-bing-lang-list">\n        ';for(var h=0;h<g;h++)b=f[h],c=b.cultureCode,d+='\n        <li data-lang-code="'+c+'"'+("en"===c?' class="ets-selected"':"")+' data-action="bing/translate(langCode)" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+b.text+'"></li>\n        ';return d+="\n    </ul>\n</div>"}}),define("school-ui-shared/tts/translator/main",["jquery","troopjs-ef/component/widget","troopjs-utils/deferred","template!./translator.html","template!./translation.html","template!./notebook.html","template!./bing.html","./lang-helper"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){var b=this;if(k.call(b,!1,!1),a=a||c(),b._inited)return void a.resolve();c(function(a){var c=W;b.query(c,a)}).done(function(c){c&&(b.publish(T,c.speechServerUrl),b._languageList=c.lngs||[]),b._inited=!0,a.resolve()}).fail(function(){b._inited=!1,a.reject()})}function j(){var a=this;a[y].find(O).stop(!0,!0).hide(),n.call(a,!1),p.call(a,!1)}function k(a,b){this[y].find(L).toggleClass(G,!a).toggleClass(H,!!b)}function l(a,b){var d=this;if(d._wordText=b,a=a||c(),a.done(function(){k.call(d,!0,!1)}),d._notebookRendered)return void a.resolve();d._notebookRendered=!0,c(function(a){m.call(d,a)}).done(function(b){var c={wordGroups:b||[],enableTranslatorDetail:d[y].data("enableTranslatorDetail")};d[y].find(M).html(f(c)).find("*").weave(a)}).fail(function(){d._notebookRendered=!1,a.reject()})}function m(a){var b=this;c(function(a){b.query(X,a)}).done(function(d){var e=d&&d.result;e&&e.length>0?a.resolve(e):c(function(a){var c={groupName:C};b.publish(R,c,a)}).done(function(b){b=b&&(b[0]||b),b&&b.isSuccess?(e=[{wordGroup_id:b.result,wordGroupName:C}],a.resolve(e)):a.reject()})}).fail(function(){a.reject()})}function n(a){this[y].find(N).toggleClass(E,a)}function o(a){var b=this;if(a=a||c(),a.done(function(){k.call(b,!0,!0)}),b._bingRendered)return void a.resolve();b._bingRendered=!0,c(function(a){if(b._languageList)return void a.resolve({lngs:b._languageList});var c=W;b.query(c,a)}).done(function(c){var d={languageList:(c||{}).lngs||[]};b[y].find(P).html(g(d)).find("*").weave(a)}).fail(function(){b._bingRendered=!1,a.reject()})}function p(a){this[y].find(Q).toggleClass(E,a)}function q(a,b){var d=this,e=d[y].find(M),f=function(a){e.find(O+z+(a?I:J)).stop(!0,!0).show().delay(1e3).fadeOut(2e3)};n.call(d,!1),c(function(c){var e={wordGroup_id:a,wordTexts:[b||d._text]};d.publish(S,e,c)}).done(function(a){a=a&&(a[0]||a),a&&a.isSuccess?f.call(d,!0):f.call(d,!1)}).fail(function(){f.call(d,!1)})}function r(a){this[y].toggleClass(F,a)}function s(a,b,d,e){var f=this;e=e||c(),c(function(c){t.call(f,a,b,d,c)}).done(function(){e.resolve()}).fail(function(){u.call(f,a,e)})}function t(a,b,d,e){var f=this;c(function(a){f.query(W,a)}).done(function(g){d=f[_]||d;var h=[D+"?appId=Bearer+"+encodeURIComponent(g.bingApiToken),"text="+encodeURIComponent(a),"from="+b,"to="+d,"maxTranslations=5"].join("&"),i={type:"GET",url:h,cache:!0,dataType:"jsonp",jsonp:"oncomplete"};c(function(a){f.publish("ajax",i,a)}).done(function(b){var c=f[$]=b&&b.From||"";if(b&&(c!==B||/\s/.test(a)||/\d/.test(a))){var g="";b.Translations&&b.Translations.length>0&&(g=b.Translations[0].TranslatedText);var h=d===B?g:c===B?a:"";h&&w.call(f,h),v.call(f,x(g)),o.call(f),e.resolve()}else e.reject()}).fail(function(){e.reject()})}).fail(function(){e.reject()})}function u(b,d){var f=this;/^([a-zA-Z`,.])+$/gim.test(a.trim(b))?c(function(a){var c=Y+'"'+b+'"';f.query(c,a)}).done(function(a){if(a&&a.isFound){var g=(a.result||[])[0]||{},h=g.wordText;g.wordText=x(h);var i={isEnglish:(f[Z]||B)===B,result:g};w.call(f,h||b),v.call(f,e(i)),l.call(f,c(),h),d.resolve()}else v.call(f,A),d.reject()}).fail(function(){v.call(f,A),d.reject()}):(v.call(f,A),d.reject())}function v(a){var b=this;a===A&&c(function(a){b.publish(V,a)}).done(function(b){a=b}),b[y].find(K).html(a)}function w(a){this.publish(U,a)}function x(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var y="$element",z=".",A=null,B="en",C="from translator",D="//api.microsofttranslator.com/V2/Ajax.svc/GetTranslations",E="ets-expanded",F="ets-loading",G="ets-none",H="ets-bing",I="ets-done",J="ets-fail",K=".ets-ui-tts-translation",L=".ets-ui-tts-translator-ft",M=".ets-ui-tts-notebook",N=".ets-ui-tts-wordgroup",O=".ets-ui-tts-notebook-msg",P=".ets-ui-tts-bing",Q=".ets-ui-tts-bing-lang",R="school/notebook/AddUserWordGroup",S="school/notebook/AddWordsToUserWordGroup",T="tts/set/url",U="tts/set/english",V="tts/get/translation/error",W="toolkit_context!current",X="notebook_wordgroup!current",Y="toolkit_translation!",Z="_cultureCode",$="_bingLangFrom",_="_bingLangTo";return b.extend({"sig/initialize":function(a,b){this.html(d,b)},"hub/tts/translator/reset":function(a){j.call(this)},"hub/tts/translator/translate":function(a,b,d,e){e=e||c();var f=this,g=f[$]="",h=f[_]||B;f._text=b,f[Z]=d,r.call(f,!0),e.always(function(){r.call(f,!1)}),c(function(a){i.call(f,a)}).done(function(){s.call(f,f._text,g,h,e)}).fail(function(){e.reject()})},"dom/action.click":a.noop,"dom/action/notebook/toggle/wordgroup":function(a,b){n.call(this)},"dom/action/notebook/add/word":function(a,b,c){var d=this;q.call(d,c,d._wordText),d.publish("tracking/useraction",{"action.translateAddtoNotebook":"1"})},"dom/action/open/translator":function(a,b){this.publish("tts/open/translator")},"dom/action/bing/toggle/lang":function(a,b){p.call(this)},"dom/action/bing/translate":function(b,d,e){var f=this,g=f[$]||"",i=f[_]=h.getBingLangByEFLang(e),j=a(d.target);j.hasClass("ets-selected")||(j.parent().find(z+"ets-selected").removeClass("ets-selected"),j.addClass("ets-selected")),p.call(f,!1),r.call(f,!0),c(function(a){s.call(f,f._text,g,i,a)}).always(function(){r.call(f,!1)})}})}),define("school-ui-shared/utils/browser-check",[],function(){function a(a){var c=a.toLowerCase(),d=/(edge)\/([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(firefox)[ \/]([\w.]+)/.exec(c)||/version\/([\d|.]+)(?: mobile\/[\w.]+)? (safari)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(?:(msie) ([\d.]+).*)?(trident)\/(\d+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||[],e=!1,f=null;if("safari"===d[2])d[2]=d[1],d[1]="safari";else if("trident"===d[3]){var g=b[d[4]];d[1]||(d[1]="msie",d[2]=g),e=c.indexOf("compatible")>=0&&d[2]!==g,e&&(f=parseFloat(g))}var h=/(ipad)[\S\s]*os (\d+)_(\d+)/.exec(c)||/(iphone)[\S\s]*os (\d+)_(\d+)/.exec(c)||/(android)[\S\s]*(mobile)/.exec(c)||/(android)[\S\s]*(?!mobile)/.exec(c)||/(kfjwi) /.exec(c)||/(kftt) /.exec(c)||/(kfot) /.exec(c)||[],i=h[1],j="pc";if("android"===i||"kfjwi"===i||"kftt"===i||"kfot"===i){var k=window.screen,l=k.width,m=k.height;j=Math.min(l,m)>=512?"tablet":"mobile",i="android"}else"ipad"===i?(j="tablet",i="ios"):"iphone"===i&&(j="mobile",i="ios");return{browser:d[1]||"",version:d[2]||"0.0",os:i,device:j,compatibilityMode:e,actualVersionOfCompatibility:f}}var b={4:"8.0",5:"9.0",6:"10.0",7:"11.0",8:"11.0"},c=a(navigator.userAgent);return c.parseUserAgent=a,c}),define("school-ui-shared/utils/ccl",["troopjs-ef/component/service","troopjs-utils/deferred","troopjs-utils/each","school-ui-shared/utils/query-builder"],function(a,b,c,d){"use strict";return a.extend({enableLockUnit:function(a){return"false"===(a||{}).value},getCCLByKey:function(a,e){var f=this,g=[].slice,h=g.call(arguments,0,-1),e=g.call(arguments,-1)[0]||b();h&&(c(h,function(a,b){h[a]=d.buildCCLQuery(b)}),b(function(a){h.push(a),f.query.apply(f,h)}).done(function(a){a=a||{},e.resolve.apply(e,g.call(arguments,0))}))}}).apply(a).start()}),define("school-ui-shared/utils/feature-access",["school-ui-shared/enum/feature-access-id"],function(a){function b(a){var b=Math.floor(a/16),e=a%16||16;return!!(c[d].charCodeAt(b)&1<<e-1)}var c={},d="unicode";return{validateFeatureByte:function(a){return b(a)},hasWritingClassFeature:function(){return b(a["Writing class limited"])||b(a["Writing class unlimited"])},hasGLClassFeature:function(){return b(a["Group discussion"])||b(a["Group discussion (unlimited)"])||b(a["Group discussion upsell"])},hasPLClassFeature:function(){return b(a["Private lesson"])||b(a["Private Lesson 40 - Unit Move On"])},hasCP20ClassFeature:function(){return b(a["Private Lesson 20"])||b(a["Private Lesson 20 - Unit Move On"])||b(a["Check Point 20"])||b(a["Check Point 20 (unlimited)"])},hasEFTClassFeature:function(){return b(a.EFT)},setFeaturesUnicode:function(a){c[d]=a},getFeaturesUnicode:function(){return c[d]}}}),define("school-ui-shared/utils/language-fixing",["jquery","poly/array"],function(a){function b(b){return b.content.presentations.forEach(function(b){var d=a("<div>"+b.text+"</div>");d.find("p,td,strong").each(function(){var b=a(this),d=b.text();Array.prototype.every.call(d,function(a,d){return!(a.charCodeAt(0)>160)||(b.addClass(c),!1)})}),b.text=d.html()}),b}var c="ets-ui-arabic-fix";return function(a,c){return/^ar/.test(c)&&(a=b(a)),a}}),define("school-ui-shared/utils/media-player",["compose","jquery","./browser-check","./ccl","../enum/ccl"],function(a,b,c,d,e){function f(a,f){if(!a||!f)throw new Error("required parameters not provided");b.Deferred(function(a){d.getCCLByKey(e.playerRules,a)}).done(function(d){d=d&&b.parseJSON(d[g]);var e=c[j],m=c[k],n=b.map(d||!1,function(b){return b&&(!(i in b)||a===b[i])&&(!(j in b)||e===b[j])&&(!(k in b)||m>=b[k])&&b[l]});f.resolve(n.pop()||h)}).fail(f.reject)}var g="value",h="shim",i="type",j="browser",k="version",l="player",m=a.create({videoPlayer:function(a){return f.call(this,"video",a)},audioPlayer:function(a){return f.call(this,"audio",a)}});return m[h]=h,m.auto="auto",m}),define("school-ui-shared/utils/path-formatter",["troopjs-ef/component/gadget","./typeid-parser"],function(a,b){function c(){var a=this,c=a[e],d=c.path,f=0;$.each(arguments,function(a,c){var e,g,i,j=b.parse(c);j&&(e=j.type,g=j.id||"",e in h&&(i=h[e],d[i]=g,f=Math.max(f,i)))}),++f>1&&(d.length=f,a.route(c))}function d(a){var c=this,d=c[e],f=d.path,g=a;b.isId(a)&&(g=b.parseType(a));var i=h[g];if(!i)throw"pathFormatter: no such type";for(;f.length>i;)f.pop();c.route(d)}var e="URI",f=[,"enrollment!$2","course!$2","level!$2.levelName","unit!$2","lesson!$2","step!$2","activity!$2.activityContent"],g=[],h={},i=!1;return a.extend(function(){var a,c,d;if(!i){for(var d=f.length;d--;)c=void 0,a=f[d],a&&(c=b.parseType(a.replace("$2","234")),h[c]=d),g.unshift(c);i=!0}},{PREFIX:g,EXPAND:f,POSITION:h,"hub:memory/route":function(a,b){this[e]=b},expand:c,collapse:d})().start()}),define("school-ui-shared/utils/progress-state",["compose","troopjs-utils/each","troopjs-utils/deferred","school-ui-shared/enum/progress-state","troopjs-ef/component/service","school-ui-shared/utils/query-builder"],function(a,b,c,d,e,f){"use strict";return e.extend({"hub:memory/load/enrollment":function(a,b){var c=this;b&&(c.enrollment_id=b.id,c.doQueryProgress())},queryProgress:function(a,b,c,d){var e=this;c=c||0,d=d||0,e.queryArgs={res_id:a,deferred:b,needChilden:c,isResNeed:d},e.doQueryProgress()},doQueryProgress:function(){var a=this;if(a.enrollment_id&&a.queryArgs){var c,d,e=[],g=a.enrollment_id,h=a.queryArgs.res_id,i=a.queryArgs.deferred,j=a.queryArgs.needChilden,k=a.queryArgs.isResNeed;"[object Array]"===Object.prototype.toString.call(h)?(b(h,function(a,b){c=f.buildProgressQuery(g,b,j),e.push(k?[b,c]:c)}),e.push(i),d=e):(c=f.buildProgressQuery(g,h,j),d=k?[h,c,i]:[c,i]),a.query.apply(a,d)}},getActPros:function(a,b){this.queryProgress(a,b)},getActAndPros:function(a,b){this.queryProgress(a,b)},getStepPros:function(a,b){this.queryProgress(a,b)},getStepAndPros:function(a,b){this.queryProgress(a,b,1,1)},getLessonPros:function(a,b){this.queryProgress(a,b)},getLessonAndPros:function(a,b){this.queryProgress(a,b,1,1)},getUnitPros:function(a,b){this.queryProgress(a,b)},getUnitAndPros:function(a,b){this.queryProgress(unit_id,b,1,1)},getLevelPros:function(a,b){this.queryProgress(a,b)},getLevelAndPros:function(a,b){this.queryProgress(level_id,b,1,1)},getMixedPros:function(a,b){this.queryProgress(a,b)},getMixedAndPros:function(a,b){this.queryProgress(a,b,1,1)},notStarted:function(a){return!a||a.notStarted},hasStarted:function(a){return!!a&&!(a&d.notStarted)},hasTried:function(a){return!!a},hasPassed:function(a){return!!a&&!!(a&d.hasPassed)},hasPassedMe:function(a,b){var d=this;d.queryProgress(a,c().done(function(a){b&&b.resolve(d.hasPassed(a&&a.state))}))}}).apply(e).start()}),define("school-ui-shared/utils/update-helper",["troopjs-core/component/service","troopjs-utils/deferred","troopjs-utils/merge","json2"],function(a,b,c,d){"use strict";function e(a){var b="Sorry! Error occurred, please contact Administrator.";return h?b=a&&a.status?a.status+" "+a.statusText:a||"unknown error":b}function f(a){var b=a&&(a[0]||a),c={success:!0,data:b};return b&&b[i]!==j||(c.success=!1,c.data=b?b[k]:"verify failed, unknown error"),c}function g(a,c,d,g,h){var i=this;c&&c.constructor&&c.constructor._getBases||(g=d,d=c,c=i),g=g||b(),b(function(b){i.publish(a,d,b)}).done(function(a){var b=f.call(i,a),c=b.data;b.success?(g.resolve(c),h&&i.publish(h,c)):g.reject(c)}).fail(function(a){g.reject(e.call(i,a))})}var h=!0,i="id",j="fault!",k="faultMessage";return a.extend({submitScore:function(a,b,c){g.call(this,"school/progress/SubmitActivityScore",a,b,c,"ef/update/progress")},moveOnUnit:function(a,b,c){g.call(this,"school/enrollment/MoveOnUnit",a,b,c,"ef/update/progress")},updateEnrollment:function(a,b,c){g.call(this,"school/enrollment/Enroll",a,b,c)},submitRating:function(a,b,c){g.call(this,"school/rating/SubmitRating",a,b,c)},saveMemberSite:function(a,b,c){g.call(this,"school/member_site_setting/Save",a,b,c)},logFeature:function(a,b,c){g.call(this,"school/featuresupport/Log",a,b,c)},logActEvent:function(a,b,c){g.call(this,"school/school_event_log/LogActivityEvent",a,b,c)}}).apply(a).start()}),define=a}();
//# sourceMappingURL=app-built.min.js.map
