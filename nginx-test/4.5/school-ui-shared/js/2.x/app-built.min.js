// Englishtown_Efekta_12_Shared_Library - 2018.44.1-1 @ 2019-01-15 11:18:41

define("school-ui-shared/enum/abtest-query-string",{activity:{lngComp:"school_mvt!lancomp_new_asr_fed"}}),define("school-ui-shared/enum/activity-event-type",{lngCompRetryTimesV1:1,lngCompRetryTimesV2:2,ASRMicSettingOnboarding:3,ASRMicSettingE13:4}),define("school-ui-shared/enum/ccl",{enableChangeUnit:"school.courseware.enableChangeUnit",enableChangeLevel:"school.courseware.enableChangeLevel",enableTTS:"school.courseware.e12.enableTTS",enableFloatingToolkit:"school.enable.floatingtoolkit",enablePCHtmlEpaper:"school.courseware.htmlepaper.pc.enable",enableSPINHtmlEpaper:"school.courseware.htmlepaper.spin.enable",asrSrvAddr:"school.AsrServerAddress",playerRules:"school.courseware.e12.playerRules"}),define("school-ui-shared/enum/course-type",{GeneralEnglish:"GE",BusinessEnglish:"BE",IndustryEnglish:"IND",IndustryEnglishB2B:"INDB2B",IndustryEnglishILS:"INDILS",TravelEnglish:"TRV",FoodEnglish:"FSE",HospitalityEnglish:"HE",SecurityEnglish:"SE",isGECourse:function(a){return this.GeneralEnglish===(""+a).toUpperCase()},isBECourse:function(a){return this.BusinessEnglish===(""+a).toUpperCase()},isSpinCourse:function(a){return!this.isGECourse(a)}}),define("school-ui-shared/enum/enroll-node-type",{course:1,courseTypeCode:4,level:2,levelCode:5,unit:3,lesson:4,step:5,activity:6}),define("school-ui-shared/enum/enrollment-state",{isPrimary:1,isCurrent:2,isCurrentForCourseType:4,isEnrollable:8}),define("school-ui-shared/enum/feature-access-id",{"free self-study":1,"Bronze group chats":2,"Bronze private chats":3,"face to face study":4,"Silver group chats":5,"Silver private chats":6,"self-study no business course (not extendable)":7,"Free group chats":8,"Gold private chats":9,"Private lesson":10,"Group discussion":11,"Trainer for TOEIC":12,"Test for TOEIC (Red)":13,"Test for TOEIC (Green)":14,"Test for TOEIC (Blue)":15,"Trainer for TOEFL":16,"Test for TOEFL (Red)":17,"Test for TOEFL (Green)":18,"Test for TOEFL (Blue)":19,EFT:20,"self-study (extendable)":21,"Group discussion (unlimited)":22,"Personalize Language Aptitude Test Online":23,"Business Course (extendable)":24,"self-study no business course":25,"Trainer for TOEIC (Interstitial)":27,"Test for TOEIC (Blue Interstitial)":28,"Trainer for TOEFL (Interstitial)":29,"Test for TOEFL (Blue Interstitial)":30,"Group discussion upsell":31,"Writing class limited":32,"Writing class unlimited":33,"Etown Translator":34,"Business Course (not extendable)":35,"Personal Coaching":36,"SPIN Course":37,"English Corner":38,"self-study (B2B Homework)":39,"Industry English SPINs":40,"Travel SPINs":41,"Private Lesson 20":42,"Private Lesson 20 - Unit Move On":43,"GL Daily Delivery":44,"Check Point 20":45,"Check Point 20 (unlimited)":46,"Private Lesson 40 - Unit Move On":47,Camp:48,"Resume Correction":49}),define("school-ui-shared/enum/hyphenator-languages",{ar:null,de:"de","de-de":"de",en:"en-us","en-gb":"en-gb",es:"es","es-cl":"es",fr:"fr","id-id":null,it:"it","ko-kr":null,"ja-jp":null,"pt-br":"pt",ru:"ru",th:null,"tr-tr":"tr",tt:"ru","zh-hk":null,"zh-tw":null,"zh-cn":null}),define("school-ui-shared/enum/moment-language",{en:"en","en-gb":"en","pt-br":"pt-br","es-cl":"es",es:"es",fr:"fr",de:"de","de-de":"de",it:"it","ko-kr":"ko","ja-jp":"ja","zh-hk":"zh-tw","zh-tw":"zh-tw","zh-cn":"zh-cn",th:"th",ru:"ru",tt:"ru","tr-tr":"tr","id-id":"id",ar:"ar"}),define("school-ui-shared/enum/progress-state",{notStarted:0,started:1,completed:2}),define("school-ui-shared/enum/rating-source-type",{ASR_TYPING:"TP",ASR_SPEAKING:"SPK",ASR_SELECTION:"SLCT"}),define("school-ui-shared/enum/step-type",{movie:0,finalTask:1,vocabulary:2,vocabularyAndIntonnation:3,languageAndFocus:4,functions:5,grammar:6,pronunciation:7,reading:8,listening:9,speaking:10,writing:11}),define("school-ui-shared/module",["module"],function(a){return a}),define("troopjs-requirejs/template!school-ui-shared/plugins/alert-box/alert-box.html",[],function(){return function(a){var b="";return a=a||{},b+='\n<div class="modal fade in alert-modal-box" tabindex="-1" role="dialog" aria-labelledby="alertModalLabel" aria-hidden="true">\n\t<div class="modal-dialog">\n\t\t<div class="modal-content">\n\t\t\t<div class="modal-header">\n\t\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t\t\t<h4 class="modal-title">'+a.title+'</h4>\n\t\t\t</div>\n\t\t\t<div class="modal-body">\n\t\t\t\t<p>'+a.body+'</p>\n\t\t\t</div>\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" class="btn btn-default" data-action="ok" data-weave="troopjs-ef/blurb/widget" data-blurb-id="150652" data-text-en="OK"></button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div class="modal-backdrop fade in hidden"></div>'}}),define("school-ui-shared/plugins/alert-box/main",["when","jquery.gudstrap","troopjs-ef/component/widget","template!./alert-box.html"],function(a,b,c,d){"use strict";return c.extend({"sig/start":function(){var a=this;return a.html(d).then(function(){var b=a.$element;a.$root=b.find(".alert-modal-box"),a.$title=b.find(".modal-title"),a.$body=b.find(".modal-body p"),a.$backdrop=b.find(".modal-backdrop"),a.$root.on("show.bs.modal",function(b){a.$backdrop.removeClass("hidden")}).on("hidden.bs.modal",function(b){a.$backdrop.addClass("hidden"),a.isBusy=!1,a._defer_ok&&a._defer_ok.reject("confirm-box reject")})})},"hub/enable/show/alert-box":function(){return[!this.isBusy]},"hub/show/alert-modal-box":function(b){var c=this;return b?(c.isBusy=!0,c.$title.text(b.title),c.$body.html(b.body),c.$root.modal(),(c._defer_ok=a.defer()).promise):a.reject("alert-box no config")},"dom:[data-action='ok']/click":function(a){var b=this,c=b._defer_ok;c&&(c.resolver.resolve({$title:b.$title,$body:b.$body}),c.promise.then(function(){b.$root.modal("hide")}))}})}),define("troopjs-requirejs/template!school-ui-shared/plugins/confirm-box/confirm-box.html",[],function(){return function(a){var b="";return a=a||{},b+='\n<div class="modal fade in confirm-modal-box" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">\n\t<div class="modal-dialog">\n\t\t<div class="modal-content">\n\t\t\t<div class="modal-header">\n\t\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t\t\t<h4 class="modal-title">'+a.title+'</h4>\n\t\t\t</div>\n\t\t\t<div class="modal-body">\n\t\t\t\t<p>'+a.body+'</p>\n\t\t\t</div>\n\t\t\t<div class="modal-footer">\n\t\t\t\t<button type="button" class="btn btn-default" data-dismiss="modal"></button>\n\t\t\t\t<button type="button" class="btn btn-primary" data-action="confirm"></button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div class="modal-backdrop fade in hidden"></div>'}}),define("school-ui-shared/plugins/confirm-box/main",["when","jquery.gudstrap","troopjs-ef/component/widget","template!./confirm-box.html"],function(a,b,c,d){"use strict";return c.extend({"sig/start":function(){var b=this;return a([b.query("blurb!450018","blurb!450019"),b.html(d)]).spread(function(a){var c=b.$element;b._cancel=a[0]&&a[0].translation,b._confirm=a[1]&&a[1].translation,b.$root=c.find(".confirm-modal-box"),b.$title=c.find(".modal-title"),b.$body=c.find(".modal-body p"),b.$cancel=c.find(".btn-default"),b.$confirm=c.find(".btn-primary"),b.$backdrop=c.find(".modal-backdrop"),b.$root.on("show.bs.modal",function(a){b.$backdrop.removeClass("hidden")}).on("hidden.bs.modal",function(a){b.$backdrop.addClass("hidden"),b.isBusy=!1,b.confirmDfd&&b.confirmDfd.reject("confirm-box reject")})})},"hub/enable/show/confirm-box":function(){return[!this.isBusy]},"hub/show/confirm-modal-box":function(b){var c=this;return b?(c.isBusy=!0,c.$title.text(b.title),c.$body.html(b.body),c.$cancel.text(b.cancel?b.cancel:c._cancel),c.$confirm.text(b.confirm?b.confirm:c._confirm),c.$root.modal(),(c.confirmDfd=a.defer()).promise):a.reject("confirm-box no config")},"dom:[data-action='confirm']/click":function(a){var b=this,c=b.confirmDfd;c&&(c.resolver.resolve({$title:b.$title,$body:b.$body}),c.promise.then(function(){b.$root.modal("hide")}))}})}),define("school-ui-shared/plugins/http-request-handling/main",["jquery","troopjs-ef/component/widget"],function(a,b){"use strict";return b.extend({"sig/start":function(){a(document).ajaxError(function(a,b,c,d){403==b.status&&window.location.reload()})}})}),define("troopjs-requirejs/template!school-ui-shared/plugins/techcheck/techcheck.html",[],function(){return function(a){return'<div class="gud tck-ui" data-weave="techcheck-ui/widget/container/main"></div>'}}),define("school-ui-shared/plugins/techcheck/main",["jquery","troopjs-ef/component/widget","template!./techcheck.html"],function(a,b,c){"use strict";return b.extend({"sig/start":function(){var a=this;return a.html(c).then(function(){return a.publish("plugins/tech-check/enable",!0)})}})}),define("school-ui-shared/plugins/techcheck/techcheck-render",["jquery","when","poly/array"],function(a,b,c){function d(c,d){return 0===c.children(j).size()?a("<div></div>").addClass(g).attr("data-weave",d).prependTo(c).weave():b.resolve()}function e(){a(i).children(k).remove()}function f(b){return e(),a("<div></div>").addClass(h).attr("data-weave",b).appendTo(a(i)).weave()}var g="ets-ui-techcheck-container",h="ets-ui-techcheck-overlay",i="body",j="."+g,k="."+h;return{renderFlashInstallBanner:function(a,b){b.some(function(b){if("flash-install"===b.id&&!1===b.passed)return d(a,b.widgets.banner),!0})},renderFlashInstallOverlay:function(a){a.some(function(a){if("flash-install"===a.id&&!1===a.passed)return f(a.widgets.overlay),!0})},removeOverlay:e}}),define("school-ui-shared/service/context",["when","troopjs-ef/component/service"],function(a,b){"use strict";function c(a){var b=this;return b.query(["school_context!current.user","student_course_enrollment!current","student_platform_version!current"]).spread(function(c,d,e){return b.publish("context",c||{},d,e,a)})}return b.extend({displayName:"school-ui-shared/service/context","sig/start":function(){var a=this;return a.query("context!current").spread(function(b){a.publish("common_context",b)}),c.call(this,!1)},"hub/context/update/context":function(){return c.call(this,!0)}})}),define("school-ui-shared/utils/console",["school-ui-shared/module"],function(a){function b(){}function c(a){return d.debug?window.console&&"function"==typeof window.console[a]&&function(){window.console[a].apply(window.console,arguments)}||b:b}var d=a.config();return{log:c("log"),warn:c("warn"),error:c("error"),info:c("info"),dir:c("dir"),time:c("time"),timeEnd:c("timeEnd")}}),define("school-ui-shared/service/popcache",["troopjs-ef/component/service","school-ui-shared/utils/console","jquery","json2"],function(a,b,c,d){"use strict";return a.extend(function(a){if(!a)throw new Error("no cache provided");this.cache=a},{"sig/start":function(){var a=this.cache;c("script[type='application/json'][data-query]").each(function(e,f){var g;try{g=d.parse(c(f).html())}catch(a){b.info(a)}g&&a.put(g)})},"hub/school/clearCache":function(a){var b=this.cache;b[a]&&delete b[a]}})}),define("school-ui-shared/tracker/base/mock-data",[],function(){return[{id:"tracking!e12_omniture",tracking:[{id:"tracking_item!001",regex:"^school/\\d+/\\d+/\\d+/\\d+/?$",props:{pageName:"School:Courseware:UnitMainMenu"},events:[{id:"tracking_events!001",click:[{id:"tracking_event_click!001",selector:" .ets-overview",props:{pageName:"School:Courseware:Test"}}]}]},{id:"tracking_item!003",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/\\d+/?$",props:{pageName:"School:Courseware:Lessons"}},{id:"tracking_item!004",behavior:[{id:"tracking_behaviors!001",name:"study/unit-overview/open",props:{pageName:"School:Courseware:UnitOverview"}}]},{id:"tracking_item!005",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/0",props:{pageName:"School:Courseware:UnitBox1"}}]},{id:"tracking_item!006",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/1",props:{pageName:"School:Courseware:UnitBox2"}}]},{id:"tracking_item!007",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/2",props:{pageName:"School:Courseware:UnitBox3"}}]},{id:"tracking_item!008",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/?$",behavior:[{id:"tracking_behaviors!001",name:"study/lesson/expand/3",props:{pageName:"School:Courseware:UnitBox4"}}]},{id:"tracking_item!009",behavior:[{id:"tracking_behaviors!001",name:"study/change-course/expand",props:{pageName:"School:Courseware:EnglishCategories"}}]},{id:"tracking_item!010",regex:"^school/\\d+/\\d+/\\d+/\\d+/\\d+/\\d+/summary$",props:{pageName:"School:Courseware:ActivityResults"}}]},{id:"tracking!e12_etvt",tracking:[{id:"tracking_item!001",regex:"",props:{}}]}]}),define("school-ui-shared/tracker/base/main",["jquery","when","troopjs-ef/component/widget","./mock-data"],function(a,b,c,d){"use strict";function e(a){if(a){var b,c=this,d=c._data.tracking;for(c[h]=a,b=d.length;b--;)d[b].props&&null!=d[b].regex&&new RegExp(d[b].regex).test(a)&&c[i](d[b],{uri:a})}}function f(a){if(a){var b,c,d,e=this,f=e._data.tracking,g=e[h];for(b=f.length;b--;)if((d=f[b].behavior)&&(!f[b].regex||new RegExp(f[b].regex).test(g)))for(c=d.length;c--;)d[c].props&&d[c].name===a&&e[i](d[c],{behavior:a})}}function g(a){var b=this;b._dfdTrackingInfo.then(function(){e.call(b,a.uri),f.call(b,a.behavior)})}var h="uri",i="_onSend";return c.extend(function(){var a=this;a._dfdTrackingInfo=a.getTracking(),a._dfdFirstRoute=b.defer()},{"sig/start":function(){var a=this.$element[0].tagName.toUpperCase();if("BODY"!==a&&"HTML"!==a)throw"Tracker widget must be bound to top-most element"},"hub:memory/route":function(a){var b=this;g.call(b,{uri:a}),b._dfdFirstRoute.resolve()},"hub:memory/tracking/track":function(a){var b=this,c=a.toString();a.name&&(c=a.name),b._dfdFirstRoute.promise.then(function(){g.call(b,{behavior:c})})},'dom:[data-action="track"]/click':function(b,c){var d=this,e=a(b.currentTarget);d.publish("tracking/track",c||e.data("behavior"))},getTracking:function(){for(var a=this,c="tracking!"+a.scope,e=d.length;e--;)if(d[e].id===c)return a._data=d[e],b.resolve();return a.query("tracking!"+a.scope).spread(function(b){a._data=b})}})}),define("school-ui-shared/tracker/sandbox/main",["gollum"],function(a){"use strict";return new a({url:"/school/tracking/e12.aspx"})}),define("school-ui-shared/tracker/etvt/etvt",["../sandbox/main"],function(a){"use strict";return{send:function(b){a.exec(function(a){window.visitTrack&&window.visitTrack(a)},b)}}}),define("school-ui-shared/tracker/etvt/main",["./etvt","../base/main"],function(a,b){"use strict";return b.extend({scope:"e12_etvt",_onSend:function(b,c){if(c.uri){var d=window.location;a.send(d.protocol+"//"+d.host+d.pathname+("/"===d.pathname.substr(d.pathname.length-1)?d.hash.replace("#",""):d.hash.replace("#","/"))+(d.search?d.search:""))}}})}),define("school-ui-shared/tracker/omniture/omniture",["when","../sandbox/main"],function(a,b){"use strict";var c={},d=a.promise(function(a,d){b.exec(function(a){if(window.s)for(var b in window.s)a[b]=window.s[b]},c).then(a,d)});return{send:function(a){d.then(function(){b.exec(function(a,b,c){var d=window.s;if(d&&window[a]){for(var e in d)d.hasOwnProperty(e)&&(e in c?d[e]=c[e]:delete d[e]);for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);window[a]()}},"E12_Tracking_Omniture_Send",a,c)})}}}),define("school-ui-shared/tracker/omniture/main",["./omniture","../base/main"],function(a,b){"use strict";return b.extend({scope:"e12_omniture",_onSend:function(b){a.send(b.props)}})}),define("school-ui-shared/tracker/shared/gollum",["jquery"],function(a){"use strict";function b(b){var c=this;c.opts=b||d,c.ready=e();var f=function(){var b=a(document.createElement("iframe"));return b.attr("src",c.opts.url),b.hide(),b.appendTo(document.body),b}();c._$gollum=f,c._$gollum.bind("load",function(){f[0].contentWindow.__gollumArgs__=[],c.ready.resolve()})}var c="Gollum: Required argument is missing.",d={url:"about:blank"},e=a.Deferred;if(!e)throw"Gollum: jQuery does not implement Deferred() method.";var f=b.prototype;return f.load=function(a){if(!a)throw c;var b=this,d=e();return b.ready.done(function(){var b=this._$gollum[0].contentWindow,c=b.document,e=c.createElement("script");e.src=a,e.completed?d.resolve():e.onload=function(){d.resolve()},c.body.appendChild(e)}),d},f.exec=function(a){if(!a)throw c;var b=this,d=e(),f=a.toString(),g=Array.prototype.slice.call(arguments,1);return b.ready.done(function(){var a=b._$gollum[0].contentWindow;a.__gollumArgs__.push(Array.prototype.slice.call(g)),d.resolve(a.eval("("+f+").apply(this, this.__gollumArgs__.shift());"))}),d},b}),define("troopjs-requirejs/template!school-ui-shared/tts/tts.html",[],function(){return function(a){return'<div class="ets-ui-tts-small-box" data-action="show/box"></div>\n<div class="ets-ui-tts-box">\n    <div class="ets-ui-tts-close-btn" data-action="close/box"></div>\n    <div class="ets-ui-tts-main">\n        <div class="ets-ui-tts-hd">\n            <div class="ets-ui-tts-hd-listen ets-hidden"></div>\n            <div class="ets-ui-tts-tabs">\n                <div data-action="toggle/pin(index)" data-index="0" class="ets-ui-tts-tab ets-pin">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="1" class="ets-ui-tts-tab ets-ui-tts-tab-switch ets-translator ets-active">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="2" class="ets-ui-tts-tab ets-ui-tts-tab-switch ets-speech">\n                    <div class="ets-ui-tts-tab-ico"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n                <div data-action="switch/tab(index)" data-index="3" class="ets-ui-tts-tab ets-ui-tts-tab-switch ets-settings">\n                    <div class="ets-ui-tts-tab-ico ets-last"></div>\n                    <div class="ets-ui-tts-tab-arrow"></div>\n                </div>\n            </div>\n        </div>\n        <div class="ets-ui-tts-bd ets-tab-1">\n            <div class="ets-ui-tts-bd-main">\n                <div class="ets-ui-tts-translator ets-loading" data-weave="school-ui-shared/tts/translator/main" data-enable-translator-detail="'+a.enableTranslatorDetail+'"></div>\n                <div class="ets-ui-tts-speech">\n                    <textarea class="ets-ui-tts-speech-input" data-action="click/input"></textarea>\n                    <div class="ets-ui-tts-speech-listen ets-hidden"></div>\n                    <div class="ets-ui-tts-speech-tip" data-weave="troopjs-ef/blurb/widget" data-blurb-id="165019" data-text-en="You could enter your content to listen the pronunciation, allow max 300 characters."></div>\n                </div>\n                <div class="ets-ui-tts-settings ets-hidden"></div>\n            </div>\n        </div>\n        <div class="ets-ui-tts-ft"></div>\n    </div>\n</div>\n<div id="ets-ui-tts-sound-sprite"></div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator.html",[],function(){return function(a){return'<div class="ets-ui-trans-small-box" data-action="open/translator">Translate</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/listen-panel.html",[],function(){return function(a){var b="",c=a||{},d=c.settings||{},e=c.isForSpeech,f=(new Date).getTime();return b+='\n<div class="ets-ui-tts-listen-panel">\n    <div class="ets-ui-tts-listen-panel-bd">\n        <div class="ets-ui-tts-listen">\n            <a id="ets-ui-tts-listen-btn-'+f+'" data-action="listen/speech('+e+')" data-value="'+e+'" class="ets-ui-tts-listen-btn" href="javascript:void(0)"><span></span></a>\n            <audio id="ets-ui-tts-listen-audio-'+f+'" class="ets-ui-tts-listen-audio"></audio>\n        </div>\n        <div class="ets-ui-tts-speed" data-action="toggle/speed">\n            <div class="ets-ui-tts-speed-bd">\n                <span class="ets-ui-tts-speed-selected" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+(100===d.speed?167328:167329)+'"></span>\n                <ul class="ets-ui-tts-speed-options">\n                    <li class="ets-ui-tts-select-speed" data-action="select/speed(value)" data-value="100" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167328" data-text-en="Normal speed"></li>\n                    <li class="ets-ui-tts-select-speed" data-action="select/speed(value)" data-value="80" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167329" data-text-en="Slow speed"></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/settings.html",[],function(){return function(a){var b="",c=a||{},d=c.settings||{};return b+='\n<h4 data-weave="troopjs-ef/blurb/widget" data-blurb-id="167332" data-text-en="Voice"></h4>\n<div class="ets-ui-tts-settings-voice">\n    <input type="radio" name="ets-ui-tts-voice" value="101" id="ets-ui-tts-voice-male"'+(100!==d.speaker?" checked='checked'":"")+' />\n    <label for="ets-ui-tts-voice-male" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167334" data-text-en="Male"></label>\n    <input type="radio" name="ets-ui-tts-voice" value="100" id="ets-ui-tts-voice-female"'+(100===d.speaker?" checked='checked'":"")+' />\n    <label for="ets-ui-tts-voice-female" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167336" data-text-en="Female"></label>\n</div>\n<h4 data-weave="troopjs-ef/blurb/widget" data-blurb-id="167345" data-text-en="Display Mode"></h4>\n<div class="ets-ui-tts-settings-display">\n    <input type="checkbox" name="ets-ui-tts-auto-launch" id="ets-ui-tts-auto-launch"'+(d.autoLaunch?" checked='checked'":"")+' />\n    <label for="ets-ui-tts-auto-launch" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167348" data-text-en="Launch it automatically when a word is double-clicked"></label>\n</div>\n<a class="ets-ui-tts-save-btn" href="javascript:void(0)" data-action="save/settings">\n    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="167349" data-text-en="Save"></span>\n</a>\n<span class="ets-ui-tts-settings-msg ets-done" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167350" data-text-en="Saved successfully!"></span>\n<span class="ets-ui-tts-settings-msg ets-fail" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167351" data-text-en="Save failed, please try again!"></span>'}}),define("school-ui-shared/utils/typeid-parser",["troopjs-core/component/factory"],function(a){"use strict";var b=/^(?:(\w+)!)?!?([;\-\w]+)?/,c=/(?:(\w+)[!|;])?(\d+)$/;return a.create({parse:function(a){var c=b.exec(a);c||(c=["","",void 0]);var d={};return d.type=c[1]||"",d.id=c[2],d},parseLastType:function(a){var b=c.exec(a)||[];return{type:b[1],id:b[2]}},parseLastTypeAndId:function(a){var b=c.exec(a)||[];return b[1]+"!"+b[2]},parseType:function(a){return this.parse(a).type},parseId:function(a){return this.parse(a).id},parseTypeid:function(a){var b=this.parse(a);return b.type+"!"+b.id},isId:function(a){return(""+a).indexOf("!")>=0}})}),define("school-ui-shared/utils/query-builder",["troopjs-core/component/factory","school-ui-shared/utils/typeid-parser"],function(a,b){"use strict";return a.create({buildProgressQuery:function(a,c,d){if(!a||!c)throw Error("invalid arguments, build progress query failed!");var e=b.parseId(a),f=b.parse(c),g="";if(d)for(d=parseInt(d,10),(isNaN(d)||d<0)&&(d=0);d-- >0;)g+=".children";return"progress!".concat([e,f.type,f.id].join(";"),g)},buildCCLQuery:function(a){if(!a)throw Error("invalid ccl variableName, build ccl query faild!");return'ccl!"'+a+'"'}})}),define("school-ui-shared/tts/text-helper",[],function(){"use strict";var a=/[A-Za-z0-9\+\\]+/,b=["~","`","!","#","^","*","(",")","_","-","[","]","{","}","|",";",":","'",",",".","<",">","?","$","%","&","@","/","="];return{canTTS:function(c){return c=c||"",c.search(a)>=0||1===c.length&&b.indexOf(c)>=0}}}),define("school-ui-shared/tts/main",["jquery","when","jquery.ui","troopjs-ef/component/widget","school-ui-shared/module","template!./tts.html","template!./translator.html","template!./listen-panel.html","template!./settings.html","school-ui-shared/enum/ccl","school-ui-shared/utils/query-builder","school-ui-shared/utils/typeid-parser","./text-helper","Cookies"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){var a=this;return a[_].addClass(Da),a._isHidden=!0,a._isRendered=!1,a._isPinned=!1,a._isTranslatorTab=!0,a._text="",a._english="",p.call(a).ensure(function(){q.call(a)})}function p(){var a=this;return a.query([k.buildCCLQuery(j.enableFloatingToolkit),"student_translator_config!current","tts_member_settings!current"]).spread(function(b,c,d){if(a[ma]="true"===(b||{}).value,a[na]=!0===(c||{}).enabled,a[ma])d&&(jb.speed=d.speed||jb.speed,jb.speaker=d.speaker||jb.speaker,jb.autoLaunch=0!==d.status);else{var e=r();if(e===$)return a.publish("ajax",{type:"GET",url:"/translator/Integration/GetAutoLaunchStatus"}).then(function(a){kb.autoLaunch="true"===a});kb.autoLaunch=e}})}function q(){function b(a){var b=a.target,c=!!pa[b.tagName]||b.className===Ea;return!c||!0!==b.readOnly&&!0!==b.disabled||(c=!1),c}function c(b){return a(b.target).closest(Ja).length>0}function d(a){if(f=b(a),!g._isHidden&&!g._isTtsSmallBox){var d=c(a);d&&(f=!0),g._isPinned||d||M.call(g)}}function e(a){if(!f){var b=s();if(b)if(g._text=g._english=b,g[ma])u.call(g).ensure(function(){g._isPinned||z.call(g,a),L.call(g),O.call(g),X.call(g)});else{var c=r();c!==$&&(kb.autoLaunch=c),kb.autoLaunch?(Z.call(g,!0),t()):u.call(g).ensure(function(){G.call(g),A.call(g,a),L.call(g)})}}}var f,g=this;a(document).unbind(aa).bind(aa,d).unbind(ba).bind(ba,e)}function r(){var a=n.get("Translator3_User_Preference"),b=a&&a.split("~");if(b&&b.length>=3)return"True"===b[2]}function s(){var b=window,c=b.document,d=b.getSelection&&b.getSelection()||c.getSelection&&c.getSelection()||c.selection&&c.selection.createRange().text||"";return a.trim((""+d).replace(ga,""))}function t(){var a=window,b=a.document;a.getSelection?a.getSelection().removeAllRanges():b.getSelection?b.getSelection().removeAllRanges():b.selection&&b.selection.empty()}function u(){var a=this;return a._isRendered?b.resolve():(a._isRendered=!0,v.call(a))}function v(){var a=this;return a[ma]?a.html(f({enableTranslatorDetail:a[na]})).then(function(){a[_].find(Ma).mouseenter(function(){a.publish("tracking/useraction",{"action.translateOverlay":"1"})}),y.call(a)}):a[na]?a.html(g).then(function(){y.call(a)}):b.resolve()}function w(a){var c=this;if(a){if(c._speechListenRendered)return b.resolve();c._speechListenRendered=!0}else{if(c._headListenRendered)return b.resolve();c._headListenRendered=!0}var d={isForSpeech:a,settings:jb},e=c[_].find(a?Za:Oa);return e.html(h(d)).find("*").weave().then(function(){H.call(c,e),e.removeClass(ra)},function(){a?c._speechListenRendered=!1:c._headListenRendered=!1})}function x(){var a=this;if(a._settingsRendered)return b.resolve();a._settingsRendered=!0;var c=a[_].find($a),d={settings:jb};return c.html(i(d)).find("*").weave().done(function(){c.removeClass(ra)},function(){a._settingsRendered=!1})}function y(){var a=this;D.call(a),F.call(a),E.call(a),w.call(a,!1),I.call(a)}function z(b){var c=b.pageX,d=b.pageY,e=this,f=C.call(e),g=a(window),h=g.width(),i=g.height(),j=h-f.width,k=i-f.height,l=c+10,m=d-60;l>j&&(l=j),m<0?m=0:m>k&&(m=k);var n,o=e[_];o.find(Ma).css({left:l,top:m}),e._isTtsSmallBox&&(n=o.find(Ka),n.css(B(n,b)))}function A(a){var b,c=this;c._isTransSmallBox&&(b=c[_].find(La),b.css(B(b,a)))}function B(b,c){var d=c.pageX,e=c.pageY,f=a(window),g=f.width(),h=f.height(),i=g-b.width(),j=h-b.height(),k=d+20,l=e-10;return k>i&&(k=i),l<0?l=0:l>j&&(l=j),{left:k,top:l}}function C(){var a=this;if(!a._ttsBoxSize){var b=a[_].find(Ma),c=b.find(Na).outerHeight()+b.find(Va).outerHeight()+b.find(cb).outerHeight()+10;a._ttsBoxSize={width:b.outerWidth()+10,height:c}}return a._ttsBoxSize}function D(){var a=this[_],b=a.data("zIndex");b!==$&&a.find(Ka+","+Ma).css("z-index",b)}function E(){function b(){g=a(window).width()-f}function d(a,b){var c=b.position;g>0&&c.left>g&&(c.left=g)}var e=this,f=C.call(e).width+2,g=0;c(e[_].find(Ma)).draggable({handle:Na,addClasses:!1,containment:"window",scroll:!1,scope:!1,disabled:!0,start:b,drag:d})}function F(a){var b=this;b._isTtsSmallBox=a===$?!jb.autoLaunch:!!a,b[_].removeClass(za).toggleClass(xa,b._isTtsSmallBox)}function G(a){var b=this;b._isTransSmallBox=a===$?!kb.autoLaunch:!!a,b[_].removeClass(za).toggleClass(ya,b._isTransSmallBox)}function H(a){var b=a.find(eb),c=a.find(db);c.on("play playing",function(){b.removeClass(va).addClass(wa)}),c.on("pause ended",function(){b.removeClass(wa)}),c.on("error",function(){b.removeClass(wa).removeClass(va)})}function I(){var a=this,b=rb;J.call(a).ensure(function(){a[_].find(Pa).find(Ra).attr(qa,a._isPinned?b[mb]:b[lb]).end().find(Sa).attr(qa,b[nb]).end().find(Ta).attr(qa,b[ob]).end().find(Ua).attr(qa,b[pb])})}function J(){var a=this;if(!a[qb]){var b=Object.keys(rb);a[qb]=a.query(b).then(function(a){a.forEach(function(a){var b=a&&a.translation;b&&(rb[a.id]=b)})})}return a[qb]}function K(){this[_].find(eb).removeClass(wa+da+va)}function L(){var a=this;a._isHidden=!1,a[_].show(),K.call(a),Y.call(a)}function M(){var a=this;a._isHidden=!0,a._isPinned=!1,a[_].hide(),N.call(a,!1),a[ma]?F.call(a):G.call(a)}function N(a){this[_].find(Ma).toggleClass(Aa,a).draggable(a?"enable":"disable").find(Ra).attr(qa,a?rb[mb]:rb[lb])}function O(){var a=this,b=a._text,c=a[_];if(c.find(Xa).val(b),!a._isTranslatorTab){var d=c.find(Sa);Q.call(a,d,ka)}}function P(a,b){var c=this;Q.call(c,a,b);var d=sb[b];typeof d===fa&&d.apply(c,arguments)}function Q(a,b){var c=this;c._isTranslatorTab=b===ka,c[_].find(Oa).toggle(c._isTranslatorTab).end().find(Qa).removeClass(sa).end().find(Va).removeClass(Ia).addClass(la+b),a.addClass(sa)}function R(a,b){a.toggleClass(ua,b)}function S(a,b){jb.speed=a,this[_].find(fb).text(b)}function T(b,c){if(!(b.hasClass(va)||b.hasClass(wa)||b.hasClass(ta))){var d,e=this,f=e[_],g=e._english;if(c&&(d=f.find(Wa),g=a.trim(d.find(Xa).val())),0===g.length||g.length>jb.maxTextLength)return void(d&&U.call(e,d,!0));if(!m.canTTS(g))if(g===ea)g=ia;else{if(c)return void V(b,!1);g=ja}var h=b.siblings(db);b.addClass(va);var i=jb.ttsUrl,j=[i+(i.indexOf("?")>=0?"&":"?")+"m="+e._member_id,"spk="+jb.speaker,"spd="+jb.speed,"t="+encodeURIComponent('"'+g+'"'),"p="+encodeURIComponent(location.href),"k="].join("&");h.attr("src",j),h.get(0).play()}}function U(a,b){var c=a.find(Ya).stop(!0,!0).toggle(b);b&&c.delay(2e3).fadeOut(3e3)}function V(a,b){a.toggleClass(ta,!b)}function W(){var a=this,b=a[_].find($a),c=function(a){b.find(bb+ca+(a?Ba:Ca)).stop(!0,!0).show().delay(2e3).fadeOut(a?1e3:3e3)},d=+b.find(_a).find("input:checked").val(),e=b.find(ab)[0].checked,f={speed:jb.speed,speaker:d,status:e?1:0};a.publish(gb,f).spread(function(a){a=a&&(a[0]||a),a&&1===a.result?(jb.speaker=d,jb.autoLaunch=e,c(!0)):c(!1)}).catch(function(){c(!1)})}function X(){var a=this,b=function(a){return(""+a).replace(/['"\\]/g,"")||" "}(a._text);b.length>jb.maxTextLength&&(b=b.substr(0,jb.maxTextLength)),a._text=b,a[oa]=!1,a.publish(ib,b,a._cultureCode).catch(function(){a[oa]=!0})}function Y(){this.publish(hb)}function Z(a){var b=this,c=b._text||"";c.length>ha&&(c=c.substr(0,ha));var d="/translator/?newcourseware=true&LE=e12-new"+(a?"-pop":"")+"&searchText="+encodeURIComponent(c);window.open(d,"Translator","height=740px,width=680px,top=0,left=0,toolbar=no,resizable=yes,location=no,status=no,scrollbars=yes").focus()}var $,_="$element",aa="mousedown.tts",ba="mouseup.tts",ca=".",da=" ",ea='"',fa="function",ga=/\n|\r/g,ha=1800,ia="double quotation",ja="Sorry! I can not recognize it.",ka=1,la="ets-tab-",ma="_enableFloatingToolkit",na="_enableTranslator",oa="_isFailed",pa={INPUT:1,TEXTAREA:1
},qa="title",ra="ets-hidden",sa="ets-active",ta="ets-disabled",ua="ets-expanded",va="ets-loading",wa="ets-playing",xa="ets-tts-small",ya="ets-trans-small",za=xa+" "+ya,Aa="ets-pinned",Ba="ets-done",Ca="ets-fail",Da="ets-ui-tts",Ea="ets-ui-tts-disabled",Fa=la+"1",Ga=la+"2",Ha=la+"3",Ia=Fa+da+Ga+da+Ha,Ja=ca+Da,Ka=".ets-ui-tts-small-box",La=".ets-ui-trans-small-box",Ma=".ets-ui-tts-box",Na=".ets-ui-tts-hd",Oa=".ets-ui-tts-hd-listen",Pa=".ets-ui-tts-tabs",Qa=".ets-ui-tts-tab"+ca+sa,Ra=".ets-ui-tts-tab.ets-pin",Sa=".ets-ui-tts-tab.ets-translator",Ta=".ets-ui-tts-tab.ets-speech",Ua=".ets-ui-tts-tab.ets-settings",Va=".ets-ui-tts-bd",Wa=".ets-ui-tts-speech",Xa=".ets-ui-tts-speech-input",Ya=".ets-ui-tts-speech-tip",Za=".ets-ui-tts-speech-listen",$a=".ets-ui-tts-settings",_a=".ets-ui-tts-settings-voice",ab="#ets-ui-tts-auto-launch",bb=".ets-ui-tts-settings-msg",cb=".ets-ui-tts-ft",db=".ets-ui-tts-listen-audio",eb=".ets-ui-tts-listen-btn",fb=".ets-ui-tts-speed-selected",gb="school/tts/SaveMemberSettings",hb="tts/translator/reset",ib="tts/translator/translate",jb={speed:100,speaker:100,autoLaunch:!0,maxTextLength:300,ttsUrl:"/tts/tts.ashx?l=1"},kb={autoLaunch:!1},lb="blurb!163322",mb="blurb!163323",nb="blurb!163084",ob="blurb!163321",pb="blurb!167509",qb="_blurbPromise",rb={};rb[lb]="PinDown",rb[mb]="PinUp",rb[nb]="Translator",rb[ob]="Speech",rb[pb]="Settings",rb["blurb!163324"]="We're sorry but there's been an error processing your request. Please try again later.";var sb=[0];return sb[1]=function(){var b=this,c=b[_],d=c.find(Oa).find(".ets-ui-tts-speed");R.call(b,d,!1),Y.call(b);var e=a.trim(c.find(Xa).val());""===e||b._text===e&&!b[oa]||(b._text=e,X.call(b))},sb[2]=function(){var a=this,b=a[_];a._isPinned||(a._isPinned=!0,N.call(a,!0));var c=b.find(Wa),d=c.find(".ets-ui-tts-speed");U.call(a,c,!1),R.call(a,d,!1),w.call(a,!0)},sb[3]=function(){var a=this;x.call(a),function(){a[_].find(bb).hide()}()},d.extend({"sig/start":function(){return o.call(this)},"hub:memory/context":function(a){if(a){var b=this;b._member_id=+l.parseId((a.user||{}).id),b._cultureCode=a.cultureCode}},"hub/tts/set/url":function(a){a&&(jb.ttsUrl=a)},"hub/tts/set/english":function(a){this._english=a||""},"hub/tts/get/translation/error":function(){return rb["blurb!163324"]},"hub/tts/open/translator":function(){Z.call(this)},"hub/tts/close/toolkit":function(){M.call(this)},"dom:.ets-ui-tts-small-box/click":function(){F.call(this,!1)},"dom:.ets-ui-trans-small-box/click":function(){Z.call(this)},"dom:.ets-ui-tts-close-btn/click":function(){M.call(this)},"dom:.ets-ui-tts-tab.ets-pin/click":function(){var a=this;a._isPinned=!a._isPinned,N.call(a,a._isPinned)},"dom:.ets-ui-tts-tab-switch/click":function(b){var c=a(b.currentTarget);c.hasClass(sa)||P.call(this,c,c.data("index"))},"dom:.ets-ui-tts-speech-input/click":function(b){var c=a(b.currentTarget).closest(Wa);U.call(this,c,!1),V(c.find(eb),!0)},"dom:.ets-ui-tts-speed/click":function(b){var c=a(b.currentTarget);R.call(this,c)},"dom:.ets-ui-tts-select-speed/click":function(b){var c=a(b.currentTarget),d=this;S.call(d,c.data("value"),c.text());var e=c.closest(".ets-ui-tts-speed");R.call(d,e,!1)},"dom:.ets-ui-tts-listen-btn/click":function(b){var c=this,d=a(b.currentTarget);T.call(c,d,d.data("value")),c.publish("tracking/useraction",{"action.translatePlay":"1"})},"dom:.ets-ui-tts-save-btn/click":function(){W.call(this)}})}),define("school-ui-shared/tts/translator/lang-helper",[],function(){"use strict";var a={},b={};return a["es-CL"]="es",a["id-ID"]="id",a["ja-JP"]="ja",a["ko-KR"]="ko",a["pt-BR"]="pt",a["zh-CN"]="zh-CHS",a["zh-HK"]="zh-CHT",a["zh-TW"]="zh-CHT",a.ch="zh-CHT",a.cs="zh-CHS",a.ge="de",a.hk="zh-CHT",a.id="id",a.jp="ja",a.kr="ko",a.sp="es",a.pt="pt",b["es-CL"]="sp",b["id-ID"]="id",b["ja-JP"]="jp",b["ko-KR"]="kr",b["pt-BR"]="pt",b["zh-CN"]="cs",b["zh-HK"]="ch",b["zh-TW"]="ch",{getBingLangByCultureCode:function(b){return a[b]||b},getEFLangByCultureCode:function(a){return b[a]||a},getBingLangByEFLang:function(b){return a[b]||b}}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/translator.html",[],function(){return function(a){return'<div class="ets-ui-tts-translating" data-weave="troopjs-ef/blurb/widget" data-blurb-id="44578" data-text-en="LOADING...Please wait"></div>\n<div class="ets-ui-tts-translation"></div>\n<div class="ets-ui-tts-translator-ft ets-none">\n    <div class="ets-ui-tts-notebook"></div>\n    <div class="ets-ui-tts-bing"></div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/translation.html",[],function(){return function(a){function b(a){d+='\n<li class="ets-ui-tts-word-pos">\n    <p>'+a.partOfSpeech+'</p>\n    <ul class="ets-ui-tts-word-sense">\n        ',c(a.definitions||[]),d+="\n    </ul>\n</li>\n"}function c(a){for(var b=0,c=a.length,e=f?c:c>0?1:0,h=c-e+1,i=0;i<e;i++){d+='\n<li class="ets-ui-tts-word-def">\n    ';for(var j=0;j<h;j++)d+="\n    "+a[b++]+g+"\n    ";d+="\n</li>\n"}}var d="",e=a||{},f=e.isEnglish,g=f?"":"; ",h=e.result||{};return d+='\n<h5 class="ets-ui-tts-translation-hd">\n    <p class="ets-ui-tts-word">'+h.wordText+"</p>\n    ",h.uk&&(d+='\n    <span class="ets-ui-tts-ipa-region">UK</span>\n    <span class="ets-ui-tts-ipa">/'+h.uk+"/</span>\n    "),d+="\n    ",h.us&&(d+='\n    <span class="ets-ui-tts-ipa-region">US</span>\n    <span class="ets-ui-tts-ipa">/'+h.us+"/</span>\n    "),d+='\n</h5>\n<ul class="ets-ui-tts-translation-bd'+(f?" ets-english":"")+'">\n    ',function(a){for(var c=a.length,d=0;d<c;d++)b(a[d])}(h.pos||[]),d+="\n</ul>\n\n",d+="\n\n",d+="\n\n"}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/notebook.html",[],function(){return function(a){var b,c="",d=a||{},e=d.wordGroups||[],f=e.length;c+="\n",d.enableTranslatorDetail&&(c+='<a class="ets-ui-tts-detail-btn" href="javascript:void(0)" data-action="open/translator" data-weave="troopjs-ef/blurb/widget" data-blurb-id="163088" data-text-en="Details"></a>'),c+='\n<div class="ets-ui-tts-wordgroup">\n    <span class="ets-ui-tts-notebook-tip ets-ui-tts-toggle-wordgroup" data-action="notebook/toggle/wordgroup">Add to My Notebook</span>\n    <ul class="ets-ui-tts-wordgroup-list">\n        <li class="ets-ui-tts-wordgroup-tip ets-ui-tts-toggle-wordgroup" data-action="notebook/toggle/wordgroup">Add to My Notebook</li>\n        ';for(var g=0;g<f;g++)b=e[g],c+='\n        <li class="ets-ui-tts-add-word" data-action="notebook/add/word(wordGroupId)" data-word-group-id="'+b.wordGroup_id+'">'+b.wordGroupName+"</li>\n        ";return c+='\n    </ul>\n</div>\n<p class="ets-ui-tts-notebook-msg ets-done" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167354" data-text-en="Add success!"></p>\n<p class="ets-ui-tts-notebook-msg ets-fail" data-weave="troopjs-ef/blurb/widget" data-blurb-id="167355" data-text-en="Add failure, please try again!"></p>'}}),define("troopjs-requirejs/template!school-ui-shared/tts/translator/bing.html",[],function(){return function(a){var b,c,d="",e=a,f=e.languageList,g=f.length;d+='\n<div class="ets-ui-tts-bing-logo">Powered by Microsoft<sup> &copy; </sup>Translator</div>\n<div class="ets-ui-tts-bing-lang">\n    <span class="ets-ui-tts-bing-tip" data-action="bing/toggle/lang" data-weave="troopjs-ef/blurb/widget" data-blurb-id="163091" data-text-en="Translate to"></span>\n    <ul class="ets-ui-tts-bing-lang-list">\n        ';for(var h=0;h<g;h++)b=f[h],c=b.cultureCode,d+='\n        <li data-lang-code="'+c+'" class="ets-ui-tts-bing-translate '+("en"===c?"ets-selected":"")+'" data-action="bing/translate(langCode)" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+b.text+'"></li>\n        ';return d+="\n    </ul>\n</div>"}}),define("school-ui-shared/tts/translator/main",["jquery","when","logger","troopjs-ef/component/widget","template!./translator.html","template!./translation.html","template!./notebook.html","template!./bing.html","./lang-helper"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=this;return l.call(a,!1,!1),a._inited?b.resolve():a.query(X).spread(function(b){b&&(a.publish(U,b.speechServerUrl),a._languageList=b.lngs||[]),a._inited=!0},function(){a._inited=!1})}function k(){var a=this;a[A].find(P).stop(!0,!0).hide(),o.call(a,!1),q.call(a,!1)}function l(a,b){this[A].find(M).toggleClass(H,!a).toggleClass(I,!!b)}function m(a){var c=this;return c._wordText=a,b.resolve().then(function(){if(!c._notebookRendered)return c._notebookRendered=!0,n.call(c).then(function(a){var b={wordGroups:a||[],enableTranslatorDetail:c[A].data("enableTranslatorDetail")};return c[A].find(N).html(g(b)).find("*").weave()},function(){c._notebookRendered=!1})}).then(function(){l.call(c,!0,!1)})}function n(){var a=this;return a.query(Y).spread(function(b){var c=b&&b.result;if(c&&c.length>0)return c;var d={groupName:E};return a.publish(S,d).spread(function(a){if((a=a&&(a[0]||a))&&a.isSuccess)return c=[{wordGroup_id:a.result,wordGroupName:E}];throw new Error("cannot load word group")})})}function o(a){this[A].find(O).toggleClass(F,a)}function p(){var a=this;return b.resolve().then(function(){if(!a._bingRendered)return a._bingRendered=!0,b.resolve().then(function(){return a._languageList?{lngs:a._languageList}:a.query(X).spread(function(a){return a})}).then(function(b){var c={languageList:(b||{}).lngs||[]};return a[A].find(Q).html(h(c)).find("*").weave()},function(){a._bingRendered=!1})}).then(function(){l.call(a,!0,!0)})}function q(a){this[A].find(R).toggleClass(F,a)}function r(a,b){var c=this,d=c[A].find(N),e=function(a){d.find(P+B+(a?J:K)).stop(!0,!0).show().delay(1e3).fadeOut(2e3)};o.call(c,!1);var f={wordGroup_id:a,wordTexts:[b||c._text]};c.publish(T,f).spread(function(a){a=a&&(a[0]||a),a&&a.isSuccess?e.call(c,!0):e.call(c,!1)},function(){e.call(c,!1)})}function s(a){this[A].toggleClass(G,a)}function t(a,b){var c=this;return u.call(c,a,b).catch(function(){return w.call(c,a)})}function u(c,d){var e=this,f=e[_]===D;return!f||/\s/.test(c)||/\d/.test(c)?(d=e[aa]||d,v(c,e[_],d),e.query(X).spread(function(b){var e=[b.translateTextAPIUrl+"?appid=Bearer "+encodeURIComponent(b.AzureApiToken),"text="+encodeURIComponent(c),"to="+d].join("&"),f={type:"GET",url:e,cache:!0};return a.ajax(f)}).then(function(b){if(!b)throw new Error("cannot translate with bing");var g=a(b).find("string").text(),h=d===D?g:f?c:"";h&&y.call(e,h),x.call(e,z(g)),p.call(e)})):b.reject(new Error("translate with ef tts"))}function v(a,b,d){var e=a.substr(0,$);c.log("BingTTS chars="+a.length+" sourceLang="+b+" targetLang="+d+" text="+e)}function w(c){var d=this;return/^([a-zA-Z`,.])+$/gim.test(a.trim(c))?d.query(Z+'"'+c+'"').catch(function(a){throw x.call(d,C),new Error("translate by ef error: "+a)}).spread(function(a){if(!a||!a.isFound)return x.call(d,C),b.reject(new Error("cannot translate by ef"));var e=(a.result||[])[0]||{},g=e.wordText;e.wordText=z(g);var h={isEnglish:(d[_]||D)===D,result:e};y.call(d,g||c),x.call(d,f(h)),m.call(d,g)}):(x.call(d,C),b.reject(new Error("cannot translate by ef")))}function x(a){var b=this;a===C&&b.publish(W).then(function(b){a=b}),b[A].find(L).html(a)}function y(a){this.publish(V,a)}function z(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var A="$element",B=".",C=null,D="en",E="from translator",F="ets-expanded",G="ets-loading",H="ets-none",I="ets-bing",J="ets-done",K="ets-fail",L=".ets-ui-tts-translation",M=".ets-ui-tts-translator-ft",N=".ets-ui-tts-notebook",O=".ets-ui-tts-wordgroup",P=".ets-ui-tts-notebook-msg",Q=".ets-ui-tts-bing",R=".ets-ui-tts-bing-lang",S="school/notebook/AddUserWordGroup",T="school/notebook/AddWordsToUserWordGroup",U="tts/set/url",V="tts/set/english",W="tts/get/translation/error",X="toolkit_context!current",Y="notebook_wordgroup!current",Z="toolkit_translation!",$=30,_="_cultureCode",aa="_bingLangTo";return d.extend({"sig/initialize":function(){return this.html(e)},"hub/tts/translator/reset":function(){k.call(this)},"hub/tts/translator/translate":function(a,b){var c=this,d=c[aa]||D;return c._text=a,c[_]=b,s.call(c,!0),j.call(c).then(function(){return t.call(c,c._text,d)}).ensure(function(){s.call(c,!1)})},"dom:.ets-ui-tts-toggle-wordgroup/click":function(){o.call(this)},"dom:.ets-ui-tts-add-word/click":function(b){var c=this,d=a(b.currentTarget);r.call(c,d.data("wordGroupId"),c._wordText),c.publish("tracking/useraction",{"action.translateAddtoNotebook":"1"})},"dom:.ets-ui-tts-detail-btn/click":function(){this.publish("tts/open/translator")},"dom:.ets-ui-tts-bing-tip/click":function(){q.call(this)},"dom:.ets-ui-tts-bing-translate/click":function(b){var c=this,d=a(b.currentTarget),e=c[aa]=i.getBingLangByEFLang(d.data("langCode"));d.hasClass("ets-selected")||(d.parent().find(B+"ets-selected").removeClass("ets-selected"),d.addClass("ets-selected")),q.call(c,!1),s.call(c,!0),t.call(c,c._text,e).ensure(function(){s.call(c,!1)})}})}),define("school-ui-shared/utils/audio-output",["when"],function(a){function b(){return a.promise(function(a,b){var c=document.createElement("audio");if(!c.canPlayType("audio/mpeg"))return void b(new Error("cannot play mp3"));c.addEventListener("error",function(d){d.srcElement&&d.srcElement.error&&d.srcElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?a(!1):b(new Error("Unexpected audio error "+d)),f.removeChild(c)}),c.addEventListener("play",function(){a(!0),f.removeChild(c)}),c.autoplay=!0,c.src=e,f.appendChild(c)})}function c(){return d?a.resolve().then(function(){return navigator.mediaDevices.enumerateDevices()}).then(function(a){return a.reduce(function(a,b){return a||"audiooutput"===b.kind},!1)}):a.resolve()}var d=Boolean(navigator.mediaDevices)&&"function"==typeof navigator.mediaDevices.enumerateDevices,e="data:audio/mpeg;base64,/+OIxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+OIxAAAAANIAAAAAExBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",f=document.body;return{hasAudioOutput:c,canPlayAudio:b}}),define("school-ui-shared/utils/browser-check",[],function(){function a(a){var c=a.toLowerCase(),d=/(edge)\/([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(firefox)[ \/]([\w.]+)/.exec(c)||/version\/([\d|.]+)(?: mobile\/[\w.]+)? (safari)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(?:(msie) ([\d.]+).*)?(trident)\/(\d+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||[],e=!1,f=null;if("safari"===d[2])d[2]=d[1],d[1]="safari";else if("trident"===d[3]){var g=b[d[4]];d[1]||(d[1]="msie",d[2]=g),e=c.indexOf("compatible")>=0&&d[2]!==g,e&&(f=parseFloat(g))}var h=/(ipad)[\S\s]*os (\d+)_(\d+)/.exec(c)||/(iphone)[\S\s]*os (\d+)_(\d+)/.exec(c)||/(android)[\S\s]*(mobile)/.exec(c)||/(android)[\S\s]*(?!mobile)/.exec(c)||/(kfjwi) /.exec(c)||/(kftt) /.exec(c)||/(kfot) /.exec(c)||[],i=h[1],j="pc";if("android"===i||"kfjwi"===i||"kftt"===i||"kfot"===i){var k=window.screen,l=k.width,m=k.height;j=Math.min(l,m)>=512?"tablet":"mobile",i="android"}else"ipad"===i?(j="tablet",i="ios"):"iphone"===i&&(j="mobile",i="ios");return"pc"!==j||i||(/mac os x/i.test(c)?i="osx":/windows/i.test(c)&&(i="windows")),{browser:d[1]||"",version:d[2]||"0.0",os:i,device:j,compatibilityMode:e,actualVersionOfCompatibility:f}}var b={4:"8.0",5:"9.0",6:"10.0",7:"11.0",8:"11.0"},c=a(navigator.userAgent);return c.parseUserAgent=a,c}),define("school-ui-shared/utils/ccl",["jquery","troopjs-ef/component/gadget","school-ui-shared/utils/query-builder"],function(a,b,c){"use strict";var d=Array.prototype.slice;return b.create({enableLockUnit:function(a){return"false"===(a||{}).value},getCCLByKey:function(b){var e=this,f=d.call(arguments);return a.each(f,function(a,b){f[a]=c.buildCCLQuery(b)}),e.query(f)},indicateCCLStringValue:function(a){return"true"===(a||{}).value.toLowerCase()}})}),define("school-ui-shared/utils/feature-access",["school-ui-shared/enum/feature-access-id"],function(a){function b(a){var b=Math.floor(a/16),e=a%16||16;return!!(c[d].charCodeAt(b)&1<<e-1)}var c={},d="unicode";return{validateFeatureByte:function(a){return b(a)},hasWritingClassFeature:function(){return b(a["Writing class limited"])||b(a["Writing class unlimited"])},hasGLClassFeature:function(){return b(a["Group discussion"])||b(a["Group discussion (unlimited)"])||b(a["Group discussion upsell"])},hasPLClassFeature:function(){return b(a["Private lesson"])||b(a["Private Lesson 40 - Unit Move On"])},hasCP20ClassFeature:function(){return b(a["Private Lesson 20"])||b(a["Private Lesson 20 - Unit Move On"])||b(a["Check Point 20"])||b(a["Check Point 20 (unlimited)"])},hasEFTClassFeature:function(){return b(a.EFT)},setFeaturesUnicode:function(a){c[d]=a},getFeaturesUnicode:function(){return c[d]}}}),define("school-ui-shared/utils/fix-viewport",["./browser-check"],function(a){function b(){return e||(e=document.querySelector("meta[name="+f+"]"))||(e=document.createElement("meta"),e.name=f,(document.head||document.getElementsByTagName("head")[0]).appendChild(e)),e}function c(){var a=screen.width>=i?j:"width="+i+",user-scalable=no";b().content=a}function d(){var d=a.device;if(("tablet"===d||"mobile"===d)&&screen.width&&screen.height&&!(screen.width>=i&&screen.height>=i)){var e=b();j=e.content,c(),(screen.width>=i&&screen.height<i||screen.height>=i&&screen.width<i)&&window.addEventListener("orientationchange",c)}}var e,f="viewport",g=parseInt(getComputedStyle(document.documentElement).minWidth,10)||0,h=parseInt(getComputedStyle(document.body).minWidth,10)||0,i=Math.max(g,h,1010),j="";return d}),define("school-ui-shared/utils/https-compatibility",["troopjs-core/pubsub/hub","logger"],function(a,b){"use strict";function c(){a.publish("query","https_compatible_urls!current").spread(function(a){g=a&&a.result||null})}function d(a){if(!g)return b.log("HTTPS whitelist not yet loaded"),!0;if(0===a.length||"/"!==a.charAt(0))return!0;for(var c=0;c<g.length;++c)if(0===a.indexOf(g[c]))return!0;return!1}function e(a){for(var b=a.target;b&&"A"!==b.tagName;)b=b.parentNode;if(b){var c=b.getAttribute("href")||"";d(c)||b.setAttribute("href",h+c)}}var f=window.location;if("https:"===f.protocol){var g=null,h="http://"+f.hostname;if(a.subscribe("context",a,c),a.reemit("context",!1,a,c),document.body.addEventListener("focus",e,!0),document.body.addEventListener("click",e,!1),window.open=function(a,b){return function(c){if(!d(c)){var e=Array.prototype.slice.call(arguments,1);return e.unshift(h+c),b.apply(a,e)}return b.apply(a,arguments)}}(window,window.open),window.parent!==window)try{window.parent.open=function(a,b){return function(c,d){if(0===c.indexOf("/translator/")&&"Translator"===d){var e=Array.prototype.slice.call(arguments,1);return e.unshift(h+c),b.apply(a,e)}return b.apply(a,arguments)}}(window.parent,window.parent.open)}catch(a){}}}),define("school-ui-shared/utils/hub-memory",["troopjs-core/pubsub/hub"],function(a){return{readMemory:function(b){var c,d=function(a){c=a};return a.subscribe(b,d,d),a.reemit(b,!1,d,d),a.unsubscribe(b,d,d),c}}}),define("hyphenate-Hyphenator",["shadow!hyphenator#exports=Hyphenator"],function(a){return a}),define("school-ui-shared/utils/hyphenate",["require","poly","when","troopjs-ef/component/gadget","../enum/hyphenator-languages"],function(a,b,c,d,e){function f(b){if(b in g)return g[b];var d=c.promise(function(c){a(["shadow!hyphenator/patterns/"+b+"#Hyphenator=hyphenate-Hyphenator&exports=Hyphenator"],c)});return g[b]=d,d}var g={},h=c.defer(),i=d.create({"hub:memory/context":function(a){h.resolver.resolve(a.cultureCode)},hyphenate:function(a){return h.promise.then(function(b){var c=e[b.toLowerCase()];return c?f(c).then(function(b){return a=b.hyphenate(a,c)||a,[a]}):[a]})}});return i.start(),i}),define("school-ui-shared/utils/language-fixing",["poly/array"],function(){function a(a,c){Array.prototype.every.call(c,function(c,d){return!(c.charCodeAt(0)>160)||(a.addClass(b),!1)})}var b="ets-ui-arabic-fix";return function(b,c,d){/^ar/.test(d)&&a(b,c)}}),define("school-ui-shared/utils/location-helper",[],function(){function a(b){var c=this;if(!(c instanceof a))return new a(b);c.link=document.createElement("a"),b&&(c.link.href=b)}return a.prototype.getUrl=function(){return this.link.href},a.prototype.toString=a.prototype.getUrl,a.prototype.valueOf=a.prototype.getUrl,a.prototype.getHref=a.prototype.getUrl,a.prototype.setHref=function(a){var b=this;return b.link.href=a,b},a.prototype.getProtocol=function(){return this.link.protocol},a.prototype.setProtocol=function(a){var b=this;return b.link.protocol=a,b},a.prototype.getHost=function(){return this.link.host},a.prototype.setHost=function(a){var b=this;return b.link.host=a,b},a.prototype.getHostname=function(){return this.link.hostname},a.prototype.setHostname=function(a){var b=this;return b.link.hostname=a,b},a.prototype.getPort=function(){return this.link.port},a.prototype.setPort=function(a){var b=this;return b.link.port=a,b},a.prototype.getPathname=function(){return this.link.pathname},a.prototype.setPathname=function(a){var b=this;return b.link.pathname=a,b},a.prototype.getSearch=function(){return this.link.search},a.prototype.setSearch=function(a){var b=this;return b.link.search=a,b},a.prototype.getHash=function(){return this.link.hash},a.prototype.setHash=function(a){var b=this;return b.link.hash=a,b},a}),define("school-ui-shared/utils/media-player",["jquery","when","troopjs-core/component/factory","./browser-check","./ccl","../enum/ccl"],function(a,b,c,d,e,f){function g(c){return c?e.getCCLByKey(f.playerRules).spread(function(b){b=b&&a.parseJSON(b[h]);var e=d[k],f=d[l];return a.map(b||!1,function(a){return a&&(!(j in a)||c===a[j])&&(!(k in a)||e===a[k])&&(!(l in a)||f>=a[l])&&a[m]}).pop()||i}):b.reject(new Error("required parameters not provided"))}var h="value",i="shim",j="type",k="browser",l="version",m="player",n=c.create({videoPlayer:function(){return g.call(this,"video")},audioPlayer:function(){return g.call(this,"audio")}});return n[i]=i,n.auto="auto",n}),define("school-ui-shared/utils/media",[],function(){"use strict";function a(a){var b=a&&a.code||null,c="number"==typeof b?String(b):null,d=window.MediaError||{};return Object.keys(d).some(function(a){return 0===a.indexOf("MEDIA_")&&d[a]===b&&(c=a,!0)}),c}return{findErrorName:a}}),define("school-ui-shared/utils/path-formatter",["troopjs-ef/component/gadget","./typeid-parser"],function(a,b){function c(){var a=this,c=a[e],d=c.path||[],f=0;$.each(arguments,function(a,c){var e,g,i,j=b.parse(c);j&&(e=j.type,g=j.id||"",e in h&&(i=h[e],d[i]=g,f=Math.max(f,i)))}),++f>1&&(d.length=f,a.route(c))}function d(a){var c=this,d=c[e],f=d.path||[],g=a;b.isId(a)&&(g=b.parseType(a));var i=h[g];if(!i)throw"pathFormatter: no such type";for(;f.length>i;)f.pop();c.route(d)}var e="URI",f=[,"enrollment!$2","course!$2","level!$2","unit!$2","lesson!$2","step!$2","activity!$2.activityContent"],g=[],h={},i=!1,j=a.create(function(){var a,c,d;if(!i){for(var d=f.length;d--;)c=void 0,a=f[d],a&&(c=b.parseType(a.replace("$2","234")),h[c]=d),g.unshift(c);i=!0}},{PREFIX:g,EXPAND:f,POSITION:h,displayName:"school-ui-shared/utils/path-formatter","hub:memory/route":function(a){this[e]=a},expand:c,collapse:d});return j.start(),j}),define("school-ui-shared/utils/performance",[],function(){"use strict";var a=window.performance,b=Boolean(a&&"function"==typeof a.getEntries&&window.PerformanceResourceTiming);return b&&"function"==typeof a.clearResourceTimings&&"function"==typeof a.setResourceTimingBufferSize&&(a.onresourcetimingbufferfull=function(b){a.getEntries().length<1e3&&a.setResourceTimingBufferSize(1e3),b.apply(this,arguments),a.clearResourceTimings()}(a.onresourcetimingbufferfull||function(){})),{getLogMessage:function(){if(b){var c={timing:a.timing,entries:a.getEntries().slice(-50)};return JSON.stringify(c,function(a,b){return"number"==typeof b?Number(b.toFixed(3)):"string"==typeof b?b.replace(/\s/g,"~"):b})}return""}}}),define("school-ui-shared/utils/progress-state",["jquery","school-ui-shared/enum/progress-state","troopjs-ef/component/gadget"],function(a,b,c){"use strict";var d=c.create({notStarted:function(a){return a===b.notStarted},hasStarted:function(a){return a===b.started},hasPassed:function(a){return a===b.completed}});return d.start(),d}),define("school-ui-shared/utils/update-command",["when","troopjs-ef/component/gadget"],function(a,b){"use strict";function c(b){var c="Sorry! Error occurred, please contact Administrator.";return f?(c=b&&b.status?b.status+" "+b.statusText:b||"unknown error",a.reject(c)):c}function d(a){var b=a&&(a[0]||a),c={success:!0,data:b};return b&&b[g]!==h||(c.success=!1,c.data=b?b[i]:"verify failed, unknown error"),c}function e(a,b,e){var f,g=this;return g.publish("school/spinner",f=g.publish(a,b)),f.spread(function(a){var c=d.call(g,a),f=c.data;if(c.success&&a!==b)return e&&g.publish(e,f),f;throw f}).otherwise(function(a){return c.call(g,a)})}var f=!0,g="id",h="fault!",i="faultMessage";return b.create({update:e})}),define("school-ui-shared/utils/update-helper",["./update-command"],function(a){"use strict";return{submitScore:function(b){return a.update("school/scoring/SubmitActivityScore",b,"ef/update/progress")},moveOnUnit:function(b){return a.update(API_MOVE_ON_UNIT,b,"ef/update/progress")},updateEnrollment:function(b){return a.update("school/enrollment/UpdateCurrentEnrollment",b)},submitRating:function(b){return a.update("school/rating/SubmitRating",b)},saveMemberSite:function(b){return a.update("school/member_site_setting/Save",b)},integrationSubmitWriting:function(b){return a.update("schoolintegration/integration_writing/SubmitWriting",b)},logFeature:function(b){return a.update("school/featuresupport/Log",b)},logActEvent:function(b){return a.update("school/school_event_log/LogActivityEvent",b)},submitWritingCorrectionRating:function(b){return a.update("school/writing_correction_rating/SubmitRating",b)},platformMigrate:function(b){return a.update("school/platform2migrate/Migrate",b)},newContentMigrate:function(b){return a.update("school/newcontentupgrade/Migrate",b)}}}),define("school-ui-shared/widget/abtest-helper",["jquery","troopjs-ef/component/widget","troopjs-browser/loom/config","when"],function(a,b,c,d){"use strict";return b.extend({"sig/start":function(){var b=this,e=b.$element.data();return e.query&&e.controller?b.query(e.query).spread(function(d){"string"==typeof e.controller&&(e.controller=a.parseJSON(e.controller));var f=e.controller[d.value];if(f)return b.$element.html(a("<div>").attr(c.weave,f).attr("data-abtest",d.value)),b.weave()}):d.resolve()}})}),define("school-ui-shared/widget/audio-player/main",["jquery","when","logger","../../utils/performance","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","school-ui-shared/utils/media","school-ui-shared/utils/hub-memory","school-ui-shared/utils/location-helper","school-ui-shared/utils/audio-output","mediaelement-and-player"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){var b=this,d=b.audioInstance?b.audioInstance.media.pluginType:"unknown",e=b._logPrefix+" mode="+d+" "+a;c.log(e)}function m(a){var d=this,e=d._logPrefix,f=d.audioInstance?d.audioInstance.media.pluginType:"unknown",g=j.hasAudioOutput().then(function(a){return"HasOutput="+a}).otherwise(function(a){return"FailedToGetOutput="+(a.message||String(a)).replace(/\s+/g,"_")}),h=j.canPlayAudio().then(function(a){return"CanPlayMedia="+a}).otherwise(function(a){return"FailedToPlayMedia="+(a.message||String(a)).replace(/\s+/g,"_")});b.all([g,h]).spread(function(b,d){var g=e+" mode="+f+" "+b+" "+d+" "+a;c.log(g)})}function n(b,e,f){function h(){j.publish("audio/event/play",b),f.controls.addClass(v)}function i(){f.controls.removeClass(v)}var j=this,k=a(e);b.addEventListener("play",h),b.addEventListener("pause",i),b.addEventListener("ended",i),w.forEach(function(a){var c=function(){k.trigger(x+a)};b.addEventListener(a,c,!1)});var n=function(a){if(!j._preloadFix){var e=a.message||g.findErrorName(b.error)||String(a),f=a.src||j._audioUrl||"",h=b.pluginType||"";c.log("Error loading audio "+h+" for "+f+": "+e);var i=d.getLogMessage();i&&l.call(j,"Error.Media.Perfs "+i),m.call(j,"Error.Media "+e)}};b.addEventListener("error",n,!1)}function o(){var c=this,d=a.extend(!0,{},c._audioOptions),e=c[s].get(0);return e.src||(c._preloadFix="msie"===f.browser&&parseInt(f.version)>9||"edge"===f.browser,c._preloadFix?e.src=z:e.src=e.attributes["data-src"].value),(c._finalized?b.resolve():q.call(c,d)).catch(function(a){a.player&&a.player.controls&&a.player.controls.show();var b="Error.Init ";throw a.canPlayType?b+="CanPlayType="+a.canPlayType("audio/mpeg"):a.error?b+=a.error:a.message?b+=a.message:b+=String(a),c._logDefer.resolver.resolve(b),a})}function p(a){return function(){var d=this,e=a.apply(d,arguments);return e&&b(e).catch(function(a){if(!("undefined"!=typeof DOMException&&a instanceof DOMException&&a.code===DOMException.ABORT_ERR)){var b=[d].concat(Array.prototype.slice.call(d.querySelectorAll("source"))),e=b.map(function(a){return a.src}).join(", ");c.log("Audio play() exception: "+String(a)+"\n"+e)}}),e}}function q(c){var d=this;return b.promise(function(b,e){d.audioInstance=new k.MediaElementPlayer(d[s].get(0),{mode:y,plugins:[],pauseOtherPlayers:"boolean"!=typeof c.pauseOtherPlayers||c.pauseOtherPlayers,alwaysShowControls:"boolean"!=typeof c.alwaysShowControls||c.alwaysShowControls,playpauseText:"",success:function(c,e,f){c.play=p(c.play);var g=a(e);g.closest(t).css("display","inline-block"),d._preloadFix&&d[s].closest(t).find(u).one("click",d._onFirstTimePlay=function(a){d._preloadFix=!1,a.stopImmediatePropagation();var b=g.data("src");d._audioUrl=b,r.call(d),c.pause(),c.setSrc(b),c.play()}),n.call(d,c,e,f),d._logDefer.resolver.resolve(),b()},error:e})})}function r(){var a=this,b=a[s],c=h.readMemory("load/course"),d=h.readMemory("load/level"),e=h.readMemory("load/activity"),g=b.closest(".ets-act-bd-activity").data("option"),i=g&&g.activityContent,j=c&&c.courseTypeCode||"",k=d&&(d.templateLevelId||d.id)||"",l=d&&(d.levelCode||d.levelNo)||"",m=e&&(e.templateActivityId||e.id)||"",n=i&&i.templateCode||"",o=a._audioUrl.replace(/ /g,"%20"),p=f.browser+"/"+parseInt(f.actualVersionOfCompatibility||f.version,10);a._logid||(a._logid=(new Date).getTime()+"."+A++),a._logPrefix=["NewMediaPlayer audio","courseTypeCode="+j,"level="+k,"levelCode="+j+"_"+l,"activity="+m,"activityType="+n,"url="+o,"browser="+p,"logid="+a._logid].join(" ")}
var s="$element",t=".mejs-container",u=".mejs-play",v="mejs-controls-playing",w=["play","playing","pause","ended"],x="media/",y="native",z="data:audio/mpeg;base64,SUQzAwAAAAAAI1RTU0UAAAAPAAAATGF2ZjU3LjQxLjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAEluZm8AAAAPAAAABwAABoYAPz8/Pz8/Pz8/Pz8/Pz9fX19fX19fX19fX19fX39/f39/f39/f39/f39/n5+fn5+fn5+fn5+fn5+fv7+/v7+/v7+/v7+/v7/f39/f39/f39/f39/f3///////////////////AAAAAExhdmM1Ny40OAAAAAAAAAAAAAAAACQAAAAAAAAAAAaGYncOXgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/jQMQAAAADSAAAAABMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/40LEOwAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jQsQ7AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+NCxDsAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/40LEOwAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jQsQ7AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+NCxDsAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",A=1e3;return e.extend(function(){var a=this;a._finalized=!1,a._audioOptions=a[s].data(),a._audioUrl=a[s].data("src")||a[s].get(0).src,a.audioInstance=null,r.call(a),a._preloadFix=!1,a._logDefer=b.defer(),a._logDefer.promise.then(function(b){b&&l.call(a,b)})},{"sig/start":function(){var a=this;return o.call(a)},"sig/stop":function(){var a=this;a._finalized=!0,a.audioInstance.pause(),a.audioInstance=null},"hub/audio/event/play":function(a){var b=this;b.audioInstance&&a!==b.audioInstance.media&&b.audioInstance.media.currentTime>0&&(b.audioInstance.media.setCurrentTime(0),b.audioInstance.media.pause())},"dom/player/play":function(a,b){var c=this;c.audioInstance&&(b&&(c._preloadFix&&(c._preloadFix=!1,c._onFirstTimePlay&&c[s].closest(t).find(u).unbind("click",c._onFirstTimePlay)),c._audioUrl=b,r.call(c),c.audioInstance.media.pause(),c.audioInstance.media.setSrc(b),c.audioInstance.media.load()),c.audioInstance.media.play())},"dom/player/pause":function(){var a=this;a.audioInstance&&a.audioInstance.media.pause()},"dom/player/seek":function(a,b){var c=this;if(c.audioInstance){var d=c.audioInstance.media.paused;c.audioInstance.media.setCurrentTime(b),d&&c.audioInstance.media.pause()}},"dom/player/end":function(){var a=this;a.audioInstance&&(a.audioInstance.media.setCurrentTime(0),a.audioInstance.media.pause())},"dom/player/volume":function(a,b){var c=this;c.audioInstance&&(c.audioInstance.media.setVolume(b.volume),"boolean"==typeof b.muted&&c.audioInstance.media.setMuted(b.muted))}})}),define("school-ui-shared/widget/blurb",["when","troopjs-ef/component/widget"],function(a,b){var c=/(?:\^(\w+)\^)/g,d={default:c};return b.extend({"sig/start":function(){var b=this,e=b.$element.data();return a(e.blurbCcl&&b.query("ccl!'"+e.blurbCcl+"'")).then(function(a){var f=a&&a[0]&&a[0].value||e.blurbId;if(f)return b.query("blurb!"+f).spread(function(a){var f=e.pattern,g=e.values,h=a&&a.translation||"";return h&&g&&(f=f?d[f]||RegExp(f,"g"):c,h=h.replace(f,function(a,b,c,d){return g[b]||b})),b.html(h)})})}})}),define("school-ui-shared/widget/hyphenate",["poly","when","jquery","troopjs-ef/component/widget","troopjs-browser/loom/config","../utils/hyphenate"],function(a,b,c,d,e,f){var g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,16)};return d.extend(function(a,b,c){this._widgetName=c},{"sig/start":function(){var a,d=this,h=d.$element;if(d._widgetName){var i=h.clone();i.attr(e.weave,d._widgetName),i.removeAttr(e.unweave),i.removeAttr(e.woven),a=d.html(i)}else a=b.resolve();return a.then(function(){return b.promise(function(a){g(a)})}).then(function(){if(h.width()>h.parent().width()){var a=h.find("*").andSelf().contents().filter(function(){return 3===this.nodeType}).map(function(){var a=c(this),b=a.text()||"";return f.hyphenate(b).spread(function(b){a.replaceWith(document.createTextNode(b))})}).get();return b.all(a)}})}})}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/container/container.html",[],function(){return function(a){var b='<div class="ets-uo-container ets-uo-loading">\n\t<div class="ets-uo-title-bar">\n\t\t<div class="ets-uo-title" data-weave="troopjs-ef/blurb/widget" data-blurb-id="450055" data-text-en="Unit overview"></div>\n\t\t';return!a.hideWorldList&&a.showDownloadButton&&(b+='\n\t\t<div class="ets-uo-export" data-weave-delay="school-ui-shared/widget/unit-overview/export-pdf/main"></div>\n\t\t'),b+='\n\t</div>\n\t<div class="ets-uo-unit-info" data-weave-delay="school-ui-shared/widget/unit-overview/unit-info/main(data)"></div>\n\t',a.hideWorldList||(b+='\n\t<div class="ets-uo-word-list" data-weave-delay="school-ui-shared/widget/unit-overview/word-list/main(data)"></div>\n\t'),b+="\n</div>"}}),define("school-ui-shared/widget/unit-overview/container/main",["when","troopjs-ef/component/widget","troopjs-browser/loom/config","template!./container.html","module"],function(a,b,c,d,e){"use strict";function f(a,b){var d=this,e=d[j].find(a);return b&&e.data("data",b),e.attr(c.weave,e.attr(k)).weave()}function g(a){return this.query("student_unit!template_unit;"+a+".unitImage, .parent, .children").spread(function(a){return{level:a.parent,unit:a,lessons:a.children}})}function h(a){return this.query("template_course_item_word!"+a).spread(function(a){return{words:a&&a.words||[]}})}var i=e.config()||{showDownloadButton:!0},j="$element",k="data-weave-delay";return b.extend(function(a,b,c){this._templateUnitId=c,this._hideWorldList=Boolean(a.data("hideWorldList"))},{"sig/start":function(){var b=this,c=b.html(d,{hideWorldList:b._hideWorldList,showDownloadButton:i.showDownloadButton}),e=g.call(b,b._templateUnitId),k=h.call(b,b._templateUnitId),l=a.all([e,c]).spread(function(a){return f.call(b,".ets-uo-unit-info",a)}),m=a.all([k,c]).spread(function(a){return f.call(b,".ets-uo-word-list",a)});return a.all([l,m]).then(function(){return f.call(b,".ets-uo-export")}).ensure(function(){b[j].find(".ets-uo-loading").removeClass("ets-uo-loading"),b[j].closest(".ets-uo-modal-loading").removeClass("ets-uo-modal-loading")}),c}})}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/export-pdf.html",[],function(){return function(a){return'<a class="ets-uo-export-link" data-weave="troopjs-ef/blurb/widget" data-blurb-id="134772" data-text-en="Download"></a>'}}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/pdf-style.html",[],function(){return function(a){return'<style type="text/css">\n\tbody {\n\t\tfont: 14px/1.5 Helvetica, Arial, sans-serif;\n\t}\n\n\t.ets-uo-title {\n\t\tfloat: left;\n\t\tmargin: 0 15px 5px 0;\n\t\tcolor: #070;\n\t}\n\n\t.ets-uo-unit-info .ets-uo-course-location {\n\t\tfloat: left;\n\t\tmargin: 0 15px 5px 0;\n\t\tcolor: #070;\n\t}\n\n\t.ets-uo-unit-info .ets-uo-unit-name {\n\t\tclear: left;\n\t\tcolor: #15a;\n\t\tmargin-bottom: 20px;\n\t\tfont-size: 16px;\n\t\tfont-weight: bold;\n\t}\n\n\t.ets-uo-word-list .ets-uo-word-list-title {\n\t\tcolor: #15a;\n\t\tfont-size: 14px;\n\t}\n\n\t.ets-uo-word-list table {\n\t\tborder-collapse: collapse;\n\t\tborder: 1px #eee solid;\n\t\twidth: 640px;\n\t\tfont-size: 12px;\n\t}\n\n\t.ets-uo-word-list th,\n\t.ets-uo-word-list td {\n\t\tborder: 1px #eee solid;\n\t\tpadding: 5px 8px;\n\t\tempty-cells: show;\n\t}\n\n\t.ets-uo-word-list th {\n\t\twhite-space: nowrap;\n\t\tbackground: #f1f1f1;\n\t}\n\n\t.ets-uo-word-list td {\n\t\tcolor: #333;\n\t}\n</style>'}}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/submit-form.html",[],function(){return function(a){return'<form method="post" action="'+a.exportPdfUrl+'">\n\t<input type="hidden" name="pdfContent" value="'+a.pdfContent.replace(/\"/g,"&quot;")+'"/>\n\t<input type="hidden" name="fileName" value="'+a.fileName+'"/>\n\t<input type="hidden" name="cacheServers" value=\'[""]\'/>\n</form>'}}),define("school-ui-shared/widget/unit-overview/export-pdf/main",["jquery","school-ui-shared/module","troopjs-ef/component/widget","template!./export-pdf.html","template!./pdf-style.html","template!./submit-form.html"],function(a,b,c,d,e,f){"use strict";function g(){var b=this,c=a("<html/>");a("<head/>").appendTo(c).append(e());var d=a("<body/>").appendTo(c),f=b[j].closest(k).clone();return f.find(".ets-uo-export, .ets-uo-unit-image, .ets-uo-unit-task, .ets-uo-word-list-column-player").remove(),d.append(f),c[0].outerHTML}function h(){var a=this,b=a[j].closest(k);return"unit-overview-level"+b.find(l).text()+"-unit"+b.find(m).text()}var i=a.extend({exportPdfUrl:"/school/StudyTools/downloads/PDF/Export"},b.config()),j="$element",k=".ets-uo-container",l=".ets-uo-level-no",m=".ets-uo-unit-no";return c.extend({"sig/start":function(){return this.html(d)},"dom:.ets-uo-export-link/click":function(){var b=this,c=b[j].children("form");if(!c.length){var d={pdfContent:g.call(b),fileName:h.call(b),exportPdfUrl:i.exportPdfUrl};c=a(f(d)).appendTo(b[j])}c.submit()}})}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/modal-container/modal-container.html",[],function(){return function(a){return'<div class="modal fade ets-uo-modal ets-uo-modal-loading" tabindex="-1" role="dialog" aria-labelledby="Unit Overview" aria-hidden="true">\n\t<div class="modal-dialog">\n\t\t<div class="modal-content">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t\t\x3c!--<div data-weave="school-ui-shared/widget/unit-overview/container/main(templateUnitId)"></div>--\x3e\n\t\t</div>\n\t</div>\n</div>'}}),define("school-ui-shared/widget/unit-overview/modal-container/main",["when","jquery","jquery.gudstrap","troopjs-ef/component/widget","template!./modal-container.html"],function(a,b,c,d,e){"use strict";return d.extend(function(a,b,c){this._templateUnitId=c,this._hideWorldList=Boolean(a.data("hideWorldList"))},{"sig/start":function(){var a=this;return a.html(e).then(function(){return b("<div></div>",{"data-weave":"school-ui-shared/widget/unit-overview/container/main(templateUnitId)",data:{templateUnitId:a._templateUnitId,hideWorldList:a._hideWorldList}}).appendTo(a.$element.find(".modal-content")).weave().then(function(){a.$element.find(".modal").modal({backdrop:"static"})})})}})}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/unit-info/unit-info.html",[],function(){return function(a){var b="",a=a||{},c=a.isGE,d=a.level||{},e=a.unit||{},f=a.lessons||[];return b+='\n<div class="ets-uo-unit-image">\n\t<img src="'+e.unitImage.url+'"/>\n</div>\n<div class="ets-uo-unit-fields">\n\t<div class="ets-uo-course-location">\n\t\t<span data-weave="troopjs-ef/blurb/widget" data-blurb-id="126799" data-text-en="Level"></span>\n\t\t<span class="ets-uo-level-no">'+(c?d.levelNo:d.levelName)+'</span>\n\t\t<span data-weave="troopjs-ef/blurb/widget" data-blurb-id="126802" data-text-en="Unit"></span>\n\t\t<span class="ets-uo-unit-no">'+e.unitNo+'</span>\n\t</div>\n\t<div class="ets-uo-unit-name">'+e.unitName+'</div>\n\t<div class="ets-uo-unit-desc">'+(e.unitDesc||"")+'</div>\n</div>\n<div class="ets-uo-unit-task">\n\t<div data-weave="troopjs-ef/blurb/widget" data-blurb-id="470915" data-text-en="Tasks"></div>\n\t<ul>\n\t\t',f.forEach(function(a){b+="\n\t\t<li>"+a.lessonName+"</li>\n\t\t"}),b+="\n\t</ul>\n</div>"}}),define("school-ui-shared/widget/unit-overview/unit-info/main",["troopjs-ef/component/widget","school-ui-shared/enum/course-type","template!./unit-info.html"],function(a,b,c){"use strict";return a.extend(function(a,d,e){var f=this,g=e,h=g.level;return g.isGE=b.isGECourse(h),f.html(c,g)})}),define("troopjs-requirejs/template!school-ui-shared/widget/unit-overview/word-list/word-list.html",[],function(){return function(a){var b="",c=a||{},d=c.words;return b+='\n<h2 class="ets-uo-word-list-title" data-weave="troopjs-ef/blurb/widget" data-blurb-id="110570" data-text-en="Vocabulary"></h2>\x3c!-- only visible for pdf export --\x3e\n<table>\n\t<thead>\n\t<tr>\n\t\t<th class="ets-uo-word-list-column-player"></th>\n\t\t<th class="ets-uo-word-list-column-vocabulary" data-weave="troopjs-ef/blurb/widget" data-blurb-id="126660" data-text-en="Vocabulary"></th>\n\t\t<th class="ets-uo-word-list-column-phonetic" data-weave="troopjs-ef/blurb/widget" data-blurb-id="135412" data-text-en="Phonetic spelling"></th>\n\t\t<th class="ets-uo-word-list-column-partofspeech" data-weave="troopjs-ef/blurb/widget" data-blurb-id="126662" data-text-en="Part of speech"></th>\n\t\t<th class="ets-uo-word-list-column-translation" data-weave="troopjs-ef/blurb/widget" data-blurb-id="126661" data-text-en="Translation / definition"></th>\n\t</tr>\n\t</thead>\n\t<tbody>\n\t\t',d.forEach(function(a){b+='<tr style="page-break-inside: avoid;">\n\t\t\t<td class="ets-uo-word-list-column-player">\n\t\t\t\t<audio src="'+a.audioPath+'" preload="none"></audio>\n\t\t\t</td>\n\t\t\t<td class="ets-uo-word-list-column-vocabulary">'+a.word+'</td>\n\t\t\t<td class="ets-uo-word-list-column-phonetic">\n\t\t\t\t',a.pronunciation.uk&&(b+='\n\t\t\t\t\t[<span data-weave="troopjs-ef/blurb/widget" data-blurb-id="135413" data-text-en="UK"></span>]'+a.pronunciation.uk+"\n\t\t\t\t"),b+="\n\t\t\t\t",a.pronunciation.us&&(b+='\n\t\t\t\t\t[<span data-weave="troopjs-ef/blurb/widget" data-blurb-id="135414" data-text-en="US"></span>]'+a.pronunciation.us+"\n\t\t\t\t"),b+='\n\t\t\t</td>\n\t\t\t<td class="ets-uo-word-list-column-partofspeech">'+a.partofSpeech+'</td>\n\t\t\t<td class="ets-uo-word-list-column-translation">'+a.translation+"</td>\n\t\t</tr>"}),b+="\n\t</tbody>\n</table>"}}),define("school-ui-shared/widget/unit-overview/word-list/main",["when","troopjs-ef/component/widget","mediaelement-and-player","template!./word-list.html"],function(a,b,c,d){"use strict";return b.extend(function(b,c,e){var f=e,g=this;return g.html(d,f).then(function(){var b=[];return g.$element.find("audio").each(function(c,d){b.push(a.promise(function(a,b){new MediaElementPlayer(d,{pauseOtherPlayers:!0,alwaysShowControls:!0,playpauseText:"",mode:"native",features:["playpause"],defaultAudioWidth:20,defaultAudioHeight:20,success:function(b,c,d){b.addEventListener("play",function(){this.currentTime=0}),a()},error:b})}))}),a.all(b)})},{"dom:tr/click":function(a){var b=$(a.currentTarget);b.addClass("etc-unit-overview-word-selected"),b.siblings().removeClass("etc-unit-overview-word-selected")}})}),define("school-ui-shared/widget/vector",["require","when","poly","school-ui-shared/utils/browser-check","troopjs-ef/component/widget"],function(a,b,c,d,e){"use strict";var f=/(\<svg[^\<]*width=\")(\S*)(\"[^\<]*\>)/gim,g=/(\<svg[^\<]*height=\")(\S*)(\"[^\<]*\>)/gim,h=/<v[^>]*width[^>]?:[^>]?([\d]+)[^>]*>/im,i=/<v[^>]*height[^>]?:[^>]?([\d]+)[^>]*>/im,j="msie"===d.browser&&8===parseInt(d.version)?"vml":"svg";return e.extend(function(a,b,c,d,e){var f=this;f.width=d,f.height=e,f.vector=c,f.$element.css("display","none")},{"sig/start":function(){var c=this;return c.width&&c.height&&c.vector?b.promise(function(b){a(["template!"+c.vector+"."+j],b)}).then(c.render.bind(c)):b.resolve()},render:function(a){var b,c,d=this,e=a();"vml"===j?(b=e.match(h),c=e.match(i),b[1]&&c[1]&&(e="<div style='zoom:"+Math.min(parseInt(d.height,10)/c[1],parseInt(d.width,10)/b[1])+"'>"+e+"</div>")):(e=e.replace(f,function(a,b,c,e){return b+d.width+"px"+e}),e=e.replace(g,function(a,b,c,e){return b+d.height+"px"+e})),d.$element.html(e),d.$element.css({display:"inline-block",width:d.width,height:d.height,"line-height":0,"vertical-align":"middle",overflow:"hidden"})}})}),define("troopjs-requirejs/template!school-ui-shared/widget/video-player/video-player.html",[],function(){return function(a){var b="",c=a.video&&a.video.url||"",d=a.video&&a.video.lowQualityUrl||"",e=a.poster&&a.poster.url||"";return b+='\n<video class="ets-vp '+(a.customClass||"")+'" width="640" height="360" playsinline="playsinline" ',e&&e.indexOf(".jpg")>0&&(b+='poster="'+e+'"'),b+=' preload="none">\n\t<source type="video/mp4" src="'+c+'" data-switch-src="'+d+'" />\n</video>'}}),define("school-ui-shared/widget/video-player/main",["when","logger","../../utils/performance","mediaelement-plugin-ef","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","school-ui-shared/utils/media","school-ui-shared/utils/hub-memory","school-ui-shared/utils/location-helper","template!./video-player.html"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){var c=this,d=c.videoInstance&&c.videoInstance.media?c.videoInstance.media.pluginType:"unknown",e=c._logPrefix+" mode="+d+" "+a;b.log(e)}function l(){var b=this,c=r.extend(!0,{},b._options),d=o.call(b),e=b.html(j,b._videoInfo);return a.all([d,e]).spread(function(d){return b._finalized?a.resolve():n.call(b,c,d,b._onSuccess)}).catch(function(a){a.player&&a.player.controls&&a.player.controls.show();var c="Error.Init ";throw a.canPlayType?c+="CanPlayType="+a.canPlayType("video/mp4"):a.error?c+=a.error:a.message?c+=a.message:c+=String(a),b._logDefer.resolver.resolve(c),a})}function m(c){return function(){var d=this,e=c.apply(d,arguments);return e&&a(e).catch(function(a){if(!("undefined"!=typeof DOMException&&a instanceof DOMException&&a.code===DOMException.ABORT_ERR)){var c=[d].concat(Array.prototype.slice.call(d.querySelectorAll("source"))),e=c.map(function(a){return a.src}).join(", ");b.log("Video play() exception: "+String(a)+"\n"+e)}}),e}}function n(e,f,h){var i=this;return a.promise(function(a,j){var l={mode:z,plugins:[],pauseOtherPlayers:"boolean"!=typeof e.pauseOtherPlayers||e.pauseOtherPlayers,alwaysShowControls:!0,startVolume:.8,success:function(d,e,f){d.play=m(d.play);var j=r(e).closest(w);j.find(u).attr("data-at-id","btn-video-start"),j.find(v).attr("data-at-id","btn-video-playpause"),d.addEventListener("error",function(a){var e=a.message||g.findErrorName(d.error)||String(a),f=a.src||i._videoInfo.video&&i._videoInfo.video.url||"",h=d.pluginType||"";b.log("Error loading video "+h+" for "+f+": "+e);var j=c.getLogMessage();j&&k.call(i,"Error.Media.Perfs "+j),k.call(i,"Error.Media "+e)},!1),d.addEventListener("play",function a(){i[q].addClass(s),d.removeEventListener("play",a)},!1),i._logDefer.resolver.resolve(),h&&h.apply(i,arguments),a()},error:j};e.features=x.concat(e.features||[]).concat(y),i.videoInstance=new d.MediaElementPlayer(i[q].find(t)[0],r.extend({},l,e,f))})}function o(){var a=this,b={playpauseText:"470485",muteText:"469863",tracksText:"469864",fullscreenText:"470489",qualityText:"469865",tracksOnText:"480847",tracksOffText:"480848",outOfTimeRangeText:"468588"},c=Object.keys(b),d=[];return c.forEach(function(a,c){d[c]="blurb!"+b[a]}),a.query(d).then(function(a){return a.forEach(function(a,d){b[c[d]]=a.translation}),b})}function p(){var a=this,b=a[q],c=h.readMemory("load/course"),d=h.readMemory("load/level"),e=h.readMemory("load/activity"),g=b.closest(".ets-act-bd-activity").data("option"),i=g&&g.activityContent,j=c&&c.courseTypeCode||"",k=d&&(d.templateLevelId||d.id)||"",l=d&&(d.levelCode||d.levelNo)||"",m=e&&(e.templateActivityId||e.id)||"",n=i&&i.templateCode||"",o=a._videoInfo.video&&a._videoInfo.video.url.replace(/ /g,"%20")||"",p=f.browser+"/"+parseInt(f.actualVersionOfCompatibility||f.version,10);a._logid||(a._logid=(new Date).getTime()+"."+A++),a._logPrefix=["NewMediaPlayer video","courseTypeCode="+j,"level="+k,"levelCode="+j+"_"+l,"activity="+m,"activityType="+n,"url="+o,"browser="+p,"logid="+a._logid].join(" ")}var q="$element",r=d.$,s="ets-vp-played",t=".ets-vp",u=".mejs-overlay-play",v="mejs-controls .mejs-playpause-button",w=".mejs-container",x=["playpause","current","progress","duration","IgnoreKeyEvent"],y=["volume"],z="native",A=1e3;return e.extend(function(b,c,d,e,f){var g=this;g._videoInfo=d,g._onSuccess=f,g._options=e,g._finalized=!1,g.videoInstance=null,p.call(g),g._logDefer=a.defer(),g._logDefer.promise.then(function(a){a&&k.call(g,a)})},{"sig/start":function(){var a=this;l.call(a)},"sig/stop":function(){var a=this;a._finalized=!0,a.videoInstance&&(a.videoInstance.pause(),a.videoInstance.remove(),a.videoInstance=null)},play:function(){this.videoInstance.media.play()}})});
//# sourceMappingURL=app-built.min.js.map
