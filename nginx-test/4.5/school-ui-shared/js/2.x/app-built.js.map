{
  "version": 3,
  "sources": [
    "enum/abtest-query-string.js",
    "enum/activity-event-type.js",
    "enum/ccl.js",
    "enum/course-type.js",
    "enum/enroll-node-type.js",
    "enum/enrollment-state.js",
    "enum/feature-access-id.js",
    "enum/hyphenator-languages.js",
    "enum/moment-language.js",
    "enum/progress-state.js",
    "enum/rating-source-type.js",
    "enum/step-type.js",
    "module.js",
    "troopjs-requirejs/template!school-ui-shared/plugins/alert-box/alert-box.html",
    "plugins/alert-box/main.js",
    "troopjs-requirejs/template!school-ui-shared/plugins/confirm-box/confirm-box.html",
    "plugins/confirm-box/main.js",
    "plugins/http-request-handling/main.js",
    "troopjs-requirejs/template!school-ui-shared/plugins/techcheck/techcheck.html",
    "plugins/techcheck/main.js",
    "plugins/techcheck/techcheck-render.js",
    "service/context.js",
    "utils/console.js",
    "service/popcache.js",
    "tracker/base/mock-data.js",
    "tracker/base/main.js",
    "tracker/sandbox/main.js",
    "tracker/etvt/etvt.js",
    "tracker/etvt/main.js",
    "tracker/omniture/omniture.js",
    "tracker/omniture/main.js",
    "tracker/shared/gollum.js",
    "troopjs-requirejs/template!school-ui-shared/tts/tts.html",
    "troopjs-requirejs/template!school-ui-shared/tts/translator.html",
    "troopjs-requirejs/template!school-ui-shared/tts/listen-panel.html",
    "troopjs-requirejs/template!school-ui-shared/tts/settings.html",
    "utils/typeid-parser.js",
    "utils/query-builder.js",
    "tts/text-helper.js",
    "tts/main.js",
    "tts/translator/lang-helper.js",
    "troopjs-requirejs/template!school-ui-shared/tts/translator/translator.html",
    "troopjs-requirejs/template!school-ui-shared/tts/translator/translation.html",
    "troopjs-requirejs/template!school-ui-shared/tts/translator/notebook.html",
    "troopjs-requirejs/template!school-ui-shared/tts/translator/bing.html",
    "tts/translator/main.js",
    "utils/audio-output.js",
    "utils/browser-check.js",
    "utils/ccl.js",
    "utils/feature-access.js",
    "utils/fix-viewport.js",
    "utils/https-compatibility.js",
    "utils/hub-memory.js",
    "utils/hyphenate.js",
    "utils/language-fixing.js",
    "utils/location-helper.js",
    "utils/media-player.js",
    "utils/media.js",
    "utils/path-formatter.js",
    "utils/performance.js",
    "utils/progress-state.js",
    "utils/update-command.js",
    "utils/update-helper.js",
    "widget/abtest-helper.js",
    "widget/audio-player/main.js",
    "widget/blurb.js",
    "widget/hyphenate.js",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/container/container.html",
    "widget/unit-overview/container/main.js",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/export-pdf.html",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/pdf-style.html",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/submit-form.html",
    "widget/unit-overview/export-pdf/main.js",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/modal-container/modal-container.html",
    "widget/unit-overview/modal-container/main.js",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/unit-info/unit-info.html",
    "widget/unit-overview/unit-info/main.js",
    "troopjs-requirejs/template!school-ui-shared/widget/unit-overview/word-list/word-list.html",
    "widget/unit-overview/word-list/main.js",
    "widget/vector.js",
    "troopjs-requirejs/template!school-ui-shared/widget/video-player/video-player.html",
    "widget/video-player/main.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClBA;AACA;AACA;AACA;AACA;AACA;AACA,ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtBA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA,ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACdA;AACA;AACA;AACA,ACHA;AACA;AACA;AACA;AACA,ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrEA;AACA;AACA;AACA;AACA,ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACfA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjIA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACn9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnGA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrEA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClGA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClEA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClBA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "app-built.js",
  "sourcesContent": [
    "define('school-ui-shared/enum/abtest-query-string',{\n\t\"activity\": {\n\t\t\"lngComp\": \"school_mvt!lancomp_new_asr_fed\"\n\t}\n});\n",
    "// For Activity Event Log 'school/school_event_log/LogActivityEvent'\n\ndefine('school-ui-shared/enum/activity-event-type',{\n\tlngCompRetryTimesV1: 1,\n\tlngCompRetryTimesV2: 2,\n\tASRMicSettingOnboarding: 3,\n\tASRMicSettingE13: 4\n});\n\n",
    "define('school-ui-shared/enum/ccl',{\n    enableChangeUnit: \"school.courseware.enableChangeUnit\",\n    enableChangeLevel: \"school.courseware.enableChangeLevel\",\n    enableTTS: \"school.courseware.e12.enableTTS\",\n    enableFloatingToolkit: \"school.enable.floatingtoolkit\",\n    enablePCHtmlEpaper: \"school.courseware.htmlepaper.pc.enable\",\n    enableSPINHtmlEpaper: \"school.courseware.htmlepaper.spin.enable\",\n    asrSrvAddr: \"school.AsrServerAddress\",\n    playerRules: \"school.courseware.e12.playerRules\"\n});\n",
    "define('school-ui-shared/enum/course-type',{\n    /**\n     * General English\n     */\n    GeneralEnglish: \"GE\",\n\n    /**\n     * Business English SPIN\n     */\n    BusinessEnglish: \"BE\",\n\n    /**\n     * Industry English SPIN\n     */\n    IndustryEnglish: \"IND\",\n\n    /**\n     * B2B Industry English SPIN\n     */\n    IndustryEnglishB2B: \"INDB2B\",\n\n    /**\n     * ILS Industry English SPIN\n     */\n    IndustryEnglishILS: \"INDILS\",\n\n    /**\n     * Travel English\n     */\n    TravelEnglish: \"TRV\",\n\n    /**\n     * English for Food Service\n     */\n    FoodEnglish: \"FSE\",\n\n    /**\n     * English for Hospitality\n     */\n    HospitalityEnglish: \"HE\",\n\n    /**\n     * English for Security\n     */\n    SecurityEnglish: \"SE\",\n\n    /**\n     * check if the course is GE by courseTypeCode\n     * @param {String} courseTypeCode\n     * @return {Boolean} true is GE course else is not\n     * @api public\n     */\n    isGECourse: function onCheckGECourse(courseTypeCode) {\n        return this.GeneralEnglish === (\"\" + courseTypeCode).toUpperCase();\n    },\n\n    /**\n     * check if the course is BE by courseTypeCode\n     * @param {String} courseTypeCode\n     * @return {Boolean} true is BE course else is not\n     * @api public\n     */\n    isBECourse: function onCheckBECourse(courseTypeCode) {\n        return this.BusinessEnglish === (\"\" + courseTypeCode).toUpperCase();\n    },\n\n    /**\n     * check if the course is SPIN by courseTypeCode\n     * @param {String} courseTypeCode\n     * @return {Boolean} true is SPIN course else is not\n     * @api public\n     */\n    isSpinCourse: function onCheckSpinCourse(courseTypeCode) {\n        return !this.isGECourse(courseTypeCode);\n    }\n});\n",
    "/**\n * enroll node type enum\n */\n define('school-ui-shared/enum/enroll-node-type',{\n    course: 1,\n    courseTypeCode: 4,\n    level: 2,\n    levelCode: 5,\n    unit: 3,\n\n    /*\n        Notes: the following node type are obsoleted.\n        Please don't use again. \n    */\n    lesson: 4,\n    step: 5,\n    activity: 6\n});\n",
    "define('school-ui-shared/enum/enrollment-state',{\n\tisPrimary: 1,\n\tisCurrent: 2,\n\tisCurrentForCourseType: 4,\n\tisEnrollable: 8\n});\n",
    "define('school-ui-shared/enum/feature-access-id',{\n    \"free self-study\"                               :  1,\n\t\"Bronze group chats\"                            :  2,\n\t\"Bronze private chats\"                          :  3,\n\t\"face to face study\"                            :  4,\n\t\"Silver group chats\"                            :  5,\n\t\"Silver private chats\"                          :  6,\n\t\"self-study no business course (not extendable)\":  7,\n\t\"Free group chats\"                              :  8,\n\t\"Gold private chats\"                            :  9,\n\t\"Private lesson\"                                :  10,\n\t\"Group discussion\"                              :  11,\n\t\"Trainer for TOEIC\"                             :  12,\n\t\"Test for TOEIC (Red)\"                          :  13,\n\t\"Test for TOEIC (Green)\"                        :  14,\n\t\"Test for TOEIC (Blue)\"                         :  15,\n\t\"Trainer for TOEFL\"                             :  16,\n\t\"Test for TOEFL (Red)\"                          :  17,\n\t\"Test for TOEFL (Green)\"                        :  18,\n\t\"Test for TOEFL (Blue)\"                         :  19,\n\t\"EFT\"                                           :  20,\n\t\"self-study (extendable)\"                       :  21,\n\t\"Group discussion (unlimited)\"                  :  22,\n\t\"Personalize Language Aptitude Test Online\"     :  23,\n\t\"Business Course (extendable)\"                  :  24,\n\t\"self-study no business course\"                 :  25,\n\t\"Trainer for TOEIC (Interstitial)\"              :  27,\n\t\"Test for TOEIC (Blue Interstitial)\"            :  28,\n\t\"Trainer for TOEFL (Interstitial)\"              :  29,\n\t\"Test for TOEFL (Blue Interstitial)\"            :  30,\n\t\"Group discussion upsell\"                       :  31,\n\t\"Writing class limited\"                         :  32,\n\t\"Writing class unlimited\"                       :  33,\n\t\"Etown Translator\"                              :  34,\n\t\"Business Course (not extendable)\"              :  35,\n\t\"Personal Coaching\"                             :  36,\n\t\"SPIN Course\"                                   :  37,\n\t\"English Corner\"                                :  38,\n\t\"self-study (B2B Homework)\"                     :  39,\n\t\"Industry English SPINs\"                        :  40,\n\t\"Travel SPINs\"                                  :  41,\n\t\"Private Lesson 20\"                             :  42,\n\t\"Private Lesson 20 - Unit Move On\"              :  43,\n\t\"GL Daily Delivery\"                             :  44,\n\t\"Check Point 20\"                                :  45,\n\t\"Check Point 20 (unlimited)\"                    :  46,\n\t\"Private Lesson 40 - Unit Move On\"              :  47,\n\t\"Camp\"                                          :  48,\n\t\"Resume Correction\"                             :  49\n});\n",
    "//if null: no hyphenator pattern, language doesn't need hyphens\ndefine('school-ui-shared/enum/hyphenator-languages',{\n\t\"ar\": null,\n\t\"de\": \"de\",\n\t\"de-de\": \"de\",\n\t\"en\": \"en-us\",\n\t\"en-gb\": \"en-gb\",\n\t\"es\": \"es\",\n\t\"es-cl\": \"es\",\n\t\"fr\": \"fr\",\n\t\"id-id\": null,\n\t\"it\": \"it\",\n\t\"ko-kr\": null,\n\t\"ja-jp\": null,\n\t\"pt-br\": \"pt\",\n\t\"ru\": \"ru\",\n\t\"th\": null,\n\t\"tr-tr\": \"tr\",\n\t\"tt\": \"ru\",\n\t\"zh-hk\": null,\n\t\"zh-tw\": null,\n\t\"zh-cn\": null\n});\n",
    "define('school-ui-shared/enum/moment-language',{\n\t\"en\": \"en\",\n\t\"en-gb\": \"en\",\n\t\"pt-br\": \"pt-br\",\n\t\"es-cl\": \"es\",\n\t\"es\": \"es\",\n\t\"fr\": \"fr\",\n\t\"de\": \"de\",\n\t\"de-de\": \"de\",\n\t\"it\": \"it\",\n\t\"ko-kr\": \"ko\",\n\t\"ja-jp\": \"ja\",\n\t\"zh-hk\": \"zh-tw\",\n\t\"zh-tw\": \"zh-tw\",\n\t\"zh-cn\": \"zh-cn\",\n\t\"th\": \"th\",\n\t\"ru\": \"ru\",\n\t\"tt\": \"ru\",\n\t\"tr-tr\": \"tr\",\n\t\"id-id\": \"id\",\n\t\"ar\": \"ar\"\n});\n",
    "define('school-ui-shared/enum/progress-state',{\n\tnotStarted: 0,\n\tstarted: 1,\n\tcompleted: 2\n});\n",
    "define('school-ui-shared/enum/rating-source-type',{\n    ASR_TYPING: \"TP\",\n    ASR_SPEAKING: \"SPK\",\n    ASR_SELECTION: \"SLCT\"\n});\n\n",
    "define('school-ui-shared/enum/step-type',{\n\tmovie: 0,\n\tfinalTask: 1,\n\tvocabulary: 2,\n\tvocabularyAndIntonnation: 3,\n\tlanguageAndFocus: 4,\n\tfunctions: 5,\n\tgrammar: 6,\n\tpronunciation: 7,\n\treading: 8,\n\tlistening: 9,\n\tspeaking: 10,\n\twriting: 11\n});\n",
    "define('school-ui-shared/module',[\"module\"], function(module){\n\treturn module;\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/plugins/alert-box/alert-box.html',[],function() { return function template(data) { var o = \"\";\n  data = data || {};\no += \"\\n<div class=\\\"modal fade in alert-modal-box\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"alertModalLabel\\\" aria-hidden=\\\"true\\\">\\n\\t<div class=\\\"modal-dialog\\\">\\n\\t\\t<div class=\\\"modal-content\\\">\\n\\t\\t\\t<div class=\\\"modal-header\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\">&times;</button>\\n\\t\\t\\t\\t<h4 class=\\\"modal-title\\\">\" + data.title + \"</h4>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"modal-body\\\">\\n\\t\\t\\t\\t<p>\" + data.body + \"</p>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"modal-footer\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"btn btn-default\\\" data-action=\\\"ok\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"150652\\\" data-text-en=\\\"OK\\\"></button>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n<div class=\\\"modal-backdrop fade in hidden\\\"></div>\"; return o; }; });\n",
    "define('school-ui-shared/plugins/alert-box/main',[\n    \"when\",\n    \"jquery.gudstrap\",\n    \"troopjs-ef/component/widget\",\n    \"template!./alert-box.html\"\n    ],function(when, $GUD, Widget, tModalBox){\n    \"use strict\";\n\n    var SEL_MODAL_ROOT = \".alert-modal-box\";\n    var SEL_MODAL_TITLE = \".modal-title\";\n    var SEL_MODAL_BODY = \".modal-body p\";\n    var SEL_BACK_DROP = \".modal-backdrop\";\n\n    var DEFERRED_OK = \"_defer_ok\";\n\n    var CLS_GUD_HIDDEN = \"hidden\";\n\n    return Widget.extend({   \n        \"sig/start\": function() {\n            var me = this;\n            \n            return me.html(tModalBox).then(function(){\n                var $el = me.$element;\n\n                me.$root = $el.find(SEL_MODAL_ROOT);\n                me.$title = $el.find(SEL_MODAL_TITLE);\n                me.$body = $el.find(SEL_MODAL_BODY);\n                me.$backdrop = $el.find(SEL_BACK_DROP);\n\n                me.$root.on('show.bs.modal', function($event) {\n                    me.$backdrop.removeClass(CLS_GUD_HIDDEN);\n                }).on('hidden.bs.modal', function($event) {\n                    me.$backdrop.addClass(CLS_GUD_HIDDEN);\n                    me.isBusy = false;\n                    //reject the promise\n                    me[DEFERRED_OK] && me[DEFERRED_OK].reject(\"confirm-box reject\");\n                });\n            });\n        },\n        \"hub/enable/show/alert-box\": function() {\n            return [!this.isBusy];\n        },\n        \"hub/show/alert-modal-box\": function(config) {\n            var me = this;\n            if(!config) return when.reject(\"alert-box no config\");\n\n            me.isBusy = true;\n            me.$title.text(config.title);\n            me.$body.html(config.body);\n\n            me.$root.modal();\n\n            return (me[DEFERRED_OK] = when.defer()).promise;\n        },\n        \"dom:[data-action='ok']/click\": function (event){\n            var me = this;\n            var defer = me[DEFERRED_OK];\n            if(defer){\n                defer.resolver.resolve({\n                    $title : me.$title,\n                    $body  : me.$body\n                });\n                defer.promise.then(function(){\n                    me.$root.modal(\"hide\");\n                });\n            }\n        }\n    });\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/plugins/confirm-box/confirm-box.html',[],function() { return function template(data) { var o = \"\";\n  data = data || {};\no += \"\\n<div class=\\\"modal fade in confirm-modal-box\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"confirmModalLabel\\\" aria-hidden=\\\"true\\\">\\n\\t<div class=\\\"modal-dialog\\\">\\n\\t\\t<div class=\\\"modal-content\\\">\\n\\t\\t\\t<div class=\\\"modal-header\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\">&times;</button>\\n\\t\\t\\t\\t<h4 class=\\\"modal-title\\\">\" + data.title + \"</h4>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"modal-body\\\">\\n\\t\\t\\t\\t<p>\" + data.body + \"</p>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"modal-footer\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"btn btn-default\\\" data-dismiss=\\\"modal\\\"></button>\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"btn btn-primary\\\" data-action=\\\"confirm\\\"></button>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n<div class=\\\"modal-backdrop fade in hidden\\\"></div>\"; return o; }; });\n",
    "define('school-ui-shared/plugins/confirm-box/main',[\n    \"when\",\n    \"jquery.gudstrap\",\n    \"troopjs-ef/component/widget\",\n    \"template!./confirm-box.html\"\n    ],function(when, $GUD, Widget, tModalBox){\n    \"use strict\";\n\n    var SEL_MODAL_ROOT = \".confirm-modal-box\";\n    var SEL_MODAL_TITLE = \".modal-title\";\n    var SEL_MODAL_BODY = \".modal-body p\";\n    var SEL_BACK_DROP = \".modal-backdrop\";\n    var SEL_CANCEL = \".btn-default\";\n    var SEL_CONFIRM = \".btn-primary\";\n\n    var CLS_GUD_HIDDEN = \"hidden\";\n\n    var DEFERRED_CONFIRM = \"confirmDfd\";\n\n    var BLURB_CANCEL = \"_cancel\";\n    var BLURB_CONFIRM = \"_confirm\";\n\n\n    return Widget.extend({\n        \"sig/start\": function() {\n            var me = this;\n\n            return when([   me.query(\"blurb!450018\", \"blurb!450019\"),\n                            me.html(tModalBox)])\n                .spread(function(blurb){\n                    var $el = me.$element;\n                    me[BLURB_CANCEL] = blurb[0] && blurb[0].translation;\n                    me[BLURB_CONFIRM] = blurb[1] && blurb[1].translation;\n\n                    me.$root = $el.find(SEL_MODAL_ROOT);\n                    me.$title = $el.find(SEL_MODAL_TITLE);\n                    me.$body = $el.find(SEL_MODAL_BODY);\n                    me.$cancel = $el.find(SEL_CANCEL);\n                    me.$confirm = $el.find(SEL_CONFIRM);\n                    me.$backdrop = $el.find(SEL_BACK_DROP);\n\n                    me.$root.on('show.bs.modal', function($event) {\n                        me.$backdrop.removeClass(CLS_GUD_HIDDEN);\n                    }).on('hidden.bs.modal', function($event) {\n                        me.$backdrop.addClass(CLS_GUD_HIDDEN);\n                        me.isBusy = false;\n                        //reject the promise\n                        me[DEFERRED_CONFIRM] && me[DEFERRED_CONFIRM].reject(\"confirm-box reject\");\n                    });\n            });\n        },\n        \"hub/enable/show/confirm-box\": function() {\n            return [!this.isBusy];\n        },\n        \"hub/show/confirm-modal-box\": function(config) {\n            var me = this;\n            if(!config) return when.reject(\"confirm-box no config\");\n\n            me.isBusy = true;\n            me.$title.text(config.title);\n            me.$body.html(config.body);\n            me.$cancel.text(config.cancel ? config.cancel : me[BLURB_CANCEL]);\n            me.$confirm.text(config.confirm ? config.confirm : me[BLURB_CONFIRM]);\n\n            me.$root.modal();\n\n            return (me[DEFERRED_CONFIRM] = when.defer()).promise;\n        },\n        \"dom:[data-action='confirm']/click\": function (event){\n            var me = this;\n            var defer = me[DEFERRED_CONFIRM];\n            if(defer){\n                defer.resolver.resolve({\n                    $title : me.$title,\n                    $body  : me.$body\n                });\n                defer.promise.then(function(){\n                    me.$root.modal(\"hide\");\n                });\n            }\n        }\n\n    });\n});\n",
    "define('school-ui-shared/plugins/http-request-handling/main',['jquery',\n        'troopjs-ef/component/widget'],\n    function HttpRequestHandling($, Widget) {\n    'use strict';\n\n    return Widget.extend({\n        \"sig/start\":function onStart() {\n            $(document).ajaxError(function(event,jqXHR,ajaxSettings,thrownError){\n                if(jqXHR.status == 403){\n                    window.location.reload();\n                }\n            });\n        }\n    });\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/plugins/techcheck/techcheck.html',[],function() { return function template(data) { var o = \"<div class=\\\"gud tck-ui\\\" data-weave=\\\"techcheck-ui/widget/container/main\\\"></div>\"; return o; }; });\n",
    "define('school-ui-shared/plugins/techcheck/main',[\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"template!./techcheck.html\"\n], function ($, Widget, tTechcheck) {\n\t\"use strict\";\n\n\tvar HUB_PLUGINS_TECHCHECK_ENABLE = \"plugins/tech-check/enable\";\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\treturn me.html(tTechcheck).then(function () {\n\t\t\t\t// Signal that the Tech-Check widget is ready\n\t\t\t\treturn me.publish(HUB_PLUGINS_TECHCHECK_ENABLE, true);\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/plugins/techcheck/techcheck-render',[\n\t\"jquery\",\n\t\"when\",\n\t\"poly/array\"\n], function ($, when, polyArray) {\n\n\tvar CLS_WIDGET = \"ets-ui-techcheck-container\",\n\t\tCLS_OVERLAY = \"ets-ui-techcheck-overlay\";\n\tvar SEL_BODY = \"body\",\n\t\tSEL_WIDGET = \".\" + CLS_WIDGET,\n\t\tSEL_OVERLAY = \".\" + CLS_OVERLAY;\n\n\tfunction renderPrependTo($container, widgetName) {\n\t\tif ($container.children(SEL_WIDGET).size() === 0) {\n\t\t\treturn $(\"<div></div>\")\n\t\t\t\t.addClass(CLS_WIDGET)\n\t\t\t\t.attr(\"data-weave\", widgetName)\n\t\t\t\t.prependTo($container)\n\t\t\t\t.weave();\n\t\t}\n\t\telse {\n\t\t\treturn when.resolve();\n\t\t}\n\t}\n\n\tfunction removeOverlay() {\n\t\t$(SEL_BODY).children(SEL_OVERLAY).remove();\n\t}\n\n\tfunction renderOverlay(widgetName) {\n\t\tremoveOverlay();\n\n\t\treturn $(\"<div></div>\")\n\t\t\t.addClass(CLS_OVERLAY)\n\t\t\t.attr(\"data-weave\", widgetName)\n\t\t\t.appendTo($(SEL_BODY))\n\t\t\t.weave();\n\t}\n\n\treturn {\n\t\t\"renderFlashInstallBanner\": function ($container, results) {\n\t\t\tresults.some(function (result) {\n\t\t\t\tif (result.id === \"flash-install\" && result.passed === false) {\n\t\t\t\t\trenderPrependTo($container, result.widgets[\"banner\"]);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\"renderFlashInstallOverlay\": function (results) {\n\t\t\tresults.some(function (result) {\n\t\t\t\tif (result.id === \"flash-install\" && result.passed === false) {\n\t\t\t\t\trenderOverlay(result.widgets[\"overlay\"]);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\"removeOverlay\": removeOverlay\n\t};\n});\n\n",
    "/**\n * load student current school context\n */\ndefine('school-ui-shared/service/context',[\n\t\"when\",\n\t\"troopjs-ef/component/service\"\n], function ContextModule(when, Service) {\n\t\"use strict\";\n\n\tfunction loadContext(isUpdate) {\n\t\tvar me = this;\n\n\t\treturn me.query([\"school_context!current.user\", \"student_course_enrollment!current\", \"student_platform_version!current\"]).spread(function doneQuery(context, courseEnroll, platformVersion) {\n\t\t\treturn me.publish(\"context\", context || {}, courseEnroll , platformVersion, isUpdate);\n\t\t});\n\t}\n\n\t/**\n\t * context module definition\n\t */\n\treturn Service.extend({\n\t\t\"displayName\" : \"school-ui-shared/service/context\",\n\n\t\t\"sig/start\": function onStart() {\n\t\t\tvar me = this;\n\t\t\t\n\t\t\tme.query(\"context!current\").spread(function(common_context){\n\t\t\t\tme.publish(\"common_context\", common_context);\n\t\t\t});\n\n\t\t\treturn loadContext.call(this, false);\n\t\t},\n\n\t\t\"hub/context/update/context\": function onUpdateContext() {\n\t\t\treturn loadContext.call(this, true);\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/utils/console',[\n\t\"school-ui-shared/module\"\n],\tfunction(module){\n\tvar config = module.config();\n\n\tfunction EMPTY(){}\n\n\tfunction wraper(name){\n\t\treturn config.debug ?\n\t\t\t\t\twindow.console &&\n\t\t\t\t\t\ttypeof window.console[name] === \"function\" &&\n\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\twindow.console[name].apply(window.console, arguments)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t||\n\t\t\t\t\t\tEMPTY\n\t\t\t\t\t:\n\t\t\t\t\tEMPTY;\n\t}\n\n\treturn {\n\t\tlog : wraper(\"log\"),\n\t\twarn : wraper(\"warn\"),\n\t\terror : wraper(\"error\"),\n\t\tinfo : wraper(\"info\"),\n\t\tdir : wraper(\"dir\"),\n\t\ttime : wraper(\"time\"),\n\t\ttimeEnd : wraper(\"timeEnd\")\n\t}\n});\n",
    "define('school-ui-shared/service/popcache',[\n\t\"troopjs-ef/component/service\",\n\t\"school-ui-shared/utils/console\",\n\t\"jquery\",\n\t\"json2\"\n], function CacheFillerService(EFService, Console, $, JSON) {\n\t\"use strict\";\n\n\t/**\n\t * Try out all possible ways to populate troop cache. Used for pre-fill data cache before any query that\n\t * eliminates network requests.\n\t */\n\tvar CACHE = \"cache\";\n\n\treturn EFService.extend(function CacheFillerService(cache) {\n\t\tif (!cache) {\n\t\t\tthrow new Error(\"no cache provided\");\n\t\t}\n\t\tthis[CACHE] = cache;\n\t}, {\n\t\t\"sig/start\": function onStart() {\n\t\t\tvar cache = this[CACHE];\n\t\t\t$(\"script[type='application/json'][data-query]\").each(function(i, el) {\n\t\t\t\tvar data;\n\n\t\t\t\ttry{ \n\t\t\t\t\tdata = JSON.parse($(el).html());\n\t\t\t\t}\n\t\t\t\tcatch(e){\n\t\t\t\t\tConsole.info(e);\n\t\t\t\t}\n\n\t\t\t\tdata && cache.put(data);\n\t\t\t});\n\t\t},\n\n\t\t\"hub/school/clearCache\": function(key) {\n\t\t\tvar cache = this[CACHE];\n\n\t\t\tcache[key] && delete cache[key];\n\t\t}\n\t});\n});\n",
    "define('school-ui-shared/tracker/base/mock-data',[],function () {\n\treturn [\n\t\t{\n\t\t\t'id': 'tracking!e12_omniture',\n\t\t\t'tracking': [\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!001',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'props': {\n\t\t\t\t\t\t'pageName': \"School:Courseware:UnitMainMenu\"\n\t\t\t\t\t},\n\t\t\t\t\t'events': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'id': 'tracking_events!001',\n\t\t\t\t\t\t\t'click': [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t'id': 'tracking_event_click!001',\n\t\t\t\t\t\t\t\t\t'selector': ' .ets-overview',\n\t\t\t\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t\t\t\t'pageName': \"School:Courseware:Test\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t// {\n\t\t\t\t//     'id': 'tracking_item!002',\n\t\t\t\t//     'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t//     'props': {\n\t\t\t\t//         'pageName': \"School:Courseware:UnitBox\"\n\t\t\t\t//     }\n\t\t\t\t// },\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!003',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'props': {\n\t\t\t\t\t\t'pageName': \"School:Courseware:Lessons\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!004',\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/unit-overview/open',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:UnitOverview\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!005',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/lesson/expand/0',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:UnitBox1\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!006',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/lesson/expand/1',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:UnitBox2\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!007',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/lesson/expand/2',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:UnitBox3\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!008',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/?$\",\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/lesson/expand/3',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:UnitBox4\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!009',\n\t\t\t\t\t'behavior': [{\n\t\t\t\t\t\t'id': 'tracking_behaviors!001',\n\t\t\t\t\t\t'name': 'study/change-course/expand',\n\t\t\t\t\t\t'props': {\n\t\t\t\t\t\t\t'pageName': \"School:Courseware:EnglishCategories\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!010',\n\t\t\t\t\t'regex': \"^school/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/\\\\d+/summary$\",\n\t\t\t\t\t'props': {\n\t\t\t\t\t\t'pageName': \"School:Courseware:ActivityResults\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t'id': 'tracking!e12_etvt',\n\t\t\t'tracking': [\n\t\t\t\t{\n\t\t\t\t\t'id': 'tracking_item!001',\n\t\t\t\t\t'regex': \"\",\n\t\t\t\t\t'props': {}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t];\n});\n\n",
    "/**\n * class TrackerBase\n * The base tracker class, allows you to inherit to implement customized tracking logic\n * It does:\n *    Getting the tracking data from server according to this.scope (which specified in sub class)\n *    Monitor the hash uri change,\n *    Check if uri match the regex in tracking data.\n */\ndefine('school-ui-shared/tracker/base/main',[\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'./mock-data'\n], function BaseTrackerModule(\n\t$,\n\twhen,\n\tWidget,\n\tMOCK_DATA\n) {\n\t\"use strict\";\n\n\tvar URI = 'uri';\n\tvar ON_SEND = '_onSend';\n\tvar EX_BOUND_ERR = 'Tracker widget must be bound to top-most element';\n\n\t/**\n\t * Try to see if current uri is matched, if matched, send out the event.\n\t * @param uri the uri to be matched and tracked.\n\t */\n\tfunction sendURI(uri) {\n\t\tif (!uri) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this, data = me._data.tracking, l;\n\n\t\tme[URI] = uri;\n\n\t\tfor (l = data.length; l--;) {\n\t\t\tif (data[l].props && data[l].regex != null && new RegExp(data[l].regex).test(uri)) {\n\t\t\t\t// this[ON_HASH_MATCH](data[l], uri);\n\t\t\t\tme[ON_SEND](data[l], {\n\t\t\t\t\turi: uri\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction sendBehavior(behavior) {\n\t\tif (!behavior) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this, data = me._data.tracking, l, lb, behaviorItem, uri = me[URI];\n\n\t\tfor (l = data.length; l--;) {\n\n\t\t\tbehaviorItem = data[l].behavior;\n\n\t\t\tif (!behaviorItem ||\n\t\t\t\t// check the constrains of uri if available\n\t\t\t\t(data[l].regex && !(new RegExp(data[l].regex).test(uri)))\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (lb = behaviorItem.length; lb--;) {\n\t\t\t\tif (behaviorItem[lb].props && behaviorItem[lb].name === behavior) {\n\n\t\t\t\t\t// this[ON_HASH_MATCH](data[l], uri);\n\t\t\t\t\tme[ON_SEND](behaviorItem[lb], {\n\t\t\t\t\t\tbehavior: behavior\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction filter(track) {\n\t\tvar me = this;\n\n\t\tme._dfdTrackingInfo.then(function(){\n\t\t\tsendURI.call(me, track.uri);\n\t\t\tsendBehavior.call(me, track.behavior);\n\t\t});\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\n\t\tme._dfdTrackingInfo = me.getTracking();\n\n\t\tme._dfdFirstRoute = when.defer();\n\t}, {\n\t\t'sig/start': function () {\n\t\t\t// check if current element is top most element\n\t\t\t// if its not, this widget cannot work\n\t\t\tvar tag = this.$element[0].tagName.toUpperCase();\n\t\t\tif (tag !== 'BODY' && tag !== 'HTML') {\n\t\t\t\tthrow EX_BOUND_ERR;\n\t\t\t}\n\t\t},\n\n\t\t'hub:memory/route': function onRoute(uri) {\n\t\t\tvar me = this;\n\n\t\t\tfilter.call(me, {\n\t\t\t\turi: uri\n\t\t\t});\n\n\t\t\tme._dfdFirstRoute.resolve();\n\t\t},\n\t\t'hub:memory/tracking/track': function onTrack(track) {\n\t\t\tvar me = this;\n\t\t\tvar behavior = track.toString();\n\n\t\t\tif (track.name) {\n\t\t\t\tbehavior = track.name;\n\t\t\t}\n\n\t\t\tme._dfdFirstRoute.promise.then(function () {\n\t\t\t\tfilter.call(me, {\n\t\t\t\t\tbehavior: behavior\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t'dom:[data-action=\"track\"]/click': function (event, behavior) {\n\t\t\tvar me = this;\n\t\t\tvar $target = $(event.currentTarget);\n\n\t\t\tme.publish('tracking/track', behavior || $target.data('behavior'));\n\t\t},\n\t\t/**\n\t\t * Get tracking info from remote server\n\t\t */\n\t\tgetTracking: function onGetTracking() {\n\t\t\tvar me = this;\n\t\t\tvar id = 'tracking!' + me.scope;\n\n\t\t\t// Check if required data is in mocking data\n\t\t\tfor (var l = MOCK_DATA.length; l--;) {\n\t\t\t\tif (MOCK_DATA[l].id === id) {\n\t\t\t\t\t// if there is, resolve with the mock data\n\t\t\t\t\tme._data = MOCK_DATA[l];\n\t\t\t\t\treturn when.resolve();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn me.query('tracking!' + me.scope)\n\t\t\t\t.spread(function (trackingData) {\n\t\t\t\t\tme._data =trackingData;\n\t\t\t\t});\n\t\t},\n\t});\n});\n\n",
    "/**\n * Shared sandbox(gollum) instance\n */\ndefine('school-ui-shared/tracker/sandbox/main',['gollum'], function (Gollum) {\n\t\"use strict\";\n\n\tvar PATH_SCODE = '/school/tracking/e12.aspx';\n\n\treturn new Gollum({\n\t\turl: PATH_SCODE\n\t});\n});\n\n",
    "define('school-ui-shared/tracker/etvt/etvt',[\n\t'../sandbox/main'\n], function EtvtWrapperModule(gollum){\n\t\"use strict\";\n\n\treturn {\n\t\tsend: function(url){\n\t\t\tgollum.exec(function(url){\n\t\t\t\tif (!window.visitTrack){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.visitTrack(url);\n\t\t\t}, url);\n\t\t}\n\t};\n});\n\n",
    "/**\n * @class omniture tracker\n * Send omniture tracking info\n */\ndefine('school-ui-shared/tracker/etvt/main',['./etvt', '../base/main'], function OmnitureTrackerModule(etvt, Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tscope: 'e12_etvt',\n\t\t_onSend: function onSend(data, track) {\n\t\t\tif (!track.uri) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Change hash to path format, and can let back-end save data to DB.\n\t\t\t// After back-end framework update, will be deleted.\n\t\t\tvar loc = window.location;\n\t\t\tetvt.send(loc.protocol + '//' + loc.host + loc.pathname + (loc.pathname.substr(loc.pathname.length - 1) === \"/\" ? loc.hash.replace('#', '') : loc.hash.replace('#', '/')) + (loc.search ? loc.search : ''));\n\t\t}\n\t});\n});\n\n",
    "/***\n * @singleton omniture\n\n * Omniture wrapper, wraps around the original omniture s_code file,\n * make sure omniture doesn't pollute the global and also provides convininent\n * APIs for single page application.\n */\ndefine('school-ui-shared/tracker/omniture/omniture',[\n\t'when',\n\t'../sandbox/main'\n], function OmnitureWrapperModule(when, gollum) {\n\t'use strict';\n\n\tvar FUNC_OMNI_SEND = 'E12_Tracking_Omniture_Send';\n\n\t// contains the backed up properties of the original s object\n\tvar backup = {};\n\n\tvar dfdSCode = when.promise(function(resolve, reject){\n\t\t// Init\n\t\tgollum\n\t\t\t.exec(function (backup) {\n\n\t\t\t\tif (!window.s) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// backup the original 's' object\n\t\t\t\tfor (var key in window.s) {\n\t\t\t\t\tbackup[key] = window.s[key];\n\t\t\t\t}\n\n\t\t\t}, backup)\n\t\t\t.then(resolve, reject);\n\t});\n\n\n\treturn {\n\t\tsend: function (settings) {\n\t\t\tdfdSCode.then(function () {\n\t\t\t\tgollum.exec(function (FUNC_OMNI_SEND, settings, backup) {\n\n\t\t\t\t\tvar s = window.s;\n\n\t\t\t\t\tif (!s || !window[FUNC_OMNI_SEND]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore the original 's' object\n\t\t\t\t\tfor (var key in s) {\n\t\t\t\t\t\tif (!s.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (key in backup) {\n\t\t\t\t\t\t\ts[key] = backup[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdelete s[key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// set up the sending parameter\n\t\t\t\t\tfor (var key in settings) {\n\t\t\t\t\t\tif (!settings.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ts[key] = settings[key];\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO: call the customized method which produced by backend code?\n\t\t\t\t\twindow[FUNC_OMNI_SEND]();\n\n\t\t\t\t}, FUNC_OMNI_SEND, settings, backup);\n\t\t\t});\n\t\t}\n\t};\n});\n\n",
    "/**\n * @class omniture tracker\n * Send omniture tracking info\n */\ndefine('school-ui-shared/tracker/omniture/main',['./omniture', '../base/main'], function OmnitureTrackerModule(omniture, Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tscope: 'e12_omniture',\n\t\t_onSend: function onSend(data) {\n\t\t\tomniture.send(data.props);\n\t\t}\n\t});\n});\n\n",
    "/**\n * @class Gollum\n * Load script under sandboxed execution context to isolate unsafe code.\n */\ndefine('school-ui-shared/tracker/shared/gollum',['jquery'], function TrackerGollum($) {\n\t'use strict';\n\n\tvar NAME = 'Gollum';\n\tvar EX_NO_ARG = NAME + ': Required argument is missing.';\n\tvar EX_NO_DEFFERED = NAME + ': jQuery does not implement Deferred() method.';\n\n\tvar defaultSettings = {\n\t\turl: 'about:blank'\n\t};\n\n\tvar Deferred = $.Deferred;\n\n\tif (!Deferred) {\n\t\tthrow EX_NO_DEFFERED;\n\t}\n\n\t// @constructor\n\t// @param opts options: {url: 'The url for iframe.'}.\n\tfunction Gollum(opts) {\n\n\t\tvar me = this;\n\n\t\tme.opts = opts || defaultSettings;\n\n\t\tme.ready = Deferred();\n\n\t\t// It creates the iframe which contains the dirty scripts.\n\t\tvar $gollum = (function createGollum() {\n\n\t\t\tvar ret = $(document.createElement('iframe'));\n\n\t\t\tret.attr('src', me.opts.url);\n\n\t\t\tret.hide();\n\n\t\t\tret.appendTo(document.body);\n\n\t\t\treturn ret;\n\n\t\t})();\n\n\t\tme._$gollum = $gollum;\n\n\t\t// It also make sure that all operation are done after iframe\n\t\t// is properly loaded\n\t\tme._$gollum.bind('load', function () {\n\t\t\t$gollum[0].contentWindow.__gollumArgs__ = [];\n\t\t\tme.ready.resolve();\n\t\t});\n\t}\n\n\tvar p = Gollum.prototype;\n\n\t/**\n\t * Load script under the execution context created by gollum.\n\t * @param path The script path\n\t * @api public\n\t */\n\tp.load = function (path) {\n\t\tif (!path) {\n\t\t\tthrow EX_NO_ARG;\n\t\t}\n\n\t\tvar me = this;\n\t\tvar deferred = Deferred();\n\n\t\tme.ready.done(function () {\n\n\t\t\tvar window = this._$gollum[0].contentWindow;\n\t\t\tvar doc = window.document;\n\t\t\tvar script = doc.createElement('script');\n\n\t\t\tscript.src = path;\n\n\t\t\tif (script.completed) {\n\t\t\t\tdeferred.resolve();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tscript.onload = function () {\n\t\t\t\t\tdeferred.resolve();\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdoc.body.appendChild(script);\n\n\t\t});\n\n\t\treturn deferred;\n\t};\n\n\t/**\n\t * Execute a function under the execution context of sub window,\n\t *     Caveat: The function passed in cannot visit its own execution context.\n\t * @param func The function to be executed under the sub window, or string that\n\t *               contains code to be executed.\n\t * @param ... All the remaining parameters will be passed into 'func'.\n\t * @api public\n\t */\n\tp.exec = function (func) {\n\t\tif (!func) {\n\t\t\tthrow EX_NO_ARG;\n\t\t}\n\n\t\tvar me = this;\n\t\tvar ret = Deferred();\n\t\tvar sSource = func.toString();\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\t\tme.ready.done(function () {\n\t\t\tvar window = me._$gollum[0].contentWindow;\n\n\t\t\twindow.__gollumArgs__.push(Array.prototype.slice.call(args));\n\n\t\t\tret.resolve(window.eval(\n\t\t\t\t'(' + sSource + ').apply(this, this.__gollumArgs__.shift());'\n\t\t\t));\n\t\t});\n\n\t\treturn ret;\n\t};\n\n\treturn Gollum;\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/tts.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-ui-tts-small-box\\\" data-action=\\\"show/box\\\"></div>\\n<div class=\\\"ets-ui-tts-box\\\">\\n    <div class=\\\"ets-ui-tts-close-btn\\\" data-action=\\\"close/box\\\"></div>\\n    <div class=\\\"ets-ui-tts-main\\\">\\n        <div class=\\\"ets-ui-tts-hd\\\">\\n            <div class=\\\"ets-ui-tts-hd-listen ets-hidden\\\"></div>\\n            <div class=\\\"ets-ui-tts-tabs\\\">\\n                <div data-action=\\\"toggle/pin(index)\\\" data-index=\\\"0\\\" class=\\\"ets-ui-tts-tab ets-pin\\\">\\n                    <div class=\\\"ets-ui-tts-tab-ico\\\"></div>\\n                </div>\\n                <div data-action=\\\"switch/tab(index)\\\" data-index=\\\"1\\\" class=\\\"ets-ui-tts-tab ets-ui-tts-tab-switch ets-translator ets-active\\\">\\n                    <div class=\\\"ets-ui-tts-tab-ico\\\"></div>\\n                    <div class=\\\"ets-ui-tts-tab-arrow\\\"></div>\\n                </div>\\n                <div data-action=\\\"switch/tab(index)\\\" data-index=\\\"2\\\" class=\\\"ets-ui-tts-tab ets-ui-tts-tab-switch ets-speech\\\">\\n                    <div class=\\\"ets-ui-tts-tab-ico\\\"></div>\\n                    <div class=\\\"ets-ui-tts-tab-arrow\\\"></div>\\n                </div>\\n                <div data-action=\\\"switch/tab(index)\\\" data-index=\\\"3\\\" class=\\\"ets-ui-tts-tab ets-ui-tts-tab-switch ets-settings\\\">\\n                    <div class=\\\"ets-ui-tts-tab-ico ets-last\\\"></div>\\n                    <div class=\\\"ets-ui-tts-tab-arrow\\\"></div>\\n                </div>\\n            </div>\\n        </div>\\n        <div class=\\\"ets-ui-tts-bd ets-tab-1\\\">\\n            <div class=\\\"ets-ui-tts-bd-main\\\">\\n                <div class=\\\"ets-ui-tts-translator ets-loading\\\" data-weave=\\\"school-ui-shared/tts/translator/main\\\" data-enable-translator-detail=\\\"\" +data.enableTranslatorDetail+ \"\\\"></div>\\n                <div class=\\\"ets-ui-tts-speech\\\">\\n                    <textarea class=\\\"ets-ui-tts-speech-input\\\" data-action=\\\"click/input\\\"></textarea>\\n                    <div class=\\\"ets-ui-tts-speech-listen ets-hidden\\\"></div>\\n                    <div class=\\\"ets-ui-tts-speech-tip\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"165019\\\" data-text-en=\\\"You could enter your content to listen the pronunciation, allow max 300 characters.\\\"></div>\\n                </div>\\n                <div class=\\\"ets-ui-tts-settings ets-hidden\\\"></div>\\n            </div>\\n        </div>\\n        <div class=\\\"ets-ui-tts-ft\\\"></div>\\n    </div>\\n</div>\\n<div id=\\\"ets-ui-tts-sound-sprite\\\"></div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/translator.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-ui-trans-small-box\\\" data-action=\\\"open/translator\\\">Translate</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/listen-panel.html',[],function() { return function template(data) { var o = \"\";\n    var model = data || {},\n        settings = model.settings || {},\n        isForSpeech = model.isForSpeech,\n        id = new Date().getTime();\no += \"\\n<div class=\\\"ets-ui-tts-listen-panel\\\">\\n    <div class=\\\"ets-ui-tts-listen-panel-bd\\\">\\n        <div class=\\\"ets-ui-tts-listen\\\">\\n            <a id=\\\"ets-ui-tts-listen-btn-\" +id+ \"\\\" data-action=\\\"listen/speech(\" +isForSpeech+ \")\\\" data-value=\\\"\" +isForSpeech+ \"\\\" class=\\\"ets-ui-tts-listen-btn\\\" href=\\\"javascript:void(0)\\\"><span></span></a>\\n            <audio id=\\\"ets-ui-tts-listen-audio-\" +id+ \"\\\" class=\\\"ets-ui-tts-listen-audio\\\"></audio>\\n        </div>\\n        <div class=\\\"ets-ui-tts-speed\\\" data-action=\\\"toggle/speed\\\">\\n            <div class=\\\"ets-ui-tts-speed-bd\\\">\\n                <span class=\\\"ets-ui-tts-speed-selected\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"\" +(settings.speed === 100 ? 167328 : 167329)+ \"\\\"></span>\\n                <ul class=\\\"ets-ui-tts-speed-options\\\">\\n                    <li class=\\\"ets-ui-tts-select-speed\\\" data-action=\\\"select/speed(value)\\\" data-value=\\\"100\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167328\\\" data-text-en=\\\"Normal speed\\\"></li>\\n                    <li class=\\\"ets-ui-tts-select-speed\\\" data-action=\\\"select/speed(value)\\\" data-value=\\\"80\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167329\\\" data-text-en=\\\"Slow speed\\\"></li>\\n                </ul>\\n            </div>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/settings.html',[],function() { return function template(data) { var o = \"\";\n    var model = data || {},\n        settings = model.settings || {};\no += \"\\n<h4 data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167332\\\" data-text-en=\\\"Voice\\\"></h4>\\n<div class=\\\"ets-ui-tts-settings-voice\\\">\\n    <input type=\\\"radio\\\" name=\\\"ets-ui-tts-voice\\\" value=\\\"101\\\" id=\\\"ets-ui-tts-voice-male\\\"\" +(settings.speaker !== 100 ? \" checked='checked'\" : \"\")+ \" />\\n    <label for=\\\"ets-ui-tts-voice-male\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167334\\\" data-text-en=\\\"Male\\\"></label>\\n    <input type=\\\"radio\\\" name=\\\"ets-ui-tts-voice\\\" value=\\\"100\\\" id=\\\"ets-ui-tts-voice-female\\\"\" +(settings.speaker === 100 ? \" checked='checked'\" : \"\")+ \" />\\n    <label for=\\\"ets-ui-tts-voice-female\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167336\\\" data-text-en=\\\"Female\\\"></label>\\n</div>\\n<h4 data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167345\\\" data-text-en=\\\"Display Mode\\\"></h4>\\n<div class=\\\"ets-ui-tts-settings-display\\\">\\n    <input type=\\\"checkbox\\\" name=\\\"ets-ui-tts-auto-launch\\\" id=\\\"ets-ui-tts-auto-launch\\\"\" +(settings.autoLaunch ? \" checked='checked'\" : \"\")+ \" />\\n    <label for=\\\"ets-ui-tts-auto-launch\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167348\\\" data-text-en=\\\"Launch it automatically when a word is double-clicked\\\"></label>\\n</div>\\n<a class=\\\"ets-ui-tts-save-btn\\\" href=\\\"javascript:void(0)\\\" data-action=\\\"save/settings\\\">\\n    <span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167349\\\" data-text-en=\\\"Save\\\"></span>\\n</a>\\n<span class=\\\"ets-ui-tts-settings-msg ets-done\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167350\\\" data-text-en=\\\"Saved successfully!\\\"></span>\\n<span class=\\\"ets-ui-tts-settings-msg ets-fail\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167351\\\" data-text-en=\\\"Save failed, please try again!\\\"></span>\"; return o; }; });\n",
    "define('school-ui-shared/utils/typeid-parser',[\n\t\"troopjs-core/component/factory\"\n], function TypeidParserUtilModule(Factory) {\n\t\"use strict\";\n\tvar RE_TYPEID = /^(?:(\\w+)!)?!?([;\\-\\w]+)?/, /* format like \"course!201\" */\n\t\tRE_LAST_TYPEID=/(?:(\\w+)[!|;])?(\\d+)$/, /* format like \"course!201;activity;345\" */\n\t\tTYPE = \"type\",\n\t\tID = \"id\",\n\t\tUNDEF;\n\n\treturn Factory.create({\n\t\t// eg: \"course!201\" -> {type: \"course\", id: 201}\n\t\t// eg: \"course!\" -> {type: \"course\", id: undefined}\n\t\t// eg: \"234234\" -> {type: \"\", id: 234234}\n\t\t// eg: \"!234234\" -> {type: \"\", id: 234234}\n\t\t// eg: \"course!sdfsdf\" -> {type: \"course\", id: \"sdfsdf\"}\n\t\t// eg: \"sdfsdf\" -> {type: \"\", id: \"sdfsdf\"}\n\t\t// eg: \"!sdfsdf\" -> {type: \"\", id: \"sdfsdf\"}\n\t\tparse: function parse(typeid) {\n\t\t\tvar matches = RE_TYPEID.exec(typeid);\n\t\t\tif(!matches) {\n\t\t\t\tmatches = [\"\", \"\", UNDEF];\n\t\t\t\t//throw Error(\"invalid format of typeid, parse failed!\");\n\t\t\t}\n\t\t\tvar result = {};\n\t\t\tresult[TYPE] = matches[1] || \"\";\n\t\t\tresult[ID] = matches[2];\n\t\t\treturn result;\n\t\t},\n\n\t\t/*\n\t\t input : \"course!201;activity;345\"\n\t\t output: {type:'activity',id:345}\n\t\t */\n\t\tparseLastType: function parseLastType(typeid){\n\t\t\tvar rs=RE_LAST_TYPEID.exec(typeid)||[];\n\t\t\treturn {\n\t\t\t\ttype: rs[1],\n\t\t\t\tid  : rs[2]\n\t\t\t};\n\t\t},\n\n\t\t/*\n\t\t input : \"course!201;activity;345\"\n\t\t output: \"activity!345\"\n\t\t */\n\t\tparseLastTypeAndId: function parseLastTypeAndId(typeid){\n\t\t\tvar rs = RE_LAST_TYPEID.exec(typeid)||[];\n\t\t\treturn rs[1] + \"!\" + rs[2];\n\t\t},\n\n\t\t// eg: \"course!201\" -> \"course\"\n\t\tparseType: function parseType(typeid) {\n\t\t\tvar result = this.parse(typeid);\n\t\t\treturn result[TYPE];\n\t\t},\n\n\t\t// eg: \"course!201\" -> 201\n\t\tparseId: function parseId(typeid) {\n\t\t\tvar result = this.parse(typeid);\n\t\t\treturn result[ID];\n\t\t},\n\n\t\t// eg: \"activity!1234.activityContent\" -> \"activity!1234\"\n\t\tparseTypeid: function parseTypeid(str) {\n\t\t\tvar result = this.parse(str);\n\t\t\treturn result[TYPE] + \"!\" + result[ID];\n\t\t},\n\n\t\t// if input looks like a id, it returns true, otherwise false\n\t\t// eg: \"course!23423\" -> true\n\t\t// eg: \"course!\" -> true\n\t\t// eg: \"course\" -> false\n\t\tisId: function isId(str) {\n\t\t\treturn ('' + str).indexOf('!') >= 0;\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/utils/query-builder',[\n\t\"troopjs-core/component/factory\",\n\t\"school-ui-shared/utils/typeid-parser\"\n], function QueryBuilderUtilModule(Factory, typeidParser) {\n\t\"use strict\";\n\tvar PROGRESS = \"progress!\",\n\t\tCHILDREN = \".children\",\n\t\tSEPARATOR = \";\",\n\t\tCCL = \"ccl!\";\n\n\treturn Factory.create({\n\t\t// input format: enrollment!1234, course!201, 1(optional)\n\t\t// output format: progress!1234;course;201.children\n\t\tbuildProgressQuery: function buildProgressQuery(enrollmentid, typeid, childrenCount) {\n\t\t\tif(!enrollmentid || !typeid) {\n\t\t\t\tthrow Error(\"invalid arguments, build progress query failed!\");\n\t\t\t}\n\t\t\tvar enrollment_id = typeidParser.parseId(enrollmentid),\n\t\t\t\toTypeid = typeidParser.parse(typeid),\n\t\t\t\tchildren = \"\";\n\t\t\tif(childrenCount) {\n\t\t\t\tchildrenCount = parseInt(childrenCount ,10);\n\t\t\t\tif(isNaN(childrenCount) || childrenCount < 0) {\n\t\t\t\t\tchildrenCount = 0;\n\t\t\t\t}\n\t\t\t\twhile(childrenCount-- > 0) {\n\t\t\t\t\tchildren += CHILDREN;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn PROGRESS.concat([enrollment_id, oTypeid.type, oTypeid.id].join(SEPARATOR), children);\n\t\t},\n\n\t\tbuildCCLQuery: function buildCCLQuery(variableName) {\n\t\t\tif (!variableName) {\n\t\t\t\tthrow Error(\"invalid ccl variableName, build ccl query faild!\");\n\t\t\t}\n\t\t\treturn CCL + '\"' + variableName + '\"';\n\t\t}\n\t});\n});\n",
    "/**\n * check text if can be recognized by TTS\n */\ndefine('school-ui-shared/tts/text-helper',[],function TextHelperModule() {\n\t\"use strict\";\n\tvar RE_TEXT_CAN_TTS = /[A-Za-z0-9\\+\\\\]+/;\n\tvar TEXT_ONLY_ONE_CAN_TTS = [\n\t\t'~',\n\t\t'`',\n\t\t'!',\n\t\t'#',\n\t\t'^',\n\t\t'*',\n\t\t'(',\n\t\t')',\n\t\t'_',\n\t\t'-',\n\t\t'[',\n\t\t']',\n\t\t'{',\n\t\t'}',\n\t\t'|',\n\t\t';',\n\t\t':',\n\t\t'\\'',\n\t\t',',\n\t\t'.',\n\t\t'<',\n\t\t'>',\n\t\t'?',\n\t\t'$',\n\t\t'%',\n\t\t'&',\n\t\t'@',\n\t\t'/',\n\t\t'='\n\t];\n\n\treturn {\n\t\t\"canTTS\": function onCheckText(text) {\n\t\t\ttext = text || \"\";\n\t\t\tif (text.search(RE_TEXT_CAN_TTS) >= 0) {\n\t\t\t\treturn true;\n\t\t\t} else if (text.length === 1) {\n\t\t\t\treturn TEXT_ONLY_ONE_CAN_TTS.indexOf(text) >= 0;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t};\n});\n\n",
    "/**\n * TTS module definition\n */\ndefine('school-ui-shared/tts/main',[\n\t'jquery',\n\t'when',\n\t'jquery.ui',\n\t'troopjs-ef/component/widget',\n\t'school-ui-shared/module',\n\t'template!./tts.html',\n\t'template!./translator.html',\n\t'template!./listen-panel.html',\n\t'template!./settings.html',\n\t'school-ui-shared/enum/ccl',\n\t'school-ui-shared/utils/query-builder',\n\t'school-ui-shared/utils/typeid-parser',\n\t'./text-helper',\n\t'Cookies'\n], function TTSModule(\n\t$,\n\twhen,\n\tui$,\n\tWidget,\n\tmodule,\n\ttTTS,\n\ttTRANS,\n\ttListenPanel,\n\ttSettings,\n\tCCL,\n\tQueryBuilder,\n\tTypeIdParser,\n\tTextHelper,\n\tCookies\n) {\n\t\"use strict\";\n\tvar $ELEMENT = \"$element\";\n\n\t/*!\n\t * event name\n\t */\n\tvar EVENT_TTS_PRELAUNCH = \"mousedown.tts\",\n\t\tEVENT_TTS_LAUNCH = \"mouseup.tts\";\n\n\t/*!\n\t * widget constants\n\t */\n\tvar UNDEF,\n\t\tDOT = \".\",\n\t\tSPACE = \" \",\n\t\tDOUBLE_QUOTE = '\"',\n\t\tTYPE_FUNCTION = \"function\",\n\t\tRE_CRLN = /\\n|\\r/g,\n\t\tMAX_SEARCH_TEXT_LENGTH = 1800,\n\t\tTTS_TEXT_DOUBLE_QUOTATION = \"double quotation\",\n\t\tTTS_TEXT_SORRY = \"Sorry! I can not recognize it.\";\n\tvar TAB_INDEX_TRANSLATOR = 1,\n\t\tTAB_PREFIX = \"ets-tab-\";\n\n\t/*!\n\t * widget data keys\n\t */\n\tvar ENABLE_FLOATING_TOOLKIT = \"_enableFloatingToolkit\",\n\t\tENABLE_TRANSLATOR = \"_enableTranslator\",\n\t\tIS_FAILED = \"_isFailed\";\n\n\tvar IGNORED_TAG = {\n\t\t\"INPUT\": 1,\n\t\t\"TEXTAREA\": 1\n\t};\n\tvar ATTR_TITLE = \"title\";\n\n\t/*!\n\t * class variables\n\t */\n\tvar CLS_HIDDEN = \"ets-hidden\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_EXPANDED = \"ets-expanded\",\n\t\tCLS_LOADING = \"ets-loading\",\n\t\tCLS_PLAYING = \"ets-playing\",\n\t\tCLS_TTS_SMALL = \"ets-tts-small\",\n\t\tCLS_TRANS_SMALL = \"ets-trans-small\",\n\t\tCLS_ALL_SMALL = CLS_TTS_SMALL + \" \" + CLS_TRANS_SMALL,\n\t\tCLS_PINNED = \"ets-pinned\",\n\t\tCLS_DONE = \"ets-done\",\n\t\tCLS_FAIL = \"ets-fail\",\n\t\tCLS_TTS = \"ets-ui-tts\",\n\t\tCLS_TTS_DISABLED = \"ets-ui-tts-disabled\",\n\t\tCLS_TAB_1 = TAB_PREFIX + \"1\",\n\t\tCLS_TAB_2 = TAB_PREFIX + \"2\",\n\t\tCLS_TAB_3 = TAB_PREFIX + \"3\",\n\t\tCLS_TAB_N = CLS_TAB_1 + SPACE + CLS_TAB_2 + SPACE + CLS_TAB_3;\n\n\t/*!\n\t * selector variables\n\t */\n\tvar SEL_TTS = DOT + CLS_TTS,\n\t\tSEL_TTS_SMALL_BOX = \".ets-ui-tts-small-box\",\n\t\tSEL_TRANS_SMALL_BOX = \".ets-ui-trans-small-box\",\n\t\tSEL_TTS_BOX = \".ets-ui-tts-box\",\n\n\t\tSEL_TTS_HEAD = \".ets-ui-tts-hd\",\n\t\tSEL_TTS_HEAD_LISTEN = \".ets-ui-tts-hd-listen\",\n\t\tSEL_TTS_TABS = \".ets-ui-tts-tabs\",\n\t\tSEL_TTS_TAB = \".ets-ui-tts-tab\",\n\t\tSEL_TTS_TAB_ACTIVE = SEL_TTS_TAB + DOT + CLS_ACTIVE,\n\t\tSEL_TTS_TAB_PIN = SEL_TTS_TAB + \".ets-pin\",\n\t\tSEL_TTS_TAB_TRANSLATOR = SEL_TTS_TAB + \".ets-translator\",\n\t\tSEL_TTS_TAB_SPEECH = SEL_TTS_TAB + \".ets-speech\",\n\t\tSEL_TTS_TAB_SETTINGS = SEL_TTS_TAB + \".ets-settings\",\n\n\t\tSEL_TTS_BODY = \".ets-ui-tts-bd\",\n\t\tSEL_TTS_SPEECH = \".ets-ui-tts-speech\",\n\t\tSEL_TTS_SPEECH_INPUT = \".ets-ui-tts-speech-input\",\n\t\tSEL_TTS_SPEECH_TIP = \".ets-ui-tts-speech-tip\",\n\t\tSEL_TTS_SPEECH_LISTEN = \".ets-ui-tts-speech-listen\",\n\t\tSEL_TTS_SETTINGS = \".ets-ui-tts-settings\",\n\t\tSEL_TTS_SETTINGS_VOICE = \".ets-ui-tts-settings-voice\",\n\t\tSEL_TTS_SETTINGS_AUTO_LAUNCH = \"#ets-ui-tts-auto-launch\",\n\t\tSEL_TTS_SETTINGS_MSG = \".ets-ui-tts-settings-msg\",\n\t\tSEL_TTS_FOOT = \".ets-ui-tts-ft\",\n\n\t\tSEL_TTS_AUDIO = \".ets-ui-tts-listen-audio\",\n\t\tSEL_TTS_LISTEN_BUTTON = \".ets-ui-tts-listen-btn\",\n\t\tSEL_TTS_SPEED = \".ets-ui-tts-speed\",\n\t\tSEL_TTS_SPEED_SELECTED = \".ets-ui-tts-speed-selected\";\n\n\t/*!\n\t * hub topic variables\n\t */\n\tvar TOPIC_SAVE_SETTINGS = \"school/tts/SaveMemberSettings\",\n\t\tTOPIC_TTS_TRANSLATOR_RESET = \"tts/translator/reset\",\n\t\tTOPIC_TTS_TRANSLATOR_TRANSLATE = \"tts/translator/translate\";\n\n\t/*!\n\t * tts default/current settings\n\t */\n\tvar SETTINGS = {\n\t\tspeed: 100,\n\t\tspeaker: 100,\n\t\tautoLaunch: true,\n\t\tmaxTextLength: 300,\n\t\tttsUrl: \"/tts/tts.ashx?l=1\"\n\t};\n\n\tvar TRANS_SETTINGS = {\n\t\tautoLaunch: false\n\t};\n\n\t/*!\n\t * widget blurb\n\t */\n\tvar BLURB = \"blurb!\",\n\t\tBLURB_PIN_DOWN = BLURB + \"163322\",\n\t\tBLURB_PIN_UP = BLURB + \"163323\",\n\t\tBLURB_TRANSLATOR = BLURB + \"163084\",\n\t\tBLURB_SPEECH = BLURB + \"163321\",\n\t\tBLURB_SETTINGS = BLURB + \"167509\",\n\t\tBLURB_TRANSLATION_ERROR = BLURB + \"163324\",\n\t\tBLURB_PROMISE = \"_blurbPromise\";\n\tvar BLURB_LIST = {};\n\tBLURB_LIST[BLURB_PIN_DOWN] = \"PinDown\";\n\tBLURB_LIST[BLURB_PIN_UP] = \"PinUp\";\n\tBLURB_LIST[BLURB_TRANSLATOR] = \"Translator\";\n\tBLURB_LIST[BLURB_SPEECH] = \"Speech\";\n\tBLURB_LIST[BLURB_SETTINGS] = \"Settings\";\n\tBLURB_LIST[BLURB_TRANSLATION_ERROR] = \"We're sorry but there's been an error processing your request. Please try again later.\";\n\n\tvar TAB_HANDLERS = [0];\n\tTAB_HANDLERS[1] = function onTranslator() {\n\t\tvar me = this,\n\t\t\t$widget = me[$ELEMENT];\n\t\tvar $speed = $widget.find(SEL_TTS_HEAD_LISTEN).find(SEL_TTS_SPEED);\n\t\ttoggleSpeed.call(me, $speed, false);\n\t\tresetTranslator.call(me);\n\t\tvar text = $.trim($widget.find(SEL_TTS_SPEECH_INPUT).val());\n\t\tif (text !== \"\" && (me._text !== text || me[IS_FAILED])) {\n\t\t\tme._text = text;\n\t\t\ttranslate.call(me);\n\t\t}\n\n\t};\n\n\tTAB_HANDLERS[2] = function onSpeech() {\n\t\tvar me = this,\n\t\t\t$widget = me[$ELEMENT];\n\t\tif (!me._isPinned) {\n\t\t\tme._isPinned = true;\n\t\t\ttogglePin.call(me, true);\n\t\t}\n\n\t\tvar $speech = $widget.find(SEL_TTS_SPEECH),\n\t\t\t$speed = $speech.find(SEL_TTS_SPEED);\n\t\ttoggleSpeechTip.call(me, $speech, false);\n\t\ttoggleSpeed.call(me, $speed, false);\n\n\t\trenderListenPanel.call(me, true);\n\t};\n\n\tTAB_HANDLERS[3] = function onSettings() {\n\t\tvar me = this;\n\t\tvar hideSettingsMessage = function () {\n\t\t\tme[$ELEMENT]\n\t\t\t\t.find(SEL_TTS_SETTINGS_MSG)\n\t\t\t\t.hide();\n\t\t};\n\n\t\trenderSettings.call(me);\n\t\thideSettingsMessage();\n\t};\n\n\tfunction init() {\n\t\tvar me = this;\n\n\t\tme[$ELEMENT].addClass(CLS_TTS);\n\n\t\tme._isHidden = true;\n\t\tme._isRendered = false;\n\t\tme._isPinned = false;\n\t\tme._isTranslatorTab = true;\n\t\tme._text = \"\";\n\t\tme._english = \"\";\n\n\t\treturn initSettings.call(me)\n\t\t\t.ensure(function () {\n\t\t\t\tinitLaunchEvent.call(me);\n\t\t\t});\n\t}\n\n\tfunction initSettings() {\n\t\tvar me = this;\n\t\treturn me.query([\n\t\t\tQueryBuilder.buildCCLQuery(CCL.enableFloatingToolkit),\n\t\t\t\"student_translator_config!current\",\n\t\t\t\"tts_member_settings!current\"\n\t\t]).spread(function doneQuery(cclFloatingResult, translatorConfig, settings) {\n\t\t\tme[ENABLE_FLOATING_TOOLKIT] = (cclFloatingResult || {}).value === \"true\";\n\t\t\tme[ENABLE_TRANSLATOR] = (translatorConfig || {}).enabled === true;\n\t\t\t//check autoLaunch value of the pupup window module\n\t\t\tif (!me[ENABLE_FLOATING_TOOLKIT]) {\n\t\t\t\t//a autolaunch value in cookie ?\n\t\t\t\tvar cookieValue = checkTransAutolaunchByCookie();\n\t\t\t\tif (cookieValue === UNDEF) {\n\t\t\t\t\t//there isn`t cookie value, use an old interface\n\t\t\t\t\treturn me.publish(\n\t\t\t\t\t\t\"ajax\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\t\t\turl: \"/translator/Integration/GetAutoLaunchStatus\"\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(function (data) {\n\t\t\t\t\t\tTRANS_SETTINGS.autoLaunch = data === \"true\";\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tTRANS_SETTINGS.autoLaunch = cookieValue;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (settings) {\n\t\t\t\tSETTINGS.speed = settings.speed || SETTINGS.speed;\n\t\t\t\tSETTINGS.speaker = settings.speaker || SETTINGS.speaker;\n\t\t\t\tSETTINGS.autoLaunch = settings.status !== 0;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction initLaunchEvent() {\n\t\tvar me = this;\n\t\tvar isIgnoredTarget;\n\n\t\tfunction verifyIgnoredTarget($event) {\n\t\t\tvar target = $event.target,\n\t\t\t\tignored = !!IGNORED_TAG[target.tagName] || target.className === CLS_TTS_DISABLED;\n\t\t\tif (ignored && (target.readOnly === true || target.disabled === true)) {\n\t\t\t\tignored = false;\n\t\t\t}\n\t\t\treturn ignored;\n\t\t}\n\n\t\tfunction verifyTTSTarget($event) {\n\t\t\treturn $($event.target).closest(SEL_TTS).length > 0;\n\t\t}\n\n\t\tfunction prelaunch($event) {\n\t\t\tisIgnoredTarget = verifyIgnoredTarget($event);\n\t\t\tif (me._isHidden || me._isTtsSmallBox) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar isFromTTS = verifyTTSTarget($event);\n\t\t\tif (isFromTTS) {\n\t\t\t\tisIgnoredTarget = true;\n\t\t\t}\n\t\t\tif (me._isPinned || isFromTTS) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide.call(me); // hide tts when unpinned\n\t\t}\n\n\t\tfunction launch($event) {\n\t\t\tif (isIgnoredTarget) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar text = getSelectedText();\n\t\t\tif (!text) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme._text = me._english = text;\n\t\t\tif (!me[ENABLE_FLOATING_TOOLKIT]) {\n\t\t\t\tvar cookieValue = checkTransAutolaunchByCookie();\n\t\t\t\tif (cookieValue !== UNDEF) {\n\t\t\t\t\tTRANS_SETTINGS.autoLaunch = cookieValue;\n\t\t\t\t}\n\n\t\t\t\tif (TRANS_SETTINGS.autoLaunch) {\n\t\t\t\t\topenTranslator.call(me, true);\n\t\t\t\t\tclearSelection();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdoRender.call(me)\n\t\t\t\t\t\t.ensure(function alwaysCall() {\n\t\t\t\t\t\t\tsetTransBoxStyle.call(me);\n\t\t\t\t\t\t\tsetTransBoxPosition.call(me, $event);\n\t\t\t\t\t\t\tshow.call(me);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdoRender.call(me)\n\t\t\t\t\t.ensure(function alwaysCall() {\n\t\t\t\t\t\tif (!me._isPinned) {\n\t\t\t\t\t\t\tsetTtsBoxPosition.call(me, $event);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshow.call(me);\n\t\t\t\t\t\tinitTranslator.call(me);\n\t\t\t\t\t\ttranslate.call(me);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\t\t$(document)\n\t\t\t.unbind(EVENT_TTS_PRELAUNCH).bind(EVENT_TTS_PRELAUNCH, prelaunch)\n\t\t\t.unbind(EVENT_TTS_LAUNCH).bind(EVENT_TTS_LAUNCH, launch);\n\t}\n\n\tfunction checkTransAutolaunchByCookie() {\n\t\tvar preference = Cookies.get(\"Translator3_User_Preference\");\n\t\tvar preferenceSegs = preference && preference.split(\"~\");\n\t\t//is there a autolaunch value in cookie ?\n\t\tif (preferenceSegs && preferenceSegs.length >= 3) {\n\t\t\treturn preferenceSegs[2] === 'True';\n\t\t}\n\t}\n\n\tfunction getSelectedText() {\n\t\tvar win = window, doc = win.document;\n\t\tvar txt = (win.getSelection && win.getSelection()) ||\n\t\t\t(doc.getSelection && doc.getSelection()) ||\n\t\t\t(doc.selection && doc.selection.createRange().text) || \"\";\n\t\treturn $.trim((\"\" + txt).replace(RE_CRLN, \"\"));\n\t}\n\n\tfunction clearSelection() {\n\t\tvar win = window, doc = win.document;\n\t\tif (win.getSelection) {\n\t\t\twin.getSelection().removeAllRanges();\n\t\t} else if (doc.getSelection) {\n\t\t\tdoc.getSelection().removeAllRanges();\n\t\t} else if (doc.selection) {\n\t\t\tdoc.selection.empty();\n\t\t}\n\t}\n\n\tfunction doRender() {\n\t\tvar me = this;\n\t\tif (me._isRendered) {\n\t\t\treturn when.resolve();\n\t\t}\n\n\t\tme._isRendered = true;\n\t\treturn render.call(me);\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me[ENABLE_FLOATING_TOOLKIT]) {\n\t\t\tif (me[ENABLE_TRANSLATOR]) {\n\t\t\t\treturn me.html(tTRANS)\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\tonRendered.call(me);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\treturn me.html(tTTS({ enableTranslatorDetail: me[ENABLE_TRANSLATOR] }))\n\t\t\t\t.then(function () {\n\t\t\t\t\tme[$ELEMENT].find(SEL_TTS_BOX).mouseenter(function () {\n\t\t\t\t\t\tme.publish(\"tracking/useraction\", {\n\t\t\t\t\t\t\t\"action.translateOverlay\": \"1\"\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tonRendered.call(me);\n\t\t\t\t});\n\t\t}\n\t}\n\n\tfunction renderListenPanel(isForSpeech) {\n\t\tvar me = this;\n\t\tif (isForSpeech) {\n\t\t\tif (me._speechListenRendered) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\t\t\tme._speechListenRendered = true;\n\t\t} else {\n\t\t\tif (me._headListenRendered) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\t\t\tme._headListenRendered = true;\n\t\t}\n\n\t\tvar data = {\n\t\t\t\"isForSpeech\": isForSpeech,\n\t\t\t\"settings\": SETTINGS\n\t\t};\n\n\t\tvar $widget = me[$ELEMENT].find(isForSpeech ? SEL_TTS_SPEECH_LISTEN : SEL_TTS_HEAD_LISTEN);\n\t\treturn $widget\n\t\t\t.html(tListenPanel(data))\n\t\t\t.find(\"*\")\n\t\t\t.weave()\n\t\t\t.then(function doneCall() {\n\t\t\t\tinitAudioElement.call(me, $widget);\n\t\t\t\t$widget.removeClass(CLS_HIDDEN);\n\t\t\t}, function failCall() {\n\t\t\t\tif (isForSpeech) {\n\t\t\t\t\tme._speechListenRendered = false;\n\t\t\t\t} else {\n\t\t\t\t\tme._headListenRendered = false;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tfunction renderSettings() {\n\t\tvar me = this;\n\t\tif (me._settingsRendered) {\n\t\t\treturn when.resolve();\n\t\t}\n\n\t\tme._settingsRendered = true;\n\t\tvar $widget = me[$ELEMENT].find(SEL_TTS_SETTINGS);\n\t\tvar data = {\n\t\t\t\"settings\": SETTINGS\n\t\t};\n\t\treturn $widget\n\t\t\t.html(tSettings(data))\n\t\t\t.find(\"*\")\n\t\t\t.weave()\n\t\t\t.done(function doneCall() {\n\t\t\t\t$widget.removeClass(CLS_HIDDEN);\n\t\t\t}, function failCall() {\n\t\t\t\tme._settingsRendered = false;\n\t\t\t});\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tsetzIndex.call(me);\n\t\tsetTtsBoxStyle.call(me);\n\n\t\tinitDraggable.call(me);\n\n\t\trenderListenPanel.call(me, false);\n\t\tinitTabTip.call(me);\n\t}\n\n\tfunction setTtsBoxPosition($event) {\n\t\tvar pageX = $event.pageX,\n\t\t\tpageY = $event.pageY;\n\t\tvar me = this,\n\t\t\tsize = getBoxSize.call(me);\n\t\tvar $win = $(window),\n\t\t\twinWidth = $win.width(),\n\t\t\twinHeight = $win.height();\n\t\tvar maxX = winWidth - size.width,\n\t\t\tmaxY = winHeight - size.height,\n\t\t\tboxX = pageX + 10,\n\t\t\tboxY = pageY - 60;\n\t\tif (boxX > maxX) {\n\t\t\tboxX = maxX;\n\t\t}\n\t\tif (boxY < 0) {\n\t\t\tboxY = 0;\n\t\t} else if (boxY > maxY) {\n\t\t\tboxY = maxY;\n\t\t}\n\t\tvar $widget = me[$ELEMENT], smallBox;\n\t\t$widget\n\t\t\t.find(SEL_TTS_BOX)\n\t\t\t.css({ \"left\": boxX, \"top\": boxY });\n\n\t\tif (me._isTtsSmallBox) {\n\t\t\tsmallBox = $widget.find(SEL_TTS_SMALL_BOX);\n\t\t\tsmallBox.css(getSmallBoxOffset(smallBox, $event));\n\t\t}\n\t}\n\n\tfunction setTransBoxPosition($event) {\n\t\tvar me = this;\n\t\tvar smallBox;\n\t\tif (me._isTransSmallBox) {\n\t\t\tsmallBox = me[$ELEMENT].find(SEL_TRANS_SMALL_BOX);\n\t\t\tsmallBox.css(getSmallBoxOffset(smallBox, $event));\n\t\t}\n\t}\n\n\tfunction getSmallBoxOffset(smallBox, $event) {\n\t\tvar pageX = $event.pageX,\n\t\t\tpageY = $event.pageY;\n\t\tvar $win = $(window),\n\t\t\twinWidth = $win.width(),\n\t\t\twinHeight = $win.height();\n\n\t\tvar smallMaxX = winWidth - smallBox.width(),\n\t\t\tsmallMaxY = winHeight - smallBox.height();\n\t\tvar smallBoxX = pageX + 20,\n\t\t\tsmallBoxY = pageY - 10;\n\t\tif (smallBoxX > smallMaxX) {\n\t\t\tsmallBoxX = smallMaxX;\n\t\t}\n\t\tif (smallBoxY < 0) {\n\t\t\tsmallBoxY = 0;\n\t\t} else if (smallBoxY > smallMaxY) {\n\t\t\tsmallBoxY = smallMaxY;\n\t\t}\n\t\treturn { \"left\": smallBoxX, \"top\": smallBoxY };\n\t}\n\n\tfunction getBoxSize() {\n\t\tvar me = this;\n\t\tif (!me._ttsBoxSize) {\n\t\t\tvar $box = me[$ELEMENT].find(SEL_TTS_BOX);\n\t\t\tvar height = $box.find(SEL_TTS_HEAD).outerHeight()\n\t\t\t\t+ $box.find(SEL_TTS_BODY).outerHeight()\n\t\t\t\t+ $box.find(SEL_TTS_FOOT).outerHeight()\n\t\t\t\t+ 10;\n\t\t\tme._ttsBoxSize = {\n\t\t\t\t\"width\": $box.outerWidth() + 10,\n\t\t\t\t\"height\": height\n\t\t\t};\n\t\t}\n\t\treturn me._ttsBoxSize;\n\t}\n\n\t/*!\n\t * set tts z-index by setting\n\t */\n\tfunction setzIndex() {\n\t\tvar $widget = this[$ELEMENT],\n\t\t\tzIndex = $widget.data(\"zIndex\");\n\t\tif (zIndex !== UNDEF) {\n\t\t\t$widget.find(SEL_TTS_SMALL_BOX + \",\" + SEL_TTS_BOX).css(\"z-index\", zIndex);\n\t\t}\n\t}\n\n\tfunction initDraggable() {\n\t\tvar me = this,\n\t\t\tboxWidth = getBoxSize.call(me).width + 2,\n\t\t\tmaxLeft = 0;\n\n\t\tfunction onStart() {\n\t\t\tmaxLeft = $(window).width() - boxWidth;\n\t\t}\n\n\t\tfunction onDrag($event, ui) {\n\t\t\tvar position = ui.position;\n\t\t\tif (maxLeft > 0 && position.left > maxLeft) {\n\t\t\t\tposition.left = maxLeft;\n\t\t\t}\n\t\t}\n\n\t\tui$(me[$ELEMENT].find(SEL_TTS_BOX))\n\t\t\t.draggable({\n\t\t\t\thandle: SEL_TTS_HEAD,\n\t\t\t\taddClasses: false,\n\t\t\t\tcontainment: \"window\",\n\t\t\t\tscroll: false,\n\t\t\t\tscope: false,\n\t\t\t\tdisabled: true,\n\t\t\t\tstart: onStart,\n\t\t\t\tdrag: onDrag\n\t\t\t});\n\t}\n\n\tfunction setTtsBoxStyle(small) {\n\t\tvar me = this;\n\t\tme._isTtsSmallBox = small === UNDEF ? !SETTINGS.autoLaunch : !!small;\n\t\tme[$ELEMENT].removeClass(CLS_ALL_SMALL).toggleClass(CLS_TTS_SMALL, me._isTtsSmallBox);\n\t}\n\n\tfunction setTransBoxStyle(small) {\n\t\tvar me = this;\n\t\tme._isTransSmallBox = small === UNDEF ? !TRANS_SETTINGS.autoLaunch : !!small;\n\t\tme[$ELEMENT].removeClass(CLS_ALL_SMALL).toggleClass(CLS_TRANS_SMALL, me._isTransSmallBox);\n\t}\n\n\tfunction initAudioElement($widget) {\n\t\tvar $player = $widget.find(SEL_TTS_LISTEN_BUTTON);\n\t\tvar $audio = $widget.find(SEL_TTS_AUDIO);\n\t\t$audio.on('play playing', function () {\n\t\t\t$player.removeClass(CLS_LOADING).addClass(CLS_PLAYING);\n\t\t});\n\t\t$audio.on('pause ended', function () {\n\t\t\t$player.removeClass(CLS_PLAYING);\n\t\t});\n\t\t$audio.on('error', function () {\n\t\t\t$player.removeClass(CLS_PLAYING).removeClass(CLS_LOADING);\n\t\t});\n\t}\n\n\tfunction initTabTip() {\n\t\tvar me = this;\n\t\tvar blurbList = BLURB_LIST;\n\t\tloadBlurb.call(me)\n\t\t\t.ensure(function () {\n\t\t\t\tme[$ELEMENT]\n\t\t\t\t\t.find(SEL_TTS_TABS)\n\t\t\t\t\t.find(SEL_TTS_TAB_PIN)\n\t\t\t\t\t.attr(ATTR_TITLE, me._isPinned ? blurbList[BLURB_PIN_UP] : blurbList[BLURB_PIN_DOWN])\n\t\t\t\t\t.end()\n\t\t\t\t\t.find(SEL_TTS_TAB_TRANSLATOR)\n\t\t\t\t\t.attr(ATTR_TITLE, blurbList[BLURB_TRANSLATOR])\n\t\t\t\t\t.end()\n\t\t\t\t\t.find(SEL_TTS_TAB_SPEECH)\n\t\t\t\t\t.attr(ATTR_TITLE, blurbList[BLURB_SPEECH])\n\t\t\t\t\t.end()\n\t\t\t\t\t.find(SEL_TTS_TAB_SETTINGS)\n\t\t\t\t\t.attr(ATTR_TITLE, blurbList[BLURB_SETTINGS]);\n\t\t\t});\n\t}\n\n\tfunction loadBlurb() {\n\t\tvar me = this;\n\t\tif (!me[BLURB_PROMISE]) {\n\t\t\tvar blurbIds = Object.keys(BLURB_LIST);\n\t\t\tme[BLURB_PROMISE] = me.query(blurbIds)\n\t\t\t\t.then(function (blurbs) {\n\t\t\t\t\tblurbs.forEach(function (blurb) {\n\t\t\t\t\t\tvar translation = blurb && blurb.translation;\n\t\t\t\t\t\tif (translation) {\n\t\t\t\t\t\t\tBLURB_LIST[blurb.id] = translation;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t}\n\t\treturn me[BLURB_PROMISE];\n\t}\n\n\tfunction resetListenButton() {\n\t\tthis[$ELEMENT]\n\t\t\t.find(SEL_TTS_LISTEN_BUTTON)\n\t\t\t.removeClass(CLS_PLAYING + SPACE + CLS_LOADING);\n\t}\n\n\tfunction show() {\n\t\tvar me = this;\n\t\tme._isHidden = false;\n\t\tme[$ELEMENT].show();\n\t\tresetListenButton.call(me);\n\t\tresetTranslator.call(me);\n\t}\n\n\tfunction hide() {\n\t\tvar me = this;\n\t\tme._isHidden = true;\n\t\tme._isPinned = false;\n\t\tme[$ELEMENT].hide();\n\t\ttogglePin.call(me, false);\n\t\tif (!me[ENABLE_FLOATING_TOOLKIT]) {\n\t\t\tsetTransBoxStyle.call(me);\n\t\t}\n\t\telse {\n\t\t\tsetTtsBoxStyle.call(me);\n\t\t}\n\t}\n\n\tfunction togglePin(pinned) {\n\t\tvar me = this;\n\t\tme[$ELEMENT]\n\t\t\t.find(SEL_TTS_BOX)\n\t\t\t.toggleClass(CLS_PINNED, pinned)\n\t\t\t.draggable(pinned ? \"enable\" : \"disable\")\n\t\t\t.find(SEL_TTS_TAB_PIN)\n\t\t\t.attr(ATTR_TITLE, pinned ? BLURB_LIST[BLURB_PIN_UP] : BLURB_LIST[BLURB_PIN_DOWN]);\n\t}\n\n\tfunction initTranslator() {\n\t\tvar me = this,\n\t\t\ttext = me._text,\n\t\t\t$widget = me[$ELEMENT];\n\t\t$widget\n\t\t\t.find(SEL_TTS_SPEECH_INPUT)\n\t\t\t.val(text);\n\t\tif (!me._isTranslatorTab) {\n\t\t\tvar $tab = $widget.find(SEL_TTS_TAB_TRANSLATOR);\n\t\t\tinitTab.call(me, $tab, TAB_INDEX_TRANSLATOR);\n\t\t}\n\t}\n\n\tfunction switchTab($tab, tabIndex) {\n\t\tvar me = this;\n\t\tinitTab.call(me, $tab, tabIndex);\n\n\t\tvar handler = TAB_HANDLERS[tabIndex];\n\t\tif (typeof(handler) === TYPE_FUNCTION) {\n\t\t\thandler.apply(me, arguments);\n\t\t}\n\t}\n\n\tfunction initTab($tab, tabIndex) {\n\t\tvar me = this;\n\t\tme._isTranslatorTab = tabIndex === TAB_INDEX_TRANSLATOR;\n\t\tme[$ELEMENT]\n\t\t\t.find(SEL_TTS_HEAD_LISTEN)\n\t\t\t.toggle(me._isTranslatorTab)\n\t\t\t.end()\n\t\t\t.find(SEL_TTS_TAB_ACTIVE)\n\t\t\t.removeClass(CLS_ACTIVE)\n\t\t\t.end()\n\t\t\t.find(SEL_TTS_BODY)\n\t\t\t.removeClass(CLS_TAB_N)\n\t\t\t.addClass(TAB_PREFIX + tabIndex);\n\n\t\t$tab.addClass(CLS_ACTIVE);\n\t}\n\n\tfunction toggleSpeed($speed, expanded) {\n\t\t$speed.toggleClass(CLS_EXPANDED, expanded);\n\t}\n\n\tfunction selectSpeed(speed, text) {\n\t\tSETTINGS.speed = speed;\n\t\tthis[$ELEMENT].find(SEL_TTS_SPEED_SELECTED).text(text);\n\t}\n\n\tfunction listenSpeech($player, isForSpeech) {\n\t\tif ($player.hasClass(CLS_LOADING) ||\n\t\t\t$player.hasClass(CLS_PLAYING) ||\n\t\t\t$player.hasClass(CLS_DISABLED)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this, $widget = me[$ELEMENT], $speech;\n\t\tvar text = me._english;\n\t\tif (isForSpeech) {\n\t\t\t$speech = $widget.find(SEL_TTS_SPEECH);\n\t\t\ttext = $.trim($speech.find(SEL_TTS_SPEECH_INPUT).val());\n\t\t}\n\t\tif (text.length === 0 || text.length > SETTINGS.maxTextLength) {\n\t\t\tif ($speech) {\n\t\t\t\ttoggleSpeechTip.call(me, $speech, true);\n\t\t\t}\n\t\t\treturn;\n\t\t} else if (!TextHelper.canTTS(text)) {\n\t\t\tif (text === DOUBLE_QUOTE) {\n\t\t\t\ttext = TTS_TEXT_DOUBLE_QUOTATION;\n\t\t\t} else if (isForSpeech) {\n\t\t\t\tenablePlayerAudio($player, false);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\ttext = TTS_TEXT_SORRY;\n\t\t\t}\n\t\t}\n\n\t\tvar $audio = $player.siblings(SEL_TTS_AUDIO);\n\t\t$player.addClass(CLS_LOADING);\n\t\tvar ttsUrl = SETTINGS.ttsUrl;\n\t\tvar url = [\n\t\t\tttsUrl + (ttsUrl.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + \"m=\" + me._member_id,\n\t\t\t\"spk=\" + SETTINGS.speaker,\n\t\t\t\"spd=\" + SETTINGS.speed,\n\t\t\t\"t=\" + encodeURIComponent('\"' + text + '\"'),\n\t\t\t\"p=\" + encodeURIComponent(location.href),\n\t\t\t\"k=\"\n\t\t].join(\"&\");\n\t\t$audio.attr('src', url);\n\t\t$audio.get(0).play();\n\t}\n\n\tfunction toggleSpeechTip($speech, show) {\n\t\tvar $speechTip = $speech\n\t\t\t.find(SEL_TTS_SPEECH_TIP)\n\t\t\t.stop(true, true)\n\t\t\t.toggle(show);\n\t\tif (show) {\n\t\t\t$speechTip.delay(2000).fadeOut(3000);\n\t\t}\n\t}\n\n\tfunction enablePlayerAudio($player, enabled) {\n\t\t$player.toggleClass(CLS_DISABLED, !enabled);\n\t}\n\n\tfunction saveSettings() {\n\t\tvar me = this;\n\t\tvar $settings = me[$ELEMENT].find(SEL_TTS_SETTINGS);\n\t\tvar showMessage = function (success) {\n\t\t\t$settings\n\t\t\t\t.find(SEL_TTS_SETTINGS_MSG + DOT + (success ? CLS_DONE : CLS_FAIL))\n\t\t\t\t.stop(true, true)\n\t\t\t\t.show()\n\t\t\t\t.delay(2000)\n\t\t\t\t.fadeOut(success ? 1000 : 3000);\n\t\t};\n\n\t\tvar speaker = +$settings.find(SEL_TTS_SETTINGS_VOICE).find(\"input:checked\").val(),\n\t\t\tautoLaunch = $settings.find(SEL_TTS_SETTINGS_AUTO_LAUNCH)[0].checked,\n\t\t\tsettings = {\n\t\t\t\t\"speed\": SETTINGS.speed,\n\t\t\t\t\"speaker\": speaker,\n\t\t\t\t\"status\": (autoLaunch ? 1 : 0)\n\t\t\t};\n\n\t\tme.publish(TOPIC_SAVE_SETTINGS, settings)\n\t\t\t.spread(function doneUpdate(saved) {\n\t\t\t\tsaved = saved && (saved[0] || saved);\n\t\t\t\tif (saved && saved.result === 1) {\n\t\t\t\t\tSETTINGS.speaker = speaker;\n\t\t\t\t\tSETTINGS.autoLaunch = autoLaunch;\n\t\t\t\t\tshowMessage(true);\n\t\t\t\t} else {\n\t\t\t\t\tshowMessage(false);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(function failUpdate() {\n\t\t\t\tshowMessage(false);\n\t\t\t});\n\t}\n\n\tfunction translate() {\n\t\t// SPC-2505, replace translation text's 'noisy' characters with EMPTY before translating\n\t\tvar normalizeText = function (txt) {\n\t\t\treturn ('' + txt).replace(/['\"\\\\]/g, '') || ' ';\n\t\t};\n\n\t\tvar me = this;\n\t\tvar text = normalizeText(me._text);\n\t\tif (text.length > SETTINGS.maxTextLength) {\n\t\t\ttext = text.substr(0, SETTINGS.maxTextLength);\n\t\t}\n\t\tme._text = text;\n\n\t\tme[IS_FAILED] = false;\n\t\tme.publish(TOPIC_TTS_TRANSLATOR_TRANSLATE, text, me._cultureCode)\n\t\t\t.catch(function failCall() {\n\t\t\t\tme[IS_FAILED] = true;\n\t\t\t});\n\t}\n\n\tfunction resetTranslator() {\n\t\tthis.publish(TOPIC_TTS_TRANSLATOR_RESET);\n\t}\n\n\tfunction openTranslator(autoPop) {\n\t\tvar me = this,\n\t\t\tsearchText = me._text || \"\";\n\t\tif (searchText.length > MAX_SEARCH_TEXT_LENGTH) {\n\t\t\tsearchText = searchText.substr(0, MAX_SEARCH_TEXT_LENGTH);\n\t\t}\n\t\tvar url = \"/translator/?newcourseware=true&LE=\" + (\"e12-new\" + (autoPop ? \"-pop\" : \"\")) + \"&searchText=\" + encodeURIComponent(searchText),\n\t\t\tfeatures = 'height=740px,width=680px,top=0,left=0,toolbar=no,resizable=yes,location=no,status=no,scrollbars=yes';\n\t\tvar translatorWindow = window.open(url, 'Translator', features);\n\t\ttranslatorWindow.focus();\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function onStart() {\n\t\t\treturn init.call(this);\n\t\t},\n\n\t\t\"hub:memory/context\": function onContext(context) {\n\t\t\tif (context) {\n\t\t\t\tvar me = this;\n\t\t\t\tme._member_id = +TypeIdParser.parseId((context.user || {}).id);\n\t\t\t\tme._cultureCode = context.cultureCode;\n\t\t\t}\n\t\t},\n\n\t\t\"hub/tts/set/url\": function onSetSpeechUrl(url) {\n\t\t\tif (url) {\n\t\t\t\tSETTINGS.ttsUrl = url;\n\t\t\t}\n\t\t},\n\n\t\t\"hub/tts/set/english\": function onSetEnglish(english) {\n\t\t\tthis._english = english || \"\";\n\t\t},\n\n\t\t\"hub/tts/get/translation/error\": function onGetTranslationError() {\n\t\t\treturn BLURB_LIST[BLURB_TRANSLATION_ERROR];\n\t\t},\n\n\t\t\"hub/tts/open/translator\": function onOpenTranslator() {\n\t\t\topenTranslator.call(this);\n\t\t},\n\n\t\t\"hub/tts/close/toolkit\": function onCloseToolkit() {\n\t\t\thide.call(this);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-small-box/click\": function onShowBox() {\n\t\t\tsetTtsBoxStyle.call(this, false);\n\t\t},\n\n\t\t\"dom:.ets-ui-trans-small-box/click\": function onActionOpenTranslator() {\n\t\t\topenTranslator.call(this);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-close-btn/click\": function onCloseBox() {\n\t\t\thide.call(this);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-tab.ets-pin/click\": function onTogglePin() {\n\t\t\tvar me = this;\n\t\t\tme._isPinned = !me._isPinned;\n\t\t\ttogglePin.call(me, me._isPinned);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-tab-switch/click\": function onSwitchTab($event) {\n\t\t\tvar $tab = $($event.currentTarget);\n\t\t\tif ($tab.hasClass(CLS_ACTIVE)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitchTab.call(this, $tab, $tab.data('index'));\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-speech-input/click\": function onClickInput($event) {\n\t\t\tvar $speech = $($event.currentTarget).closest(SEL_TTS_SPEECH);\n\t\t\ttoggleSpeechTip.call(this, $speech, false);\n\n\t\t\tvar $player = $speech.find(SEL_TTS_LISTEN_BUTTON);\n\t\t\tenablePlayerAudio($player, true);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-speed/click\": function onToggleSpeed($event) {\n\t\t\tvar $speed = $($event.currentTarget);\n\t\t\ttoggleSpeed.call(this, $speed);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-select-speed/click\": function onSelectSpeed($event) {\n\t\t\tvar $option = $($event.currentTarget);\n\t\t\tvar me = this;\n\t\t\tselectSpeed.call(me, $option.data('value'), $option.text());\n\n\t\t\tvar $speed = $option.closest(SEL_TTS_SPEED);\n\t\t\ttoggleSpeed.call(me, $speed, false);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-listen-btn/click\": function onListenSpeech($event) {\n\t\t\tvar me = this;\n\t\t\tvar $player = $($event.currentTarget);\n\t\t\tlistenSpeech.call(me, $player, $player.data('value'));\n\t\t\t//send useraction tracking\n\t\t\tme.publish(\"tracking/useraction\", {\n\t\t\t\t\"action.translatePlay\": \"1\"\n\t\t\t});\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-save-btn/click\": function onSaveSettings() {\n\t\t\tsaveSettings.call(this);\n\t\t}\n\t});\n});\n\n",
    "/**\n * # language map helper module definition\n */\ndefine('school-ui-shared/tts/translator/lang-helper',[],function LangHelperModule() {\n\t\"use strict\";\n\n\t/*!\n\t * culture code need to be mapped\n\t */\n\tvar CULTURE_CODE_ES_CL = \"es-CL\",\n\t\tCULTURE_CODE_ID_ID = \"id-ID\",\n\t\tCULTURE_CODE_JA_JP = \"ja-JP\",\n\t\tCULTURE_CODE_KO_KR = \"ko-KR\",\n\t\tCULTURE_CODE_PT_BR = \"pt-BR\",\n\t\tCULTURE_CODE_ZH_CN = \"zh-CN\",\n\t\tCULTURE_CODE_ZH_HK = \"zh-HK\",\n\t\tCULTURE_CODE_ZH_TW = \"zh-TW\";\n\n\t/*!\n\t * bing language code need to be mapped\n\t *\n\t * Language codes representing languages that are supported by BING Translation Service\n\t * ar,bg,ca,zh-CHS,zh-CHT,cs,da,nl,en,et,fi,fr,de,el,ht,he,hi,mww,\n\t * hu,id,it,ja,ko,lv,lt,no,fa,pl,pt,ro,ru,sk,sl,es,sv,th,tr,uk,vi\n\t *\n\t * ref URL: http://api.microsofttranslator.com/V2/Ajax.svc/GetLanguagesForTranslate?appId=XXX\n\t */\n\tvar BING_LANG_CODE_DE = \"de\",\n\t\tBING_LANG_CODE_ES = \"es\",\n\t\tBING_LANG_CODE_ID = \"id\",\n\t\tBING_LANG_CODE_JA = \"ja\",\n\t\tBING_LANG_CODE_KO = \"ko\",\n\t\tBING_LANG_CODE_PT = \"pt\",\n\t\tBING_LANG_CODE_ZH_CHS = \"zh-CHS\",\n\t\tBING_LANG_CODE_ZH_CHT = \"zh-CHT\";\n\n\t/*!\n\t * EF non-stardand language code need to be mapped\n\t */\n\tvar EF_LANG_CODE_CH = \"ch\",\n\t\tEF_LANG_CODE_CS = \"cs\",\n\t\tEF_LANG_CODE_GE = \"ge\",\n\t\tEF_LANG_CODE_HK = \"hk\",\n\t\tEF_LANG_CODE_ID = \"id\",\n\t\tEF_LANG_CODE_JP = \"jp\",\n\t\tEF_LANG_CODE_KR = \"kr\",\n\t\tEF_LANG_CODE_SP = \"sp\",\n\t\tEF_LANG_CODE_PT = \"pt\";\n\n\t/*!\n\t * language code map from culture code/EF language code to bing language code\n\t */\n\tvar AS_BING_LANG = {}, AS_EF_LANG = {};\n\tAS_BING_LANG[CULTURE_CODE_ES_CL] = BING_LANG_CODE_ES;\n\tAS_BING_LANG[CULTURE_CODE_ID_ID] = BING_LANG_CODE_ID;\n\tAS_BING_LANG[CULTURE_CODE_JA_JP] = BING_LANG_CODE_JA;\n\tAS_BING_LANG[CULTURE_CODE_KO_KR] = BING_LANG_CODE_KO;\n\tAS_BING_LANG[CULTURE_CODE_PT_BR] = BING_LANG_CODE_PT;\n\tAS_BING_LANG[CULTURE_CODE_ZH_CN] = BING_LANG_CODE_ZH_CHS;\n\tAS_BING_LANG[CULTURE_CODE_ZH_HK] = BING_LANG_CODE_ZH_CHT;\n\tAS_BING_LANG[CULTURE_CODE_ZH_TW] = BING_LANG_CODE_ZH_CHT;\n\n\tAS_BING_LANG[EF_LANG_CODE_CH] = BING_LANG_CODE_ZH_CHT;\n\tAS_BING_LANG[EF_LANG_CODE_CS] = BING_LANG_CODE_ZH_CHS;\n\tAS_BING_LANG[EF_LANG_CODE_GE] = BING_LANG_CODE_DE;\n\tAS_BING_LANG[EF_LANG_CODE_HK] = BING_LANG_CODE_ZH_CHT;\n\tAS_BING_LANG[EF_LANG_CODE_ID] = BING_LANG_CODE_ID;\n\tAS_BING_LANG[EF_LANG_CODE_JP] = BING_LANG_CODE_JA;\n\tAS_BING_LANG[EF_LANG_CODE_KR] = BING_LANG_CODE_KO;\n\tAS_BING_LANG[EF_LANG_CODE_SP] = BING_LANG_CODE_ES;\n\tAS_BING_LANG[EF_LANG_CODE_PT] = BING_LANG_CODE_PT;\n\n\t/*!\n\t * language code map from culture code to EF language code\n\t */\n\tAS_EF_LANG[CULTURE_CODE_ES_CL] = EF_LANG_CODE_SP;\n\tAS_EF_LANG[CULTURE_CODE_ID_ID] = EF_LANG_CODE_ID;\n\tAS_EF_LANG[CULTURE_CODE_JA_JP] = EF_LANG_CODE_JP;\n\tAS_EF_LANG[CULTURE_CODE_KO_KR] = EF_LANG_CODE_KR;\n\tAS_EF_LANG[CULTURE_CODE_PT_BR] = EF_LANG_CODE_PT;\n\tAS_EF_LANG[CULTURE_CODE_ZH_CN] = EF_LANG_CODE_CS;\n\tAS_EF_LANG[CULTURE_CODE_ZH_HK] = EF_LANG_CODE_CH;\n\tAS_EF_LANG[CULTURE_CODE_ZH_TW] = EF_LANG_CODE_CH;\n\n\treturn {\n\t\t\"getBingLangByCultureCode\": function onGetBingLangByCultureCode(cultureCode) {\n\t\t\treturn AS_BING_LANG[cultureCode] || cultureCode;\n\t\t},\n\n\t\t\"getEFLangByCultureCode\": function onGetEFLangByCultureCode(cultureCode) {\n\t\t\treturn AS_EF_LANG[cultureCode] || cultureCode;\n\t\t},\n\n\t\t\"getBingLangByEFLang\": function onGetBingLangByEFLang(eflangCode) {\n\t\t\treturn AS_BING_LANG[eflangCode] || eflangCode;\n\t\t}\n\t};\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/translator/translator.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-ui-tts-translating\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"44578\\\" data-text-en=\\\"LOADING...Please wait\\\"></div>\\n<div class=\\\"ets-ui-tts-translation\\\"></div>\\n<div class=\\\"ets-ui-tts-translator-ft ets-none\\\">\\n    <div class=\\\"ets-ui-tts-notebook\\\"></div>\\n    <div class=\\\"ets-ui-tts-bing\\\"></div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/translator/translation.html',[],function() { return function template(data) { var o = \"\";\n    var model = data || {},\n        isEnglish = model.isEnglish,\n        SEP_CHAR = isEnglish ? \"\" : \"; \",\n        result = model.result || {};\no += \"\\n<h5 class=\\\"ets-ui-tts-translation-hd\\\">\\n    <p class=\\\"ets-ui-tts-word\\\">\" +result.wordText+ \"</p>\\n    \"; if(result.uk) { o += \"\\n    <span class=\\\"ets-ui-tts-ipa-region\\\">UK</span>\\n    <span class=\\\"ets-ui-tts-ipa\\\">/\" +result.uk+ \"/</span>\\n    \";}o += \"\\n    \"; if(result.us) { o += \"\\n    <span class=\\\"ets-ui-tts-ipa-region\\\">US</span>\\n    <span class=\\\"ets-ui-tts-ipa\\\">/\" +result.us+ \"/</span>\\n    \";}o += \"\\n</h5>\\n<ul class=\\\"ets-ui-tts-translation-bd\" +(isEnglish ? \" ets-english\" : \"\")+ \"\\\">\\n    \"; renderTranslation(result.pos || []); o += \"\\n</ul>\\n\\n\"; function renderTranslation(posList) {\n    var posCount = posList.length;\n    for(var i = 0; i < posCount; i++) {\n        renderPartOfSpeech(posList[i]);\n    }\n}o += \"\\n\\n\"; function renderPartOfSpeech(pos) { o += \"\\n<li class=\\\"ets-ui-tts-word-pos\\\">\\n    <p>\" +pos.partOfSpeech+ \"</p>\\n    <ul class=\\\"ets-ui-tts-word-sense\\\">\\n        \"; renderDefinition(pos.definitions || []); o += \"\\n    </ul>\\n</li>\\n\";}o += \"\\n\\n\";\n// For English layout : <li>definition1</li><li>definition2</li>\n// Non English layout : <li>definition1; definition2</li>\nfunction renderDefinition(definitions) {\n    var index = 0,\n        count = definitions.length,\n        outerLoopCount = isEnglish ? count : (count > 0 ? 1 : 0),\n        innerLoopCount = count - outerLoopCount + 1;\n    for(var i = 0; i < outerLoopCount; i++) {\no += \"\\n<li class=\\\"ets-ui-tts-word-def\\\">\\n    \"; for(var j = 0; j < innerLoopCount; j++) { o += \"\\n    \" +definitions[index++]+ \"\" +SEP_CHAR+ \"\\n    \";}o += \"\\n</li>\\n\";}} return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/translator/notebook.html',[],function() { return function template(data) { var o = \"\";\n    var NOTEBOOK_TIP = \"Add to My Notebook\";\n    var model = data || {},\n        wordGroupList = model.wordGroups || [],\n        wordGroupCount = wordGroupList.length,\n        wordGroup;\no += \"\\n\";if(model.enableTranslatorDetail) {o += \"<a class=\\\"ets-ui-tts-detail-btn\\\" href=\\\"javascript:void(0)\\\" data-action=\\\"open/translator\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"163088\\\" data-text-en=\\\"Details\\\"></a>\";}o += \"\\n<div class=\\\"ets-ui-tts-wordgroup\\\">\\n    <span class=\\\"ets-ui-tts-notebook-tip ets-ui-tts-toggle-wordgroup\\\" data-action=\\\"notebook/toggle/wordgroup\\\">\" +NOTEBOOK_TIP+ \"</span>\\n    <ul class=\\\"ets-ui-tts-wordgroup-list\\\">\\n        <li class=\\\"ets-ui-tts-wordgroup-tip ets-ui-tts-toggle-wordgroup\\\" data-action=\\\"notebook/toggle/wordgroup\\\">\" +NOTEBOOK_TIP+ \"</li>\\n        \"; for(var i = 0; i < wordGroupCount; i++) {\n            wordGroup = wordGroupList[i];\n        o += \"\\n        <li class=\\\"ets-ui-tts-add-word\\\" data-action=\\\"notebook/add/word(wordGroupId)\\\" data-word-group-id=\\\"\" +wordGroup.wordGroup_id+ \"\\\">\" +wordGroup.wordGroupName+ \"</li>\\n        \";}o += \"\\n    </ul>\\n</div>\\n<p class=\\\"ets-ui-tts-notebook-msg ets-done\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167354\\\" data-text-en=\\\"Add success!\\\"></p>\\n<p class=\\\"ets-ui-tts-notebook-msg ets-fail\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"167355\\\" data-text-en=\\\"Add failure, please try again!\\\"></p>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/tts/translator/bing.html',[],function() { return function template(data) { var o = \"\";\n    var model = data,\n        langList = model.languageList,\n        langCount = langList.length,\n        lang, langCode;\no += \"\\n<div class=\\\"ets-ui-tts-bing-logo\\\">Powered by Microsoft<sup> &copy; </sup>Translator</div>\\n<div class=\\\"ets-ui-tts-bing-lang\\\">\\n    <span class=\\\"ets-ui-tts-bing-tip\\\" data-action=\\\"bing/toggle/lang\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"163091\\\" data-text-en=\\\"Translate to\\\"></span>\\n    <ul class=\\\"ets-ui-tts-bing-lang-list\\\">\\n        \"; for(var i = 0; i < langCount; i++) {\n            lang = langList[i];\n            langCode = lang.cultureCode;\n        o += \"\\n        <li data-lang-code=\\\"\" +langCode+ \"\\\" class=\\\"ets-ui-tts-bing-translate \" +(langCode === 'en' ? 'ets-selected' : '')+ \"\\\" data-action=\\\"bing/translate(langCode)\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"\" +lang.text+ \"\\\"></li>\\n        \";}o += \"\\n    </ul>\\n</div>\"; return o; }; });\n",
    "/**\n * TTS translator module definition\n */\ndefine('school-ui-shared/tts/translator/main',[\n\t\"jquery\",\n\t\"when\",\n\t'logger',\n\t\"troopjs-ef/component/widget\",\n\t\"template!./translator.html\",\n\t\"template!./translation.html\",\n\t\"template!./notebook.html\",\n\t\"template!./bing.html\",\n\t\"./lang-helper\"\n], function TTSTranslatorModule(\n\t$,\n\twhen,\n\tLogger,\n\tWidget,\n\ttTranslator,\n\ttTranslation,\n\ttNotebook,\n\ttBing,\n\tLangHelper\n) {\n\t\"use strict\";\n\tvar $ELEMENT = \"$element\";\n\n\tvar DOT = \".\",\n\t\tNULL = null,\n\t\tLANG_EN = \"en\",\n\t\tDEFAULT_WORDGROUP_NAME = \"from translator\";\n\n\tvar CLS_SELECTED = \"ets-selected\",\n\t\tCLS_EXPANDED = \"ets-expanded\",\n\t\tCLS_LOADING = \"ets-loading\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_BING = \"ets-bing\",\n\t\tCLS_DONE = \"ets-done\",\n\t\tCLS_FAIL = \"ets-fail\";\n\n\tvar SEL_TRANSLATION = \".ets-ui-tts-translation\",\n\t\tSEL_TRANSLATOR_FOOT = \".ets-ui-tts-translator-ft\",\n\t\tSEL_NOTEBOOK = \".ets-ui-tts-notebook\",\n\t\tSEL_WORDGROUP = \".ets-ui-tts-wordgroup\",\n\t\tSEL_NOTEBOOK_MSG = \".ets-ui-tts-notebook-msg\",\n\t\tSEL_BING = \".ets-ui-tts-bing\",\n\t\tSEL_BING_LANG = \".ets-ui-tts-bing-lang\";\n\n\tvar TOPIC_ADD_USER_WORDGROUP = \"school/notebook/AddUserWordGroup\",\n\t\tTOPIC_ADD_WORDS_TO_USER_WORDGROUP = \"school/notebook/AddWordsToUserWordGroup\",\n\t\tTOPIC_SET_TTS_URL = \"tts/set/url\",\n\t\tTOPIC_SET_ENGLISH = \"tts/set/english\",\n\t\tTOPIC_GET_TRANSLATION_ERROR = \"tts/get/translation/error\",\n\t\tTOPIC_OPEN_TRANSLATOR = \"tts/open/translator\";\n\n\tvar QUERY_TOOLKIT_CONTEXT = \"toolkit_context!current\",\n\t\tQUERY_NOTEBOOK_WORDGROUP = \"notebook_wordgroup!current\",\n\t\tQUERY_PREFIX_TOOLKIT_TRANSLATION = \"toolkit_translation!\";\n\n\tvar MAX_LOG_TEXT_LEN = 30;\n\n\t/*!\n\t * widget data key\n\t */\n\tvar CULTURE_CODE = \"_cultureCode\",\n\t\tBING_LANG_TO = \"_bingLangTo\";\n\n\tfunction init() {\n\t\tvar me = this;\n\t\ttoggleFoot.call(me, false, false);\n\n\t\tif (me._inited) {\n\t\t\treturn when.resolve();\n\t\t}\n\n\t\treturn me.query(QUERY_TOOLKIT_CONTEXT)\n\t\t\t.spread(function doneQuery(result) {\n\t\t\t\tif (result) {\n\t\t\t\t\tme.publish(TOPIC_SET_TTS_URL, result.speechServerUrl);\n\t\t\t\t\tme._languageList = result.lngs || [];\n\t\t\t\t}\n\t\t\t\tme._inited = true;\n\t\t\t}, function failCall() {\n\t\t\t\tme._inited = false;\n\t\t\t});\n\t}\n\n\tfunction reset() {\n\t\tvar me = this;\n\t\tme[$ELEMENT]\n\t\t\t.find(SEL_NOTEBOOK_MSG)\n\t\t\t.stop(true, true)\n\t\t\t.hide();\n\n\t\ttoggleWordGroup.call(me, false);\n\t\ttoggleLanguage.call(me, false);\n\t}\n\n\tfunction toggleFoot(show, bing) {\n\t\tthis[$ELEMENT]\n\t\t\t.find(SEL_TRANSLATOR_FOOT)\n\t\t\t.toggleClass(CLS_NONE, !show)\n\t\t\t.toggleClass(CLS_BING, !!bing);\n\t}\n\n\tfunction renderNotebook(wordText) {\n\t\tvar me = this;\n\t\t//Save for add to notebook\n\t\tme._wordText = wordText;\n\t\treturn when.resolve()\n\t\t\t.then(function () {\n\t\t\t\tif (me._notebookRendered) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme._notebookRendered = true;\n\t\t\t\treturn loadWordGroup.call(me)\n\t\t\t\t\t.then(function doneCall(wordGroups) {\n\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\"wordGroups\": wordGroups || [],\n\t\t\t\t\t\t\t\"enableTranslatorDetail\": me[$ELEMENT].data(\"enableTranslatorDetail\")\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn me[$ELEMENT]\n\t\t\t\t\t\t\t.find(SEL_NOTEBOOK)\n\t\t\t\t\t\t\t.html(tNotebook(data))\n\t\t\t\t\t\t\t.find(\"*\")\n\t\t\t\t\t\t\t.weave();\n\t\t\t\t\t}, function failCall() {\n\t\t\t\t\t\tme._notebookRendered = false;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\ttoggleFoot.call(me, true, false);\n\t\t\t});\n\t}\n\n\tfunction loadWordGroup() {\n\t\tvar me = this;\n\t\treturn me.query(QUERY_NOTEBOOK_WORDGROUP)\n\t\t\t.spread(function doneQuery(wordGroup) {\n\t\t\t\tvar result = wordGroup && wordGroup.result;\n\t\t\t\tif (result && result.length > 0) {\n\t\t\t\t\treturn result;\n\t\t\t\t} else {\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\"groupName\": DEFAULT_WORDGROUP_NAME\n\t\t\t\t\t};\n\t\t\t\t\treturn me.publish(TOPIC_ADD_USER_WORDGROUP, data)\n\t\t\t\t\t\t.spread(function doneUpdate(added) {\n\t\t\t\t\t\t\tadded = added && (added[0] || added);\n\t\t\t\t\t\t\tif (added && added.isSuccess) {\n\t\t\t\t\t\t\t\tresult = [{\n\t\t\t\t\t\t\t\t\t\"wordGroup_id\": added.result,\n\t\t\t\t\t\t\t\t\t\"wordGroupName\": DEFAULT_WORDGROUP_NAME\n\t\t\t\t\t\t\t\t}];\n\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error('cannot load word group');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tfunction toggleWordGroup(show) {\n\t\tthis[$ELEMENT]\n\t\t\t.find(SEL_WORDGROUP)\n\t\t\t.toggleClass(CLS_EXPANDED, show);\n\t}\n\n\tfunction renderBing() {\n\t\tvar me = this;\n\n\t\treturn when.resolve()\n\t\t\t.then(function () {\n\t\t\t\tif (me._bingRendered) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme._bingRendered = true;\n\t\t\t\treturn when.resolve()\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\tif (me._languageList) {\n\t\t\t\t\t\t\treturn { \"lngs\": me._languageList };\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn me.query(QUERY_TOOLKIT_CONTEXT).spread(function (result) {\n\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.then(function doneQuery(result) {\n\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\"languageList\": (result || {}).lngs || []\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn me[$ELEMENT]\n\t\t\t\t\t\t\t.find(SEL_BING)\n\t\t\t\t\t\t\t.html(tBing(data))\n\t\t\t\t\t\t\t.find(\"*\")\n\t\t\t\t\t\t\t.weave();\n\t\t\t\t\t}, function failQuery() {\n\t\t\t\t\t\tme._bingRendered = false;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\ttoggleFoot.call(me, true, true);\n\t\t\t});\n\t}\n\n\tfunction toggleLanguage(show) {\n\t\tthis[$ELEMENT]\n\t\t\t.find(SEL_BING_LANG)\n\t\t\t.toggleClass(CLS_EXPANDED, show);\n\t}\n\n\tfunction addWordToWordGroup(wordGroupId, wordText) {\n\t\tvar me = this;\n\t\tvar $notebook = me[$ELEMENT].find(SEL_NOTEBOOK);\n\t\tvar showMessage = function (success) {\n\t\t\t$notebook\n\t\t\t\t.find(SEL_NOTEBOOK_MSG + DOT + (success ? CLS_DONE : CLS_FAIL))\n\t\t\t\t.stop(true, true)\n\t\t\t\t.show()\n\t\t\t\t.delay(1000)\n\t\t\t\t.fadeOut(2000);\n\t\t};\n\n\t\ttoggleWordGroup.call(me, false);\n\n\t\tvar data = {\n\t\t\t\"wordGroup_id\": wordGroupId,\n\t\t\t\"wordTexts\": [wordText || me._text]\n\t\t};\n\t\tme.publish(TOPIC_ADD_WORDS_TO_USER_WORDGROUP, data)\n\t\t\t.spread(function doneUpdate(added) {\n\t\t\t\tadded = added && (added[0] || added);\n\t\t\t\tif (added && added.isSuccess) {\n\t\t\t\t\tshowMessage.call(me, true);\n\t\t\t\t} else {\n\t\t\t\t\tshowMessage.call(me, false);\n\t\t\t\t}\n\t\t\t}, function failUpdate() {\n\t\t\t\tshowMessage.call(me, false);\n\t\t\t});\n\t}\n\n\tfunction toggleTranslating(translating) {\n\t\tthis[$ELEMENT].toggleClass(CLS_LOADING, translating);\n\t}\n\n\t/*!\n\t * translate text\n\t *\n\t * @param {String} text\n\t * @param {String} from, from bing lang code\n\t * @param {String} to, to bing lang code\n\t * @param {Object} deferred\n\t * @return {void}\n\t */\n\tfunction translate(text, to) {\n\t\tvar me = this;\n\n\t\treturn translateByBing.call(me, text, to)\n\t\t\t.catch(function failCall() {\n\t\t\t\treturn translateByEF.call(me, text);\n\t\t\t});\n\t}\n\n\tfunction translateByBing(text, to) {\n\t\tvar me = this;\n\t\tvar isEnglish = me[CULTURE_CODE] === LANG_EN;\n\t\t//if is en & without space & without num , we use ef tts\n\t\tif(isEnglish && !/\\s/.test(text) && !/\\d/.test(text)){\n\t\t\treturn when.reject(new Error('translate with ef tts'));\n\t\t}\n\t\tto = me[BING_LANG_TO] || to;\n\t\tlogBingTTS(text, me[CULTURE_CODE], to);\n\t\treturn me.query(QUERY_TOOLKIT_CONTEXT)\n\t\t\t.spread(function doneQueryToken(contextResult) {\n\t\t\t\tvar url = [\n\t\t\t\t\tcontextResult.translateTextAPIUrl + \"?appid=Bearer \" + encodeURIComponent(contextResult.AzureApiToken),\n\t\t\t\t\t\"text=\" + encodeURIComponent(text),\n\t\t\t\t\t\"to=\" + to\n\t\t\t\t].join(\"&\");\n\n\t\t\t\tvar options = {\n\t\t\t\t\t\"type\": \"GET\",\n\t\t\t\t\t\"url\": url,\n\t\t\t\t\t\"cache\": true\n\t\t\t\t};\n\n\t\t\t\treturn $.ajax(options);\n\t\t\t})\n\t\t\t.then(function doneQueryTranslate(result) {\n\t\t\t\tif (!result) {\n\t\t\t\t\tthrow new Error('cannot translate with bing');\n\t\t\t\t} else {\n\t\t\t\t\tvar translatedText = $(result).find('string').text();\n\t\t\t\t\tvar english = to === LANG_EN ? translatedText : (isEnglish ? text : \"\");\n\t\t\t\t\tif (english) {\n\t\t\t\t\t\tsetEnglish.call(me, english);\n\t\t\t\t\t}\n\t\t\t\t\trenderTranslation.call(me, encodeHtml(translatedText));\n\t\t\t\t\trenderBing.call(me);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tfunction logBingTTS(text, sourceLang, targetLang) {\n\t\tvar partialText = text.substr(0, MAX_LOG_TEXT_LEN);\n\t\tLogger.log('BingTTS chars=' + text.length + ' sourceLang=' + sourceLang + ' targetLang=' + targetLang + ' text=' + partialText);\n\t}\n\n\tfunction translateByEF(text) {\n\t\tvar me = this, regEn = /^([a-zA-Z`,.])+$/gim;\n\t\t//just pass pure letter\n\t\tif (regEn.test($.trim(text))) {\n\t\t\treturn me.query(QUERY_PREFIX_TOOLKIT_TRANSLATION + '\"' + text + '\"')\n\t\t\t\t.catch(function (e) {\n\t\t\t\t\trenderTranslation.call(me, NULL);\n\t\t\t\t\tthrow new Error('translate by ef error: ' + e);\n\t\t\t\t})\n\t\t\t\t.spread(function doneQuery(translation) {\n\t\t\t\t\tif (translation && translation.isFound) {\n\t\t\t\t\t\tvar result = (translation.result || [])[0] || {};\n\t\t\t\t\t\tvar wordText = result.wordText;\n\t\t\t\t\t\tresult.wordText = encodeHtml(wordText);\n\n\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\"isEnglish\": (me[CULTURE_CODE] || LANG_EN) === LANG_EN,\n\t\t\t\t\t\t\t\"result\": result\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsetEnglish.call(me, wordText || text);\n\t\t\t\t\t\trenderTranslation.call(me, tTranslation(data));\n\t\t\t\t\t\trenderNotebook.call(me, wordText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trenderTranslation.call(me, NULL);\n\t\t\t\t\t\treturn when.reject(new Error('cannot translate by ef'));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t\telse {\n\t\t\trenderTranslation.call(me, NULL);\n\t\t\treturn when.reject(new Error('cannot translate by ef'));\n\t\t}\n\t}\n\n\tfunction renderTranslation(translation) {\n\t\tvar me = this;\n\t\tif (translation === NULL) {\n\t\t\tme.publish(TOPIC_GET_TRANSLATION_ERROR)\n\t\t\t\t.then(function doneCall(errorMessage) {\n\t\t\t\t\ttranslation = errorMessage;\n\t\t\t\t});\n\t\t}\n\t\tme[$ELEMENT]\n\t\t\t.find(SEL_TRANSLATION)\n\t\t\t.html(translation);\n\t}\n\n\tfunction setEnglish(english) {\n\t\tthis.publish(TOPIC_SET_ENGLISH, english);\n\t}\n\n\tfunction encodeHtml(text) {\n\t\treturn (\"\" + text).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function onInit() {\n\t\t\treturn this.html(tTranslator);\n\t\t},\n\n\t\t\"hub/tts/translator/reset\": function onReset() {\n\t\t\treset.call(this);\n\t\t},\n\n\t\t\"hub/tts/translator/translate\": function onTranslate(text, cultureCode) {\n\t\t\tvar me = this;\n\t\t\tvar to = me[BING_LANG_TO] || LANG_EN;\n\n\t\t\tme._text = text;\n\t\t\tme[CULTURE_CODE] = cultureCode;\n\n\t\t\ttoggleTranslating.call(me, true);\n\t\t\treturn init.call(me)\n\t\t\t\t.then(function doneCall() {\n\t\t\t\t\treturn translate.call(me, me._text, to);\n\t\t\t\t})\n\t\t\t\t.ensure(function alwaysCall() {\n\t\t\t\t\ttoggleTranslating.call(me, false);\n\t\t\t\t});\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-toggle-wordgroup/click\": function onToggleWordGroup() {\n\t\t\ttoggleWordGroup.call(this);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-add-word/click\": function onAddWord($event) {\n\t\t\tvar me = this;\n\t\t\tvar $elem = $($event.currentTarget);\n\t\t\taddWordToWordGroup.call(me, $elem.data('wordGroupId'), me._wordText);\n\t\t\t//send useraction tracking\n\t\t\tme.publish(\"tracking/useraction\", {\n\t\t\t\t\"action.translateAddtoNotebook\": \"1\"\n\t\t\t});\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-detail-btn/click\": function onOpenTranslator() {\n\t\t\tthis.publish(TOPIC_OPEN_TRANSLATOR);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-bing-tip/click\": function onBingToggleLang() {\n\t\t\ttoggleLanguage.call(this);\n\t\t},\n\n\t\t\"dom:.ets-ui-tts-bing-translate/click\": function onBingTranslate($event) {\n\t\t\tvar me = this;\n\t\t\tvar $lang = $($event.currentTarget);\n\t\t\tvar to = me[BING_LANG_TO] = LangHelper.getBingLangByEFLang($lang.data('langCode'));\n\n\t\t\tif (!$lang.hasClass(CLS_SELECTED)) {\n\t\t\t\t$lang.parent().find(DOT + CLS_SELECTED).removeClass(CLS_SELECTED);\n\t\t\t\t$lang.addClass(CLS_SELECTED);\n\t\t\t}\n\n\t\t\ttoggleLanguage.call(me, false);\n\t\t\ttoggleTranslating.call(me, true);\n\t\t\ttranslate.call(me, me._text, to)\n\t\t\t\t.ensure(function alwaysCall() {\n\t\t\t\t\ttoggleTranslating.call(me, false);\n\t\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/utils/audio-output',[\n\t'when'\n], function (when) {\n\tvar HAS_ENUMERATE_DEVICES = Boolean(navigator.mediaDevices) &&\n\t\ttypeof navigator.mediaDevices.enumerateDevices === 'function';\n\n\tvar MP3_DATA_URI = 'data:audio/mpeg;base64,/+OIxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+OIxAAAAANIAAAAAExBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\n\tvar body = document.body;\n\n\tfunction canPlayAudio() {\n\t\treturn when\n\t\t\t.promise(function (resolve, reject) {\n\t\t\t\tvar audio = document.createElement('audio');\n\t\t\t\tif (!audio.canPlayType('audio/mpeg')) {\n\t\t\t\t\treject(new Error('cannot play mp3'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\taudio.addEventListener('error', function (event) {\n\t\t\t\t\tif (event.srcElement && event.srcElement.error &&\n\t\t\t\t\t\tevent.srcElement.error.code === MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED) {\n\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Unexpected audio error ' + event));\n\t\t\t\t\t}\n\t\t\t\t\tbody.removeChild(audio);\n\t\t\t\t});\n\t\t\t\taudio.addEventListener('play', function () {\n\t\t\t\t\tresolve(true);\n\t\t\t\t\tbody.removeChild(audio);\n\t\t\t\t});\n\t\t\t\taudio.autoplay = true;\n\t\t\t\taudio.src = MP3_DATA_URI;\n\t\t\t\tbody.appendChild(audio);\n\t\t\t});\n\t}\n\n\tfunction hasAudioOutput() {\n\t\tif (HAS_ENUMERATE_DEVICES) {\n\t\t\treturn when.resolve()\n\t\t\t\t.then(function () { // encapsulate in then() to catch exceptions\n\t\t\t\t\treturn navigator.mediaDevices.enumerateDevices();\n\t\t\t\t})\n\t\t\t\t.then(function (devices) {\n\t\t\t\t\treturn devices.reduce(function (hasOutputDevices, device) {\n\t\t\t\t\t\treturn hasOutputDevices || device.kind === 'audiooutput';\n\t\t\t\t\t}, false);\n\t\t\t\t});\n\t\t} else {\n\t\t\treturn when.resolve();\n\t\t}\n\t}\n\n\treturn {\n\t\thasAudioOutput: hasAudioOutput,\n\t\tcanPlayAudio: canPlayAudio\n\t};\n});\n\n",
    "define('school-ui-shared/utils/browser-check',[],function(){\n    // mapping from https://msdn.microsoft.com/en-us/library/ms537503(v=vs.85).aspx#TriToken\n    var TRIDENT_TO_MSIE = {\n        '4': '8.0',\n        '5': '9.0',\n        '6': '10.0',\n        '7': '11.0',\n        '8': '11.0' // see http://answers.microsoft.com/en-us/ie/forum/ie11-iewindows_10/trident-version-being-reported-as-trident80-in/00091417-43c7-4f60-9198-f6634cd1c352\n    };\n\n    function parseUserAgent(userAgent) {\n        var ua = userAgent.toLowerCase();\n\n        var match = /(edge)\\/([\\w.]+)/.exec(ua) ||    //make sure test edge before Chrome, because \"chrome\" keyword is in Edge's UA\n            /(chrome)[ \\/]([\\w.]+)/.exec(ua) ||\n            /(firefox)[ \\/]([\\w.]+)/.exec(ua) ||\n            /version\\/([\\d|.]+)(?: mobile\\/[\\w.]+)? (safari)/.exec(ua) ||\n            /(webkit)[ \\/]([\\w.]+)/.exec(ua) ||\n            /(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(ua) ||\n            // use to check compatible mode in ie\n            /(?:(msie) ([\\d.]+).*)?(trident)\\/(\\d+)/.exec(ua) ||\n            /(msie) ([\\w.]+)/.exec(ua) ||\n            [];\n\n        var compatibilityMode = false;\n        var actualVersionOfCompatibility = null;\n\n        if (match[2] === \"safari\") {\n            match[2] = match[1];\n            match[1] = \"safari\";\n        } else if (match[3] === \"trident\") {\n            var actualMsieVersion = TRIDENT_TO_MSIE[match[4]];\n            if (!match[1]) {\n                match[1] = \"msie\";\n                match[2] = actualMsieVersion;\n            }\n            compatibilityMode = ua.indexOf('compatible') >= 0\n                && match[2] !== actualMsieVersion; // IE9 reports itself has \"compatible\" in default mode\n            if (compatibilityMode) {\n                actualVersionOfCompatibility = parseFloat(actualMsieVersion);\n            }\n        }\n\n        // TODO: if we need to check anyother OS, add here\n        var platform = /(ipad)[\\S\\s]*os (\\d+)_(\\d+)/.exec(ua) ||\n            /(iphone)[\\S\\s]*os (\\d+)_(\\d+)/.exec(ua) ||\n            //this is recommend by google, but unfortunately, few browser to follow it.\n            /(android)[\\S\\s]*(mobile)/.exec(ua) ||\n            /(android)[\\S\\s]*(?!mobile)/.exec(ua) ||\n            //kindle fire, so special\n            /(kfjwi) /.exec(ua) ||\n            /(kftt) /.exec(ua) ||\n            /(kfot) /.exec(ua) ||\n            [];\n\n        var os = platform[1];\n\n        var device = \"pc\";\n\n        if (os === \"android\" || os === \"kfjwi\" || os === \"kftt\" || os === \"kfot\") {\n            var screen = window.screen,\n                screenW = screen.width,\n                screenH = screen.height,\n                minSize = Math.min(screenW, screenH);\n                device = minSize >= 512 ? \"tablet\" : \"mobile\";\n                os = \"android\";\n        }\n        else if (os === \"ipad\") {\n            device = \"tablet\";\n            os = \"ios\";\n        }\n        else if (os === \"iphone\") {\n            device = \"mobile\";\n            os = \"ios\";\n        }\n\n\t    if (device === \"pc\" && !os) {\n\t\t    if (/mac os x/i.test(ua)) {\n\t\t\t    os = \"osx\";\n\t\t    } else if (/windows/i.test(ua)) {\n\t\t\t    os = \"windows\";\n\t\t    }\n\t    }\n\n        return {\n            browser: match[1] || \"\",\n            version: match[2] || \"0.0\",\n            os: os,\n            device: device,\n            compatibilityMode: compatibilityMode,\n            actualVersionOfCompatibility: actualVersionOfCompatibility\n        };\n    }\n\n    var result = parseUserAgent(navigator.userAgent);\n    result.parseUserAgent = parseUserAgent; // for tests\n    return result;\n});\n\n",
    "define('school-ui-shared/utils/ccl',[\n\t\"jquery\",\n\t\"troopjs-ef/component/gadget\",\n\t\"school-ui-shared/utils/query-builder\"\n], function CCLUtilModule($, Gadget, queryBuilder) {\n\t\"use strict\";\n\n\tvar ARRAY_SLICE = Array.prototype.slice;\n\n\treturn Gadget.create({\n\t\tenableLockUnit: function enableLockUnit(queryResult) {\n\t\t\treturn (queryResult || {}).value === \"false\";\n\t\t},\n\n\t\tgetCCLByKey : function onGetCCLByKey(key){\n\t\t\tvar me = this;\n\t\t\tvar args = ARRAY_SLICE.call(arguments);\n\n\t\t\t$.each(args,function(key,val){\n\t\t\t\targs[key] = queryBuilder.buildCCLQuery(val);\n\t\t\t});\n\n\t\t\treturn me.query(args);\n\t\t},\n\t\tindicateCCLStringValue: function(queryResult) {\n\t\t\treturn (queryResult || {}).value.toLowerCase() === \"true\";\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/utils/feature-access',[\"school-ui-shared/enum/feature-access-id\"], function(FeatureAccessId){\n\t//var featureBits = \"\\u0000\\u0002\\u0070\\u0040\\u0019\";//get from service\n\tvar cache = {},\n\t\tFEATURE_UNICODE = \"unicode\";\n\n\tfunction validate(featureAccessId){\n\t\t// featureAccessId is always >= 1\n\t\tvar quotient = Math.floor(featureAccessId / 16),\n\t\t\tremainder = featureAccessId % 16 || 16;\n\n\t\treturn (cache[FEATURE_UNICODE].charCodeAt(quotient) & (1 << (remainder-1))) ? true : false;\n\t}\n\n\treturn {\n\t\tvalidateFeatureByte: function validateFeatureByte(featureAccessId){\n\t\t\treturn validate(featureAccessId);\n\t\t},\n\t\thasWritingClassFeature:function hasWritingClassFeature(){\n\t\t\tvar WRT_LIMT = \"Writing class limited\",\n\t\t\t\tWRT_UNLIMT = \"Writing class unlimited\";\n\n\t\t\treturn validate(FeatureAccessId[WRT_LIMT]) || validate(FeatureAccessId[WRT_UNLIMT]);\n\t\t},\n\t\thasGLClassFeature: function () {\n\t\t\tvar GL = \"Group discussion\",\n\t\t\t\tGL_UNLIMIT = \"Group discussion (unlimited)\",\n\t\t\t\tGL_UPSELL = \"Group discussion upsell\";\n\n\t\t\treturn validate(FeatureAccessId[GL]) ||\n\t\t\t\tvalidate(FeatureAccessId[GL_UNLIMIT]) ||\n\t\t\t\tvalidate(FeatureAccessId[GL_UPSELL]);\n\t\t},\n\t\thasPLClassFeature: function () {\n\t\t\tvar PL = \"Private lesson\",\n\t\t\t\tPL_MOVEON = \"Private Lesson 40 - Unit Move On\";\n\n\t\t\treturn validate(FeatureAccessId[PL]) ||\n\t\t\t\tvalidate(FeatureAccessId[PL_MOVEON]);\n\t\t},\n\t\thasCP20ClassFeature: function () {\n\t\t\tvar PL20 = \"Private Lesson 20\",\n\t\t\t\tPL20_MOVEON = \"Private Lesson 20 - Unit Move On\",\n\t\t\t\tCP20 = \"Check Point 20\",\n\t\t\t\tCP20_UNLIMIT = \"Check Point 20 (unlimited)\";\n\n\t\t\treturn validate(FeatureAccessId[PL20]) ||\n\t\t\t\tvalidate(FeatureAccessId[PL20_MOVEON]) ||\n\t\t\t\tvalidate(FeatureAccessId[CP20]) ||\n\t\t\t\tvalidate(FeatureAccessId[CP20_UNLIMIT]);\n\t\t},\n\t\thasEFTClassFeature: function () {\n\t\t\tvar EFT = \"EFT\";\n\t\t\treturn validate(FeatureAccessId[EFT]);\n\t\t},\n\t\tsetFeaturesUnicode: function setFeaturesUnicode(featureAccessId){\n\t\t\tcache[FEATURE_UNICODE] = featureAccessId;\n\t\t},\n\t\tgetFeaturesUnicode: function getFeaturesUnicode(){\n\t\t\treturn cache[FEATURE_UNICODE];\n\t\t}\n\t}\n});\n",
    "// adjust viewport meta tag for mobile devices\n// that screen width is less than minimal requirement\ndefine('school-ui-shared/utils/fix-viewport',[\n\t'./browser-check'\n], function (browserCheck) {\n\tvar VIEWPORT = 'viewport';\n\n\tvar HTML_MIN_WIDTH = parseInt(getComputedStyle(document.documentElement).minWidth, 10) || 0;\n\tvar BODY_MIN_WIDTH = parseInt(getComputedStyle(document.body).minWidth, 10) || 0;\n\tvar MIN_REQUIRED_WIDTH = 1010;  //10px for ePaper handler\n\tvar MIN_WIDTH = Math.max(HTML_MIN_WIDTH, BODY_MIN_WIDTH, MIN_REQUIRED_WIDTH);\n\n\tvar _metaViewport;\n\tvar _initialSettings = '';\n\n\tfunction _getMetaViweport() {\n\t\tif (!_metaViewport) {\n\t\t\t_metaViewport = document.querySelector('meta[name=' + VIEWPORT + ']');\n\n\t\t\tif (!_metaViewport) {\n\t\t\t\t_metaViewport = document.createElement('meta');\n\t\t\t\t_metaViewport.name = VIEWPORT;\n\t\t\t\t(document.head || document.getElementsByTagName('head')[0]).appendChild(_metaViewport);\n\t\t\t}\n\t\t}\n\n\t\treturn _metaViewport;\n\t}\n\n\tfunction _doFixViewPort() {\n\t\tvar newSettings = screen.width >= MIN_WIDTH ?\n\t\t\t_initialSettings :\n\t\t\t'width=' + MIN_WIDTH + ',user-scalable=no';\n\n\t\tvar metaViewport = _getMetaViweport();\n\t\tmetaViewport.content = newSettings;\n\t}\n\n\tfunction fixViewPort() {\n\t\tvar device = browserCheck.device;\n\t\tif (device !== 'tablet' && device !== 'mobile') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!screen.width || !screen.height) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (screen.width >= MIN_WIDTH && screen.height >= MIN_WIDTH) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar metaViewport = _getMetaViweport();\n\t\t_initialSettings = metaViewport.content;\n\n\t\t_doFixViewPort();\n\n\t\tif (\n\t\t\t(screen.width >= MIN_WIDTH && screen.height < MIN_WIDTH) ||\n\t\t\t(screen.height >= MIN_WIDTH && screen.width < MIN_WIDTH)\n\t\t) {\n\t\t\twindow.addEventListener(\"orientationchange\", _doFixViewPort);\n\t\t}\n\t}\n\n\treturn fixViewPort;\n});\n",
    "define('school-ui-shared/utils/https-compatibility',[\n\t'troopjs-core/pubsub/hub',\n\t'logger'\n], function HttpsCompatibility(Hub, Logger) {\n\t\"use strict\";\n\n\tvar loc = window.location;\n\n\tif (loc.protocol !== 'https:') {\n\t\treturn;\n\t}\n\n\tvar whitelist = null;\n\tvar prefix = 'http://' + loc.hostname;\n\n\tfunction onContext() {\n\t\tHub.publish('query', 'https_compatible_urls!current')\n\t\t\t.spread(function (whitelistResponse) {\n\t\t\t\twhitelist = whitelistResponse && whitelistResponse.result || null;\n\t\t\t});\n\t}\n\n\tHub.subscribe('context', Hub, onContext);\n\tHub.reemit('context', false, Hub, onContext);\n\n\tfunction isWhitelisted(url) {\n\t\tif (!whitelist) {\n\t\t\tLogger.log('HTTPS whitelist not yet loaded');\n\t\t\treturn true;\n\t\t}\n\t\tif (url.length === 0 || url.charAt(0) !== '/') {\n\t\t\treturn true;\n\t\t}\n\t\tfor (var i = 0; i < whitelist.length; ++i) {\n\t\t\tif (url.indexOf(whitelist[i]) === 0) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction handleEvent(event) {\n\t\tvar node = event.target;\n\t\twhile (node && node.tagName !== 'A') {\n\t\t\tnode = node.parentNode;\n\t\t}\n\t\tif (node) {\n\t\t\tvar href = node.getAttribute('href') || '';\n\t\t\tif (!isWhitelisted(href)) {\n\t\t\t\tnode.setAttribute('href', prefix + href);\n\t\t\t}\n\t\t}\n\t}\n\n\tdocument.body.addEventListener('focus', handleEvent, true);\n\tdocument.body.addEventListener('click', handleEvent, false);\n\n\n\tfunction patchOpenFunction(thisWindow, open) {\n\t\treturn function (url) {\n\t\t\tif (!isWhitelisted(url)) {\n\t\t\t\t// force http\n\t\t\t\tvar fixedArgs = Array.prototype.slice.call(arguments, 1);\n\t\t\t\tfixedArgs.unshift(prefix + url);\n\t\t\t\treturn open.apply(thisWindow, fixedArgs);\n\t\t\t}\n\t\t\t// default behaviour\n\t\t\treturn open.apply(thisWindow, arguments);\n\t\t};\n\t}\n\n\twindow.open = patchOpenFunction(window, window.open);\n\n\n\t// Special case for window.parent.open used in legacy code to\n\t// open /translator/ page, we want to force http only in this case\n\tfunction patchParentOpenTranslatorFunction(thisWindow, open) {\n\t\treturn function (url, windowName) {\n\t\t\tif (url.indexOf('/translator/') === 0 && windowName === 'Translator') {\n\t\t\t\t// force http\n\t\t\t\tvar fixedArgs = Array.prototype.slice.call(arguments, 1);\n\t\t\t\tfixedArgs.unshift(prefix + url);\n\t\t\t\treturn open.apply(thisWindow, fixedArgs);\n\t\t\t}\n\t\t\t// default behaviour\n\t\t\treturn open.apply(thisWindow, arguments);\n\t\t};\n\t}\n\n\tif (window.parent !== window) {\n\t\ttry {\n\t\t\twindow.parent.open = patchParentOpenTranslatorFunction(window.parent, window.parent.open);\n\t\t} catch (ignored) {\n\t\t\t// probably cross-origin parent\n\t\t}\n\t}\n});\n\n",
    "define('school-ui-shared/utils/hub-memory',[\n\t\"troopjs-core/pubsub/hub\"\n], function (Hub) {\n\n\treturn {\n\t\treadMemory: function (topic) {\n\t\t\tvar result;\n\t\t\tvar callback = function (value) {\n\t\t\t\tresult = value;\n\t\t\t};\n\t\t\t// Use \"callback\" as context to ensure it doesn't conflict with another subscription\n\t\t\tHub.subscribe(topic, callback, callback);\n\t\t\tHub.reemit(topic, false, callback, callback);\n\t\t\tHub.unsubscribe(topic, callback, callback);\n\t\t\treturn result;\n\t\t}\n\t}\n\n});\n\n",
    "define('hyphenate-Hyphenator', [\"shadow!hyphenator#exports=Hyphenator\"], function (Hyphenator) {\n\treturn Hyphenator;\n});\n\ndefine('school-ui-shared/utils/hyphenate',[\n\t\"require\",\n\t\"poly\",\n\t\"when\",\n\t\"troopjs-ef/component/gadget\",\n\t\"../enum/hyphenator-languages\"\n\t//Don't depend on Hyphenator here, require the lib only if actually needed\n], function (require, poly, when, Gadget, HyphenatorLanguages) {\n\n\tvar loadedLanguages = {};\n\n\tfunction loadLanguage(hyphenatorLanguage) {\n\t\tif (hyphenatorLanguage in loadedLanguages) {\n\t\t\treturn loadedLanguages[hyphenatorLanguage];\n\t\t}\n\t\tvar promise = when.promise(function (resolve) {\n\t\t\trequire([\n\t\t\t\t\"shadow!hyphenator/patterns/\" + hyphenatorLanguage + \"#Hyphenator=hyphenate-Hyphenator&exports=Hyphenator\"\n\t\t\t], resolve);\n\t\t});\n\t\tloadedLanguages[hyphenatorLanguage] = promise;\n\t\treturn promise;\n\t}\n\n\tvar currentLanguageDefer = when.defer();\n\n\tvar gadget = Gadget.create({\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tcurrentLanguageDefer.resolver.resolve(context.cultureCode);\n\t\t},\n\t\t\"hyphenate\": function (text) {\n\t\t\tvar languagePromise = currentLanguageDefer.promise;\n\t\t\treturn languagePromise.then(function (language) {\n\t\t\t\tvar hyphenatorLanguage = HyphenatorLanguages[language.toLowerCase()];\n\t\t\t\tif (hyphenatorLanguage) {\n\t\t\t\t\treturn loadLanguage(hyphenatorLanguage).then(function (Hyphenator) {\n\t\t\t\t\t\ttext = Hyphenator.hyphenate(text, hyphenatorLanguage) || text;\n\t\t\t\t\t\treturn [text];\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn [text];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tgadget.start();\n\n\treturn gadget;\n});\n",
    "define('school-ui-shared/utils/language-fixing',[\"poly/array\"],\n\tfunction () {\n\t\tvar CLS_ARABIC_FIX = \"ets-ui-arabic-fix\";\n\n\t\tfunction arabicFix(el, data) {\n\t\t\t// Add rtl direction in Arabic-English mixing layout\n\t\t\tArray.prototype.every.call(data, function (e, i) {\n\t\t\t\tif (e.charCodeAt(0) > 160) {\n\t\t\t\t\tel.addClass(CLS_ARABIC_FIX);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\treturn function (el, data, cultureCode) {\n\t\t\tif (/^ar/.test(cultureCode)) {\n\t\t\t\tarabicFix(el, data);\n\t\t\t}\n\t\t}\n\t});\n",
    "define('school-ui-shared/utils/location-helper',[], function () {\n\t//constructor\n\tfunction LocationHelper(initHref) {\n\t\tvar me = this;\n\t\tif (!(me instanceof LocationHelper)) {\n\t\t\treturn new LocationHelper(initHref);\n\t\t}\n\n\t\tme.link = document.createElement('a');\n\t\tif (initHref) {\n\t\t\tme.link.href = initHref;\n\t\t}\n\t}\n\n\t//common function\n\tLocationHelper.prototype.getUrl = function () {\n\t\treturn this.link.href;\n\t};\n\n\tLocationHelper.prototype.toString = LocationHelper.prototype.getUrl;\n\tLocationHelper.prototype.valueOf = LocationHelper.prototype.getUrl;\n\n\t//href\n\tLocationHelper.prototype.getHref = LocationHelper.prototype.getUrl;\n\tLocationHelper.prototype.setHref = function (value) {\n\t\tvar me = this;\n\t\tme.link.href = value;\n\t\treturn me;\n\t};\n\n\t//protocol\n\tLocationHelper.prototype.getProtocol = function () {\n\t\treturn this.link.protocol;\n\t};\n\tLocationHelper.prototype.setProtocol = function (value) {\n\t\tvar me = this;\n\t\tme.link.protocol = value;\n\t\treturn me;\n\t};\n\n\t//host\n\tLocationHelper.prototype.getHost = function () {\n\t\treturn this.link.host;\n\t};\n\tLocationHelper.prototype.setHost = function (value) {\n\t\tvar me = this;\n\t\tme.link.host = value;\n\t\treturn me;\n\t};\n\n\t//hostname\n\tLocationHelper.prototype.getHostname = function () {\n\t\treturn this.link.hostname;\n\t};\n\tLocationHelper.prototype.setHostname = function (value) {\n\t\tvar me = this;\n\t\tme.link.hostname = value;\n\t\treturn me;\n\t};\n\n\t//port\n\tLocationHelper.prototype.getPort = function () {\n\t\treturn this.link.port;\n\t};\n\tLocationHelper.prototype.setPort = function (value) {\n\t\tvar me = this;\n\t\tme.link.port = value;\n\t\treturn me;\n\t};\n\n\t//pathname\n\tLocationHelper.prototype.getPathname = function () {\n\t\treturn this.link.pathname;\n\t};\n\tLocationHelper.prototype.setPathname = function (value) {\n\t\tvar me = this;\n\t\tme.link.pathname = value;\n\t\treturn me;\n\t};\n\n\t//search\n\tLocationHelper.prototype.getSearch = function () {\n\t\treturn this.link.search;\n\t};\n\tLocationHelper.prototype.setSearch = function (value) {\n\t\tvar me = this;\n\t\tme.link.search = value;\n\t\treturn me;\n\t};\n\n\t//hash\n\tLocationHelper.prototype.getHash = function () {\n\t\treturn this.link.hash;\n\t};\n\tLocationHelper.prototype.setHash = function (value) {\n\t\tvar me = this;\n\t\tme.link.hash = value;\n\t\treturn me;\n\t};\n\n\treturn LocationHelper;\n});\n",
    "define('school-ui-shared/utils/media-player',[\n\t\"jquery\",\n\t\"when\",\n\t\"troopjs-core/component/factory\",\n\t \"./browser-check\",\n\t\"./ccl\",\n\t\"../enum/ccl\"\n], function ($, when, Factory, BROWSERCHECK, CCL, ENUM) {\n    var VALUE = \"value\";\n    var SHIM = \"shim\";\n    var AUTO = \"auto\";\n    var TYPE = \"type\";\n    var BROWSER = \"browser\";\n    var VERSION = \"version\";\n    var PLAYER = \"player\";\n    var AUDIO = \"audio\";\n    var VIDEO = \"video\";\n\n    function player(type) {\n        // Quick fail if required parameter were not provided\n        if (!type) {\n            return when.reject(new Error(\"required parameters not provided\"));\n        }\n\n\t\t// Query CCL for rules\n\t\treturn CCL\n\t\t\t.getCCLByKey(ENUM.playerRules)\n            .spread(function (rules) {\n                // Parse rules\n                rules = rules\n                    && $.parseJSON(rules[VALUE]);\n\n                // Get browser and version from BROWSERCHECK\n                var browser = BROWSERCHECK[BROWSER];\n                var version = BROWSERCHECK[VERSION];\n\n                // Map players for combined rules\n                var players = $.map(rules || false, function (rule) {\n                    return rule\n                        && (!(TYPE in rule) || type === rule[TYPE])\n                        && (!(BROWSER in rule) || browser === rule[BROWSER])\n                        && (!(VERSION in rule) || version >= rule[VERSION])\n                        && rule[PLAYER];\n                });\n\n                // Resolve with last matched rule or SHIM\n                return players.pop() || SHIM;\n            });\n    }\n\n    var MediaPlayer = Factory.create({\n        \"videoPlayer\" : function () {\n            return player.call(this, VIDEO);\n        },\n\n        \"audioPlayer\" : function () {\n            return player.call(this, AUDIO);\n        }\n    });\n\n    MediaPlayer[SHIM] = SHIM;\n    MediaPlayer[AUTO] = AUTO;\n\n    return MediaPlayer;\n});\n",
    "define('school-ui-shared/utils/media',[], function () {\n\t\"use strict\";\n\n\tfunction findErrorName(error) {\n\t\tvar code = error && error.code || null;\n\t\tvar result = typeof code === 'number' ? String(code) : null;\n\t\tvar ME = window.MediaError || {};\n\t\tObject.keys(ME).some(function (name) {\n\t\t\tif (name.indexOf('MEDIA_') === 0 && ME[name] === code) {\n\t\t\t\tresult = name;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\treturn result;\n\t}\n\n\treturn {\n\t\tfindErrorName: findErrorName\n\t};\n});\n\n",
    "define('school-ui-shared/utils/path-formatter',[\"troopjs-ef/component/gadget\", \"./typeid-parser\"], function(Gadget, typeIdParser){\n\n\tvar UNDEF;\n\tvar URI = \"URI\";\n\tvar NUMBER_ANY = '234';\n\n\tvar EXPAND = [ , \"enrollment!$2\", \"course!$2\", \"level!$2\", \"unit!$2\", \"lesson!$2\", \"step!$2\", \"activity!$2.activityContent\" ];\n\tvar PLACEHOLDER_ID = '$2';\n\tvar PREFIX = [];\n\tvar PREFIX_POSITION = {};\n\tvar inited = false;\n\n\t/**\n\t * update uri according to the IDs that passed in.\n\t * @param IDs\n\t */\n\tfunction routeUri() {\n\t\tvar me = this;\n\t\tvar uri = me[URI];\n\t\tvar path = uri.path || [];\n\t\tvar length = 0;\n\n\t\t$.each(arguments, function (i, entity) {\n\t\t\tvar matches = typeIdParser.parse(entity);\n\t\t\tvar type;\n\t\t\tvar id;\n\t\t\tvar position;\n\n\t\t\t// Is this an entity\n\t\t\tif (matches) {\n\t\t\t\ttype = matches.type;\n\t\t\t\tid = matches.id || \"\";\n\n\t\t\t\t// Do we know where to change\n\t\t\t\tif (type in PREFIX_POSITION) {\n\t\t\t\t\t// Get position\n\t\t\t\t\tposition = PREFIX_POSITION[type];\n\n\t\t\t\t\t// Update path\n\t\t\t\t\tpath[position] = id;\n\n\t\t\t\t\t// Update length\n\t\t\t\t\tlength = Math.max(length, position);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Did we modify anything?\n\t\tif (++length > 1) {\n\t\t\t// Remove trailing part of path\n\t\t\tpath.length = length;\n\t\t\t// Reroute\n\t\t\tme.route(uri);\n\t\t}\n\t}\n\n\t/**\n\t * remove some id value in url hash\n\t * @param id id or type\n\t */\n\tfunction unrouteUri(id) {\n\t\tvar me = this;\n\n\t\tvar uri = me[URI];\n\n\t\tvar path = uri.path || [];\n\t\tvar type = id;\n\n\t\tif (typeIdParser.isId(id)){\n\t\t\ttype = typeIdParser.parseType(id);\n\t\t}\n\n\t\tvar pos = PREFIX_POSITION[type];\n\n\t\tif (!pos){\n\t\t\tthrow \"pathFormatter: no such type\";\n\t\t}\n\n\t\twhile(path.length > pos) {\n\t\t\tpath.pop();\n\t\t}\n\n\t\tme.route(uri);\n\t}\n\n\tvar pathFormatter = Gadget.create(function(){\n\t\tvar expand, type, l;\n\n\t\tinit : {\n\n\t\t\tif (inited){\n\t\t\t\tbreak init;\n\t\t\t}\n\n\t\t\t// get prefixes and prefix positions\n\t\t\tfor(var l = EXPAND.length; l--;){\n\n\t\t\t\ttype = UNDEF;\n\n\t\t\t\texpand = EXPAND[l];\n\n\t\t\t\tif (expand){\n\t\t\t\t\ttype = typeIdParser.parseType(expand.replace(PLACEHOLDER_ID, NUMBER_ANY));\n\n\t\t\t\t\tPREFIX_POSITION[type] = l;\n\t\t\t\t}\n\n\t\t\t\tPREFIX.unshift(type);\n\n\t\t\t}\n\n\t\t\tinited = true;\n\t\t}\n\n\t}, {\n\t\tPREFIX: PREFIX,\n\t\tEXPAND: EXPAND,\n\t\tPOSITION: PREFIX_POSITION,\n\t\t\"displayName\" : \"school-ui-shared/utils/path-formatter\",\n\t\t\"hub:memory/route\" : function onRoute(uri) {\n\t\t\tthis[URI] = uri;\n\t\t},\n\t\t/**\n\t\t * update uri according to the IDs that passed in.\n\t\t * @param IDs\n\t\t */\n\t\texpand: routeUri,\n\n\t\t/**\n\t\t * remove some id value in url hash\n\t\t * @param id id or type\n\t\t */\n\t\tcollapse: unrouteUri\n\t});\n\n\tpathFormatter.start();\n\treturn pathFormatter;\n});\n",
    "define('school-ui-shared/utils/performance',[\n], function () {\n\t\"use strict\";\n\n\tvar performance = window.performance;\n\tvar HAS_PERFORMANCE_API = Boolean(\n\t\tperformance\n\t\t&& typeof performance.getEntries === 'function'\n\t\t&& window.PerformanceResourceTiming\n\t);\n\n\tif (HAS_PERFORMANCE_API) {\n\t\tif (typeof performance.clearResourceTimings === 'function'\n\t\t\t&& typeof performance.setResourceTimingBufferSize === 'function') {\n\t\t\tperformance.onresourcetimingbufferfull = (function (onresourcetimingbufferfull) {\n\t\t\t\tif (performance.getEntries().length < 1000) {\n\t\t\t\t\tperformance.setResourceTimingBufferSize(1000);\n\t\t\t\t}\n\t\t\t\tonresourcetimingbufferfull.apply(this, arguments);\n\t\t\t\tperformance.clearResourceTimings();\n\t\t\t})(performance.onresourcetimingbufferfull || function () {});\n\t\t}\n\t}\n\n\treturn {\n\t\t\"getLogMessage\": function () {\n\t\t\tif (HAS_PERFORMANCE_API) {\n\t\t\t\tvar perfs = {\n\t\t\t\t\ttiming: performance.timing,\n\t\t\t\t\tentries: performance.getEntries().slice(-50),\n\t\t\t\t};\n\t\t\t\treturn JSON.stringify(perfs, function (key, value) {\n\t\t\t\t\tif (typeof value === 'number') {\n\t\t\t\t\t\treturn Number(value.toFixed(3));\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\t\treturn value.replace(/\\s/g, '~');\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t};\n});\n\n",
    "define('school-ui-shared/utils/progress-state',[\n\t\"jquery\",\n\t\"school-ui-shared/enum/progress-state\",\n\t\"troopjs-ef/component/gadget\"\n], function ProgressStateUtilModule($, ProgressStateEnum, Gadget) {\n\t\"use strict\";\n\n\tvar progressState = Gadget.create({\n\t\tnotStarted: function notStarted (state) {\n\t\t\treturn (state === ProgressStateEnum.notStarted);\n\t\t},\n\n\t\thasStarted: function hasStarted (state) {\n\t\t\treturn (state === ProgressStateEnum.started);\n\t\t},\n\n\t\thasPassed: function hasPassed(state){\n\t\t\treturn (state === ProgressStateEnum.completed);\n\t\t}\n\t});\n\n\tprogressState.start();\n\n\treturn progressState;\n});\n",
    "define('school-ui-shared/utils/update-command',[\n\t\"when\",\n\t\"troopjs-ef/component/gadget\"\n], function (when, Gadget) {\n\t\"use strict\";\n\tvar DEBUG = true;\n\n\t/*!\n\t * constants\n\t */\n\tvar ID = \"id\",\n\t\tFAULT = \"fault!\",\n\t\tFAULT_CODE = \"faultCode\",\n\t\tFAULT_MSG = \"faultMessage\";\n\n\t/*!\n\t * get error status and status text from ajax error\n\t *\n\t * TODO: For ajax error we need a framework layer process?\n\t *\n\t * @param {Object} ex\n\t * @return {String} error\n\t */\n\tfunction errorOf(ex) {\n\t\tvar error = \"Sorry! Error occurred, please contact Administrator.\";\n\t\tif(!DEBUG) {\n\t\t\treturn error;\n\t\t}\n\n\t\tif(ex && ex.status) {\n\t\t\terror = ex.status + \" \" + ex.statusText;\n\t\t} else {\n\t\t\terror = ex || \"unknown error\";\n\t\t}\n\t\treturn when.reject(error);\n\t}\n\n\t/*!\n\t * verify results\n\t *\n\t * @param {Array} results\n\t * @return {Object} verified\n\t */\n\tfunction verify(results) {\n\t\tvar result = results && (results[0] || results),\n\t\t\tverified = { success: true, data: result };\n\n\t\tif(!result || result[ID] === FAULT) {\n\t\t\tverified.success = false;\n\t\t\tverified.data = result ? result[FAULT_MSG] : \"verify failed, unknown error\";\n\t\t}\n\t\treturn verified;\n\t}\n\n\t/*!\n\t * call update service by api\n\t *\n\t * @param {String} apiName\n\t * @param {Object} data\n\t * @param {String} topic\n\t */\n\tfunction update(apiName, data, topic) {\n\t\tvar me = this;\n\t\tvar promise;\n\t\tme.publish(\"school/spinner\", promise = me.publish(apiName, data));\n\t\treturn promise.spread(function doneUpdate(results) {\n\t\t\tvar verified = verify.call(me, results),\n\t\t\t\tresult  = verified.data;\n\n\t\t\tif(verified.success && results !== data) {\n\t\t\t\tif(topic) {\n\t\t\t\t\tme.publish(topic, result);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\tthrow result;\n\t\t\t}\n\t\t}).otherwise(function(ex){\n\t\t\treturn errorOf.call(me, ex);\n\t\t});\n\t}\n\n\treturn Gadget.create({\n\t\tupdate: update\n\t});\n});\n\n",
    "/**\n * # util/update-help.js\n *\n * Update service wrapper\n *\n * @author UX Team\n * @version 0.0.1\n */\ndefine('school-ui-shared/utils/update-helper',[\n\t\"./update-command\"\n], function UpdateHelperUtilModule(UpdateCommand) {\n\t\"use strict\";\n\n\t/*!\n\t * api name\n\t */\n\tvar API_SUBMIT_SCORE = \"school/scoring/SubmitActivityScore\";\n\tvar API_UPDATE_ENROLLMENT = \"school/enrollment/UpdateCurrentEnrollment\";\n\tvar API_SAVE_MEMBER_SITE = \"school/member_site_setting/Save\";\n\tvar API_INTEGRATION_SUBMIT_WRITING = \"schoolintegration/integration_writing/SubmitWriting\";\n\tvar API_SUBMIT_RATING = \"school/rating/SubmitRating\";\n\tvar API_FEATURE_LOG = \"school/featuresupport/Log\";\n\tvar API_ACT_EVENT_LOG = \"school/school_event_log/LogActivityEvent\";\n\tvar API_WRITING_CORRECTION_SUBMIT_RATING = \"school/writing_correction_rating/SubmitRating\";\n\tvar API_PLATFORM_MIGRATE = \"school/platform2migrate/Migrate\";\n\tvar API_NEW_CONTENT_MIGRATE = \"school/newcontentupgrade/Migrate\";\n\n\t/*!\n\t * hub name\n\t */\n\tvar HUB_UPDATE_PROGRESS = \"ef/update/progress\";\n\n\treturn {\n\t\tsubmitScore: function onSubmitScore(data) {\n\t\t\treturn UpdateCommand.update(API_SUBMIT_SCORE, data, HUB_UPDATE_PROGRESS);\n\t\t},\n\n\t\tmoveOnUnit: function onMoveOnUnit(data) {\n\t\t\treturn UpdateCommand.update(API_MOVE_ON_UNIT, data, HUB_UPDATE_PROGRESS);\n\t\t},\n\n\t\tupdateEnrollment: function onUpdateEnrollment(data) {\n\t\t\treturn UpdateCommand.update(API_UPDATE_ENROLLMENT, data);\n\t\t},\n\n\t\tsubmitRating: function onSubmitRating(data) {\n\t\t\treturn UpdateCommand.update(API_SUBMIT_RATING, data);\n\t\t},\n\n\t\tsaveMemberSite: function onSubmitRating(data) {\n\t\t\treturn UpdateCommand.update(API_SAVE_MEMBER_SITE, data);\n\t\t},\n\n\t\tintegrationSubmitWriting: function onSubmitWriting(data) {\n\t\t\treturn UpdateCommand.update(API_INTEGRATION_SUBMIT_WRITING, data);\n\t\t},\n\n\t\tlogFeature: function onLogFeature(data) {\n\t\t\treturn UpdateCommand.update(API_FEATURE_LOG, data);\n\t\t},\n\n\t\tlogActEvent: function onLogActEvent(data) {\n\t\t\treturn UpdateCommand.update(API_ACT_EVENT_LOG, data);\n\t\t},\n\n\t\tsubmitWritingCorrectionRating: function onSubmitWritingCorrectionRating(data) {\n\t\t\treturn UpdateCommand.update(API_WRITING_CORRECTION_SUBMIT_RATING, data);\n\t\t},\n\n\t\tplatformMigrate: function onPlatformMigrate(data) {\n\t\t\treturn UpdateCommand.update(API_PLATFORM_MIGRATE, data);\n\t\t},\n\n\t\tnewContentMigrate: function onPlatformMigrate(data) {\n\t\t\treturn UpdateCommand.update(API_NEW_CONTENT_MIGRATE, data);\n\t\t}\n\t};\n});\n\n",
    "define('school-ui-shared/widget/abtest-helper',[\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"troopjs-browser/loom/config\",\n\t\"when\"\n], function($, Widget, loom, when){\n\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\n\treturn Widget.extend({\n\t\t// controller\n\t\t// {\n\t\t//  \"value1\": \"widgetA\",\n\t\t//  \"value2\": \"widgetB\"\n\t\t// }\n\t\t\"sig/start\": function onSingle() {\n\t\t\tvar me = this;\n\t\t\tvar $data = me[$ELEMENT].data();\n\n\t\t\tif($data.query && $data.controller) {\n\t\t\t\treturn me.query($data.query).spread(function(data){\n\t\t\t\t\tif(typeof $data.controller == \"string\") {\n\t\t\t\t\t\t$data.controller = $.parseJSON($data.controller);\n\t\t\t\t\t}\n\t\t\t\t\tvar widget = $data.controller[data.value];\n\n\t\t\t\t\tif(widget) {\n\t\t\t\t\t\tme[$ELEMENT].html($(\"<div>\").attr(loom.weave, widget).attr(\"data-abtest\", data.value));\n\t\t\t\t\t\treturn me.weave();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/widget/audio-player/main',[\n\t'jquery',\n\t'when',\n\t'logger',\n\t\"../../utils/performance\",\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/utils/browser-check\",\n\t'school-ui-shared/utils/media',\n\t'school-ui-shared/utils/hub-memory',\n\t'school-ui-shared/utils/location-helper',\n\t'school-ui-shared/utils/audio-output',\n\t'mediaelement-and-player'\n], function audioPlayerModule($,\n                              when,\n                              Logger,\n                              performanceUtils,\n                              Widget,\n                              browserCheck,\n                              Media,\n                              HubMemory,\n                              LocationHelper,\n                              AudioOutput,\n                              mejs) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar SEL_CONTAINER = '.mejs-container';\n\tvar SEL_BTN_PLAY = '.mejs-play';\n\n\tvar CLS_CONTROLS_PLAYING = 'mejs-controls-playing';\n\n\tvar EVENTS_TO_FORWARD = [\n\t\t'play', 'playing', 'pause', 'ended'\n\t];\n\tvar FORWARDED_EVENT_PREFIX = 'media/';\n\tvar MODE_NATIVE = \"native\";\n\n\tvar blankAudio = 'data:audio/mpeg;base64,SUQzAwAAAAAAI1RTU0UAAAAPAAAATGF2ZjU3LjQxLjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAEluZm8AAAAPAAAABwAABoYAPz8/Pz8/Pz8/Pz8/Pz9fX19fX19fX19fX19fX39/f39/f39/f39/f39/n5+fn5+fn5+fn5+fn5+fv7+/v7+/v7+/v7+/v7/f39/f39/f39/f39/f3///////////////////AAAAAExhdmM1Ny40OAAAAAAAAAAAAAAAACQAAAAAAAAAAAaGYncOXgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/jQMQAAAADSAAAAABMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/40LEOwAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jQsQ7AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+NCxDsAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/40LEOwAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/jQsQ7AAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+NCxDsAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=';\n\n\tvar logIdGenerator = 1000;\n\n\tfunction mediaPlayerLog(message) {\n\t\tvar me = this;\n\t\tvar mode = me.audioInstance ? me.audioInstance.media.pluginType : 'unknown';\n\t\tvar finalMessage = me._logPrefix + ' mode=' + mode + ' ' + message;\n\t\tLogger.log(finalMessage);\n\t}\n\n\tfunction mediaPlayerLogAudioOutput(message) {\n\t\tvar me = this;\n\t\tvar logPrefix = me._logPrefix;\n\t\tvar mode = me.audioInstance ? me.audioInstance.media.pluginType : 'unknown';\n\n\t\tvar promiseHasAudioOutput = AudioOutput.hasAudioOutput()\n\t\t.then(function (result) {\n\t\t\treturn 'HasOutput=' + result;\n\t\t})\n\t\t.otherwise(function (error) {\n\t\t\treturn 'FailedToGetOutput=' + (error.message || String(error)).replace(/\\s+/g, '_');\n\t\t});\n\n\t\tvar promiseCanPlayAudio = AudioOutput.canPlayAudio()\n\t\t.then(function (result) {\n\t\t\treturn 'CanPlayMedia=' + result;\n\t\t})\n\t\t.otherwise(function (error) {\n\t\t\treturn 'FailedToPlayMedia=' + (error.message || String(error)).replace(/\\s+/g, '_');\n\t\t});\n\n\t\twhen.all([promiseHasAudioOutput, promiseCanPlayAudio]).spread(function (hasAudioOutput, canPlayAudio) {\n\t\t\tvar finalMessage = logPrefix + ' mode=' + mode + ' ' + hasAudioOutput + ' ' + canPlayAudio + ' ' + message;\n\t\t\tLogger.log(finalMessage);\n\t\t});\n\t}\n\n\tfunction bindMediaElement(mediaElement, domElement, player) {\n\t\tfunction _onStartPlay() {\n\t\t\tme.publish('audio/event/play', mediaElement);\n\t\t\tplayer.controls.addClass(CLS_CONTROLS_PLAYING);\n\t\t}\n\n\t\tfunction _onStopPlay(){\n\t\t\tplayer.controls.removeClass(CLS_CONTROLS_PLAYING);\n\t\t}\n\n\t\tvar me = this;\n\t\tvar $domElement = $(domElement);\n\n\t\tmediaElement.addEventListener('play', _onStartPlay);\n\t\tmediaElement.addEventListener('pause', _onStopPlay);\n\t\tmediaElement.addEventListener('ended', _onStopPlay);\n\n\t\tEVENTS_TO_FORWARD.forEach(function (eventName) {\n\t\t\t// var listener = $domElement.trigger.bind($domElement, FORWARDED_EVENT_PREFIX + eventName);\n\t\t\tvar listener = function () {\n\t\t\t\t$domElement.trigger(FORWARDED_EVENT_PREFIX + eventName);\n\t\t\t};\n\t\t\tmediaElement.addEventListener(eventName, listener, false);\n\t\t});\n\n\t\tvar onError = function (e) {\n\t\t\tif (me._preloadFix) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar message = e.message || Media.findErrorName(mediaElement.error) || String(e);\n\t\t\tvar url = e.src || me._audioUrl || '';\n\n\t\t\t//for Frontend log\n\t\t\tvar mode = mediaElement.pluginType || \"\";\n\t\t\tLogger.log(\"Error loading audio \" + mode + \" for \" + url + \": \" + message);\n\n\t\t\t//for Media log\n\t\t\tvar perfLog = performanceUtils.getLogMessage();\n\t\t\tif (perfLog) {\n\t\t\t\tmediaPlayerLog.call(me, 'Error.Media.Perfs ' + perfLog);\n\t\t\t}\n\t\t\tmediaPlayerLogAudioOutput.call(me, 'Error.Media ' + message);\n\t\t};\n\t\tmediaElement.addEventListener('error', onError, false);\n\t}\n\n\tfunction initPlayer() {\n\t\tvar me = this;\n\t\tvar customOptions = $.extend(true, {}, me._audioOptions);\n\n\t\t//init mep\n\t\tvar audio = me[$ELEMENT].get(0);\n\t\tif (!audio.src) {\n\t\t\tme._preloadFix =\n\t\t\t\t(browserCheck.browser === 'msie' && parseInt(browserCheck.version) > 9 ) ||\n\t\t\t\tbrowserCheck.browser === 'edge';\n\n\t\t\tif (me._preloadFix) {\n\t\t\t\taudio.src = blankAudio;\n\t\t\t}\n\t\t\telse {\n\t\t\t\taudio.src = audio.attributes['data-src'].value;\n\t\t\t}\n\t\t}\n\n\t\treturn (me._finalized ?\n\t\t\t\twhen.resolve() :\n\t\t\t\tinitMediaelementPlayer.call(me, customOptions)\n\t\t).catch(function (ex) {\n\t\t\tex.player && ex.player.controls && ex.player.controls.show();\n\n\t\t\tvar message = 'Error.Init ';\n\t\t\tif (ex.canPlayType) {\n\t\t\t\tmessage += 'CanPlayType=' + ex.canPlayType('audio/mpeg');\n\t\t\t}\n\t\t\telse if (ex.error) {\n\t\t\t\tmessage += ex.error;\n\t\t\t}\n\t\t\telse if (ex.message) {\n\t\t\t\tmessage += ex.message;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmessage += String(ex);\n\t\t\t}\n\t\t\tme._logDefer.resolver.resolve(message);\n\t\t\tthrow ex;\n\t\t});\n\t}\n\n\tfunction wrapPlayToHandleRejection(play) {\n\t\treturn function playWithHandledRejection() {\n\t\t\tvar mediaElement = this;\n\t\t\tvar promise = play.apply(mediaElement, arguments);\n\t\t\tif (promise) {\n\t\t\t\twhen(promise).catch(function (error) {\n\t\t\t\t\tif (typeof DOMException !== 'undefined' && error instanceof DOMException) {\n\t\t\t\t\t\tif (error.code === DOMException.ABORT_ERR) {\n\t\t\t\t\t\t\t// ignore\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar nodes = [mediaElement].concat(\n\t\t\t\t\t\tArray.prototype.slice.call(mediaElement.querySelectorAll('source')));\n\t\t\t\t\tvar src = nodes.map(function (node) {\n\t\t\t\t\t\treturn node.src;\n\t\t\t\t\t}).join(', ');\n\t\t\t\t\tLogger.log('Audio play() exception: ' + String(error) + '\\n' + src);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promise;\n\t\t};\n\t}\n\n\tfunction initMediaelementPlayer(customOptions) {\n\t\tvar me = this;\n\n\t\treturn when.promise(function (resolve, reject) { //handle exceptions\n\t\t\tme.audioInstance = new mejs.MediaElementPlayer(me[$ELEMENT].get(0), {\n\t\t\t\tmode: MODE_NATIVE,\n\t\t\t\tplugins: [],\n\t\t\t\tpauseOtherPlayers: (typeof customOptions.pauseOtherPlayers === 'boolean' ? customOptions.pauseOtherPlayers : true),\n\t\t\t\talwaysShowControls: (typeof customOptions.alwaysShowControls === 'boolean' ? customOptions.alwaysShowControls : true),\n\t\t\t\tplaypauseText: '',\n\t\t\t\tsuccess: function (mediaElement, domElement, player) {\n\t\t\t\t\tmediaElement.play = wrapPlayToHandleRejection(mediaElement.play);\n\n\t\t\t\t\tvar $domElement = $(domElement);\n\t\t\t\t\t$domElement.closest(SEL_CONTAINER).css(\"display\", \"inline-block\");\n\n\t\t\t\t\tif (me._preloadFix) {\n\t\t\t\t\t\tme[$ELEMENT].closest(SEL_CONTAINER).find(SEL_BTN_PLAY).one('click', me._onFirstTimePlay = function onFirstTimePlay(e) {\n\t\t\t\t\t\t\tme._preloadFix = false;\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tvar src = $domElement.data(\"src\");\n\t\t\t\t\t\t\tme._audioUrl = src;\n\t\t\t\t\t\t\tupdateLogPrefix.call(me);\n\n\t\t\t\t\t\t\tmediaElement.pause();\n\t\t\t\t\t\t\tmediaElement.setSrc(src);\n\t\t\t\t\t\t\tmediaElement.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tbindMediaElement.call(me, mediaElement, domElement, player);\n\n\t\t\t\t\tme._logDefer.resolver.resolve();\n\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\terror: reject\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction updateLogPrefix() {\n\t\tvar me = this;\n\t\tvar $el = me[$ELEMENT];\n\n\t\tvar course = HubMemory.readMemory('load/course');\n\t\tvar level = HubMemory.readMemory('load/level');\n\t\tvar activity = HubMemory.readMemory('load/activity');\n\t\tvar activityOption = $el.closest('.ets-act-bd-activity').data('option');\n\t\tvar activityContent = activityOption && activityOption.activityContent;\n\n\t\tvar courseTypeCode = course && course.courseTypeCode || '';\n\t\tvar levelId = level && (level.templateLevelId || level.id) || '';    //templateLevelId for platform 2, id for platform 1\n\t\tvar levelCode = level && (level.levelCode || level.levelNo) || '';\n\t\tvar activityId = activity && (activity.templateActivityId || activity.id) || '';    //templateActivityId for platform 2, id for platform 1\n\t\tvar activityTemplateCode = activityContent && activityContent.templateCode || '';\n\t\tvar mediaUrl = me._audioUrl.replace(/ /g, '%20');\n\t\tvar browser = browserCheck.browser + '/' + parseInt(browserCheck.actualVersionOfCompatibility || browserCheck.version, 10);\n\t\tif (!me._logid) {\n\t\t\tme._logid = (new Date().getTime()) + '.' + (logIdGenerator++);\n\t\t}\n\n\t\tme._logPrefix = [\n\t\t\t'NewMediaPlayer audio',\n\t\t\t'courseTypeCode=' + courseTypeCode,\n\t\t\t'level=' + levelId,\n\t\t\t'levelCode=' + courseTypeCode + '_' + levelCode,\n\t\t\t'activity=' + activityId,\n\t\t\t'activityType=' + activityTemplateCode,\n\t\t\t'url=' + mediaUrl,\n\t\t\t'browser=' + browser,\n\t\t\t'logid=' + me._logid\n\t\t].join(' ');\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme._finalized = false;\n\t\tme._audioOptions = me[$ELEMENT].data();\n\t\tme._audioUrl = me[$ELEMENT].data('src') || me[$ELEMENT].get(0).src;\n\t\tme.audioInstance = null;\n\t\tupdateLogPrefix.call(me);\n\n\t\tme._preloadFix = false;\n\n\t\tme._logDefer = when.defer();\n\t\tme._logDefer.promise.then(function (message) {\n\t\t\tmessage && mediaPlayerLog.call(me, message);\n\t\t});\n\t}, {\n\t\t\"sig/start\": function onStart() {\n\t\t\tvar me = this;\n\t\t\treturn initPlayer.call(me);\n\t\t},\n\t\t'sig/stop': function () {\n\t\t\tvar me = this;\n\t\t\tme._finalized = true;\n\t\t\tme.audioInstance.pause();\n\t\t\tme.audioInstance = null;\n\t\t},\n\n\t\t\"hub/audio/event/play\": function (sourceMediaElement) {\n\t\t\tvar me = this;\n\n\t\t\t// on another audio-player plays\n\t\t\tif (me.audioInstance\n\t\t\t\t&& sourceMediaElement !== me.audioInstance.media\n\t\t\t\t&& me.audioInstance.media.currentTime > 0\n\t\t\t) {\n\t\t\t\t// force reset current time to match previous behaviour\n\t\t\t\tme.audioInstance.media.setCurrentTime(0);\n\t\t\t\tme.audioInstance.media.pause();\n\t\t\t}\n\t\t},\n\n\t\t\"dom/player/play\": function play($event, src) {\n\t\t\tvar me = this;\n\t\t\tif (me.audioInstance) {\n\t\t\t\tif (src) {\n\t\t\t\t\tif (me._preloadFix) {\n\t\t\t\t\t\tme._preloadFix = false;\n\t\t\t\t\t\tme._onFirstTimePlay && me[$ELEMENT].closest(SEL_CONTAINER).find(SEL_BTN_PLAY).unbind('click', me._onFirstTimePlay);\n\t\t\t\t\t}\n\n\t\t\t\t\tme._audioUrl = src;\n\t\t\t\t\tupdateLogPrefix.call(me);\n\n\t\t\t\t\tme.audioInstance.media.pause();\n\t\t\t\t\tme.audioInstance.media.setSrc(src);\n\t\t\t\t\tme.audioInstance.media.load();\n\t\t\t\t}\n\t\t\t\tme.audioInstance.media.play();\n\t\t\t}\n\t\t},\n\t\t\"dom/player/pause\": function pause() {\n\t\t\tvar me = this;\n\t\t\tif (me.audioInstance) {\n\t\t\t\tme.audioInstance.media.pause();\n\t\t\t}\n\t\t},\n\t\t\"dom/player/seek\": function seek($event, seekedTime) {\n\t\t\tvar me = this;\n\t\t\tif (me.audioInstance) {\n\t\t\t\tvar paused = me.audioInstance.media.paused;\n\t\t\t\tme.audioInstance.media.setCurrentTime(seekedTime);\n\t\t\t\tif (paused) {\n\t\t\t\t\tme.audioInstance.media.pause();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"dom/player/end\": function end() {\n\t\t\tvar me = this;\n\t\t\tif (me.audioInstance) {\n\t\t\t\tme.audioInstance.media.setCurrentTime(0);\n\t\t\t\tme.audioInstance.media.pause();\n\t\t\t}\n\t\t},\n\t\t\"dom/player/volume\": function setVolume($event, volumeInfo) {\n\t\t\tvar me = this;\n\t\t\tif (me.audioInstance) {\n\t\t\t\tme.audioInstance.media.setVolume(volumeInfo.volume);\n\n\t\t\t\tif (typeof volumeInfo.muted === 'boolean') {\n\t\t\t\t\tme.audioInstance.media.setMuted(volumeInfo.muted);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-shared/widget/blurb',[\n\t\"when\",\n\t\"troopjs-ef/component/widget\"\n\t], function(when, Widget){\n\n\t\tvar RE = /(?:\\^(\\w+)\\^)/g;\n\t\tvar PATTERNS = {\n\t\t\t\"default\" : RE\n\t\t};\n\n\t\treturn Widget.extend({\n\t\t\t\"sig/start\" : function cclBlurbStart () {\n\t\t\t\tvar me = this;\n\t\t\t\tvar data = me.$element.data();\n\t\t\t\t//if there is a blurb-ccl in data, we try to use the ccl value as the blurb id\n\t\t\t\treturn when(data.blurbCcl && me.query(\"ccl!'\" + data.blurbCcl + \"'\"))\n\t\t\t\t\t.then(function(cclValue){\n\t\t\t\t\t\t//if the ccl value is undefined, we use origin blurb id in data\n\t\t\t\t\t\tvar id = cclValue && cclValue[0] && cclValue[0].value || data.blurbId;\n\t\t\t\t\t\tif(id){\n\t\t\t\t\t\t\t// Query for blurb\n\t\t\t\t\t\t\treturn me.query(\"blurb!\" + id).spread(function doneQuery(blurb) {\n\t\t\t\t\t\t\t\tvar pattern = data.pattern;\n\t\t\t\t\t\t\t\tvar values = data.values;\n\t\t\t\t\t\t\t\tvar translation = blurb && blurb.translation || \"\";\n\n\t\t\t\t\t\t\t\tif (translation && values) {\n\t\t\t\t\t\t\t\t\tpattern = pattern\n\t\t\t\t\t\t\t\t\t\t? PATTERNS[pattern] || RegExp(pattern, \"g\")\n\t\t\t\t\t\t\t\t\t\t: RE;\n\n\t\t\t\t\t\t\t\t\t\ttranslation = translation.replace(pattern, function (match, key, position, original) {\n\t\t\t\t\t\t\t\t\t\t\treturn values[key] || key;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Set html, pass deferred\n\t\t\t\t\t\t\t\treturn me.html(translation);\n\t\t\t\t\t\t\t});\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t});\n",
    "define('school-ui-shared/widget/hyphenate',[\n\t\"poly\",\n\t\"when\",\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"troopjs-browser/loom/config\",\n\t\"../utils/hyphenate\"\n], function (poly, when, $, Widget, loom, HyphenateGadget) {\n\n\tvar $ELEMENT = \"$element\";\n\tvar PROP_WIDGET_NAME = \"_widgetName\";\n\tvar requestAnimationFrame = window.requestAnimationFrame ||\n\t\twindow.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame ||\n\t\twindow.oRequestAnimationFrame ||\n\t\twindow.msRequestAnimationFrame ||\n\t\tfunction (callback) {\n\t\t\twindow.setTimeout(callback, 16);\n\t\t};\n\n\treturn Widget.extend(function ($element, name, widgetName) {\n\t\tthis[PROP_WIDGET_NAME] = widgetName;\n\t}, {\n\t\t\"sig/start\": function onStart() {\n\t\t\tvar me = this;\n\t\t\tvar $element = me[$ELEMENT];\n\n\t\t\tvar promise;\n\t\t\tif (me[PROP_WIDGET_NAME]) {\n\t\t\t\tvar $newWidget = $element.clone();\n\t\t\t\t$newWidget.attr(loom.weave, me[PROP_WIDGET_NAME]);\n\t\t\t\t$newWidget.removeAttr(loom.unweave);\n\t\t\t\t$newWidget.removeAttr(loom.woven);\n\t\t\t\tpromise = me.html($newWidget);\n\t\t\t} else {\n\t\t\t\tpromise = when.resolve();\n\t\t\t}\n\n\t\t\treturn promise.then(function () {\n\t\t\t\t//wait next animation frame, content is likely to have been rendered so we can measure width\n\t\t\t\t// without blocking\n\t\t\t\treturn when.promise(function (resolve) {\n\t\t\t\t\trequestAnimationFrame(resolve);\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\tif ($element.width() > $element.parent().width()) {\n\t\t\t\t\t//overflow, need to hyphenate texts\n\n\t\t\t\t\t//In case it contains DOM elements, hyphenate each text node one by one\n\t\t\t\t\tvar hyphenatePromises = $element.find('*').andSelf().contents()\n\t\t\t\t\t\t.filter(function(){\n\t\t\t\t\t\t\treturn this.nodeType === 3; //text node\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.map(function(){\n\t\t\t\t\t\t\t//can't use this.textContent in IE8, use .text() and createTextNode() instead\n\t\t\t\t\t\t\tvar $textNode = $(this);\n\t\t\t\t\t\t\tvar text = $textNode.text() || '';\n\t\t\t\t\t\t\treturn HyphenateGadget.hyphenate(text).spread(function (hyphenatedText) {\n\t\t\t\t\t\t\t\t$textNode.replaceWith(document.createTextNode(hyphenatedText));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.get();\n\n\t\t\t\t\treturn when.all(hyphenatePromises);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/container/container.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-uo-container ets-uo-loading\\\">\\n\\t<div class=\\\"ets-uo-title-bar\\\">\\n\\t\\t<div class=\\\"ets-uo-title\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"450055\\\" data-text-en=\\\"Unit overview\\\"></div>\\n\\t\\t\"; if (!data.hideWorldList && data.showDownloadButton) { o += \"\\n\\t\\t<div class=\\\"ets-uo-export\\\" data-weave-delay=\\\"school-ui-shared/widget/unit-overview/export-pdf/main\\\"></div>\\n\\t\\t\"; } o += \"\\n\\t</div>\\n\\t<div class=\\\"ets-uo-unit-info\\\" data-weave-delay=\\\"school-ui-shared/widget/unit-overview/unit-info/main(data)\\\"></div>\\n\\t\"; if (!data.hideWorldList) { o += \"\\n\\t<div class=\\\"ets-uo-word-list\\\" data-weave-delay=\\\"school-ui-shared/widget/unit-overview/word-list/main(data)\\\"></div>\\n\\t\"; } o += \"\\n</div>\"; return o; }; });\n",
    "define('school-ui-shared/widget/unit-overview/container/main',[\n\t'when',\n\t'troopjs-ef/component/widget',\n\t\"troopjs-browser/loom/config\",\n\t'template!./container.html',\n\t\"module\"\n], function (when, Widget, loom, tContainer, module) {\n\t'use strict';\n\n\tvar MODULE_CONFIG = module.config() || {\n\t\t\"showDownloadButton\": true\n\t}\n\n\tvar $ELEMENT = '$element';\n\tvar SEL_UNIT_INFO = \".ets-uo-unit-info\";\n\tvar SEL_WORD_LIST = \".ets-uo-word-list\";\n\tvar SEL_EXPORT = \".ets-uo-export\";\n\n\tvar CLS_LOADING = 'ets-uo-loading';\n\tvar SEL_LOADING = '.' + CLS_LOADING;\n\n\tvar CLS_MODAL_LOADING = \"ets-uo-modal-loading\";\n\tvar SEL_MODAL_LOADING = \".\" + CLS_MODAL_LOADING;\n\n\tvar DATA_WEAVE_DELAY = 'data-weave-delay';\n\n\tfunction weaveDelayedWidget(selector, data) {\n\t\tvar me = this;\n\t\tvar $widget = me[$ELEMENT].find(selector);\n\t\tif (data) {\n\t\t\t$widget.data('data', data);\n\t\t}\n\t\treturn $widget.attr(loom.weave, $widget.attr(DATA_WEAVE_DELAY)).weave();\n\t}\n\n\tfunction loadUnitInfo(templateUnitId) {\n\t\tvar me = this;\n\t\treturn me.query('student_unit!template_unit;' + templateUnitId + '.unitImage, .parent, .children').spread(function (unit) {\n\t\t\treturn {\n\t\t\t\tlevel: unit.parent,\n\t\t\t\tunit: unit,\n\t\t\t\tlessons: unit.children\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction loadWordList(templateUnitId) {\n\t\tvar me = this;\n\t\treturn me.query('template_course_item_word!' + templateUnitId).spread(function (wordList) {\n\t\t\treturn {\n\t\t\t\twords: wordList && wordList.words || []\n\t\t\t};\n\t\t});\n\t}\n\n\treturn Widget.extend(function (element, path, templateUnitId) {\n\t\tthis._templateUnitId = templateUnitId;\n\t\tthis._hideWorldList = Boolean(element.data('hideWorldList'));\n\t}, {\n\t\t'sig/start': function () {\n\t\t\tvar me = this;\n\n\t\t\tvar containerRender = me.html(tContainer, {\n\t\t\t\thideWorldList: me._hideWorldList,\n\t\t\t\tshowDownloadButton: MODULE_CONFIG.showDownloadButton\n\t\t\t});\n\t\t\tvar unitInfoLoad = loadUnitInfo.call(me, me._templateUnitId);\n\t\t\tvar wordListLoad = loadWordList.call(me, me._templateUnitId);\n\n\t\t\tvar unitInfoRender = when.all([\n\t\t\t\tunitInfoLoad,\n\t\t\t\tcontainerRender\n\t\t\t]).spread(function (unitInfo) {\n\t\t\t\treturn weaveDelayedWidget.call(me, SEL_UNIT_INFO, unitInfo);\n\t\t\t});\n\n\t\t\tvar wordListRender = when.all([\n\t\t\t\twordListLoad,\n\t\t\t\tcontainerRender\n\t\t\t]).spread(function (wordList) {\n\t\t\t\treturn weaveDelayedWidget.call(me, SEL_WORD_LIST, wordList);\n\t\t\t});\n\n\t\t\twhen.all([\n\t\t\t\tunitInfoRender,\n\t\t\t\twordListRender\n\t\t\t]).then(function () {\n\t\t\t\treturn weaveDelayedWidget.call(me, SEL_EXPORT);\n\t\t\t}).ensure(function () {\n\t\t\t\tme[$ELEMENT].find(SEL_LOADING).removeClass(CLS_LOADING);\n\t\t\t\tme[$ELEMENT].closest(SEL_MODAL_LOADING).removeClass(CLS_MODAL_LOADING);\n\t\t\t});\n\n\t\t\treturn containerRender;\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/export-pdf.html',[],function() { return function template(data) { var o = \"<a class=\\\"ets-uo-export-link\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"134772\\\" data-text-en=\\\"Download\\\"></a>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/pdf-style.html',[],function() { return function template(data) { var o = \"<style type=\\\"text/css\\\">\\n\\tbody {\\n\\t\\tfont: 14px/1.5 Helvetica, Arial, sans-serif;\\n\\t}\\n\\n\\t.ets-uo-title {\\n\\t\\tfloat: left;\\n\\t\\tmargin: 0 15px 5px 0;\\n\\t\\tcolor: #070;\\n\\t}\\n\\n\\t.ets-uo-unit-info .ets-uo-course-location {\\n\\t\\tfloat: left;\\n\\t\\tmargin: 0 15px 5px 0;\\n\\t\\tcolor: #070;\\n\\t}\\n\\n\\t.ets-uo-unit-info .ets-uo-unit-name {\\n\\t\\tclear: left;\\n\\t\\tcolor: #15a;\\n\\t\\tmargin-bottom: 20px;\\n\\t\\tfont-size: 16px;\\n\\t\\tfont-weight: bold;\\n\\t}\\n\\n\\t.ets-uo-word-list .ets-uo-word-list-title {\\n\\t\\tcolor: #15a;\\n\\t\\tfont-size: 14px;\\n\\t}\\n\\n\\t.ets-uo-word-list table {\\n\\t\\tborder-collapse: collapse;\\n\\t\\tborder: 1px #eee solid;\\n\\t\\twidth: 640px;\\n\\t\\tfont-size: 12px;\\n\\t}\\n\\n\\t.ets-uo-word-list th,\\n\\t.ets-uo-word-list td {\\n\\t\\tborder: 1px #eee solid;\\n\\t\\tpadding: 5px 8px;\\n\\t\\tempty-cells: show;\\n\\t}\\n\\n\\t.ets-uo-word-list th {\\n\\t\\twhite-space: nowrap;\\n\\t\\tbackground: #f1f1f1;\\n\\t}\\n\\n\\t.ets-uo-word-list td {\\n\\t\\tcolor: #333;\\n\\t}\\n</style>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/export-pdf/submit-form.html',[],function() { return function template(data) { var o = \"<form method=\\\"post\\\" action=\\\"\" +data.exportPdfUrl+ \"\\\">\\n\\t<input type=\\\"hidden\\\" name=\\\"pdfContent\\\" value=\\\"\" +data.pdfContent.replace(/\\\"/g,'&quot;')+ \"\\\"/>\\n\\t<input type=\\\"hidden\\\" name=\\\"fileName\\\" value=\\\"\" +data.fileName+ \"\\\"/>\\n\\t<input type=\\\"hidden\\\" name=\\\"cacheServers\\\" value='[\\\"\\\"]'/>\\n</form>\"; return o; }; });\n",
    "define('school-ui-shared/widget/unit-overview/export-pdf/main',[\n\t'jquery',\n\t'school-ui-shared/module',\n\t'troopjs-ef/component/widget',\n\t'template!./export-pdf.html',\n\t'template!./pdf-style.html',\n\t'template!./submit-form.html'\n], function ($, module, Widget, tExportPdf, tPdfStyle, tSubmitForm) {\n\t'use strict';\n\n\tvar MODULE_CONFIG = $.extend({\n\t\texportPdfUrl: \"/school/StudyTools/downloads/PDF/Export\"\n\t}, module.config());\n\n\tvar $ELEMENT = '$element';\n\tvar SEL_CONTAINER = '.ets-uo-container';\n\tvar SEL_LEVEL_NO = '.ets-uo-level-no';\n\tvar SEL_UNIT_NO = '.ets-uo-unit-no';\n\tvar SEL_FORM = 'form';\n\n\tfunction getExportHtml() {\n\t\tvar me = this;\n\n\t\tvar $html = $('<html/>');\n\n\t\tvar $head = $('<head/>').appendTo($html);\n\t\t$head.append(tPdfStyle());\n\n\t\tvar $body = $('<body/>').appendTo($html);\n\t\tvar $clonedContainer = me[$ELEMENT].closest(SEL_CONTAINER).clone();\n\t\t$clonedContainer.find('.ets-uo-export, .ets-uo-unit-image, .ets-uo-unit-task, .ets-uo-word-list-column-player').remove();\n\t\t$body.append($clonedContainer);\n\n\t\treturn $html[0].outerHTML;\n\t}\n\n\tfunction getExportFileName() {\n\t\tvar me = this;\n\t\tvar $container = me[$ELEMENT].closest(SEL_CONTAINER);\n\t\tvar levelNo = $container.find(SEL_LEVEL_NO).text();\n\t\tvar unitNo = $container.find(SEL_UNIT_NO).text();\n\t\treturn 'unit-overview-level' + levelNo + '-unit' + unitNo;\n\t}\n\n\treturn Widget.extend({\n\t\t'sig/start': function () {\n\t\t\treturn this.html(tExportPdf);\n\t\t},\n\t\t'dom:.ets-uo-export-link/click': function () {\n\t\t\tvar me = this;\n\t\t\tvar $form = me[$ELEMENT].children(SEL_FORM);\n\n\t\t\tif (!$form.length) {\n\t\t\t\tvar submitData = {\n\t\t\t\t\tpdfContent: getExportHtml.call(me),\n\t\t\t\t\tfileName: getExportFileName.call(me),\n\t\t\t\t\texportPdfUrl: MODULE_CONFIG.exportPdfUrl\n\t\t\t\t};\n\t\t\t\t$form = $(tSubmitForm(submitData)).appendTo(me[$ELEMENT]);\n\t\t\t}\n\n\t\t\t$form.submit();\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/modal-container/modal-container.html',[],function() { return function template(data) { var o = \"<div class=\\\"modal fade ets-uo-modal ets-uo-modal-loading\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"Unit Overview\\\" aria-hidden=\\\"true\\\">\\n\\t<div class=\\\"modal-dialog\\\">\\n\\t\\t<div class=\\\"modal-content\\\">\\n\\t\\t\\t<button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-hidden=\\\"true\\\">&times;</button>\\n\\t\\t\\t<!--<div data-weave=\\\"school-ui-shared/widget/unit-overview/container/main(templateUnitId)\\\"></div>-->\\n\\t\\t</div>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-shared/widget/unit-overview/modal-container/main',[\n\t'when',\n\t'jquery',\n\t\"jquery.gudstrap\",\n\t'troopjs-ef/component/widget',\n\t'template!./modal-container.html'\n], function (when, $, $GUD, Widget, tModalContainer) {\n\t'use strict';\n\n\tvar $ELEMENT = '$element';\n\tvar SEL_MODAL = \".modal\";\n\tvar SEL_MODAL_CONTENT = \".modal-content\";\n\n\treturn Widget.extend(function (element, path, templateUnitId) {\n\t\tthis._templateUnitId = templateUnitId;\n\t\tthis._hideWorldList = Boolean(element.data('hideWorldList'));\n\t}, {\n\t\t'sig/start': function () {\n\t\t\tvar me = this;\n\n\t\t\treturn me.html(tModalContainer).then(function () {\n\t\t\t\tvar $container = $('<div></div>', {\n\t\t\t\t\t\"data-weave\": \"school-ui-shared/widget/unit-overview/container/main(templateUnitId)\",\n\t\t\t\t\t\"data\": {\n\t\t\t\t\t\t\"templateUnitId\": me._templateUnitId,\n\t\t\t\t\t\t\"hideWorldList\": me._hideWorldList\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn $container.appendTo(me[$ELEMENT].find(SEL_MODAL_CONTENT)).weave().then(function () {\n\t\t\t\t\tme[$ELEMENT].find(SEL_MODAL).modal({\n\t\t\t\t\t\tbackdrop: 'static'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/unit-info/unit-info.html',[],function() { return function template(data) { var o = \"\";\nvar data = data || {};\nvar isGE = data.isGE;\nvar level = data.level || {};\nvar unit = data.unit || {};\nvar lessons = data.lessons || [];\no += \"\\n<div class=\\\"ets-uo-unit-image\\\">\\n\\t<img src=\\\"\" + unit.unitImage.url + \"\\\"/>\\n</div>\\n<div class=\\\"ets-uo-unit-fields\\\">\\n\\t<div class=\\\"ets-uo-course-location\\\">\\n\\t\\t<span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"126799\\\" data-text-en=\\\"Level\\\"></span>\\n\\t\\t<span class=\\\"ets-uo-level-no\\\">\" +(isGE ? level.levelNo : level.levelName)+ \"</span>\\n\\t\\t<span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"126802\\\" data-text-en=\\\"Unit\\\"></span>\\n\\t\\t<span class=\\\"ets-uo-unit-no\\\">\" +unit.unitNo+ \"</span>\\n\\t</div>\\n\\t<div class=\\\"ets-uo-unit-name\\\">\" +unit.unitName+ \"</div>\\n\\t<div class=\\\"ets-uo-unit-desc\\\">\" +(unit.unitDesc || '')+ \"</div>\\n</div>\\n<div class=\\\"ets-uo-unit-task\\\">\\n\\t<div data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"470915\\\" data-text-en=\\\"Tasks\\\"></div>\\n\\t<ul>\\n\\t\\t\"; lessons.forEach(function (lesson) { o += \"\\n\\t\\t<li>\" + lesson.lessonName + \"</li>\\n\\t\\t\"; }); o += \"\\n\\t</ul>\\n</div>\"; return o; }; });\n",
    "define('school-ui-shared/widget/unit-overview/unit-info/main',[\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/enum/course-type\",\n\t'template!./unit-info.html'\n], function (Widget, courseType, tUnitInfo) {\n\t'use strict';\n\n\treturn Widget.extend(function (element, path, data) {\n\t\tvar me = this;\n\t\tvar unitInfo = data;\n\n\t\tvar level = unitInfo.level;\n\t\tunitInfo.isGE = courseType.isGECourse(level);\n\n\t\treturn me.html(tUnitInfo, unitInfo);\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/unit-overview/word-list/word-list.html',[],function() { return function template(data) { var o = \"\";\nvar wordList = data || {};\nvar words = wordList.words;\no += \"\\n<h2 class=\\\"ets-uo-word-list-title\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"110570\\\" data-text-en=\\\"Vocabulary\\\"></h2><!-- only visible for pdf export -->\\n<table>\\n\\t<thead>\\n\\t<tr>\\n\\t\\t<th class=\\\"ets-uo-word-list-column-player\\\"></th>\\n\\t\\t<th class=\\\"ets-uo-word-list-column-vocabulary\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"126660\\\" data-text-en=\\\"Vocabulary\\\"></th>\\n\\t\\t<th class=\\\"ets-uo-word-list-column-phonetic\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"135412\\\" data-text-en=\\\"Phonetic spelling\\\"></th>\\n\\t\\t<th class=\\\"ets-uo-word-list-column-partofspeech\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"126662\\\" data-text-en=\\\"Part of speech\\\"></th>\\n\\t\\t<th class=\\\"ets-uo-word-list-column-translation\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"126661\\\" data-text-en=\\\"Translation / definition\\\"></th>\\n\\t</tr>\\n\\t</thead>\\n\\t<tbody>\\n\\t\\t\"; words.forEach(function(wordItem) { o += \"<tr style=\\\"page-break-inside: avoid;\\\">\\n\\t\\t\\t<td class=\\\"ets-uo-word-list-column-player\\\">\\n\\t\\t\\t\\t<audio src=\\\"\" + wordItem.audioPath + \"\\\" preload=\\\"none\\\"></audio>\\n\\t\\t\\t</td>\\n\\t\\t\\t<td class=\\\"ets-uo-word-list-column-vocabulary\\\">\" + wordItem.word + \"</td>\\n\\t\\t\\t<td class=\\\"ets-uo-word-list-column-phonetic\\\">\\n\\t\\t\\t\\t\";if (wordItem.pronunciation.uk) {o += \"\\n\\t\\t\\t\\t\\t[<span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"135413\\\" data-text-en=\\\"UK\\\"></span>]\" + wordItem.pronunciation.uk + \"\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t\\t\";if (wordItem.pronunciation.us) {o += \"\\n\\t\\t\\t\\t\\t[<span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"135414\\\" data-text-en=\\\"US\\\"></span>]\" + wordItem.pronunciation.us + \"\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t</td>\\n\\t\\t\\t<td class=\\\"ets-uo-word-list-column-partofspeech\\\">\" + wordItem.partofSpeech + \"</td>\\n\\t\\t\\t<td class=\\\"ets-uo-word-list-column-translation\\\">\" + wordItem.translation + \"</td>\\n\\t\\t</tr>\"; }); o += \"\\n\\t</tbody>\\n</table>\"; return o; }; });\n",
    "define('school-ui-shared/widget/unit-overview/word-list/main',[\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'mediaelement-and-player',\n\t'template!./word-list.html'\n], function (when, Widget, mejs, tWordList) {\n\t'use strict';\n\n\tvar $ELEMENT = '$element';\n\tvar CLS_WORD_SELECTED = 'etc-unit-overview-word-selected';\n\n\treturn Widget.extend(function (element, path, data) {\n\t\tvar wordList = data;\n\t\tvar me = this;\n\t\treturn me.html(tWordList, wordList).then(function () {\n\t\t\tvar mediaelementInits = [];\n\t\t\tme[$ELEMENT].find('audio').each(function (index, audio) {\n\t\t\t\tmediaelementInits.push(when.promise(function (resolve, reject) {\n\t\t\t\t\tnew MediaElementPlayer(audio, {\n\t\t\t\t\t\tpauseOtherPlayers: true,\n\t\t\t\t\t\talwaysShowControls: true,\n\t\t\t\t\t\tplaypauseText: '',\n\t\t\t\t\t\tmode: 'native',\n\t\t\t\t\t\tfeatures: ['playpause'],\n\t\t\t\t\t\tdefaultAudioWidth: 20,\n\t\t\t\t\t\tdefaultAudioHeight: 20,\n\t\t\t\t\t\tsuccess: function (mediaElement, domObject, player) {\n\t\t\t\t\t\t\tmediaElement.addEventListener('play', function () {\n\t\t\t\t\t\t\t\tthis.currentTime = 0;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: reject\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t});\n\n\t\t\treturn when.all(mediaelementInits);\n\t\t});\n\t}, {\n\t\t'dom:tr/click': function (evt) {\n\t\t\tvar $tr = $(evt.currentTarget);\n\t\t\t$tr.addClass(CLS_WORD_SELECTED);\n\t\t\t$tr.siblings().removeClass(CLS_WORD_SELECTED);\n\t\t}\n\t});\n});\n\n",
    "/* vector images support for ie8 & modern browsers\n * use in this way : \"<div data-weave=\"school-ui-progress-report/utils/vector(\"filename\", \"width\", \"height\")\"></div>\"\n * exp : \"<div data-weave=\"school-ui-progress-report/utils/vector(check, 50, 50)\"></div>\"\n */\n\ndefine('school-ui-shared/widget/vector',[\n\t\"require\",\n\t\"when\",\n\t\"poly\",\n\t\"school-ui-shared/utils/browser-check\",\n\t\"troopjs-ef/component/widget\"\n], function (localRequire, when, poly, browserCheck, Widget) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\n\tvar PREFIX_TEMPLATE = \"template!\";\n\tvar SUFFIX_SVG = \"svg\";\n\tvar SUFFIX_VML = \"vml\";\n\n\tvar REG_SVG_WIDTH = /(\\<svg[^\\<]*width=\\\")(\\S*)(\\\"[^\\<]*\\>)/gmi;\n\tvar REG_SVG_HEIGHT = /(\\<svg[^\\<]*height=\\\")(\\S*)(\\\"[^\\<]*\\>)/gmi;\n\tvar REG_VML_WIDTH = /<v[^>]*width[^>]?:[^>]?([\\d]+)[^>]*>/mi;\n\tvar REG_VML_HEIGHT = /<v[^>]*height[^>]?:[^>]?([\\d]+)[^>]*>/mi;\n\n\t//for ie8 we use vml to display vector image\n\tvar VECTOR_TYPE = browserCheck.browser === \"msie\" &&\n\tparseInt(browserCheck.version) === 8 ? SUFFIX_VML : SUFFIX_SVG;\n\n\treturn Widget.extend(function (path, $element, vector, width, height) {\n\t\tvar me = this;\n\n\t\tme.width = width;\n\t\tme.height = height;\n\t\tme.vector = vector;\n\n\t\t//for optimize vml performance in ie8,\n\t\t//we hide element before append the vml, and display inline-block after appending\n\t\tme[$ELEMENT].css(\"display\", \"none\");\n\t}, {\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\tif (me.width && me.height && me.vector) {\n\t\t\t\treturn when.promise(function (resolve) {\n\t\t\t\t\t// use template plugin to load vector,\n\t\t\t\t\t// and then we can pack them together in grunt\n\t\t\t\t\tlocalRequire(\n\t\t\t\t\t\t[PREFIX_TEMPLATE + me.vector + \".\" + VECTOR_TYPE],\n\t\t\t\t\t\tresolve\n\t\t\t\t\t);\n\t\t\t\t}).then(me.render.bind(me));\n\t\t\t}\n\n\t\t\treturn when.resolve();\n\t\t},\n\t\t\"render\": function (template) {\n\t\t\tvar me = this;\n\t\t\tvar html = template();\n\t\t\tvar width;\n\t\t\tvar height;\n\n\t\t\tif (VECTOR_TYPE === SUFFIX_VML) {\n\t\t\t\twidth = html.match(REG_VML_WIDTH);\n\t\t\t\theight = html.match(REG_VML_HEIGHT);\n\t\t\t\tif (width[1] && height[1]) {\n\t\t\t\t\t//can't use a top width and height in vml to set the size, so we use zoom here\n\t\t\t\t\t//don't use jquery function here, because ignore zoom will be ignored...\n\t\t\t\t\thtml = \"<div style='zoom:\" + Math.min(parseInt(me.height, 10) / height[1], parseInt(me.width, 10) / width[1]) + \"'>\" + html + \"</div>\";\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//replace height and width for svg element\n\t\t\t\thtml = html.replace(\n\t\t\t\t\tREG_SVG_WIDTH,\n\t\t\t\t\tfunction (match, $1, $2, $3) {\n\t\t\t\t\t\treturn $1 + me.width + \"px\" + $3;\n\t\t\t\t\t});\n\t\t\t\thtml = html.replace(\n\t\t\t\t\tREG_SVG_HEIGHT,\n\t\t\t\t\tfunction (match, $1, $2, $3) {\n\t\t\t\t\t\treturn $1 + me.height + \"px\" + $3;\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tme[$ELEMENT].html(html);\n\t\t\t//show and set the width and height\n\t\t\tme[$ELEMENT].css({\n\t\t\t\t\"display\": \"inline-block\",\n\t\t\t\t\"width\": me.width,\n\t\t\t\t\"height\": me.height,\n\t\t\t\t\"line-height\": 0,\n\t\t\t\t\"vertical-align\": \"middle\",\n\t\t\t\t\"overflow\": \"hidden\"\n\t\t\t});\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-shared/widget/video-player/video-player.html',[],function() { return function template(data) { var o = \"\";\n\tvar videoUrl = data.video && data.video.url || \"\";\n\tvar videoLowQualityUrl = data.video && data.video.lowQualityUrl || \"\";\n\tvar posterUrl = data.poster && data.poster.url || \"\";\n\tvar customClass = data.customClass || \"\";\no += \"\\n<video class=\\\"ets-vp \" +customClass+ \"\\\" width=\\\"640\\\" height=\\\"360\\\" playsinline=\\\"playsinline\\\" \"; if (posterUrl && posterUrl.indexOf(\".jpg\") > 0) { o += \"poster=\\\"\" +posterUrl+ \"\\\"\"; } o += \" preload=\\\"none\\\">\\n\\t<source type=\\\"video/mp4\\\" src=\\\"\" +videoUrl+ \"\\\" data-switch-src=\\\"\" +videoLowQualityUrl+ \"\\\" />\\n</video>\"; return o; }; });\n",
    "define('school-ui-shared/widget/video-player/main',[\n\t\"when\",\n\t\"logger\",\n\t\"../../utils/performance\",\n\t\"mediaelement-plugin-ef\",\n\t\"troopjs-ef/component/widget\",\n\t\"school-ui-shared/utils/browser-check\",\n\t\"school-ui-shared/utils/media\",\n\t\"school-ui-shared/utils/hub-memory\",\n\t\"school-ui-shared/utils/location-helper\",\n\t\"template!./video-player.html\"\n], function videoPlayerModule(\n\twhen,\n\tLogger,\n\tperformanceUtils,\n\tmejs,\n\tWidget,\n\tbrowserCheck,\n\tMedia,\n\tHubMemory,\n\tLocationHelper,\n\ttTemplate\n) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\tvar $ = mejs.$;\n\n\tvar CLS_VP_PLAYED = \"ets-vp-played\";\n\n\tvar SEL_VP = \".ets-vp\";\n\tvar SEL_OVERLAY_PLAY = \".mejs-overlay-play\";\n\tvar SEL_CONTROLS_BUTTON_PLAYPAUSE = \"mejs-controls .mejs-playpause-button\";\n\tvar SEL_CONTAINTER = \".mejs-container\";\n\n\tvar ME_DEFAULT_FEATURES_BEFORE = [\"playpause\", \"current\", \"progress\", \"duration\", \"IgnoreKeyEvent\"];\n\tvar ME_DEFAULT_FEATURES_AFTER = [\"volume\"];\n\n\tvar MODE_NATIVE = \"native\";\n\n\tvar logIdGenerator = 1000;\n\n\tfunction mediaPlayerLog(message) {\n\t\tvar me = this;\n\t\tvar mode = (me.videoInstance && me.videoInstance.media) ? me.videoInstance.media.pluginType : 'unknown';\n\t\tvar finalMessage = me._logPrefix + ' mode=' + mode + ' ' + message;\n\t\tLogger.log(finalMessage);\n\t}\n\n\tfunction initPlayer() {\n\t\tvar me = this;\n\t\tvar customOptions = $.extend(true, {}, me._options);\n\n\t\t//init mep\n\t\tvar translationPromise = getTranslations.call(me);\n\t\tvar renderPromise = me.html(tTemplate, me._videoInfo);\n\n\t\treturn when.all([\n\t\t\ttranslationPromise,\n\t\t\trenderPromise\n\t\t]).spread(function (translations) {\n\t\t\treturn me._finalized ?\n\t\t\t\twhen.resolve() :\n\t\t\t\tinitMediaelementPlayer.call(me, customOptions, translations, me._onSuccess);\n\t\t}).catch(function (ex) {\n\t\t\tex.player && ex.player.controls && ex.player.controls.show();\n\n\t\t\tvar message = 'Error.Init ';\n\t\t\tif (ex.canPlayType) {\n\t\t\t\tmessage += 'CanPlayType=' + ex.canPlayType('video/mp4');\n\t\t\t}\n\t\t\telse if (ex.error) {\n\t\t\t\tmessage += ex.error;\n\t\t\t}\n\t\t\telse if (ex.message) {\n\t\t\t\tmessage += ex.message;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmessage += String(ex);\n\t\t\t}\n\t\t\tme._logDefer.resolver.resolve(message);\n\t\t\tthrow ex;\n\t\t});\n\t}\n\n\tfunction wrapPlayToHandleRejection(play) {\n\t\treturn function playWithHandledRejection() {\n\t\t\tvar mediaElement = this;\n\t\t\tvar promise = play.apply(mediaElement, arguments);\n\t\t\tif (promise) {\n\t\t\t\twhen(promise).catch(function (error) {\n\t\t\t\t\tif (typeof DOMException !== 'undefined' && error instanceof DOMException) {\n\t\t\t\t\t\tif (error.code === DOMException.ABORT_ERR) {\n\t\t\t\t\t\t\t// ignore\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar nodes = [mediaElement].concat(\n\t\t\t\t\t\tArray.prototype.slice.call(mediaElement.querySelectorAll('source')));\n\t\t\t\t\tvar src = nodes.map(function (node) {\n\t\t\t\t\t\treturn node.src;\n\t\t\t\t\t}).join(', ');\n\t\t\t\t\tLogger.log('Video play() exception: ' + String(error) + '\\n' + src);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promise;\n\t\t};\n\t}\n\n\tfunction initMediaelementPlayer(customOptions, translations, cbOnSuccess) {\n\t\tvar me = this;\n\n\t\treturn when.promise(function (resolve, reject) { //handle exceptions\n\t\t\tvar videoOptions = {\n\t\t\t\tmode: MODE_NATIVE,\n\t\t\t\tplugins: [],\n\t\t\t\tpauseOtherPlayers: (typeof customOptions.pauseOtherPlayers === 'boolean' ? customOptions.pauseOtherPlayers : true),\n\t\t\t\talwaysShowControls: true,\n\t\t\t\tstartVolume: 0.8,\n\t\t\t\tsuccess: function (mediaElement, domElement, player) {\n\t\t\t\t\tmediaElement.play = wrapPlayToHandleRejection(mediaElement.play);\n\n\t\t\t\t\tvar $container = $(domElement).closest(SEL_CONTAINTER);\n\n\t\t\t\t\t//add attribute data-at-id for automation testing\n\t\t\t\t\tvar $playButton = $container.find(SEL_OVERLAY_PLAY);\n\t\t\t\t\t$playButton.attr(\"data-at-id\", \"btn-video-start\");\n\n\t\t\t\t\tvar $playPauseButton = $container.find(SEL_CONTROLS_BUTTON_PLAYPAUSE);\n\t\t\t\t\t$playPauseButton.attr(\"data-at-id\", \"btn-video-playpause\");\n\n\t\t\t\t\tmediaElement.addEventListener(\"error\", function (e) {\n\t\t\t\t\t\tvar message = e.message || Media.findErrorName(mediaElement.error) || String(e);\n\t\t\t\t\t\tvar url = e.src || (me._videoInfo.video && me._videoInfo.video.url) || '';\n\n\t\t\t\t\t\t//for Frontend log\n\t\t\t\t\t\tvar mode = mediaElement.pluginType || \"\";\n\t\t\t\t\t\tLogger.log(\"Error loading video \" + mode + \" for \" + url + \": \" + message);\n\n\t\t\t\t\t\t//for Media log\n\t\t\t\t\t\tvar perfLog = performanceUtils.getLogMessage();\n\t\t\t\t\t\tif (perfLog) {\n\t\t\t\t\t\t\tmediaPlayerLog.call(me, 'Error.Media.Perfs ' + perfLog);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmediaPlayerLog.call(me, 'Error.Media ' + message);\n\t\t\t\t\t}, false);\n\n\t\t\t\t\tmediaElement.addEventListener('play', function handleFirstPlay() {\n\t\t\t\t\t\tme[$ELEMENT].addClass(CLS_VP_PLAYED);\n\t\t\t\t\t\tmediaElement.removeEventListener('play', handleFirstPlay);\n\t\t\t\t\t}, false);\n\n\t\t\t\t\tme._logDefer.resolver.resolve();\n\n\t\t\t\t\tcbOnSuccess && cbOnSuccess.apply(me, arguments);\n\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\terror: reject\n\t\t\t};\n\n\t\t\tcustomOptions.features = ME_DEFAULT_FEATURES_BEFORE.concat(customOptions.features || []).concat(ME_DEFAULT_FEATURES_AFTER);\n\n\t\t\tme.videoInstance = new mejs.MediaElementPlayer(\n\t\t\t\tme[$ELEMENT].find(SEL_VP)[0],\n\t\t\t\t$.extend({}, videoOptions, customOptions, translations)\n\t\t\t);\n\t\t});\n\t}\n\n\tfunction getTranslations() {\n\t\tvar me = this;\n\n\t\tvar translations = {\n\t\t\tplaypauseText: '470485',\n\t\t\tmuteText: '469863',\n\t\t\ttracksText: '469864',\n\t\t\tfullscreenText: '470489',\n\t\t\tqualityText: '469865',\n\t\t\ttracksOnText: '480847',\n\t\t\ttracksOffText: '480848',\n\t\t\toutOfTimeRangeText: '468588'\n\t\t};\n\n\t\tvar blurbPrefix = \"blurb!\";\n\t\tvar translationNames = Object.keys(translations);\n\t\tvar blurbIds = [];\n\n\t\ttranslationNames.forEach(function (name, index) {\n\t\t\t//use keys[index] instead of key.push to make code easier to understand\n\t\t\tblurbIds[index] = blurbPrefix + translations[name];\n\t\t});\n\n\t\treturn me.query(blurbIds).then(function (blurbs) {\n\t\t\tblurbs.forEach(function (blurb, index) {\n\t\t\t\ttranslations[translationNames[index]] = blurb.translation;\n\t\t\t});\n\t\t\treturn translations;\n\t\t});\n\t}\n\n\tfunction updateLogPrefix() {\n\t\tvar me = this;\n\t\tvar $el = me[$ELEMENT];\n\n\t\tvar course = HubMemory.readMemory('load/course');\n\t\tvar level = HubMemory.readMemory('load/level');\n\t\tvar activity = HubMemory.readMemory('load/activity');\n\t\tvar activityOption = $el.closest('.ets-act-bd-activity').data('option');\n\t\tvar activityContent = activityOption && activityOption.activityContent;\n\n\t\tvar courseTypeCode = course && course.courseTypeCode || '';\n\t\tvar levelId = level && (level.templateLevelId || level.id) || '';    //templateLevelId for platform 2, id for platform 1\n\t\tvar levelCode = level && (level.levelCode || level.levelNo) || '';\n\t\tvar activityId = activity && (activity.templateActivityId || activity.id) || '';    //templateActivityId for platform 2, id for platform 1\n\t\tvar activityTemplateCode = activityContent && activityContent.templateCode || '';\n\t\tvar mediaUrl = me._videoInfo.video && me._videoInfo.video.url.replace(/ /g, '%20') || '';\n\t\tvar browser = browserCheck.browser + '/' + parseInt(browserCheck.actualVersionOfCompatibility || browserCheck.version, 10);\n\t\tif (!me._logid) {\n\t\t\tme._logid = (new Date().getTime()) + '.' + (logIdGenerator++);\n\t\t}\n\n\t\tme._logPrefix = [\n\t\t\t'NewMediaPlayer video',\n\t\t\t'courseTypeCode=' + courseTypeCode,\n\t\t\t'level=' + levelId,\n\t\t\t'levelCode=' + courseTypeCode + '_' + levelCode,\n\t\t\t'activity=' + activityId,\n\t\t\t'activityType=' + activityTemplateCode,\n\t\t\t'url=' + mediaUrl,\n\t\t\t'browser=' + browser,\n\t\t\t'logid=' + me._logid\n\t\t].join(' ');\n\t}\n\n\treturn Widget.extend(\n\t\t/**\n\t\t * Constructor\n\t\t * @param {Object}    $el\n\t\t * @param {Object}    module\n\t\t * @param {Object}    videoInfo (video, scripts, stopPoints)\n\t\t * @param {Function}  onSuccess\n\t\t * @param {Object}    options\n\t\t */\n\t\tfunction Ctor($el, module, videoInfo, options, onSuccess) {\n\t\t\tvar me = this;\n\t\t\tme._videoInfo = videoInfo;\n\t\t\tme._onSuccess = onSuccess;\n\t\t\tme._options = options;\n\t\t\tme._finalized = false;\n\t\t\tme.videoInstance = null;\n\t\t\tupdateLogPrefix.call(me);\n\n\t\t\tme._logDefer = when.defer();\n\t\t\tme._logDefer.promise.then(function (message) {\n\t\t\t\tmessage && mediaPlayerLog.call(me, message);\n\t\t\t});\n\t\t}, {\n\t\t\t\"sig/start\": function onStart() {\n\t\t\t\tvar me = this;\n\t\t\t\tinitPlayer.call(me);\n\t\t\t},\n\t\t\t\"sig/stop\": function () {\n\t\t\t\tvar me = this;\n\t\t\t\tme._finalized = true;\n\t\t\t\tif (me.videoInstance) {\n\t\t\t\t\tme.videoInstance.pause();\n\t\t\t\t\tme.videoInstance.remove();\n\t\t\t\t\tme.videoInstance = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"play\": function () {\n\t\t\t\tvar me = this;\n\t\t\t\tme.videoInstance.media.play();\n\t\t\t}\n\t\t});\n});\n\n"
  ]
}