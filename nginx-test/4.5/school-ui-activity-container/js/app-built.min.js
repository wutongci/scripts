// Englishtown_Efekta_12_Activity_Container - 2018.44.1 @ 2018-11-15 12:27:39

define("school-ui-activity-container/util/ccl-cache-server",[],function(){return"http:"===location.protocol?"ccl!'configuration.servers.cache'":"ccl!'configuration.servers.cachesecure'"}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-container/activity-container.html",[],function(){return function(a){return'<div class="ets-ui-acc" data-at-page-id="sp-activity-container">\n\t<div class="ets-ui-acc-hd">\n\t\t<div class="ets-ui-acc-hd-main">\n\t\t\t<div class="ets-ui-acc-step-title" data-weave="school-ui-activity-container/widget/activity/step-title/main"></div>\n\t\t\t<div class="ets-ui-acc-step-nav" data-weave="school-ui-activity-container/widget/activity/navigation/main"></div>\n\t\t\t<div class="ets-ui-acc-btn-close" data-action="close" data-at-id="btn-close"></div>\n\t\t</div>\n\t</div>\n\t<div class="ets-ui-acc-bd">\n\t\t<div class="ets-ui-acc-bd-main">\n\t\t\t\x3c!--<div class="ets-ui-step-summary" data-weave="school-ui-activity-container/widget/activity/step-summary/main"></div>--\x3e\n\t\t\t\x3c!--<div class="ets-activity" data-weave="school-ui-activity-container/widget/activity/activity-manager/main"></div>--\x3e\n\t\t</div>\n\t</div>\n\n\t<div class="ets-ui-acc-ft">\n\t\t<div class="ets-ui-acc-ft-main" data-weave="school-ui-activity-container/widget/activity/bottom-bar/main"></div>\n\t</div>\n\n\t<div class="ets-ui-acc-loading" data-at-id="global-loading">\n\t\t<div class="ets-ui-acc-loading-main">\n\t\t\t<div class="ets-ui-acc-loading-backdrop"></div>\n\t\t\t<div class="ets-ui-acc-loading-content">\n\t\t\t\t<div class="ets-ui-acc-loading-icon"><span></span></div>\n\t\t\t\t<div class="ets-ui-acc-loading-timeout">\n\t\t\t\t\t<div class="ets-bd">\n\t\t\t\t\t\t<h3><span data-weave="troopjs-ef/blurb/widget" data-blurb-id="463704" data-text-en="An error has occurred."></span></h3>\n\t\t\t\t\t\t<p><span data-weave="troopjs-ef/blurb/widget" data-blurb-id="463688" data-text-en="Please try again later."></span></p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ets-ft">\n\t\t\t\t\t\t<div class="ets-btn ets-btn-purple ets-btn-shadowed"><span data-weave="troopjs-ef/blurb/widget" data-blurb-id="462940" data-text-en="Close"></span></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}}),define("school-ui-activity-container/widget/activity/activity-container/main",["jquery","mv!jquery#troopjs-1.0","troopjs-ef/component/widget","troopjs-browser/loom/config","troopjs-browser/loom/weave","troopjs-browser/route/uri","school-ui-shared/utils/progress-state","school-ui-shared/utils/typeid-parser","poly/array","logger","when","template!./activity-container.html"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(b,c){var e=this,f=a("<div>").addClass(c).attr(d.weave,b);return e[D].find(M).empty().html(f),e.weave()}function n(){var a=this,b=k.defer();return a[D].hasClass(Q)?void b.resolve():(v(!0),a[D].find(L).css("top",t().top),a[D].removeClass(R),setTimeout(function(){a[D].addClass(Q),setTimeout(function(){x.call(a),a.publish(W),a.publish(Y),b.resolve()},G)},0),b.promise)}function o(){var a=this,b=k.defer();return setTimeout(function(){a[D].removeClass(Q),a[D].find(L).css({height:0,top:t().top,overflow:"hidden"}),y.call(a),setTimeout(function(){a[D].addClass(R),v(!1),a.publish(Z),b.resolve()},G)},0),b.promise}function p(){var a=this;return a[D].find(I).height()+a[D].find(J).height()+a[D].find(K).height()}function q(){var a=this;return Math.round((s().height-p.call(a))/2)>0?Math.round((s().height-p.call(a))/2):0}function r(){var a=this;a[D].find(L).css({top:q.call(a)})}function s(){return{height:aa.height(),width:aa.width()}}function t(){return{left:aa.width()/2,top:aa.height()/2}}function u(){var a=this;aa.unbind("resize",r.call(a)).bind("resize",r.call(a))}function v(a){a?ba.css("overflow","hidden"):ba.css("overflow","auto")}function w(){var a=this,b=a[D].find(L),c=p.call(a),d=q.call(a);b.height()!=c||b.offset().top!=d?b.css({height:c,top:d,overflow:"hidden"}):b.css({overflow:"visible"})}function x(){var a=this;y.call(a),a[F]=setInterval(function(){w.call(a)},H)}function y(){var a=this;a[F]&&clearInterval(a[F])}function z(a){var b,c=this;if(a){switch(a){case"summary":b=m.call(c,_,V);break;default:c[D].find(P).length<=0&&(b=m.call(c,$,U))}b&&b.then(function(){c.publish(X)})}else c[D].find(M).empty()}function A(a,b){var c=this,d=c[D],e=d.find(N),f=d.find(L),g=d.find(O);f.addClass(S),e.attr("data-at-status","shown"),clearTimeout(c.loadingTimeout),a&&(c.loadingTimeout=setTimeout(function(){e.addClass(T),g.bind("click",function(){f.removeClass(S),e.removeClass(T),g.unbind("click")}),b&&b()},a))}function B(){var a=this;if(!a.interfaceLoading){var b=a[D],c=b.find(N);b.find(L).removeClass(S),c.attr("data-at-status","unshown"),c.removeClass(T),clearTimeout(a.loadingTimeout)}}function C(a,b){var c=this;if(a&&b&&(z.call(c,b.activity),b.step&&!b.activity&&"summary"!=b.activity))return c.query(a.id+".children.progress").spread(function(a){var b,d=0;a.children.every(function(a,b){return!!g.hasPassed(a.progress.state)||(d=b,!1)}),b=h.parseId(a.children[d].id),c.publish("load",{activity:b})})}var D="$element",E="_step",F="_retryResizeTimer",G=400,H=200,I=".ets-ui-acc-hd",J=".ets-ui-acc-bd",K=".ets-ui-acc-ft",L=".ets-ui-acc",M=".ets-ui-acc-bd-main",N=".ets-ui-acc-loading",O=".ets-ui-acc-loading .ets-btn",P=".ets-activity",Q="ets-acc-open",R="ets-none",S="ets-loading",T="ets-timeout",U="ets-activity",V="ets-ui-step-summary",W="activity-container/show/loading",X="activity-container/hide/loading",Y="activity/opened",Z="activity/closed",$="school-ui-activity-container/widget/activity/activity-manager/main",_="school-ui-activity-container/widget/activity/step-summary/main",aa=a(window),ba=a("html");return c.extend({"sig/start":function(){var a=this;return u.call(a),a.html(l).spread(function(){var c=f(document.location.href),d=Boolean(c.query&&void 0!==c.query.atpreview);b(a[D].find(".ets-ui-acc-act-header-notification")).attr("data-weave","headerfooter/widget/alert/courseware/main").weave(),a[D].find(L).css({top:t().top}),a[D].scroll(function(){a.publish("activity-container/scroll")}),a[D].toggleClass("ets-atpreview",d)})},"sig/finalize":function(){b(this[D].find(".ets-ui-acc-act-header-notification")).remove()},"hub:memory/load/lesson":function(a){var b=this;a&&(b._lesson=a)},"hub:memory/load/step":function(a){var b=this;a?(b._stepId=a.id,b[D].find(M).children().length>0?C.call(b,b[E]=a,b._results):n.call(b).then(function(){C.call(b,b[E]=a,b._results)})):o.call(b).then(function(){delete b[E],b[D].find(M).empty()})},"hub:memory/load/activity":function(a){var b=this;a&&(b._activity=a)},"hub:memory/load/results":function(a){var b=this;a&&C.call(b,b[E],b._results=a)},"hub/activity-container/show/loading":function(a){A.call(this,2e4,function(){a&&j.log("Activity error: "+h.parseId(a)+" loading timeout")})},"hub/activity-container/hide/loading":function(){B.call(this)},"hub/activity-container/tryAgain":function(){var a=this;a[E]&&a[E].children&&a.publish("load",{activity:h.parseId(a[E].children[0].id)})},"hub/activity-container/nextStep":function(){var a,b=this,c=b[E].id,d=b._lesson.children;d.every(function(b,d){return b.id!==c||(a=d,!1)}),void 0!=a&&a+1!=d.length&&(delete b[E],b.publish("load",{step:h.parseId(d[a+1].id),activity:void 0}))},"hub/activity-container/nextActivity":function(){var a,b=this,c=b._activity.id,d=b[E].children;d.every(function(b,d){return b.id!=c||(a=d,!1)}),void 0!=a&&(a+1!=d.length?b.publish("load",{activity:h.parseId(d[a+1].id)}):b.publish("load",{activity:"summary"}))},"hub/activity-container/close":function(){var b=this;b.publish("school/interface/get/activity-container/closeHash",{}).spread(function(c){b.publish("load",a.extend({step:void 0,activity:void 0},c))})},"hub/activity-container/resize":function(){var a=this;w.call(a)},"hub/school/interface/activity-container/show/loading":function(a){var b=this;b.interfaceLoading=!0,A.call(b),a.ensure(function(){b.interfaceLoading=!1,B.call(b)})},"dom:.ets-ui-acc-btn-close/click":function(){this.publish("activity-container/close")}})}),define("school-ui-activity-container/widget/activity/activity-manager/data-bridge",["jquery","troopjs-browser/loom/config","troopjs-browser/loom/weave","when","poly/array","troopjs-ef/component/ef","troopjs-core/pubsub/hub","school-ui-shared/utils/feature-access","logger","underscore","asr-core","school-ui-shared/enum/abtest-query-string"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(b){a(s).remove();var c="school-ui-activity/activity/",e=d.resolve(),k=d.resolve();switch(b.templateCode){case"SeqParVer":var m=j.filter(b.content.sequences,function(a){return a.isLock});b.content.sequences=n(j.filter(b.content.sequences,function(a){return!a.isLock}),b.filterOptions,!0),a.each(m,function(a,c){b.content.sequences.splice(c.position-1,0,c)}),c+="sequencing-paragraph-vertical/main";break;case"SeqWordHor":a.each(b.content.phrases,function(b,c){a.each(c.words,function(a,b){b._id=c.blanks[a]._id})}),b.content.phrases=n(b.content.phrases,b.filterOptions,!0,"words"),c+="sequencing-word-horizontal/main";break;case"SeqWordVer":var r=j.filter(b.content.sequences,function(a){return a.isLock});b.content.sequences=n(j.filter(b.content.sequences,function(a){return!a.isLock}),b.filterOptions,!0),a.each(r,function(a,c){b.content.sequences.splice(c.position-1,0,c)}),c+="sequencing-word-vertical/main";break;case"SeqImg":b.content.sequences=n(b.content.sequences,b.filterOptions,!0,"options"),c+="sequencing-image/main";break;case"MatPicToAud":c+="matching-pic-audio/main";break;case"Writing":b.isGraded&&h.hasWritingClassFeature()?c+="writing-challenge-exercise/main":c+="writing-challenge-practice/main";break;case"MatTxtToPic":c+="matching-text-pic/main";break;case"MatTxtToTxt":c+="matching-text-text/main";break;case"MatTxtToLongTxt":c+="matching-text-long-text/main";break;case"MulChoTxt":c+="multiple-choice-text/main";break;case"MulChoMedia":c+="multiple-choice-media/main";break;case"FlaPre":case"FlaPreFlip":b.content.flashCards=n(b.content.flashCards,b.filterOptions,!0,"options"),c+="flashcard-presentation/main";break;case"MulSelTxt":c+="multiple-select-text/main";break;case"MulSelMedia":c+="multiple-select-media/main";break;case"MoviePre":c+="movie-presentation/continuousMovie",o(b.content.video);break;case"MovieQuestion":b.content.questions=n(b.content.questions,b.filterOptions,!1,"options"),c+="movie-question/main",o(b.content.video);break;case"TypingTable":b.content.items=n(b.content.items,b.filterOptions,!0),c+="typing-table/main";break;case"TypingDragDrop":b.content.items=n(b.content.items,b.filterOptions,!0),c+="typing-drag-drop/main";break;case"TypingGapFill":b.content.items=n(b.content.items,b.filterOptions,!0),c+="typing-gap-fill/main";break;case"GroupMove":case"GroupCopy":c+="grouping/main";break;case"LngPre":c+="language-presentation/main";break;case"FlaExe":b.content.flashCards=n(b.content.flashCards,b.filterOptions,!0,"options"),b.hasNoAsrFallback=!0,c+="flashcard-exercise/main",e=p(b.content.flashCards,"pronsXML");break;case"LngComp":b.content.phrases=n(b.content.phrases,b.filterOptions,!0,"options"),e=p(b.content.phrases,"pronsXML"),k=f.query.call(g,l.activity.lngComp).spread(function(a){return{path:c+"language-comparison/"+a.value.toLowerCase(),version:a.value}});break;case"TextSelect":b.content.phrases=n(b.content.phrases,b.filterOptions,!0,"options"),c+="text-select/main";break;case"SpeakCha":c+="speaking-challenge/main",e=p(b,"templateCode");break;case"SpeakChaRio":c+="speaking-challenge-new/main",e=p(b,"templateCode");break;case"FlaChoice":b.content.flashCards=n(b.content.flashCards,b.filterOptions,!0,"options"),c+="flashcard-choice/main";break;case"RolePlayVideo":b.content.questions=n(b.content.questions,b.filterOptions,!1,"options"),b.hasNoAsrFallback=!0,c+="role-play-video/main",o(b.content.video),e=p(b.content.questions,"pronsXML");break;case"SharingPictureDescr":c+="sharing-pic-desc/main";break;case"RolePlayAudio":b.content.questions=n(b.content.questions,b.filterOptions,!1,"options"),b.hasNoAsrFallback=!0,c+="role-play-audio/main",e=p(b.content.questions,"pronsXML");break;case"LanguagePresentationNew":c+="language-presentation-new/main",o(b.content.grammarVideo.videoUrl);break;default:c+="no-template/main",i.log("Activity error: template type '"+b.templateCode+"' is not defined")}return d.all([e,k]).spread(function(a,d){return{basePath:d&&d.path?d.path:c,data:b,techcheckModules:a,abtestVersion:d&&d.version?d.version:q}})}function n(b,c,d,e){var f=c?c.random:"",g=c?c.questionNo:"",h=c?c.optionNo:"";return f&&(d&&(b=j.shuffle(b)),e&&(a.each(b,function(b,c){c[e]&&a.each(c[e],function(a,b){b.original_index===q&&(b.original_index=a)})}),a.each(b,function(a,b){b[e]&&(b[e]=j.shuffle(b[e]))}))),g&&a.isNumeric(g)&&(b=b.slice(0,g)),h&&a.isNumeric(h)&&a.each(b,function(a,b){b[e]&&(b[e]=b[e].slice(0,h))}),a('<div data-weave="school-ui-activity/shared/automation-test/main(assets)"></div>').addClass(r).data("assets",b).appendTo("body").weave(),b}function o(a){if(a&&a.url){if(/^(?:\w+:\/\/[\w\.-]+(?:\:\d+)?)?\/dam\//i.test(a.url))a.lowQualityUrl=a.url+"/_jcr_content/renditions/s.mp4";else{var b=a.url.substring(0,a.url.lastIndexOf(".")),c=a.url.substring(a.url.lastIndexOf("."));a.lowQualityUrl=b+"_s"+c}}}function p(a,b){return function(a,b){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(a[c][b])return!0}else if(a[b])return!0;return!1}(a,b)?k.isAvailable()?d.resolve([{id:"html5-mic-auth"},{id:"check-audio"}]):d.resolve([{id:"flash-install"},{id:"flash-setting"},{id:"chrome-auth"},{id:"check-audio"}]):d.resolve()}var q,r="ets-at-assets",s=".ets-at-assets";return{getProcessedActivityData:function(a){return f.query.call(g,"student_activity!"+a).spread(function(a){return m(a.activityContent)})}}}),define("school-ui-activity-container/widget/activity/activity-manager/scoring",["jquery","when"],function(a,b){"use strict";function c(a,b){if(a===b)return!0;if(void 0===a||null===a||"object"!=typeof a)return!1;if(void 0===b||null===b||"object"!=typeof b)return!1;if(a.constructor===b.constructor){if(f(a)){for(var g=a.length;g--;)if(!c(a[g],i(b,e(a[g]))))return!1}else for(var h in a)if(!d(s,h))if("object"==typeof a[h]){if(!c(a[h],b[h]))return!1}else if(a[h]!==b[h])return!1;return!0}return!1}function d(b,c){var d=!1;return Array.prototype.indexOf?d=!!~b.indexOf(c):a.each(b,function(a,b){if(c===b)return d=!0,!1}),d}function e(a){return a._id||a.id}function f(a){return p.call(a)===q}function g(a){return p.call(a)===r}function h(a,b){if(a&&b){var c=[];for(var d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)&&f(a[d])&&c.push(d);return c}}function i(a,b){for(var c,d=a.length;d--;)if(c=a[d],e(c)===b)return c}function j(a){if(a&&a[v])return a[o]}function k(a,b){if(1!==A){var d=!0;return c(b,a)||j(a)?a[o]=!0:(a[o]=!1,d=!1),A--,d}}function l(a,b){if(a&&b){for(var c,d,e,f,g=h(a,b),i=g.length,j=0;i--;)if(f=g[i],e=a[f],c=e.length,!e[o]){for(d=0;d<c;d++)e[d][o]&&j++;if(100*j/c<z)return void(a[o]=!1)}a[o]=!0}}function m(a,b){if(a&&b){A++;for(var c,d,f,j,l,n=!1,p=h(a,b),q=p.length;q--;)for(c=p[q],d=b[c],f=a[c],l=d.length,f[o]=!0;l--;)g(d[l])&&(j=e(d[l]),m(i(f,j),d[l])||(f[o]=!1));return b&&(n=k(a,b)),n}}function n(b,c,d){var e,g,i,j,k,l=h(b,c),n=0;if(d=d[0],l&&l.length&&d&&(i=b[l[0]],a.each(i,function(a,b){if(b[x]===d[x])return j=b,!1}),j)){for(var p in j)if(p!==v&&j.hasOwnProperty(p)&&f(j[p])){k=j[p];break}k?(a.each(k,function(a,b){b[w]===d.index-1?b[y]=!0:b[y]=!1}),m(b,c)):(d.score>=z?j[o]=!0:j[o]=!1,delete d.score,d.words&&(a.each(d.words,function(a,b){b.score>=z?b[o]=!0:b[o]=!1,delete b.score}),j[v]=d.words)),a.each(i,function(a,b){b[o]||n++}),g=i.length,e=Math.ceil(g*z/100),b[t]=n,b[u]=e,b[o]=e<=g-n}}var o="_isCorrect",p=Object.prototype.toString,q="[object Array]",r="[object Object]",s=["collapsed","indexed","expires"],t="iNOT_PASSED",u="iNEED_PASSED",v="_asrWords",w="original_index",x="_id",y="selected",z=70,A=1,B={ASR:"asr",GP:"grouping",DEFAULT:"default"};return{compute:function(c,d,e,f){switch(f=f||a.Deferred(),A=1,e=e||{scoringType:B.DEFAULT},e.scoringType){case B.ASR:n.call(d,c.content,c.scoring,e.currASRResult);break;case B.DEFAULT:default:m.call(d,c.content,c.scoring),l(c.content,c.scoring)}return f.resolve(c),b.resolve(c)}}}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-manager/manager.html",[],function(){return function(a){return'<div class="ets-act-hd" data-weave="school-ui-activity-container/widget/activity/activity-reference/main"></div>\n<div class="ets-act-bd">\n\t<div class="ets-act-bd-main">\n    \t\x3c!--render activity luncher here--\x3e\n\t</div>\n\t<div class="ets-act-epaper">\n\t\t<div class="ets-act-bd-epaper">\n\t\t\t\x3c!-- render epaper here --\x3e\n\t\t</div>\t\t\n\t</div>\n\n</div>\n<div class="ets-act-ft"></div>'}}),define("school-ui-activity-container/widget/activity/activity-manager/main",["when","poly/array","jquery","json2","troopjs-ef/component/widget","./scoring","./data-bridge","school-ui-shared/utils/progress-state","school-ui-shared/utils/typeid-parser","school-ui-shared/utils/feature-access","school-ui-shared/utils/update-helper","school-ui-activity-container/util/ccl-cache-server","troopjs-browser/route/uri","logger","school-ui-shared/plugins/techcheck/techcheck-render","asr-core","template!./manager.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){var b=a&&a.references;return b&&(b.htmlPap||b.imgPap)}function s(b){var d=this;if(r(b[G])&&b[G].references){b[G].references._epaperType="expand",b[H]&&"true"===b[H].value&&z.test(b[G].templateCode)&&(b[G].references._epaperType="fixed",b[I]="right");var e=d[y].find("."+O).empty();return c("<div></div>").data("json",b[G].references).attr("data-weave","school-ui-activity/shared/epaper/main(json)").appendTo(e).weave()}return a.resolve()}function t(a){var b=this,d=b[y].find("."+N).empty(),e=c('<div class="ets-activity-launcher"></div>').data("option",a).attr("data-weave","school-ui-activity/launcher/main(option)").appendTo(d).weave();return e.otherwise(function(c){n.log(["Activity error: "+i.parseId(b[E])+" weave error.Message: "+(c?c.message:"NULL")+".Type: "+(a[G]?a[G].templateCode:"NULL")+"."].join(" | "))}),e}function u(){var b=this,c=i.parseId(b[E]),d=b[y].find("."+N).empty(),e=b[y].find("."+O).empty();return b.publish(R,b[E]),a.promise(function(a){setTimeout(a,0)}).then(function(){return a.all([g.getProcessedActivityData(c),b.query(b[E]+".progress"),b.query(Q),d.length&&e.length||b.html(q)])}).spread(function(a,c,e){var g={};return g[K]=a.basePath,g[G]=a.data,g[H]=e[0],g[I]="across",g[J]=f,g[B]=b[B],g[E]=b[E],g[F]=b[F],g[L]=c[0]&&h.hasPassed(c[0].progress.state),g[M]=a.abtestVersion,b[y].toggleClass(P,g[L]),x.call(b,a).then(function(a){return a&&a.skip?(b.publish(W),void b.publish(X)):(a&&a.proceedWithoutAsr&&(g[G].asrDisabled=!0),s.call(b,g),t.call(b,g).then(function(){b.publish(S),b.publish(T),b._beforeLoadActTime=+new Date}).otherwise(function(){d.empty()}))})})}function v(){var b=this;if(b[E]&&b[C]&&b[D]&&b[A]&&b[y]){var c=m(document.location.href),e=c.query&&void 0!==c.query.atpreview,f=b[A];a(e||b.query(f+".progress")).spread(function(a){if(a){if(!a.progress||!a.children){var c;try{c=d.stringify(a,function(a,b){if("parent"!==a)return"children"===a?b.map(function(a){return{id:a.id}}):b})}catch(a){c=String(a)}n.log("Error in properties of step "+a.id+" ("+f+"): "+c)}}else n.log("Cannot retrieve step "+f);var e;return b[B]=h.hasPassed(a.progress.state),a.children.forEach(function(a){a.id===b[E]&&(e=!0)}),e}).then(function(a){return a&&u.call(b)})}}function w(a){var b=this,d=b[y].find("."+N).empty();c('<div class="ets-activity-launcher"></div>').data("resolver",a.resolver).data("html5AsrAvailable",a.html5AsrAvailable).data("lacksFlash",a.lacksFlash).data("hasNoAsrFallback",a.hasNoAsrFallback).attr("data-weave","school-ui-activity-container/widget/activity/asr-not-supported/main").appendTo(d).weave()}function x(b){var c=this,d=b.techcheckModules,e=b.data.hasNoAsrFallback;return d&&0!==d.length?c[Y].promise.then(function(){return o.removeOverlay(),c.publish(V)}).then(function(){return c[$]}).then(function(b){d=d.filter(function(a){return"check-audio"!==a.id||"true"!==localStorage.getItem(Z)});var f={flashPath:[b,_,aa,ba].join("/")},g=p.isAvailable();g&&(f.recorderMode="html5");var h=[];return a.promise(function(a,b){c.publish(U,d,f).then(function(b){b.forEach(function(a){"check-audio"===a.id&&a.passed&&localStorage.setItem(Z,"true")}),c.publish(R,c[E]),a({})},function(d){if("cancel techcheck"!==d)b(d);else{var f=!1,i=!1;h.forEach(function(a){"check-audio"!==a.id&&!1===a.passed&&(f=!0),"flash-install"===a.id&&!1===a.passed&&(i=!0)}),f?w.call(c,{resolver:a,html5AsrAvailable:g,lacksFlash:i,hasNoAsrFallback:e}):(c.publish(R,c[E]),a({}))}},function(a){h=a}),c.publish(S)})}):a.resolve()}var y="$element",z=/^MulChoTxt$|^MulSelTxt$/,A="step_id",B="isReview",C="studentCourseId",D="memberId",E="act_id",F="act_template_id",G="activityContent",H="epaperType",I="_layoutType",J="scoring",K="target",L="hasPassed",M="abtestVersion",N="ets-act-bd-main",O="ets-act-bd-epaper",P="ets-pass",Q="ccl!'school.courseware.epaper.fixed.enable'",R="activity-container/show/loading",S="activity-container/hide/loading",T="activity-container/resize",U="tech-check/request",V="tech-check/cancel",W="activity/submit/score/proxy",X="activity-container/nextActivity",Y="_techcheckInitialized",Z="_activity_techcheck_checkaudio_already_shown",$="_cache_server",_="_shared/techcheck-flash",aa="{version}",ba="techcheck.swf";return e.extend({"sig/initialize":function(){this._beforeLoadActTime=+new Date,this[Y]=a.defer(),this[$]=this.query(l).spread(function(a){return a&&a.value||""})},"sig/finalize":function(){window.CollectGarbage&&window.CollectGarbage()},"hub:memory/plugins/tech-check/enable":function(){this[Y].resolve()},"hub:memory/context":function(a){var b=this;a&&(j.setFeaturesUnicode(a.featureAccessBits),b[D]=i.parseId(a.user.id),v.call(b))},"hub:memory/load/enrollment":function(a){var b=this;a&&(b[C]=i.parseId(a.id),v.call(b))},"hub:memory/load/step":function(a){var b=this;a&&(b[A]=a.id,v.call(b))},"hub:memory/load/activity":function(a){var b=this;a&&(b[E]=a.id,b[F]=a.templateActivityId,v.call(b))},"hub/render/activity":function(a){var b=this;a&&(b[E]=a,v.call(b))},"hub/activity/submit/score":function(a,b){var c,e=this,f=Math.ceil((+new Date-e._beforeLoadActTime)/6e4)||1,g="number"==typeof a?a:100;return f<=0?f=1:f>32767&&(f=32767),c=setTimeout(function(){e.publish(R,e[E])},1e3),e.publish("school/interface/activityIsReview",e[B]).spread(function(a){return k.submitScore({studentActivityId:i.parseId(e[E]),score:g,minutesSpent:f,studyMode:a?1:0}).spread(function(a){var c;return void 0!==b&&(c=k.integrationSubmitWriting({writingScore:{StudentActivityId:i.parseId(e[E]),Content:b||"",StartTime:new Date(e._beforeLoadActTime).toUTCString(),CompleteTime:(new Date).toUTCString()}})),e.publish("activity/update/progress",a),c}).otherwise(function(a){"object"==typeof a?n.log("Activity error: Submit score failed cause by "+d.stringify(a)):n.log("Activity error: Submit score failed cause by "+a)}).ensure(function(){clearTimeout(c),e.publish(S),e._beforeLoadActTime=+new Date})})}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-reference/reference.html",[],function(){return function(a){return'<div class="ets-act-intro">\n    <div class="ets-act-intro-title" data-at-id="lbl-title"></div>\n    <div class="ets-act-intro-desc" data-at-id="lbl-description"></div>\n</div>\n<div class="ets-act-live-chat" data-weave="school-ui-activity-container/widget/plugin/live-chat/main">\n</div>'}}),define("school-ui-activity-container/widget/activity/activity-reference/main",["jquery","troopjs-ef/component/widget","when","school-ui-shared/utils/language-fixing","markdownjs","template!./reference.html"],function(a,b,c,d,e,f){"use strict";function g(){var a=this;if(a[m]&&a[l]){var b=a[h].find(i),g=a[h].find(j),n=a[m]&&a[m].activityContent&&a[m].activityContent.references;c(b.length&&g.length||a.html(f)).then(function(){if(b=a[h].find(i),g=a[h].find(j),n){var c=n.title&&n.title.length>0?e.toHTML(n.title):"";n.standardInstruction&&n.standardInstruction.length>0&&(c+=" "+e.toHTML(n.standardInstruction)),d(b,c,a[l]),b.html(c);var f=n.desc&&n.desc.length>0?e.toHTML(n.desc):"";d(g,f,a[l]),g.html(f),a[h].removeClass(k)}else b.html(""),g.html("")})}}var h="$element",i=".ets-act-intro .ets-act-intro-title",j=".ets-act-intro .ets-act-intro-desc",k="ets-none",l="cultureCode",m="_activity";return b.extend({"hub:memory/load/activity":function(a){var b=this;a&&(b[m]=a),g.call(b)},"hub:memory/context":function(a){var b=this;a&&a[l]&&(b[l]=a[l]),g.call(b)}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/asr-not-supported/asr-not-supported.html",[],function(){return function(a){var b='<div class="ets-acc-asr-not-supported">\n    <i class="ets-acc-asr-not-supported-warning-icon"></i>\n    <p class="ets-acc-asr-not-supported-notice"\n       data-blurb-id="'+a.noticeBlurbId+'" data-blurb-en="'+a.noticeBlurbEn+'"\n       data-weave="troopjs-ef/blurb/widget"></p>\n\n    ';return a.hasNoAsrFallback&&(b+='\n    <div class="ets-acc-asr-not-supported-btn-proceed" data-action="proceedWithoutAsr"\n         data-blurb-id="707725" data-blurb-en="Proceed without Speech Recognition"\n         data-weave="troopjs-ef/blurb/widget"></div>\n    '),b+='\n    <div class="ets-acc-asr-not-supported-btn-skip" data-action="skip"\n         data-blurb-id="707726" data-blurb-en="Skip"\n         data-weave="troopjs-ef/blurb/widget"></div>\n    <div class="ets-acc-asr-not-supported-livechat">\n        <span data-blurb-id="644326" data-text-en="Need help? Get in touch"\n              data-weave="troopjs-ef/blurb/widget"></span>\n        <span data-weave="techcheck-ui/widget/shared/live-chat/main(\'small-button\')"\n              class="tck-ui-livechat-widget" data-delegate="button"></span>\n    </div>\n</div>'}}),define("school-ui-activity-container/widget/activity/asr-not-supported/main",["when","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","template!./asr-not-supported.html"],function(a,b,c,d){"use strict";function e(a){var b=709456,d="Please allow your Microphone to be accessed and try again.";if(!a){var e="pc"===c.device,f="osx"===c.os,g="ios"===c.os;e?f?(b=709458,d="Please use the latest version of Web browser Chrome or upgrade to Safari 11."):(b=709457,d="Please use the latest version of web browser such as Chrome (preferred), Firefox. Thanks."):g?(b=709460,d="Please use Safari 11 by upgrading to iOS 11."):(b=709459,d="Please use the latest version of Chrome or Firefox. Thanks.")}return{noticeBlurbId:b,noticeBlurbEn:d}}return b.extend({"sig/start":function(){var b=this.$element,c=b.data("html5AsrAvailable"),f=b.data("hasNoAsrFallback"),g=e(c);return a.all([this.html(d,{hasNoAsrFallback:f,html5AsrAvailable:c,noticeBlurbId:g.noticeBlurbId,noticeBlurbEn:g.noticeBlurbEn}),this.publish("activity/prop/changed/completed",!1),this.publish("activity/prop/changed/type",-1),this.publish("activity/prop/changed/length",0),this.publish("activity/prop/changed/index",-1/0)])},"dom:[data-action=skip]/click":function(){this.$element.data("resolver")({skip:!0})},"dom:[data-action=proceedWithoutAsr]/click":function(){this.$element.data("resolver")({proceedWithoutAsr:!0})}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/bottom-bar/bottom-bar.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"},d=function(a,b){return"ets-btn "+(b?"ets-btn-"+b:"ets-btn-green")+" ets-btn-large ets-btn-shadowed ets-disabled "+(a?"ets-btn-fn-"+a:"")};return b+='\n\n<div class="'+d("check","purple")+'" data-action="check" data-at-id="btn-check-answer">\n\t<span '+c(450316,"CHECK MY ANSWER")+'></span>\n</div>\n<div class="'+d("retry","blue")+'" data-action="retry" data-at-id="btn-retry">\n\t<span '+c(450051,"RETRY")+'></span>\n</div>\n<div class="'+d("next")+'" data-action="nextQues" data-at-id="btn-next-question">\n\t<span '+c(450052,"NEXT")+'></span>\n</div>\n<div class="'+d("save")+'" data-action="save" data-at-id="save">\n\t<span '+c(443583,"DONE")+'></span>\n</div>\n<div class="'+d("submit")+'" data-action="submit" data-at-id="btn-submit">\n\t<span '+c(150622,"SUBMIT")+'></span>\n</div>\n<div class="'+d("done")+'" data-action="done" data-at-id="btn-done">\n\t<span '+c(443583,"DONE")+'></span>\n</div>\n<div class="'+d("move")+'" data-action="next" data-type="button" data-at-id="btn-next">\n\t<span '+c(450052,"NEXT")+"></span>\n</div>"}}),define("school-ui-activity-container/widget/activity/bottom-bar/main",["jquery","mv!jquery#troopjs-1.0","troopjs-ef/component/widget","when","template!./bottom-bar.html","poly/array","poly/object"],function(a,b,c,d,e){"use strict";function f(a){a.forEach(function(a){var b=a.$el;b&&(a.show?b.addClass(l):b.removeClass(l),a.enable?b.removeClass(m):b.addClass(m),a.enable?b.attr("data-at-enable","true"):b.attr("data-at-enable","false"))})}function g(a,b,c){c&&(a=c+a),r[a]=b,j(r)}function h(a,b){g(a,b,p)}function i(a){if(a&&!a.hasClass(m)){var b=[].slice.call(arguments,1);this.publish.apply(this,b)}}function j(a){var b=a[p+o.ANSWERED],c=a[p+o.INSTANT_FEEDBACK],d=a[p+o.SAVABLE],e=a[n.TYPE]===q.PRACTICE,g=a[n.TYPE]===q.LEARNING,h=a[n.TYPE]===q.EXERCISE,i=a[p+o.COMPLETED],j=a[n.COMPLETED],k=a[n.INDEX],l=a[n.LENGTH],m=k>=l-1,r=!j&&!c&&!d&&h&&!i,t=e&&m&&!d&&!j,u=j||(!h||c)&&!d&&m;f([{$el:s.save,show:d&&!h&&!j,enable:b},{$el:s.submit,show:d&&h&&!j,enable:b},{$el:s.check,show:r,enable:b},{$el:s.done,show:t,enable:b},{$el:s.moveOn,show:u&&!t,enable:j||!h&&b},{$el:s.retry,show:(!g||d)&&j&&!(d&&h),enable:j},{$el:s.nextQues,show:!r&&l>1&&k<l-1,enable:b||g}])}function k(a,b){Object.keys(b).forEach(function(c){s[c]=a.find("."+b[c])})}var l="ets-show",m="ets-disabled",n={COMPLETED:"completed",INDEX:"index",LENGTH:"length",TYPE:"type"},o={ANSWERED:"answered",INSTANT_FEEDBACK:"instantFeedback",SAVABLE:"savable",COMPLETED:"completed"},p="item_",q={LEARNING:2,EXERCISE:1,PRACTICE:3},r={},s={};return c.extend({"sig/start":function(){var a=this,b=a.$element;return a.html(e).then(function(){k(b,{check:"ets-btn-fn-check",nextQues:"ets-btn-fn-next",save:"ets-btn-fn-save",submit:"ets-btn-fn-submit",nextAct:"ets-ui-acc-btn-next",prevAct:"ets-ui-acc-btn-prev",done:"ets-btn-fn-done",retry:"ets-btn-fn-retry",moveOn:"ets-btn-fn-move"})})},"sig/finalize":function(){b(this.$element.find(".ets-asr-ob-bt")).remove()},"hub:memory/load/results":function(a){var b=this;a&&a.activity&&"summary"===a.activity?b.hide():b.show()},hide:function(){this.$element.addClass("ets-hidden")},show:function(){this.$element.removeClass("ets-hidden")},"hub/activity/prop/changed/completed":function(a){g(n.COMPLETED,a)},"hub/activity/prop/changed/index":function(a){g(n.INDEX,a)},"hub/activity/prop/changed/length":function(a){g(n.LENGTH,a)},"hub/activity/prop/changed/type":function(a){g(n.TYPE,a)},"hub/activity/item/prop/changed/answered":function(a){h(o.ANSWERED,a)},"hub/activity/item/prop/changed/instantFeedback":function(a){h(o.INSTANT_FEEDBACK,a)},"hub/activity/item/prop/changed/savable":function(a){h(o.SAVABLE,a)},"hub/activity/item/prop/changed/completed":function(a){h(o.COMPLETED,a)},"dom:[data-action=check]/click":function(){i.call(this,s.check,"activity/check/answer")},"dom:[data-action=nextQues]/click":function(){i.call(this,s.nextQues,"activity/next/step")},"dom:[data-action=next]/click":function(){i.call(this,s.moveOn,"activity/submit/score/proxy"),i.call(this,s.moveOn,"activity-container/nextActivity")},"dom:[data-action=save]/click":function(){i.call(this,s.save,"activity-container/bottom-bar/item/completed",!0,r[n.INDEX])},"dom:[data-action=submit]/click":function(){i.call(this,s.submit,"activity/check/answer")},
"dom:[data-action=done]/click":function(){i.call(this,s.done,"activity-container/bottom-bar/item/completed",!0,r[n.INDEX])},"dom:[data-action=retry]/click":function(){i.call(this,s.retry,"activity/retry")}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/navigation/navigation.html",[],function(){return function(a){var b,c,d,e,f,g="",h=a||{},i=h.activities||[],j=i.length,k=h.index,l=h.currentType,m=h.hasStepPassed?" ets-ui-acc-act-nav-summary-green":"",n=h.hasStepPassed?" ets-passed":"",o=!1;g+='\n<ul class="ets-ui-acc-act-nav">\x3c!--\n    ';for(var p=0;p<j;p++)b=i[p],c=!!b.hasPassed,d=c?"&nbsp;":p+1,e=c?" ets-ui-acc-act-nav-passed":"",f=p===k?" ets-ui-acc-act-nav-active":"",!o&&b.hasPassing&&(e=" ets-ui-acc-act-nav-passing",o=!0),g+="\n    --\x3e<li class='ets-ui-acc-act-nav-act"+e+"' data-at-id=\""+b.id+'">\n        <a class="'+f+'" data-nav-index="'+p+'" data-act-id="'+b.id+'" data-action="route" href="javascript:void(0)">'+d+"</a>\n    </li>\x3c!--\n    ";return g+='\n    --\x3e<li class="ets-ui-acc-act-nav-summary'+m+'">\n        <a href="javascript:void(0)" data-action="route" class="'+("summary"===l?"ets-ui-acc-act-nav-active":"")+n+'">&nbsp;</a>\n    </li>\n</ul>'}}),define("school-ui-activity-container/widget/activity/navigation/main",["jquery","when","troopjs-ef/component/widget","template!./navigation.html","school-ui-shared/utils/progress-state","school-ui-shared/utils/typeid-parser","poly/json"],function(a,b,c,d,e,f){"use strict";function g(){var a=this;a[k]&&a[j]&&(a[m]=a[m].then(function(){return a.query(a[k]+".progress,.children").spread(function(b){var c,f=b.children||[],g=e.hasPassed(b.progress.state),k=f.map(function(a){return a.progress.id});return a.query(k).spread(function(){return f.forEach(function(a,b){f[b].hasPassed=e.hasPassed(a.progress.state)}),a[j]!==l?f.forEach(function(b,d){b.id===a[i]&&(c=d)}):c=f.length,a.html(d,{index:c,activities:f,currentType:a[j],hasStepPassed:g}).then(function(){c!==h?a.show():a.hide()})})})}).otherwise(function(){}))}var h,i="_activity_id",j="_current_type",k="_step_id",l="summary",m="_render_promise";return c.extend({"sig/start":function(){this[m]=b.resolve()},"hub:memory/load/step":function(a){var b=this;a&&(b[k]=a.id,g.call(b))},"hub:memory/load/results":function(a){var b=this;a&&(b[j]=a.activity===l?l:"activity",b[i]=a.activity&&a.activity.id,g.call(b))},hide:function(){this.$element.addClass("ets-none")},show:function(){this.$element.removeClass("ets-none")},"hub/activity/update/progress":function(){g.call(this)},"dom:[data-action='route']/click":function(b){var c=this,d=a(b.target),e=d.data("act-id");d.hasClass("ets-ui-acc-act-nav-active")||(c.publish("activity/submit/score/proxy"),c.publish("load",{activity:e?f.parseId(e):l}),c[i]=e,c[j]=e?"activity":l,e&&c.publish("activity-container/show/loading",e),g.call(c))}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-summary/step-summary.html",[],function(){return function(a){var b="",c=a.actPros,d=c.length,e=a.hasPassed,f=0,g=a.pros,h=a.numNotPassed,i=a.isLastStep,j=a.isLessonPassed,k=a.isStepPerfect,l=a.isLessonPerfect,m=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};if(b+='\n<div class="ets-ui-step-summary-bd">\n',e?(b+="\n    ",j?(b+='\n        <h3 data-at-id="lbl-step-summary-title">\n            <i class="ets-ui-icon-pass-l"></i>\n            <span '+m(450041,"Step passed")+' >&nbsp;</span>\n        </h3>\n        <div class="ets-cf"></div>\n        <h3 data-at-id="lbl-step-summary-sub-title">\n            <i class="ets-ui-icon-pass-l"></i>\n            <span '+m(450040,"Lesson passed")+" >&nbsp;</span>\n        </h3>\n        ",b+=l?'\n            <h4 data-at-id="lbl-step-summary-description" '+m(450312,"Well done! You got everything correct and passed this lesson.")+" ></h4>\n        ":'\n            <h4 data-at-id="lbl-step-summary-description" '+m(450042,"Well done! You passed this lesson.")+" ></h4>\n        ",b+="\n    "):(b+="\n        ",b+=k?'\n            <h3 data-at-id="lbl-step-summary-title" '+m(462934,"Perfect!")+' ></h3>\n            <h4 data-at-id="lbl-step-summary-description" '+m(450048,"Good work! You got everything correct and passed the step.")+" ></h4>\n        ":'\n            <h3 data-at-id="lbl-step-summary-title" '+m(450041,"Step passed")+' ></h3>\n            <h4 data-at-id="lbl-step-summary-description" '+m(450315,"Good work! You passed the step.")+" ></h4>\n        ",b+="\n    "),b+="\n"):(b+="\n    ",g<40?b+='\n        <h3 data-at-id="lbl-step-summary-title" '+m(450045,"Keep trying")+" ></h3>\n    ":g>=40&&g<60&&(b+='\n        <h3 data-at-id="lbl-step-summary-title" '+m(450043,"Almost there")+" ></h3>\n    "),b+="\n    ",b+=1===h?'\n        <h4 data-at-id="lbl-step-summary-description" '+m(450576,"You need to pass 1 more activities to move on.")+" ></h4>\n    ":'\n        <h4 data-at-id="lbl-step-summary-description" '+m(450317,"You need to pass ^numberofactivities^ more activities to move on.")+'  data-values=\'{"numberofactivities":'+h+"}'></h4>\n    ",b+="\n"),b+="\n\n",e||(b+="\n    <p>\n        \x3c!--<span "+m(450046,"You need to pass 60% of the activities in a step.")+' ></span>--\x3e\n        \x3c!--<br/>--\x3e\n        <span data-at-id="lbl-step-summary-sub-description" '+m(450047,"Your current progress will be saved.")+" ></span>\n    </p>\n"),b+="\n\n",!j){for(b+='\n<ul class="ets-ui-step-summary-acts">\n    ';f<d;f++)b+="\n        ",c[f]?b+='\n            <li class="ets-pass" data-at-id="lbl-activity-status-'+(f+1)+'"></li>\n        ':b+='\n            <li class="ets-fail" data-at-id="lbl-activity-status-'+(f+1)+'">'+(f+1)+"</li>\n        ",b+='\n        \x3c!--<li class="',c[f]?b+="ets-pass":b+="ets-fail",b+='"></li>--\x3e\n    ';b+="\n</ul>\n"}return b+='\n\n<div class="ets-ui-step-summary-actions">\n    \x3c!--<div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="close">--\x3e\n        \x3c!--<span '+m(450015,"Back to the unit")+" ></span>--\x3e\n    \x3c!--</div> --\x3e\n    ",k?(b+="\n        ",b+=j||i?'\n            <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="close" data-at-id="btn-back-to-the-unit">\n                <span '+m(450015,"Back to the unit")+" ></span>\n            </div>\n        ":'\n            <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="nextstep" data-at-id="btn-start-the-next-step">\n    <span '+m(450053,"Start the next step")+" ></span>\n</div>\n        ",b+="\n    "):e?(b+='\n        <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="tryagain" data-at-id="btn-try-the-step-again">\n            <span '+m(450050,"Try the step again")+" ></span>\n        </div>\n        ",b+=j||i?'\n            <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="close" data-at-id="btn-back-to-the-unit">\n                <span '+m(450015,"Back to the unit")+" ></span>\n            </div>\n        ":'\n            <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="nextstep" data-at-id="btn-start-the-next-step">\n                <span '+m(450053,"Start the next step")+" ></span>\n            </div>\n        ",b+="\n    "):b+=' \n        <div class="ets-btn-large ets-btn-shadowed ets-btn-white" data-action="tryagain" data-at-id="btn-try-the-step-again">\n            <span '+m(450050,"Try the step again")+" ></span>\n        </div>  \n    ",b+="\n</div>\n</div>\n",e&&(b+='\n<div class="ets-acc-sharing" data-ccl="Facebook.School.Share" data-weave="troopjs-ef/ccl/placeholder(\'school-ui-activity-container/widget/plugin/sharing/main\')"></div>\n'),b}}),define("school-ui-activity-container/widget/activity/step-summary/main",["jquery","troopjs-ef/component/widget","when","school-ui-shared/utils/progress-state","school-ui-shared/utils/typeid-parser","template!./step-summary.html","poly/array","poly/object"],function(a,b,c,d,e,f){"use strict";function g(b){var c=this;if(b)return c.query(b.id+".progress,.parent.progress,.parent.children,.children.progress").spread(function(b){var e,g,v,w=0,x=t,y=[],z=!0,A={state:0,children:[]},B=b.id,C=b.parent.children,D=u;if(b[p]=C[C.length-1][k]===B,v=a.extend({},A,b.parent.progress),b[s]=d.hasPassed(v.state),C.every(function(a){return!(a.progress.score&&a.progress.score<x)||(z=!1,!1)}),c[h].removeClass(i+" "+j).addClass((b[m]=d.hasPassed(b.progress.state))?i:j),g=(b.children||[]).length,g?(b.children.forEach(function(a){(e=d.hasPassed(a.progress.state))||w++,y.push(e)}),b[n]=Math.floor((g-w)/g*100),b[l]=Math.ceil(g*D)-(g-w)):(b[l]=Math.ceil(b.children.length*D),b[n]=b.children.length,z=!1),b[q]=z,!y.length)for(g=b.children.length;g--;)y.push(0);return b[o]=y,b[r]=100===b[n],c.html(f,b)})}var h="$element",i="ets-ui-acc-step-status-pass",j="ets-ui-acc-step-status-fail",k="id",l="numNotPassed",m="hasPassed",n="pros",o="actPros",p="isLastStep",q="isLessonPerfect",r="isStepPerfect",s="isLessonPassed",t=100,u=.6;return b.extend({"hub:memory/load/step":function(a){var b=this;a&&g.call(b,b.step=a)},"hub/activity/update/progress":function(){var a=this;g.call(a,a.step)},"dom:[data-action=close]/click":function(){this.publish("activity-container/close")},"dom:[data-action=tryagain]/click":function(){this.publish("activity-container/tryAgain")},"dom:[data-action=nextstep]/click":function(){this.publish("activity-container/nextStep")}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-title/step-title.html",[],function(){return function(a){return'<span data-at-id="lbl-step-name">'+a+"</span>"}}),define("school-ui-activity-container/widget/activity/step-title/main",["troopjs-ef/component/widget","school-ui-shared/utils/language-fixing","template!./step-title.html"],function(a,b,c){"use strict";function d(){var a=this;a[g]&&a[f]&&(b(a[e],a[g],a[f]),a.html(c,a[g]))}var e="$element",f="cultureCode",g="_data";return a.extend({"hub:memory/load/step":function(a){var b=this;a&&(b[g]=a.stepName),d.call(b)},"hub:memory/context":function(a){var b=this;a&&a[f]&&(b[f]=a[f]),d.call(b)}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/button.html",[],function(){return function(a){return'<div class="ets-act-live-chat-when-online gud">\n\t<button type="button" class="ets-act-live-chat-button"\n\t        data-weave="troopjs-ef/blurb/widget"\n\t        data-blurb-id="702070" data-text-en="I need help"\n\t        data-toggle="tooltip" data-placement="bottom"></button>\n</div>'}}),define("troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/tooltip-title.html",[],function(){return function(a){var b="";return a.hasCloseBtn&&(b+='\n\t<button type="button" class="tooltip-close">&#x2715;</button>\n'),b+='\n<div class="tooltip-text">'+a.title+"</div>"}}),define("school-ui-activity-container/widget/plugin/live-chat/main",["when","jquery","jquery.gudstrap","troopjs-ef/component/widget","livechat-ui/livechat-button","template!./button.html","template!./tooltip-title.html"],function(a,b,c,d,e,f,g){function h(a){var c=b.extend({trigger:"hover focus"},a);return{html:!0,trigger:c.trigger,title:function(){return g({hasCloseBtn:c.hasCloseBtn,title:c.title})}}}return d.extend({"sig/start":function(){var b=this;b.liveChatChecked=a.all([b.query("blurb!702072"),b.getLiveChatOptions(),b.getButtonIds()]).spread(function(c,d,g){return g&&d?b.html(f).then(function(){var f,i=b.$element;return b.$button=i.find(".ets-act-live-chat-button"),b.tooltipTitle=c&&c[0]&&c[0].translation,b.$button.tooltip(h({title:b.tooltipTitle})),f=new e(b.$button,g,d,i.data("delegate")||null),a.promise(function(a){b.$button.on("statuschange",function(){a(f)})})}):a.resolve()})},"dom:.tooltip-close/click":function(){var a=this;a.$button.tooltip("destroy"),a.$button.tooltip(h({title:a.tooltipTitle}))},"hub/activity/interaction":function(a){var b=this;a&&a.correct||b.liveChatChecked.then(function(a){a&&a.isOnline&&(localStorage.getItem("activityLivechatTooltipShownOnIncorrectAnswer")||(localStorage.setItem("activityLivechatTooltipShownOnIncorrectAnswer",!0),b.$button.tooltip("destroy"),b.$button.tooltip(h({hasCloseBtn:!0,trigger:"manual",title:b.tooltipTitle})),b.$button.tooltip("show")))})},getButtonIds:function(){return this.query("cms!CustomerService#Contactus#livechat-ui-language").spread(function(a){if(a&&a.content&&"string"==typeof a.content)return a.content.split(",")})},getLiveChatOptions:function(){return this.query("context!current","school_context!current.user","cms!CustomerService#Contactus#livechat-teacher-deploymentId","cms!CustomerService#Contactus#livechat-teacher-url").spread(function(a,b,c,d){if(c&&c.content&&d&&d.content){var e=a&&a.values&&a.values.languagecode,f=b&&b.user||{};return{sf:{url:d.content,deploymentId:c.content,orgId:"00D300000000Ys3"},user:{Email:f.email,Division:f.divisionCode,Partner:f.partnerCode,"Full name":f.firstName+" "+f.lastName,MemberID:f.member_id,Country:f.countryCode,"Browser language":e&&e.value}}}})}})}),define("troopjs-requirejs/template!school-ui-activity-container/widget/plugin/sharing/facebook.html",[],function(){return function(a){return'<div class="ets-acc-sharing-box">\n\t<span class="ets-acc-sharing-text" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'494918\' data-text-en=\'Share\'></span>\n\t<span class="ets-acc-sharing-icon" data-action="share"></span>\n\t<div class="ets-acc-sharing-container">\n\t\t<div class="ets-acc-sharing-inner">\n\t\t\t<div class="ets-acc-sharing-arrow"></div>\n\t\t\t<span data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'494870\' data-text-en=\'Proud of Yourself? Share Your Progress With Friends\'></span>\n\t\t</div>\n\t</div>\n</div>'}}),define("school-ui-activity-container/widget/plugin/sharing/main",["when","jquery","troopjs-ef/component/widget","school-ui-shared/utils/typeid-parser","template!./facebook.html"],function(a,b,c,d,e){function f(a){return this.query("ccl!'"+a+"'").spread(function(a){return a.value})}function g(a){return this.query("blurb!'"+a+"'").spread(function(a){return a.translation})}var h={picture:"school.courseware.facebook.share.pic",app_id:"configuration.facebook.appid",link:"Facebook.School.Share.link",redirect_uri:"Facebook.School.Share.RedirectUrl"},i={name:"Facebook.School.Share.Name",caption:"Facebook.School.Share.Caption"},j={description:494632},k={display:"popup"};return c.extend(function(a){var b=this;b.$element=a,b.feedParam={},b.cacheServer=""},{"sig/start":function(){var c=this,d={},l=[];b.each(h,function(a,b){l.push(f.call(c,b).then(function(b){d[a]=b}))}),b.each(j,function(a,b){l.push(g.call(c,b).then(function(b){d[a]=b}))}),b.each(i,function(a,b){l.push(f.call(c,b).then(function(a){if((a*=1)==a)return g.call(c,a)}).then(function(b){d[a]=b}))}),a.all(l).then(function(){b.extend(d,k),d.picture=c.cacheServer+d.picture,c.feedParam=d,c.html(e),c.$element.find(".ets-acc-sharing-container").addClass("ets-acc-sharing-shake").fadeIn().delay(1e4).fadeOut()})},"hub:memory/context":function(a){this.cacheServer=a.cacheServer,k.ref="Share_School_"+a.countryCode},"hub:memory/load/step":function(a){var b=this;a&&(b.stepId=d.parseId(a.id))},"dom:[data-action=share]/click":function(){var a=this;window.open("https://www.facebook.com/dialog/feed?"+b.param(this.feedParam),"facebook","width=600,height=380"),a.stepId&&a.publish("tracking/useraction",{"action.socialShare":a.stepId})}})});
//# sourceMappingURL=app-built.min.js.map
