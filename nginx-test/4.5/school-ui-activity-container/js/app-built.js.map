{
  "version": 3,
  "sources": [
    "util/ccl-cache-server.js",
    "troopjs-requirejs/multiversion!jquery#troopjs-1.0",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-container/activity-container.html",
    "widget/activity/activity-container/main.js",
    "widget/activity/activity-manager/data-bridge.js",
    "widget/activity/activity-manager/scoring.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-manager/manager.html",
    "widget/activity/activity-manager/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-reference/reference.html",
    "widget/activity/activity-reference/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/asr-not-supported/asr-not-supported.html",
    "widget/activity/asr-not-supported/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/bottom-bar/bottom-bar.html",
    "widget/activity/bottom-bar/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/navigation/navigation.html",
    "widget/activity/navigation/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-summary/step-summary.html",
    "widget/activity/step-summary/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-title/step-title.html",
    "widget/activity/step-title/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/button.html",
    "troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/tooltip-title.html",
    "widget/plugin/live-chat/main.js",
    "troopjs-requirejs/template!school-ui-activity-container/widget/plugin/sharing/facebook.html",
    "widget/plugin/sharing/main.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA,ACDA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9kBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9XA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1cA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7EA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxJA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrCA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5JA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "app-built.js",
  "sourcesContent": [
    "define('school-ui-activity-container/util/ccl-cache-server',[], function () {\n\treturn location.protocol === 'http:'\n\t\t? \"ccl!'configuration.servers.cache'\"\n\t\t: \"ccl!'configuration.servers.cachesecure'\";\n});\n",
    "\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-container/activity-container.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-ui-acc\\\" data-at-page-id=\\\"sp-activity-container\\\">\\n\\t<div class=\\\"ets-ui-acc-hd\\\">\\n\\t\\t<div class=\\\"ets-ui-acc-hd-main\\\">\\n\\t\\t\\t<div class=\\\"ets-ui-acc-step-title\\\" data-weave=\\\"school-ui-activity-container/widget/activity/step-title/main\\\"></div>\\n\\t\\t\\t<div class=\\\"ets-ui-acc-step-nav\\\" data-weave=\\\"school-ui-activity-container/widget/activity/navigation/main\\\"></div>\\n\\t\\t\\t<div class=\\\"ets-ui-acc-btn-close\\\" data-action=\\\"close\\\" data-at-id=\\\"btn-close\\\"></div>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-ui-acc-bd\\\">\\n\\t\\t<div class=\\\"ets-ui-acc-bd-main\\\">\\n\\t\\t\\t<!--<div class=\\\"ets-ui-step-summary\\\" data-weave=\\\"school-ui-activity-container/widget/activity/step-summary/main\\\"></div>-->\\n\\t\\t\\t<!--<div class=\\\"ets-activity\\\" data-weave=\\\"school-ui-activity-container/widget/activity/activity-manager/main\\\"></div>-->\\n\\t\\t</div>\\n\\t</div>\\n\\n\\t<div class=\\\"ets-ui-acc-ft\\\">\\n\\t\\t<div class=\\\"ets-ui-acc-ft-main\\\" data-weave=\\\"school-ui-activity-container/widget/activity/bottom-bar/main\\\"></div>\\n\\t</div>\\n\\n\\t<div class=\\\"ets-ui-acc-loading\\\" data-at-id=\\\"global-loading\\\">\\n\\t\\t<div class=\\\"ets-ui-acc-loading-main\\\">\\n\\t\\t\\t<div class=\\\"ets-ui-acc-loading-backdrop\\\"></div>\\n\\t\\t\\t<div class=\\\"ets-ui-acc-loading-content\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-ui-acc-loading-icon\\\"><span></span></div>\\n\\t\\t\\t\\t<div class=\\\"ets-ui-acc-loading-timeout\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t\\t\\t\\t<h3><span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"463704\\\" data-text-en=\\\"An error has occurred.\\\"></span></h3>\\n\\t\\t\\t\\t\\t\\t<p><span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"463688\\\" data-text-en=\\\"Please try again later.\\\"></span></p>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t<div class=\\\"ets-ft\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-btn ets-btn-purple ets-btn-shadowed\\\"><span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"462940\\\" data-text-en=\\\"Close\\\"></span></div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/activity-container/main',[\n\t\"jquery\",\n\t\"mv!jquery#troopjs-1.0\",\n\t\"troopjs-ef/component/widget\",\n\t\"troopjs-browser/loom/config\",\n\t\"troopjs-browser/loom/weave\",\n\t\"troopjs-browser/route/uri\",\n\t\"school-ui-shared/utils/progress-state\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"poly/array\",\n\t\"logger\",\n\t\"when\",\n\t\"template!./activity-container.html\"\n], function($, jqueryInTroop1, Widget, loom, weave, URI, progressState, typeidParser, poly, Logger, when, tAcc){\n\t\"use strict\";\n\n\tvar UNDEF;\n\n\tvar $ELEMENT = \"$element\";\n\n\tvar LESSON = \"_lesson\",\n\t\tSTEP = \"_step\",\n\t\tACTIVITY = \"_activity\",\n\t\tSTEP_ID = \"_stepId\",\n\t\tRESULTS = \"_results\",\n\t\tRETRY_RESIZE_TIMER = \"_retryResizeTimer\";\n\n\tvar ANIME_DURATION = 400,\n\t\tRESIZE_DURATION = 200;\n\n\tvar SEL_ACC_HD = \".ets-ui-acc-hd\",\n\t\tSEL_ACC_BD = \".ets-ui-acc-bd\",\n\t\tSEL_ACC_FT = \".ets-ui-acc-ft\",\n\t\tSEL_ACC = \".ets-ui-acc\",\n\t\tSEL_ACC_BD_MAIN = \".ets-ui-acc-bd-main\",\n\t\tSEL_ACC_LOADING = \".ets-ui-acc-loading\",\n\t\tSEL_ACC_LOADING_CLOSE = \".ets-ui-acc-loading .ets-btn\",\n\t\tSEL_HEADER_NOTIFICATION = \".ets-ui-acc-act-header-notification\",\n\t\tSEL_ACC_MANAGER = \".ets-activity\";\n\n\tvar CLS_OPEN = \"ets-acc-open\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_LOADING = \"ets-loading\",\n\t\tCLS_TIMEOUT = \"ets-timeout\",\n\t\tCLS_ATPREVIEW = \"ets-atpreview\",\n\t\tCLS_ACC_MANAGER = \"ets-activity\",\n\t\tCLS_STEP_SUMMARY = \"ets-ui-step-summary\";\n\n\tvar HUB_SHOW_LOADING = \"activity-container/show/loading\",\n\t\tHUB_HIDE_LOADING = \"activity-container/hide/loading\",\n\t\tHUB_ACTIVITY_OPENED = \"activity/opened\",\n\t\tHUB_ACTIVITY_CLOSED = \"activity/closed\";\n\n\tvar WIDGET_ACTIVITY_MANAGER = \"school-ui-activity-container/widget/activity/activity-manager/main\",\n\t\tWIDGET_STEP_SUMMARY = \"school-ui-activity-container/widget/activity/step-summary/main\",\n\t\tWIDGET_NOTIFICATION = \"headerfooter/widget/alert/courseware/main\";\n\n\tvar LOADING_TIMEOUT = 20000;\n\n\tvar $win = $(window),\n\t\t$html = $(\"html\");\n\n\t/**\n\t * append a new widget and weave it into activity-continer body\n\t * @param widgetName\n\t * @param className\n\t * @returns {promise}\n\t */\n\tfunction showWidget(widgetName, className) {\n\t\tvar me = this;\n\t\tvar $el = $(\"<div>\").addClass(className).attr(loom.weave, widgetName);\n\n\t\tme[$ELEMENT].find(SEL_ACC_BD_MAIN).empty().html($el);\n\n\t\treturn me.weave();\n\t}\n\n\t/**\n\t * open activity container\n\t */\n\tfunction openActivity(){\n\t\tvar me = this;\n\t\tvar dfd = when.defer();\n\n\t\tif(me[$ELEMENT].hasClass(CLS_OPEN)) {\n\t\t\tdfd.resolve();\n\t\t\treturn;\n\t\t}\n\n\t\thiddenPageScroll(true);\n\n\t\t// set default position and let activity container open from window center\n\t\tme[$ELEMENT].find(SEL_ACC).css(\"top\", getWindowCenter().top);\n\n\t\tme[$ELEMENT].removeClass(CLS_NONE);\n\n\t\t// if we don't add a zero duration here, the css3 animation will be failed\n\t\t// because we need remove ets-none firstly and need wait removeClass finished render\n\t\tsetTimeout(function(){\n\t\t\tme[$ELEMENT].addClass(CLS_OPEN);\n\n\t\t\t// wait for css3 animation\n\t\t\tsetTimeout(function(){\n\t\t\t\t// start timer for auto resize activity container\n\t\t\t\tretryResize.call(me);\n\n\t\t\t\t// start loading state\n\t\t\t\tme.publish(HUB_SHOW_LOADING);\n\t\t\t\tme.publish(HUB_ACTIVITY_OPENED);\n\n\t\t\t\tdfd.resolve();\n\t\t\t}, ANIME_DURATION);\n\t\t}, 0);\n\n\t\treturn dfd.promise;\n\t}\n\n\t/**\n\t * close activity container\n\t */\n\tfunction closeActivity(){\n\t\tvar me = this;\n\t\tvar dfd = when.defer();\n\n\t\t// sometime close activity container will be not shown css3 animation\n\t\t// add a zero duration timeout to fixed\n\t\tsetTimeout(function(){\n\t\t\tme[$ELEMENT].removeClass(CLS_OPEN);\n\t\t\tme[$ELEMENT].find(SEL_ACC).css({\n\t\t\t\t\"height\": 0,\n\t\t\t\t\"top\": getWindowCenter().top,\n\t\t\t\t\"overflow\": \"hidden\"\n\t\t\t});\n\n\t\t\t// clear timer for auto resize activity container\n\t\t\tclearRetryReszie.call(me);\n\n\t\t\t// wait for css3 animation\n\t\t\tsetTimeout(function(){\n\t\t\t\t// set display none after animation finished\n\t\t\t\tme[$ELEMENT].addClass(CLS_NONE);\n\n\t\t\t\thiddenPageScroll(false);\n\n\t\t\t\t// publish activity container closed event\n\t\t\t\tme.publish(HUB_ACTIVITY_CLOSED);\n\n\t\t\t\tdfd.resolve();\n\t\t\t}, ANIME_DURATION);\n\n\t\t}, 0);\n\n\t\treturn dfd.promise;\n\t}\n\n\t/**\n\t * dynamic get activity container height\n\t * @returns {number}\n\t */\n\tfunction getAccHeight(){\n\t\tvar me = this;\n\t\treturn me[$ELEMENT].find(SEL_ACC_HD).height() +\n\t\t\t\tme[$ELEMENT].find(SEL_ACC_BD).height() +\n\t\t\t\tme[$ELEMENT].find(SEL_ACC_FT).height();\n\t}\n\n\t/**\n\t * dynamic get activity container offset top\n\t * @returns {number}\n\t */\n\tfunction getAccTop(){\n\t\tvar me = this;\n\t\treturn Math.round( (getWindowSize().height - getAccHeight.call(me)) / 2) > 0\n\t\t\t\t? Math.round( (getWindowSize().height - getAccHeight.call(me)) / 2)\n\t\t\t\t: 0;\n\t}\n\n\t/**\n\t * set activity container offset top\n\t */\n\tfunction setAccTop(){\n\t\tvar me = this;\n\t\tme[$ELEMENT].find(SEL_ACC).css({\n\t\t\t\"top\": getAccTop.call(me)\n\t\t});\n\t}\n\n\t/**\n\t * dynamic get window size\n\t * @returns {{height: number, width: number}}\n\t */\n\tfunction getWindowSize(){\n\t\treturn {\n\t\t\theight: $win.height(),\n\t\t\twidth: $win.width()\n\t\t}\n\t}\n\n\t/**\n\t * dynamic get window center\n\t * @returns {{left: number, top: number}}\n\t */\n\tfunction getWindowCenter(){\n\t\treturn {\n\t\t\tleft: $win.width() / 2,\n\t\t\ttop: $win.height() / 2\n\t\t}\n\t}\n\n\t/**\n\t * change activity container offset when resize window\n\t */\n\tfunction respondWinResize(){\n\t\tvar me = this;\n\t\t$win.unbind(\"resize\", setAccTop.call(me))\n\t\t\t.bind(\"resize\", setAccTop.call(me));\n\t}\n\n\t/**\n\t * show or hide window scrollbar\n\t * @param toggle\n\t */\n\tfunction hiddenPageScroll(toggle){\n\t\tif(toggle){\n\t\t\t$html.css(\"overflow\", \"hidden\");\n\t\t}\n\t\telse {\n\t\t\t$html.css(\"overflow\", \"auto\");\n\t\t}\n\t}\n\n\t/**\n\t * dynamic resize activity container and change offset\n\t */\n\tfunction resizeContainer(){\n\t\tvar me = this;\n\t\tvar $ACC = me[$ELEMENT].find(SEL_ACC);\n\t\tvar targetHeight = getAccHeight.call(me);\n\t\tvar targetTop = getAccTop.call(me);\n\n\t\t// just change when height or top be changed\n\t\tif ($ACC.height() != targetHeight || $ACC.offset().top != targetTop) {\n\t\t\t$ACC.css({\n\t\t\t\t\"height\": targetHeight,\n\t\t\t\t\"top\": targetTop,\n\t\t\t\t\"overflow\": \"hidden\"\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\t$ACC.css({\n\t\t\t\t\"overflow\": \"visible\"\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * repeat trying to resize activity container\n\t */\n\tfunction retryResize(){\n\t\tvar me = this;\n\n\t\tclearRetryReszie.call(me);\n\t\tme[RETRY_RESIZE_TIMER] = setInterval(function(){\n\t\t\tresizeContainer.call(me);\n\t\t}, RESIZE_DURATION);\n\t}\n\n\t/**\n\t * clear interval for retry resize\n\t */\n\tfunction clearRetryReszie(){\n\t\tvar me = this;\n\n\t\tme[RETRY_RESIZE_TIMER] && clearInterval(me[RETRY_RESIZE_TIMER]);\n\t}\n\n\t/**\n\t * change widget between activity manager and step summary\n\t * @param activity\n\t */\n\tfunction switchWidget(activity) {\n\t\tvar me = this,\n\t\t\trenderPromise;\n\n\t\tif(activity) {\n\t\t\tswitch (activity) {\n\t\t\t\tcase \"summary\":\n\t\t\t\t\trenderPromise = showWidget.call(me, WIDGET_STEP_SUMMARY, CLS_STEP_SUMMARY);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// if activity manager already exist, don't weave again\n\t\t\t\t\tif(me[$ELEMENT].find(SEL_ACC_MANAGER).length <= 0) {\n\t\t\t\t\t\trenderPromise = showWidget.call(me, WIDGET_ACTIVITY_MANAGER, CLS_ACC_MANAGER);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\t// hiden loading state after widget woven\n\t\t\trenderPromise && renderPromise.then(function(){\n\t\t\t\tme.publish(HUB_HIDE_LOADING);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\t// empty activity container for next render\n\t\t\tme[$ELEMENT].find(SEL_ACC_BD_MAIN).empty();\n\t\t}\n\t}\n\n\tfunction showLoading(timeoutMS, timeoutCallback) {\n\t\tvar me = this;\n\t\tvar $el = me[$ELEMENT];\n\t\tvar $loadingOverlay = $el.find(SEL_ACC_LOADING);\n\t\tvar $acc = $el.find(SEL_ACC);\n\t\tvar $closeBtn = $el.find(SEL_ACC_LOADING_CLOSE);\n\n\t\t$acc.addClass(CLS_LOADING);\n\t\t$loadingOverlay.attr(\"data-at-status\", \"shown\");\n\n\t\tclearTimeout(me.loadingTimeout);\n\n\t\tif (timeoutMS) {\n\t\t\tme.loadingTimeout = setTimeout(function () {\n\t\t\t\t$loadingOverlay.addClass(CLS_TIMEOUT);\n\t\t\t\t$closeBtn.bind(\"click\", function () {\n\t\t\t\t\t$acc.removeClass(CLS_LOADING);\n\t\t\t\t\t$loadingOverlay.removeClass(CLS_TIMEOUT);\n\t\t\t\t\t$closeBtn.unbind(\"click\");\n\t\t\t\t});\n\t\t\t\ttimeoutCallback && timeoutCallback();\n\t\t\t}, timeoutMS);\n\t\t}\n\t}\n\n\tfunction hideLoading() {\n\t\tvar me = this;\n\t\tif(me.interfaceLoading) {\n\t\t\treturn;\n\t\t}\n\t\tvar $el = me[$ELEMENT];\n\t\tvar $loadingOverlay = $el.find(SEL_ACC_LOADING);\n\t\tvar $acc = $el.find(SEL_ACC);\n\n\t\t$acc.removeClass(CLS_LOADING);\n\t\t$loadingOverlay.attr(\"data-at-status\", \"unshown\");\n\t\t$loadingOverlay.removeClass(CLS_TIMEOUT);\n\n\t\tclearTimeout(me.loadingTimeout);\n\t}\n\n\t/**\n\t * find correct activity\n\t * @param step\n\t * @param loadResults\n\t * @returns {*}\n\t */\n\tfunction fillActivity(step, loadResults){\n\t\tvar me = this;\n\n\t\t// first run check\n\t\tif(!step || !loadResults){\n\t\t\treturn;\n\t\t}\n\n\t\t// select activity widget or step summary widget\n\t\tswitchWidget.call(me, loadResults.activity);\n\n\t\t// every run check\n\t\tif(!loadResults.step || loadResults.activity || loadResults.activity == \"summary\") {\n\t\t\treturn;\n\t\t}\n\n\t\treturn me.query(step.id + \".children.progress\").spread(function(step){\n\t\t\tvar activityIndex = 0,\n\t\t\t\tactivityId;\n\n\t\t\t// find first and didn't pass activity\n\t\t\t// if didn't find, use first one\n\t\t\tstep.children.every(function(e,i){\n\t\t\t\tif(progressState.hasPassed(e.progress.state)){\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tactivityIndex = i;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tactivityId = typeidParser.parseId(step.children[activityIndex].id);\n\n\t\t\tme.publish(\"load\", {\n\t\t\t\t\"activity\": activityId\n\t\t\t});\n\t\t});\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\" : function(){\n\t\t\tvar me = this;\n\n\t\t\t// bind window resize\n\t\t\trespondWinResize.call(me);\n\n\t\t\treturn me.html(tAcc).spread(function(){\n\t\t\t\tvar uri = URI(document.location.href);\n\t\t\t\tvar atpreview = Boolean(uri.query && uri.query.atpreview !== undefined);\n\n\t\t\t\t//use troop1 to weave headerfooter notification\n\t\t\t\tjqueryInTroop1(me[$ELEMENT].find(SEL_HEADER_NOTIFICATION))\n\t\t\t\t\t.attr(\"data-weave\", WIDGET_NOTIFICATION).weave();\n\n\t\t\t\t// set activity container default offset\n\t\t\t\tme[$ELEMENT].find(SEL_ACC).css({\n\t\t\t\t\t\"top\": getWindowCenter().top\n\t\t\t\t});\n\n\t\t\t\t//emit scroll event\n\t\t\t\tme[$ELEMENT].scroll(function(){\n\t\t\t\t\tme.publish(\"activity-container/scroll\");\n\t\t\t\t});\n\n\t\t\t\t//set class for at-preview\n\t\t\t\tme[$ELEMENT].toggleClass(CLS_ATPREVIEW, atpreview);\n\t\t\t});\n\t\t},\n\n\t\t\"sig/finalize\":function(){\n\t\t\tvar me = this;\n\n\t\t\t//unweave troop1 widget manually\n\t\t\tjqueryInTroop1(me[$ELEMENT].find(SEL_HEADER_NOTIFICATION)).remove();\n\t\t},\n\n\t\t\"hub:memory/load/lesson\": function onLoadLevel(lesson) {\n\t\t\tvar me = this;\n\n\t\t\tlesson && (me[LESSON] = lesson);\n\t\t},\n\n\t\t\"hub:memory/load/step\": function onLoadStep(step){\n\t\t\tvar me = this;\n\n\t\t\tif(step){\n\t\t\t\tme[STEP_ID] = step.id;\n\n\t\t\t\t// if already exist activity manager or step summary, don't need open container again\n\t\t\t\tif(me[$ELEMENT].find(SEL_ACC_BD_MAIN).children().length > 0) {\n\t\t\t\t\tfillActivity.call(me, me[STEP] = step, me[RESULTS]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\topenActivity.call(me).then(function(){\n\t\t\t\t\t\tfillActivity.call(me, me[STEP] = step, me[RESULTS]);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcloseActivity.call(me).then(function(){\n\t\t\t\t\t// remove variable and dom element for next open\n\t\t\t\t\tdelete me[STEP];\n\n\t\t\t\t\tme[$ELEMENT].find(SEL_ACC_BD_MAIN).empty();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t\"hub:memory/load/activity\": function onLoadActivity(activity){\n\t\t\tvar me = this;\n\n\t\t\tactivity && (me[ACTIVITY] = activity);\n\t\t},\n\n\t\t\"hub:memory/load/results\": function(results) {\n\t\t\tvar me = this;\n\n\t\t\tresults && fillActivity.call(me, me[STEP], me[RESULTS] = results);\n\t\t},\n\n\t\t\"hub/activity-container/show/loading\": function (activityId) {\n\t\t\tshowLoading.call(this, LOADING_TIMEOUT, function onTimeout() {\n\t\t\t\tactivityId && Logger.log(\"Activity error: \" + typeidParser.parseId(activityId) + \" loading timeout\");\n\t\t\t});\n\t\t},\n\n\t\t\"hub/activity-container/hide/loading\": function () {\n\t\t\thideLoading.call(this);\n\t\t},\n\n\t\t\"hub/activity-container/tryAgain\": function(){\n\t\t\tvar me = this;\n\n\t\t\t// load first activity of one step\n\t\t\tme[STEP] && me[STEP].children && me.publish(\"load\", {\n\t\t\t\t\"activity\": typeidParser.parseId(me[STEP].children[0].id)\n\t\t\t});\n\t\t},\n\n\t\t\"hub/activity-container/nextStep\": function(){\n\t\t\tvar me = this;\n\t\t\tvar currentStepIndex;\n\t\t\tvar stepId = me[STEP].id;\n\t\t\tvar steps = me[LESSON].children;\n\n\t\t\tsteps.every(function (e, i) {\n\t\t\t\tif (e.id === stepId) {\n\t\t\t\t\tcurrentStepIndex = i;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif ((currentStepIndex != UNDEF) && ((currentStepIndex + 1) != steps.length)) {\n\t\t\t\t// delete cache step data for next step render\n\t\t\t\tdelete me[STEP];\n\n\t\t\t\tme.publish(\"load\", {\n\t\t\t\t\t\"step\": typeidParser.parseId(steps[currentStepIndex + 1].id),\n\t\t\t\t\t\"activity\": UNDEF\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t\"hub/activity-container/nextActivity\": function(){\n\t\t\tvar me = this;\n\t\t\tvar currentActivityIndex;\n\t\t\tvar activityId = me[ACTIVITY].id;\n\t\t\tvar activities = me[STEP].children;\n\n\t\t\tactivities.every(function(e,i){\n\t\t\t\tif(e.id == activityId) {\n\t\t\t\t\tcurrentActivityIndex = i;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(currentActivityIndex != UNDEF) {\n\t\t\t\tif((currentActivityIndex + 1) != activities.length) {\n\t\t\t\t\tme.publish(\"load\", {\n\t\t\t\t\t\t\"activity\": typeidParser.parseId(activities[currentActivityIndex + 1].id)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tme.publish(\"load\", {\n\t\t\t\t\t\t\"activity\": \"summary\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"hub/activity-container/close\": function(){\n\t\t\tvar me = this;\n\n\t\t\t// the interface for third-party study courseware\n\t\t\t// when close activity container, should be changed back to which hash\n\t\t\tme.publish(\"school/interface/get/activity-container/closeHash\", {}).spread(function(data){\n\t\t\t\tme.publish(\"load\", $.extend({\n\t\t\t\t\t\"step\": UNDEF,\n\t\t\t\t\t\"activity\": UNDEF\n\t\t\t\t}, data));\n\t\t\t});\n\t\t},\n\n\t\t\"hub/activity-container/resize\": function(){\n\t\t\tvar me = this;\n\n\t\t\tresizeContainer.call(me);\n\t\t},\n\n\t\t\"hub/school/interface/activity-container/show/loading\": function (promise) {\n\t\t\tvar me = this;\n\n\t\t\t//todo: use better solution\n\t\t\tme.interfaceLoading = true;\n\n\t\t\tshowLoading.call(me);\n\t\t\tpromise.ensure(function () {\n\t\t\t\tme.interfaceLoading = false;\n\t\t\t\thideLoading.call(me);\n\t\t\t});\n\t\t},\n\n\t\t\"dom:.ets-ui-acc-btn-close/click\": function(){\n\t\t\tvar me = this;\n\n\t\t\tme.publish(\"activity-container/close\");\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity-container/widget/activity/activity-manager/data-bridge',[\n\t\"jquery\",\n\t\"troopjs-browser/loom/config\",\n\t\"troopjs-browser/loom/weave\",\n\t\"when\",\n\t\"poly/array\",\n\t\"troopjs-ef/component/ef\",\n\t\"troopjs-core/pubsub/hub\",\n\t\"school-ui-shared/utils/feature-access\",\n\t\"logger\",\n\t\"underscore\",\n\t\"asr-core\",\n\t\"school-ui-shared/enum/abtest-query-string\"\n], function(\n\t$, loom, weave, when, polyArray,\n\tEF, HUB,\n\tfeature,\n\tLogger,\n\t_,\n\thtml5AsrRecorder,\n\tabtestQueryString\n){\n\t'use strict';\n\n\tvar UNDEF;\n\n\tvar ACT_PRE = 'student_activity!';\n\n\tvar CLS_AT_ASSETS = \"ets-at-assets\";\n\n\tvar SEL_AT_ASSETS = \".ets-at-assets\";\n\n\tfunction getActivityData(data) {\n\t\t// remove automation test assets\n\t\t$(SEL_AT_ASSETS).remove();\n\n\t\tvar base_path = \"school-ui-activity/activity/\";\n\t\tvar techcheck_modules_promise = when.resolve();\n\t\tvar abtest_promise = when.resolve();\n\n\t\tswitch (data.templateCode) {\n\t\t\tcase \"SeqParVer\":\n\t\t\t\tvar lockDataSeqParVer = _.filter(data.content.sequences, function (seq) {\n\t\t\t\t\treturn seq.isLock;\n\t\t\t\t});\n\n\t\t\t\tdata.content.sequences = filterData(_.filter(data.content.sequences, function (seq) {\n\t\t\t\t\treturn !seq.isLock;\n\t\t\t\t}), data.filterOptions, true);\n\n\t\t\t\t$.each(lockDataSeqParVer, function (entryIndex, entry) {\n\t\t\t\t\tdata.content.sequences.splice(entry.position - 1, 0, entry);\n\t\t\t\t});\n\n\t\t\t\tbase_path += \"sequencing-paragraph-vertical/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"SeqWordHor\":\n\t\t\t\t$.each(data.content.phrases, function (p_entryIndex, p_entry) {\n\t\t\t\t\t$.each(p_entry.words, function (entryIndex, entry) {\n\t\t\t\t\t\tentry._id = p_entry.blanks[entryIndex]._id;\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tdata.content.phrases = filterData(data.content.phrases, data.filterOptions, true, \"words\");\n\n\t\t\t\tbase_path += \"sequencing-word-horizontal/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"SeqWordVer\":\n\t\t\t\tvar lockDataSeqWordVer = _.filter(data.content.sequences, function (seq) {\n\t\t\t\t\treturn seq.isLock;\n\t\t\t\t});\n\n\t\t\t\tdata.content.sequences = filterData(_.filter(data.content.sequences, function (seq) {\n\t\t\t\t\treturn !seq.isLock;\n\t\t\t\t}), data.filterOptions, true);\n\n\t\t\t\t$.each(lockDataSeqWordVer, function (entryIndex, entry) {\n\t\t\t\t\tdata.content.sequences.splice(entry.position - 1, 0, entry);\n\t\t\t\t});\n\n\t\t\t\tbase_path += \"sequencing-word-vertical/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"SeqImg\":\n\t\t\t\tdata.content.sequences = filterData(data.content.sequences, data.filterOptions, true, \"options\");\n\t\t\t\tbase_path += \"sequencing-image/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"MatPicToAud\":\n\t\t\t\tbase_path += \"matching-pic-audio/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"Writing\":\n\t\t\t\tif (data.isGraded && feature.hasWritingClassFeature()) {\n\t\t\t\t\tbase_path += \"writing-challenge-exercise/main\";\n\t\t\t\t} else {\n\t\t\t\t\tbase_path += \"writing-challenge-practice/main\";\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"MatTxtToPic\":\n\t\t\t\tbase_path += \"matching-text-pic/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase 'MatTxtToTxt':\n\t\t\t\tbase_path += \"matching-text-text/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase 'MatTxtToLongTxt':\n\t\t\t\tbase_path += 'matching-text-long-text/main';\n\t\t\t\tbreak;\n\n\t\t\tcase \"MulChoTxt\":\n\t\t\t\tbase_path += \"multiple-choice-text/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"MulChoMedia\":\n\t\t\t\tbase_path += \"multiple-choice-media/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"FlaPre\":\n\t\t\tcase \"FlaPreFlip\":\n\t\t\t\tdata.content.flashCards = filterData(data.content.flashCards, data.filterOptions, true, \"options\");\n\t\t\t\tbase_path += \"flashcard-presentation/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"MulSelTxt\":\n\t\t\t\tbase_path += \"multiple-select-text/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"MulSelMedia\":\n\t\t\t\tbase_path += \"multiple-select-media/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"MoviePre\":\n\t\t\t\tbase_path += \"movie-presentation/continuousMovie\";\n\t\t\t\tsetVideoLowQualityUrl(data.content.video);\n\t\t\t\tbreak;\n\n\t\t\tcase \"MovieQuestion\":\n\t\t\t\tdata.content.questions = filterData(data.content.questions, data.filterOptions, false, \"options\");\n\t\t\t\tbase_path += \"movie-question/main\";\n\t\t\t\tsetVideoLowQualityUrl(data.content.video);\n\t\t\t\tbreak;\n\n\t\t\tcase \"TypingTable\":\n\t\t\t\tdata.content.items = filterData(data.content.items, data.filterOptions, true);\n\t\t\t\tbase_path += \"typing-table/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"TypingDragDrop\":\n\t\t\t\tdata.content.items = filterData(data.content.items, data.filterOptions, true);\n\t\t\t\tbase_path += \"typing-drag-drop/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"TypingGapFill\":\n\t\t\t\tdata.content.items = filterData(data.content.items, data.filterOptions, true);\n\t\t\t\tbase_path += \"typing-gap-fill/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"GroupMove\":\n\t\t\t\tbase_path += \"grouping/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"GroupCopy\":\n\t\t\t\tbase_path += \"grouping/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"LngPre\":\n\t\t\t\tbase_path += \"language-presentation/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"FlaExe\":\n\t\t\t\tdata.content.flashCards = filterData(data.content.flashCards, data.filterOptions, true, \"options\");\n\t\t\t\tdata.hasNoAsrFallback = true;\n\t\t\t\tbase_path += \"flashcard-exercise/main\";\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data.content.flashCards, \"pronsXML\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"LngComp\":\n\t\t\t\tdata.content.phrases = filterData(data.content.phrases, data.filterOptions, true, \"options\");\n\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data.content.phrases, \"pronsXML\");\n\n\t\t\t\tabtest_promise = EF.query.call(HUB, abtestQueryString.activity.lngComp).spread(function(data){\n\t\t\t\t\treturn {\n\t\t\t\t\t\tpath: base_path + \"language-comparison/\" + data.value.toLowerCase(),\n\t\t\t\t\t\tversion: data.value\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"TextSelect\":\n\t\t\t\tdata.content.phrases = filterData(data.content.phrases, data.filterOptions, true, \"options\");\n\t\t\t\tbase_path += \"text-select/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase 'SpeakCha':\n\t\t\t\tbase_path += 'speaking-challenge/main';\n\n\t\t\t\t//since there is no property to detect in this activity, just check \"templateCode\" to make property check success\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data, \"templateCode\");\n\t\t\t\tbreak;\n\n\t\t\tcase 'SpeakChaRio':\n\t\t\t\tbase_path += 'speaking-challenge-new/main';\n\n\t\t\t\t//since there is no property to detect in this activity, just check \"templateCode\" to make property check success\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data, \"templateCode\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"FlaChoice\":\n\t\t\t\tdata.content.flashCards = filterData(data.content.flashCards, data.filterOptions, true, \"options\");\n\t\t\t\tbase_path += \"flashcard-choice/main\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"RolePlayVideo\":\n\t\t\t\tdata.content.questions = filterData(data.content.questions, data.filterOptions, false, \"options\");\n\t\t\t\tdata.hasNoAsrFallback = true;\n\t\t\t\tbase_path += \"role-play-video/main\";\n\t\t\t\tsetVideoLowQualityUrl(data.content.video);\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data.content.questions, \"pronsXML\");\n\t\t\t\tbreak;\n\n\t\t\tcase 'SharingPictureDescr':\n\t\t\t\tbase_path += 'sharing-pic-desc/main';\n\t\t\t\tbreak;\n\n\t\t\tcase \"RolePlayAudio\":\n\t\t\t\tdata.content.questions = filterData(data.content.questions, data.filterOptions, false, \"options\");\n\t\t\t\tdata.hasNoAsrFallback = true;\n\t\t\t\tbase_path += \"role-play-audio/main\";\n\t\t\t\ttechcheck_modules_promise = getAsrTechcheckModules(data.content.questions, \"pronsXML\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"LanguagePresentationNew\":\n\t\t\t\tbase_path += \"language-presentation-new/main\";\n\t\t\t\tsetVideoLowQualityUrl(data.content.grammarVideo.videoUrl);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbase_path += \"no-template/main\";\n\t\t\t\tLogger.log(\"Activity error: template type '\" + data.templateCode + \"' is not defined\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn when.all([\n\t\t\ttechcheck_modules_promise,\n\t\t\tabtest_promise\n\t\t]).spread(function(techcheck_modules, abtest){\n\t\t\treturn {\n\t\t\t\t\"basePath\": (abtest && abtest.path) ? abtest.path : base_path,\n\t\t\t\t\"data\": data,\n\t\t\t\t\"techcheckModules\": techcheck_modules,\n\t\t\t\t\"abtestVersion\": (abtest && abtest.version) ? abtest.version : UNDEF\n\t\t\t};\n\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param data contain all questions\n\t * @param filterOptions get from activity query data\n\t * @param randomQuestion get from activity query data\n\t * @param randomOptionName specific which property(option of the question) we need to random\n\t * @returns {data}\n\t */\n\tfunction filterData(data, filterOptions, randomQuestion, randomOptionName) {\n\t\tvar random = filterOptions ? filterOptions.random : \"\";\n\t\tvar questionNo = filterOptions ? filterOptions.questionNo : \"\";\n\t\tvar optionNo = filterOptions ? filterOptions.optionNo : \"\";\n\n\t\tif(random) {\n\t\t\tif(randomQuestion){\n\t\t\t\tdata = _.shuffle(data);\n\t\t\t}\n\n\t\t\tif(randomOptionName){\n\t\t\t\t// for scoring\n\t\t\t\t$.each(data, function(entryIndex,entry){\n\t\t\t\t\tif(entry[randomOptionName]) {\n\t\t\t\t\t\t$.each(entry[randomOptionName], function(entryOptionIndex, entryOption){\n\t\t\t\t\t\t\t//set original_index just at the begining\n\t\t\t\t\t\t\tif(entryOption.original_index === UNDEF){\n\t\t\t\t\t\t\t\tentryOption.original_index = entryOptionIndex;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$.each(data, function(entryIndex,entry){\n\t\t\t\t\tif(entry[randomOptionName]) {\n\t\t\t\t\t\tentry[randomOptionName] = _.shuffle(entry[randomOptionName]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(questionNo && $.isNumeric(questionNo)) {\n\t\t\tdata = data.slice(0, questionNo);\n\t\t}\n\n\t\tif(optionNo && $.isNumeric(optionNo)) {\n\t\t\t$.each(data, function(entryIndex,entry){\n\t\t\t\tif(entry[randomOptionName]) {\n\t\t\t\t\tentry[randomOptionName] = entry[randomOptionName].slice(0, optionNo);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t//for automation test assets, use troop2.0 version\n\t\t$('<div data-weave=\"school-ui-activity/shared/automation-test/main(assets)\"></div>')\n\t\t\t.addClass(CLS_AT_ASSETS)\n\t\t\t.data(\"assets\", data)\n\t\t\t.appendTo(\"body\")\n\t\t\t.weave();\n\n\t\treturn data;\n\t}\n\n\tfunction setVideoLowQualityUrl(videoObj) {\n\t\tif (videoObj && videoObj.url) {\n\t\t\tvar patternCQ5 = /^(?:\\w+:\\/\\/[\\w\\.-]+(?:\\:\\d+)?)?\\/dam\\//i;     //match ^(protocol://www.host.com(:port)?)?/dam/\n\n\t\t\tif (patternCQ5.test(videoObj.url)) {\n\t\t\t\tvideoObj.lowQualityUrl = videoObj.url + \"/_jcr_content/renditions/s.mp4\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar path = videoObj.url.substring(0, videoObj.url.lastIndexOf(\".\"));\n\t\t\t\tvar fileType = videoObj.url.substring(videoObj.url.lastIndexOf(\".\"));\n\t\t\t\tvideoObj.lowQualityUrl = path + \"_s\" + fileType;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param obj object to check\n\t * @param checkProperty decides which property name to check\n\t */\n\tfunction getAsrTechcheckModules(obj, checkProperty) {\n\n\t\tfunction hasProperty(obj, checkProperty) {\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\tfor (var i = 0; i < obj.length; i++) {\n\t\t\t\t\tif (obj[i][checkProperty]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (obj[checkProperty]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tif (hasProperty(obj, checkProperty)) {\n\t\t\tif (html5AsrRecorder.isAvailable()) {\n\t\t\t\treturn when.resolve([\n\t\t\t\t\t{ id: \"html5-mic-auth\" },\n\t\t\t\t\t{ id: \"check-audio\" }\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\treturn when.resolve([\n\t\t\t\t\t{ id: \"flash-install\" },\n\t\t\t\t\t{ id: \"flash-setting\" },\n\t\t\t\t\t{ id: \"chrome-auth\" },\n\t\t\t\t\t{ id: \"check-audio\" }\n\t\t\t\t]);\n\t\t\t}\n\t\t} else {\n\t\t\treturn when.resolve();\n\t\t}\n\t}\n\n\treturn {\n\t\tgetProcessedActivityData : function (act_id){\n\t\t\treturn EF.query.call(HUB, (ACT_PRE + act_id))\n\t\t\t\t.spread(function(data){\n\t\t\t\t\tvar content = data.activityContent;\n\t\t\t\t\treturn getActivityData(content);\n\t\t\t\t});\n\t\t}\n\t};\n});\n\n",
    "/* global module:false */\nif(typeof define !== 'function') {\n\tvar define = require('amdefine')(module);\n}\n\ndefine('school-ui-activity-container/widget/activity/activity-manager/scoring',[\"jquery\", \"when\"], function($, when) {\n\t\"use strict\";\n\n    /*\n     *  Common scoring related properties\n     */\n\tvar IS_CORRECT = \"_isCorrect\",\n\t\tOBJ_TOSTRING = Object.prototype.toString,\n\t\tARRAY = \"[object Array]\",\n\t\tOBJECT = \"[object Object]\",\n\t\tEXCLUDED_PROPERTY_ARR = [\"collapsed\", \"indexed\", \"expires\"];\n\n    /*\n     *  ASR scoring related properties\n     */\n\tvar NUM_ASR_NOT_PASSED_ITEMS = \"iNOT_PASSED\",\n\t\tNUM_ASR_NEED_PASSED_ITEMS = \"iNEED_PASSED\",\n\t\tASR_WORDS = \"_asrWords\",\n\t\tORINGNAL_INDEX = \"original_index\",\n\t\tID = \"_id\",\n\t\tSELECTED = \"selected\";\n\n\tvar iBASE_LINE = 70,\n\t\tdepth = 1;\n\n\tvar ENUM_SCORING_TYPE = {\n        /*ASR scoring type*/\n\t\t\"ASR\": \"asr\",\n        /*Grouping like scoring type*/\n\t\t\"GP\": \"grouping\",\n        /*Default scoring type*/\n\t\t\"DEFAULT\": \"default\"\n\t};\n\n    /*\n     *   Indicate whether 'o1' is sub-object of 'o2'\n     */\n\n\tfunction isSubObj(o1, o2) {\n\t\tif(o1 === o2) {\n\t\t\treturn true;\n\t\t}\n\t\tif(o1 === undefined || o1 === null || typeof(o1) !== \"object\") {\n\t\t\treturn false;\n\t\t}\n\t\tif(o2 === undefined || o2 === null || typeof(o2) !== \"object\") {\n\t\t\treturn false;\n\t\t}\n\n\t\tif(o1.constructor === o2.constructor) {\n\t\t\tif(isArray(o1)) {\n\t\t\t\tvar len = o1.length;\n\t\t\t\twhile(len--) {\n\t\t\t\t\tif(!isSubObj(o1[len], getElById(o2, getIdProp(o1[len])))) return false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor(var i in o1) {\n                    //Somtimes, we need use '_id' or 'id' to do scoring opration,\n                    //So we still need iterate '_id' and 'id' property\n\t\t\t\t\tif(arrayContains(EXCLUDED_PROPERTY_ARR, i)) continue;\n\n\t\t\t\t\tif(typeof(o1[i]) === \"object\") {\n\t\t\t\t\t\tif(!isSubObj(o1[i], o2[i])) return false;\n\t\t\t\t\t} else if(o1[i] !== o2[i]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n    /**\n    *   a is an array\n        item is a string element\n    */\n\tfunction arrayContains(a, item) {\n\t\tvar ret = false;\n\t\tif(Array.prototype.indexOf) {\n\t\t\tret = !! ~a.indexOf(item);\n\t\t} else {\n\t\t\t$.each(a, function(i, v) {\n\t\t\t\tif(item === v) {\n\t\t\t\t\tret = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn ret;\n\t}\n\n    /**\n     *  Return id or _id property of object.\n     */\n\n\tfunction getIdProp(obj) {\n\t\treturn obj[\"_id\"] || obj[\"id\"];\n\t}\n    /**\n     *   Assert obj is an array or not\n     */\n\n\tfunction isArray(obj) {\n\t\treturn OBJ_TOSTRING.call(obj) === ARRAY;\n\t}\n\n\tfunction isPlainObj(obj) {\n\t\treturn OBJ_TOSTRING.call(obj) === OBJECT;\n\t}\n    /*\n     * Get activity property by activity type,such as \"sequences\",\"audios\"\n     */\n\n\tfunction getSameArrayProps(source, scoring) {\n\t\tif(!source || !scoring) return;\n\t\tvar ret = [];\n\t\tfor(var i in source) {\n\t\t\tif(source.hasOwnProperty(i) && scoring.hasOwnProperty(i) && isArray(source[i])) {\n\t\t\t\tret.push(i);\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n    /*\n     *  Get Specific items from 'objArray' by object's property 'id'\n     */\n\n\tfunction getElById(objArray, id) {\n\t\tvar len = objArray.length,\n\t\t\tcurrItem;\n\n\t\twhile(len--) {\n\t\t\tcurrItem = objArray[len];\n\t\t\tif(getIdProp(currItem) === id) {\n\t\t\t\treturn currItem;\n\t\t\t}\n\t\t}\n\t}\n\n    /**!\n    *  Indicate have ASR scoring record or not, if have ,\n       then do ASR scroing check too.\n\n    *  Params:\n    *  source {Object} current source content\n    */\n\tfunction checkASRScoring(source){\n\t\tif(source && source[ASR_WORDS]){\n\t\t\treturn source[IS_CORRECT];\n\t\t}\n\n\t\treturn;\n\t}\n\n    /*\n     *  Mark 'isCorrect' flag for source content\n     */\n\tfunction markJSON(currSource, currScoring) {\n        //For root element, it don't need to marked here\n\t\tif(depth === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar result = true;\n\t\tif(isSubObj(currScoring, currSource) || checkASRScoring(currSource)) {\n\t\t\tcurrSource[IS_CORRECT] = true;\n\t\t} else {\n\t\t\tcurrSource[IS_CORRECT] = false;\n\t\t\tresult = false;\n\t\t}\n\n\t\tdepth--;\n\n\t\treturn result;\n\t}\n\n    /*\n     * This function actually is used to check whether current activity have passed or not,\n     *   When 70% questions have passed, then activity passed.\n     *\n     *   actContent {Object}\n     *   actScoring {Object}\n     */\n\n\tfunction markRoot(actContent, actScoring) {\n\t\tif(!actContent || !actScoring) return;\n\n\t\tvar arrProps = getSameArrayProps(actContent, actScoring),\n\t\t\tpropsLen = arrProps.length,\n\t\t\tlen, i, iCorr = 0,\n\t\t\tcurrItem, currPorp;\n\n\t\twhile(propsLen--) {\n\t\t\tcurrPorp = arrProps[propsLen];\n\t\t\tcurrItem = actContent[currPorp];\n\t\t\tlen = currItem.length;\n\n\t\t\tif(currItem[IS_CORRECT]) continue;\n\n\t\t\tfor(i = 0; i < len; i++) {\n\t\t\t\tif(currItem[i][IS_CORRECT]) {\n\t\t\t\t\tiCorr++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(iCorr * 100 / len < iBASE_LINE) {\n\t\t\t\tactContent[IS_CORRECT] = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tactContent[IS_CORRECT] = true;\n\t}\n\n    /*\n        process and update jsondata\n        actContent : activity content\n        actScoring : activity scoring\n    */\n\tfunction parse(actContent, actScoring) {\n\t\tif(!actContent || !actScoring) {\n\t\t\treturn;\n\t\t}\n\n        //traverse depth increase\n\t\tdepth++;\n\n\t\tvar currProp, currScoring, currSource, currId, len, result = false;\n\t\tvar arrProps = getSameArrayProps(actContent, actScoring),\n\t\t\tarrPorpLen = arrProps.length;\n\n\t\twhile(arrPorpLen--) {\n\n\t\t\tcurrProp = arrProps[arrPorpLen];\n\t\t\tcurrScoring = actScoring[currProp];\n\t\t\tcurrSource = actContent[currProp];\n\t\t\tlen = currScoring.length;\n\t\t\tcurrSource[IS_CORRECT] = true;\n\n\t\t\twhile(len--) {\n\t\t\t\tif(isPlainObj(currScoring[len])) {\n\t\t\t\t\tcurrId = getIdProp(currScoring[len]);\n\t\t\t\t\tparse(getElById(currSource, currId), currScoring[len]) || (currSource[IS_CORRECT] = false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(actScoring) {\n\t\t\tresult = markJSON(actContent, actScoring);\n\t\t}\n\n\t\treturn result;\n\t}\n\n    /* ASR Scoring Logic\n     *  actContent {Object} activity content node in json data\n     *  actScoring {Object} activity scoring node in json data\n     *  currResult {Object} Current ASR recganize result\n     *      Notes:\n     *          ASR Scoring have two types:\n     *          1. Only have one option to recognize\n     *              In this case, only need to go through ASR_Scoring logic\n     *          2. Recgonize more than one options,'currResult' will contains 'index' property\n     *              In this case, need to go through ASR_Scoring and Common_Scoring logic\n     *\n     */\n\n\tfunction parseASRScoring(actContent, actScoring, currResult) {\n\t\tvar arrEls = getSameArrayProps(actContent, actScoring),\n\t\t\tiNotPassed = 0,\n\t\t\tiNeedPassed, length, allItems, currItem, currSubItem;\n\n        //todo: find most case for ASRResult\n\t\tcurrResult = currResult[0];\n\n\t\tif(arrEls && arrEls.length && currResult) {\n            //Note: 1. Here assume \"actContent\" only have one array element\n            //      2. 'this' is point to current activity instance\n\t\t\tallItems = actContent[arrEls[0]];\n\n\t\t\t$.each(allItems, function(i, item) {\n\t\t\t\tif(item[ID] === currResult[ID]) {\n\t\t\t\t\tcurrItem = item;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n            //ASR Result contains 'index' property\n\t\t\tif(currItem) {\n                //1. find current recording sub-item in currentItem\n\t\t\t\tfor(var key in currItem) {\n\t\t\t\t\tif(key !== ASR_WORDS && currItem.hasOwnProperty(key) && isArray(currItem[key])) {\n\t\t\t\t\t\tcurrSubItem = currItem[key];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n                //Notes: Because 'index' always exists in ASR Result,\n                //       So we need to check wheither has sub-item.\n                //       if it is has, we need to preprocess json and go through common scoring.\n                //       Otherwise, we only need mark json by result score.\n\t\t\t\tif(currSubItem) {\n                    //2. mark selected symbol\n\t\t\t\t\t$.each(currSubItem, function(i, item) {\n\t\t\t\t\t\tif(item[ORINGNAL_INDEX] === currResult.index - 1) {\n\t\t\t\t\t\t\titem[SELECTED] = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titem[SELECTED] = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n                    //3. go trrough common scoring logic\n\t\t\t\t\tparse(actContent, actScoring);\n\t\t\t\t} else {\n\t\t\t\t\tif(currResult.score >= iBASE_LINE) {\n\t\t\t\t\t\tcurrItem[IS_CORRECT] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrItem[IS_CORRECT] = false;\n\t\t\t\t\t}\n\t\t\t\t\tdelete currResult.score;\n\n\t\t\t\t\tif(currResult.words) {\n\t\t\t\t\t\t$.each(currResult.words, function(i, word) {\n\t\t\t\t\t\t\tif(word.score >= iBASE_LINE) {\n\t\t\t\t\t\t\t\tword[IS_CORRECT] = true;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tword[IS_CORRECT] = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdelete word.score;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcurrItem[ASR_WORDS] = currResult.words;\n\t\t\t\t\t}\n\t\t\t\t}\n\n                //mark ASR related JSON\n\t\t\t\t$.each(allItems, function(i, item) {\n\t\t\t\t\tif(!item[IS_CORRECT]) {\n\t\t\t\t\t\tiNotPassed++;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlength = allItems.length;\n\t\t\t\tiNeedPassed = Math.ceil(length * iBASE_LINE / 100);\n\n\t\t\t\tactContent[NUM_ASR_NOT_PASSED_ITEMS] = iNotPassed;\n\t\t\t\tactContent[NUM_ASR_NEED_PASSED_ITEMS] = iNeedPassed;\n\t\t\t\tactContent[IS_CORRECT] = iNeedPassed <= length-iNotPassed;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tcompute: function computeScore(actJSON, actInstance, option, /*data1,data2 ...*/ deferred) {\n\t\t\tdeferred = deferred || $.Deferred();\n            //reset current depth\n\t\t\tdepth = 1;\n\t\t\toption = option || {\n\t\t\t\tscoringType: ENUM_SCORING_TYPE.DEFAULT\n\t\t\t};\n\n\t\t\tswitch(option.scoringType) {\n\t\t\t\tcase ENUM_SCORING_TYPE.ASR:\n\t\t\t\t\tparseASRScoring.call(actInstance, actJSON.content, actJSON.scoring, option.currASRResult);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ENUM_SCORING_TYPE.DEFAULT:\n\t\t\t\tdefault:\n\t\t\t\t\tparse.call(actInstance, actJSON.content, actJSON.scoring);\n\t\t\t\t\tmarkRoot(actJSON.content, actJSON.scoring);\n\t\t\t}\n\n\t\t\tdeferred.resolve(actJSON);\n\t\t\treturn when.resolve(actJSON);\n\t\t}\n\t}\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-manager/manager.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-hd\\\" data-weave=\\\"school-ui-activity-container/widget/activity/activity-reference/main\\\"></div>\\n<div class=\\\"ets-act-bd\\\">\\n\\t<div class=\\\"ets-act-bd-main\\\">\\n    \\t<!--render activity luncher here-->\\n\\t</div>\\n\\t<div class=\\\"ets-act-epaper\\\">\\n\\t\\t<div class=\\\"ets-act-bd-epaper\\\">\\n\\t\\t\\t<!-- render epaper here -->\\n\\t\\t</div>\\t\\t\\n\\t</div>\\n\\n</div>\\n<div class=\\\"ets-act-ft\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/activity-manager/main',[\n\t\"when\",\n\t\"poly/array\",\n\t\"jquery\",\n\t\"json2\",\n\t\"troopjs-ef/component/widget\",\n\t\"./scoring\",\n\t\"./data-bridge\",\n\t\"school-ui-shared/utils/progress-state\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"school-ui-shared/utils/feature-access\",\n\t\"school-ui-shared/utils/update-helper\",\n\t\"school-ui-activity-container/util/ccl-cache-server\",\n\t\"troopjs-browser/route/uri\",\n\t\"logger\",\n\t\"school-ui-shared/plugins/techcheck/techcheck-render\",\n\t\"asr-core\",\n\t\"template!./manager.html\"\n], function ActivityManagerModule(\n\twhen,\n\tpolyArray,\n\t$,\n\tJSON,\n\tWidget,\n\tscoring,\n\tbridge,\n\tprogressState,\n\ttypeidParser,\n\tfeatureAccess,\n\tupdateHelper,\n\tCCL_CACHE_SERVER,\n\tURI,\n\tLogger,\n\ttechcheckRender,\n\thtml5AsrRecorder,\n\ttManager\n) {\n\n\t\"use strict\";\n\n\tvar UNDEF;\n\n\tvar $ELEMENT = \"$element\";\n\n\tvar REG_EPAPER = /^MulChoTxt$|^MulSelTxt$/;\n\n\tvar STEP_ID = \"step_id\";\n\n\tvar IS_REVIEW = \"isReview\";\n\tvar STU_ID = \"studentCourseId\";\n\tvar MEM_ID = \"memberId\";\n\tvar ACT_ID = \"act_id\";\n\tvar ACT_TEMPLATE_ID = \"act_template_id\";\n\tvar ACT_CONTENT = \"activityContent\";\n\tvar EPAPER_TYPE = \"epaperType\";\n\tvar LAYOUT_TYPE = \"_layoutType\";\n\tvar SCORING = \"scoring\";\n\tvar TARGET = \"target\";\n\tvar HAS_PASSED = \"hasPassed\";\n\tvar ABTEST_VERSION = \"abtestVersion\";\n\n\tvar CLS_ACTIVITY_BODY = \"ets-act-bd-main\";\n\tvar CLS_EPAPER_BODY = \"ets-act-bd-epaper\";\n\tvar CLS_ACT_PASS = \"ets-pass\";\n\n\tvar CCL_EPAPER_TYPE = \"ccl!'school.courseware.epaper.fixed.enable'\";\n\n\tvar HUB_SHOW_LOADING = \"activity-container/show/loading\";\n\tvar HUB_HIDE_LOADING = \"activity-container/hide/loading\";\n\tvar HUB_RESIZE_CONTAINER = \"activity-container/resize\";\n\tvar HUB_TECHCHECK_REQUEST = \"tech-check/request\";\n\tvar HUB_TECHCHECK_CANCEL = \"tech-check/cancel\";\n\tvar HUB_MOVE_ON_ACT = \"activity/submit/score/proxy\";\n\tvar HUB_CONTAINER_NEXT_ACT = \"activity-container/nextActivity\";\n\n\tvar TECHCHECK_INITIALIZED = \"_techcheckInitialized\";\n\tvar TECHCHECK_CHECK_AUDIO_ALREADY_SHOWN = '_activity_techcheck_checkaudio_already_shown';\n\tvar CACHE_SERVER = \"_cache_server\";\n\n\tvar FLASH_PATH = \"_shared/techcheck-flash\";\n\tvar FLASH_VERSION = \"{version}\";\n\tvar FLASH_NAME = \"techcheck.swf\";\n\n\tfunction checkEpaper(json) {\n\t\tvar refs = json && json.references;\n\t\treturn refs && (refs.htmlPap || refs.imgPap);\n\t}\n\n\tfunction weaveEpaper(options) {\n\t\tvar me = this;\n\t\tif (checkEpaper(options[ACT_CONTENT]) && options[ACT_CONTENT].references) {\n\t\t\t//default epaper type\n\t\t\toptions[ACT_CONTENT].references._epaperType = \"expand\";\n\n\t\t\tif (options[EPAPER_TYPE] &&\n\t\t\t\toptions[EPAPER_TYPE].value === \"true\" &&\n\t\t\t\t//if there is a mulit select text | mulit choice text template\n\t\t\t\tREG_EPAPER.test(options[ACT_CONTENT].templateCode)) {\n\n\t\t\t\toptions[ACT_CONTENT].references._epaperType = \"fixed\";\n\t\t\t\toptions[LAYOUT_TYPE] = \"right\";\n\t\t\t}\n\t\t\t//\n\t\t\tvar $epaperBody = me[$ELEMENT].find(\".\" + CLS_EPAPER_BODY).empty();\n\t\t\treturn $(\"<div></div>\")\n\t\t\t\t.data(\"json\", options[ACT_CONTENT].references)\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/epaper/main(json)\")\n\t\t\t\t.appendTo($epaperBody)\n\t\t\t\t.weave();\n\t\t}\n\t\treturn when.resolve();\n\t}\n\n\tfunction weaveActivity(options) {\n\t\tvar me = this;\n\t\tvar $activityBody = me[$ELEMENT].find(\".\" + CLS_ACTIVITY_BODY).empty();\n\t\tvar promise = $('<div class=\"ets-activity-launcher\"></div>')\n\t\t\t.data(\"option\", options)\n\t\t\t.attr(\"data-weave\", \"school-ui-activity/launcher/main(option)\")\n\t\t\t.appendTo($activityBody)\n\t\t\t.weave();\n\t\tpromise.otherwise(function (error) {\n\t\t\tLogger.log([\n\t\t\t\t\"Activity error: \" + typeidParser.parseId(me[ACT_ID]) + \" weave error.\" +\n\t\t\t\t\"Message: \" + (error ? error.message : \"NULL\") + \".\" +\n\t\t\t\t\"Type: \" + (options[ACT_CONTENT] ? options[ACT_CONTENT].templateCode : \"NULL\") + \".\"\n\t\t\t].join(' | '));\n\t\t});\n\t\treturn promise;\n\t}\n\n\tfunction loadActivity() {\n\t\tvar me = this;\n\t\tvar activityId = typeidParser.parseId(me[ACT_ID]);\n\t\tvar $activityBody = me[$ELEMENT].find(\".\" + CLS_ACTIVITY_BODY).empty();\n\t\tvar $epaperBody = me[$ELEMENT].find(\".\" + CLS_EPAPER_BODY).empty();\n\n\t\tme.publish(HUB_SHOW_LOADING, me[ACT_ID]);\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t//let the loading start by browser reflow\n\t\t\tsetTimeout(resolve, 0);\n\t\t}).then(function () {\n\t\t\treturn when.all([\n\t\t\t\tbridge.getProcessedActivityData(activityId),\n\t\t\t\tme.query(me[ACT_ID] + \".progress\"),\n\t\t\t\tme.query(CCL_EPAPER_TYPE),\n\t\t\t\t($activityBody.length && $epaperBody.length) || me.html(tManager)\n\t\t\t]);\n\t\t}).spread(function (activityData, actPros, epaperQuery) {\n\t\t\t// Create option\n\t\t\tvar options = {};\n\t\t\toptions[TARGET] = activityData.basePath;\n\t\t\toptions[ACT_CONTENT] = activityData.data;\n\t\t\toptions[EPAPER_TYPE] = epaperQuery[0];\n\t\t\toptions[LAYOUT_TYPE] = \"across\"; // default activity layout type\n\t\t\toptions[SCORING] = scoring;\n\t\t\toptions[IS_REVIEW] = me[IS_REVIEW];\n\t\t\toptions[ACT_ID] = me[ACT_ID];\n\t\t\toptions[ACT_TEMPLATE_ID] = me[ACT_TEMPLATE_ID];\n\t\t\toptions[HAS_PASSED] = actPros[0] && progressState.hasPassed(actPros[0].progress.state);\n\t\t\toptions[ABTEST_VERSION] = activityData.abtestVersion;\n\n\t\t\t//start to weave\n\t\t\tme[$ELEMENT].toggleClass(CLS_ACT_PASS, options[HAS_PASSED]);\n\t\t\treturn renderTechCheck.call(me, activityData)\n\t\t\t\t.then(function (techCheckResult) {\n\t\t\t\t\tif (techCheckResult && techCheckResult.skip) {\n\t\t\t\t\t\tme.publish(HUB_MOVE_ON_ACT);\n\t\t\t\t\t\tme.publish(HUB_CONTAINER_NEXT_ACT);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (techCheckResult && techCheckResult.proceedWithoutAsr) {\n\t\t\t\t\t\toptions[ACT_CONTENT].asrDisabled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tweaveEpaper.call(me, options);\n\t\t\t\t\treturn weaveActivity.call(me, options)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\tme.publish(HUB_HIDE_LOADING);\n\t\t\t\t\t\t\tme.publish(HUB_RESIZE_CONTAINER);\n\t\t\t\t\t\t\t// Store new _beforeLoadActTime\n\t\t\t\t\t\t\tme._beforeLoadActTime = +new Date;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.otherwise(function () {\n\t\t\t\t\t\t\t// Remove broken $activityContent\n\t\t\t\t\t\t\t$activityBody.empty();\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\n\tfunction renderActivity() {\n\t\tvar me = this;\n\t\tif (!me[ACT_ID] || !me[STU_ID] || !me[MEM_ID] || !me[STEP_ID] || !me[$ELEMENT]) {\n\t\t\treturn;\n\t\t}\n\t\tvar uri = URI(document.location.href);\n\t\t// don't need to validate the activity for at preview mode,\n\t\t// because only the activity_id provided in the hash when preview in at\n\t\tvar atpreview = uri.query && uri.query.atpreview !== undefined;\n\n\t\tvar stepId = me[STEP_ID];\n\t\twhen(atpreview ?\n\t\t\tatpreview :\n\t\t\tme.query(stepId + \".progress\")\n\t\t)\n\t\t\t.spread(function (step) {\n\t\t\t\t// Logs to understand \"Cannot read property 'state' of undefined\", SPC-7147\n\t\t\t\tif (!step) {\n\t\t\t\t\tLogger.log('Cannot retrieve step ' + stepId);\n\t\t\t\t} else if (!step.progress || !step.children) {\n\t\t\t\t\tvar stepJson;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tstepJson = JSON.stringify(step, function (key, value) {\n\t\t\t\t\t\t\tif (key === 'parent') {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (key === 'children') {\n\t\t\t\t\t\t\t\treturn value.map(function (child) {\n\t\t\t\t\t\t\t\t\treturn { id: child.id };\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tstepJson = String(e);\n\t\t\t\t\t}\n\t\t\t\t\tLogger.log('Error in properties of step ' + step.id + ' (' + stepId + '): ' + stepJson);\n\t\t\t\t}\n\n\t\t\t\tvar match;\n\t\t\t\tme[IS_REVIEW] = progressState.hasPassed(step.progress.state);\n\t\t\t\tstep.children.forEach(function (act) {\n\t\t\t\t\tif (act.id === me[ACT_ID]) {\n\t\t\t\t\t\tmatch = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn match;\n\t\t\t})\n\t\t\t.then(function (isValid) {\n\t\t\t\treturn isValid && loadActivity.call(me);\n\t\t\t});\n\t}\n\n\tfunction renderAsrNotSupportedWidget(options) {\n\t\tvar me = this;\n\t\tvar $activityBody = me[$ELEMENT].find(\".\" + CLS_ACTIVITY_BODY).empty();\n\t\t$('<div class=\"ets-activity-launcher\"></div>')\n\t\t\t.data(\"resolver\", options.resolver)\n\t\t\t.data(\"html5AsrAvailable\", options.html5AsrAvailable)\n\t\t\t.data(\"lacksFlash\", options.lacksFlash)\n\t\t\t.data(\"hasNoAsrFallback\", options.hasNoAsrFallback)\n\t\t\t.attr(\"data-weave\", \"school-ui-activity-container/widget/activity/asr-not-supported/main\")\n\t\t\t.appendTo($activityBody)\n\t\t\t.weave();\n\t}\n\n\tfunction renderTechCheck(activityData) {\n\t\tvar me = this;\n\t\tvar checkModules = activityData.techcheckModules;\n\t\tvar hasNoAsrFallback = activityData.data.hasNoAsrFallback;\n\n\t\tif (!checkModules || checkModules.length === 0) {\n\t\t\treturn when.resolve();\n\t\t}\n\n\t\treturn me[TECHCHECK_INITIALIZED].promise.then(function () {\n\t\t\t//remove Overlay and tech check popup modal\n\t\t\ttechcheckRender.removeOverlay();\n\t\t\treturn me.publish(HUB_TECHCHECK_CANCEL);\n\t\t}).then(function () {\n\t\t\treturn me[CACHE_SERVER];\n\t\t}).then(function (cacheServer) {\n\t\t\t// Remove check-audio if already passed once\n\t\t\tcheckModules = checkModules.filter(function (module) {\n\t\t\t\tif (module.id === 'check-audio') {\n\t\t\t\t\treturn localStorage.getItem(TECHCHECK_CHECK_AUDIO_ALREADY_SHOWN) !== 'true';\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tvar techcheckOptions = {\n\t\t\t\tflashPath: [cacheServer, FLASH_PATH, FLASH_VERSION, FLASH_NAME].join(\"/\")\n\t\t\t};\n\n\t\t\tvar html5AsrAvailable = html5AsrRecorder.isAvailable();\n\t\t\tif (html5AsrAvailable) {\n\t\t\t\ttechcheckOptions.recorderMode = 'html5';\n\t\t\t}\n\n\t\t\tvar latestTechCheckResults = [];\n\t\t\treturn when.promise(function (resolve, reject) {\n\t\t\t\tme.publish(HUB_TECHCHECK_REQUEST, checkModules, techcheckOptions).then(function (checkResults) {\n\t\t\t\t\tcheckResults.forEach(function (module) {\n\t\t\t\t\t\tif (module.id === 'check-audio' && module.passed) {\n\t\t\t\t\t\t\tlocalStorage.setItem(TECHCHECK_CHECK_AUDIO_ALREADY_SHOWN, 'true');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.publish(HUB_SHOW_LOADING, me[ACT_ID]);\n\t\t\t\t\tresolve({});\n\t\t\t\t}, function ignoreCancelledTechcheck(error) {\n\t\t\t\t\tif (error !== 'cancel techcheck') {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if anything but check-audio failed, show popup\n\t\t\t\t\t\tvar failedTechCheck = false;\n\t\t\t\t\t\tvar lacksFlash = false;\n\t\t\t\t\t\tlatestTechCheckResults.forEach(function (result) {\n\t\t\t\t\t\t\tif (result.id !== \"check-audio\" && result.passed === false) {\n\t\t\t\t\t\t\t\tfailedTechCheck = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (result.id === \"flash-install\" && result.passed === false) {\n\t\t\t\t\t\t\t\tlacksFlash = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (failedTechCheck) {\n\t\t\t\t\t\t\trenderAsrNotSupportedWidget.call(me, {\n\t\t\t\t\t\t\t\tresolver: resolve,\n\t\t\t\t\t\t\t\thtml5AsrAvailable: html5AsrAvailable,\n\t\t\t\t\t\t\t\tlacksFlash: lacksFlash,\n\t\t\t\t\t\t\t\thasNoAsrFallback: hasNoAsrFallback\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.publish(HUB_SHOW_LOADING, me[ACT_ID]);\n\t\t\t\t\t\t\tresolve({});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function (checkResults) {\n\t\t\t\t\tlatestTechCheckResults = checkResults;\n\t\t\t\t});\n\t\t\t\tme.publish(HUB_HIDE_LOADING);\n\t\t\t});\n\t\t});\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function () {\n\t\t\tthis._beforeLoadActTime = +new Date;\n\t\t\tthis[TECHCHECK_INITIALIZED] = when.defer();\n\t\t\tthis[CACHE_SERVER] = this.query(CCL_CACHE_SERVER).spread(function (cclCacheServer) {\n\t\t\t\treturn cclCacheServer && cclCacheServer.value || \"\";\n\t\t\t});\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\twindow.CollectGarbage && window.CollectGarbage();\n\t\t},\n\t\t\"hub:memory/plugins/tech-check/enable\": function () {\n\t\t\tthis[TECHCHECK_INITIALIZED].resolve();\n\t\t},\n\t\t\"hub:memory/context\": function onContext(context) {\n\t\t\tvar me = this;\n\t\t\tif (context) {\n\t\t\t\tfeatureAccess.setFeaturesUnicode(context.featureAccessBits);\n\t\t\t\tme[MEM_ID] = typeidParser.parseId(context.user.id);\n\t\t\t\trenderActivity.call(me);\n\t\t\t}\n\t\t},\n\t\t\"hub:memory/load/enrollment\": function onEnrollment(enrollment) {\n\t\t\tvar me = this;\n\t\t\tif (enrollment) {\n\t\t\t\tme[STU_ID] = typeidParser.parseId(enrollment.id);\n\t\t\t\trenderActivity.call(me);\n\t\t\t}\n\t\t},\n\n\t\t\"hub:memory/load/step\": function onStep(step) {\n\t\t\tvar me = this;\n\t\t\tif (step) {\n\t\t\t\tme[STEP_ID] = step.id;\n\t\t\t\trenderActivity.call(me);\n\t\t\t}\n\t\t},\n\n\t\t\"hub:memory/load/activity\": function onActivity(activity) {\n\t\t\tvar me = this;\n\t\t\tif (activity) {\n\t\t\t\tme[ACT_ID] = activity.id;\n\t\t\t\tme[ACT_TEMPLATE_ID] = activity.templateActivityId;\n\t\t\t\trenderActivity.call(me);\n\t\t\t}\n\t\t},\n\t\t\"hub/render/activity\": function onRenderActivity(act_id) {\n\t\t\tvar me = this;\n\t\t\tif (act_id) {\n\t\t\t\tme[ACT_ID] = act_id;\n\t\t\t\trenderActivity.call(me);\n\t\t\t}\n\t\t},\n\n\t\t\"hub/activity/submit/score\": function onActivitySubmitScore(score, content) {\n\t\t\tvar me = this,\n\t\t\t\tsubmitTimeout;\n\n\t\t\t//submit score to server\n\t\t\tvar _timeCost = Math.ceil((+new Date - me._beforeLoadActTime) / 60000) || 1; // 60000 = 1000*60; the min study minutes is 1, should not be 0.\n\t\t\tvar _score = typeof score === \"number\" ? score : 100;\n\n\t\t\tif (_timeCost <= 0) {\n\t\t\t\t// if the computer date time changed to a earlier date, we keep it as 1 minute.\n\t\t\t\t_timeCost = 1;\n\t\t\t} else if (_timeCost > 32767) {\n\t\t\t\t// server value type is INT16, max is 32767\n\t\t\t\t_timeCost = 32767;\n\t\t\t}\n\t\t\t/*\n\t\t\t Start submit score, if submit score not finished after 1 sec,\n\t\t\t then here will publish an event\n\t\t\t */\n\t\t\tsubmitTimeout = setTimeout(function () {\n\t\t\t\tme.publish(HUB_SHOW_LOADING, me[ACT_ID]);\n\t\t\t}, 1000);\n\n\t\t\t// school interface activity isReview\n\t\t\treturn me.publish(\"school/interface/activityIsReview\", me[IS_REVIEW]).spread(function (isReview) {\n\t\t\t\treturn updateHelper.submitScore({\n\t\t\t\t\t\"studentActivityId\": typeidParser.parseId(me[ACT_ID]),\n\t\t\t\t\t\"score\": _score,\n\t\t\t\t\t\"minutesSpent\": _timeCost,\n\t\t\t\t\t\"studyMode\": isReview ? 1 : 0\n\t\t\t\t}).spread(function (pros) {\n\t\t\t\t\t// sent writing content after submit score success\n\t\t\t\t\tvar submitPromise;\n\t\t\t\t\tif (content !== UNDEF) {\n\t\t\t\t\t\tsubmitPromise = updateHelper.integrationSubmitWriting({\n\t\t\t\t\t\t\t\"writingScore\": {\n\t\t\t\t\t\t\t\t\"StudentActivityId\": typeidParser.parseId(me[ACT_ID]),\n\t\t\t\t\t\t\t\t\"Content\": content || \"\",\n\t\t\t\t\t\t\t\t\"StartTime\": new Date(me._beforeLoadActTime).toUTCString(),\n\t\t\t\t\t\t\t\t\"CompleteTime\": new Date().toUTCString()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tme.publish(\"activity/update/progress\", pros);\n\t\t\t\t\treturn submitPromise;\n\t\t\t\t}).otherwise(function (errorMsg) {\n\t\t\t\t\tif (typeof errorMsg === \"object\") {\n\t\t\t\t\t\tLogger.log(\"Activity error: Submit score failed cause by \" + JSON.stringify(errorMsg));\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tLogger.log(\"Activity error: Submit score failed cause by \" + errorMsg);\n\t\t\t\t\t}\n\t\t\t\t}).ensure(function () {\n\t\t\t\t\tclearTimeout(submitTimeout);\n\t\t\t\t\t/*\n\t\t\t\t\t Publish submit score finished, and pass an param 'act_id',\n\t\t\t\t\t If activity changed during submiting score, will not nothing.\n\t\t\t\t\t */\n\t\t\t\t\tme.publish(HUB_HIDE_LOADING);\n\t\t\t\t\tme._beforeLoadActTime = +new Date;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/activity-reference/reference.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-intro\\\">\\n    <div class=\\\"ets-act-intro-title\\\" data-at-id=\\\"lbl-title\\\"></div>\\n    <div class=\\\"ets-act-intro-desc\\\" data-at-id=\\\"lbl-description\\\"></div>\\n</div>\\n<div class=\\\"ets-act-live-chat\\\" data-weave=\\\"school-ui-activity-container/widget/plugin/live-chat/main\\\">\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/activity-reference/main',[\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"when\",\n\t\"school-ui-shared/utils/language-fixing\",\n\t\"markdownjs\",\n\t\"template!./reference.html\"\n], function ReferenceModule($, Widget, when, languageFixing, md, tReference) {\n\t\"use strict\";\n\tvar $ELEMENT = \"$element\";\n\tvar SEL_INTRO_TITLE = \".ets-act-intro .ets-act-intro-title\";\n\tvar SEL_INTRO_DESC = \".ets-act-intro .ets-act-intro-desc\";\n\tvar CLS_NONE = \"ets-none\";\n\n\tvar PROP_CULTURE_CODE = \"cultureCode\";\n\tvar PROP_ACT = \"_activity\";\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me[PROP_ACT] || !me[PROP_CULTURE_CODE]) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $title = me[$ELEMENT].find(SEL_INTRO_TITLE);\n\t\tvar $desc = me[$ELEMENT].find(SEL_INTRO_DESC);\n\t\tvar reference = me[PROP_ACT] &&\n\t\t\tme[PROP_ACT].activityContent &&\n\t\t\tme[PROP_ACT].activityContent.references;\n\n\t\twhen(($title.length && $desc.length) || me.html(tReference)).then(function () {\n\n\t\t\t$title = me[$ELEMENT].find(SEL_INTRO_TITLE);\n\t\t\t$desc = me[$ELEMENT].find(SEL_INTRO_DESC);\n\n\t\t\tif (reference) {\n\t\t\t\tvar titleText = reference.title && reference.title.length > 0\n\t\t\t\t\t? md.toHTML(reference.title)\n\t\t\t\t\t: \"\";\n\n\t\t\t\t//Prepend standard instruction if exist\n\t\t\t\tif (reference.standardInstruction && reference.standardInstruction.length > 0) {\n\t\t\t\t\ttitleText += \" \" + md.toHTML(reference.standardInstruction);\n\t\t\t\t}\n\n\t\t\t\tlanguageFixing($title, titleText, me[PROP_CULTURE_CODE]);\n\t\t\t\t$title.html(titleText);\n\n\t\t\t\tvar descText = reference.desc && reference.desc.length > 0\n\t\t\t\t\t? md.toHTML(reference.desc)\n\t\t\t\t\t: \"\";\n\n\t\t\t\tlanguageFixing($desc, descText, me[PROP_CULTURE_CODE]);\n\t\t\t\t$desc.html(descText);\n\n\t\t\t\tme[$ELEMENT].removeClass(CLS_NONE);\n\t\t\t} else {\n\t\t\t\t$title.html(\"\");\n\t\t\t\t$desc.html(\"\");\n\t\t\t}\n\t\t});\n\t}\n\n\treturn Widget.extend({\n\t\t\"hub:memory/load/activity\": function onLoadRef(activity) {\n\t\t\tvar me = this;\n\t\t\tactivity && (me[PROP_ACT] = activity);\n\t\t\trender.call(me);\n\t\t},\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tvar me = this;\n\t\t\tcontext && context[PROP_CULTURE_CODE] && (me[PROP_CULTURE_CODE] = context[PROP_CULTURE_CODE]);\n\t\t\trender.call(me);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/asr-not-supported/asr-not-supported.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-acc-asr-not-supported\\\">\\n    <i class=\\\"ets-acc-asr-not-supported-warning-icon\\\"></i>\\n    <p class=\\\"ets-acc-asr-not-supported-notice\\\"\\n       data-blurb-id=\\\"\" +data.noticeBlurbId+ \"\\\" data-blurb-en=\\\"\" +data.noticeBlurbEn+ \"\\\"\\n       data-weave=\\\"troopjs-ef/blurb/widget\\\"></p>\\n\\n    \"; if (data.hasNoAsrFallback) { o += \"\\n    <div class=\\\"ets-acc-asr-not-supported-btn-proceed\\\" data-action=\\\"proceedWithoutAsr\\\"\\n         data-blurb-id=\\\"707725\\\" data-blurb-en=\\\"Proceed without Speech Recognition\\\"\\n         data-weave=\\\"troopjs-ef/blurb/widget\\\"></div>\\n    \"; } o += \"\\n    <div class=\\\"ets-acc-asr-not-supported-btn-skip\\\" data-action=\\\"skip\\\"\\n         data-blurb-id=\\\"707726\\\" data-blurb-en=\\\"Skip\\\"\\n         data-weave=\\\"troopjs-ef/blurb/widget\\\"></div>\\n    <div class=\\\"ets-acc-asr-not-supported-livechat\\\">\\n        <span data-blurb-id=\\\"644326\\\" data-text-en=\\\"Need help? Get in touch\\\"\\n              data-weave=\\\"troopjs-ef/blurb/widget\\\"></span>\\n        <span data-weave=\\\"techcheck-ui/widget/shared/live-chat/main('small-button')\\\"\\n              class=\\\"tck-ui-livechat-widget\\\" data-delegate=\\\"button\\\"></span>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/asr-not-supported/main',[\n\t\"when\",\n\t\"troopjs-ef/component/widget\",\n\t\"school-ui-shared/utils/browser-check\",\n\t\"template!./asr-not-supported.html\"\n], function ReferenceModule(\n\twhen,\n\tWidget,\n\tbrowserCheck,\n\ttemplate\n) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\n\tfunction computeNoticeBlurb(html5AsrAvailable) {\n\t\tvar noticeBlurbId = 709456;\n\t\tvar noticeBlurbEn = 'Please allow your Microphone to be accessed and try again.';\n\n\t\tif (!html5AsrAvailable) {\n\t\t\tvar isPc = browserCheck.device === 'pc';\n\t\t\tvar isOsx = browserCheck.os === 'osx';\n\t\t\tvar isIos = browserCheck.os === 'ios';\n\t\t\tif (isPc) {\n\t\t\t\tif (isOsx) {\n\t\t\t\t\tnoticeBlurbId = 709458;\n\t\t\t\t\tnoticeBlurbEn = 'Please use the latest version of Web browser Chrome or upgrade to Safari 11.';\n\t\t\t\t} else { // windows\n\t\t\t\t\tnoticeBlurbId = 709457;\n\t\t\t\t\tnoticeBlurbEn = 'Please use the latest version of web browser such as Chrome (preferred), Firefox. Thanks.';\n\t\t\t\t}\n\t\t\t} else { // tablet / mobile\n\t\t\t\tif (isIos) {\n\t\t\t\t\tnoticeBlurbId = 709460;\n\t\t\t\t\tnoticeBlurbEn = 'Please use Safari 11 by upgrading to iOS 11.';\n\t\t\t\t} else { // android\n\t\t\t\t\tnoticeBlurbId = 709459;\n\t\t\t\t\tnoticeBlurbEn = 'Please use the latest version of Chrome or Firefox. Thanks.';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tnoticeBlurbId: noticeBlurbId,\n\t\t\tnoticeBlurbEn: noticeBlurbEn\n\t\t};\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tvar $element = this.$element;\n\t\t\tvar html5AsrAvailable = $element.data('html5AsrAvailable');\n\t\t\tvar hasNoAsrFallback = $element.data('hasNoAsrFallback');\n\n\t\t\tvar noticeBlurb = computeNoticeBlurb(html5AsrAvailable);\n\n\t\t\treturn when.all([\n\t\t\t\tthis.html(template, {\n\t\t\t\t\thasNoAsrFallback: hasNoAsrFallback,\n\t\t\t\t\thtml5AsrAvailable: html5AsrAvailable,\n\t\t\t\t\tnoticeBlurbId: noticeBlurb.noticeBlurbId,\n\t\t\t\t\tnoticeBlurbEn: noticeBlurb.noticeBlurbEn\n\t\t\t\t}),\n\t\t\t\t// reset bottom bar\n\t\t\t\tthis.publish(\"activity/prop/changed/completed\", false),\n\t\t\t\tthis.publish(\"activity/prop/changed/type\", -1),\n\t\t\t\tthis.publish(\"activity/prop/changed/length\", 0),\n\t\t\t\tthis.publish(\"activity/prop/changed/index\", -Infinity)\n\t\t\t]);\n\t\t},\n\t\t\"dom:[data-action=skip]/click\": function () {\n\t\t\tvar resolver = this[$ELEMENT].data('resolver');\n\t\t\tresolver({\n\t\t\t\tskip: true\n\t\t\t});\n\t\t},\n\t\t\"dom:[data-action=proceedWithoutAsr]/click\": function () {\n\t\t\tvar resolver = this[$ELEMENT].data('resolver');\n\t\t\tresolver({\n\t\t\t\tproceedWithoutAsr: true\n\t\t\t});\n\t\t},\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/bottom-bar/bottom-bar.html',[],function() { return function template(data) { var o = \"\";\n\tvar outBlurb = function(id,en){\n        var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\n        return res;\n    };\n\n    var outCls = function(fnType, type){\n    \tvar typeCls = type ? 'ets-btn-'+ type : 'ets-btn-green';\n    \tvar fnCls = fnType ? 'ets-btn-fn-' + fnType : \"\";\n\n    \treturn \"ets-btn \"+ typeCls +\" ets-btn-large ets-btn-shadowed ets-disabled \" + fnCls;\n    }\no += \"\\n\\n<div class=\\\"\" + outCls('check', 'purple')+ \"\\\" data-action=\\\"check\\\" data-at-id=\\\"btn-check-answer\\\">\\n\\t<span \" + outBlurb(450316, \"CHECK MY ANSWER\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('retry', 'blue')+ \"\\\" data-action=\\\"retry\\\" data-at-id=\\\"btn-retry\\\">\\n\\t<span \" + outBlurb(450051, \"RETRY\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('next')+ \"\\\" data-action=\\\"nextQues\\\" data-at-id=\\\"btn-next-question\\\">\\n\\t<span \" + outBlurb(450052, \"NEXT\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('save')+ \"\\\" data-action=\\\"save\\\" data-at-id=\\\"save\\\">\\n\\t<span \" + outBlurb(443583, \"DONE\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('submit')+ \"\\\" data-action=\\\"submit\\\" data-at-id=\\\"btn-submit\\\">\\n\\t<span \" + outBlurb(150622, \"SUBMIT\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('done')+ \"\\\" data-action=\\\"done\\\" data-at-id=\\\"btn-done\\\">\\n\\t<span \" + outBlurb(443583, \"DONE\")+ \"></span>\\n</div>\\n<div class=\\\"\" + outCls('move')+ \"\\\" data-action=\\\"next\\\" data-type=\\\"button\\\" data-at-id=\\\"btn-next\\\">\\n\\t<span \" + outBlurb(450052, \"NEXT\")+ \"></span>\\n</div>\"; return o; }; });\n",
    "/*\n    Responsibility of this module:\n\n    1. go to prev activity\n    2. go to next activity\n    3. 'check my answer' btn status change \n    4. save and submit content for writing challenge\n\n    Notes: \n        Instance feedback\n            show next Ques or next Act button\n        Practice\n            show check my answer\n        Learning\n            no grade\n        Exercise\n            grade\n*/\ndefine('school-ui-activity-container/widget/activity/bottom-bar/main',[\n    \"jquery\",\n    \"mv!jquery#troopjs-1.0\",\n    \"troopjs-ef/component/widget\",\n    \"when\",\n    \"template!./bottom-bar.html\",\n    \"poly/array\",\n    \"poly/object\"\n], function ActivityBottomButton($, jqueryInTroop1, Widget, when, tBottomBtn) {\n    \"use strict\";\n    var $EL = \"$element\",\n        CLS_CHECK_ANSWER = \"ets-btn-fn-check\",\n        CLS_NEXT = \"ets-btn-fn-next\",\n        CLS_SAVE = \"ets-btn-fn-save\",\n        CLS_SUBMIT = \"ets-btn-fn-submit\",\n        CLS_MOVE_ON = \"ets-btn-fn-move\",\n        CLS_DONE = \"ets-btn-fn-done\",\n        CLS_RETRY = \"ets-btn-fn-retry\",\n\n        CLS_NEXT_ACT = \"ets-ui-acc-btn-next\",\n        CLS_PREV_ACT = \"ets-ui-acc-btn-prev\",\n        CLS_HIDDEN = \"ets-hidden\",\n        CLS_SHOW = \"ets-show\",\n        CLS_DISABLE = \"ets-disabled\",\n\n        PROP = {\n            /* indicates if current activity is completed */\n            COMPLETED: 'completed',\n            /* indicates current sub question index */\n            INDEX: 'index',\n            /* indicates how many sub question does current activity has */\n            LENGTH: 'length',\n            /* indicates activity type */\n            TYPE: 'type'\n        },\n        ITEM_PROP = {\n            /* Return true or false, indicates if current answer is intact so that it can be checked by scoring.compute */\n            ANSWERED: 'answered',\n            /* indicates if current activity enabled instance feedback */\n            INSTANT_FEEDBACK: 'instantFeedback',\n            /* indicates if current activity is savable */\n            SAVABLE: 'savable',\n            /* indicates if current activity is completed */\n            COMPLETED: 'completed'\n        },\n        ITEM_PREFIX = 'item_',\n\n        ACT_TYPE = {\n            /* indicates current activity is a 'LEARNING' activity or not  */\n            LEARNING: 2,\n            /* indicates current activity is a 'EXERCISE' activity or not */\n            EXERCISE: 1,\n            /* indicates current activity is a 'PRACTICE' activity or not */\n            PRACTICE: 3\n        },\n\n        TOPIC_CHECK_ANSWERS = \"activity/check/answer\",\n        TOPIC_NEXT_STEP = \"activity/next/step\",\n        TOPIC_MOVE_ON_ACT = \"activity/submit/score/proxy\",\n        TOPIC_CONTAINER_NEXT_ACT = \"activity-container/nextActivity\",\n        TOPIC_ITEM_COMPLETED = \"activity-container/bottom-bar/item/completed\",\n        TOPIC_RETRY_ACT = \"activity/retry\",\n\n        state_machine = {},\n        $subELs = {};\n\n\n    function toggleLayout(states) {\n        // Show or hide, enable or disable button\n        states.forEach(function (state) {\n            var $el = state.$el;\n            if (!$el) return;\n            state.show ? $el.addClass(CLS_SHOW) : $el.removeClass(CLS_SHOW);\n            state.enable ? $el.removeClass(CLS_DISABLE) : $el.addClass(CLS_DISABLE);\n            //for automation test\n            state.enable ? $el.attr(\"data-at-enable\", \"true\") : $el.attr(\"data-at-enable\", \"false\");\n        });\n    }\n\n    function stateProxy(state_name, state, itemPrefix) {\n        if(itemPrefix) state_name = itemPrefix + state_name;\n        state_machine[state_name] = state;\n        check_button_state(state_machine);\n    }\n\n    function itemStateProxy(state_name, state) {\n        stateProxy(state_name, state, ITEM_PREFIX);\n    }\n\n    function publishProxy($el) {\n        if(!$el) return;\n        \n        if (!$el.hasClass(CLS_DISABLE)) {           \n            var args = [].slice.call(arguments, 1);\n            this.publish.apply(this, args);\n        }\n    }\n\n    function check_button_state(states) {\n        // Button states conditions\n        var answered = states[ITEM_PREFIX + ITEM_PROP.ANSWERED],\n            instantFeedback = states[ITEM_PREFIX + ITEM_PROP.INSTANT_FEEDBACK],\n            savable = states[ITEM_PREFIX + ITEM_PROP.SAVABLE],\n            isPractice= states[PROP.TYPE] === ACT_TYPE.PRACTICE,\n            isLearning = states[PROP.TYPE] === ACT_TYPE.LEARNING,\n            isExercise = states[PROP.TYPE] === ACT_TYPE.EXERCISE,     \n\n            itemCompleted = states[ITEM_PREFIX + ITEM_PROP.COMPLETED],\n\n            completed = states[PROP.COMPLETED],\n            index = states[PROP.INDEX],\n            length = states[PROP.LENGTH],\n\n            isLastItem = index >= length - 1;\n\n        var showCheck = !completed && (!instantFeedback && !savable && isExercise && !itemCompleted),\n            showDone = isPractice && isLastItem && !savable && !completed,\n            showMoveon = completed || ((!isExercise || instantFeedback) && !savable && isLastItem);\n\n        toggleLayout([\n            {   //Save state\n                $el: $subELs.save,\n                show: savable && !isExercise && !completed,\n                enable: answered\n            },\n            {   //Submit state\n                $el: $subELs.submit,\n                show: savable && isExercise && !completed,\n                enable: answered\n            },\n            {   //check answer state\n                $el: $subELs.check,\n                show: showCheck,\n                enable: answered\n            },\n            {   //Done state\n                $el: $subELs.done,\n                show: showDone,\n                enable: answered\n            },\n            {   //Move on state\n                $el: $subELs.moveOn,\n                show: showMoveon && !showDone,\n                enable: completed || (!isExercise && answered)\n            },\n            {   //retry state\n                $el: $subELs.retry,\n                show: (!isLearning || savable) && completed && !(savable && isExercise),\n                enable: completed\n            },\n            {   //next question state\n                $el: $subELs.nextQues,\n                show: !showCheck && length > 1 && index < length - 1,\n                enable: answered || isLearning\n            }\n        ]);\n    }\n\n    function subElList($el, list) {\n        Object.keys(list).forEach(function(key){\n            $subELs[key] = $el.find(\".\" + list[key]);\n        });\n    }\n\n    return Widget.extend({\n        \"sig/start\": function() {\n            var me = this,\n                $el = me[$EL];\n\n            return me.html(tBottomBtn).then(function(){\n                subElList($el, {\n                    check: CLS_CHECK_ANSWER,\n                    nextQues: CLS_NEXT,\n                    save: CLS_SAVE,\n                    submit: CLS_SUBMIT,\n                    nextAct: CLS_NEXT_ACT,\n                    prevAct: CLS_PREV_ACT,\n                    done: CLS_DONE,\n                    retry: CLS_RETRY,\n                    moveOn: CLS_MOVE_ON\n                });\n            });\n        },\n        \"sig/finalize\":function(){\n            jqueryInTroop1(this[$EL].find(\".ets-asr-ob-bt\")).remove();\n        },\n        \"hub:memory/load/results\":function(results){\n            var me = this;\n            results &&\n                results.activity &&\n                results.activity === \"summary\" ? me.hide() : me.show();\n        },\n        \"hide\": function hideBottomBar() {\n            this.$element.addClass(CLS_HIDDEN);\n        },\n        \"show\": function showBottomBar() {\n            this.$element.removeClass(CLS_HIDDEN);\n        },\n        \"hub/activity/prop/changed/completed\": function stateCompleted(state) {\n            stateProxy(PROP.COMPLETED, state);\n        },\n        \"hub/activity/prop/changed/index\": function stateIndex(state) {\n            stateProxy(PROP.INDEX, state);\n        },\n        \"hub/activity/prop/changed/length\": function stateLength(state) {\n            stateProxy(PROP.LENGTH, state);\n        },\n        \"hub/activity/prop/changed/type\": function stateType(state) {\n            stateProxy(PROP.TYPE, state);\n        },\n        \"hub/activity/item/prop/changed/answered\": function itemStateAnswered(state) {\n            itemStateProxy(ITEM_PROP.ANSWERED, state);\n        },\n        \"hub/activity/item/prop/changed/instantFeedback\": function itemStateInstantFeedback(state) {\n            itemStateProxy(ITEM_PROP.INSTANT_FEEDBACK, state);\n        },\n        \"hub/activity/item/prop/changed/savable\": function itemStateSavable(state) {\n            itemStateProxy(ITEM_PROP.SAVABLE, state);\n        },\n        \"hub/activity/item/prop/changed/completed\": function itemStateCompleted(state) {\n            itemStateProxy(ITEM_PROP.COMPLETED, state);\n        },\n        \"dom:[data-action=check]/click\": function checkAnswer() {\n            publishProxy.call(this, $subELs.check, TOPIC_CHECK_ANSWERS);\n        },\n        \"dom:[data-action=nextQues]/click\": function nextQuestion() {\n            publishProxy.call(this, $subELs.nextQues, TOPIC_NEXT_STEP);\n        },\n        \"dom:[data-action=next]/click\": function nextActivity() {\n            publishProxy.call(this, $subELs.moveOn, TOPIC_MOVE_ON_ACT);\n            publishProxy.call(this, $subELs.moveOn, TOPIC_CONTAINER_NEXT_ACT);\n        },\n        \"dom:[data-action=save]/click\": function saveContent() {\n            publishProxy.call(this, $subELs.save, TOPIC_ITEM_COMPLETED, true, state_machine[PROP.INDEX]);\n        },\n        \"dom:[data-action=submit]/click\": function submitContent() {\n            publishProxy.call(this, $subELs.submit, TOPIC_CHECK_ANSWERS);\n        },\n        \"dom:[data-action=done]/click\": function submitContent() {\n            publishProxy.call(this, $subELs.done, TOPIC_ITEM_COMPLETED, true, state_machine[PROP.INDEX]);\n        },\n        \"dom:[data-action=retry]/click\": function submitContent() {\n            publishProxy.call(this, $subELs.retry, TOPIC_RETRY_ACT);\n        }\n    });\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/navigation/navigation.html',[],function() { return function template(data) { var o = \"\";\n    var model = data || {},\n        activities = model.activities || [],\n        count = activities.length,\n        act,\n        passed,\n        actNum;\n    var activeIndex = model.index,\n        currentType = model.currentType,\n        summaryPassedClass = model.hasStepPassed ? \" ets-ui-acc-act-nav-summary-green\" : \"\",\n        summaryArrowClass = model.hasStepPassed ? \" ets-passed\" : \"\",\n        hasPassingNav = false,\n        passedClass,\n        activeClass;\no += \"\\n<ul class=\\\"ets-ui-acc-act-nav\\\"><!--\\n    \"; for(var i = 0; i < count; i++) {\n        act = activities[i];\n        passed = !!act.hasPassed,\n        actNum = passed ? \"&nbsp;\" : i + 1;\n        passedClass = passed ? \" ets-ui-acc-act-nav-passed\" : \"\",\n        activeClass = i === activeIndex ? \" ets-ui-acc-act-nav-active\" : \"\";\n\n        if(!hasPassingNav && act.hasPassing) {\n            passedClass = \" ets-ui-acc-act-nav-passing\";\n            hasPassingNav = true;\n        }\n    o += \"\\n    --><li class='ets-ui-acc-act-nav-act\" +passedClass+ \"' data-at-id=\\\"\" +act.id+ \"\\\">\\n        <a class=\\\"\" +activeClass+ \"\\\" data-nav-index=\\\"\" +i+ \"\\\" data-act-id=\\\"\" +act.id+ \"\\\" data-action=\\\"route\\\" href=\\\"javascript:void(0)\\\">\" +actNum+ \"</a>\\n    </li><!--\\n    \";}o += \"\\n    --><li class=\\\"ets-ui-acc-act-nav-summary\" +summaryPassedClass+ \"\\\">\\n        <a href=\\\"javascript:void(0)\\\" data-action=\\\"route\\\" class=\\\"\" +(currentType === 'summary' ? 'ets-ui-acc-act-nav-active' : '')+ \"\" +summaryArrowClass+ \"\\\">&nbsp;</a>\\n    </li>\\n</ul>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/navigation/main',[\n\t\"jquery\",\n\t\"when\",\n\t\"troopjs-ef/component/widget\",\n\t\"template!./navigation.html\",\n\t\"school-ui-shared/utils/progress-state\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"poly/json\"\n], function ActivityNavigationModule($, when, Widget, tNav, progressState, typeidParser) {\n\t\"use strict\";\n\tvar $ELEMENT = \"$element\";\n\n\t/*!\n\t * widget constants\n\t */\n\tvar UNDEF;\n\tvar ACTIVITY_ID = \"_activity_id\";\n\tvar CURRENT_TYPE = \"_current_type\";\n\tvar STEP_ID = \"_step_id\";\n\tvar SUMMARY = \"summary\";\n\tvar ACTIVITY = \"activity\";\n\tvar RENDER_PROMISE = \"_render_promise\";\n\n\tvar CLS_HIDE = \"ets-none\";\n\tvar CLS_ACT_NAV_ACTIVE = \"ets-ui-acc-act-nav-active\";\n\n\tvar HUB_SHOW_LOADING = \"activity-container/show/loading\";\n\tvar HUB_SUBMIT_SCORE = 'activity/submit/score/proxy';\n\n\tfunction render(){\n\t\tvar me = this;\n\t\tif(me[STEP_ID] && me[CURRENT_TYPE]){\n\t\t\t//to make sure render function to call me.show() or me.hide() in calling order\n\t\t\t//we use promise to keep this order\n\t\t\tme[RENDER_PROMISE] = me[RENDER_PROMISE].then(function () {\n\t\t\t\treturn me.query(me[STEP_ID] + \".progress,.children\").spread(function (step) {\n\t\t\t\t\tvar activities = step.children || [];\n\n\t\t\t\t\tvar hasStepPassed = progressState.hasPassed(step.progress.state);\n\t\t\t\t\tvar activity_index;\n\n\t\t\t\t\t//check every activity pass state\n\n\t\t\t\t\t// The code query way is for at-preview optimizing\n\t\t\t\t\tvar q_activity_progress = activities.map(function(activity) {\n\t\t\t\t\t\treturn activity.progress.id;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn me.query(q_activity_progress).spread(function() {\n\t\t\t\t\t\tactivities.forEach(function(activity, index) {\n\t\t\t\t\t\t\tactivities[index].hasPassed = progressState.hasPassed(activity.progress.state);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif(me[CURRENT_TYPE] !== SUMMARY){\n\t\t\t\t\t\t\tactivities.forEach(function(activity, index){\n\t\t\t\t\t\t\t\tif(activity.id === me[ACTIVITY_ID]){\n\t\t\t\t\t\t\t\t\tactivity_index = index;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tactivity_index = activities.length;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn me.html(tNav, {\n\t\t\t\t\t\t\t\"index\": activity_index,\n\t\t\t\t\t\t\t\"activities\": activities,\n\t\t\t\t\t\t\t\"currentType\" : me[CURRENT_TYPE],\n\t\t\t\t\t\t\t\"hasStepPassed\": hasStepPassed\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(function(){\n\t\t\t\t\t\t\t\tactivity_index !== UNDEF ? me.show() : me.hide();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}).otherwise(function ignoreError() {\n\t\t\t});\n\t\t}\n\t}\n\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tthis[RENDER_PROMISE] = when.resolve();\n\t\t},\n\t\t\"hub:memory/load/step\":function(step){\n\t\t\tvar me = this;\n\t\t\tif(step){\n\t\t\t\tme[STEP_ID] = step.id;\n\t\t\t\trender.call(me);\n\t\t\t}\n\t\t},\n\t\t\"hub:memory/load/results\":function(results){\n\t\t\tvar me = this;\n\t\t\tif(results){\n\t\t\t\tme[CURRENT_TYPE] =  results.activity === SUMMARY ?\n\t\t\t\t\t\t\t\t\t\tSUMMARY :\n\t\t\t\t\t\t\t\t\t\tACTIVITY;\n\t\t\t\tme[ACTIVITY_ID] = results.activity && results.activity.id;\n\t\t\t\trender.call(me);\n\t\t\t}\n\t\t},\n\t\t\"hide\" : function(){\n\t\t\tthis[$ELEMENT].addClass(CLS_HIDE);\n\t\t},\n\t\t\"show\" : function(){\n\t\t\tthis[$ELEMENT].removeClass(CLS_HIDE);\n\t\t},\n\t\t\"hub/activity/update/progress\" : function(){\n\t\t\trender.call(this);\n\t\t},\n\t\t\"dom:[data-action='route']/click\": function onRouteActivity($event) {\n\t\t\tvar me = this;\n\t\t\tvar $target = $($event.target);\n\t\t\tvar actId = $target.data(\"act-id\");\n\n\t\t\tif(!$target.hasClass(CLS_ACT_NAV_ACTIVE)) {\n\t\t\t\t// If clicking navigation button also try to submit score\n\t\t\t\tme.publish(HUB_SUBMIT_SCORE);\n\t\t\t\tme.publish(\"load\", {\n\t\t\t\t\t\"activity\" : actId ? typeidParser.parseId(actId) : SUMMARY\n\t\t\t\t});\n\n\t\t\t\t// navigate activity for good user experience\n\t\t\t\t//use for render this time\n\t\t\t\tme[ACTIVITY_ID] = actId;\n\t\t\t\tme[CURRENT_TYPE] = actId ? ACTIVITY : SUMMARY;\n\t\t\t\tactId && me.publish(HUB_SHOW_LOADING, actId);\n\t\t\t\trender.call(me);\n\t\t\t}\n\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-summary/step-summary.html',[],function() { return function template(data) { var o = \"\";\n    var pros = data.actPros,\n        len = pros.length,\n        bStepPassed = data.hasPassed,\n        i= 0,\n        stepPros = data.pros,\n        numNotPassed = data.numNotPassed,\n        isLastStep = data.isLastStep,\n        isLessonPassed = data.isLessonPassed,\n        isStepPerfect = data.isStepPerfect,\n        isLessonPerfect = data.isLessonPerfect;\n        \n    var outBlurb = function(id,en){\n        var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\n        return res;\n    };\no += \"\\n<div class=\\\"ets-ui-step-summary-bd\\\">\\n\";if(bStepPassed){o += \"\\n    \";if(isLessonPassed){o += \"\\n        <h3 data-at-id=\\\"lbl-step-summary-title\\\">\\n            <i class=\\\"ets-ui-icon-pass-l\\\"></i>\\n            <span \" + outBlurb(450041,\"Step passed\")+ \" >&nbsp;</span>\\n        </h3>\\n        <div class=\\\"ets-cf\\\"></div>\\n        <h3 data-at-id=\\\"lbl-step-summary-sub-title\\\">\\n            <i class=\\\"ets-ui-icon-pass-l\\\"></i>\\n            <span \" + outBlurb(450040,\"Lesson passed\")+ \" >&nbsp;</span>\\n        </h3>\\n        \";if(isLessonPerfect){o += \"\\n            <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450312,\"Well done! You got everything correct and passed this lesson.\")+ \" ></h4>\\n        \";}else{o += \"\\n            <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450042,\"Well done! You passed this lesson.\")+ \" ></h4>\\n        \";}o += \"\\n    \";}else{o += \"\\n        \";if(isStepPerfect){o += \"\\n            <h3 data-at-id=\\\"lbl-step-summary-title\\\" \" + outBlurb(462934,\"Perfect!\")+ \" ></h3>\\n            <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450048,\"Good work! You got everything correct and passed the step.\")+ \" ></h4>\\n        \";}else{o += \"\\n            <h3 data-at-id=\\\"lbl-step-summary-title\\\" \" + outBlurb(450041,\"Step passed\")+ \" ></h3>\\n            <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450315,\"Good work! You passed the step.\")+ \" ></h4>\\n        \";}o += \"\\n    \";}o += \"\\n\";}else{o += \"\\n    \";if(stepPros<40){o += \"\\n        <h3 data-at-id=\\\"lbl-step-summary-title\\\" \" + outBlurb(450045,\"Keep trying\")+ \" ></h3>\\n    \";}else if(stepPros>=40 && stepPros<60){o += \"\\n        <h3 data-at-id=\\\"lbl-step-summary-title\\\" \" + outBlurb(450043,\"Almost there\")+ \" ></h3>\\n    \";}o += \"\\n    \";if(numNotPassed===1){o += \"\\n        <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450576,\"You need to pass 1 more activities to move on.\")+ \" ></h4>\\n    \";}else{o += \"\\n        <h4 data-at-id=\\\"lbl-step-summary-description\\\" \" + outBlurb(450317,\"You need to pass ^numberofactivities^ more activities to move on.\")+ \"  data-values='{\\\"numberofactivities\\\":\" + numNotPassed+ \"}'></h4>\\n    \";}o += \"\\n\";}o += \"\\n\\n\"; if(!bStepPassed){ o += \"\\n    <p>\\n        <!--<span \" + outBlurb(450046,\"You need to pass 60% of the activities in a step.\")+ \" ></span>-->\\n        <!--<br/>-->\\n        <span data-at-id=\\\"lbl-step-summary-sub-description\\\" \" + outBlurb(450047,\"Your current progress will be saved.\")+ \" ></span>\\n    </p>\\n\"; }o += \"\\n\\n\";if(!isLessonPassed){o += \"\\n<ul class=\\\"ets-ui-step-summary-acts\\\">\\n    \"; for(;i<len;i++){o += \"\\n        \"; if(pros[i]) { o += \"\\n            <li class=\\\"ets-pass\\\" data-at-id=\\\"lbl-activity-status-\" + ( i + 1 ) + \"\\\"></li>\\n        \"; }else{ o += \"\\n            <li class=\\\"ets-fail\\\" data-at-id=\\\"lbl-activity-status-\" + ( i + 1 ) + \"\\\">\" + ( i + 1 ) + \"</li>\\n        \"; } o += \"\\n        <!--<li class=\\\"\";if(pros[i]){o += \"ets-pass\";} else {o += \"ets-fail\";}o += \"\\\"></li>-->\\n    \";}o += \"\\n</ul>\\n\";}o += \"\\n\\n<div class=\\\"ets-ui-step-summary-actions\\\">\\n    <!--<div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"close\\\">-->\\n        <!--<span \" + outBlurb(450015,\"Back to the unit\")+ \" ></span>-->\\n    <!--</div> -->\\n    \";if(isStepPerfect){o += \"\\n        \";if(!isLessonPassed && !isLastStep){o += \"\\n            <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"nextstep\\\" data-at-id=\\\"btn-start-the-next-step\\\">\\n    <span \" + outBlurb(450053,\"Start the next step\")+ \" ></span>\\n</div>\\n        \";}else{o += \"\\n            <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"close\\\" data-at-id=\\\"btn-back-to-the-unit\\\">\\n                <span \" + outBlurb(450015,\"Back to the unit\")+ \" ></span>\\n            </div>\\n        \";}o += \"\\n    \";}else if(bStepPassed){o += \"\\n        <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"tryagain\\\" data-at-id=\\\"btn-try-the-step-again\\\">\\n            <span \" + outBlurb(450050,\"Try the step again\")+ \" ></span>\\n        </div>\\n        \";if(!isLessonPassed && !isLastStep){o += \"\\n            <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"nextstep\\\" data-at-id=\\\"btn-start-the-next-step\\\">\\n                <span \" + outBlurb(450053,\"Start the next step\")+ \" ></span>\\n            </div>\\n        \";}else{o += \"\\n            <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"close\\\" data-at-id=\\\"btn-back-to-the-unit\\\">\\n                <span \" + outBlurb(450015,\"Back to the unit\")+ \" ></span>\\n            </div>\\n        \";}o += \"\\n    \";}else{o += \" \\n        <div class=\\\"ets-btn-large ets-btn-shadowed ets-btn-white\\\" data-action=\\\"tryagain\\\" data-at-id=\\\"btn-try-the-step-again\\\">\\n            <span \" + outBlurb(450050,\"Try the step again\")+ \" ></span>\\n        </div>  \\n    \";}o += \"\\n</div>\\n</div>\\n\";if(bStepPassed){o += \"\\n<div class=\\\"ets-acc-sharing\\\" data-ccl=\\\"Facebook.School.Share\\\" data-weave=\\\"troopjs-ef/ccl/placeholder('school-ui-activity-container/widget/plugin/sharing/main')\\\"></div>\\n\";} return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/step-summary/main',[\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"when\",\n\t\"school-ui-shared/utils/progress-state\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"template!./step-summary.html\",\n\t\"poly/array\",\n\t\"poly/object\"\n], function StepSummaryModule($, Widget, when, progressState, parser, tStepSum) {\n\t\"use strict\";\n\tvar $ELE = \"$element\",\n\n\t\tSEL_STEP_PASSED = \"ets-ui-acc-step-status-pass\",\n\t\tSEL_STEP_FAIL = \"ets-ui-acc-step-status-fail\",\n\n\t\tPROP_ID = \"id\",\n\t\tPROP_NOT_PASSED = \"numNotPassed\",\n\t\tPROP_HAS_PASSED = \"hasPassed\",\n\t\tPROP_PROGRESS = \"pros\",\n\t\tPROP_ACT_PROGRESS = \"actPros\",\n\t\tPROP_STEP = \"step\",\n\n\t\tIS_LAST_STEP = \"isLastStep\",\n\t\tIS_LESSON_PERFECT = \"isLessonPerfect\",\n\t\tIS_STEP_PERFECT = \"isStepPerfect\",\n\t\tIS_LESSON_PASSED = \"isLessonPassed\",\n\n\t\tPERFECT_SCORE = 100,\n\t\tPASS_RATE = 0.6;\n\n\n\tfunction onRender(step){\n\t\tvar me = this;\n\n\t\tif(!step) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn me.query(step.id + \".progress,.parent.progress,.parent.children,.children.progress\").spread(function (step) {\n\n\t\t\tvar ite = 0, //stat how many acts not passed in current step\n\t\t\t\tperfectScore = PERFECT_SCORE,\n\t\t\t\tactPros = [],\n\t\t\t\tisPassed,\n\t\t\t\tisLessonPerfect = true,\n\t\t\t\tstepLen,\n\t\t\t\tnoop = {state: 0, children: []},\n\t\t\t\tstepId = step.id,\n\t\t\t\tsteps = step.parent.children,\n\t\t\t\tlessonPros,\n\t\t\t\tpassRate = PASS_RATE;\n\n\t\t\t// Is the last step of current lesson or not\n\t\t\tstep[IS_LAST_STEP] = steps[steps.length - 1][PROP_ID] === stepId;\n\n\n\t\t\t// fetch current lesson progresses\n\t\t\tlessonPros = $.extend({}, noop, step.parent.progress);\n\n\t\t\t// for the step summary of the last step in current lesson\n\t\t\tstep[IS_LESSON_PASSED] = progressState.hasPassed(lessonPros.state);\n\n\t\t\t// if scores of all steps in current lesson get to max score, this lesson has passed perfectly.\n\t\t\tsteps.every(function (steps) {\n\t\t\t\tif (steps.progress.score && steps.progress.score < perfectScore) {\n\t\t\t\t\tisLessonPerfect = false;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// pass of fail layout showing\n\t\t\tme[$ELE]\n\t\t\t\t.removeClass(SEL_STEP_PASSED + \" \" + SEL_STEP_FAIL)\n\t\t\t\t.addClass(\n\t\t\t\t\t(step[PROP_HAS_PASSED] = progressState.hasPassed(step.progress.state))\n\t\t\t\t\t\t? SEL_STEP_PASSED\n\t\t\t\t\t\t: SEL_STEP_FAIL\n\t\t\t\t);\n\n\t\t\t//cached data\n\t\t\tstepLen = (step.children || []).length;\n\t\t\tif (stepLen) {\n\t\t\t\tstep.children.forEach(function(act){\n\t\t\t\t\tif (!(isPassed = progressState.hasPassed(act.progress.state))) {\n\t\t\t\t\t\tite++;\n\t\t\t\t\t}\n\t\t\t\t\tactPros.push(isPassed);\n\t\t\t\t});\n\n\t\t\t\t/*\n\t\t\t\t Why do we use PassRate at frontend code?\n\t\t\t\t Because we need to calculate how much activities does user finish,\n\t\t\t\t and backend just send back state of step, frontend only know is this step pass or not.\n\t\t\t\t*/\n\t\t\t\tstep[PROP_PROGRESS] = Math.floor((stepLen - ite) / stepLen * 100);\n\t\t\t\tstep[PROP_NOT_PASSED] = Math.ceil(stepLen * passRate) - (stepLen - ite);\n\t\t\t} else {\n\t\t\t\tstep[PROP_NOT_PASSED] = Math.ceil(step.children.length * passRate);\n\t\t\t\tstep[PROP_PROGRESS] = step.children.length;\n\t\t\t\tisLessonPerfect = false;\n\t\t\t}\n\n\t\t\tstep[IS_LESSON_PERFECT] = isLessonPerfect;\n\n\t\t\t//If there is no act progress,we need to build it\n\t\t\tif (!actPros.length) {\n\t\t\t\tstepLen = step.children.length;\n\t\t\t\twhile (stepLen--) {\n\t\t\t\t\tactPros.push(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstep[PROP_ACT_PROGRESS] = actPros;\n\t\t\tstep[IS_STEP_PERFECT] = step[PROP_PROGRESS] === 100;\n\t\t\treturn me.html(tStepSum, step);\n\t\t});\n\t}\n\n\treturn Widget.extend({\n\t\t\"hub:memory/load/step\": function onStep(step) {\n\t\t\tvar me = this;\n\t\t\tif(step){\n\t\t\t\tonRender.call(me, me[PROP_STEP] = step);\n\t\t\t}\n\t\t},\n\n\t\t\"hub/activity/update/progress\" : function(){\n\t\t\tvar me = this;\n\t\t\tonRender.call(me, me[PROP_STEP]);\n\t\t},\n\n\t\t\"dom:[data-action=close]/click\": function(){\n\t\t\tvar me = this;\n\t\t\tme.publish(\"activity-container/close\");\n\t\t},\n\n\t\t\"dom:[data-action=tryagain]/click\": function(){\n\t\t\tvar me = this;\n\t\t\tme.publish(\"activity-container/tryAgain\");\n\t\t},\n\n\t\t\"dom:[data-action=nextstep]/click\": function(){\n\t\t\tvar me = this;\n\t\t\tme.publish(\"activity-container/nextStep\");\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/activity/step-title/step-title.html',[],function() { return function template(data) { var o = \"<span data-at-id=\\\"lbl-step-name\\\">\" + data + \"</span>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/activity/step-title/main',[\n\t\"troopjs-ef/component/widget\",\n\t\"school-ui-shared/utils/language-fixing\",\n\t\"template!./step-title.html\"\n], function (Widget, languageFixing, tStepTitle) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\tvar PROP_CULTURE_CODE = \"cultureCode\";\n\tvar PROP_DATA = \"_data\";\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me[PROP_DATA] || !me[PROP_CULTURE_CODE]) {\n\t\t\treturn;\n\t\t}\n\n\t\tlanguageFixing(me[$ELEMENT], me[PROP_DATA], me[PROP_CULTURE_CODE]);\n\n\t\tme.html(tStepTitle, me[PROP_DATA]);\n\t}\n\n\treturn Widget.extend({\n\t\t\"hub:memory/load/step\": function onLoadStep(step) {\n\t\t\tvar me = this;\n\t\t\tstep && (me[PROP_DATA] = step.stepName);\n\t\t\trender.call(me);\n\t\t},\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tvar me = this;\n\t\t\tcontext && context[PROP_CULTURE_CODE] && (me[PROP_CULTURE_CODE] = context[PROP_CULTURE_CODE]);\n\t\t\trender.call(me);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/button.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-live-chat-when-online gud\\\">\\n\\t<button type=\\\"button\\\" class=\\\"ets-act-live-chat-button\\\"\\n\\t        data-weave=\\\"troopjs-ef/blurb/widget\\\"\\n\\t        data-blurb-id=\\\"702070\\\" data-text-en=\\\"I need help\\\"\\n\\t        data-toggle=\\\"tooltip\\\" data-placement=\\\"bottom\\\"></button>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/plugin/live-chat/tooltip-title.html',[],function() { return function template(data) { var o = \"\"; if(data.hasCloseBtn){ o += \"\\n\\t<button type=\\\"button\\\" class=\\\"tooltip-close\\\">&#x2715;</button>\\n\"; } o += \"\\n<div class=\\\"tooltip-text\\\">\" + data.title + \"</div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/plugin/live-chat/main',[\n\t\"when\",\n\t\"jquery\",\n\t\"jquery.gudstrap\",\n\t\"troopjs-ef/component/widget\",\n\t\"livechat-ui/livechat-button\",\n\t\"template!./button.html\",\n\t\"template!./tooltip-title.html\"\n], function (when, $, $gudstrap, Widget, LiveChatBtn, tButton, tTooltipTitle) {\n\tvar $ELEMENT = \"$element\";\n\tvar SEL_LIVE_CHAT_BTN = '.ets-act-live-chat-button';\n\tvar SF_LIVECHAT_ORG_ID = \"00D300000000Ys3\";\n\tvar BLURB_TOOLTIP_TITLE = \"blurb!702072\";\n\n\tvar TOOLTIP_SHOWN_ON_INCORRECT_ANSWER_KEY = 'activityLivechatTooltipShownOnIncorrectAnswer';\n\n\tfunction createTooltipOptions(options) {\n\t\tvar _options = $.extend({\n\t\t\ttrigger: \"hover focus\"\n\t\t}, options);\n\t\treturn {\n\t\t\thtml: true,\n\t\t\ttrigger: _options.trigger,\n\t\t\ttitle: function () {\n\t\t\t\treturn tTooltipTitle({\n\t\t\t\t\thasCloseBtn: _options.hasCloseBtn,\n\t\t\t\t\ttitle: _options.title\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\t\t\tme.liveChatChecked = when.all([\n\t\t\t\tme.query(BLURB_TOOLTIP_TITLE),\n\t\t\t\tme.getLiveChatOptions(),\n\t\t\t\tme.getButtonIds()\n\t\t\t]).spread(function (tooltipTitle, liveChatOptions, buttonIds) {\n\t\t\t\tif (!buttonIds || !liveChatOptions) {\n\t\t\t\t\treturn when.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn me.html(tButton).then(function () {\n\t\t\t\t\tvar $element = me[$ELEMENT];\n\t\t\t\t\tvar button;\n\n\t\t\t\t\tme.$button = $element.find(SEL_LIVE_CHAT_BTN);\n\t\t\t\t\tme.tooltipTitle = tooltipTitle && tooltipTitle[0] && tooltipTitle[0].translation;\n\n\t\t\t\t\tme.$button.tooltip(createTooltipOptions({\n\t\t\t\t\t\ttitle: me.tooltipTitle\n\t\t\t\t\t}));\n\n\t\t\t\t\tbutton = new LiveChatBtn(\n\t\t\t\t\t\tme.$button,\n\t\t\t\t\t\tbuttonIds,\n\t\t\t\t\t\tliveChatOptions,\n\t\t\t\t\t\t$element.data(\"delegate\") || null\n\t\t\t\t\t);\n\n\t\t\t\t\treturn when.promise(function (resolve) {\n\t\t\t\t\t\tme.$button.on('statuschange', function () {\n\t\t\t\t\t\t\tresolve(button);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t\"dom:.tooltip-close/click\": function () {\n\t\t\tvar me = this;\n\t\t\tme.$button.tooltip(\"destroy\");\n\t\t\tme.$button.tooltip(createTooltipOptions({\n\t\t\t\ttitle: me.tooltipTitle\n\t\t\t}));\n\t\t},\n\n\t\t// Manually trigger a tooltip\n\t\t// when an answer is incorrect for the first time\n\t\t\"hub/activity/interaction\": function (iteraction) {\n\t\t\tvar me = this;\n\n\t\t\tif (iteraction && iteraction.correct) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.liveChatChecked.then(function (button) {\n\t\t\t\tif (!button || !button.isOnline) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (localStorage.getItem(TOOLTIP_SHOWN_ON_INCORRECT_ANSWER_KEY)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlocalStorage.setItem(TOOLTIP_SHOWN_ON_INCORRECT_ANSWER_KEY, true);\n\n\t\t\t\tme.$button.tooltip(\"destroy\");\n\t\t\t\tme.$button.tooltip(createTooltipOptions({\n\t\t\t\t\thasCloseBtn: true,\n\t\t\t\t\ttrigger: \"manual\",\n\t\t\t\t\ttitle: me.tooltipTitle\n\t\t\t\t}));\n\t\t\t\tme.$button.tooltip(\"show\");\n\t\t\t});\n\t\t},\n\n\t\tgetButtonIds: function () {\n\t\t\tvar me = this;\n\t\t\treturn me.query(\n\t\t\t\t\"cms!CustomerService#Contactus#livechat-ui-language\"\n\t\t\t).spread(function (buttonIds) {\n\t\t\t\tif (!buttonIds || !buttonIds.content || typeof buttonIds.content !== \"string\") {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn buttonIds.content.split(\",\");\n\t\t\t});\n\t\t},\n\n\t\tgetLiveChatOptions: function () {\n\t\t\tvar me = this;\n\t\t\treturn me.query(\n\t\t\t\t\"context!current\",\n\t\t\t\t\"school_context!current.user\",\n\t\t\t\t\"cms!CustomerService#Contactus#livechat-teacher-deploymentId\",\n\t\t\t\t\"cms!CustomerService#Contactus#livechat-teacher-url\"\n\t\t\t).spread(function (context, schoolContext, deploymentIdInfo, livechatUrlInfo) {\n\t\t\t\tif (!deploymentIdInfo || !deploymentIdInfo.content ||\n\t\t\t\t\t!livechatUrlInfo || !livechatUrlInfo.content) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tvar languageCode = context && context.values && context.values.languagecode;\n\t\t\t\tvar user = schoolContext && schoolContext.user || {};\n\t\t\t\treturn {\n\t\t\t\t\t\"sf\": {\n\t\t\t\t\t\t\"url\": livechatUrlInfo.content,\n\t\t\t\t\t\t\"deploymentId\": deploymentIdInfo.content,\n\t\t\t\t\t\t\"orgId\": SF_LIVECHAT_ORG_ID\n\t\t\t\t\t},\n\t\t\t\t\t\"user\": {\n\t\t\t\t\t\t\"Email\": user.email,\n\t\t\t\t\t\t\"Division\": user.divisionCode,\n\t\t\t\t\t\t\"Partner\": user.partnerCode,\n\t\t\t\t\t\t\"Full name\": user.firstName + \" \" + user.lastName,\n\t\t\t\t\t\t\"MemberID\": user.member_id,\n\t\t\t\t\t\t\"Country\": user.countryCode,\n\t\t\t\t\t\t\"Browser language\": languageCode && languageCode.value\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity-container/widget/plugin/sharing/facebook.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-acc-sharing-box\\\">\\n\\t<span class=\\\"ets-acc-sharing-text\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='494918' data-text-en='Share'></span>\\n\\t<span class=\\\"ets-acc-sharing-icon\\\" data-action=\\\"share\\\"></span>\\n\\t<div class=\\\"ets-acc-sharing-container\\\">\\n\\t\\t<div class=\\\"ets-acc-sharing-inner\\\">\\n\\t\\t\\t<div class=\\\"ets-acc-sharing-arrow\\\"></div>\\n\\t\\t\\t<span data-weave='troopjs-ef/blurb/widget' data-blurb-id='494870' data-text-en='Proud of Yourself? Share Your Progress With Friends'></span>\\n\\t\\t</div>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity-container/widget/plugin/sharing/main',[\n\t\"when\",\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"template!./facebook.html\"\n], function (when, $, Widget, typeIdParser, tFacebook) {\n\n\tvar FACEBOOK_FEED = \"https://www.facebook.com/dialog/feed\",\n\t\t// params for facebook api, from ccl\n\t\tCCLS = {\n\t\t\tpicture: \"school.courseware.facebook.share.pic\",\n\t\t\tapp_id: \"configuration.facebook.appid\",\n\t\t\tlink: \"Facebook.School.Share.link\",\n\t\t\tredirect_uri: \"Facebook.School.Share.RedirectUrl\"\n\t\t},\n\t\t// params for facebook api, load from blurb which loaded from ccl\n\t\tBLURBS_VIA_CCLS = {\n\t\t\tname: \"Facebook.School.Share.Name\",\n\t\t\tcaption: \"Facebook.School.Share.Caption\"\n\t\t},\n\t\t// params for facebook api, from blurb\n\t\tBLURBS = {\n\t\t\tdescription: 494632\n\t\t},\n\t\t// static params for facebook api\n\t\tSTATIC = {\n\t\t\tdisplay: \"popup\"\n\t\t},\n\t\tPOPUP_PARAM = \"width=600,height=380\",\n\t\tFEEDPARAM = \"feedParam\",\n\t\tSTEP_ID = \"stepId\",\n\t\tCACHE_SERVER = \"cacheServer\",\n\t\tSEL_CONTAINER = \".ets-acc-sharing-container\",\n\t\tCLASS_SHAKE = \"ets-acc-sharing-shake\",\n\t\t$ELEMENT = \"$element\";\n\n\tfunction getCCL(ccl) {\n\t\treturn this.query(\"ccl!'\" + ccl + \"'\")\n\t\t\t.spread(function (data) {\n\t\t\t\treturn data.value;\n\t\t\t});\n\t}\n\n\tfunction getBlurb(id) {\n\t\treturn this.query(\"blurb!'\" + id + \"'\")\n\t\t\t.spread(function (data) {\n\t\t\t\treturn data.translation;\n\t\t\t});\n\t}\n\n\treturn Widget.extend(function ($element) {\n\t\tvar me = this;\n\t\tme[$ELEMENT] = $element;\n\t\tme[FEEDPARAM] = {};\n\t\tme[CACHE_SERVER] = \"\";\n\t}, {\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\t\t\tvar params = {};\n\t\t\tvar promises = [];\n\n\t\t\t// loading parameters start\n\n\t\t\t// ccl params\n\t\t\t$.each(CCLS, function (key, ccl) {\n\t\t\t\tpromises.push(\n\t\t\t\t\tgetCCL.call(me, ccl)\n\t\t\t\t\t\t.then(function (cclValue) {\n\t\t\t\t\t\t\tparams[key] = cclValue;\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\n\t\t\t// blurb params\n\t\t\t$.each(BLURBS, function (key, blurbID) {\n\t\t\t\tpromises.push(\n\t\t\t\t\tgetBlurb.call(me, blurbID)\n\t\t\t\t\t\t.then(function (blurbText) {\n\t\t\t\t\t\t\tparams[key] = blurbText;\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\n\t\t\t// blurb inside ccl\n\t\t\t$.each(BLURBS_VIA_CCLS, function (key, ccl) {\n\t\t\t\tpromises.push(\n\t\t\t\t\tgetCCL.call(me, ccl)\n\t\t\t\t\t\t.then(function (cclValue) {\n\t\t\t\t\t\t\t// convert it to either NaN or number\n\t\t\t\t\t\t\tcclValue *= 1;\n\n\t\t\t\t\t\t\t// NaN != NaN return true\n\t\t\t\t\t\t\tif (cclValue != cclValue) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn getBlurb.call(me, cclValue);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(function (blurbText) {\n\t\t\t\t\t\t\tparams[key] = blurbText;\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\n\t\t\t// loading parameters end\n\n\t\t\twhen.all(promises)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\t// parameter construction start\n\n\t\t\t\t\t// static params\n\t\t\t\t\t$.extend(params, STATIC);\n\n\t\t\t\t\tparams.picture = me[CACHE_SERVER] + params.picture;\n\n\t\t\t\t\tme[FEEDPARAM] = params;\n\n\t\t\t\t\t// parameter construction end\n\n\t\t\t\t\t// do render\n\t\t\t\t\tme.html(tFacebook);\n\t\t\t\t\tme[$ELEMENT].find(SEL_CONTAINER)\n\t\t\t\t\t\t.addClass(CLASS_SHAKE)\n\t\t\t\t\t\t.fadeIn()\n\t\t\t\t\t\t.delay(10000)\n\t\t\t\t\t\t.fadeOut()\n\t\t\t\t});\n\t\t},\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tthis[CACHE_SERVER] = context.cacheServer;\n\t\t\tSTATIC.ref = \"Share_School_\" + context.countryCode;\n\t\t},\n\t\t\"hub:memory/load/step\": function (step) {\n\t\t\tvar me = this;\n\t\t\tif (step) {\n\t\t\t\tme[STEP_ID] = typeIdParser.parseId(step.id);\n\t\t\t}\n\t\t},\n\t\t\"dom:[data-action=share]/click\": function () {\n\t\t\tvar me = this;\n\t\t\twindow.open(FACEBOOK_FEED + \"?\" + $.param(this[FEEDPARAM]), \"facebook\", POPUP_PARAM);\n\n\t\t\t//use hub way to send useraction tracking\n\t\t\t//in studyplan, we will subscribe this hub to send the useraction data,\n\t\t\t//but in e12 or others, nothing will happen.\n\t\t\tme[STEP_ID] && me.publish(\"tracking/useraction\", {\n\t\t\t\t\"action.socialShare\": me[STEP_ID]\n\t\t\t});\n\t\t}\n\t})\n});\n\n"
  ]
}