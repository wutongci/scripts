// Englishtown_Efekta_12_Activity_Templates - 2018.44.1 @ 2018-11-15 12:05:43

define("school-ui-activity/activity/base/item",["when","troopjs-core/component/factory","troopjs-core/pubsub/hub"],function(a,b,c){var d={ANSWERED:"answered",INSTANT_FEEDBACK:"instantFeedback",SAVABLE:"savable",COMPLETED:"completed"},e={_pubProps:function(){var b=this,c=[];for(var f in d){if(!d.hasOwnProperty(f))return;var g=e[d[f]].call(b),h=e[d[f]+"Promise"].call(b,g,!1);c.push(h)}return a.all(c)}};for(var f in d){if(!d.hasOwnProperty(f))return;e[d[f]]=function(a){return function(b,e){var f=this["_"+a];return arguments.length>=1&&(!1===e||b!==f)&&(this["_"+a]=b,!0!==e&&c.publish("activity/item/prop/changed/"+d[a],b,this._index,this)),f}}(f),e[d[f]+"Promise"]=function(b){return function(e,f){var g=this["_"+b];return arguments.length>=1&&(!1===f||e!==g)&&(this["_"+b]=e,!0!==f)?c.publish("activity/item/prop/changed/"+d[b],e,this._index,this).then(function(){return g},function(){return g}):a.resolve(g)}}(f)}return b(function(a){this._index=a,this[d.ANSWERED](!1,!0),this[d.INSTANT_FEEDBACK](!1,!0),this[d.SAVABLE](!1,!0),this[d.COMPLETED](!1,!0)},e)}),define("school-ui-activity/activity/base/main",["jquery","when","compose","troopjs-ef/component/widget","troopjs-core/pubsub/hub","school-ui-shared/utils/typeid-parser","json2","./item"],function(a,b,c,d,e,f,g,h){"use strict";function i(){if(!0!==this._submitted){this._submitted=!0;var a=this._json.content,b=!this.hasScoring||void 0===a||a[r],c=this.type()===t.EXERCISE&&this._json[s],d=b||c?100:0,e=this._json[s],f={actId:this[p],startTime:this[n],completeTime:(new Date).getTime()};this.publish(x,d,e,f)}}var j,k,l,m,n="_startTime",o=["_json","_scoring","_onAnswerChecked"],p="act_id",q="studentCourseId",r="_isCorrect",s="_writingContent",t={LEARNING:2,EXERCISE:1,PRACTICE:3},u={COMPLETED:"completed",INDEX:"index",LENGTH:"length",TYPE:"type"},v={ASR:"asr",GP:"grouping",DEFAULT:"default"},w={TYPING:"TYPING",SELECT:"SELECT",NEXT:"NEXT"},x="activity/submit/score",y={"sig/start":function(){var a=this;a[n]=(new Date).getTime();var c=a.query("student_platform_version!current").spread(function(b){a.platformVersion=b&&b.version});e.subscribe("load/enrollment",a,a.onLoadEnrollment);var d=e.reemit("load/enrollment",!1,a,a.onLoadEnrollment);return b.all([c,d]).then(function(){return a.signal("render")})},"sig/stop":function(){var a=this;e.unsubscribe("load/enrollment",a,a.onLoadEnrollment)},onLoadEnrollment:function(a){var b=this;a&&(b[q]=f.parseId(a.id)),b._enrollmentLoaded.resolve()},activityCompleted:function(a){a&&this.type()!==t.LEARNING&&m===this&&i.call(this)},retryActivity:function(){return this.publish("render/activity",this[p])},"hub/activity/next/step":function(){if(m===this)return this.hasScoring||this.items(this.index()).completed(!0),this.nextStep()},"hub/activity/submit/score/proxy":function(){this.type()===t.LEARNING&&m===this&&i.call(this)},"hub/activity/retry":function(){if(m===this)return this.retryActivity()},"hub:memory/activity/prop/changed/type":function(a){a!==t.EXERCISE&&m===this&&(this.hasScoring=!1)},"hub/activity/prop/changed/completed":function(a){this.activityCompleted(a)},"hub/activity-container/bottom-bar/item/completed":function(a,b){this.publish("activity/item/prop/changed/completed",a,b)},"hub/activity/item/prop/changed/completed":function(a,b,c){if(!c||this._items[b]===c){this.items(b).completed(a);for(var d=!0,e=this.length();e--;)if(!this.items(e).completed()){d=!1;break}d&&this.completed(!0)}},attachATAssetDom:function(c){var d=this;return c?a('<div class="ets-hidden" data-weave="school-ui-activity/shared/automation-test/main(assets)"></div>').data("assets",c).appendTo(d.$element).weave():b.resolve()},scoringType:function(a){return a&&(this._scoringType=a),this._scoringType||v.DEFAULT},publishInteraction:function(b){return this.publish("activity/interaction",a.extend(b,{activityId:this[p]}))},getWritingHist:function(){var a=this;return a._enrollmentLoaded.promise.then(function(){var c=f.parseId(a[p]);if(a[q]){var d;return d="2.0"===a.platformVersion?"integration_student_writing!"+c:"writing_status!"+a[q]+";"+c,a.query(d).spread(function(a){return a})}return b.resolve(null)})},getProgress:function(){var a=this;return a._enrollmentLoaded.promise.then(function(){var c=f.parseId(a[p]);if(a[q]){var d;return d="2.0"===a.platformVersion?"student_activity_progress!"+c:"progress!"+a[q]+";activity;"+c,a.query(d).spread(function(a){return a})}return b.resolve(null)})},nextStep:function(){return b.resolve()},items:function(a){return arguments.length<1&&(a=this.index()),this._items[a]||(this._items[a]=new h(a,this._json)),this._items[a]}};for(var z in u){if(!u.hasOwnProperty(z))return;y[u[z]]=function(a){return function(b){var c=this["_"+a];return arguments.length>=1&&b!==c&&(this["_"+a]=b,this.publish("activity/prop/changed/"+u[a],b)),c}}(z),y[u[z]+"Promise"]=function(a){return function(c){var d=this["_"+a];return arguments.length>=1&&c!==d?(this["_"+a]=c,this.publish("activity/prop/changed/"+u[a],c).then(function(){return d},function(){return d})):b.resolve(d)}}(z)}j=y[u.LENGTH],y[u.LENGTH]=function(a){if(void 0!=a&&"number"==typeof a)for(var b=a;b--;)this.items(b);return j.apply(this,arguments)},k=y[u.INDEX],y[u.INDEX]=function(a){if(void 0!=a&&"number"==typeof a){if(a>=this.length())throw this+": new index() is greater or equal to length()";this.items(a)._pubProps()}return k.apply(this,arguments)},l=y[u.INDEX+"Promise"],y[u.INDEX+"Promise"]=function(a){var c=arguments,d=this;if(void 0!=a&&"number"==typeof a){if(a>=this.length())return b.reject(new Error(this+": new index() is greater or equal to length()"));return this.items(a)._pubProps().then(function(){return l.apply(d,c)})}return l.apply(d,c)};for(var A=o.length;A--;)y[o[A]]=c.required;var B=d.extend(function(a,c,d){m=this,this._items=[],this._source=d.activityContent;try{this._json=g.parse(g.stringify(d.activityContent))}catch(a){throw"JSON parse error. Invalid JSON string."}this._scoring=d.scoring,this[p]=d[p],this.act_template_id=d.act_template_id,this.hasPassed=d.hasPassed,this[u.COMPLETED](!1),this[u.INDEX](0),this[u.LENGTH](1),this._score=100,(this.hasScoring=!!d.activityContent.scoring)?this.type(t.EXERCISE):this.type(t.LEARNING),this._enrollmentLoaded=b.defer()},y);return B.ACT_TYPE=t,B.SCORING_TYPE=v,B.ASR_FALLBACK_TYPE=w,B}),define("school-ui-activity/util/scoring",[],function(){"use strict";function a(a,b){var c,d=a.length;for(c=0;c<d;++c){var e=a[c];if(e._id&&e._id===b)return e}}return{ASR_MIN_PASSED_QUESTIONS_RATE:.7,BASE_ASR_SCORE:70,findById:a,isPhraseCorrect:function(a){return a.score>=70},isWordCorrect:function(a){return a.score>=70},isQuestionOptionCorrect:function(b,c,d){var e=a(b.scoring[c.collection],c.id),f=a(e.options,d);return Boolean(f.selected)}}}),define("school-ui-activity/util/interaction",["./scoring"],function(a){"use strict";function b(a,b){var e={};return e[c]=Boolean(a),e[d]=b,e}var c="correct",d="id";return{makeMatchingInteraction:function(a,c,d){var e=b(a,c);return e.answerId=d,e},makeChoiceInteraction:function(c,d,e,f){f=f||"questions";var g=c.content[f][d],h=g._id,i=a.isQuestionOptionCorrect(c,{id:h,collection:f},e),j=b(i,h);return j.answerId=e,j},makeGroupingInteraction:function(a,c,d){var e=b(a,d);return e.answerId=c,e},makeSequencingInteraction:function(a,c){return b(a,c)},makeTextSelectInteraction:function(a,c,d,e){var f;f="number"==typeof d?[c,d]:c;var g=b(a,f);return g.answerId=e,g},makeSubmitWritingInteraction:function(){return b(!0,"Writing")},makeAlreadySubmittedWritingInteraction:function(){return b(!0,"Writing")},makeAsrInteraction:function(a,c){return b(a,c)},makeAsrFallbackInteraction:function(a,c){return b(a,c)},makeTypingInteraction:function(a,c){return b(a,c)},makeSkipInteraction:function(a){return b(!1,a)}}}),define("troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/flashcard-choice.html",[],function(){return function(a){var b="";b+='\n\n<div class="ets-act-fce">\n\t<div class="ets-act-fce-main">\n\t\t<div class="ets-act-fce-bd">\n\t\t\t<div class="ets-act-fce-stack">\n\t\t\t\t';for(var a=a||{},c=a.cards,d=(a.correctRequired,0);d<c.length;d++)!function(a,c){var c=parseInt(c)+1;b+='\n\t<div class="ets-act-fce-card ',b+=c>4?"ets-candidate ":" ets-stack-"+c+" ",b+='" id="ets-act-fce-card'+a._id+'" data-id="'+a._id+'" data-at-id="'+a._id+'">\n\t\t<div class="ets-bd">\n\t\t\t<img src="'+a.image.url+'" />\n\t\t</div>\n        <div class="ets-icon">\n            <span></span>\n        </div>\n\t\t<div class="ets-ft">\n\t\t\t<div class="ets-act-fce-word ets-audio-only">\n\t\t\t\t<div class="ets-audio">\n\t\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-small">\n\t\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t\t       data-src="'+a.audio.url+'" type="audio/mpeg"\n\t\t\t\t\t\t       data-at-id="answer_audio_'+a._id+'"\n\t\t\t\t\t\t       class="ets-ap ets-ap-small ets-ap-nobar"></audio>\n\t\t\t\t\t</div></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'}(c[d],d),b+="\n\t\t\t\t";b+='\n\t\t\t</div>\n\t\t\t<div class="ets-act-fce-ctrl">\n\t\t\t\t<div class="ets-bd">\n\t\t\t\t\t<div data-at-id="btn-skip" class="ets-act-fce-btn ets-act-btn-skip ets-btn-skip"><span '+function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"}(450011,"Skip")+'></span></div>\n\t\t\t\t\t<div class="ets-act-fce-number">\n\t\t\t\t\t\t<span class="ets-act-fce-number-current"></span> / <span class="ets-act-fce-number-total"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-fce-ft">\n\t\t\t<div class="ets-act-fce-choice">\n\t\t\t\t';for(var d=0;d<c.length;d++)!function(a,c){var c=parseInt(c)+1;b+='\n\t<ul class="ets-options ets-cf ets-none" id="'+a._id+'" data-id="'+a._id+'">\n\t\t';for(var d=0;d<a.options.length;d++)b+='\n\t\t<li id="'+a.options[d]._id+'"  data-id="'+a.options[d]._id+'" data-at-id="'+a.options[d]._id+'"><span>'+a.options[d].text+"</span></li>\n\t\t";b+="\n\t</ul>\n"}(c[d],d),b+="\n\t\t\t\t";return b+='\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\n\t\x3c!-- Activity Summary Start--\x3e\n\t<div class="ets-act-summary-wrap"></div>\n\t\x3c!-- Activity Summary End--\x3e\n</div>\n\n',b+="\n\n"}}),define("school-ui-activity/activity/flashcard-choice/flashcard-choice",["jquery","jquery.ui","poly","when","troopjs-ef/component/widget","school-ui-activity/util/interaction","school-ui-activity/util/scoring","template!./flashcard-choice.html"],function(a,b,c,d,e,f,g,h){"use strict";function i(){this.currentCardIndex=0}function j(){var a=this,b=this._json.content.flashCards;if(this.totalCards=this._json.content.flashCards.length,!b||!b.length)return d.reject(new Error(this.toString()+o));a.correctRequired=Math.ceil(g.ASR_MIN_PASSED_QUESTIONS_RATE*a.totalCards),a.correctCount=0,a.incorrectCount=a.totalCards,a.html(h,{cards:this._json.content.flashCards,correctRequired:a.correctRequired}).tap(k.bind(a))}function k(){var b=this,c=this.$element;c.find(F).click(function(){a(this).hasClass(r)||b.publishSkipInteraction(b.currentCardIndex).then(function(){l.call(b)})}),b.$activeCard=c.find(A),b.$activeQuestion=c.find(G).filter(function(){return a(this).data("id")==b.$activeCard.data("id")}),c.find(G).addClass(y),b.$activeQuestion.removeClass(y),c.find(G+" li").click(function(){n.call(b,a(this))}),c.find(J).text(b.totalCards),c.find(I).text(b.currentCardIndex+1)}function l(){var b=this,c=this.$element;if(c.find(z).trigger("player/pause"),b.currentCardIndex+1>=b.totalCards)c.find(F).addClass(y),b._item.completed(!0),c.find(q).fadeOut(200,function(){m.call(b)});else{var d=c.find(A),e=c.find(B),f=c.find(C),g=c.find(D),h=a(c.find(E).first());b.currentCardIndex++,c.find(J).text(b.totalCards),c.find(I).text(b.currentCardIndex+1),d.animate({left:"+=150",top:"-=100",opacity:"0"},300,function(){a(this).removeAttr("style").removeClass(s).addClass(x),c.find(F).removeClass(r)}),e.animate({top:"0",left:"12"},300,function(){a(this).removeAttr("style").removeClass(t).addClass(s),b.currentCardIndex<b.totalCards&&(b.$activeCard=c.find(A),b.$activeQuestion=c.find(G).filter(function(){return a(this).data("id")==b.$activeCard.data("id")}),c.find(G).addClass(y),b.$activeQuestion.removeClass(y))}),f.animate({top:"6",left:"6"},300,function(){a(this).removeAttr("style").removeClass(u).addClass(t)}),g.animate({top:"12",left:"0",opacity:"1"},300,function(){a(this).removeAttr("style").removeClass(v).addClass(u)}),h.removeClass(w).addClass(v)}}function m(){var b=this,c=this.$element,d=b.isPassed();b.publish(p),a(this).removeClass(y).removeAttr("style"),d&&(c.find(K).removeClass(y),c.find(L).addClass(y),c.find(M).addClass(y)),c.find(H).data("settings",{passed:d,correctNum:b.correctCount,skippedNum:b.incorrectCount,passNum:b.correctRequired}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave()}function n(a){var b=this,c=this.$element;if(!a.hasClass(r)&&!b.optionFreezed){c.find(F).addClass(r);var d=a.data("id"),e=b.checkAnswer(b.currentCardIndex,d);b.displayInteractionResult(e,a)}}var o=": json format is incorrect.",p="dispose/reference",q=".ets-act-fce-main",r="ets-disabled",s="ets-stack-1",t="ets-stack-2",u="ets-stack-3",v="ets-stack-4",w="ets-candidate",x="ets-done",y="ets-none",z=".ets-ap",A=".ets-act-fce-card.ets-stack-1",B=".ets-act-fce-card.ets-stack-2",C=".ets-act-fce-card.ets-stack-3",D=".ets-act-fce-card.ets-stack-4",E=".ets-act-fce-card.ets-candidate",F=".ets-act-fce-btn.ets-btn-skip",G=".ets-act-fce-choice > .ets-options",H=".ets-act-summary-wrap",I=".ets-act-fce-number-current",J=".ets-act-fce-number-total",K=".ets-act-fce-summary > .ets-hd > .ets-pass",L=".ets-act-fce-summary > .ets-hd > .ets-fail",M=".ets-act-fce-summary > .ets-ft > p",N={"sig/render":function(){return j.call(this)},"hub/activity/template/flashcardchoice/load":function(a){var b=this;return b._json=a.json,b._item=a.item,b._super=a._super,b._interacted=!1,b._item.instantFeedback(!0),b.signal("render")},checkAnswer:function(a,b){var c=this,d=c._json,e=f.makeChoiceInteraction(d,a,b,"flashCards"),g=e.correct;return g&&(c.correctCount++,c.incorrectCount--,c._json.content._isCorrect=c.isPassed()),{correct:g,promise:c._super.publishInteraction(e)}},displayInteractionResult:function(a,b){var c=this,d=this.$element,e=c.$activeCard.find(".ets-icon span");c.optionFreezed=!0,a.correct?(c.$activeCard.addClass("ets-correct"),b.addClass("ets-correct"),setTimeout(function(){a.promise.then(function(){l.call(c),c.optionFreezed=!1})},800)):(b.addClass("ets-incorrect"),c.$activeCard.addClass("ets-incorrect"),e.effect("shake",{distance:8,times:3},100,function(){setTimeout(function(){c.$activeCard.removeClass("ets-incorrect"),b.removeClass("ets-incorrect").addClass(r),c.optionFreezed=!1,d.find(F).removeClass(r)},500)}))},publishSkipInteraction:function(a){var b=this,c=b._json.content.flashCards[a]._id,d=f.makeSkipInteraction(c);return b._super.publishInteraction(d)},isPassed:function(){var a=this;return a.correctCount>=a.correctRequired}};return e.extend(i,N)}),define("troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/main.html",[],function(){return function(a){return'<div class="ets-act-fce-wrap" data-weave="school-ui-activity/activity/flashcard-choice/flashcard-choice"></div>'}}),define("school-ui-activity/activity/flashcard-choice/main",["jquery","when","../base/main","template!./main.html","./flashcard-choice"],function(a,b,c,d){"use strict";function e(){}function f(){var a=this;if(a.$element){this._htmlPromise||(this._htmlPromise=this.html(d()));var b=this._json;return this._htmlPromise.then(function(){return a.publish(g,{item:a.items(),json:b,_super:a})})}}var g="activity/template/flashcardchoice/load",h={"sig/initialize":function(){this.length(1)},"sig/render":function(){return f.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(e,h)}),define("troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/flashcard-exercise.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};b+='\n\n<div class="ets-act-fce">\n\t<div class="ets-act-fce-main">\n\t\t<div class="ets-act-fce-bd">\n\t\t\t<div class="ets-act-fce-stack">\n\t\t\t\t';for(var a=a||{},d=a.cards,e=(a.correctRequired,0);e<d.length;e++)!function(a,c){var c=parseInt(c)+1;b+='\n\t<div class="ets-act-fce-card ',b+=c>4?"ets-candidate ":" ets-stack-"+c+" ",b+='" id="ets-act-fce-card'+a._id+'" data-at-id="'+a._id+'">\n\t\t<div class="ets-bd">\n\t\t\t<img src="'+a.image.url+'" />\n\t\t</div>\n        <div class="ets-icon">\n            <span></span>\n        </div>\n\t\t<div class="ets-ft">\n\t\t\t<div class="ets-act-fce-word">\n\t\t\t\t',a.audio&&(b+='\n\t\t\t\t<div class="ets-audio">\n\t\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-small">\n\t\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t\t       data-src="'+a.audio.url+'" type="audio/mpeg"\n\t\t\t\t\t\t       data-at-id="answer_audio_'+a._id+'"\n\t\t\t\t\t\t       class="ets-ap ets-ap-small ets-ap-nobar"></audio>\n\t\t\t\t\t</div></div>\n\t\t\t\t</div>\n\t\t\t\t'),b+='\n\t\t\t\t<div class="ets-text ',a.txt.length>26&&(b+=" ets-text-long"),b+='"><span>'+a.txt+"</span></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n"}(d[e],e),b+="\n\t\t\t\t";return b+='\n\t\t\t</div>\n\t\t\t<div class="ets-act-fce-ctrl">\n\t\t\t\t<div class="ets-bd">\n\t\t\t\t\t<div data-at-id="btn-skip" class="ets-act-fce-btn ets-act-btn-skip ets-btn-skip"><span '+c(450011,"Skip")+'></span></div>\n\t\t\t\t\t<div class="ets-act-fce-number">\n\t\t\t\t\t\t<span class="ets-act-fce-number-current">4</span> / <span class="ets-act-fce-number-total">6</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-fce-ft">\n\t\t\t<div class="ets-act-fce-mic">\n\t\t\t\t <div data-weave="school-ui-activity/shared/asr/asr-ui"></div>\n\t\t\t</div>\n\t\t\t<div class="ets-act-fce-typing ets-none">\n\t\t\t\t<div class="ets-act-fce-typing-box">\n\t\t\t\t\t<div class="ets-input"><input type="text" name="" data-at-id="answer_input" class="ets-act-fce-typing-input" /> <div data-at-id="submit" class="ets-btn ets-btn-blue ets-act-fce-typing-check ets-disabled"><span '+c(443583,"DONE")+'></span></div></div>\n\t\t\t\t\t<i class="ets-icon-correct-s"></i> <i class="ets-icon-incorrect-s"></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\x3c!-- Activity Summary Start--\x3e\n\t<div class="ets-act-summary-wrap"></div>\n\t\x3c!-- Activity Summary End--\x3e\n</div>\n\n\n'}}),define("school-ui-activity/shared/typing-helper/main",["jquery","json2","underscore","school-ui-shared/utils/ccl","when"],function(a,b,c,d,f){"use strict";var g,h={},i=function(b){return a.trim(b.replace(/\s+/g," "))},j=f.promise(function(c,f){d.query('ccl!"e13.activity.typing.replaceDict"').spread(function(d){try{g=b.parse(d.value),g?(a.each(g,function(a,b){var c,d;if(0==b.indexOf("/")){var e=b.lastIndexOf("/");c=b.substring(1,e),d=b.substring(e+1)}else c=b;g[a]=new RegExp(c,d)}),c(g)):f(e)}catch(a){f(a)}})}),k=function(b){return c.isString(b)&&a.each(g,function(a,c){b=b.replace(c,a)}),b};return h.readyPromise=j,h.prepareTypingSolution=function(a){return a.split("/").map(i).map(k)},h.cleanTypingAnswer=function(a){return k(i(a))},h}),define("school-ui-activity/shared/asr/asr-service-message-type",[],function(){return{VOICE_TOO_SLOW:"VOICE_TOO_SLOW",VOICE_TOO_FAST:"VOICE_TOO_FAST",VOICE_TOO_LOW:"VOICE_TOO_LOW",VOICE_TOO_HIGH:"VOICE_TOO_HIGH",CAN_NOT_RECOGNIZE:"CAN_NOT_RECOGNIZE",TIMEOUT:"TIMEOUT",NO_VOICE:"NO_VOICE",FLASH_ERROR:"FLASH_ERROR",SERVER_ERROR:"SERVER_ERROR",INCORRECT_ANSWER:"INCORRECT_ANSWER",INCORRECT_PRONUN:"INCORRECT_PRONUN",FALLBACK:"FALLBACK"}}),define("school-ui-activity/shared/asr/asr-ui-states",[],function(){return{COMMON:"COMMON",START:"START",STOP:"STOP",NORMAL:"NORMAL",DISABLE:"DISABLE",RECORDING:"RECORDING",PROCESSING:"PROCESSING",PREPARING:"PREPARING",WARNING:"WARNING",ERROR:"ERROR",HINT:"HINT",DOWN:"DOWN",BROKEN:"BROKEN",START_REPLAY:"START_REPLAY",STOP_REPLAY:"STOP_REPLAY"}}),define("school-ui-activity/activity/flashcard-exercise/flashcard-exercise",["jquery","jquery.ui","poly","when","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./flashcard-exercise.html","school-ui-activity/shared/typing-helper/main","school-ui-shared/enum/rating-source-type","school-ui-activity/shared/asr/asr-service-message-type","school-ui-activity/shared/asr/asr-ui-states"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){this.currentCardIndex=0,this.correctCount={},this.incorrectCount={},this.totalCards={},this.$activeCard={},this.$activeQuestion={},this.answerMode="ASR",this.asrDisabled=!1,this.asrMode=j.ASR_SPEAKING}function n(){var a=this,b=this._json.content.flashCards;if(!b||!b.length)throw this.toString()+v;return a.totalCards=this._json.content.flashCards.length,a.correctRequired=Math.ceil(f.ASR_MIN_PASSED_QUESTIONS_RATE*a.totalCards),a.correctCount=0,a.incorrectCount=a.totalCards,b&&b[0]&&b[0].pronsXML&&(a.hasPronsXML=!0),a.html(h,{cards:b,correctRequired:a.correctRequired})}function o(){var b=this,c=this.$element,d=!b.asrDisabled&&!b._json.asrDisabled&&b.hasPronsXML&&window.location.search.indexOf("non-asr")<0;c.find(M).click(function(){a(this).hasClass(x)||(b.publish("asr/disable"),b.publish("asr/ui/playback",!1),b.publishSkipInteraction(b.currentCardIndex).then(function(){r.call(b),b.publish("asr/enable")}))}),b.$activeCard=c.find(H),c.find(U).text(b.totalCards),c.find(T).text(b.currentCardIndex+1),b.publish(V,q.bind(b),b._json.content.flashCards[b.currentCardIndex],{asrFallbackType:"TYPING",asrFallbackCb:p.bind(b,"TYPING"),needResetASRFailedTimes:!0,asrEnableTip:!0}),d||(p.call(b,"TYPING"),b.asrMode=j.ASR_TYPING)}function p(a){var b=this,c=this.$element;switch(a){case"ASR":b.answerMode="ASR",c.find(N).addClass(E),c.find(G).removeClass(E),c.find(R).removeClass(F),c.find(P).unbind("click"),c.find(O).unbind("change"),b._super.scoringType("asr");break;case"TYPING":b.answerMode="TYPING",c.find(G).addClass(E),c.find(N).removeClass(E),c.find(R).addClass(F),b._super.scoringType("default"),c.find(P).click(function(){t.call(b)}),u.call(b)}}function q(a){var b=this,c=a[0],d=b.checkAnswer(b.currentCardIndex,c);b.displayInteractionResult(d,a)}function r(){var b=this,c=this.$element;if(c.find(Q).trigger("player/pause"),b.currentCardIndex+1>=b.totalCards)c.find(M).addClass(E),b._json.content._isCorrect=b.isActivityPassed(),b._item.completed(!0),c.find(w).fadeOut(200,function(){s.call(b)});else{var d=c.find(H),e=c.find(I),f=c.find(J),g=c.find(K),h=a(c.find(L).first());b.currentCardIndex++,c.find(T).text(b.currentCardIndex+1),d.animate({left:"+=150",top:"-=100",opacity:"0"},300,function(){a(this).removeAttr("style").removeClass(y).addClass(D)}),e.animate({top:"0",left:"12"},300,function(){a(this).removeAttr("style").removeClass(z).addClass(y),b.$activeCard=c.find(H)}),f.animate({top:"6",left:"6"},300,function(){a(this).removeAttr("style").removeClass(A).addClass(z)}),g.animate({top:"12",left:"0",opacity:"1"},300,function(){a(this).removeAttr("style").removeClass(B).addClass(A)}),h.removeClass(C).addClass(B),c.find(O).removeAttr("readonly").val(""),c.find(P).addClass(x),b.publish(V,q.bind(b),b._json.content.flashCards[b.currentCardIndex],{asrEnableTip:!0})}}function s(){var a=this;this.$element.find(S).data("settings",{passed:a.isActivityPassed(),correctNum:a.correctCount,skippedNum:a.incorrectCount,passNum:a.correctRequired}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave(),a.publish(W)}function t(){var a=this,b=this.$element,c=b.find(P),d=b.find(O);if("TYPING"!=!this.answerMode&&!c.hasClass(x)){var e=d.val(),f=a.checkTypingAnswer(a.currentCardIndex,e);a.displayInteractionResult(f)}}function u(){var b=this,c=this.$element,d=c.find(P),e=c.find(O);e.keyup(function(c){13==c.which?t.call(b):a.trim(e.val()).length>0?d.removeClass(x):d.addClass(x)})}var v=": json format is incorrect.",w=".ets-act-fce-main",x="ets-disabled",y="ets-stack-1",z="ets-stack-2",A="ets-stack-3",B="ets-stack-4",C="ets-candidate",D="ets-done",E="ets-none",F="ets-audio-only",G=".ets-act-fce-mic",H=".ets-act-fce-card.ets-stack-1",I=".ets-act-fce-card.ets-stack-2",J=".ets-act-fce-card.ets-stack-3",K=".ets-act-fce-card.ets-stack-4",L=".ets-act-fce-card.ets-candidate",M=".ets-act-fce-btn.ets-btn-skip",N=".ets-act-fce-typing",O=".ets-act-fce-typing-input",P=".ets-act-fce-typing-check",Q=".ets-ap",R=".ets-act-fce-word",S=".ets-act-summary-wrap",T=".ets-act-fce-number-current",U=".ets-act-fce-number-total",V="asr/ui/setting",W="dispose/reference",X={"sig/render":function(){return d.all([n.call(this),i.readyPromise])},"sig/start":function(){var a=this;a.query('ccl!"school.asr.enabled"').spread(function(b){a.asrDisabled=!(b&&"true"===b.value)})},"hub/asr/ui/states/changed":function(a){if(a){var b=this.$element,c=b.find(M);switch(a){case l.RECORDING:case l.PROCESSING:case l.PREPARING:case l.DISABLE:c.addClass(x);break;default:c.removeClass(x)}}},"hub/rating/sourceType":function(){return[this.asrMode]},"dom:.ets-ap/media/play":function(){this.publish("asr/stopPlayback")},isActivityPassed:function(){var a=this;return a.correctCount>=a.correctRequired},checkAnswer:function(a,b){var c=this,d=f.isPhraseCorrect(b);return d&&c.incrementCorrectCount(),{correct:d,promise:this._super.publishInteraction(g.makeAsrInteraction(d,b._id))}},checkTypingAnswer:function(a,b){var c=this,d=c._json,e=d.content.flashCards[a],h=f.findById(d.scoring.flashCards,e._id),j=i.cleanTypingAnswer(b).toLowerCase(),k=i.cleanTypingAnswer(h.answer).toLowerCase(),l=k===j;return l&&c.incrementCorrectCount(),{correct:l,promise:this._super.publishInteraction(g.makeAsrFallbackInteraction(l,e._id))}},publishSkipInteraction:function(a){var b=this,c=b._json.content.flashCards[a]._id,d=g.makeSkipInteraction(c);return b._super.publishInteraction(d)},incrementCorrectCount:function(){var a=this;a.correctCount++,a.incorrectCount--},displayInteractionResult:function(a,b){var c=this,d=(this._json,this.$element),e=d.find(".ets-act-fce-typing-box"),f=d.find(O),g=c.$activeCard.find(".ets-icon span");a.correct?(c.$activeCard.addClass("ets-correct"),e.addClass("ets-correct"),f.attr("disabled","disabled"),c.publish("asr/disable"),setTimeout(function(){a.promise.then(function(){r.call(c),e.removeClass("ets-correct"),f.removeAttr("disabled").focus(),c.publish("asr/enable")})},800)):(c.$activeCard.addClass("ets-incorrect"),e.addClass("ets-incorrect"),f.attr("disabled","disabled"),b&&!b._hasError&&c.publish("asr/show/message",k.INCORRECT_PRONUN),g.effect("shake",{distance:8,times:3},100,function(){setTimeout(function(){c.$activeCard.removeClass("ets-incorrect"),e.removeClass("ets-incorrect"),f.removeAttr("disabled").focus()},500)}))}};return X["hub/activity/template/flashcardexercise/load"]=function(a,b){var c=this;return c._json=b.json,c._item=b.item,c._super=a,c._interacted=!1,c._item.instantFeedback(!0),c.signal("render").then(function(){o.call(c)})},e.extend(m,X)}),define("troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/main.html",[],function(){return function(a){return'<div class="ets-act-fce-wrap" data-weave="school-ui-activity/activity/flashcard-exercise/flashcard-exercise"></div>'}}),define("school-ui-activity/activity/flashcard-exercise/main",["jquery","when","../base/main","school-ui-activity/shared/typing-helper/main","./flashcard-exercise","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(){this.scoringType(c.SCORING_TYPE.ASR)}function h(){var a=this;if(a.$element){a._htmlPromise||(a._htmlPromise=a.html(f()));var b=this._json;return a._htmlPromise.then(function(){return a.publish(i,a,{item:a.items(),json:b})})}}var i="activity/template/flashcardexercise/load",j={"sig/initialize":function(){this.length(1)},"sig/render":function(){return h.call(this)},"sig/finalize":function(){delete this._htmlPromise},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(g,j)}),define("troopjs-requirejs/template!school-ui-activity/activity/flashcard-presentation/flashcard-presentation.html",[],function(){return function(a){var b="",c=a.flashCards,d=c.length,e="";d<10&&(e="ets-distant"),b+='\n<div class="ets-act-fcp">\n\t<div class="ets-act-fcp-main ">\n\t\t<ul>\n\t\t\t';for(var f=0;f<d;f++)b+='\n\t\t\t\t<li class="ets-act-fcp-item ets-foggy '+e+'" data-at-id="'+c[f]._id+'" data-index="'+f+'">\n\t\t\t\t\t<img src="'+c[f].image.url+'" alt="" />\n\t\t\t\t</li>\n\t\t\t';return b+='\n\t\t</ul>\n\t</div>\n\t<div class="ets-act-fcp-side">\n\t\t<div class="ets-act-fcp-card-wrap">\n\t\t\t<div class="ets-act-fcp-card">\n\t\t\t\t<div class="ets-act-fcp-card-front">\n\t\t\t\t\t<div class="ets-act-fcp-card-img"></div>\n\t\t\t\t\t<div class="ets-act-fcp-card-vocabulary">\n\n\t\t\t\t\t\t<div class="ets-act-fcp-card-audio">\n\t\t\t\t\t\t\t<div data-at-id="answer_audio" class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-small">\n\t\t\t\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t\t\t\t       id="ets-act-fcp-audio-player"\n\t\t\t\t\t\t\t\t       data-src="'+c[0].audio.url+'" type="audio/mpeg"\n\t\t\t\t\t\t\t\t       class="ets-ap ets-ap-small ets-ap-nobar"></audio>\n\t\t\t\t\t\t\t</div></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="ets-act-fcp-card-text"></div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ets-act-fcp-card-back ets-none">\n\t\t\t\t\t<div class="ets-act-fcp-card-translation">\n\t\t\t\t\t\t<h4></h4>\n\t\t\t\t\t\t<div class="ets-translation">\n\t\t\t\t\t\t\t<span class="ets-translation-title"></span> \n\t\t\t\t\t\t\t<span class="ets-partofspeech"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ets-pronunciation">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="ets-definition">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ets-example">\n\t\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-fcp-card-action ets-none">\n\t\t\t<div class="ets-btn ets-btn-white ets-btn-shadowed ets-act-fcp-flip ets-act-fcp-normal" data-at-id="btn-filp">\n\t\t\t\t<span>\n\t\t\t\t\t<i class="ets-icon-flip"></i>\n\t\t\t\t\t<span class="ets-act-fcp-info-normal" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'469642\' data-text-en=\'Grammar Notes\'></span>\n\t\t\t\t\t<span class="ets-act-fcp-info-back" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'469643\' data-text-en=\'Flip Back\'></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-fcp-reminder ets-clear" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'465094\' data-text-en=\'Make sure you try all cards at least once before moving on!\'></div>\n</div>'}}),define("school-ui-activity/activity/flashcard-presentation/main",["jquery","poly","underscore","../base/main","troopjs-core/pubsub/hub","jquery.flip","template!./flashcard-presentation.html"],function(a,b,c,d,e,f,g){"use strict";function h(){var a=this,b=a._cardFlipped;f(a._$card).flip({direction:b?"lr":"rl",bgColor:"#eee",speed:300,onEnd:function(){a._$cardFront.toggleClass(r,!b),a._$cardBack.toggleClass(r,b),a._$btnFlip.toggleClass(u,!b),a._$card.removeAttr("style"),a._cardFlipped=!a._cardFlipped}})}function i(b){var c=this,d=a(b);if(!d.hasClass(s)){clearTimeout(c.playTimeoutId),c._$items.not(d).removeClass(s),d.addClass(s),d.removeClass(t)
;var e=d.find("img").clone(),f=d.data("index"),g=c._json.content.flashCards[f],i=g.audio.url,l=g.txt,m=this._$phImage,n=function(){m.hide().html(e).fadeIn(w)};m.children().length?m.fadeOut(v,n):n(),c._$phText.text(l),j.call(c,g),c._cardFlipped&&h.call(c),c.playTimeoutId=setTimeout(function(){a(q).trigger("player/play",i)},500),this.$element.find(k).length||this.items().completed(!0)}}function j(b){var d=b.translation,e=b.txt,f=this;if(d){var g=a.trim(d.phoneticSpelling),h=[];c.isArray(d.sampleSentences)&&d.sampleSentences.forEach(function(a){var b,d="";a&&(c.isObject(a)?(d=f.isNeedShowTrans&&a.value!=a.key?"<br/>&nbsp;&nbsp;&nbsp;&nbsp;"+['<span class="ets-translation">',a.value,"</span>"].join(""):"",b=a.key+d,h.push(b)):h.push(a))});var i=h.length?"<li><span>"+h.join("</span></li><li><span>")+"</span></li>":"";g=g.length&&0!==g.indexOf("/")?"/"+g+"/":g,this._$trans.find(l).text(e).end().find(n).text(d.translation==e?"":d.translation).end().find(o).text(d.definition).end().find(p).html(i).end().find(m).text(g)}}var k=".ets-act-fcp-item.ets-foggy",l="> h4",m="> .ets-pronunciation > span",n="> .ets-translation .ets-translation-title",o="> .ets-definition",p="> .ets-example ol",q="#ets-act-fcp-audio-player",r="ets-none",s="ets-active",t="ets-foggy",u="ets-act-fcp-back",v=100,w=200;return d.extend({"sig/start":function(){var a=this;a._cardFlipped=!1,a.type(d.ACT_TYPE.LEARNING)},"sig/render":function(){function a(a){a&&(b="en"===a.cultureCode,c="Anat"===a.partnerCode,f.isNeedShowTrans=!b&&!c)}var b,c,d=this.$element,f=this;return f.isNeedShowTrans=!0,e.subscribe("context",e,a),e.reemit("context",!1,e,a),e.unsubscribe("context",e,a),f.renderPromise=f.html(g,{flashCards:f._json.content.flashCards,hasPassed:f.hasPassed}).then(function(){f._$items=d.find(".ets-act-fcp-item"),f._$card=d.find(".ets-act-fcp-card"),f._$cardFront=d.find(".ets-act-fcp-card-front"),f._$cardBack=d.find(".ets-act-fcp-card-back"),f._$phImage=d.find(".ets-act-fcp-card-img"),f._$phText=d.find(".ets-act-fcp-card-text"),f._$btnFlip=d.find(".ets-act-fcp-flip"),f._$trans=d.find(".ets-act-fcp-card-translation"),i.call(f,f._$items[0]),"FlaPreFlip"===f._json.templateCode&&f._json.canFlipCard&&d.find(".ets-act-fcp-card-action").removeClass(r)})},"sig/finalize":function(){var a=this;f(a._$card).stop(!0,!0),a.renderPromise&&a.renderPromise.ensure(function(){a._$items=null,a._$card=null,a._$cardFront=null,a._$cardBack=null,a._$phImage=null,a._$phText=null,a._$btnFlip=null,a._$trans=null})},"dom:.ets-act-fcp-item/click":function(a){i.call(this,a.currentTarget)},"dom:.ets-act-fcp-flip/click":function(){h.call(this)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/grouping/grouping.html",[],function(){return function(a){var b="",c=a.wordItems,d=a.wordGroups,e=a.references,f=c.length,g=d.length,h=a.isCopyMode?"ets-act-grp-strip-copy":"ets-act-grp-strip-move";b+="\n",e.aud&&(b+='\n<div class="ets-act-grp-audio">\n    <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n        <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n               data-src="'+e.aud.url+'" type="audio/mpeg"\n               class="ets-ap"></audio>\n    </div></div>\n</div>\n'),b+='\n<div class="ets-act-grp">\n    <div class="ets-act-grp-droparea">\n        ';for(var i=0;i<g;i++)b+="\n            <section>\n                <h5><span>"+d[i].txt+'</span></h5>\n                <div class="ets-act-grp-target" data-group="'+d[i]._id+'" data-at-id="'+d[i]._id+'"></div>\n            </section>\n        ';b+='\n    </div>\n\n    <div class="ets-act-grp-originarea">\n        ';for(var i=0;i<f;i++)b+='\n            <div class="ets-act-grp-strip '+h+'" data-group="'+c[i]._id+'" data-at-id="'+c[i]._id+'"><p>'+c[i].txt+"</p></div>\n        ";return b+="\n    </div>\n</div>"}}),define("school-ui-activity/activity/grouping/main",["jquery","school-ui-activity/activity/base/main","troopjs-core/component/factory","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./grouping.html","jquery.ui","jquery.ui.touch-punch","underscore"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){var c=this,d=c._allItemsCount=b.filterOptions.optionNo,e=b.filterOptions.distNo,f=[],g=0,h=a.extend(!0,{},b),j=c._source.scoring.items,k=a.extend(!0,{},c._source.scoring.groups),l=[];if(h.content.items=[],e>0&&(j=i.shuffle(j),f=j.slice(0,e),h.content.items=h.content.items.concat(f)),a.each(c._source.scoring.groups,function(a,b){g+=b.items.length}),d>=g)a.each(c._source.scoring.groups,function(a,b){h.content.items=h.content.items.concat(b.items)}),c._allItemsCount=g;else{for(;d>0;)a.each(k,function(a,b){if(b.items=i.shuffle(b.items),b.items&&b.items.length&&(h.content.items.push(b.items.shift()),d--),d<=0)return!1});a.each(k,function(a,b){b.items&&b.items.length&&(l=l.concat(b.items))}),a.each(b.scoring.groups,function(b,c){if(0===l.length)return!1;c.items&&c.items.length&&(c.items=a.grep(c.items,function(b){var c=!0;return a.each(l,function(a,d){if(b._id===d._id)return c=!1,!1}),c}))})}return a.each(h.content.items,function(c,d){a.each(b.content.items,function(a,b){if(d._id===b._id)return d.txt=b.txt,!1})}),delete b.scoring.items,b.content.items=i.shuffle(h.content.items),b.content.items=i.uniq(b.content.items,!1,function(a){return a.txt}),b}function k(b){var c=b.filterOptions.optionNo,d=a.extend(!0,{},b);return b.content.items=i.shuffle(d.content.items).slice(0,c),b.content.items=i.uniq(b.content.items,!1,function(a){return a.txt}),b}function l(a){return this.hasScoring?j.call(this,a):k.call(this,a)}function m(){var b=this,c=this.$element.find(y),d=this.$element.find(x);c.droppable({accept:A,hoverClass:H,drop:function(c,d){var e=a(this),f=d.draggable;s.call(b,f,e)}}),a.each(d.find(A),function(c,d){var e=a(d),f=b._isCopyMode;e.draggable({containment:z,revert:"invalid",revertDuration:300,snapMode:"inner",stack:f?"":"div.ets-act-grp-strip",helper:f?"clone":"original",cancel:"",scroll:!1,stop:function(){var b=a(this);b.parent().hasClass(C)||b.animate({left:0,top:0},500)},start:function(b,c){var d=a(this);if(f&&c.helper.removeClass(E).addClass(D),d.parent().hasClass(C))return!1}})})}function n(a,b,c){var d=this,e=b.clone();e.removeClass(E).addClass(D),c.prepend(e.css({left:0,top:0})),a?(d.hasScoring&&e.addClass(F),window.setTimeout(function(){p.call(d,e)},L.correct)):(e.addClass(G),window.setTimeout(function(){e.removeClass(G),r.call(d,e,b,c)},L.incorrect))}function o(a,b,c){var d=this;c.prepend(b.css({left:0,top:0})),a?(d.hasScoring&&b.addClass(F),window.setTimeout(function(){p.call(d,b)},L.correct)):(b.addClass(G),window.setTimeout(function(){d.$element.find(x).append(b.removeClass(G)),q.call(d,b,c)},L.incorrect))}function p(b){b.animate({top:60},500,function(){a(this).addClass(I);var c=b.attr("data-group");b.siblings('[data-group="'+c+'"]').length>0&&b.remove()})}function q(a,b){var c={left:b.offset().left-a.offset().left,top:b.offset().top-a.offset().top};a.css({left:c.left,top:c.top}).animate({left:0,top:0},500)}function r(a,b,c){var d=this,e={sLeft:b.position().left,sTop:b.position().top,tLeft:c.position().left,tTop:c.position().top};d.$element.find(x).append(a.css({position:"absolute"})),a.css({left:e.tLeft,top:e.tTop}).animate({left:e.sLeft,top:e.sTop},500,function(){a.remove()})}function s(a,b){var c,d=this,e=a.data("group"),f=b.data("group");c=d.checkAnswer(e,f),d.displayInteractionResult(c,a,b)}function t(){var a=this;if(!a.hasScoring)return a.items().answered(!0),!1;a._json.content._isCorrect=!0;var b=a.$element.find(w),c=a.$element.find(x);b.addClass(J).hide().fadeIn("slow"),u.call(a),0===c.children().length&&c.remove(),a.$element.parents(B).css({"vertical-align":"top"}),a.items().completed(!0),a.publish("activity-container/resize")}function u(){var a=this.$element.find(x);a.find(A).draggable("disable"),a.addClass(K)}function v(){var a=this;a._isCopyMode="GroupCopy"==a._json.templateCode;var b={wordItems:a._json.content.items,wordGroups:a._json.content.groups,references:a._json.references,isCopyMode:a._isCopyMode};return a.html(f,b).then(function(){return m.call(a),a.attachATAssetDom(a._json.content.items)})}var w=".ets-act-grp-droparea",x=".ets-act-grp-originarea",y=".ets-act-grp-target",z=".ets-act-bd",A=".ets-act-grp-strip",B="div.ets-act-bd-main",C="ets-act-grp-target",D="ets-act-grp-strip-move",E="ets-act-grp-strip-copy",F="ets-correct",G="ets-incorrect",H="ets-hover",I="ets-accepted",J="ets-act-grade-completed",K="ets-act-strip-disabled",L={correct:500,incorrect:800},M={"sig/initialize":function(){this.hasScoring||this.type(b.ACT_TYPE.PRACTICE),this.items().instantFeedback(!0),l.call(this,this._json)},"sig/render":function(){return v.call(this)},completed:c.around(function(a){return function(){a.apply(this,arguments),this._COMPLETED&&u.call(this)}}),checkAnswer:function(a,b){var c=this;if(!c.hasScoring)return window.setTimeout(function(){t.call(c)},L.correct),!0;var f=c._json,g=d.findById(f.scoring.groups,b),h=d.findById(g.items,a),j=Boolean(h),k=!1;if(j&&(c._storeGroup[b]=c._storeGroup[b]||[],-1===i.indexOf(c._storeGroup[b],a)?(c._storeGroup[b].push(a),c._allItemsCount--):k=!0),!k){var l=c.publishInteraction(e.makeGroupingInteraction(j,b,a));0==c._allItemsCount&&window.setTimeout(function(){l.then(function(){t.call(c)})},L.correct)}return j},displayInteractionResult:function(a,b,c){var d=this;d._isCopyMode?n.call(d,a,b,c):o.call(d,a,b,c)}};return b.extend(function(){this._allItemsCount=0,this._storeGroup={}},M)}),define("troopjs-requirejs/template!school-ui-activity/activity/language-comparison/language-comparison.html",[],function(){return function(a){var b="",a=a||{},c=this,d=a.content.phrases[c.index()],e=d.audio.url,f=d.text,g=d.translation,h=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};return b+='\r\n\r\n<div class="ets-act-lnc ets-cf">\r\n\t<div class="ets-act-lnc-main">\r\n\t\t<div class="ets-act-btn-skip ets-act-lnc-skip">\r\n\t\t\t<span '+h(450011,"Skip")+'></span>\r\n\t\t</div>\r\n\t\t<div class="ets-act-lnc-content">\r\n\t\t\t<div class="ets-act-lnc-play">\r\n\t\t\t\t<div class="ets-act-lnc-play-content">\r\n\t\t\t\t\t<div class="ets-table-hack">\r\n\t\t\t\t\t\t<div class="ets-act-lnc-play-container">\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-play-tip ets-none">\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-play-tip-top"></div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-play-tip-mid">\r\n\t\t\t\t\t\t\t\t\t<span class="ets-act-lnc-tip-msg" '+h(462459,"Listen to the audio")+'></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-play-tip-bottom"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-play-btn">\r\n\t\t\t\t\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t\t\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t\t\t\t\t\t\t\t       data-src="'+e+'" type="audio/mpeg"\r\n\t\t\t\t\t\t\t\t\t       class="ets-ap" controls="controls"></audio>\r\n\t\t\t\t\t\t\t\t</div></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-play-sentences">\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-play-original">'+f+'</div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-play-translation">'+g+'</div>\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class="ets-act-lnc-record">\r\n\t\t\t\t<div class="ets-act-lnc-record-content">\r\n\t\t\t\t\t<div class="ets-act-lnc-record-msg ets-first-time">\r\n\t\t\t\t\t\t<div class="ets-table-hack">\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-record-btn" data-weave="school-ui-activity/shared/asr/asr-ui"></div>\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-record-tip ets-away">\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-tip-top"></div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-tip-mid">\r\n\t\t\t\t\t\t\t\t\t<span class="ets-act-lnc-tip-msg ets-act-lnc-tip-msg-repeat" '+h(465087,"Try to repeat the phrase")+'></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-tip-bottom"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-container ets-away">\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-title">\r\n\t\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-title-top"></div>\r\n\t\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-title-bottom">\r\n\t\t\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-title-content-container">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class="ets-act-lnc-record-msg-title-content ets-act-lnc-record-msg-title-content-correct" '+h(480559,"Correct")+'>Correct</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class="ets-act-lnc-record-msg-title-content ets-act-lnc-record-msg-title-content-wrong" '+h(480560,"Try again!")+'></span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\t\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-content-container-top">\r\n\t\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-content-container-inner">\r\n\t\t\t\t\t\t\t\t\t\t<div class="ets-table-hack">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class="ets-ap-lnc-record"></div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class="ets-table-hack">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-content"></div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class="ets-act-lnc-record-msg-content-container-bottom"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="ets-act-lnc-new-icon"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="ets-act-lnc-number">\r\n                <span class="ets-act-lnc-number-current"></span> / <span class="ets-act-lnc-number-total"></span>\r\n            </div>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t\x3c!-- Activity Summary Start--\x3e\r\n\t<div class="ets-act-summary-wrap"></div>\r\n\t\x3c!-- Activity Summary End--\x3e\r\n</div>'}}),define("school-ui-activity/activity/language-comparison/v1",["jquery","when","poly","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./language-comparison.html","school-ui-shared/enum/rating-source-type","school-ui-activity/shared/asr/asr-service-message-type","school-ui-activity/shared/asr/asr-ui-states","school-ui-shared/utils/update-helper","school-ui-shared/utils/typeid-parser","school-ui-shared/enum/activity-event-type"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var a=this;return a.publish("activity/step/render",a.index(),a.length()-1),a.items().instantFeedback(!0),a.html(g,a._json).then(function(){o.call(a)})}function o(){var b=this,c=b.$element,e=b._json.content.phrases[b.index()],f=e.text,g=e.translation;b._firstTimePlay=!0,b._firstTimeRecord=!0,b._playMediaElement="",b._recordMediaElement="",b._asrState="NORMAL",f.replace(/\’/g,"'")===g.replace(/\’/g,"'")&&c.find(N).hide(),c.find(C).click(function(){a(this).hasClass(A)||(v.call(b,"skip"),b.index()+1!==b.length()&&b.publishSkipInteraction(b.index()).then(function(){b.publish("asr/ui/playback",!1),b.nextStep()}))}),0!=b.index()&&c.find(E).addClass(B),p.call(b),b.asrDisabled||window.location.search.indexOf("non-asr")>0?(c.find(C).addClass(A),c.find(E).addClass(x),b._json.content[Q]=!0,b.index(b.length()-1),b.completed(!0),b.publish("asr/disable")):(c.find(E).removeClass(x),b.publish(W,q.bind(b),b._json.content.phrases[b.index()],{asrFallbackType:d.ASR_FALLBACK_TYPE.NEXT,asrFallbackCb:function(){c.find(C).addClass(A),b._json.content[Q]=!0,b.index(b.length()-1),b.completed(!0)},needResetASRFailedTimes:!0}))}function p(){var a=this,b=a.$element;b.find(K).text(a.index()+1),b.find(L).text(a.length()-1)}function q(a,b){if(!a._hasError){var c=this,d=c.$element,f="",g=d.find(C),h=d.find(G),i=d.find(H),j=d.find(F),k=c.index(),l=a[0],m=this.checkAnswer(k,l),n=l.words;if(n){for(var o=0;o<n.length;o++){f+="<span class='"+(e.isWordCorrect(n[o])?"":y)+"'>"+n[o].word+"</span>"}d.find(I).html(f),j.addClass(B),m?(g.addClass(A),h.removeClass(y).addClass(z),d.find(O).removeClass(x),d.find(P).addClass(x)):(g.removeClass(A),h.addClass(y).removeClass(z),d.find(P).removeClass(x),d.find(O).addClass(x)),r.call(c,b),i.removeClass(B),v.call(c,"passOrFail")}}}function r(a){var b=this,c=b.$element.find(D);c.unweave().then(function(){return c.data("option",{_playHandler:function(){b.publish(Y)},_pauseHandler:function(){b.publish(X)},guid:a}).attr("data-weave",$+"(option)").weave()})}function s(){var a=this,b=a.length()-1,c=a._answersCorrectness.reduce(function(a,b){return b?a+1:a},0),d=b-c,f=Math.ceil(e.ASR_MIN_PASSED_QUESTIONS_RATE*b),g=c>=f;return t.call(a,g,c,d,f),a._json.content._isCorrect=g,u.call(a,!0)}function t(a,b,c,d){var e=this,f=e.$element;e.$element.find(M).fadeOut(300,function(){f.find(J).data("settings",{passed:a,correctNum:b,skippedNum:c,passNum:d}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave()}),e.publish(Z)}function u(a){var c=this,d=c.index(),e=c.items(d).answeredPromise(a),f=c.items(d).completedPromise(a);return b.all([e,f])}function v(a){var b=this,c=b.index(),d=b._json.content.phrases[c],e=Boolean(b._answersCorrectness[c]);w[c]&&("passOrFail"===a&&(a=e?"pass":"fail"),k.logActEvent({activityId:l.parseId(b[T]||b[S]),eventDescr:d[R]+V[a],eventTypeId:U[b.feedbackVersion]})),e&&(w[c]=e)}var w,x="ets-none",y="ets-wrong",z="ets-correct",A="ets-disabled",B="ets-away",C=".ets-act-lnc-skip",D=".ets-ap-lnc-record",E=".ets-act-lnc-play-tip",F=".ets-act-lnc-record-tip",G=".ets-act-lnc-record-content",H=".ets-act-lnc-record-msg-container",I=".ets-act-lnc-record-msg-content",J=".ets-act-summary-wrap",K=".ets-act-lnc-number-current",L=".ets-act-lnc-number-total",M=".ets-act-lnc-main",N=".ets-act-lnc-play-translation",O=".ets-act-lnc-record-msg-title-content-correct",P=".ets-act-lnc-record-msg-title-content-wrong",Q="_isCorrect",R="_id",S="act_id",T="act_template_id",U={V1:m.lngCompRetryTimesV1,V2:m.lngCompRetryTimesV2},V={pass:"|pass",fail:"|fail",skip:"|skip",warning:"|warning",broken:"|broken"},W="asr/ui/setting",X="asr/stopPlayback",Y="asr/startPlayback",Z="dispose/reference",$="school-ui-activity/shared/audio/audio-shell",_={"sig/initialize":function(){var a=this,b=a._json.content.phrases.length;a.scoringType(d.SCORING_TYPE.ASR),a.length(b+1)},"sig/render":function(){if(!(this.index()>=this.length()-1))return n.call(this)},"sig/finalize":function(){var a=this;a._summaryTimer>0&&window.clearTimeout(a._summaryTimer)},"sig/start":function(){var a=this;a.query('ccl!"school.asr.enabled"').spread(function(b){a.asrDisabled=!(b&&"true"===b.value),w=[]})},checkAnswer:function(a,b){var c=this,d=e.isPhraseCorrect(b);return c._answersCorrectness[a]=d,this.publishInteraction(f.makeAsrInteraction(d,b._id)).then(function(){u.call(c,d)}),d},publishSkipInteraction:function(a){var b=this,c=b._json.content.phrases[a]._id,d=f.makeSkipInteraction(c);return b.publishInteraction(d).then(function(){u.call(b,!0)})},nextStep:function(){var a=this.index(),c=this;return c.publish("asr/disable"),a>c.length()-2?b.resolve():a===c.length()-2?c.indexPromise(a+1).then(s.bind(c)):c.indexPromise(a+1).then(function(){return c.publish(X)}).then(function(){return c.signal("render")})},"hub/asr/ui/states/changed":function(a){function b(){d.find(H).addClass(B),e.removeClass(A)}if(a){var c=this,d=c.$element,e=d.find(C);switch(c._asrState=a,a){case j.NORMAL:!1===c._firstTimePlay&&d.find(F).removeClass(B),e.removeClass(A);break;case j.RECORDING:case j.PROCESSING:e.addClass(A),d.find(F).addClass(B);break;case j.PREPARING:c.items(c.index()).answered(!1),e.addClass(A),c._firstTimeRecord&&(c._firstTimeRecord=!1),d.find(F).addClass(B),d.find(H).addClass(B),d.find(".ets-ap").trigger("player/pause");break;case j.BROKEN:b(),v.call(c,"broken");break;case j.WARNING:b(),v.call(c,"warning");break;case j.HINT:case j.ERROR:case j.DOWN:b();break;case j.DISABLE:d.find(F).addClass(B)}}},"hub/rating/sourceType":function(){return[h.ASR_SPEAKING]},"dom:.ets-ap/media/play":function(){var a=this,b=a.$element;a.publish(X),a._firstTimePlay&&(b.find(E).addClass(B),"NORMAL"===a._asrState&&a._firstTimeRecord&&b.find(F).removeClass(B),a._firstTimePlay=!1)}};return d.extend(function(a){this._playMediaElement,this._recordMediaElement,this._firstTimePlay,this._firstTimeRecord,this._asrState,this.asrDisabled=!1,this.feedbackVersion=a.data("option").abtestVersion,this._answersCorrectness=[]},_)}),define("school-ui-activity/activity/language-comparison/v2",["jquery","poly","when","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./language-comparison.html","school-ui-shared/enum/rating-source-type","school-ui-activity/shared/asr/asr-service-message-type","school-ui-activity/shared/asr/asr-ui-states","school-ui-shared/utils/update-helper","school-ui-shared/utils/typeid-parser","school-ui-shared/enum/activity-event-type"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var a=this;return a.publish("activity/step/render",a.index(),a.length()-1),a.items().instantFeedback(!0),a.html(g,a._json).then(function(){o.call(a)})}function o(){var b=this,c=b.$element,e=b._json.content.phrases[b.index()],f=e.text,g=e.translation;b._firstTimePlay=!0,b._firstTimeRecord=!0,b._playMediaElement="",b._recordMediaElement="",b._asrState="NORMAL",f.replace(/\’/g,"'")===g.replace(/\’/g,"'")&&c.find(P).hide(),c.find(E).click(function(){a(this).hasClass(A)||(w.call(b,"skip"),b.index()+1!==b.length()&&b.publishSkipInteraction(b.index()).then(function(){b.publish("asr/ui/playback",!1),b.nextStep()}))}),0!=b.index()&&c.find(G).addClass(B),q.call(b),b.asrDisabled||window.location.search.indexOf("non-asr")>0?(c.find(E).addClass(A),c.find(G).addClass(y),b._json.content[Q]=!0,b.index(b.length()-1),b.completed(!0),b.publish("asr/disable")):(c.find(G).removeClass(y),b.publish(W,r.bind(b),b._json.content.phrases[b.index()],{asrFallbackType:d.ASR_FALLBACK_TYPE.NEXT,asrFallbackCb:function(){c.find(E).addClass(A),b._json.content[Q]=!0,b.index(b.length()-1),b.completed(!0)},needResetASRFailedTimes:!0}))}function p(a){this.publish("asr/show/message",i[a])}function q(){var a=this,b=a.$element;b.find(M).text(a.index()+1),b.find(N).text(a.length()-1)}function r(a,b){if(!a._hasError){var c=this,d=c.$element,f="",g=d.find(E),h=d.find(I),i=d.find(H),j=c.index(),k=a[0],l=this.checkAnswer(j,k),m=k.words;if(m){for(var n=0;n<m.length;n++){f+="<span class='"+(e.isWordCorrect(m[n])?"":z)+"'>"+m[n].word+"</span>"}d.find(K).html(f),i.addClass(B),g.toggleClass(A,l),h.toggleClass(C,l),h.toggleClass(D,!l),l||!a||a._hasError||p.call(c,"INCORRECT_PRONUN"),s.call(c,b),w.call(c,"passOrFail")}}}function s(a){var b=this,c=b.$element.find(F);c.unweave().then(function(){return c.data("option",{_playHandler:function(){b.publish(Y)},_pauseHandler:function(){b.publish(X)},guid:a}).attr("data-weave",$+"(option)").weave()})}function t(){var a=this,b=a.length()-1,c=a._answersCorrectness.reduce(function(a,b){return b?a+1:a},0),d=b-c,f=Math.ceil(e.ASR_MIN_PASSED_QUESTIONS_RATE*b),g=c>=f;return u.call(a,g,c,d,f),a._json.content._isCorrect=g,a.items().completedPromise(!0)}function u(a,b,c,d){var e=this,f=e.$element;e.$element.find(O).fadeOut(300,function(){f.find(L).data("settings",{passed:a,correctNum:b,skippedNum:c,passNum:d}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave()}),e.publish(Z)}function v(a){var b=this,d=b.items(b.index()).answeredPromise(a),e=b.items(b.index()).completedPromise(a);return c.all([d,e])}function w(a){var b=this,c=b.index(),d=b._json.content.phrases[c],e=Boolean(b._answersCorrectness[c]);x[c]&&("passOrFail"===a&&(a=e?"pass":"fail"),k.logActEvent({activityId:l.parseId(b[T]||b[S]),eventDescr:d[R]+V[a],eventTypeId:U[b.feedbackVersion]})),e&&(x[c]=e)}var x,y="ets-none",z="ets-wrong",A="ets-disabled",B="ets-away",C="ets-act-lnc-new-correct",D="ets-act-lnc-new-incorrect",E=".ets-act-lnc-skip",F=".ets-ap-lnc-record",G=".ets-act-lnc-play-tip",H=".ets-act-lnc-record-tip",I=".ets-act-lnc-record-content",J=".ets-act-lnc-record-msg-container",K=".ets-act-lnc-record-msg-content",L=".ets-act-summary-wrap",M=".ets-act-lnc-number-current",N=".ets-act-lnc-number-total",O=".ets-act-lnc-main",P=".ets-act-lnc-play-translation",Q="_isCorrect",R="_id",S="act_id",T="act_template_id",U={V1:m.lngCompRetryTimesV1,V2:m.lngCompRetryTimesV2},V={pass:"|pass",fail:"|fail",skip:"|skip",warning:"|warning",broken:"|broken"},W="asr/ui/setting",X="asr/stopPlayback",Y="asr/startPlayback",Z="dispose/reference",$="school-ui-activity/shared/audio/audio-shell",_={"sig/initialize":function(){var a=this,b=a._json.content.phrases.length;a.scoringType(d.SCORING_TYPE.ASR),a.length(b+1)},"sig/render":function(){if(!(this.index()>=this.length()-1))return n.call(this)},"sig/finalize":function(){var a=this;a._summaryTimer>0&&window.clearTimeout(a._summaryTimer)},"sig/start":function(){var a=this;a.query('ccl!"school.asr.enabled"').spread(function(b){a.asrDisabled=!(b&&"true"===b.value),x=[]})},checkAnswer:function(a,b){var c=this,d=e.isPhraseCorrect(b);return c._answersCorrectness[a]=d,this.publishInteraction(f.makeAsrInteraction(d,b._id)).then(function(){v.call(c,d)}),d},publishSkipInteraction:function(a){var b=this,c=b._json.content.phrases[a]._id,d=f.makeSkipInteraction(c);return b.publishInteraction(d).then(function(){v.call(b,!0)})},nextStep:function(){var a=this.index(),b=this;return b.publish("asr/disable"),a>b.length()-2?c.resolve():a===b.length()-2?b.indexPromise(a+1).then(v.bind(b,!0)).then(t.bind(b,"comeFromClick")):b.indexPromise(a+1).then(function(){return b.publish(X)}).then(function(){return b.signal("render")})},"hub/asr/ui/states/changed":function(a){function b(){d.find(J).addClass(B),e.removeClass(A)}if(a){var c=this,d=c.$element,e=d.find(E),f=d.find(I);switch(c._asrState=a,a){case j.NORMAL:!1===c._firstTimePlay&&d.find(H).removeClass(B),e.removeClass(A);break;case j.RECORDING:case j.PROCESSING:e.addClass(A),d.find(H).addClass(B),f.removeClass(C).removeClass(D);break;case j.PREPARING:c.items(c.index()).answered(!1),e.addClass(A),c._firstTimeRecord&&(c._firstTimeRecord=!1),d.find(H).addClass(B),d.find(J).addClass(B),d.find(".ets-ap").trigger("player/pause"),f.removeClass(C).removeClass(D);break;case j.BROKEN:b(),w.call(c,"broken");break;case j.WARNING:b(),w.call(c,"warning");break;case j.HINT:case j.ERROR:case j.DOWN:b();break;case j.DISABLE:d.find(H).addClass(B)}}},"hub/rating/sourceType":function(){return[h.ASR_SPEAKING]},"dom:.ets-ap/media/play":function(){var a=this,b=a.$element;a.publish(X),a._firstTimePlay&&(b.find(G).addClass(B),"NORMAL"===a._asrState&&a._firstTimeRecord&&b.find(H).removeClass(B),a._firstTimePlay=!1)}};return d.extend(function(a){this._playMediaElement,this._recordMediaElement,this._firstTimePlay,this._firstTimeRecord,this._asrState,this.asrDisabled=!1,this.feedbackVersion=a.data("option").abtestVersion,this._answersCorrectness=[]},_)}),define("school-ui-activity/util/content-converter",[],function(){"use strict";function a(a){for(var b=a.split(/[:.]/),c=0,d=4-b.length;c<d;c++)b.unshift(0);var e=b[0],f=b[1],g=b[2],h=b[3];h+="000",h=h.substr(0,3);return 3600*parseInt(e,10)+60*parseInt(f,10)+parseInt(g,10)+parseInt(h,10)/1e3}return{timeStrToSeconds:a,scriptsToSubtitles:function(b){return b.map(function(b){return{text:b.txt,start:a(b.startTime),end:a(b.endTime)}})},questionsToEndTimes:function(b){return b.map(function(b){return a(b.timeline||b.endTime)})},questionsToTimeRanges:function(b){return b.map(function(b){return[a(b.startTime),a(b.endTime)]})}}}),define("troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/language-presentation-new.html",[],function(){return function(a){function b(a,b){c+='\n\t\t<div class="ets-act-lpn-section" data-section="'+b+'">\n\t\t\t<div class="ets-bd">\n\t\t\t\t<div class="ets-act-lpn-grammar">\n\t\t\t\t\t'+a.text+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n"}var c="",a=a||{};if(c+='\n\n<div class="ets-act-lpn">\n\t<div class="ets-act-lpn-bd">\n\t\t<div class="ets-act-lpn-view-wrap">\n\t\t\t<div class="ets-act-lpn-view" id="ets-act-lpn-view">\n\t\t\t\t',a.content.title&&(c+='\n\t\t\t\t<div class="ets-act-lpn-section" data-section="1">\n\t\t\t\t\t<div class="ets-bd">\n\t\t\t\t\t\t<div class="ets-act-lpn-start">\n\t\t\t\t\t\t\t<h2>'+a.content.title+"</h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t"),c+="\n\n\t\t\t\t",a.content.grammarVideo&&a.content.grammarVideo.videoUrl){!function(a,b){c+='\n\t<div class="ets-act-lpn-section" data-section="'+b+'">\n\t\t<div class="ets-bd">\n\t\t\t<div class="ets-act-lpn-grammar-video">\n\t\t\t\t<div class="ets-act-vp-wrap">\x3c!--<div data-weave="school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"></div>--\x3e</div>\n\t\t\t\t',a.audioUrl&&a.audioUrl.url&&(c+='\n\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t       data-pause-other-players="false"\n\t\t\t\t       src="'+a.audioUrl.url+'" type="audio/mpeg"\n\t\t\t\t       class="ets-ap ets-ap-nobar"></audio>\n\t\t\t\t'),c+="\n\t\t\t</div>\n\t\t</div>\n\t</div>\n"}(a.content.grammarVideo,1);for(var d=0;d<a.content.presentations.length;d++){var e=d+2;b(a.content.presentations[d],e)}}else for(var d=0;d<a.content.presentations.length;d++){var e=d+1;b(a.content.presentations[d],e)}c+='\n\t\t\t\t\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class="ets-act-lpn-tabs" id="ets-act-lpn-tabs">\n\t\t\t<div class="ets-act-lpn-tabs-path">\n\t\t\t\t<span></span>\n\t\t\t</div>\n\t\t\t';var f;f=a.content.grammarVideo&&a.content.grammarVideo.videoUrl?a.content.presentations.length+1:a.content.presentations.length,c+='\n\t\t\t<ul class="ets-total-'+f+'">\n\t\t\t\t';for(var d=0;d<f;d++){var e=d+1;c+='\n\t\t\t\t\t\t<li data-section="'+e+'">\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\x3c!--[if lte IE 7]>\n\t\t\t\t\t\t<div class="ets-act-iefix-wrap">\n\t\t\t\t\t\t    <div class="ets-act-iefix-offset">\n\t\t\t\t\t\t        <div class="ets-act-iefix-inner">\n\t\t\t\t\t\t<![endif]--\x3e\n\t\t\t\t\t\t\t'+["A","B","C","D","E","F","G"][d]+"\n\t\t\t\t\t\t\t\x3c!--[if lte IE 7]>\n\t\t\t\t\t\t        </div>\n\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<![endif]--\x3e\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t"}return c+="\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</div>\n\n",c+="\n\n"}}),define("school-ui-activity/activity/language-presentation-new/language-presentation-new",["jquery","jquery.ui","poly","troopjs-ef/component/widget","jquery.easing","jquery.scrollto","jquery.viewport","jquery.mousewheel","markdownjs","mediaelement-plugin-ef","school-ui-activity/util/content-converter","template!./language-presentation-new.html","school-ui-shared/utils/browser-check","mediaelement-and-player"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(b){b.content.presentations.forEach(function(b){var c=a("<div>"+b.text+"</div>");c.find("p,td,strong").each(function(){var b=a(this),c=b.text();Array.prototype.every.call(c,function(a){return!(a.charCodeAt(0)>160)||(b.addClass(M),!1)})}),b.text=c.html()})}function p(){var a=this;if(a._json&&a[N]){var b=a._json;if(!b)throw this.toString()+B;return q.call(a,b),/^ar/.test(a[N])&&o(b),a.html(l,b).tap(r.bind(a))}}function q(a){for(var b=0;b<a.content.presentations.length;b++)a.content.presentations[b].text=a.content.presentations[b].text.replace(/(^\s*)|(\s*$)/g,""),a.content.presentations[b].text=i.toHTML(a.content.presentations[b].text)}function r(){var a=this;a._json.content.grammarVideo&&a._json.content.grammarVideo.videoUrl&&t.call(a),A.call(a),v.call(a)}function s(a){return a.map(function(a){return{html:i.toHTML(a.text),start:k.timeStrToSeconds(a.StartTime),end:k.timeStrToSeconds(a.EndTime)}})}function t(){var a=this,b=this.$element,c={video:a._json.content.grammarVideo.videoUrl},d={
features:["Subtitles","SwitchQuality"],subtitles:s(a._json.content.grammarVideo.scripts),showToggleSubtitlesButton:!1,pauseOtherPlayers:"tablet"!==m.device};b.find(I).data({videoInfo:c,options:d,successCallback:u.bind(a)}).attr("data-weave","school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)").weave()}function u(b,c,d){var e=this,f=e.$element,g="tablet"===m.device,h=a(c).parents(".ets-vp");if(e.grammarVideoMediaElement=b,d.enableSubtitles(),g&&f.find(".mejs-overlay-button, .ets-act-lpn-grammar-video .mejs-play").on("click",function(){var a=f.find(".ets-act-lpn-grammar-video audio")[0];a&&(a.paused?a.play():a.pause())}),b.addEventListener("pause",function(){h.removeClass(L)}),b.addEventListener("play",function(){h.addClass(L)}),e._json.content.grammarVideo.audioUrl){b.addEventListener("pause",function(){f.find(C).trigger("player/pause")}),b.addEventListener("playing",function(){if(g){var a=f.find(".ets-act-lpn-grammar-video audio")[0];Object.keys(n.players).forEach(function(c){var d=n.players[c].media;d===b||d===a||d.paused||d.ended||d.pause()})}else f.find(C).trigger("player/play")}),b.addEventListener("ended",function(){f.find(C).trigger("player/end")}),b.addEventListener("seeked",function(){var a=b.currentTime;f.find(C).trigger("player/seek",a)}),b.addEventListener("volumechange",function(){var a=b.volume,c=b.muted;f.find(C).trigger("player/volume",{volume:a,muted:c})});var i=b.volume,j=b.muted;f.find(C).trigger("player/volume",{volume:i,muted:j})}}function v(){this.$element.find(H).each(function(b,c){var d=a(c),e=y(d.html());e=w(e),e=x(e),d.html(e),d.find("[data-weave]").weave()})}function w(a){var b=/((?:https?:)?\/\/.*?.(?:mp3|ogg|webm))/gi;return a=a.replace(b,['<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-smaller">','<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none" data-src="$1" type="audio/mpeg" class="ets-ap ets-ap-smaller ets-ap-nobar"></audio>',"</div></div>"].join(""))}function x(a){var b=/((?:https?:)?\/\/.*?.(?:jpg|png|gif|jpeg|bmp))/gi;return a=a.replace(b,"<img src='$1' />")}function y(b){var c=a("<div></div>");return c.html(b),c.find(".flashplaceholder").each(function(){a(this).removeAttr("name width height class id"),a(this).text().trim()}),c.html()}function z(b){var c=b,d=c.$element;if(!a(this).hasClass(K)){var e=a(this).index();c._super.index(e),e>=a(this).siblings().length?c._super.completed(!0):c._super.completed(!1),a(this).addClass(K).siblings(F).removeClass(K);var f=a(this).data("section"),g=a(E).filter(function(){return a(this).data("section")==f});a(D).stop().scrollTo(g,300),c.grammarVideoMediaElement&&c.grammarVideoMediaElement.played&&setTimeout(function(){c.grammarVideoMediaElement.pause()},100),d.find(G).trigger("player/pause")}}function A(){var b=this,c=this.$element;c.find(F).click(function(){z.call(this,b)}),z.call(a(c.find(F).get(0)),b),c.find(D).viewport({targets:E,onViewChange:function(b){a.each(b,function(b,d){var e=a(d).data("section"),f=c.find(F).filter(function(){return a(this).data("section")==e});c.find(F).removeClass(K),f.addClass(K),c.find(D).removeClass(J),a(d).addClass(J)})}})}var B=": json format is incorrect.",C=".ets-act-lpn-grammar-video .ets-ap",D="#ets-act-lpn-view",E=".ets-act-lpn-section",F="#ets-act-lpn-tabs > ul > li",G=".ets-ap",H=".ets-act-lpn-grammar",I=".ets-act-vp-wrap",J="ets-current",K="ets-active",L="ets-playing",M="ets-ui-arabic-fix",N="cultureCode",O={"hub/activity/template/lpn/load":function(a,b){var c=this;return c._json=b.json,c._item=b.item,c._interacted=!1,c._super=a,c._item.instantFeedback(!1),p.call(c)},"hub/activity/template/lpn/next":function(b){z.call(a(this.$element.find(F).get(b)),this)},"hub:memory/context":function(a){var b=this;a&&a[N]&&(b[N]=a[N]),p.call(b)}};return d.extend(O)}),define("troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/main.html",[],function(){return function(a){return'<div class="ets-act-lpn-wrap" data-weave="school-ui-activity/activity/language-presentation-new/language-presentation-new"></div>'}}),define("school-ui-activity/activity/language-presentation-new/main",["jquery","underscore","when","../base/main","./language-presentation-new","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(){h.call(this)}function h(){var a,b=this,c=b._json;a=c.content.grammarVideo&&c.content.grammarVideo.videoUrl?c.content.presentations.length+1:c.content.presentations.length,b.length(a)}function i(){var a=this,b=this._json;if(a.$element)return this._htmlPromise||(this._htmlPromise=this.html(f())),this._htmlPromise.then(function(){return a.publish(j,a,{item:a.items(),json:b})})}var j="activity/template/lpn/load",k={"sig/render":function(){return i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.publish("activity/template/lpn/next",this.index()+1)},_onAnswerChecked:function(){}};return d.extend(g,k)}),define("troopjs-requirejs/template!school-ui-activity/activity/language-presentation/language-presentation.html",[],function(){return function(a){return'<div class="ets-act-lan-pre">\n    <div class="ets-act-lan-title" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'450030\' data-text-en=\'Language Focus\'></div>\n    <div class="ets-act-lnp-view" id="ets-act-lnp-view">\n        <div class="ets-act-lnp-scroll">\n            <div class="ets-act-lnp-section ets-section-grammer" data-section="1">\n                \x3c!--[if lt IE 8]><div class="ets-bd"><![endif]--\x3e\n                \x3c!--[if IE 8]><div class="ets-bd ets-ie8-fix"><![endif]--\x3e\n                \x3c!--[if gt IE 8]><div class="ets-bd"><![endif]--\x3e\n                \x3c!--[if !IE]>\x3c!--\x3e\n                <div class="ets-bd">\n                \x3c!--<![endif]--\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/language-presentation/content-audio.html",[],function(){return function(a){return'<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-smaller">\n\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t       data-src="'+a.audioUrl+'" type="audio/mpeg"\n\t       class="ets-ap ets-ap-smaller ets-ap-nobar"></audio>\n</div></div>'}}),define("school-ui-activity/util/activity-util",["jquery","school-ui-shared/utils/browser-check"],function(a,b){var c={};return c.clearVideo=function(a){c.clearMedia(a)},c.clearAudio=function(a){c.clearMedia(a)},c.clearMedia=function(c){if(parseInt(b.version,10)<=8&&c&&c.container){var d=c.container.find("object").attr("id");a("<div></div>",{id:d,style:"display: none;"}).appendTo("body")}try{c.dispose()}catch(a){}},c.blink=function(a){return this.fn._blink=this.fn._blink||function(){return this.fadeOut({duration:400,queue:!0}).fadeIn({duration:400,queue:!0})},a._blink()._blink()._blink()._blink()},c}),define("school-ui-activity/activity/language-presentation/main",["jquery","school-ui-activity/activity/base/main","template!./language-presentation.html","template!./content-audio.html","jquery.ui","school-ui-activity/util/activity-util","jquery.jscrollpane","jquery.mousewheel"],function(a,b,c,d,e,f){"use strict";function g(){var b,c=this;return c.$element.find(m).each(function(){var b=a(this).parent().html().replace("&nbsp;<span","<span");a(this).parent().html(b)}),c.$element.find(m).each(function(){var c=a(this).attr("name");if(b==c)return!1;b=c;var e=c.split(/[=|&]/)[1],f=a.trim(d({audioUrl:e}));a(this).replaceWith(a(f))}),c.$element.find("[data-weave]").weave()}function h(b){return b.bind("jsp-initialised",function(){var c=b.find(".jspDrag");k=setTimeout(function(){f.blink.call(a,c)},5e3),l=setTimeout(function(){f.blink.call(a,c)},3e4),b.bind("jsp-scroll-y",function(){b.unbind("jsp-scroll-y"),window.clearTimeout(k),window.clearTimeout(l)})})}function i(){h(this.$element.find(n)).jScrollPane({contentWidth:"0"})}function j(){var a=this,b={content:a._json.content.txt};return a.html(c,b).then(function(){return a.$element.find(o).html(b.content),g.call(a)}).then(function(){i.call(a)})}var k,l,m="span.flashplaceholder",n=".ets-act-lnp-scroll",o=".ets-bd",p={"sig/finalize":function(){window.clearTimeout(k),window.clearTimeout(l)},"sig/render":function(){return this.items().completed(!0),j.call(this)}};return b.extend(function(){},p)}),define("troopjs-requirejs/template!school-ui-activity/activity/matching-pic-audio/main.html",[],function(){return function(a){var b="",c=a.audios,d=a.pics;b+='\n\n<div class="ets-act-mpa">\n\n    <div class="ets-targets">\n        <ul class="ets-cf">\n            ';for(var e=0,f=c.length;e<f;e++)b+="\n            <li ",e===f-1&&(b+='class="last"'),b+='>\n                <div class="ets-mb-top ets-mb-top-small" data-at-id="'+c[e]._id+'" data-audio-id="'+c[e]._id+'">\n                    <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n                        <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                               data-src="'+c[e].audio.url+'" type="audio/mpeg"\n                               class="ets-ap"></audio>\n                    </div></div>\n                </div>\n                <div class="ets-placeholder"></div>\n            </li>\n            ';b+='\n        </ul>\n    </div>\n\n    <div class="ets-options">\n        <ul class="ets-cf">\n            ';for(var e=0,f=d.length;e<f;e++)b+="\n            <li ",e===f-1&&(b+='class="last"'),b+='>\n                <div class="ets-mb-bottom ets-mb-bottom-large" data-at-id="'+d[e]._id+'" data-pic-id="'+d[e]._id+'" data-index="'+e+'">\n                    <i class="ets-indicator"></i>\n                    <img src="'+d[e].image.url+'" alt="" width="127" height="97">\n                    <div class="ets-img-shadow"></div>\n                </div>\n            </li>\n            ';return b+="\n        </ul>\n    </div>\n</div>"}}),define("school-ui-activity/activity/matching-pic-audio/main",["jquery","when","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./main.html","jquery.ui","jquery.ui.touch-punch","jquery.transit"],function(a,b,c,d,e,f){"use strict";function g(a){var c=a.attr("data-index"),d=n.find("li").eq(c),e=d.position(),f=a.position();return b.promise(function(b){a.css("z-index",1).removeClass(t).addClass(u).animate({left:e.left-f.left,top:e.top-f.top},function(){a.removeClass(u).next().show(),d.html(a.css({left:"auto",top:"auto","z-index":"auto"})),d.find(r).draggable(v),b()})})}function h(a){var b=this,c=a.scoring.pics;return c?(a.dists=[],_.each(c,function(b){a.dists.push(_.find(a.content.pics,function(a){return b._id==a._id})),a.content.pics=_.reject(a.content.pics,function(a){return b._id==a._id})}),delete b._json.scoring.pics,a):a}function i(a){var b=this;if(a.pics){if(a.dists)for(var c=b._json.filterOptions.distNo,d=0,e=5-a.pics.length;d<e&&!(d>=c);d++)a.dists[d]&&a.pics.push(a.dists[d]);return a.pics=_.shuffle(a.pics),a}}function j(a){var b,c,d,e,f,g,h=this,j=Math.min(a.filterOptions.questionNo,a.content.audios.length),k=Math.ceil(j/5),l=[];b=a.scoring.audios.length,c=a.scoring.audios,d=b>j?_.shuffle(c).slice(0,j):_.shuffle(c),h.length(k);for(var m=Math.ceil(j/k),n=0;n<k;++n){e={},g=e.audios=[],f=e.pics=[];for(var o=n*m,p=(n+1)*m;o<p;o++){var q=d[o];if(!q)break;g.push(_.find(a.content.audios,function(a){return q._id==a._id})),f.push(_.find(a.content.pics,function(a){return q.pic._id==a._id}))}e.references=a.references,e.dists=a.dists,l=l.concat(g),h._templateData.push(i.call(h,e))}h._json.content.audios=l}function k(){var b=this;return b.publish("activity/step/render",b.index(),b.length()),b.html(f,b._templateData[b.index()]).then(function(){return l.call(b),m=a(o),n=m.find(q),m.find(p+" "+r).draggable(v),m.find(s).droppable(b.droppableSetting),b.attachATAssetDom(b._templateData[b.index()])})}function l(){var a=this;a._currentPairs+=a._templateData[a.index()].audios.length}var m,n,o=".ets-act-mpa",p=".ets-options",q=".ets-options ul",r=".ets-mb-bottom",s=".ets-targets li",t="ets-mb-dropped",u="ets-moving",v={containment:o,scroll:!1,revert:"invalid",start:function(){var b=a(this);if(b.addClass(u),b.hasClass(t))return!1;b.closest("li").siblings().css({"z-index":0,position:"relative"}),b.css("z-index",1)},stop:function(){var b=a(this);b.removeClass(u),b.closest("li").siblings().css({"z-index":"",position:"static"}),b.css("z-index","")}};return c.extend(function(){var b=this;b._templateData=[],b._currentPairs=0,b._correctAnswers=0,b.droppableSetting={drop:function(c,d){var e=a(this),f=d.draggable,g=e.find(".ets-mb-top"),h=e.find(".ets-placeholder"),i=h.position(),j=f.position();g.animate({top:0},"fast"),f.animate({left:parseInt(f.css("left"))+(i.left-j.left),top:parseInt(f.css("top"))+(i.top-j.top)},"fast",function(){h.before(f.addClass(t).css({left:"auto",top:"auto"})).hide(),f.draggable("destroy"),e.droppable("disable");var a=g.attr("data-audio-id"),c=f.attr("data-pic-id"),d=b.checkAnswer(a,c);b.displayInteractionResult(d,a,c)})},over:function(){var b=a(this),c=b.find(".ets-mb-top");b.prev().addClass("ets-hover"),c.is(":animated")||c.animate({top:10},"fast")},out:function(){var b=a(this),c=b.find(".ets-mb-top");c.removeClass("ets-hover"),c.animate({top:0},"fast")}}},{"sig/initialize":function(){var b=this;j.call(b,h.call(b,a.extend(!0,{},b._json))),b.items().instantFeedback(!0)},"sig/render":function(){return k.call(this)},checkAnswer:function(a,b){var c=this,f=c._json,g=d.findById(f.content.pics,b),h=d.findById(f.scoring.audios,a),i=g&&h&&h.pic._id===g._id;i&&(c._correctAnswers+=1);var j=c.publishInteraction(e.makeMatchingInteraction(i,a,b));return c._correctAnswers===c._currentPairs&&(c._json.content._isCorrect=!0,j.then(function(){var a=c.items();a.answered(!0),a.completed(!0)})),i},displayInteractionResult:function(b,c,d){var e=a('[data-audio-id="'+c+'"]'),f=a('[data-pic-id="'+d+'"]'),h=e.closest("li");b?h.addClass("ets-correct"):(h.addClass("ets-incorrect"),setTimeout(function(){e.css("z-index","auto"),h.removeClass("ets-incorrect"),g(f).then(function(){h.droppable("enable")})},1e3))},nextStep:function(){var a=this;return a.index(a.index()+1),a.items().instantFeedback(!0),k.call(a)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/matching-text-long-text/main.html",[],function(){return function(a){var b="",c=a.targets,d=a.sources;b+='\n<div class="ets-act-mtl ets-cf">\n    ',a.references.aud&&(b+='\n    <div class="ets-references">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap ets-ap-bottom-right"></audio>\n        </div></div>\n    </div>\n    '),b+='\n\n    <div class="ets-targets">\n        <ul>\n            ';for(var e=0,f=c.length;e<f;e++)b+='\n            <li class="ets-droppable-line">\n                <ul class="ets-cf">\n                    <li class="ets-first">\n                        <span class="ets-mtl-left" data-at-id="'+c[e]._id+'" data-target-id="'+c[e]._id+'">\n                            <span>\n                                <div>\n                                    <div>'+c[e].txt+'</div>\n                                </div>\n                            </span>\n                        </span>\n                    </li>\n                    <li class="ets-last"></li>\n                </ul>\n            </li>\n            ';b+='\n        </ul>\n    </div>\n\n    <div class="ets-options">\n        <ul>\n            ';for(var e=0,f=d.length;e<f;e++)b+='\n            <li>\n                <span class="ets-mtl-right" data-at-id="'+d[e]._id+'" data-source-id="'+d[e]._id+'" data-index="'+e+'">\n                    <i class="ets-indicator"></i>\n                    <span>\n                        <div>\n                            <div>'+d[e].txt+'</div>\n                        </div>\n                    </span>\n                    <i class="ets-bottom-shadow"></i>\n                </span>\n            </li>\n            ';return b+="\n        </ul>\n    </div>\n</div>"}}),define("school-ui-activity/activity/matching-text-long-text/main",["jquery","when","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","school-ui-shared/utils/browser-check","template!./main.html","underscore","jquery.ui","jquery.ui.touch-punch"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){var c=this,d=a.attr("data-index"),e=c.$element.find(s).find("li").eq(d),f=e.offset(),g=a.parent(),h=g.offset();return b.promise(function(b){a.addClass("ets-moving").animate({left:f.left-h.left,top:f.top-h.top},function(){e.append(a.removeAttr("style").removeClass(w+" "+x)),e.find(u).draggable(y),b()})})}function j(a){var b=this,c=a.scoring.sources;return c?(a.dists=[],h.each(c,function(b){a.dists.push(h.find(a.content.sources,function(a){return b._id==a._id})),a.content.sources=h.reject(a.content.sources,function(a){return b._id==a._id})}),delete b._json.scoring.sources,a):a}function k(a){var b=this;if(a.sources){if(a.dists)for(var c=b._json.filterOptions.distNo,d=0,e=5-a.sources.length;d<e&&!(d>=c);d++)a.dists[d]&&a.sources.push(a.dists[d]);return a.sources=h.shuffle(a.sources),a}}function l(a){var b,c,d,e,f=this,g=Math.min(a.filterOptions.questionNo,a.content.targets.length),i=a.scoring.targets.length,j=Math.ceil(g/o),l=[];i>=g?(b=h.shuffle(a.scoring.targets).slice(0,g),f._json.scoring.targets=b):b=h.shuffle(a.scoring.targets),f.length(j);for(var m=Math.ceil(g/j),n=0;n<j;++n){c={},d=c.targets=[],e=c.sources=[];for(var p=n*m,q=(n+1)*m;p<q;p++){var r=b[p];if(!r)break;d.push(h.find(a.content.targets,function(a){return r._id==a._id})),e.push(h.find(a.content.sources,function(a){return r.source.txt==a.txt}))}c.dists=a.dists,c.references=a.references,l=l.concat(e),f._templateData.push(k.call(f,c))}f._json.content.sources=l}function m(){var a=this;return a.publish("activity/step/render",a.index(),a.length()),a.html(g,a._templateData[a.index()]).then(function(){return n.call(a),a.attachATAssetDom(a._templateData[a.index()])})}function n(){var b=this;b._currentPairs+=b._templateData[b.index()].targets.length,b.$element.find(r+" "+u).css("position","relative").draggable(y),b.$element.find(r).on("mousedown mouseup",u,function(b){var c=a(this);"mousedown"===b.type?c.addClass(w):c.removeClass(w)}),b.$element.find(t).droppable(b._droppableOptions),"msie"===f.browser&&b.$element.find(q).add(r).on("selectstart",function(){return!1}),b._json.references.aud&&b.$element.find(v).css({"padding-top":(b.$element.find(p).height()-75)/2})}var o=6,p=".ets-act-mtl",q=".ets-targets",r=".ets-options",s=".ets-options ul",t=".ets-droppable-line ul",u=".ets-mtl-right",v=".ets-references",w="ets-moving",x="ets-dropped",y={revert:"invalid",containment:p,scroll:!1};return c.extend(function(){var b=this;b._templateData=[],b._currentPairs=0,b._correctAnswers=0,b._droppableOptions={hoverClass:"ets-drop-hover",drop:function(c,d){var e=a(this).animate({left:0},"fast",function(){e.css("position","static")}),f=d.draggable,g=e.find(".ets-first .ets-mtl-left"),h=e.find(".ets-last"),i=h.offset(),j=d.offset;f.addClass("ets-moving").animate({left:parseInt(f.css("left"))+(i.left-j.left),top:parseInt(f.css("top"))+(i.top-j.top)},"fast",function(){f.removeClass(w).addClass(x),h.html(f.removeAttr("style")),e.droppable("disable"),f.draggable("destroy");var a=f.attr("data-source-id"),c=g.attr("data-target-id"),d=b.checkAnswer(a,c);b.displayInteractionResult(d,f,g)})},over:function(){var b=a(this);b.is(":animated")||b.css({position:"relative"}).animate({left:10},"fast")},out:function(){var b=a(this);b.animate({left:0},"fast",function(){b.css("position","static")})}}},{"sig/initialize":function(){var a=this;l.call(a,j.call(a,a._json))},"sig/render":function(){return this.items().instantFeedback(!0),m.call(this)},checkAnswer:function(a,b){var c=this,f=c._json,g=d.findById(f.content.sources,a),h=d.findById(f.scoring.targets,b),i=g&&h&&h.source.txt===g.txt;i&&(c._correctAnswers+=1);var j=c.publishInteraction(e.makeMatchingInteraction(i,b,a));return c._correctAnswers===c._currentPairs&&(c._json.content._isCorrect=!0,j.then(function(){var a=c.items();a.answered(!0),a.completed(!0)})),i},displayInteractionResult:function(a,b,c){var d=this,e=c.closest("ul");a?e.addClass("ets-correct"):(e.addClass("ets-incorrect"),setTimeout(function(){c.css("z-index","auto"),e.removeClass("ets-incorrect"),i.call(d,b).then(function(){c.closest("ul").droppable("enable")})},1e3))},nextStep:function(){var a=this;a.index(a.index()+1),a.items().instantFeedback(!0),m.call(a)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/matching-text-pic/main.html",[],function(){return function(a){var b="",c=a.pics,d=a.texts;b+='\n\n<div class="ets-act-mtp">\n    ',a.references.aud&&(b+='\n    <div class="ets-references">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n    </div>\n    '),b+='\n\n    <div class="ets-targets">\n        <ul class="ets-cf">\n            ';for(var e=0,f=c.length;e<f;e++)b+="\n            <li ",e===f-1&&(b+='class="last"'),b+='>\n                <div class="ets-mb-top" data-at-id="'+c[e]._id+'" data-pic-id="'+c[e]._id+'">\n                    <img src="'+c[e].image.url+'" alt="" width="127" height="97">\n                    <div class="ets-img-shadow"></div>\n                </div>\n                <div class="ets-placeholder">\n                </div>\n            </li>\n            ';b+='\n        </ul>\n    </div>\n\n    <div class="ets-options">\n        <ul class="ets-cf">\n            ';for(var e=0,f=d.length;e<f;e++)b+="\n            <li ",e===f-1&&(b+='class="last"'),b+='>\n                <div class="ets-mb-bottom" data-at-id="'+d[e]._id+'" data-text-id="'+d[e]._id+'" data-index="'+e+'">\n                    <i class="ets-indicator"></i>\n                    <span>'+d[e].txt+"</span>\n                </div>\n            </li>\n            ";return b+="\n        </ul>\n    </div>\n</div>"}}),define("school-ui-activity/activity/matching-text-pic/main",["jquery","when","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./main.html","underscore","jquery.ui","jquery.ui.touch-punch","jquery.transit"],function(a,b,c,d,e,f){"use strict";function g(a){var c=a.attr("data-index"),d=n.find("li").eq(c),e=d.position(),f=a.position();return b.promise(function(b){a.css("z-index",1).removeClass(u).addClass(v).animate({left:e.left-f.left,top:e.top-f.top},function(){a.removeClass(v).next().show(),d.html(a.css({left:"auto",top:"auto","z-index":"auto"})),d.find(r).draggable(y),b()})})}function h(a){var b=this,c=a.scoring.texts;return c?(a.dists=[],_.each(c,function(b){a.dists.push(_.find(a.content.texts,function(a){return b._id==a._id})),a.content.texts=_.reject(a.content.texts,function(a){return b._id==a._id})}),delete b._json.scoring.texts,a):a}function i(a){var b=this;if(a.texts){if(a.dists)for(var c=b._json.filterOptions.distNo,d=0,e=5-a.texts.length;d<e&&!(d>=c);d++)a.dists[d]&&a.texts.push(a.dists[d]);return a.texts=_.shuffle(a.texts),a}}function j(a){var b,c,d,e,f=this,g=Math.min(a.filterOptions.questionNo,a.content.pics.length),h=a.scoring.pics.length,j=Math.ceil(g/5),k=[];b=h>=g?_.shuffle(a.scoring.pics).slice(0,g):_.shuffle(a.scoring.pics),f.length(j);for(var l=Math.ceil(g/j),m=0;m<j;++m){c={},d=c.pics=[],e=c.texts=[];for(var n=m*l,o=(m+1)*l;n<o;n++){var p=b[n];if(!p)break;d.push(_.find(a.content.pics,function(a){return p._id==a._id})),e.push(_.find(a.content.texts,function(a){return p.text._id==a._id}))}c.dists=a.dists,c.references=a.references,k=k.concat(d),f._templateData.push(i.call(f,c))}f._json.content.pics=k}function k(){var b=this;return b.publish("activity/step/render",b.index(),b.length()),b.html(f,b._templateData[b.index()]).then(function(){return l.call(b),m=a(o),n=m.find(q),m.find(p+" "+r).draggable(y),m.find(t).droppable(b.droppableSetting),b.attachATAssetDom(b._templateData[b.index()])})}function l(){var b=this,c=a(r),d=c.children("span");b._currentPairs+=b._templateData[b.index()].pics.length,d.length&&d.each(function(){if(a(this).height()>32)return c.addClass(w),a(s).addClass(x),!1})}var m,n,o=".ets-act-mtp",p=".ets-options",q=".ets-options ul",r=".ets-mb-bottom",s=".ets-placeholder",t=".ets-targets li",u="ets-mb-dropped",v="ets-moving",w="ets-mb-bottom-medium",x="ets-placeholder-medium",y={containment:o,scroll:!1,revert:"invalid",start:function(){var b=a(this);if(b.addClass(v),b.hasClass(u))return!1;b.closest("li").siblings().css({"z-index":0,position:"relative"}),b.css("z-index",1)},stop:function(){var b=a(this);b.removeClass(v),b.closest("li").siblings().css({"z-index":"",position:"static"}),b.css("z-index","")}};return c.extend(function(){var b=this;b._templateData=[],b._currentPairs=0,b._correctAnswers=0,b.droppableSetting={drop:function(c,d){var e=a(this),f=d.draggable,g=e.find(".ets-mb-top"),h=e.find(s),i=h.position(),j=f.position();g.animate({top:0},"fast"),f.animate({left:parseInt(f.css("left"))+(i.left-j.left),top:parseInt(f.css("top"))+(i.top-j.top)},"fast",function(){h.before(f.addClass(u).css({left:"auto",top:"auto"})).hide(),f.draggable("destroy"),e.droppable("disable");var a=g.attr("data-pic-id"),c=f.attr("data-text-id"),d=b.checkAnswer(a,c);b.displayInteractionResult(d,g,f)})},over:function(){var b=a(this),c=b.find(".ets-mb-top");b.prev().addClass("ets-hover"),c.is(":animated")||c.animate({top:10},"fast")},out:function(){var b=a(this),c=b.find(".ets-mb-top");c.removeClass("ets-hover"),c.animate({top:0},"fast")}}},{"sig/initialize":function(){var b=this;j.call(b,h.call(b,a.extend(!0,{},b._json))),b.items().instantFeedback(!0)},"sig/render":function(){return k.call(this)},checkAnswer:function(a,b){var c=this,f=c._json,g=d.findById(f.content.texts,b),h=d.findById(f.scoring.pics,a),i=g&&h&&h.text._id===g._id;i&&(c._correctAnswers+=1);var j=c.publishInteraction(e.makeMatchingInteraction(i,a,b));return c._correctAnswers===c._currentPairs&&(c._json.content._isCorrect=!0,j.then(function(){var a=c.items();a.answered(!0),a.completed(!0)})),i},displayInteractionResult:function(a,b,c){var d=(this._json,b.closest("li"));a?d.addClass("ets-correct"):(d.addClass("ets-incorrect"),setTimeout(function(){b.css("z-index","auto"),d.removeClass("ets-incorrect"),g(c).then(function(){b.closest("li").droppable("enable")})},1e3))},nextStep:function(){var a=this;return a.index(a.index()+1),a.items().instantFeedback(!0),k.call(a)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/matching-text-text/main.html",[],function(){return function(a){var b="",c=a.targets,d=a.sources;b+='\n<div class="ets-act-mtt ets-cf">\n\n    ',a.references.aud&&(b+='\n    <div class="ets-references">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n    </div>\n    '),b+='\n\n    <div class="ets-targets">\n\n        <ul class="ets-droppable">\n            ';for(var e=0,f=c.length;e<f;e++)b+='\n            <li class="ets-droppable-line">\n                <ul class="ets-cf">\n                    <li class="ets-first">\n                        <span class="ets-word-puzzle ets-undraggable" data-at-id="'+c[e]._id+'" data-target-id="'+c[e]._id+'">\n                            <span>\n                                <div>\n                                    <div>'+c[e].txt+'</div>\n                                </div>\n                            </span>\n                        </span>\n                    </li>\n                    <li class="ets-last"></li>\n                </ul>\n            </li>\n            ';b+='\n        </ul>\n\n    </div>\n\n    <div class="ets-options">\n        <ul>\n            ';for(var e=0,f=d.length;e<f;e++)b+='\n            <li class="ets-last">\n                <span class="ets-word-puzzle" data-at-id="'+d[e]._id+'" data-source-id="'+d[e]._id+'" data-index="'+e+'" data-action="draggable/option">\n                    <i class="ets-indicator"></i>\n                    <span>\n                        <div>\n                            <div>'+d[e].txt+'</div>\n                        </div>\n                    </span>\n                    <i class="ets-bottom-shadow"></i>\n                </span>\n            </li>\n            ';return b+="\n        </ul>\n    </div>\n\n</div>"}}),define("school-ui-activity/activity/matching-text-text/main",["jquery","poly","when","school-ui-activity/activity/base/main","school-ui-activity/util/scoring","school-ui-activity/util/interaction","school-ui-shared/utils/browser-check","template!./main.html","underscore","jquery.ui","jquery.ui.touch-punch"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=this,d=a.attr("data-index"),e=b.$element.find(u).find("li").eq(d),f=e.position(),g=a.position();return c.promise(function(b){a.css("z-index",1).addClass(v).animate({left:f.left-g.left,top:f.top-g.top},function(){a.removeClass(v+" "+w).next().show(),e.html(a.css({left:"auto",top:"auto","z-index":"auto"})),e.find(s).draggable(x),b()})})}function k(a){var b=this,c=a.scoring.sources;return c?(a.dists=[],i.each(c,function(b){a.dists.push(i.find(a.content.sources,function(a){return b._id==a._id})),a.content.sources=i.reject(a.content.sources,function(a){return b._id==a._id})}),delete b._json.scoring.sources,a):a}function l(a){var b=this;if(a.sources){if(a.dists)for(var c=b._json.filterOptions.distNo,d=0,e=5-a.sources.length;d<e&&!(d>=c);d++)a.dists[d]&&a.sources.push(a.dists[d]);return a.sources=i.shuffle(a.sources),a}}function m(a){var b,c,d,e,f=this,g=Math.min(a.filterOptions.questionNo,a.content.targets.length),h=a.scoring.targets.length,j=Math.ceil(g/p),k=[];h>=g?(b=i.shuffle(a.scoring.targets).slice(0,g),f._json.scoring.targets=b):b=i.shuffle(a.scoring.targets),f.length(j);for(var m=Math.ceil(g/j),n=0;n<j;++n){c={},d=c.targets=[],e=c.sources=[];for(var o=n*m,q=(n+1)*m;o<q;++o){var r=b[o];if(!r)break;d.push(i.find(a.content.targets,function(a){return r._id==a._id})),e.push(i.find(a.content.sources,function(a){return r.source.txt==a.txt}))}c.dists=a.dists,c.references=a.references,k=k.concat(e),f._templateData.push(l.call(f,c))}f._json.content.sources=k}function n(){var a=this;return a.publish("activity/step/render",a.index(),a.length()),a.html(h,a._templateData[a.index()]).then(function(){a.attachATAssetDom(a._templateData[a.index()]),o.call(a)})}function o(){var b=this;b._currentPairs+=b._templateData[b.index()].targets.length,b.$element.find(r+" "+s).css("position","relative").draggable(x),b.$element.find(r).on("mousedown mouseup",s,function(b){var c=a(this);"mousedown"===b.type?c.addClass(v):c.removeClass(v)}),b.$element.find(t).droppable(b._droppableOptions),"msie"===g.browser&&b.$element.find(q).add(r).on("selectstart",function(a){a.preventDefault()})}var p=6,q=".ets-targets",r=".ets-options",s=".ets-word-puzzle",t=".ets-droppable ul",u=".ets-options ul",v="ets-moving",w="ets-undraggable",x={revert:"invalid",containment:".ets-act-mtt",scroll:!1,zIndex:2};return d.extend(function(){var b=this;b._templateData=[],b._currentPairs=0,b._correctAnswers=0,b._droppableOptions={hoverClass:"ets-drop-hover",drop:function(c,d){
var e=a(this).css("position","static"),f=d.draggable,g=e.find(".ets-first .ets-word-puzzle"),h=e.find(".ets-last"),i=h.position(),j=f.position();f.addClass(v).animate({left:parseInt(f.css("left"))+(i.left-j.left)+2,top:parseInt(f.css("top"))+(i.top-j.top)},function(){h.html(f.removeAttr("style").removeClass(v)),e.droppable("disable"),f.addClass(w).draggable("destroy");var a=f.attr("data-source-id"),c=g.attr("data-target-id"),d=b.checkAnswer(a,c);b.displayInteractionResult(d,f,g)})},over:function(){var b=a(this);b.is(":animated")||b.css({position:"relative"}).animate({left:10},"fast")},out:function(){a(this).animate({left:0},"fast")}}},{"sig/initialize":function(){var a=this;m.call(a,k.call(a,a._json))},"sig/render":function(){return this.items().instantFeedback(!0),n.call(this)},checkAnswer:function(a,b){var c=this,d=c._json,g=e.findById(d.content.sources,a),h=e.findById(d.scoring.targets,b),i=g&&h&&h.source.txt===g.txt;i&&(c._correctAnswers+=1);var j=c.publishInteraction(f.makeMatchingInteraction(i,b,a));return c._correctAnswers===c._currentPairs&&(c._json.content._isCorrect=!0,j.then(function(){var a=c.items();a.answered(!0),a.completed(!0)})),i},displayInteractionResult:function(a,b,c){var d=this,e=c.closest("ul");a?e.addClass("ets-correct"):(e.addClass("ets-incorrect"),setTimeout(function(){c.css("z-index","auto"),e.removeClass("ets-incorrect"),j.call(d,b).then(function(){c.closest("ul").droppable("enable")})},1e3))},nextStep:function(){var a=this;return a.index(a.index()+1),this.items().instantFeedback(!0),n.call(a)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/main.html",[],function(){return function(a){var b="",c=a.content.words;b+='\n<div class="ets-act-mvp ets-cf">\n    <div class="ets-movie" data-at-id="video">\n        \x3c!--<div data-weave="school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"></div>--\x3e\n    </div>\n\n    <div class="ets-word-list">\n        <ul>\n            ';for(var d=0,e=c.length;d<e;d++)b+='\n            <li class="'+(0===d?"ets-first":"")+'" data-at-id="answer">\n                <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                       class="ets-ap ets-ap-small ets-ap-nobar"\n                       data-src="'+c[d].translation.audio.url+'" type="audio/mpeg"\n                       controls="controls"></audio>\n\n                <div class="ets-words-info">\n                    <p class="ets-word">'+c[d].txt+"</p>\n                    ",c[d].txt.replace(/\’/g,"'")!==c[d].translation.translation.replace(/\’/g,"'")&&(b+='\n                        <p class="ets-translation">'+c[d].translation.translation+"</p>\n                    "),b+="\n                </div>\n            </li>\n            ";return b+="\n        </ul>\n    </div>\n</div>"}}),define("school-ui-activity/activity/movie-presentation/continuousMovie",["jquery","poly","mediaelement-plugin-ef","school-ui-activity/util/content-converter","school-ui-activity/activity/base/main","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(a){var b=this,c=b.$wordlist.find(q).eq(a);c.show(),c.attr("data-at-status","shown")}function h(a){var b=this,c=b.$wordlist.find(q).eq(a);c.hasClass(n)||(c.addClass(n),setTimeout(function(){c.removeClass(n)},s))}function i(a){var b=this,c=b.$wordlist.find(q).eq(a),d=c.position().top,e=c.outerHeight(!0),f=d+e,g=b.$wordlist.height();if(d<0)b.$wordlist.animate({scrollTop:d},t);else if(f>g){var h=f-g;b.$wordlist.animate({scrollTop:b.$wordlist.scrollTop()+h},t)}}function j(a,b,d){var e=this,f=c.$(a);f.on("restrict_time_range_ended",function(a,b){if(b.index<e.timeSepCount){g.call(e,b.index),i.call(e,b.index),h.call(e,b.index);e[m].find(r+":eq("+b.index+")").addClass(n)}}),f.one("ended",function(){f.off("restrict_time_range_ended"),d.disableRestrictPlayingTimeRange(),a.pause(),a.setCurrentTime(0),f.on("time_range_changed",function(a,b){b.oldIndex<e.timeSepCount&&b.oldIndex+1===b.newIndex&&(i.call(e,b.oldIndex),h.call(e,b.oldIndex))})})}function k(){var a=this;return a.html(f,a._json).tap(function(){a.$wordlist=a[m].find(p)}).tap(l.bind(a))}function l(){var a=this,b=a._json.content,c={video:b.video,poster:b.poster},e=["TimeRanges","Subtitles","SwitchQuality"],f=d.scriptsToSubtitles(b.scripts),g=d.questionsToEndTimes(b.words);a.timeSepCount=g.length;var h={features:e,subtitles:f,timeRangeSeparators:g,restrictPlayingTimeRange:!0,restrictDeviationBefore:.5,continueOnEndOfRestrictRange:!0},i=function(){j.apply(a,arguments)},k=a[m].find(o);k.data({videoInfo:c,options:h,successCallback:i}),k.attr("data-weave","school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"),k.weave()}var m="$element",n="ets-active",o=".ets-movie",p=".ets-word-list",q="li",r=".mejs-time-separator-item",s=1e3,t=500;return e.extend({"sig/start":function(){var a=this;a.$wordlist=null,a.timeSepCount=-1},"sig/render":function(){return this.items().completed(!0),k.call(this)},"dom:.ets-ap/media/play":function(b){a(b.target).closest("li").addClass(n)},"dom:.ets-ap/media/pause":function(b){a(b.target).closest("li").removeClass(n)},"dom:.ets-ap/media/ended":function(b){a(b.target).closest("li").removeClass(n)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/screen-word.html",[],function(){return function(a){var b='<table class="ets-screen-inner">\n    <tr>\n        <td>\n            <p class="ets-word">'+a.txt+"</p>\n            ";return a.txt.replace(/\’/g,"'")!==a.translation.translation.replace(/\’/g,"'")&&(b+='\n                <p class="ets-translation">'+a.translation.translation+"</p>\n            "),b+="\n        </td>\n    </tr>\n</table>  "}}),define("school-ui-activity/activity/movie-presentation/screen-word",["jquery","troopjs-core/component/widget","troopjs-utils/deferred","template!./screen-word.html"],function(a,b,c,d){"use strict";function e(a){var b=this;b.html(d,b._content,a)}return b.extend(function(a,b,c){this._content=c},{"sig/initialize":function(a,b){var c=this;e.call(c,b)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/movie-question/movie-question.html",[],function(){return function(a){var b="",a=a||{},c=a.content.questions;b+='\n<div class="ets-act-mvq ets-cf">\n\t<div class="ets-act-mvq-movie">\n\t\t<div class="ets-movie" data-at-id="video">\x3c!--<div data-weave="school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"></div>--\x3e</div>\n\t\t<span data-weave="troopjs-ef/blurb/widget" data-blurb-id="464922" data-text-en="Replay this video segment" class="ets-act-mvq-replay-blurb ets-none"></span>\n\t</div>\n\n\t<div class="ets-act-mvq-ques">\n\t\t';for(var d=0;d<c.length;d++){b+='\n\t\t<div class="ets-act-mvq-que ets-none">\n\t\t\t<span class="ets-act-mvq-que-title">'+c[d].txt+'</span>\n\t\t\t<ul class="ets-act-mvq-answers" data-at-id="'+c[d]._id+'">\n\t\t\t\t';for(var e=0;e<c[d].options.length;e++)b+='\n\t\t\t\t\t<li class="ets-act-mvq-answer ets-table" data-at-id="'+c[d]._id+"_"+c[d].options[e]._id+'" data-option-id="'+c[d].options[e]._id+'" data-index="'+e+'">\n\t\t\t\t\t\t<div class="ets-table-hack">\n\t\t\t\t\t\t\t<span>'+c[d].options[e].txt+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t";b+="\n\t\t\t</ul>\n\t\t</div>\n\t\t"}return b+="\n\t</div>\n</div>"}}),define("school-ui-activity/activity/movie-question/main",["jquery","poly","when","mediaelement-plugin-ef","school-ui-activity/util/content-converter","school-ui-activity/util/interaction","school-ui-activity/activity/base/main","template!./movie-question.html"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=this;a.needReplay=!1,a[r].find(z).removeClass(x)}function j(){var a=this;a.needReplay=!0,a[r].find(z).addClass(x)}function k(a,b,c){var e=this;e.player=c,e.mediaElement=a,e[r].find(F).appendTo(e[r].find(A)),i.call(e);var f=d.$(a);f.on("restrict_time_range_ended",function(a,b){if(!b.continueOnEnd){var c=e[r].find(B+":eq("+e.currentQuestionIndex+")");c.hasClass(s)||(c.addClass(s),l.call(e,e.currentQuestionIndex)),j.call(e)}}),f.on("play",function(){e.needReplay&&(e.needReplay=!1,c.restartCurrentTimeRange(),a.play(),i.call(e))}),f.one("ended",function(){c.pause(),c.disableRestrictPlayingTimeRange(),a.setCurrentTime(0),i.call(e)})}function l(a){var b=this,c=b[r].find(y),d=b[r].find(C);d.addClass(s);var e=d.find(D+":eq("+a+")");0===b.currentQuestionIndex?(e.removeClass(t),c.animate({right:"150"},G),d.animate({marginLeft:"180"},G)):e.fadeIn(),e.find(E).attr("data-at-status","shown");var f=b._json.scoring.questions;f.splice(a+1),f.slice(0,a)}function m(a){var b=this;return b._json.scoring.questions=b._source.scoring.questions.slice(),b[r].find(D+":eq("+a+")").fadeOut().promise().then(function(){n.call(b)})}function n(){var a=this,b=a.currentQuestionIndex;a.currentQuestionIndex++;var c,e;a.currentQuestionIndex===a._json.content.questions.length?(a._json.content._isCorrect=!0,c=!0):a.timeRangeSeparators[b]===a.timeRangeSeparators[a.currentQuestionIndex]&&(e=!0),e?(l.call(a,a.currentQuestionIndex,a),a.player.nextTimeRange()):(i.call(a),Math.abs(a.mediaElement.currentTime-a.timeRangeSeparators[b])<.1?a.player.nextTimeRange():(d.$(a.mediaElement).one("time_range_changed",function(){a.player.disableContinueOnEndOfRestrictRange()}),a.player.enableContinueOnEndOfRestrictRange()),a.mediaElement.play(),c&&a.items().completed(!0))}function o(b){var c=this,d=a(b.currentTarget);if(!(d.hasClass(u)||d.hasClass(v)||d.hasClass(w)||c.answerTimeoutHandler)){var e=c._json.content.questions[c.currentQuestionIndex],f=d.data("option-id"),g=c.checkAnswer(c.currentQuestionIndex,f);g.correct?(e.pass=!0,d.addClass(v),c.answerTimeoutHandler=setTimeout(function(){g.promise.then(function(){return m.call(c,c.currentQuestionIndex)}).then(function(){c.answerTimeoutHandler=0})},H)):(d.addClass(u),c.answerTimeoutHandler=setTimeout(function(){d.removeClass(u).addClass(w),c.answerTimeoutHandler=0},I))}}function p(){var a=this;return a.html(h,a._json).tap(q.bind(a))}function q(){var a=this,b=a._json.content,c={video:b.video},d=["TimeRanges","Subtitles","SwitchQuality"],f=e.scriptsToSubtitles(b.scripts),g=e.questionsToEndTimes(b.questions);a.timeRangeSeparators=g;var h={features:d,subtitles:f,timeRangeSeparators:g,restrictPlayingTimeRange:!0,allowPlayingBeforeRestrictRange:!0,continueOnEndOfRestrictRange:!1},i=function(){k.apply(a,arguments)},j=a[r].find(z);j.data({videoInfo:c,options:h,successCallback:i}),j.attr("data-weave","school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"),j.weave()}var r="$element",s="ets-active",t="ets-none",u="ets-wrong",v="ets-correct",w="ets-disabled",x="ets-movie-replay",y=".ets-act-mvq-movie",z=".ets-movie",A=".mejs-overlay-play",B=".mejs-time-separator-item",C=".ets-act-mvq-ques",D=".ets-act-mvq-que",E=".ets-act-mvq-answers",F=".ets-act-mvq-replay-blurb",G=500,H=1500,I=1e3;return g.extend(function(){var a=this;a.currentQuestionIndex=0,a.answerTimeoutHandler=0,a.player=null,a.mediaElement=null,a.needReplay=!1},{"sig/initialize":function(){this.items().instantFeedback(!0)},"sig/render":function(){return p.call(this)},"sig/finalize":function(){var a=this;clearTimeout(a.answerTimeoutHandler)},checkAnswer:function(a,b){var c=this,d=c._json,e=f.makeChoiceInteraction(d,a,b),g=c.publishInteraction(e);return{correct:e.correct,promise:g}},"dom:.ets-act-mvq-answer/click":function(){o.apply(this,arguments)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/multiple-choice-media.html",[],function(){return function(a){var b="",a=a||{},c=a.content.questions[this._index].txt,d=a.content.questions[this._index].options,e=a.content.questions[this._index].audio;b+='\n<div class="ets-act-mcm ets-act-multiple ets-cf">\n\t<div class="ets-act-mcm-content">\n\t\t<div class="ets-act-mt-top">\n\t\t\t',e&&(b+='\n\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t       data-src="'+e.url+'" type="audio/mpeg"\n\t\t\t\t\t       class="ets-ap"></audio>\n\t\t\t\t</div></div>\n\t\t\t'),b+='\n\t\t\t<div class="ets-act-mt-title-container">\n\t\t\t\t<span class="ets-act-mt-title">'+c+'</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<ul class="ets-act-mcm-options">\n\t\t\t';for(var f=0;f<d.length;f++)b+='\n\t\t\t\t<li class="ets-act-mcm-option" data-at-id="'+d[f]._id+'" data-answer="'+d[f]._id+'" data-index="'+f+'">\n\t\t\t\t\t<img src="'+d[f].image.url+'" width="162"  height="117"/>\n\t\t\t\t\t<span class="ets-icon-correct-s ets-none"></span>\n\t\t\t\t\t<span class="ets-icon-incorrect-s ets-none"></span>\n\t\t\t\t</li>\n\t\t\t';return b+="\n\t\t</ul>\t\t\n\t</div>\n</div>"}}),define("school-ui-activity/activity/multiple-choice-media/multiple-choice-media",["jquery","poly","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./multiple-choice-media.html"],function(a,b,c,d,e){"use strict";function f(){}function g(){var a=this,b=a._json,c=b.content.questions[a._index];a.optionWrongT=0,a.selectIsCorrect=!1;for(var d=0;d<c.options.length;d++)c.options[d].selected=!1;return a.html(e,b).tap(h.bind(a))}function h(){var a=this,b=a.$element,c=a._json.references.aud;switch(a.answersNum=1,a._optionsNum){case 2:case 4:b.find(m).addClass(i);break;case 1:b.find(m).addClass(j);break;default:b.find(m).addClass(k)}c&&b.find(n).addClass(l)}var i="ets-act-mt-lay",j="ets-act-mt-single-lay",k="ets-act-mt-common-lay",l="ets-act-mt-ap-content-gap",m=".ets-act-mcm-options",n=".ets-act-mcm-content",o={"sig/render":function(){return g.call(this)},"sig/finalize":function(){window.clearTimeout(this._correctTimer),window.clearTimeout(this.optionWrongT)},"dom:.ets-act-mcm-option/click":function(b){var c=this,d=c.$element,e=a(b.currentTarget),f=d.find(".ets-act-mcm-option"),g=c._item;if(!(e.hasClass("ets-correct")||e.hasClass("ets-wrong")||e.hasClass("ets-disabled")||0!=c.optionWrongT||c.selectIsCorrect))if(c._hasScoring){var h=e.data("answer"),i=c.checkAnswer(h);i?(e.addClass("ets-correct"),e.find(".ets-icon-correct-s").removeClass("ets-none"),c.selectIsCorrect=!0):(e.addClass("ets-wrong"),e.find(".ets-icon-incorrect-s").removeClass("ets-none"),c.optionWrongT=setTimeout(function(){e.toggleClass("ets-disabled ets-wrong"),e.find(".ets-icon-incorrect-s").addClass("ets-none"),c.optionWrongT=0},2e3))}else if(g.answered(!0),c._index===c._length-1&&(g.completed(!0),c._super.nextStep()),e.hasClass("ets-act"))e.removeClass("ets-act"),c.answersNum++;else{if(f.removeClass("ets-act"),e.addClass("ets-act"),0===c.answersNum)return;c.answersNum--}},checkAnswer:function(a){var b=this,c=b._json,e=d.makeChoiceInteraction(c,b._index,a),f=e.correct,g=b._super.publishInteraction(e);return f&&g.then(function(){var a=b._index===b._length-1;a&&(b._json.content._isCorrect=!0),b._item.completed(!0),b._correctTimer=setTimeout(function(){b._super.nextStep()},a?0:2e3)}),f}};return o["hub/activity/template/multiplechoicemedia/load"]=function(a){var b=this;return b._super=a._super,b._json=b._super._json,b._item=b._super.items(),b._index=b._super.index(),b._length=b._super.length(),b._hasScoring=b._super.hasScoring,b._optionsNum=b._json.content.questions[b._index].options.length,b.signal("render")},c.extend(f,o)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/main.html",[],function(){return function(a){var b="",a=a||{},c=a.references.aud;return b+='\r\n<div class="ets-act-mt-container">\r\n\t',c&&(b+='\r\n\t\t<div class="ets-table-hack">\r\n\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t\t\t       data-src="'+c.url+'" type="audio/mpeg"\r\n\t\t\t\t       class="ets-ap ets-com-ap"></audio>\r\n\t\t\t</div></div>\r\n\t\t</div>\r\n\t'),b+='\r\n\t<div class="ets-act-mcm-wrap" data-weave="school-ui-activity/activity/multiple-choice-media/multiple-choice-media">\r\n\t</div>\r\n</div>'}}),define("school-ui-activity/activity/multiple-choice-media/main",["jquery","underscore","when","../base/main","./multiple-choice-media","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(a){if(!a.content.questions)throw"the json data can't find questions node in multiple-choice-media";var c,d,e,f,g,h,i,j=this._json,k=j.filterOptions.optionNo,l=j.filterOptions.random,m=j.content.questions;if(!this.hasScoring&&l)b.each(m,function(c,d){a.content.questions[d].options=b.shuffle(m[d].options),k<c.options.length&&a.content.questions[d].options.splice(k,c.options.length-k)});else{var n=j.scoring.questions;b.each(n,function(j,n){e=l?b.shuffle(m[n].options):m[n].options,f=l?b.shuffle(j.options):j.options,g=[],i=[],h=[],d=1,c=k-d,b.each(f,function(a){(a.selected&&d&&d--||!a.selected&&c&&c--)&&(g.push(a),i.push(a._id))}),b.each(e,function(a){b.indexOf(i,a._id)>=0&&h.push(a)}),a.scoring.questions[n].options=g,a.content.questions[n].options=h})}return a}function i(){var a=this;if(a.publish("activity/step/render",a.index(),a.length()),a.$element)return this._htmlPromise||(this._htmlPromise=this.html(f,this._json).then(function(){return a._$wrapper=a.$element.find(j),a.attachATAssetDom(a._json.content.questions)})),this._htmlPromise.then(function(){return a.publish(k,{_super:a})})}var j=".ets-act-mcm-wrap",k="activity/template/multiplechoicemedia/load",l={"sig/initialize":function(){this.type(d.ACT_TYPE.EXERCISE),this.length(this._json.content.questions.length),h.call(this,this._json)},"sig/render":function(){return this.items().instantFeedback(!0),i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?c.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return d.extend(g,l)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/multiple-choice-text.html",[],function(){return function(a){var b="",a=a||{},c=a.content.questions[this._index].txt,d=a.content.questions[this._index].options,e=a.content.questions[this._index].audio,f="right"===a._layoutType;b+='\n<div class="ets-act-mct ets-act-multiple ets-cf">\n\t<div class="ets-act-mct-content">\n\t\t<div class="ets-act-mt-top">\n\t\t\t',e&&(b+='\n\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t       data-src="'+e.url+'" type="audio/mpeg"\n\t\t\t\t\t       class="ets-ap"></audio>\n\t\t\t\t</div></div>\n\t\t\t'),b+='\n\t\t\t<div class="ets-act-mt-title-container">\n\t\t\t\t<span class="ets-act-mt-title">'+c+'</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<ul class="ets-act-mct-options">\n\t\t\t';for(var g=0;g<d.length;g++)b+='\n\t\t\t\t<li class="ets-act-mct-option" data-at-id="'+d[g]._id+'" data-answer="'+d[g]._id+'" data-index="'+g+'">\n\t\t\t\t\t<div class="ets-table-hack">\n\t\t\t\t\t\t<span>'+d[g].txt+"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t",f&&(b+='\n\t\t\t\t\t<span class="ets-act-mct-option-bg"></span>\n\t\t\t\t\t'),b+="\n\t\t\t\t</li>\n\t\t\t";return b+="\n\t\t</ul>\n\t</div>\n</div>"}}),define("school-ui-activity/activity/multiple-choice-text/multiple-choice-text",["jquery","poly","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./multiple-choice-text.html"],function(a,b,c,d,e){"use strict";function f(){}function g(){var a=this,b=a._json,c=b.content.questions[a._index];a.optionWrongT=0,a.selectIsCorrect=!1;for(var d=0;d<c.options.length;d++)c.options[d].selected=!1;return a.html(e,b).tap(h.bind(a))}function h(){this.answersNum=1}var i={"sig/render":function(){return g.call(this)},"sig/finalize":function(){window.clearTimeout(this._correctTimer),window.clearTimeout(this.optionWrongT)},"dom:.ets-act-mct-option/click":function(b){var c=this,d=c.$element,e=a(b.currentTarget),f=d.find(".ets-act-mct-option"),g=(c._json.content.questions[c._index],c._item);if(!(e.hasClass("ets-correct")||e.hasClass("ets-wrong")||e.hasClass("ets-disabled")||0!=c.optionWrongT||c.selectIsCorrect))if(c._hasScoring){var h=e.data("answer"),i=c.checkAnswer(h);i?(e.addClass("ets-correct"),c.selectIsCorrect=!0):(e.addClass("ets-wrong"),c.optionWrongT=setTimeout(function(){e.toggleClass("ets-disabled ets-wrong"),c.optionWrongT=0},2e3))}else if(g.answered(!0),c._index===c._length-1&&(g.completed(!0),c._super.nextStep()),e.hasClass("ets-act"))e.removeClass("ets-act"),c.answersNum++;else{if(f.removeClass("ets-act"),e.addClass("ets-act"),0===c.answersNum)return;c.answersNum--}},checkAnswer:function(a){var b=this,c=b._json,e=d.makeChoiceInteraction(c,b._index,a),f=e.correct,g=b._super.publishInteraction(e);return f&&g.then(function(){var a=b._index===b._length-1;a&&(b._json.content._isCorrect=!0),b._item.completed(!0),b._correctTimer=setTimeout(function(){b._super.nextStep()},a?0:2e3)}),f}};return i["hub/activity/template/multiplechoicetext/load"]=function(a){var b=this;return b._super=a._super,b._json=b._super._json,b._item=b._super.items(),b._index=b._super.index(),b._length=b._super.length(),b._hasScoring=b._super.hasScoring,b._optionsNum=b._json.content.questions[b._index].options.length,b.signal("render")},c.extend(f,i)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/main.html",[],function(){return function(a){var b="",a=a||{},c=a.references.aud;return b+='\r\n<div class="ets-act-mt-container">\r\n\t',c&&(b+='\r\n\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t\t       data-src="'+c.url+'" type="audio/mpeg"\r\n\t\t\t       class="ets-ap ets-mt-com-ap"></audio>\r\n\t\t</div></div>\r\n\t'),b+='\r\n\t<div class="ets-act-mct-wrap" data-weave="school-ui-activity/activity/multiple-choice-text/multiple-choice-text">\r\n\t</div>\r\n</div>'}}),define("school-ui-activity/activity/multiple-choice-text/main",["jquery","when","underscore","../base/main","./multiple-choice-text","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(a,b,c){"right"===c[l]&&a.addClass(k),this._json[l]=c[l]}function h(a){if(!a.content.questions)throw"the json data can't find questions node in multiple-choice-text";var b,d,e,f,g,h,i,j=this._json,k=j.filterOptions.optionNo,l=j.filterOptions.random,m=j.content.questions;if(!this.hasScoring&&l)c.each(m,function(b,d){a.content.questions[d].options=c.shuffle(m[d].options),k<b.options.length&&a.content.questions[d].options.splice(k,b.options.length-k)});else{var n=j.scoring.questions;c.each(n,function(j,n){e=l?c.shuffle(m[n].options):m[n].options,f=l?c.shuffle(j.options):j.options,g=[],i=[],h=[],d=1,b=k-d,c.each(f,function(a){(a.selected&&d&&d--||!a.selected&&b&&b--)&&(g.push(a),i.push(a._id))}),c.each(e,function(a){c.indexOf(i,a._id)>=0&&h.push(a)}),a.scoring.questions[n].options=g,a.content.questions[n].options=h})}return a}function i(){var a=this;if(a.publish("activity/step/render",a.index(),a.length()),a.$element)return this._htmlPromise||(this._htmlPromise=this.html(f,this._json).then(function(){return a._$wrapper=a.$element.find(j),a.attachATAssetDom(a._json.content.questions)})),this._htmlPromise.then(function(){return a.publish(m,{_super:a})})}var j=".ets-act-mct-wrap",k="ets-act-activity-right",l="_layoutType",m="activity/template/multiplechoicetext/load",n={"sig/initialize":function(){this.type(d.ACT_TYPE.EXERCISE),this.length(this._json.content.questions.length),h.call(this,this._json)},"sig/render":function(){return this.items().instantFeedback(!0),i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))}};return d.extend(g,n)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/multiple-select-media.html",[],function(){return function(a){var b="",a=a||{},c=a.content.questions[this._index].txt,d=a.content.questions[this._index].options,e=a.content.questions[this._index].audio;b+='\r\n<div class="ets-act-msm ets-act-multiple ets-cf">\r\n\t<div class="ets-act-msm-content">\r\n\t\t<div class="ets-act-mt-top">\r\n\t\t\t',e&&(b+='\r\n\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t\t\t           data-src="'+e.url+'" type="audio/mpeg"\r\n\t\t\t\t           class="ets-ap"></audio>\r\n\t\t\t\t</div></div>\r\n\t\t\t'),b+='\r\n\t\t\t<div class="ets-act-mt-title-container">\r\n\t\t\t\t<span class="ets-act-mt-title">'+c+'</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<ul class="ets-act-msm-options">\r\n\t\t\t';for(var f=0;f<d.length;f++)b+='\r\n\t\t\t\t<li class="ets-act-msm-option" data-at-id="'+d[f]._id+'" data-answer="'+d[f]._id+'" data-index="'+f+'">\r\n\t\t\t\t\t<img src="'+d[f].image.url+'" width="162"  height="117"/>\r\n\t\t\t\t\t<span class="ets-icon-correct-s ets-none"></span>\r\n\t\t\t\t\t<span class="ets-icon-incorrect-s ets-none"></span>\r\n\t\t\t\t</li>\r\n\t\t\t';return b+='\r\n\t\t\t<div class="ets-ar ets-clear"></div>\r\n\t\t</ul>\r\n\t</div>\r\n</div>'}}),define("school-ui-activity/activity/multiple-select-media/multiple-select-media",["jquery","poly","when","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./multiple-select-media.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(){var a=this,b=a._json,c=b.content.questions[a._index],d=0;a.optionWrongT=0,a.selectIsCorrect=!1,a._onlyOneAnswer=!1;for(var e=0;e<c.options.length;e++)c.options[e].selected=!1;if(a._hasScoring)for(var g=b.scoring.questions[a._index].options,h=0;h<g.length;h++)g[h].selected&&d++;return a.answersNum=Math.min(b.filterOptions.correctOptionNo,d),a.html(f,b)}function i(){var a=this,b=a.$element,d=a._json.references.aud;switch(a._optionsNum){case 2:case 4:b.find(p).addClass(k);break;case 1:b.find(p).addClass(l);break;default:b.find(p).addClass(m)}return d&&b.find(q).addClass(n),a._hasScoring&&1!==a.answersNum?b.find(o).data("setting",{length:2}).attr("data-weave","school-ui-activity/shared/rolling-number/main(setting)").attr("data-at-id","pnl-answer-remaining").weave().then(function(){b.find(o).trigger(r,{action:"reset",step:a.answersNum})}):(b.find(o).addClass(j),a._onlyOneAnswer=!0,c.resolve())}var j="ets-none",k="ets-act-mt-lay",l="ets-act-mt-single-lay",m="ets-act-mt-common-lay",n="ets-act-mt-ap-content-gap",o=".ets-ar",p=".ets-act-msm-options",q=".ets-act-msm-content",r="rolling-number/switch-answers-num",s={"sig/finalize":function(){window.clearTimeout(this._correctTimer),window.clearTimeout(this.optionWrongT)},"dom:.ets-act-msm-option/click":function(b){var c=this,d=c.$element,e=a(b.currentTarget),f=d.find(".ets-act-msm-option"),g=c._item;if(!(e.hasClass("ets-correct")||e.hasClass("ets-wrong")||e.hasClass("ets-disabled")||0!=c.optionWrongT||c.selectIsCorrect||e.hasClass("ets-animate")))if(c._hasScoring){var h=e.data("answer"),i=c.checkAnswer(h);if(i.correct){if(c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(o).trigger(r,{action:"sub",step:1}),f.removeClass("ets-animate")),e.addClass("ets-correct"),e.find(".ets-icon-correct-s").removeClass(j),0===--c.answersNum){c.selectIsCorrect=!0;var k=c._index===c._length-1;k&&(c._json.content._isCorrect=!0),i.promise.then(function(){c._item.completed(!0),c._correctTimer=setTimeout(function(){c._super.nextStep()},k?0:2e3)})}}else c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(o).trigger(r,{action:"sub",step:1}),f.removeClass("ets-animate")),e.addClass("ets-wrong"),e.find(".ets-icon-incorrect-s").removeClass(j),c.optionWrongT=setTimeout(function(){c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(o).trigger(r,{action:"add",step:1}),f.removeClass("ets-animate")),e.toggleClass("ets-disabled ets-wrong"),e.find(".ets-icon-incorrect-s").addClass(j),c.optionWrongT=0},2e3)}else e.toggleClass("ets-act"),g.answered(!0),c._index===c._length-1&&(g.completed(!0),c._super.nextStep())},checkAnswer:function(a){var b=this,c=b._json,d=e.makeChoiceInteraction(c,b._index,a);return{correct:d.correct,promise:b._super.publishInteraction(d)}}};return s["hub/activity/template/multipleselectmedia/load"]=function(a){var b=this;return b._super=a._super,b._json=b._super._json,b._item=b._super.items(),b._index=b._super.index(),b._length=b._super.length(),b._hasScoring=b._super.hasScoring,b._optionsNum=b._json.content.questions[b._index].options.length,h.call(b).then(i.bind(b))},d.extend(g,s)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/main.html",[],function(){return function(a){var b="",a=a||{},c=a.references.aud;return b+='\r\n<div class="ets-act-mt-container">\r\n\t',c&&(b+='\r\n\t\t<div class="ets-table-hack">\r\n\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t\t\t       data-src="'+c.url+'" type="audio/mpeg"\r\n\t\t\t\t       class="ets-ap ets-com-ap"></audio>\r\n\t\t\t</div></div>\r\n\t\t</div>\r\n\t'),b+='\r\n\t<div class="ets-act-msm-wrap" data-weave="school-ui-activity/activity/multiple-select-media/multiple-select-media">\r\n\t</div>\r\n</div>'}}),define("school-ui-activity/activity/multiple-select-media/main",["jquery","underscore","when","../base/main","./multiple-select-media","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(a){if(!a.content.questions)throw"the json data can't find questions node in multiple-select-media";var c,d,e,f,g,h,i,j=this._json,k=j.filterOptions.optionNo,l=j.content.questions;if(this.hasScoring){var m=j.scoring.questions;b.each(m,function(m,n){e=b.shuffle(l[n].options),f=b.shuffle(m.options),g=[],i=[],h=[],d=j.filterOptions.correctOptionNo,c=k-d,b.each(f,function(a){(a.selected&&d&&d--||!a.selected&&c&&c--)&&(g.push(a),i.push(a._id))}),b.each(e,function(a){b.indexOf(i,a._id)>=0&&h.push(a)}),a.scoring.questions[n].options=g,a.content.questions[n].options=h})}else b.each(l,function(c,d){a.content.questions[d].options=b.shuffle(l[d].options),k<c.options.length&&a.content.questions[d].options.splice(k,c.options.length-k)});return a}function i(){var a=this;if(a.publish("activity/step/render",a.index(),a.length()),a.$element)return this._htmlPromise||(this._htmlPromise=this.html(f,this._json).then(function(){return a._$wrapper=a.$element.find(j),a.attachATAssetDom(a._json.content.questions)})),this._htmlPromise.then(function(){a.publish(k,{_super:a})})}var j=".ets-act-msm-wrap",k="activity/template/multipleselectmedia/load",l={"sig/initialize":function(){this.type(d.ACT_TYPE.EXERCISE),this.length(this._json.content.questions.length),h.call(this,this._json)},"sig/render":function(){return this.items().instantFeedback(!0),i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?c.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return d.extend(g,l)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/multiple-select-text.html",[],function(){return function(a){var b="",a=a||{},c=a.content.questions[this._index].txt,d=a.content.questions[this._index].options,e=a.content.questions[this._index].audio,f="right"===a._layoutType;b+='\n<div class="ets-act-mst ets-act-multiple ets-cf">\n\t<div class="ets-act-mst-content">\n\t\t<div class="ets-act-mt-top">\n\t\t\t',
e&&(b+='\n\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t           data-src="'+e.url+'" type="audio/mpeg"\n\t\t\t\t           class="ets-ap"></audio>\n\t\t\t\t</div></div>\n\t\t\t'),b+='\n\t\t\t<div class="ets-act-mt-title-container">\n\t\t\t\t<span class="ets-act-mt-title">'+c+'</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<ul class="ets-act-mst-options">\n\t\t\t';for(var g=0;g<d.length;g++)b+='\n\t\t\t\t<li class="ets-act-mst-option" data-at-id="'+d[g]._id+'" data-answer="'+d[g]._id+'" data-index="'+g+'">\n\t\t\t\t\t<div class="ets-table-hack">\n\t\t\t\t\t\t<span>'+d[g].txt+"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t",f&&(b+='\n\t\t\t\t\t<span class="ets-act-mst-option-bg"></span>\n\t\t\t\t\t'),b+="\n\t\t\t\t</li>\n\t\t\t";return b+='\n\t\t\t<div class="ets-ar ets-clear"></div>\n\t\t</ul>\n\t</div>\n</div>'}}),define("school-ui-activity/activity/multiple-select-text/multiple-select-text",["jquery","poly","when","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./multiple-select-text.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(){var a=this,b=a._json,c=b.content.questions[a._index],d=0;a.optionWrongT=0,a.selectIsCorrect=!1,a._onlyOneAnswer=!1;for(var e=0;e<c.options.length;e++)c.options[e].selected=!1;if(a._hasScoring)for(var g=b.scoring.questions[a._index].options,h=0;h<g.length;h++)g[h].selected&&d++;return a.answersNum=Math.min(b.filterOptions.correctOptionNo,d),a.html(f,b)}function i(){var a=this,b=a.$element;return a._hasScoring&&1!==a.answersNum?b.find(k).data("setting",{length:2,type:"right"===this._json[l]?"white":"gray"}).attr("data-weave","school-ui-activity/shared/rolling-number/main(setting)").attr("data-at-id","pnl-answer-remaining").weave().then(function(){b.find(k).trigger(m,{action:"reset",step:a.answersNum})}):(b.find(k).addClass(j),a._onlyOneAnswer=!0,c.resolve())}var j="ets-none",k=".ets-ar",l="_layoutType",m="rolling-number/switch-answers-num",n={"sig/finalize":function(){window.clearTimeout(this._correctTimer),window.clearTimeout(this.optionWrongT)},"dom:.ets-act-mst-option/click":function(b){var c=this,d=c.$element,e=a(b.currentTarget),f=d.find(".ets-act-mst-option"),g=c._item;if(!(e.hasClass("ets-correct")||e.hasClass("ets-wrong")||e.hasClass("ets-disabled")||0!=c.optionWrongT||c.selectIsCorrect||e.hasClass("ets-animate")))if(c._hasScoring){var h=e.data("answer"),i=c.checkAnswer(h);if(i.correct){if(c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(k).trigger(m,{action:"sub",step:1}),f.removeClass("ets-animate")),e.addClass("ets-correct"),0===--c.answersNum){c.selectIsCorrect=!0;var j=c._index===c._length-1;j&&(c._json.content._isCorrect=!0),i.promise.then(function(){c._item.completed(!0),c._correctTimer=setTimeout(function(){c._super.nextStep()},j?0:2e3)})}}else c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(k).trigger(m,{action:"sub",step:1}),f.removeClass("ets-animate")),e.addClass("ets-wrong"),c.optionWrongT=setTimeout(function(){c._onlyOneAnswer||(f.addClass("ets-animate"),d.find(k).trigger(m,{action:"add",step:1}),f.removeClass("ets-animate")),e.toggleClass("ets-disabled ets-wrong"),c.optionWrongT=0},2e3)}else e.toggleClass("ets-act"),g.answered(!0),c._index===c._length-1&&(g.completed(!0),c._super.nextStep())},checkAnswer:function(a){var b=this,c=b._json,d=e.makeChoiceInteraction(c,b._index,a);return{correct:d.correct,promise:b._super.publishInteraction(d)}}};return n["hub/activity/template/multipleselecttext/load"]=function(a){var b=this;return b._super=a._super,b._json=b._super._json,b._item=b._super.items(),b._index=b._super.index(),b._length=b._super.length(),b._hasScoring=b._super.hasScoring,b._optionsNum=b._json.content.questions[b._index].options.length,h.call(b).then(i.bind(b))},d.extend(g,n)}),define("troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/main.html",[],function(){return function(a){var b="",a=a||{},c=a.references.aud;return b+='\r\n<div class="ets-act-mt-container">\r\n\t',c&&(b+='\r\n\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\r\n\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\r\n\t\t           data-src="'+c.url+'" type="audio/mpeg"\r\n\t\t           class="ets-ap ets-mt-com-ap"></audio>\r\n\t\t</div></div>\r\n\t'),b+='\r\n\t<div class="ets-act-mst-wrap" data-weave="school-ui-activity/activity/multiple-select-text/multiple-select-text">\r\n\t</div>\r\n</div>'}}),define("school-ui-activity/activity/multiple-select-text/main",["jquery","underscore","when","../base/main","./multiple-select-text","template!./main.html"],function(a,b,c,d,e,f){"use strict";function g(a,b,c){"right"===c[l]&&a.addClass(k),this._json[l]=c[l]}function h(a){if(!a.content.questions)throw"the json data can't find questions node in multiple-select-text";var c,d,e,f,g,h,i,j=this._json,k=j.filterOptions.optionNo,l=j.filterOptions.random,m=j.content.questions;if(!this.hasScoring&&l)b.each(m,function(c,d){a.content.questions[d].options=b.shuffle(m[d].options),k<c.options.length&&a.content.questions[d].options.splice(k,c.options.length-k)});else{var n=j.scoring.questions;b.each(n,function(n,o){e=l?b.shuffle(m[o].options):m[o].options,f=l?b.shuffle(n.options):n.options,g=[],i=[],h=[],d=j.filterOptions.correctOptionNo,c=k-d,b.each(f,function(a){(a.selected&&d&&d--||!a.selected&&c&&c--)&&(g.push(a),i.push(a._id))}),b.each(e,function(a){b.indexOf(i,a._id)>=0&&h.push(a)}),a.scoring.questions[o].options=g,a.content.questions[o].options=h})}return a}function i(){var a=this;if(a.publish("activity/step/render",a.index(),a.length()),a.$element)return this._htmlPromise||(this._htmlPromise=this.html(f,a._json).then(function(){return a._$wrapper=a.$element.find(j),a.attachATAssetDom(a._json.content.questions)})),this._htmlPromise.then(function(){return a.publish(m,{_super:a})})}var j=".ets-act-mst-wrap",k="ets-act-activity-right",l="_layoutType",m="activity/template/multipleselecttext/load",n={"sig/initialize":function(){this.type(d.ACT_TYPE.EXERCISE),this.length(this._json.content.questions.length),h.call(this,this._json)},"sig/render":function(){return this.items().instantFeedback(!0),i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?c.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return d.extend(g,n)}),define("troopjs-requirejs/template!school-ui-activity/activity/no-template/no-template.html",[],function(){return function(a){return"<div>\n\t<p>Activity not available now. Please skip this activity to continue.</p>\n</div>"}}),define("school-ui-activity/activity/no-template/main",["school-ui-activity/activity/base/main","template!./no-template.html"],function(a,b){"use strict";return a.extend({"sig/initialize":function(){this.items().completed(!0)},"sig/render":function(){return this.html(b)}})}),define("troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/main.html",[],function(){return function(a){return'<div class="ets-act-rpa-wrap" data-weave="school-ui-activity/activity/role-play-audio/role-play-audio"></div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/role-play-audio.html",[],function(){return function(a){var b="",a=a||{},a=(a.correctRequired,a.data),c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};b+='\n\n\n<div class="ets-act-rpa">\n\t<div class="ets-act-rpa-bd">\n\t\t<div class="ets-act-rpa-side">\n\t\t\t<div class="ets-act-rpa-questions">\n\t\t\t\t<h4><span '+c(150634,"Question")+"></span> <strong>1</strong> / "+a.content.questions.length+"</h4>\n\t\t\t\t";for(var d=a.content.questions,e=0;e<d.length;e++)!function(a,c){var d=c+1,e={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F"};b+='\n\t\t<ul class="ets-act-rpa-question" data-order="'+d+'" data-id="'+a._id+'" data-at-id="'+a._id+'" data-start-time="'+a.startTime+'" data-end-time="'+a.endTime+'">\n\t\t\t';for(var f=a.options,g=0;g<f.length;g++)b+='\n\t\t            <li class="ets-act-rpa-answer ets-nth-'+(g+1)+'" data-id="'+f[g]._id+'" data-at-id="'+a._id+"_"+f[g]._id+'"><b>'+e[g]+'</b><i class="ets-mark-correct"></i><i class="ets-mark-incorrect"></i><span>'+f[g].txt+"</span></li>\n\t\t    ";b+="\n\t\t\t\n\t\t</ul>\n"}(d[e],e);b+='\n\t\t\t</div>\n\t\t\t<div class="ets-act-rpa-mic ets-none">\n\t\t\t\t<div data-weave="school-ui-activity/shared/asr/asr-ui"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-rpa-main">\n\t\t\n\t\t\t<div class="ets-act-rpa-audio-overlay"><span class="ets-act-rpa-audio-start" data-at-id="btn-audio-start"></span></div>\n\t\t\t<div class="ets-act-rpa-image">\n\t\t\t\t';for(var d=a.content.questions,e=0;e<d.length;e++)!function(a,c){b+='\n\t\t<img src="'+a.image.url+'" alt="" width="640" height="360" data-index=\''+c+"' />\n"}(d[e],e);return b+='\n\t\t\t</div>\n\t\t\t<div class="ets-act-rpa-audio-player">\n\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t       src="'+a.content.questions[0].audio.url+'" type="audio/mpeg"\n\t\t\t\t       class="ets-ap ets-ap-nobar"></audio>\n\t\t\t</div>\n\t\t\t<div class="ets-act-rpa-audio-control">\n\t\t\t\t<div class="ets-act-rpa-btn-replay" data-at-id="replay"><span '+c(467622,"Replay this segment")+'></span></div>\n\t\t\t\t<div class="ets-act-rpa-btn-skip" data-at-id="btn-skip"><span '+c(467623,"Skip this segment")+'></span></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Activity Summary Start--\x3e\n\t<div class="ets-act-summary-wrap"></div>\n\t\x3c!-- Activity Summary End--\x3e\n</div>\n\n',b+="\n\n"}}),define("school-ui-activity/activity/role-play-audio/role-play-audio",["jquery","jquery.ui","poly","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./role-play-audio.html","school-ui-shared/enum/rating-source-type","school-ui-activity/shared/asr/asr-service-message-type","school-ui-activity/shared/asr/asr-ui-states"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){var a=this;a.answerMode={},a.questionShown=!1,a.isLastQuestion=!1,a.isFirstQuestion=!0,a.totalQuestions={},a.currentQuestion={},a.currentQuestionIndex={},a.$currentQuestion={},a.correctCount={},a.incorrectCount={},a.correctRequired={},a.asrDisabled=!1,a.timeouts=[]}function l(){var a=this,b=this._json;if(this.totalQuestions=this._json.content.questions.length,!b)throw this.toString()+C;return a.correctRequired=Math.ceil(e.ASR_MIN_PASSED_QUESTIONS_RATE*a.totalQuestions),a.correctCount=0,a.incorrectCount=a.totalQuestions,this.html(g,{data:b,correctRequired:a.correctRequired}).tap(m.bind(a))}function m(){var b=this,c=this.$element,d=!b.asrDisabled&&!b._json.asrDisabled&&window.location.search.indexOf("non-asr")<0;b.publish(_,n.bind(b),b._json.content.questions[0],{asrFallbackType:"SELECT",asrFallbackCb:o.bind(b,"SELECT"),needResetASRFailedTimes:!0,asrEnableTip:!0}),c.find(K).click(function(){x.call(b)}),c.find(L).click(function(){b.audioControlEnabled&&(b.publish("asr/ui/playback",!1),y.call(b))}),c.find(M).click(function(){b.audioControlEnabled&&(b.publish("asr/ui/playback",!1),b.isNonGraded()?z.call(b):b.publishSkipInteraction(b.currentQuestionIndex))}),ba.call(b),d||(o.call(b,"SELECT"),$=h.ASR_SELECTION),b.currentQuestionIndex=0,b.currentQuestion=b._json.content.questions[b.currentQuestionIndex],b.$currentQuestion=c.find(O),c.find(H).filter(function(){return 0==a(this).data("index")}).show()}function n(b){var c=this;if(b&&b.length>0){var d=a(c.$currentQuestion.find(J).filter(function(){return a(this).data("id").split("_")[1]==b[0].index})[0]),e=d.data("id");if(c.isNonGraded()){d.addClass(U),w.call(c);var f=setTimeout(function(){z.call(c)},Z);c.timeouts.push(f),c.correctCount++,c.incorrectCount--}else if(b[0].score<100)B.call(c,"INCORRECT_PRONUN");else{var g=c.checkAnswer(c.currentQuestionIndex,e);c.displayInteractionResult(g,d,b)}}}function o(b){var c=this,d=this.$element;switch(b){case"ASR":c.answerMode="ASR",d.find(Q).removeClass(W),d.find(N).removeClass(Y),d.find(N+" li").unbind("click"),c._super.scoringType("asr");break;case"SELECT":default:c.answerMode="SELECT",d.find(Q).addClass(W),d.find(N).addClass(Y),d.find(N+" li").click(function(){p.call(c,a(this))}),c._super.scoringType("default")}}function p(a){var b=this;if(!a.hasClass(V)&&!b.optionFreezed){var c=a.data("id");if(u.call(b),b.isNonGraded()){b.optionFreezed=!0,a.addClass(U),w.call(b);var d=setTimeout(function(){z.call(b)},Z);b.timeouts.push(d),b.correctCount++,b.incorrectCount--}else{var e=b.checkAnswer(b.currentQuestionIndex,c);b.displayInteractionResult(e,a)}}}function q(){var a=this,b=this.$element;a.questionShown||(a.questionShown=!0,a.optionFreezed=!1,a.isFirstQuestion?(b.find(F).animate({left:"0"},300),b.find(G).animate({right:"0"},300),a.isFirstQuestion=!1):navigator.userAgent.indexOf("MSIE 8.0")>0?b.find(G).show():b.find(G).fadeIn("slow"),b.find(R).show())}function r(){var a=this,b=this.$element;a.questionShown&&(a.questionShown=!1,navigator.userAgent.indexOf("MSIE 8.0")>0?b.find(G).hide():b.find(G).fadeOut("slow"),b.find(R).hide())}function s(){var a=this,b=this.$element;a.currentQuestionIndex<a.totalQuestions?(b.find(E).trigger("player/pause"),v.call(a),q.call(a),t.call(a),b.find(I+"[data-order="+(a.currentQuestionIndex+1)+"]").attr("data-at-status","shown")):(a.actStarted=!1,u.call(a))}function t(){var a=this;this.$element.find(S).removeClass(V),a.audioControlEnabled=!0}function u(){var a=this;this.$element.find(S).addClass(V),a.audioControlEnabled=!1}function v(){this.publish("asr/enable")}function w(){this.publish("asr/disable")}function x(){var a=this,b=this.$element;b.find(E).trigger("player/play"),b.find(K).hide(0),a.actStarted=!0,w.call(a),u.call(a),r.call(a)}function y(){var a=this,b=this.$element;a.audioControlEnabled&&(a.$currentQuestion=b.find(O),b.find(E).trigger("player/play",a.currentQuestion.audio.url),w.call(a),u.call(a))}function z(){var b=this,c=this.$element;if(b.currentQuestionIndex+1<b.totalQuestions){b.currentQuestionIndex++,b.currentQuestion=b._json.content.questions[b.currentQuestionIndex];var d=setTimeout(function(){b.$currentQuestion.removeClass(X).next().addClass(X),b.$currentQuestion=b.$currentQuestion.next(),c.find(P).text(b.currentQuestionIndex+1)},500);b.timeouts.push(d),c.find(H).hide(),c.find(H).filter(function(){return a(this).data("index")==b.currentQuestionIndex}).show(),c.find(E).trigger("player/play",b.currentQuestion.audio.url),b.publish(_,n.bind(b),b.currentQuestion,{asrEnableTip:!0}),w.call(b),u.call(b),r.call(b)}else{var e,f=b.isNonGraded();f?e=!0:(e=b.correctCount>=b.correctRequired,b._json.content._isCorrect=e),c.find(D).fadeOut(300,function(){a(this).addClass(W).removeAttr("style"),A.call(b,e)}),f?b._item.answered(!0):b._item.completed(!0)}}function A(a){var b=this;this.$element.find(T).data("settings",{passed:a,correctNum:b.correctCount,skippedNum:b.incorrectCount,passNum:b.correctRequired}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave(),b.publish(aa)}function B(a){this.publish("asr/show/message",i[a])}var C=": json format is incorrect.",D=".ets-act-rpa-bd",E=".ets-ap",F=".ets-act-rpa-main",G=".ets-act-rpa-side",H=".ets-act-rpa-image img",I=".ets-act-rpa-question",J=".ets-act-rpa-answer",K=".ets-act-rpa-audio-start",L=".ets-act-rpa-btn-replay",M=".ets-act-rpa-btn-skip",N=".ets-act-rpa-questions",O=".ets-act-rpa-question.ets-active",P=".ets-act-rpa-questions h4 strong",Q=".ets-act-rpa-mic > div",R=".ets-act-rpa-mic",S=".ets-act-rpa-audio-control",T=".ets-act-summary-wrap",U="ets-correct",V="ets-disabled",W="ets-none",X="ets-active",Y="ets-select-mode",Z=1500,$=h.ASR_SPEAKING,_="asr/ui/setting",aa="dispose/reference",ba=function(){var a=this,b=this.$element;b.find(I).removeClass(X),b.find(I+":first").addClass(X),b.find(K).show(0),b.find(P).text("1"),this.actStarted=!1,w.call(a),u.call(a)},ca={"sig/render":function(){return l.call(this)},"sig/finalize":function(){a.each(this.timeouts,function(a,b){window.clearTimeout(b)})},"sig/start":function(){var a=this;return a.query('ccl!"school.asr.enabled"').spread(function(b){a.asrDisabled=!(b&&"true"===b.value)})},"hub/activity/template/rpa/load":function(a,b){var c=this;return c._json=b.json,c._item=b.item,c._interacted=!1,c._super=a,c._item.instantFeedback(!0),c.signal("render")},"hub/asr/ui/states/changed":function(a){var b=this;if(a&&b.actStarted)switch(a){case j.RECORDING:case j.PROCESSING:case j.PREPARING:case j.DISABLE:u.call(b);break;default:t.call(b)}},"hub/rating/sourceType":function(){return[$]},"dom:.ets-ap/media/ended":function(){s.call(this)},checkAnswer:function(a,b){var c=this,d=f.makeChoiceInteraction(c._json,a,b),e=c._super.publishInteraction(d);if(d.correct){c.correctCount++,c.incorrectCount--;var g=setTimeout(function(){e.then(function(){z.call(c)})},Z);c.timeouts.push(g)}return d.correct},publishSkipInteraction:function(a){var b=this,c=b._json.content.questions[a]._id,d=f.makeSkipInteraction(c);b._super.publishInteraction(d).then(function(){z.call(b)})},displayInteractionResult:function(a,b,c){var d=this;if(d.optionFreezed=!0,a)b.addClass(U),w.call(d);else{b.addClass("ets-incorrect"),c&&!c._hasError&&B.call(d,"INCORRECT_ANSWER");var e=setTimeout(function(){b.removeClass("ets-incorrect").addClass(V),d.optionFreezed=!1,c||t.call(d)},Z);d.timeouts.push(e)}},isNonGraded:function(){return 3==this._super.type()}};return d.extend(k,ca)}),define("school-ui-activity/activity/role-play-audio/main",["jquery","when","../base/main","template!./main.html","./role-play-audio"],function(a,b,c,d,e){"use strict";function f(){this.scoringType(c.SCORING_TYPE.ASR),this._htmlPromise=null}function g(){var a=this;if(a.$element){this._htmlPromise||(this._htmlPromise=this.html(d()));var b=this._json;return this._htmlPromise.then(function(){return a.publish(h,a,{item:a.items(),json:b})})}}var h="activity/template/rpa/load",i={"sig/initialize":function(){this.hasScoring||this.type(c.ACT_TYPE.PRACTICE),this.items().instantFeedback(!0),this.length(1)},"sig/render":function(){return g.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(f,i)}),define("troopjs-requirejs/template!school-ui-activity/activity/role-play-video/main.html",[],function(){return function(a){return'<div class="ets-act-rpv-wrap" data-weave="school-ui-activity/activity/role-play-video/role-play-video"></div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/role-play-video/role-play-video.html",[],function(){return function(a){var b="",a=a||{},a=(a.correctRequired,a.data),c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};b+='\n\n\n<div class="ets-act-rpv">\n\t<div class="ets-act-rpv-bd">\n\t\t<div class="ets-act-rpv-side">\n\t\t\t<div class="ets-act-rpv-questions">\n\t\t\t\t<h4><span '+c(150634,"Question")+"></span> <strong>1</strong> / "+a.content.questions.length+"</h4>\n\t\t\t\t";for(var d=a.content.questions,e=0;e<d.length;e++)!function(a,c){var d=c+1,e={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F"};b+='\n\t\t<ul class="ets-act-rpv-question" data-order="'+d+'" data-id="'+a._id+'" data-at-id="'+a._id+'" data-start-time="'+a.startTime+'" data-end-time="'+a.endTime+'">\n\t\t\t';for(var f=a.options,g=0;g<f.length;g++)b+='\n\t\t            <li class="ets-act-rpv-answer ets-nth-'+(g+1)+'" data-id="'+f[g]._id+'" data-at-id="'+a._id+"_"+f[g]._id+'"><b>'+e[g]+'</b><i class="ets-mark-correct"></i><i class="ets-mark-incorrect"></i><span>'+f[g].txt+"</span></li>\n\t\t    ";b+="\n\t\t\t\n\t\t</ul>\n"}(d[e],e);return b+='\n\t\t\t</div>\n\t\t\t<div class="ets-act-rpv-mic ets-none">\n\t\t\t\t<div data-weave="school-ui-activity/shared/asr/asr-ui"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-rpv-main">\n\t\t\t<div class="ets-act-vp-wrap">\x3c!--<div data-weave="school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"></div>--\x3e</div>\n\t\t\t<div class="ets-act-rpv-video-control">\n\t\t\t\t<div class="ets-act-rpv-btn-replay" data-at-id="replay"><span '+c(467622,"Replay this segment")+'></span></div>\n\t\t\t\t<div class="ets-act-rpv-btn-skip" data-at-id="btn-skip"><span '+c(467623,"Skip this segment")+'></span></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\n\t\x3c!-- Activity Summary Start--\x3e\n\t<div class="ets-act-summary-wrap"></div>\n\t\x3c!-- Activity Summary End--\x3e\n\t\n</div>\n\n'}}),define("school-ui-activity/activity/role-play-video/role-play-video",["jquery","jquery.ui","jquery.easing","poly","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","mediaelement-plugin-ef","school-ui-activity/util/activity-util","school-ui-shared/enum/rating-source-type","school-ui-activity/shared/asr/asr-service-message-type","school-ui-activity/shared/asr/asr-ui-states","school-ui-activity/util/content-converter","template!./role-play-video.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){var a=this;a.answerMode={},a.questionShown=!1,a.outOfLastQuestion=!1,a.firstQuestionShown=!1,a.questionCount=0,a.currentQuestion={},a.currentQuestionIndex=-1,a.$currentQuestion={},a.correctCount={},a.incorrectCount={},a.correctRequired={},a.mediaElement={},a.asrDisabled=!1,a.timeouts=[],a.actStarted=!1}function p(){var a=this,b=this._json;if(this.questionCount=this._json.content.questions.length,!b)throw this.toString()+K;return a.correctRequired=Math.ceil(f.ASR_MIN_PASSED_QUESTIONS_RATE*a.questionCount),a.correctCount=0,a.incorrectCount=a.questionCount,this.html(n,{data:b,correctRequired:a.correctRequired}).tap(q.bind(a))}function q(){var a=this,b=!a.asrDisabled&&!a._json.asrDisabled&&window.location.search.indexOf("non-asr")<0;a.publish(ca,s.bind(a),a._json.content.questions[0],{asrFallbackType:"SELECT",asrEnableSwitch:b,asrFallbackCb:t.bind(a,"SELECT"),needResetASRFailedTimes:!0,asrEnableTip:!0}),x.call(a),E.call(a),C.call(a),b||(t.call(a,"SELECT"),ea=j.ASR_SELECTION),r.call(a,0)}function r(a){var b=this,c=b.$element;b.currentQuestionIndex=a,b.currentQuestion=b._json.content.questions[a],b.$currentQuestion=c.find(O+":eq("+a+")"),c.find(R).text(a+1)}function s(b){var c=this;if(b&&b.length>0){var d=a(c.$currentQuestion.find(P).filter(function(){return a(this).data("id").split("_")[1]==b[0].index})[0]),e=d.data("id");if(b[0].score<100)J.call(c,"INCORRECT_PRONUN");else{var f=c.checkAnswer(c.currentQuestionIndex,e);c.displayInteractionResult(f,d,b)}}}function t(b){var c=this,d=this.$element;switch(b){case"ASR":c.answerMode="ASR",d.find(S).removeClass(Y),d.find(Q).removeClass($),d.find(Q+" li").unbind("click"),c._super.scoringType("asr");break;case"SELECT":default:c.answerMode="SELECT",d.find(S).addClass(Y),d.find(Q).addClass($),d.find(Q+" li").click(function(){u.call(c,a(this))}),c._super.scoringType("default")}}function u(a){var b=this;if(!a.hasClass(X)&&!b.optionFreezed){var c=a.data("id");C.call(b);var d=b.checkAnswer(b.currentQuestionIndex,c);b.displayInteractionResult(d,a)}}function v(){var a=this,b=this.$element;a.questionShown||(a.questionShown=!0,a.optionFreezed=!1,a.$currentQuestion.addClass(Z).siblings().removeClass(Z),a.firstQuestionShown?b.find(N).fadeIn(ba):(a.firstQuestionShown=!0,b.find(M).animate({left:"0"},ba),b.find(N).animate({right:"0"},ba)),b.find(T).show())}function w(){var a=this,b=this.$element;a.questionShown&&(a.questionShown=!1,b.find(N).fadeOut(ba),b.find(T).hide())}function x(){var a=this,b=this.$element,c=a._json.content||{},d={video:c.video},e=["TimeRanges"],f=m.questionsToTimeRanges(c.questions),g={features:e,timeRanges:f,restrictPlayingTimeRange:!0,allowPlayingBeforeRestrictRange:!0,continueOnEndOfRestrictRange:!0},h=function(){y.apply(a,arguments)},i=b.find(W);i.data({videoInfo:d,options:g,successCallback:h}),i.attr("data-weave","school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)"),i.weave()}function y(a,b,c){var d=this,e=d.$element;d.mediaElement=a,d.$mediaElement=h.$(a),d.player=c,d.$mediaElement.one("play",function(){d.actStarted=!0,c.options.clickToPlayPause=!1,e.find(W).addClass(_)}),d.$mediaElement.on("restrict_time_range_ended",function(){d.mediaElement.pause(),z.call(d)})}function z(){var a=this;a.outOfLastQuestion||(D.call(a),B.call(a),v.call(a),A.call(a))}function A(){var a=this;a.$element.find(O+"[data-order="+(a.currentQuestionIndex+1)+"]").attr("data-at-status","shown")}function B(){var a=this;this.$element.find(U).removeClass(X),a.videoControlEnabled=!0}function C(){var a=this;this.$element.find(U).addClass(X),a.videoControlEnabled=!1}function D(){this.publish("asr/enable")}function E(){this.publish("asr/disable")}function F(){var a=this;a.player.goToTimeRange(a.currentQuestionIndex,!0),a.mediaElement.play(),E.call(a),C.call(a)}function G(){var a=this;if(E.call(a),C.call(a),w.call(a),a.currentQuestionIndex+1<a.questionCount){var b=setTimeout(function(){r.call(a,a.currentQuestionIndex+1),a.publish(ca,s.bind(a),a.currentQuestion,{asrEnableTip:!0}),a.player.goToTimeRange(a.currentQuestionIndex),a.mediaElement.play()},aa);a.timeouts.push(b)}else if(a.outOfLastQuestion=!0,0===a.mediaElement.currentTime||a.mediaElement.duration-a.mediaElement.currentTime<1)I.call(a);else{a.$mediaElement.one("ended",function(){I.call(a)});var c=setTimeout(function(){w.call(a),a.mediaElement.play()},aa);a.timeouts.push(c)}}function H(b){var c=this,d=this.$element;d.find(L).fadeOut(ba,function(){a(this).addClass(Y).removeAttr("style"),d.find(V).data("settings",{passed:b,correctNum:c.correctCount,skippedNum:c.incorrectCount,passNum:c.correctRequired}).attr("data-weave","school-ui-activity/shared/summary/main(settings)").weave()}),c.publish(da)}function I(){var a=this,b=a.correctCount>=a.correctRequired;a._json.content._isCorrect=b,H.call(a,b),a._item.completed(!0),a.actStarted=!1}function J(a){this.publish("asr/show/message",k[a])}var K=": json format is incorrect.",L=".ets-act-rpv-bd",M=".ets-act-rpv-main",N=".ets-act-rpv-side",O=".ets-act-rpv-question",P=".ets-act-rpv-answer",Q=".ets-act-rpv-questions",R=".ets-act-rpv-questions h4 strong",S=".ets-act-rpv-mic > div",T=".ets-act-rpv-mic",U=".ets-act-rpv-video-control",V=".ets-act-summary-wrap",W=".ets-act-vp-wrap",X="ets-disabled",Y="ets-none",Z="ets-active",$="ets-select-mode",_="ets-vp-played",aa=500,ba=300,ca="asr/ui/setting",da="dispose/reference",ea=j.ASR_SPEAKING,fa={"sig/render":function(){return p.call(this)},"sig/finalize":function(){a.each(this.timeouts,function(a,b){clearTimeout(b)})},"sig/start":function(){var a=this;return a.query('ccl!"school.asr.enabled"').spread(function(b){a.asrDisabled=!(b&&"true"===b.value)})},"dom/destroy":function(){var a=this;i.clearVideo(a.mediaElement)},"hub/asr/ui/states/changed":function(a){var b=this;if(a&&b.actStarted)switch(a){case l.RECORDING:case l.PROCESSING:case l.PREPARING:case l.DISABLE:C.call(b);break;default:B.call(b)}},"hub/rating/sourceType":function(){return[ea]},"dom:.ets-act-rpv-btn-replay/click":function(){var a=this;a.videoControlEnabled&&(a.publish("asr/ui/playback",!1),F.call(a))},"dom:.ets-act-rpv-btn-skip/click":function(){var a=this;a.videoControlEnabled&&(a.publish("asr/ui/playback",!1),a.publishSkipInteraction(a.currentQuestionIndex))},"hub/activity/template/rpv/load":function(a,b){var c=this;return c._json=b.json,c._item=b.item,c._interacted=!1,c._super=a,c._item.instantFeedback(!0),c.signal("render")},checkAnswer:function(a,b){var c=this,d=g.makeChoiceInteraction(c._json,a,b),e=c._super.publishInteraction(d);if(d.correct){c.correctCount++,c.incorrectCount--;var f=setTimeout(function(){e.then(function(){G.call(c)})},1500);c.timeouts.push(f)}return d.correct},publishSkipInteraction:function(a){var b=this,c=b._json.content.questions[a]._id,d=g.makeSkipInteraction(c);b._super.publishInteraction(d).then(function(){G.call(b)})},displayInteractionResult:function(a,b,c){var d=this;if(d.optionFreezed=!0,a)b.addClass("ets-correct"),E.call(d);else{b.addClass("ets-incorrect"),c&&!c._hasError&&J.call(d,"INCORRECT_ANSWER");var e=setTimeout(function(){b.removeClass("ets-incorrect").addClass(X),d.optionFreezed=!1,c||B.call(d)},1500);d.timeouts.push(e)}}};return e.extend(o,fa)}),define("school-ui-activity/activity/role-play-video/main",["jquery","underscore","../base/main","template!./main.html","when","./role-play-video"],function(a,b,c,d,e,f){"use strict";return c.extend(function(){this.scoringType(c.SCORING_TYPE.ASR),this._htmlPromise=null},{"sig/initialize":function(){this.length(1)},"sig/render":function(){var a=this;if(a.$element)return this._htmlPromise||(this._htmlPromise=this.html(d())),a._htmlPromise.then(function(){return a.publish("activity/template/rpv/load",a,{item:a.items(),json:a._json})})},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?e.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}})}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/sequencing-image.html",[],function(){return function(a){var b='<div class="ets-act-sqi">\n\t',a=a||{};a.references.aud&&(b+='\n\t<div class="ets-act-sqi-side">\n\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t           data-src="'+a.references.aud.url+'" type="audio/mpeg"\n\t\t           class="ets-ap"></audio>\n\t\t</div></div>\n\t</div>\n\t'),b+='\n\t<div class="ets-act-sqi-main">\n\t\t<div class="ets-act-sqi-droparea">\n\t\t';for(var c=a.content.sequences,d=1;d<=c.length;d++)d<c.length?b+='\n\t            <div class="ets-act-sqi-droppable ets-nth-'+d+'"></div>\n\t            ':b+='\n\t            <div class="ets-act-sqi-droppable ets-nth-'+d+' ets-last"></div>\n\t            ',b+="\n\t    ";b+='\n\t\t</div>\n\t\t<div class="ets-act-sqi-originarea">\n\t\t\t';for(var c=a.content.sequences,d=1;d<=c.length;d++)!function(a){b+='\n\t\t<div class="ets-act-sqi-origin ets-nth-'+d+'">\n\t\t\t<div id="'+a._id+'" data-at-id="'+a._id+'" class="ets-act-sqi-item ets-nth-'+d+'">\n\t\t\t\t',a.image?b+='\n\t\t\t\t\t<img src="'+a.image.url+'" />\n\t\t\t\t':b+="\n\t\t\t\t\t\n\t\t\t\t",b+='\n\t\t\t\t<div class="ets-act-act-sqi-item-cover"></div>\n\t\t\t\t<i class="ets-icon-correct-s"></i>\n\t\t\t\t<i class="ets-icon-incorrect-s"></i>\n\t\t\t</div>\n\t\t</div>\n'}(c[d-1]);return b+="\n\t\t</div>\n\t</div>\n</div>\n"}}),define("school-ui-activity/activity/sequencing-image/sequencing-image",["jquery","jquery.ui","jquery.ui.touch-punch","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./sequencing-image.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(){var a=this,b=this._json;if(!b)throw this.toString()+p;return this.html(f,b).tap(i.bind(a))}function i(){var a=this;k.call(a)}function j(a,b){return a.length===b.length&&a.length===a.filter(b).length}function k(){var b=this,c=this.$element;c.find(t).droppable({accept:u,hoverClass:B,over:function(b,c){var d=a(this);if(d.find(u).length>0){var e=d.find(u);(j(e,a(c.draggable))||e.hasClass(z))&&d.removeClass(B)}},out:function(){},drop:function(d,e){var f=a(this);if(f.find(u).length>0){var g=f.find(u);g.hasClass(z)||(a(c.find(r).find(y).filter(function(){return 0==a(this).html()})[0]).append(g),a(this).append(a(e.draggable).removeAttr("style").addClass(C)))}else a(this).append(a(e.draggable).removeAttr("style").addClass(C));l.call(b),m.call(b)}}),c.find(y).droppable({accept:u,drop:function(c,d){a(this).find(u).length>0||(a(this).append(a(d.draggable)),l.call(b),m.call(b))}}),c.find(u).draggable({cancel:v+", "+w,containment:s,activeClass:x,revert:!0,start:function(){a(this).addClass(D)},
stop:function(){a(this).removeAttr("style"),a(this).removeClass(D)}})}function l(){var a=this;this.$element.find(t+":empty").length<1?o.call(a):a._item.answered(!1)}function m(){this.$element.find(r).find(u).removeAttr("style").removeClass(C+" "+A)}function n(){var b=this,c=this.$element,d=c.find(q).find(w);a(c.find(r).find(y).filter(function(){return 0==a(this).html()})).each(function(b){a(this).append(d[b])}),m.call(b),b._item.answered(!1)}function o(){this._item.answered(!0)}var p=": json format is incorrect.",q=".ets-act-sqi-droparea",r=".ets-act-sqi-originarea",s=".ets-act-bd",t=".ets-act-sqi-droppable",u=".ets-act-sqi-item",v=".ets-correct",w=".ets-incorrect",x=".ets-active",y=".ets-act-sqi-origin",z="ets-correct",A="ets-incorrect",B="ets-hover",C="ets-dropped",D="ets-active",E={"sig/render":function(){return h.call(this)},"hub/activity/template/sqi/load":function(a){var b=this;return b._json=a.json,b._item=a.item,b._interacted=!1,b._super=a._super,b._item.instantFeedback(!1),b.signal("render")},"hub/activity/check/answer":function(){var a=this,b=!0,c=this.$element,d=c.find(q).find(u);a._json.scoring.sequences.forEach(function(a,c){var e=d.eq(c),f=a._id===e.attr("id");e.addClass(f?z:A),b=b&&f}),window.setTimeout(function(){n.call(a)},1500),a._super.publishInteraction(e.makeSequencingInteraction(b,"SeqImgId")).then(function(){b?(a._json.content._isCorrect=!0,a._item.answered(!0),a._item.completed(!0)):a._item.answered(!1)})}};return d.extend(g,E)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/main.html",[],function(){return function(a){return'<div class="et-act-sqi-wrap" data-weave="school-ui-activity/activity/sequencing-image/sequencing-image"></div>'}}),define("school-ui-activity/activity/sequencing-image/main",["jquery","when","../base/main","./sequencing-image","template!./main.html"],function(a,b,c,d,e){"use strict";function f(){}function g(){var a=this;if(a.$element){this._htmlPromise||(this._htmlPromise=this.html(e()));var b=this._json;return this._htmlPromise.then(function(){return a.publish(h,{item:a.items(),json:b,_super:a})})}}var h="activity/template/sqi/load",i={"sig/initialize":function(){this.length(1)},"sig/render":function(){return g.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(f,i)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical.html",[],function(){return function(a){var b='<div class="ets-act-spv">\n\t',a=a||{};a.references.aud&&(b+='\n\t<div class="ets-act-spv-side">\n\t\t<div class="ets-act-spv-side-bd">\n\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t       data-src="'+a.references.aud.url+'" type="audio/mpeg"\n\t\t\t\t       class="ets-ap"></audio>\n\t\t\t</div></div>\n\t\t</div>\n\t</div>\n\t'),b+='\n\t<div class="ets-act-spv-main">\n\t\t<div class="ets-act-spv-list-wrap">\n\t\t    <ul class="ets-act-spv-list">\n\t\t    ';for(var c=a.content.sequences,d=0;d<c.length;d++)!function(a){a.isLock?a.lockClass="ets-correct ets-locked":a.lockClass="",b+='\n\t\n\t\t\t\t<li id="'+a._id+'" data-at-id="'+a._id+'" class="ets-act-spv-item '+a.lockClass+'" data-position="'+a.position+'">\n\t\t\t\t\t<div class="ets-bd">'+a.item+'<div class="ets-bd-handle"></div><div class="ets-bd-correct"></div><div class="ets-bd-incorrect"></div><div class="ets-bd-lock"></div></div>\n\t\t\t\t\t<div class="ets-ft"></div>\n\t\t\t\t</li>\n'}(c[d]);return b+="\n\t\t    </ul>\n\t    </div>\n\t</div>\n</div>\n"}}),define("school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical",["jquery","jquery.ui","jquery.ui.touch-punch","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./sequencing-paragraph-vertical.html"],function(a,b,c,d,e,f){"use strict";function g(){}function h(){var a=this,b=this._json;if(!b)throw this.toString()+n;this.html(f,b).tap(i.bind(a))}function i(){var a=this,b=this.$element,c=b.find(v);if(!c)throw"Sequecing data not found";c.addClass(q),a.actLocked=!0,a._json.references.aud||l.call(a),j.call(a),k.call(a)}function j(){var b=this.$element,c=a(t),d=a(s);c.css("padding-top",(d.outerHeight()-75)/2),b.find(u).outerHeight()>=416&&b.find(u).addClass(r)}function k(){this.$element.find(v).find("p, span").removeAttr("style")}function l(){var b=this,c=this.$element;if(b.actLocked){c.find(v).removeClass(q),b.actLocked=!1,c.find(u).sortable({containment:z,cancel:w+", "+x+", "+y,axis:"y",placeholder:o,start:function(b,c){a(c.item).addClass(p);var d=a(this).data("ui-sortable");d.placeholder.outerHeight(d.currentItem.height()-10),a(x,this).each(function(){var b=a(this);b.data("pos",b.index())})},change:function(){var b=a(this),c=a(x,this).detach(),d=a("<li></li>").prependTo(this);c.each(function(){var c=a(this),d=c.data("pos");c.insertAfter(a("li",b).eq(d))}),d.remove()},update:function(){m.call(b)},stop:function(b,c){a(c.item).removeClass(p)}})}}function m(){this._item.answered(!0)}var n=": json format is incorrect.",o="ets-act-spv-list-placeholder",p="ets-active",q="ets-freezed",r="ets-scrollable",s=".ets-act-spv-main",t=".ets-act-spv-side",u=".ets-act-spv-list",v=".ets-act-spv-list > .ets-act-spv-item",w=".ets-locked",x=".ets-correct",y=".ets-incorrect",z=".ets-ui-acc-bd-main",A={"sig/render":function(){return h.call(this)},"hub/activity/template/spv/load":function(a){var b=this;return b._json=a.json,b._item=a.item,b._interacted=!1,b._super=a._super,b._item.instantFeedback(!1),b.signal("render")},"hub/activity/check/answer":function(){var a=this,b=!0,c=this.$element,d=c.find(v);a._json.scoring.sequences.forEach(function(a,c){var e=d.eq(c),f=a._id===e.attr("id");e.toggleClass("ets-correct",f),e.toggleClass("ets-incorrect",!f),b=b&&f}),b||window.setTimeout(function(){d.removeClass("ets-incorrect")},1500),a._super.publishInteraction(e.makeSequencingInteraction(b,"SeqParVerId")).then(function(){b?(a._json.content._isCorrect=!0,a._item.answered(!0),a._item.completed(!0)):a._item.answered(!1)})},"dom:.ets-ap/media/play":function(){l.call(this)},"dom:.ets-ap/media/playing":function(){l.call(this)}};return d.extend(g,A)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/main.html",[],function(){return function(a){return'<div class="et-act-spv-wrap" data-weave="school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical"></div>'}}),define("school-ui-activity/activity/sequencing-paragraph-vertical/main",["jquery","when","../base/main","./sequencing-paragraph-vertical","template!./main.html"],function(a,b,c,d,e){"use strict";function f(){}function g(){var a=this;if(a.$element){this._htmlPromise||(this._htmlPromise=this.html(e()));var b=this._json;return this._htmlPromise.then(function(){return a.publish(h,{item:a.items(),json:b,_super:a})})}}var h="activity/template/spv/load",i={"sig/initialize":function(){this.length(1)},"sig/render":function(){return g.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(f,i)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal.html",[],function(){return function(a){for(var b='<div class="ets-act-swh-droparea ets-cf">\n\t\n</div>\n\n<div class="ets-act-swh-originarea">\n\t',c=a.words,d=0;d<c.length;d++)!function(a){b+='\n\t\t<div class="ets-act-swh-strip" data-at-id="'+a._id+'">\n\t\t\t<div class="ets-l"></div>\n\t\t\t<div class="ets-c">'+a.txt+'</div>\n\t\t\t<div class="ets-r"></div>\n\t\t</div>\n'}(c[d]);return b+="\n</div>\n\n"}}),define("school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal",["jquery","jquery.ui","jquery.ui.touch-punch","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./sequencing-word-horizontal.html"],function(a,b,c,d,e,f,g){"use strict";function h(){}function i(){var a=this,b=a._phrase;if(!b)throw a.toString()+r;return a.html(g,b).tap(j.bind(a))}function j(){var a=this;l.call(a),p.call(a),k.call(a)}function k(){a(v).each(function(b,c){var d=a(c).find(".ets-l").outerWidth(),e=a(c).find(".ets-c").outerWidth(),f=a(c).find(".ets-r").outerWidth();a(c).css("width",d+e+f+1)})}function l(){var b=this,c=this.$element;c.find(t).sortable({cancel:w+","+x,containment:u,activeClass:y,connectWith:s,placeholder:B,tolerance:"pointer",start:function(){a(s).find(w).each(function(){var b=a(this);b.data("pos",b.index()+1)})},change:function(){var b=a(w,a(s)).detach(),c=a(G).prependTo(a(s));b.each(function(){var b=a(this),c=b.data("pos");b.insertAfter(a(v,a(s)).eq(parseInt(c)-1))}),c.remove()},stop:function(){m.call(b),n.call(b),k.call(b)}}),c.find(s).sortable({cancel:w+","+x,containment:u,activeClass:y,connectWith:t,placeholder:B,tolerance:"pointer",start:function(){a(w,this).each(function(){var b=a(this);b.data("pos",b.index()+1)})},change:function(){var b=a(this),c=a(w,this).detach(),d=a(G).prependTo(this);c.each(function(){var c=a(this),d=c.data("pos");c.insertAfter(a(v,b).eq(parseInt(d)-1))}),d.remove()},stop:function(){m.call(b),n.call(b),k.call(b)}})}function m(){var b=this,c=a(s).find(v);c.length>0&&(c.removeClass(C+" "+D).removeAttr("style"),c.first().addClass(C),b._item.answered(!1)),c.length===b._phrase.words.length&&(q.call(b),c.last().addClass(D))}function n(){var b=a(t).find(v);b.length>0&&b.removeClass([C,D,E,F].join(" ")).removeAttr("style")}function o(){var b=this,c=a(s).find(x).first().index(),d=a(s).find(v),e=[];c>=0&&(d.each(function(a,b){a>=c&&e.push(b)}),a(t).append(e),n.call(b),k.call(b))}function p(){var b=this;a(v).on("dblclick customdblclick",function(){var c=a(this);if(c.parent().hasClass(z))a(s).append(c),m.call(b);else if(c.parent().hasClass(A)){if(c.hasClass(E))return;a(t).append(c),n.call(b),m.call(b)}k.call(b)}),a(v).on("touchstart",function(b){b.preventDefault();var c=a(this),d=c.data(H),e=(new Date).getTime();if(!d)return void c.data(H,e);e-d<=I?(c.trigger("customdblclick"),c.removeData(H)):c.data(H,e)})}function q(){this._item.answered(!0)}var r=": json format is incorrect.",s=".ets-act-swh-droparea",t=".ets-act-swh-originarea",u=".ets-act-bd",v=".ets-act-swh-strip",w=".ets-correct",x=".ets-incorrect",y=".ets-active",z="ets-act-swh-originarea",A="ets-act-swh-droparea",B="ets-act-swh-placeholder",C="ets-begin",D="ets-end",E="ets-correct",F="ets-incorrect",G="<div class='ets-act-swh-strip'></div>",H="_lastTouchDate",I=250,J={"sig/render":function(){return i.call(this)},"hub/activity/template/swh/load":function(a){var b=this;return b._json=a.json,b._index=a.index,b._phrase=b._json.content.phrases[b._index],b._item=a.item,b._interacted=!1,b._super=a._super,b._item.instantFeedback(!1),b.signal("render")},"hub/activity/check/answer":function(){var b=this,c=!0,d=this.$element,g=d.find(s).find(v),h=e.findById(b._json.scoring.phrases,b._phrase._id),i=h.blanks.map(function(a){return a.word.txt});g.each(function(b){var d=a(this),e=d.find(".ets-c").text(),f=i[b]===e;d.addClass(f?E:F),c=c&&f}),window.setTimeout(function(){o.call(b)},1500),b._super.publishInteraction(f.makeSequencingInteraction(c,b._phrase._id)).then(function(){c?(b._index===b._json.content.phrases.length-1&&(b._json.content._isCorrect=!0),b._item.answered(!0),b._item.completed(!0)):b._item.answered(!1)})}};return d.extend(h,J)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/main.html",[],function(){return function(a){var b='<div class="ets-act-swh ets-cf">\n\t',a=a||{};return a.references.aud&&(b+='\n\t<div class="ets-act-swh-audio">\n\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t       data-src="'+a.references.aud.url+'" type="audio/mpeg"\n\t\t\t       class="ets-ap"></audio>\n\t\t</div></div>\n\t</div>\n\t'),b+='\n\t\n\t<div class="et-act-swh-main" data-weave="school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal"></div>\n</div>'}}),define("school-ui-activity/activity/sequencing-word-horizontal/main",["jquery","../base/main","when","poly","underscore","./sequencing-word-horizontal","template!./main.html"],function(a,b,c,d,e,f,g){"use strict";function h(){}function i(){var a=this;if(a.publish("activity/step/render",a.index(),a.length()),a.$element)return a._htmlPromise||(a._htmlPromise=a.html(g,a._json)),a._htmlPromise.then(function(){return a.publish(k,{item:a.items(),index:a.index(),json:a._json,_super:a})})}function j(a){a.content.phrases.forEach(function(a){a.words&&(a.words=e.shuffle(a.words))})}var k="activity/template/swh/load",l={"sig/initialize":function(){var a=this;a.length(a._json.content.phrases.length),j.call(a,this._json)},"sig/render":function(){return i.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?c.resolve():(this.index(this.index()+1),this.signal("render"))}};return b.extend(h,l)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical.html",[],function(){return function(a){var b='<div class="ets-act-swv">\n\t',a=a||{};a.references.aud&&(b+='\n\t<div class="ets-act-swv-side">\n\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t       data-src="'+a.references.aud.url+'" type="audio/mpeg"\n\t\t\t       class="ets-ap"></audio>\n\t\t</div></div>\n\t</div>\n\t'),b+='\n\t<div class="ets-act-swv-main">\n\t\t<div class="ets-act-swv-list-wrap">\n\t\t    <ul class="ets-act-swv-list">\n\t\t    ';for(var c=a.content.sequences,d=0;d<c.length;d++)!function(a){a.isLock?a.lockClass="ets-correct ets-locked":a.lockClass="",b+='\n\t\t\t\t<li id="'+a._id+'" data-at-id="'+a._id+'" class="ets-act-swv-item '+a.lockClass+'" data-position="'+a.position+'">\n\t\t\t\t\t<div class="ets-bd">'+a.item+"</div>\n\t\t\t\t</li>\n"}(c[d]);return b+='\n\t\t    </ul>\n\t    </div>\n\t    <div class="ets-act-swv-label">\n\t\t\t<div class="ets-arrow">\n\t\t\t\t<div class="ets-bd"></div>\n\t\t\t</div>\n\t\t\t<div class="ets-label">\n\t\t\t\t<div class="ets-hd">'+a.content.labels.top+'</div>\n\t\t\t\t<div class="ets-ft">'+a.content.labels.bottom+"</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n"}}),define("school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical",["jquery","jquery.ui","jquery.ui.touch-punch","when","troopjs-ef/component/widget","school-ui-activity/util/interaction","template!./sequencing-word-vertical.html"],function(a,b,c,d,e,f,g){"use strict";function h(){}function i(){var a=this,b=this._json;return b||d.reject(new Error(this.toString()+n)),this.html(g,b).tap(j.bind(a))}function j(){var b=this,c=a(v);if(!c)throw"Sequecing data not found";c.addClass(o),b.actLocked=!0,b._json.references.aud||l.call(b),k.call(b)}function k(){var b=this.$element,c=a(s),d=a(t),e=b.find(A),f=b.find(t);c.css("padding-top",(d.outerHeight()-75)/2),e.css("height",f.outerHeight())}function l(){var b=this,c=this.$element;c.find(v).each(function(){a(this).hasClass(p)||a(this).removeClass(o)}),b.actLocked=!1,c.find(u).sortable({containment:z,cancel:w+", "+x+", "+y,axis:"y",placeholder:q,start:function(b,c){a(c.item).addClass(r);var d=a(this).data("ui-sortable");d.placeholder.outerHeight(d.currentItem.height()-10),a(x,this).each(function(){var b=a(this);b.data("pos",b.index())})},change:function(){var b=a(this),c=a(x,this).detach(),d=a("<li></li>").prependTo(this);c.each(function(){var c=a(this),d=c.data("pos");c.insertAfter(a("li",b).eq(d))}),d.remove()},update:function(){m.call(b)},stop:function(b,c){a(c.item).removeClass(r)}})}function m(){this._item.answered(!0)}var n=": json format is incorrect.",o="ets-locked",p="ets-correct",q="ets-act-swv-list-placeholder",r="ets-active",s=".ets-act-swv-side",t=".ets-act-swv-main",u=".ets-act-swv-list",v=".ets-act-swv-list > .ets-act-swv-item",w=".ets-act-swv-item.ets-locked",x=".ets-act-swv-item.ets-correct",y=".ets-act-swv-item.ets-incorrect",z=".ets-ui-acc-bd-main",A=".ets-act-swv-label",B={"sig/render":function(){return i.call(this)},"hub/activity/template/swv/load":function(a){var b=this;return b._json=a.json,b._item=a.item,b._interacted=!1,b._super=a._super,b._item.instantFeedback(!1),b.signal("render")},"hub/activity/check/answer":function(){var a=this,b=!0,c=this.$element,d=c.find(v);a._json.scoring.sequences.forEach(function(a,c){var e=d.eq(c),f=a._id===e.attr("id");e.toggleClass(p,f),e.toggleClass("ets-incorrect",!f),b=b&&f}),b||window.setTimeout(function(){d.removeClass("ets-incorrect")},1500),a._super.publishInteraction(f.makeSequencingInteraction(b,"SeqWordVerId")).then(function(){b?(a._json.content._isCorrect=!0,a._item.answered(!0),a._item.completed(!0)):a._item.answered(!1)})},"dom:.ets-ap/media/play":function(){l.call(this)}};return e.extend(h,B)}),define("troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/main.html",[],function(){return function(a){return'<div class="et-act-swv-wrap" data-weave="school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical"></div>'}}),define("school-ui-activity/activity/sequencing-word-vertical/main",["jquery","when","../base/main","./sequencing-word-vertical","template!./main.html"],function(a,b,c,d,e){"use strict";function f(){}function g(){var a=this;if(a.$element){this._htmlPromise||(this._htmlPromise=this.html(e()));var b=this._json;return this._htmlPromise.then(function(){return a.publish(h,{item:a.items(),json:b,_super:a})})}}var h="activity/template/swv/load",i={"sig/initialize":function(){this.hasScoring||this.type(c.ACT_TYPE.PRACTICE),this.type()==c.ACT_TYPE.PRACTICE&&this.items().answered(!0),this.length(1)},"sig/render":function(){return g.call(this)},"sig/finalize":function(){this._htmlPromise=null},nextStep:function(){return this.index()>=this.length()-1?b.resolve():(this.index(this.index()+1),this.signal("render"))},_onAnswerChecked:function(){}};return c.extend(f,i)}),define("troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/choose-picture/main.html",[],function(){return function(a){var b="",c=a.content.stockImages;b+='\n<div class="ets-create-profile">\n    <div class="ets-images-area">\n\n        <div class="ets-tooltip" data-weave="school-ui-activity/shared/tooltip/main">\n            \x3c!-- TODO: should from authoring tool --\x3e\n            <span>'+a.content.descriptionTips+'</span>\n        </div>\n\n\n        <div class="ets-tooltip ets-tooltip-error" data-weave="school-ui-activity/shared/tooltip/main">\n        </div>\n\n        <div class="ets-gallery">\n            <ul class="ets-cf">\n                ';for(var d=0;d<c.length;d++)b+='\n                <li>\n                    <a href="#" class="ets-gallery-item">\n                        <img src="'+c[d].url+'">\n                        <span class="ets-shadow"></span>\n                    </a> \n                </li>\n                ';return b+='\n            </ul>\n        </div>\n\n        <div class="ets-uploading">\n            <div class="ets-progress">\n                <div class="ets-progress-bg">\n                    <div class="ets-current-progress"></div>\n                </div>\n            </div>\n            <p data-blurb-id="443582" data-weave="troopjs-ef/blurb/widget" data-text-en="Uploading"></p>\n        </div>\n\n    \n        <div class="ets-reupload">\n            <form action="#" method="POST" enctype="multipart/form-data">\n                ',a.isiPad||(b+='\n                <div>\n                    <div class="ets-btn ets-btn-blue ets-btn-shadowed">\n                        <span data-blurb-id="467433" data-weave="troopjs-ef/blurb/widget" data-text-en="Upload another picture"></span>\n                        <input type="file" name="UploadImage" class="ets-file"/>\n                    </div>\n                </div>\n                '),b+='\n                <div>\n                    <div class="ets-btn ets-btn-white ets-btn-shadowed ets-select-library">\n                        <span data-blurb-id="443595" data-weave="troopjs-ef/blurb/widget"  data-text-en="Select a picture from library"></span>\n                    </div>\n                </div>\n            </form>\n        </div>\n\n        ',!a.isiPad&&a.enableUpload&&(b+='\n        <div class="ets-upload">\n            <form action="#" method="POST" enctype="multipart/form-data">\n                <span data-blurb-id="462924" data-weave="troopjs-ef/blurb/widget" data-text-en="or">or</span> \n                <span class="upload-btn">\n                    <a href="#"><span data-blurb-id="467429" data-weave="troopjs-ef/blurb/widget" data-text-en="upload your own picture"></span><input type="file" name="UploadImage" class="ets-file"/></a>\n                </span>\n            </form>\n        </div>\n        '),b+="\n    </div>\n    \n</div>"}}),define("school-ui-activity/activity/sharing-pic-desc/choose-picture/main",["jquery","poly","when","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","template!./main.html","school-ui-shared/utils/typeid-parser","jquery.form","jquery.ui"],function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a){case 800:return H[E];case 900:return H[F]+" 80px*80px";case 500:return H[D];case 406:return H[G];case 403:case 404:default:return H[D]}}function i(){this[s].removeClass(z).toggleClass(y)}function j(){this[s].removeClass(y).toggleClass(z)}function k(a){var b=this;b[s].find(v).hide(),b[s].find(w).show().find(x).text(a)}function l(){var a=this;a[s].find(v).show(),a[s].find(w).hide()}function m(b){var c=this,d=a(b.target);a(b.target).val()&&d.closest("form").ajaxSubmit({url:B.UPLOAD,dataType:"JSON",data:{ActivityId:c._ActivityId,StudentId:c._StudentId,CultureCode:c._cultureCode},beforeSend:function(){l.call(c),i.call(c),A&&n(c.$currentProgress)},uploadProgress:function(a,b,d,e){c.$currentProgress.width(e+"%")},success:function(a){switch(A&&o(c.$currentProgress),a.Status){case 200:i.call(c),c.publish(C,{url:a.ImagePath,isLibrary:!1,cropped:!1,from:"choose-picture"});break;case 800:case 900:case 500:case 406:case 403:case 404:k.call(c,h(a.Status)),j.call(c)}d.closest("form")[0].reset()},error:function(a){switch(a.status){case 504:case 413:case 0:var b=H[E]+" 1024KB";k.call(c,b);break;default:k.call(c,H[D])}j.call(c),d.closest("form")[0].reset()}})}function n(a){a.animate({left:"-10px"},function(){a.css({left:0}),n(a)})}function o(a){a.stop(!0,!0)}function p(){var b=this,c=H,d=Object.keys(H);return b.query(d).spread(function(){a.each(arguments,function(a,b){var d=b&&b.translation;d&&(c[b.id]=d)})})}function q(){var b=this;return c.resolve().then(function(){return b.query('ccl!"school.sharingTemplate.upload.enable"').spread(function(a){b._json.enableUpload=a&&"true"===a.value}).otherwise(function(){})}).then(function(){return b.html(f,b._json).then(function(){b.$upload=b[s].find(t),b.$upload.each(function(){a(this).on("change",a.proxy(m,b))}),b.$currentProgress=b[s].find(u)})})}function r(a,b,c){var d=this,e=/ipad/gi.test(navigator.userAgent);d._json=c,d._json.isiPad=e,d._cultureCode="en",p.call(d)}var s="$element",t='input[type="file"]',u=".ets-current-progress",v=".ets-tooltip:not(.ets-tooltip-error)",w=".ets-tooltip-error",x=".ets-tooltip-content",y="ets-show-uploading",z="ets-show-reupload",A="msie"===e.browser,B={UPLOAD:"/services/schoolupload/SharingPictureDescr/UploadHandler.ashx?NeatUpload_PostBackID="+(new Date).getTime()},C="activity/sharing-pic-desc/show/describe-srceen",D="blurb!467616",E="blurb!467614",F="blurb!467613",G="blurb!467618",H={};H[D]="Upload file error: An unexpected error occurred. Please try it again or later!",H[E]="Upload file error: The image size is too big, please select image no more than:",H[F]="The image is too small. The minimum dimension is",H[E]="The file you have uploaded is not supported. Please upload an image of the type JPG, GIF or PNG.";var I={"sig/initialize":function(){var a=this;return q.call(a)},"hub:memory/context":function(a){var b=this;b._cultureCode=a.cultureCode,b._StudentId=g.parseId(a.user.id)},"hub:memory/start/load/activity":function(a){this._ActivityId=g.parseId(a.id)},"dom:.ets-gallery-item/click":function(b){b.preventDefault();var c=this,d=a(b.currentTarget).find("img").attr("src");c.publish(C,{url:d,isLibrary:!0,from:"choose-picture"})},"dom:.ets-select-library/click":function(a){a.preventDefault();var b=this;j.call(b),l.call(b)}};return d.extend(r,I)}),define("troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/describe/main.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};return b+='\n<div class="ets-act-st ets-cf">\n    <div class="ets-create-profile">\n        <div class="ets-profile-image">\n            <div class="ets-tooltip ets-tooltip-error" data-weave="school-ui-activity/shared/tooltip/main">\n            </div>\n\n            <div class="ets-corp-area" >\n                <img src="">\n            </div>\n            <div class="ets-btn-change">\n                <div class="ets-btn ets-btn-white ets-btn-shadowed ets-btn-change-button">\n                    <span '+c(467430,"Change Picture")+'></span>\n                </div>\n            </div>\n            <div class="ets-edit-entry ets-none">\n                <div class="ets-btn ets-btn-white ets-btn-shadowed ets-edit-entry-button">\n                    <span '+c(467434,"Edit your entry")+' ></span>\n                </div>\n            </div>\n        </div>\n        <div class="ets-describe-area ets-none">\n            <div class="ets-tooltip ets-none" data-weave="school-ui-activity/shared/tooltip/main">\n                <span>'+a.content.pickImgTips+'</span>\n            </div>\n\n            <textarea id="input-describe" cols="30" rows="10" data-weave="school-ui-activity/shared/textchange/main"></textarea>\n             \n            <div class="share-info">\n                <label for="agree-share" data-weave="school-ui-activity/shared/checkbox/main">\n                    <input type="checkbox" id="agree-share" name="agree-share" checked="checked">\n                    <i class="icon-people"></i> <span data-blurb-id="467432" data-weave="troopjs-ef/blurb/widget" data-text-en="Share my post with other students"></span>\n                </label>\n            </div>\n            <div class="ets-btn ets-btn-blue ets-btn-shadowed ets-disabled ets-describe-submit-button"\n                 data-action="submit">',b+='\n                <span data-blurb-id="462455" data-weave="troopjs-ef/blurb/widget" data-text-en="Submit"></span>\n            </div>\n        </div>\n    </div>\n</div>'}}),define("school-ui-activity/activity/sharing-pic-desc/describe/main",["jquery","poly","when","troopjs-utils/merge","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","template!./main.html","school-ui-shared/utils/typeid-parser","jquery.ui","jquery.ui.touch-punch","jquery.counter"],function(a,b,c,d,e,f,g,h){"use strict";function i(){this.$generalTooltip.addClass(U).removeClass(V).show().find(O).text(aa[_])}function j(){this.$generalTooltip.hide()}function k(a){this.$generalTooltip.addClass(V).removeClass(U).show().find(O).text(a)}function l(){this.$generalTooltip.addClass(V).removeClass(U).hide()}function m(){function a(){if(b.$previewImage.attr("src",c),b._json.isLibrary||b._json.cropped)return void b.$previewImage.css({width:"100%",height:"100%"});b.$previewImage.css("cursor","move");var a=b.$previewImage.width()-D,d=b.$previewImage.height()-E;b.$previewImage.draggable({drag:function(b,c){c.position.left>=0&&(c.position.left=0),c.position.top>=0&&(c.position.top=0),c.position.left<=-a&&(c.position.left=-a),c.position.top<=-d&&(c.position.top=-d)}})}var b=this,c=b._json.url,d=new Image;"msie"===f.browser?d.onreadystatechange=a:d.onload=a,d.src=c}function n(){var a=this;a.$previewImage.data("ui-draggable")&&a.$previewImage.draggable("destroy"),a.$previewImage.removeAttr("style")}function o(){var b=this;if(void 0!==b._json.describe){var c=b._json.describe.replace(/(<|(?:&lt;))/g,"$1 "),d=a("<div/>").html(c).text();b.$textarea.val(d.replace(/((<|(?:&lt;))\s)/g,"$2")),delete b._json.describe}void 0!==b._json.isPrivate&&b._json.isPrivate?(b.$agreeShare.parent("span").removeClass(W),b.$agreeShare.prop("checked",!1)):(b.$agreeShare.parent("span").addClass(W),b.$agreeShare.prop("checked",!0)),t.call(b,b.$textarea.val().length),b.$describeArea.show("slide",{direction:"left"},"normal",function(){b.$textarea.focus(),b.$textareaTooltip.hasClass(X)?b.$textareaTooltip.css("top",-1*b.$textareaTooltip.height()).show():b.$textareaTooltip.css("top",-1*(b.$textareaTooltip.height()+10)).show()})}function p(){var a=this;return c.promise(function(b){a.$textareaTooltip.hide(),a.$describeArea.hide("slide",{direction:"left"},"slow",b)})}function q(b){function d(){n.call(e),e.$previewImage.attr("src",f).css({width:"100%",height:"100%"})}var e=this;if(e._json.isLibrary)return c.resolve().tap(d);var f=b,g=new Image;return g.src=f,c.promise(function(b){a(g).one("load",b)}).tap(d)}function r(){var a=this;return c.promise(function(b){a[C].find(L).animate({width:F,height:G},"normal",function(){a._isShrink=!0,b()}).find(Q).addClass(S)})}function s(){var b=this;return c.promise(function(c){b[C].find(L).animate({width:D,height:E},"normal",function(){b._isShrink=!1,a(this).find(Q).removeClass(S),b.$previewImage.css({width:"100%",height:"100%"}),c()})})}function t(a){var b=this;a?b.$submit.removeClass(T):b.$submit.addClass(T)}function u(b){var e=this,f=parseInt(e.$previewImage.css("left"),10)||0,g=parseInt(e.$previewImage.css("top"),10)||0,h=d.call({data:JSON.stringify({activity_id:e.activity_id,descr:a.trim(e.$textarea.val()),imagePath:e._json.url,isPrivate:!e.$agreeShare.prop("checked"),height:E,width:D,xAxis:-f,yAxis:-g,isFromLibrary:e._json.isLibrary})},e._saveAndCropImage);return e.publish("ajax",h).tap(l.bind(e)).then(function(a){e.publish(Z),a&&a[0].saveResult&&(b.imageUrl=a[0].cropedFileName),c.all([p.call(e),q.call(e,b.imageUrl)]).then(function(){e._noOthers?(i.call(e),e.$changePicture.addClass(S),e.$editEntry.removeClass(S)):r.call(e).then(function(){e.publish(Y,b)})})}).otherwise(function(){k.call(e,aa[$])})}function v(){var a=this;return a.html(g,a._content).tap(w.bind(a))}function w(){var a=this;a.$textarea=a[C].find(J),a.$textarea.counter({goal:200}),a.$submit=a[C].find(K),a.$describeArea=a[C].find(I),a.$previewImage=a[C].find(H),a.$textareaTooltip=a[C].find(M),a.$generalTooltip=a[C].find(N),a.$agreeShare=a[C].find(P),a.$editEntry=a[C].find(R),a.$changePicture=a[C].find(Q)}function x(){var a=this;a._json&&(m.call(a),o.call(a))}function y(){var a=this;s.call(a).then(o.bind(a))}function z(){var a=this;a.$changePicture.addClass(S),a.$editEntry.removeClass(S),m.call(a),i.call(a)}function A(){var b=this,c=aa,d=Object.keys(aa);return b.query(d).spread(function(){a.each(arguments,function(a,b){var d=b&&b.translation;d&&(c[b.id]=d)})})}function B(a,b,c){var d=this;d._isShrink=!1,d._json=null,d._content=c,A.call(d)}
var C="$element",D=310,E=310,F=110,G=110,H=".ets-corp-area img",I=".ets-describe-area",J="textarea",K=".ets-btn-blue",L=".ets-profile-image",M=".ets-describe-area .ets-tooltip",N=".ets-profile-image .ets-tooltip",O=".ets-tooltip-content",P="#agree-share",Q=".ets-btn-change",R=".ets-edit-entry",S="ets-none",T="ets-disabled",U="ets-tooltip-success",V="ets-tooltip-error",W="ets-checkbox-checked",X="ets-tooltip-ie8",Y="activity/sharing-pic-desc/show/picture-wall-screen",Z="activity/sharing-pic-desc/enable/next",$="blurb!467617",_="blurb!467615",aa={};aa["blurb!467616"]="Upload file error: An unexpected error occurred. Please try it again or later!",aa[$]="There is an unexpected error occured when save your entity. Please try it again or later!",aa[_]="Completed. Good job!";var ba={"sig/initialize":function(){return v.call(this)},"hub/activity/sharing-pic-desc/describe/reload":function(a){var b=this,c=b._noOthers&&a&&"choose-picture"!==a.from;b._json=a,b._isShrink?y.call(b):c?z.call(b):x.call(b)},"dom:.ets-btn-change-button/click":function(a){a.preventDefault();var b=this;b.$generalTooltip.hide();var d;d=b.$describeArea.is(":visible")?p.call(b):c.resolve(),d.then(function(){n.call(b),l.call(b),b.publish("activity/sharing-pic-desc/show/choose-picture-screen")})},"dom:.ets-edit-entry-button/click":function(){var a=this;a.$changePicture.removeClass(S),a.$editEntry.addClass(S),j.call(a),o.call(a)},"dom:#input-describe/EFTextChange":function(){var b=this,c=a.trim(b.$textarea.val()).length;c>190?b[C].find("#input-describe_counter").addClass("ets-warning"):b[C].find("#input-describe_counter").removeClass("ets-warning"),t.call(b,c)},"dom:.ets-describe-submit-button/click":function(a){a.preventDefault();var b=this;if(!b.$submit.hasClass(T)){var c={imageUrl:b.$previewImage.attr("src"),describe:b.$textarea.val(),isPrivate:!b.$agreeShare.prop("checked")};u.call(b,c)}},"dom:#input-describe/focusin":function(){this.$describeArea.addClass("ets-focus")},"dom:#input-describe/focusout":function(){this.$describeArea.removeClass("ets-focus")},"hub:memory/start/load/activity":function(a){this.activity_id=h.parseId(a.id)},"hub:memory/activity/sharing-pic-desc/describe/no/others":function(){this._noOthers=!0},"hub:memory/context":function(a){this._saveAndCropImage=a.api["action/sharingpicturedescr/SaveAndCropImage"]}};return e.extend(B,ba)}),define("troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/main.html",[],function(){return function(a){return'<div class="ets-act-st ets-cf">\n    <div class="ets-choose-picture-screen ets-none"></div>\n    <div class="ets-share-and-describe-screen ets-none"></div>\n    <div class="ets-picture-wall-screen ets-none" data-weave="school-ui-activity/activity/sharing-pic-desc/picture-wall/main"></div>\n</div>'}}),define("school-ui-activity/activity/sharing-pic-desc/main",["jquery","when","../base/main","template!./main.html"],function(a,b,c,d){"use strict";function e(a,b,c){var d=this;d[h].find(a).removeClass(n).siblings().addClass(n),b&&d.publish(b,c)}function f(){var a=this;return a.html(d,a._json).tap(g.bind(a))}function g(){var a=this;b.resolve().then(function(){return a[h].find(k).data("json",a._json).attr("data-weave",i+"(json)").weave()}).then(function(){return a[h].find(l).data("json",a._json).attr("data-weave",j+"(json)").weave()}).then(function(){a.hasPassed?(e.call(a,m,o),a.publish(p)):e.call(a,k)})}var h="$element",i="school-ui-activity/activity/sharing-pic-desc/choose-picture/main",j="school-ui-activity/activity/sharing-pic-desc/describe/main",k=".ets-choose-picture-screen",l=".ets-share-and-describe-screen",m=".ets-picture-wall-screen",n="ets-none",o="activity/sharing-pic-desc/picture-wall/reload",p="activity/sharing-pic-desc/enable/next",q={"sig/render":function(){return f.call(this)},"hub/activity/sharing-pic-desc/show/describe-srceen":function(a){var b=this;e.call(b,l,"activity/sharing-pic-desc/describe/reload",a)},"hub/activity/sharing-pic-desc/show/choose-picture-screen":function(){var a=this;e.call(a,k)},"hub/activity/sharing-pic-desc/show/picture-wall-screen":function(a){var b=this;e.call(b,m,o,a)},"hub/activity/sharing-pic-desc/enable/next":function(){this.items().completed(!0)}};return c.extend(q)}),define("troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/picture-wall/main.html",[],function(){return function(a){function b(b,c){return c.indexOf("http:")<0&&(c=(b?a.cacheServer:a.uploadCacheServer)+c),c}var c,d="",e=a.others,f=a.myself;d+='\n<ul class="ets-profile-wall ets-cf">\n    ';for(var g=0,h=e.length;g<h;g++)c=b(e[g].isFromLibrary,e[g].imagePath),d+="\n    <li ",9===g&&(d+='class="ets-add-margin-right"'),d+='>\n        <a href="#" student-id="'+e[g].studentId+'" class="ets-profile-wall-item">\n            <img src="'+c+'">\n            <div class="ets-shadow"></div>\n        </a>\n\n        <div class="ets-tooltip ets-left-arrow" data-weave="school-ui-activity/shared/tooltip/main">\n            <p>'+e[g].descr+'</p>\n\n            <div class="ets-person-info">\n                <img src="'+e[g].avatar+'" width="40" height="40" alt="">\n                <div class="ets-info">\n                    <p class="ets-name">'+e[g].firstName+"</p>\n                    ",e[g].countryFlag&&(d+='\n                    <p class="ets-location">\n                        <img src="/_imgs/friends/flags/'+e[g].countryFlag+'.gif" width="16" height="11"/>\n                        <span>'+e[g].country+"</span>\n                    </p>\n                    "),d+="\n                </div>\n            </div>\n        </div>\n\n    </li>\n    ";d+="\n    ";for(var i=g;i<20;i++)d+='\n    <li class="ets-profile-placeholder ',9===i&&(d+="ets-add-margin-right"),d+='">\n        <a class="ets-profile-wall-item-placeholder">\n            <div class="ets-shadow"></div>\n        </a>\n    </li>\n    ';return d+='\n</ul>\n<div class="ets-profile-me">\n    <a href="#" class="ets-profile-wall-item">\n        <img src="',f&&f.imagePath&&(d+=b(f.isFromLibrary,f.imagePath)+"?"+(new Date).getTime()),d+='">\n        <div class="ets-shadow"></div>\n    </a>\n    \n    <div class="ets-tooltip ets-left-arrow" data-weave="school-ui-activity/shared/tooltip/main">\n        <p>',f&&f.descr&&(d+=""+f.descr),d+='</p>\n\n        <div class="ets-person-info">\n            <img src="'+f.avatar+'" width="40" height="40" alt="">\n                <div class="ets-info">\n                    <p class="ets-name">'+f.firstName+"</p>\n                    ",f.countryFlag&&(d+='\n                    <p class="ets-location">\n                        <img src="/_imgs/friends/flags/'+f.countryFlag+'.gif" width="16" height="11"/>\n                        <span>'+f.country+"</span>\n                    </p>\n                    "),d+='\n                </div>\n        </div>\n\n        <div class="ets-tooltip-btns">\n            <span class="ets-btn-small ets-btn-white ets-btn-shadow ets-profile-edit-button">\n                <span data-blurb-id="467434" data-text-en="Edit your entry"></span>\n            </span>\n        </div>\n    </div>\n</div>\n\n<div class="ets-msg-box">\n    <div class="ets-content">\n        <h3 data-blurb-id="467619" data-weave="troopjs-ef/blurb/widget" data-text-en="See what other students like"></h3>\n        <p data-blurb-id="467620" data-weave="troopjs-ef/blurb/widget" data-text-en="There are thousands of other students learning English at Englishtown. Take a minute to browse around and see what food the other students in the school like."></p>\n        <p data-blurb-id="467621" data-weave="troopjs-ef/blurb/widget" data-text-en="Click on the pictures to read their stories."></p>\n\n        <div class="ets-btn ets-btn-blue ets-btn-shadowed ets-msg-box-close-button">\n            <span data-blurb-id="462940" data-weave="troopjs-ef/blurb/widget" data-text-en="Close">\n            </span>\n        </div>\n    </div>\n</div>'}}),define("school-ui-activity/activity/sharing-pic-desc/picture-wall/main",["jquery","poly","when","troopjs-ef/component/widget","template!./main.html","school-ui-shared/utils/typeid-parser","jquery.ui"],function(a,b,c,d,e,f){"use strict";function g(){var a=this;return c.all([function(){return a._activityLoaded.promise.then(function(){var b="sharing_picture_descr!"+a.activity_id;return a.query(b)}).spread(function(a){return a})}(),function(){return a.query('ccl!"school.sharingTemplate.upload.cacheServer"').spread(function(a){return a})}()]).spread(function(b,d){if(!a[B])return c.reject();(!b||!b.pictureWall||b.pictureWall.length<3)&&a.publish(D),a._json.others=b.pictureWall,a._json.myself=b.studentSharing,a._json.uploadCacheServer=d.value})}function h(a){var b=this;return b[p].find(q+" a > img").attr("src",a.imageUrl),b[p].find([q,w].join(" ")).text(a.describe),b._json.myself.descr=a.describe,b._json.myself.isPrivate=a.isPrivate,b[p].find(q).hasClass(z)||j.call(b),c.resolve()}function i(){this[p].find(v).fadeOut("fast",function(){a(this).remove()})}function j(){this[p].find(s).trigger("click")}function k(){return this[p].addClass(y),c.resolve()}function l(){var a=this;a.publish(C,{url:a[p].find(r).attr("src"),isLibrary:a._json.myself.isFromLibrary,describe:a._json.myself.descr,isPrivate:a._json.myself.isPrivate,cropped:!0})}function m(){var b=this;return b.html(e,b._json).then(function(){b[p].find(".ets-tooltip-btns [data-blurb-id]").attr("data-weave","troopjs-ef/blurb/widget").weave(),b.$profileWall=b[p].find(t),a(document.body).on("click."+A,function(a){b.$profileWall.css("zIndex",""),b[p].find(q).removeClass(z),b[p].find(u).removeClass(z)})}).then(b._dfdRendered.resolve)}function n(){var a=this;a._json={},a.edge=a[p].closest(x).offset().left+980,a._contextLoaded=c.defer(),a._activityLoaded=c.defer(),a._dfdRendered=c.defer()}function o(b){var c=this,d=b.attr("student-id");c._contextLoaded.promise.then(function(){var b={visitor_id:c._json.myself.studentId,activity_id:c.activity_id,student_id:d,StudentId:c._StudentId};b.visitor_id&&b.activity_id&&b.student_id&&a.get("/services/school/social/SharingPictureDescr/picturevisit",b)})}var p="$element",q=".ets-profile-me",r=".ets-profile-me img",s=".ets-profile-me a",t=".ets-profile-wall",u=".ets-profile-wall li",v=".ets-msg-box",w=".ets-tooltip-content > p:eq(0)",x=".ets-act-st",y="ets-none",z="ets-on",A="ets-act-sharing-pic-desc",B="_started",C="activity/sharing-pic-desc/show/describe-srceen",D="activity/sharing-pic-desc/describe/no/others",E={"sig/start":function(){var a=this;return a[B]=!0,g.call(a).then(m.bind(a)),c.resolve()},"sig/stop":function(){this[B]=!1,a(document.body).off("click."+A)},"hub/activity/sharing-pic-desc/picture-wall/reload":function(a){var b=this;b._dfdRendered.promise.then(function(){b._json.others.length||(b[p].addClass(y),l.call(b)),a&&h.call(b,a)})},"hub/st/picture-wall/show/myself":function(){this.$element.find(s).trigger("click")},"hub:memory/context":function(a){var b=this;b._StudentId=f.parseId(a.user.id),b._json.cacheServer=a.cacheServer,b._contextLoaded.resolve()},"dom:.ets-profile-wall-item-placeholder/click":function(a){a.preventDefault()},"dom:.ets-profile-wall-item/click":function(b){b.preventDefault(),b.stopPropagation();var c=this,d=a(b.currentTarget),e=d.next(),f=!!d.closest(q).length,g=f?d.closest(q):d.closest("li");i.call(this),f?(g.toggleClass(z),c[p].find(u).removeClass(z)):(c.$profileWall.css("zIndex",2),g.siblings().removeClass(z).end().toggleClass(z),c[p].find(q).removeClass(z),o.call(c,d));var h=e.height(),j=e.width();e.css("margin-top",-h/2),c.edge-e.offset().left<j&&e.addClass("ets-right-arrow")},"dom:.ets-profile-edit-button/click":function(a){a.preventDefault(),a.stopPropagation();var b=this;k.call(b).then(l.bind(b))},"hub:memory/start/load/activity":function(a){this.activity_id=f.parseId(a.id),this._activityLoaded.resolve()},"dom:.ets-msg-box-close-button/click":function(a){a.preventDefault(),a.stopPropagation();var b=this;i.call(b),j.call(b)}};return d.extend(n,E)}),define("troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge-new/main.html",[],function(){return function(a){var b="",c=a.references&&a.references.aud&&a.references.aud.url,d=a.modelAud&&a.modelAud.url;return b+='\n<div class="gud text-center">\n\n    <div class="ets-act-spc-new ets-cf">\n\n        ',d&&(b+='\n            <div class="glyphicon glyphicon-volume-up active js-toggle">\n                <div class="tooltip-volume-up " data-weave="troopjs-ef/blurb/widget" data-blurb-id="655958">Listen to a model audio to what it sounds like</div>\n            </div>\n         '),b+='\n\n\n        <div class="ets-act-spc-l">\n\n            \n            <div class="ets-act-spc-content asr-output ets-act-disabled-'+Boolean(c)+'">\n                \x3c!-- asr component --\x3e\n                <div class="title"><strong data-weave="troopjs-ef/blurb/widget" data-blurb-id="655954">Record your Audio</strong></div>\n                <div class="ets-act-spc-asr">\n                    <div data-weave="school-ui-activity/shared/asr/asr-ui"></div>\n                    <div class="ets-tooltip">\n                        <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464924">\n                            Press to record\n                        </div>\n                    </div>\n                </div>\n\n                <div class="ets-act-record">\n                    <div class="ets-tooltip ets-tooltip-green">\n                        <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464925">\n                            Listen to your recording. You can record again or press DONE.\n                        </div>\n                    </div>\n                </div>\n\n                ',c&&(b+='\n                    <div class="icon-replay-audioin please-play" data-weave="troopjs-ef/blurb/widget" data-blurb-id="655956">Re-play Audio</div>\n                '),b+="\n            </div>\n\n            ",c&&(b+='\n                <div class="ets-act-spc-content audio-input">\n                    \x3c!-- audio-input component--\x3e\n                        <div class="title"><strong data-weave="troopjs-ef/blurb/widget" data-blurb-id="655957" >Listen to this audio</strong></div>\n\n                        <div class="swing-container">\n                            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                                   data-src="'+a.references.aud.url+'" class="ets-ap" type="audio/mpeg"\n                                   controls="controls"></audio>\n\n                           <div class="ets-tooltip">\n                                <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464923"></div>\n                            </div>\n\n                        </div>\n\n\n                </div>\n             '),b+='\n\n        </div>\n\n        <div class="ets-act-spc-r">\n\n        \n            ',d&&(b+='\n                <div class="glyphicon glyphicon-arrow-left active js-toggle"></div>\n\n                    \x3c!-- model-audio-input component--\x3e\n\n                <div class="ets-act-spc-content model-audio-input" >\n                    <div class="title"><strong data-weave="troopjs-ef/blurb/widget" data-blurb-id="655955">Model Audio</strong></div>\n\n                    <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                           data-src="'+a.modelAud.url+'" class="ets-ap" type="audio/mpeg"\n                           controls="controls"></audio>\n                </div>\n\n                \n            '),b+="\n\n         </div>\n\n    </div>\n</div>"}}),define("school-ui-activity/activity/speaking-challenge-new/main",["jquery","poly","school-ui-activity/activity/base/main","template!./main.html","school-ui-shared/enum/rating-source-type"],function(a,b,c,d,f){"use strict";function g(){for(var a=this,b=0,c=arguments.length;b<c;++b)arguments[b][0].call(a,arguments[b][1])}function h(a){var b=this,c=b[C][a];return c||(c=b[B].find(a),c.length>0&&(b[C][a]=c),c)}function i(){var a=this;a.publish(R,function(b,c){t.call(a,c)},{prons:"",autostopTime:18e4,disableScoreRecording:!0,playback:!1},{asrFailCb:function(){a._json.content={},a._json.content[V]=!0,a.completed(!0)}})}function j(a){var b=this,c=h.call(b,[M,I].join(" "));0!==c.length&&(a&&!b._isOpen?c.fadeIn():c.fadeOut())}function k(a){var b=this,c=h.call(b,G);0!==c.length&&(a?(c.removeClass("mejs-disabled"),c.find(".mejs-playpause-button").children().prop("disabled",!1)):(c.addClass("mejs-disabled"),c.find(".mejs-playpause-button").children().prop("disabled",!0)))}function l(a){var b=this,c=h.call(b,[F,I].join(" "));0!==c.length&&(a?c.fadeIn():c.fadeOut())}function m(a){var b=this,c=h.call(b,".tooltip-volume-up");0!==c.length&&(a?c.delay(500).fadeIn():c.delay(500).fadeOut())}function n(a){var b=this,c=h.call(b,".icon-replay-audioin");0!==c.length&&(a?c.addClass("please-pause"):c.removeClass("please-pause"))}function o(a){var b=this,c=h.call(b,".icon-replay-audioin");0!==c.length&&(a?c.removeClass("status-disabled"):c.addClass("status-disabled"))}function p(a){var b=this,c=h.call(b,J);0!==c.length&&(a?c.fadeIn():c.fadeOut())}function q(a){var b=this,c=h.call(b,F);0!==c.length&&(a.animate({"margin-left":-72,opacity:1},"slow",function(){p.call(b,!0),setTimeout(function(){p.call(b,!1)},5e3),c.css({"z-index":"auto"})}),c.animate({"margin-left":-15},"slow"))}function r(b){var c=this,d=h.call(c,H),e=h.call(c,F);0!==d.length&&0!==e.length&&(d.animate({"margin-left":-41,opacity:.5},"slow",function(){a(this).children("."+P).remove(),c._hasRecord=!1,t.call(c,b)}),e.css({"z-index":1}).animate({"margin-left":-38},"slow"))}function s(a){var b=this,c=h.call(b,H);if(0!==c.length){c.prepend('<div class="'+P+'"></div>');var d=b[B].find("."+P);d.unweave().then(function(){return d.data("option",{_playHandler:function(){b.publish(T),p.call(b,!1),o.call(b,!1),k.call(b,!1)},_pauseHandler:function(){b.publish(S),o.call(b,!0)},guid:a}).attr("data-weave",U+"(option)").weave()}).then(function(){q.call(b,c),b._hasRecord=!0,b.items().answered(!0)})}}function t(a){this._hasRecord?r.call(this,a):s.call(this,a)}function u(){var a=this,b=h.call(a,M),c=h.call(a,O);0!==b.length&&0!==c.length&&(b.find(".title").fadeOut(),8===v()?b.find(".swing-container").fadeOut(800):(b.find(".swing-container").hide(800),b.find("button").addClass("transform")),c.show({duration:800,easing:"linear"}))}function v(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("msie")&&parseInt(a.split("msie")[1])}function w(a){var b=this,c=h.call(b,L);0!==c.length&&(a?c.addClass("active"):c.removeClass("active"))}function x(){var a=this;return a[C]={},a.html(d,a._json).tap(z.bind(a))}function y(a){var b=this;b.publish("asr/ui/states/changed",a);var c=h.call(b,[H,K].join(" "));0!==c.length&&("DISABLE"===a?(c.addClass(Q),p.call(b,!1)):c.removeClass(Q))}function z(){var a=this,b=a[B].find(N).find(G);b.find(".mejs-volume-button").remove(),b.find(".mejs-horizontal-volume-slider").remove();var c=a[B].find(M).find(G);c.find(".mejs-time").remove(),c.find(".mejs-time-rail").remove(),c.find(".mejs-volume-button").remove(),c.find(".mejs-horizontal-volume-slider").remove(),i.call(a)}function A(){var a=this;a.type(2),a._hasRecord=!1,a._isOpen=!1,a._state="",a[C]={},a[D]=null,a[E]=null}var B="$element",C="_elementsCache",D="_audioState",E="_audioState",F=".ets-act-spc-asr",G=".mejs-container",H=".ets-act-record",I=".ets-tooltip",J=".ets-tooltip-green",K=".ets-ap",L=".glyphicon-volume-up",M=".audio-input",N=".model-audio-input",O=".asr-output",P="ets-ap-con",Q="ets-disabled",R="asr/ui/setting",S="asr/stopPlayback",T="asr/startPlayback",U="school-ui-activity/shared/audio/audio-shell",V="_isCorrect",W={"sig/render":function(){return x.call(this)},"sig/stop":function(){var a=this;a[C]={};var b=a[B].find("."+P);return a.publish(S),b.unweave()},"hub/asr/ui/states/changed":function(a){var b=this;b._state=a,"PREPARING"===a&&g.call(b,[p,!1],[l,!1],[o,!1]),"WARNING"!==a&&"ERROR"!==a&&"DOWN"!==a||l.call(b,!1),"RECORDING"===a&&k.call(b,!1),"PROCESSING"===a&&o.call(b,!0),"PREPARING"!==a&&"DISABLE"!==a||w.call(b,!1),"NORMAL"===a&&g.call(b,[k,!0],[o,!0],[w,!0])},"hub/activity/epaper/expanding":function(){var a=this;g.call(a,[w,!1],[l,!1],[m,!1])},"hub/activity/epaper/folding":function(){var a=this;g.call(a,[w,!0],[m,!0],[p,!1]),"RECORDING"!==a._state&&l.call(this,!0)},"hub/rating/sourceType":function(){return[f.ASR_SPEAKING]},"hub/audio/shell/play/complete":function(){var a=this;o.call(a,!0)},"dom:.js-toggle/click":function(b){var c=this;if(a(b.currentTarget).hasClass("active")){var d=h.call(this,[N,K].join(" "));h.call(c,".ets-act-spc-r").animate({"margin-left":c._isOpen?0:453},{duration:"slow",complete:function(){c._isOpen=!c._isOpen,c._isOpen?(d.trigger("player/play"),j.call(c,!1)):("RECORDING"!==c._state&&d.trigger("player/pause"),j.call(c,!0)),m.call(c,!c._isOpen)}})}},"dom:.icon-replay-audioin/click":function(b){var c=a(b.currentTarget);if(!c.hasClass("status-disabled")){var d=h.call(this,[M,K].join(" "));c.hasClass("please-pause")?d.trigger("player/pause"):d.trigger("player/play")}},"dom:.model-audio-input .ets-ap/media/play":function(a){var b=this;b[E]=e.type,g.call(b,[y,"DISABLE"],[l,!1],[p,!1])},"dom:.model-audio-input .ets-ap/media/pause":function(a){var b=this;b[E]=e.type,y.call(b,"NORMAL"),setTimeout(function(){l.call(b,"play"!==b[D])},0)},"dom:.model-audio-input .ets-ap/media/ended":function(a){var b=this;b[E]=e.type,g.call(b,[y,"NORMAL"],[l,!0])},"dom:.audio-input .ets-ap/media/play":function(a){var b=this;b[D]=a.type,g.call(b,[y,"DISABLE"],[w,!1],[m,!1],[l,!1],[n,!0],[j,!1])},"dom:.audio-input .ets-ap/media/pause":function(a){var b=this;b[D]=a.type,g.call(b,[y,"NORMAL"],[w,!0],[m,!0],[n,!1]),setTimeout(function(){j.call(b,"ended"!==b[D])},0),setTimeout(function(){l.call(b,"play"!==b[E])},0)},"dom:.audio-input .ets-ap/media/ended":function(a){var b=this;b[D]=a.type,g.call(b,[y,"NORMAL"],[l,!0],[w,!0],[m,!0],[n,!1],[j,!1],[u,null])}};return c.extend(A,W)}),define("troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge/main.html",[],function(){return function(a){var b='<div class="ets-act-spc ets-cf">\n    ';return a.references.aud&&(b+='\n    <div class="ets-act-spc-l">\n        <div class="ets-act-spc-content">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" class="ets-ap" type="audio/mpeg"\n                   controls="controls"></audio>\n\n            <div class="ets-tooltip">\n                <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464923">\n                    First, you listen to the dailog\n                </div>\n            </div>\n        </div>\n    </div>\n    '),b+='\n    <div class="ets-act-spc-r">\n\n        <div class="ets-act-spc-content">\n            \x3c!-- asr component --\x3e\n            <div class="ets-act-spc-asr">\n                <div data-weave="school-ui-activity/shared/asr/asr-ui"></div>\n                <div class="ets-tooltip">\n                    <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464924">\n                        Press to record\n                    </div>\n                </div>\n            </div>\n\n            <div class="ets-act-record">\n                <div class="ets-tooltip ets-tooltip-green">\n                    <div class="ets-tooltip-content" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464925">\n                        Listen to your recording. You can record again or press DONE.\n                    </div>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n</div>'}}),define("school-ui-activity/activity/speaking-challenge/main",["jquery","poly","school-ui-activity/activity/base/main","template!./main.html","school-ui-shared/enum/rating-source-type"],function(a,b,c,d,e){"use strict";function f(){var a=this;a.publish(B,function(b,c){o.call(a,c)},{prons:"",autostopTime:18e4,disableScoreRecording:!0,playback:!1},{asrFailCb:function(){a._json.content={},a._json.content[F]=!0,a.completed(!0)}})}function g(){var a=this;a._timer=window.setTimeout(function(){a[s].find([t,y].join(" ")).fadeOut()},5e3)}function h(){this.$recordTooltip.delay(5e3).fadeOut()}function i(){!this._ASRTooltip&&this.$asrTooltip&&(this.$asrTooltip.css("display","block"),j.call(this),this._ASRTooltip=!0)}function j(){this.$asrTooltip.delay(5e3).fadeOut()}function k(){var b=this;b._ASRShowed||b[s].find(u).delay(1e3).animate({"margin-left":110},"slow",function(){a(this).css("z-index",2),j.call(b)})}function l(a){var b=this;a.animate({"margin-left":8},"slow",function(){b[s].find(z).fadeIn(),h.call(b),b.$asr.css({"z-index":"auto"})}),b.$asr.animate({"margin-left":-61},"slow")}function m(b){var c=this;c.$record.animate({"margin-left":-27},"slow",function(){a(this).children("."+A).remove(),c._hasRecord=!1,o.call(c,b)}),c.$asr.css({"z-index":1}).animate({"margin-left":-38},"slow")}function n(a){var b=this;b.$record.prepend('<div class="'+A+'"></div>');var c=b[s].find("."+A);c.unweave().then(function(){return c.data("option",{_playHandler:function(){b.publish(D),b[s].find(z).fadeOut()},_pauseHandler:function(){b.publish(C)},guid:a}).attr("data-weave",E+"(option)").weave().then(function(){l.call(b,b.$record),b._hasRecord=!0,b.items().answered(!0)})})}function o(a){this._hasRecord?m.call(this,a):n.call(this,a)}function p(){var a=this;return a.html(d,a._json).tap(q.bind(a))}function q(){var a=this,b=a[s].find(w);a._interval=window.setInterval(function(){b.is(":visible")&&(g.call(a),window.clearInterval(a._interval))},4),b.find(".mejs-time").remove(),b.find(".mejs-time-rail").remove(),b.find(".mejs-volume-button").remove(),b.find(".mejs-horizontal-volume-slider").remove(),f.call(a),a.$record=a[s].find(x),a.$asr=a[s].find(v),a.$asrTooltip=a[s].find([v,y].join(" ")),a.$recordTooltip=a[s].find(z)}function r(){var a=this;a.type(3),a._ASRShowed=!1,a._hasRecord=!1,a._ASRTooltip=!1}var s="$element",t=".ets-act-spc-l",u=".ets-act-spc-r",v=".ets-act-spc-asr",w=".mejs-container",x=".ets-act-record",y=".ets-tooltip",z=".ets-tooltip-green",A="ets-ap-con",B="asr/ui/setting",C="asr/stopPlayback",D="asr/startPlayback",E="school-ui-activity/shared/audio/audio-shell",F="_isCorrect",G={"sig/render":function(){return p.call(this)},"sig/finalize":function(){var a=this;window.clearTimeout(a._timer),window.clearInterval(a._interval)},"sig/stop":function(){var a=this,b=a[s].find("."+A);return a.publish(C),b.unweave()},"hub/asr/ui/states/changed":function(a){var b=this;"PREPARING"===a&&(b.$asr.find(y).fadeOut(),b.$asrTooltip.hide(),b.$recordTooltip.hide(),b._ASRTooltip=!0)},"hub/activity/epaper/expanding":function(){i.call(this)},"hub/rating/sourceType":function(){return[e.ASR_SPEAKING]},"dom:.ets-ap/media/play":function(){this[s].find([t,y].join(" ")).fadeOut(),k.call(this)},"dom:.ets-ap/media/pause":function(){i.call(this)},"dom:.ets-ap/media/ended":function(){i.call(this)}};return c.extend(r,G)}),define("school-ui-activity/activity/text-select/const",{SLASH:"/",DOUBLE_SLASH:"//"}),define("troopjs-requirejs/template!school-ui-activity/activity/text-select/main.html",[],function(){return function(a){var b="",c=a,d=c.hasSharedAudio;c.weaver;return b+='\n\n<div class="ets-act-tsl">\n    <div class="ets-act-tsl-main">\n        ',d&&(b+='\n        <div class="ets-act-tsl-audio ets-shared">\n            <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n                <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                       data-src="'+c.ref.aud.url+'" type="audio/mpeg"\n                       class="ets-ap"></audio>\n            </div></div>\n        </div>\n        '),b+='\n        <div class="ets-act-tsl-view" data-weave="school-ui-activity/activity/text-select/text-select"></div>\n    </div>\n    ',c.isMultiType&&c.isGradeMode&&(b+='\n    <div class="ets-act-tsl-ft'+(d?" ets-shrink":"")+'">\n        <div class="ets-act-tpg-b" data-weave="school-ui-activity/shared/toggle-slide/main"></div>\n        <div class="ets-ar" data-at-id="pnl-answer-remaining" data-weave="school-ui-activity/shared/rolling-number/main"></div>\n        <div class="ets-cf"></div>\n    </div>\n    '),b+="\n</div>"}}),define("school-ui-activity/activity/text-select/main",["jquery","poly","when","school-ui-activity/activity/base/main","troopjs-core/component/factory","template!./main.html","./const"],function(a,b,c,d,e,f,g){"use strict";function h(b){if(!b)return l;var c=m;return a.each(b.phrases||[],function(a,b){if((b.items||[]).length>1)return c=l,!1}),c}function i(b,c){function d(a){return+(""+a).split("_")[2]}var e=n;if(!b||!b.phrases||!b.phrases.length)return e;for(var f=b.phrases[0]||{},g=f.items||[],h=[g[0]._id],i=1;i<g.length;i++){var l=g[i-1]._id,m=g[i]._id;if(d(m)-d(l)!=1)break;h.push(m)}return a.each(c||[],function(b,c){if(c._id===f._id){var d=c.items,g=0;return a.each(d||[],function(a,b){var c=b.txt||"";if(b._id===h[g]){if((d[a-1]||{}).txt===j||(d[a+1]||{}).txt===j||c!==j&&c!==k&&c.indexOf(j)>=0)return e=o,!1;if(++g>=h.length)return!1}}),!1}}),e}var j=g.SLASH,k=g.DOUBLE_SLASH,l="multiple",m="single",n="any",o="some";return d.extend({"sig/initialize":function(){var a=this,b=a._json||{},c=b.references,e=b.filterOptions,f=b.scoring,g=(b.content||{}).phrases||[];a.isGradeMode=Boolean(a.hasScoring),a.isMultiType=l===h(f),a.isAnyNode=n===i(f,g),a.hasSharedAudio=Boolean(c&&c.aud&&c.aud.url),a.questionPhraseCount=Math.min(e.questionNo,g.length),a.isMultiType?a.hasScoring||a.type(d.ACT_TYPE.PRACTICE):a.questionPhraseCount=1;var j=Boolean(a.hasScoring);a.items().instantFeedback(!j),a.length(a.questionPhraseCount)},"sig/render":function(){var a=this,b=a._json||{};if(a.publish("activity/step/render",a.index(),a.length()),a.$element){if(!a._htmlPromise){var c={hasSharedAudio:a.hasSharedAudio,ref:b.references,isMultiType:a.isMultiType,isGradeMode:a.isGradeMode};a._htmlPromise=a.html(f,c)}return a._htmlPromise.then(function(){var c={activityContent:b,hasSharedAudio:a.hasSharedAudio,isMultiType:a.isMultiType,isGradeMode:a.isGradeMode,isAnyMode:a.isAnyNode,questionPhraseCount:a.questionPhraseCount,questionPhraseIndex:a.isMultiType?a.index():-1,item:a.items()};a.publish("activity/text-select/render",c)})}},"sig/stop":function(){this._htmlPromise=null},"hub/text-select/interaction":function(a){return this.publishInteraction(a)},nextStep:function(){var a=this;return a.index()>=a.length()-1?c.resolve():(a.index(a.index()+1),a.signal("render"))}})}),define("troopjs-requirejs/template!school-ui-activity/activity/text-select/text-select.html",[],function(){return function(a){var b="",c=this,d=a,e=d.makePhrase,f=d.isAnyMode,g=d.hasSharedAudio,h=d.renderQuestionPhrases;return b+='\n<div class="ets-act-tsl-view-main">\n\t<div class="ets-act-tsl-phrases">',function(){for(var a=0,d=h.length;a<d;a++){var i=h[a],j=!g&&i.audio?i.audio.url:"",k=f?"ets-any":"ets-some";j&&(k+=" ets-has-audio"),b+='\n\t\t<div class="ets-act-tsl-phrase'+(0===a?" ets-first":"")+(a===d-1?" ets-last":"")+'">\n\t\t\t',j&&(b+='\n\t\t\t<div class="ets-act-tsl-audio">\n\t\t\t\t<div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap ets-ap-small">\n\t\t\t\t\t<audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n\t\t\t\t\t\t   data-src="'+j+'" type="audio/mpeg"\n\t\t\t\t\t\t   class="ets-ap ets-ap-small ets-ap-nobar"></audio>\n\t\t\t\t</div></div>\n\t\t\t</div>\n\t\t\t'),b+='\n\t\t\t<div data-phrase-index="'+a+'" data-phrase-id="'+i._id+'" class="ets-act-tsl-text ets-doing '+k+'">\n\t\t\t\t'+e.call(c,i,f)+"\n\t\t\t</div>\n\t\t</div>\n\t\t"}}(),b+="</div>\n</div>\n"}}),
define("school-ui-activity/activity/text-select/text-select",["jquery","when","underscore","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./text-select.html","./const","school-ui-activity/util/activity-util","jquery.jscrollpane","jquery.mousewheel"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){for(var c=this,d={step:1,joinedAnswerCount:0},e="",f=a.items,g=f.length,h=1,i=0;i<g;i+=h){d.step=h=1;var j=f[i];!b&&y.test(j.txt)?(e+=l.call(c,f,i,g,b,d),h=d.step):e+=k(j._id,j.txt,i,b)}var m=d.joinedAnswerCount;return m>0&&(c[$]-=m),e}function k(a,b,c,d,e,f){if(!b)return"";if(b=String(b),!d&&b===H)return aa;if(v.test(b))return b;var g=-1;d||b===I||-1===(g=b.indexOf(H))||(-1!==b.indexOf(H,g+1)?g=-1:b=b.replace(H,""));var h="",i=1===b.length,j=i&&z.test(b);d?i&&b!==H&&!w.test(b)||(h=O):f&&x.test(b)&&(h=Q),j&&""===h&&(h=R);var k=e?' data-other-index="'+e+'"':"";b=b.replace(A,"&amp;").replace(B,"&lt;").replace(C,"&gt;");var l="<"+D+' class="'+h+'" data-at-id="'+a+'" data-word-id="'+a+'" data-word-index="'+c+'"'+k+">"+b+"</"+D+">",m=j?"":E;return-1===g?m+l:0===g?m+aa+E+l:g>0?m+l+E+aa:void 0}function l(a,b,c,d,e){var f=this,g="",h=0,i=function(a,b,c,d,e){var f=a[b],g=f.txt,h=ca[g];e.step=e.step||1,f._index=b;for(var i,j=[[f]],k=1,l=b+1;l<c;l++){if(e.step++,f=a[l],g=f.txt,f._index=l,g===h){j[++k]=[f];break}if(!v.test(g)){var m=g===H,n=g.indexOf(H);m&&(i=!0),m||-1===n||(f.txt=g.replace(J,"")),m?(j[k]&&k++,j[k]=[f],k++):0===n?(k++,j[k]=[ba],k++,j[k]=[f]):(j[k]||(j[k]=[]),j[k].push(f),n>0&&(k++,j[k]=[ba],k++))}}return!i&&j.length>1&&(j=[j[0]].concat(j[1].map(function(a){return[a]})).concat(j.slice(2))),j.hasSeparator=i,j}(a,b,c,d,e);return i.forEach(function(a){var b="",c=[],e=[];a.forEach(function(a){m.call(f,a._id)?(c.unshift(a),e.push(a._index)):c.push(a),b+=E+a.txt}),e.length>1&&(h+=e.length-1);var j=c[0];j&&(b=b.trim(),g+=k(j._id,b,j._index,d,e.slice(0,-1).join(","),i.hasSeparator))}),e.joinedAnswerCount+=h,g}function m(b){var c=this,d=c[L].scoring,e=!1;return d?(a.each(d.phrases||[],function(c,d){if(a.each(d.items||[],function(a,c){if(c._id===b)return e=!0,!1}),e)return!1}),e):e}function n(){var a=this,b=a[u],c=a[$]-a[_];b.closest(X).find(Y).trigger(F,{action:"reset",step:c})}function o(){var a=this,b=a[u],c=b.find(T),d=c.find(U);a[K]||p(d),1===d.length&&d.height()<G&&d.addClass(S),q(c)}function p(b){var d=b.find(W);d.next().add(d.prev()).addClass(O);var e=b.find(V),f=0;e.each(function(b,c){var d=a(c);d.attr(N,f),d.next().hasClass(P)||f++});for(var g=f,h=0;h<g;h++){var i=e.filter("["+N+"="+h+"]");if(!(i.length<=1)){for(var j=i.wrap("<span></span>").parent(),k=c.shuffle(i.toArray()),l=0;l<k.length;l++){var m=j.eq(l),n=k[l];m.empty().append(n)}i.unwrap()}}}function q(b){b.one("jsp-initialised",function(){var c=b.find(".jspDrag");s=setTimeout(function(){i.blink.call(a,c)},5e3),t=setTimeout(function(){i.blink.call(a,c)},3e4),b.one("jsp-scroll-y",function(){clearTimeout(s),clearTimeout(t)})}),b.jScrollPane({enableKeyboardNavigation:!1,autoReinitialise:!1})}function r(a){return a.hasClass(O)&&a.data(M)}var s,t,u="$element",v=/<\w+[^>]*>|<\/\w+>/,w=/[\w~@#$%^&*]+/,x=/^[()[\]]$/,y=/^[(\[]$/,z=/^[.?;:!]$/,A=/&/g,B=/</g,C=/>/g,D="span",E=" ",F="rolling-number/switch-answers-num",G=100,H=h.SLASH,I=h.DOUBLE_SLASH,J=new RegExp(H,"g"),K="_isAnyMode",L="_activityContent",M="wordId",N="data-option-group-index",O="ets-option",P="ets-some-separator",Q="ets-some-border",R="ets-punctuation",S="ets-min-height",T=".ets-act-tsl-view-main",U=".ets-act-tsl-phrase",V="."+O,W="."+P,X=".ets-act-tsl",Y=".ets-ar",Z="_item",$="_answerCount",_="_selectCount",aa="<"+D+' class="'+P+'">'+H+"</"+D+">",ba={_id:"",_index:-1,txt:H},ca={"(":")","[":"]"};return d.extend({"sig/finalize":function(){window.clearTimeout(s),window.clearTimeout(t)},"hub/activity/text-select/render":function(b){var d=this;d.isAnswerShown&&(d.publish("activity/widget/toggleslide/toggle"),d.isAnswerShown=!1),d._hasSharedAudio=b.hasSharedAudio,d[Z]=b.item,d[L]=b.activityContent,d._isGradeMode=b.isGradeMode,d[K]=b.isAnyMode,d._questionPhraseCount=b.questionPhraseCount,d._questionPhraseIndex=b.questionPhraseIndex,d._reset(d._questionPhraseIndex),b.makePhrase=j;var e=(b.activityContent.content||{}).phrases||[],f=b.isMultiType?[e[b.questionPhraseIndex]]:e.slice(0,b.questionPhraseCount);return f.length>1&&b.activityContent.filterOptions.random&&(f=c.shuffle(f)),d.html(g,a.extend({renderQuestionPhrases:f},b)).then(function(){n.call(d),o.call(d)})},"hub/activity/check/answer":function(){var b=this;b[Z].instantFeedback()||(b[u].find(".ets-selected").each(function(c,d){var e=a(d),f=e.closest(".ets-act-tsl-text"),g=e.data("option-group-index"),h=f.data("phraseId"),i=e.data("word-id"),j=b.checkAnswer(h,g,i);b.displayInteractionResult(j,f,e)}),b._updateAnsweredState(),b.publish("activity/widget/toggleslide/show",{show:!b[Z].completed()}))},"hub/activity/correctanswer/show":function(b){var c=this;c.isAnswerShown=b;var d=c[u].find(".ets-act-tsl-text");b?d.filter(".ets-doing").removeClass("ets-doing").addClass("ets-checking").each(function(b,d){var f=a(d),g=f.data("phraseId"),h=e.findById(c[L].scoring.phrases,g);f.find(V).each(function(b,c){var d=a(c),f=d.data("word-id"),g=e.findById(h.items,f),i=Boolean(g);d.addClass(i?"ets-chk-correct":"ets-chk-disabled")})}):d.filter(".ets-checking").removeClass("ets-checking").addClass("ets-doing").find(V).removeClass("ets-chk-correct").removeClass("ets-chk-disabled")},_reset:function(b){var c=this;c[_]=0,c[$]=0,c._selectCountByPhrase={},c._answerCountByPhrase={};for(var d=-1===b||void 0===b,e=c[L],f=e.scoring,g=e.content.phrases||[],h=d?0:b,i=d?c._questionPhraseCount-1:b;h<=i;h++){var j=g[h]._id;c._selectCountByPhrase[j]=0,f?a.each(f.phrases||[],function(a,b){if(b._id===j){var d=b.items.length;return c[$]+=d,c._answerCountByPhrase[j]=d,!1}}):(c[$]+=1,c._answerCountByPhrase[j]=1)}},_getAnswerSelector:function(b,c){var d=this,e=d[L],f=e.scoring,g=[];if(f){var h=e.content.phrases[b]._id,i=void 0===c;a.each(f.phrases||[],function(b,d){if(d._id===h)return a.each(d.items||[],function(a,b){(i||b._id!==c)&&g.push('[data-word-id="'+b._id+'"]')}),!1})}return g},_disableOtherOption:function(a,b){a.find(V).filter(b).not(".ets-correct").addClass("ets-disabled")},_isSelectableWord:function(a){return!(a.hasClass("ets-correct")||a.hasClass("ets-disabled")||a.hasClass("ets-incorrect"))},_coundRemainingAnswers:function(){var a=this,b=a[u].find([".ets-selected",".ets-correct"].join(",")).length;return Math.max(0,a[$]-b)},_updateAnsweredState:function(){var a=this,b=a[u],c=a._coundRemainingAnswers();a[Z].answered(0===c),b.closest(X).find(Y).trigger(F,{action:"set",step:c})},handleSelectText:function(a,b){var c=this,d=a.data("phraseId"),e=c._isGradeMode,f=c[K];if(e&&f&&!b.hasClass("ets-selected")){if(0===c._coundRemainingAnswers())return}if(c.disablePreviousIncorrectSelection(a,b),!c[Z].instantFeedback()){b.toggleClass("ets-selected");return b.siblings(V).filter(c.getOptionSelector(b)).removeClass("ets-selected"),void c._updateAnsweredState()}var g,h=b.data("word-id");if(e){var i=b.data("option-group-index");g=c.checkAnswer(d,i,h)}else g=!0,c[_]+=1,c[_]>=c[$]&&c[Z].completed(!0);c.displayInteractionResult(g,a,b),c._updateAnsweredState()},checkAnswer:function(a,b,c){var d=this,g=e.findById(d[L].scoring.phrases,a),h=e.findById(g.items,c),i=Boolean(h),j=f.makeTextSelectInteraction(i,a,b,c),k=d.publish("text-select/interaction",j);return i&&(d[_]+=1,d._selectCountByPhrase[a]+=1,d[_]>=d[$]&&(d[L].content._isCorrect=!0,k.then(function(){d[Z].completed(!0)}))),i},displayInteractionResult:function(a,b,c){var d=this;d.disableCompletedPhrase(b),c.removeClass("ets-selected"),a?(c.addClass("ets-correct"),d[K]||d._disableOtherOption(b,d.getOptionSelector(c))):c.addClass("ets-incorrect")},disablePreviousIncorrectSelection:function(a,b){var c=this;c[K]?a.find(h.SEL_WORD).filter(".ets-incorrect").removeClass(h.CLS_INCORRECT).addClass(h.CLS_DISABLED):a.find(h.SEL_WORD).filter(c.getOptionSelector(b)).filter(".ets-incorrect").removeClass(h.CLS_INCORRECT).addClass(h.CLS_DISABLED)},disableCompletedPhrase:function(a){var b=this,c=a.data("phraseId");b._selectCountByPhrase[c]===b._answerCountByPhrase[c]&&a.removeClass(h.CLS_DOING)},getOptionSelector:function(a){return"["+N+"='"+a.data("option-group-index")+"']"},"dom:.ets-act-tsl-text/click":function(b){var c=a(b.target);if(r(c)){var d=this,e=a(b.currentTarget),f=e.data("phraseIndex");if(e.hasClass("ets-doing")&&d._isSelectableWord(c)){var g=c.data("wordIndex");d.handleSelectText(e,c,f,g)}}}})}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/main.html",[],function(){return function(a){var b="";return a.references.aud&&(b+='\n    <div class="ets-act-tpd-hd-ap">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n    </div>\n'),b+='\n<div class="ets-act-tpd" data-weave="school-ui-activity/activity/typing-drag-drop/typing-drag-drop"></div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/typing-drag-drop.html",[],function(){return function(a){var b="",c=a.paragraphs;a.dragPieces;b+='\n<div class="ets-act-tpd-main">\n';for(var d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.length;f++){var g=e[f];g._toAs?b+='\n            <span class="ets-act-tpd-gap ets-act-tpd-n" data-at-tag="droppable" data-at-id="'+g.text+'" data-id="'+g.text+'"><span class="ets-act-tpd-cm">\n                </span>\n            </span> \n        ':b+="\n            "+g.text+"\n        "}b+='\n</div>\n<div class="ets-act-tpd-shadow ets-act-tpg-none"></div>\n<div class="ets-act-tpd-items">\n    <ul>\n    ';for(var d=0;d<a.dragPieces.length;d++){var h=a.dragPieces[d];b+='\n        <li>\n            <span class="ets-act-tpd-item ets-act-tpd-item-n" data-index="'+d+'" data-at-tag="draggable" data-at-id="'+h._id+'" data-id="'+h._id+'"><span class="ets-act-tpd-im">\n                <span class="ets-act-tpd-txt">'+h.txt+'\n                </span><span class="ets-act-tpd-idc">\n                </span></span>\n            </span>\n        </li>\n        '}return b+="\n    </ul>\n</div> "}}),define("school-ui-activity/activity/typing-drag-drop/typing-drag-drop",["jquery","jquery.ui","jquery.ui.touch-punch","troopjs-ef/component/widget","school-ui-activity/util/interaction","school-ui-shared/utils/browser-check","school-ui-activity/util/activity-util","template!./typing-drag-drop.html","jquery.jscrollpane","jquery.mousewheel"],function(a,b,c,d,e,f,g,h){"use strict";function i(){a(this).removeAttr("style")}function j(){if(G){this.$element.find(N).addClass("notExists")}}function k(){var a=this;return a.html(h,a._json).tap(l.bind(a))}function l(){var a=this;m.call(a),o.call(a),p.call(a),q.call(a)}function m(){var a=this,b=a.$element,c=b.find(U),d=b.find(N),e=c.height()+F;c.css({height:e});var f=a._hasAudio?D:0;b.css({maxHeight:C-f});var g=C-e-f;d.height()>g?(d.css({maxHeight:g-E}),b.find(W).show(),H&&d.css({"overflow-y":"scroll"})):d.css({height:g})}function n(b){var c=".jspPane";return b.bind("jsp-initialised",function(){function d(){var a=b.find(c).height();parseInt(a)-parseInt(f)&&b.jScrollPane(),f=a,z=setTimeout(d,100)}b.unbind("jsp-initialised");var e=b.find(".jspDrag");A=setTimeout(function(){g.blink.call(a,e)},5e3),B=setTimeout(function(){g.blink.call(a,e)},3e4),b.bind("jsp-scroll-y",function(){b.unbind("jsp-scroll-y"),window.clearTimeout(A),window.clearTimeout(B)});var f=b.find(c).height();z=setTimeout(d,100)})}function o(){var a=this,b=a.$element,c=b.find(N);H||n(c).jScrollPane()}function p(){var b=this,c=b.$element,d={stack:R,cancel:S,appendTo:".ets-act-bd-main",revert:"invalid",start:function(a,b){if(w||x)return b.helper.removeClass(K),!1;w=!0},stop:function(a,b){b.helper.removeClass(K),w=!1},disabled:!1};c.find(U).find(R).bind("mousedown",function(){a(this).addClass(K)}).bind("mouseup",function(){a(this).removeClass(K)}).draggable(d)}function q(){var b=this,c=b.$element,d={accept:Q,activeClass:I,tolerance:"intersect",greedy:!0,over:function(b,c){a(this).css("zIndex",1).find(P).stop().animate({width:c.draggable.find(T).width()+6})},out:function(){var b=a(this).css("zIndex",0),c=b.find(P);c.stop().animate({width:b.width()},function(){c.each(i)})},drop:function(c,d){if(!x){x=!0;var e=d.draggable.draggable({disabled:!0}),f=a(this).droppable({disabled:!0});f.find(P).stop().css({width:e.find(T).width()+6});var g=f.offset(),h=e.offset(),j={left:g.left-h.left,top:g.top-h.top};e.animate({left:parseInt(e.css("left"))+j.left+4,top:parseInt(e.css("top"))+j.top+3},100,function(){f.find(P).append(e.each(i).addClass(J)),f.css("width","auto"),setTimeout(function(){r.call(b,f,e)},500)})}}};c.find(O).droppable(d)}function r(a,b){var c=this,d=a.data("id"),f=b.data("id");if(d&&f){var g=d===f,h=c._super.publishInteraction(e.makeMatchingInteraction(g,d,f));g&&(c._correctAnswers+=1),c._totalAnswers===c._correctAnswers&&(c._json.content._isCorrect=!0,h.then(function(){c._item.completed(!0)})),t.call(c,g,a,b)}}function s(a){a.removeClass(M+" "+J);var b=this,c=b.$element,d=a.offset(),e=a.closest(O),f=e.find(P);e.css({width:e.width()}),f.animate({width:50},function(){f.each(i),e.each(i)}),a.detach().css({position:"absolute",zIndex:10}).appendTo(c).offset(d).find(T).each(i);var g=c.find(U).find("li").eq(parseInt(a.data("index"))).css({width:a.width()+20}),h=g.offset(),j={left:h.left-d.left,top:h.top-d.top};a.animate({left:parseInt(a.css("left"))+j.left+10,top:parseInt(a.css("top"))+j.top},function(){g.append(a.each(i).css({position:"relative"}).draggable({disabled:!1})).each(i),x=!1})}function t(a,b,c){var d=this;a?u.call(d,b):v.call(d,b,c),j.call(d)}function u(b){var c=a("<span>").html(b.find(V).text());b.removeClass().each(i).addClass(L).html(c).removeAttr("data-at-tag"),x=!1}function v(a,b){var c=this;a.droppable({disabled:!1}),b.addClass(M),y=window.setTimeout(function(){s.call(c,b)},500)}var w,x,y,z,A,B,C=430,D=85,E=37,F=10,G="msie"===f.browser,H=G&&parseInt(f.version)<8,I="ets-act-tpd-h",J="ets-act-tpd-item-p",K="ets-act-tpd-item-h",L="ets-act-tpd-item-sc",M="ets-act-tpd-item-ic",N=".ets-act-tpd-main",O=".ets-act-tpd-gap",P=".ets-act-tpd-cm",Q=".ets-act-tpd-item",R=".ets-act-tpd-item-n",S="."+J,T=".ets-act-tpd-im",U=".ets-act-tpd-items",V=".ets-act-tpd-txt",W=".ets-act-tpd-shadow";return d.extend({"sig/render":function(){return k.call(this)},"sig/finalize":function(){window.clearTimeout(y),window.clearTimeout(z),window.clearTimeout(A),window.clearTimeout(B),w=x=null},"hub/activity/template/typing-drag-drop/load":function(a){var b=this;return b._super=a._super,b._json=a.json,b._item=a.item,b._hasScoring=a.hasScoring,b._hasAudio=b._json.references.aud,b._correctAnswers=0,b._totalAnswers=b._json.content.items.reduce(function(a,b){return a+b.gaps.length},0),b.signal("render")}})}),define("school-ui-activity/activity/typing-drag-drop/main",["jquery","poly","underscore","school-ui-activity/activity/base/main","template!./main.html","string.split","jquery.ui","jquery.transit","./typing-drag-drop"],function(a,b,c,d,e){"use strict";function f(){var b=this,d=b._json,e=[],f=b._json.content.evalLogic&&2==b._json.content.evalLogic,g=d.scoring.items||[],h=d.content.items||[];g.forEach(function(a){e.push.apply(e,a.gaps||[])}),e=c.shuffle(e),d.dragPieces=e,d.paragraphs=[];var i=0;h.forEach(function(b){var c=[],e=split(b.txt.replace(/\n/g,""),/(<strike(?:.*?)>.*?<\/strike>)/);a.each(e,function(a,b){var d={},e=b.match(/^<strike(?:.*?)>(.*?)<\/strike>$/);e?(d._toAs=!0,d.text=e[1],i++):d.text=b,c.push(d)}),d.paragraphs.push(c)}),g.forEach(function(b){b.gaps.forEach(function(b){null!=b.txt&&(b.txt=a.trim(b.txt.replace(/\n/g,"").replace(/<.*?>/gi,"")),f||(b.txt=b.txt.toLowerCase()))})}),d._gapTotal=i}function g(){var a=this;return a._htmlPromise||(a._htmlPromise=a.html(e,a._json)),a._htmlPromise.then(function(){return a.publish("activity/template/typing-drag-drop/load",{item:a.items(),json:a._json,hasScoring:a.hasScoring,_super:a})})}return d.extend(function(){},{"sig/initialize":function(){var a=this;a.items().instantFeedback(!0),f.call(a)},"sig/render":function(){return g.call(this)},"sig/finalize":function(){this._htmlPromise=null},_onAnswerChecked:function(){}})}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/main.html",[],function(){return function(a){var b='<div class="ets-act-tpg';return a.references.aud||(b+=" ets-act-tpg-noaudio"),b+='">\n    ',a.references.aud&&(b+='\n    <div class="ets-act-hd-ap">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                 data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                 class="ets-ap"></audio>\n        </div></div>\n    </div>\n    '),b+='\n   <div data-weave="school-ui-activity/activity/typing-gap-fill/typing-gap-fill"></div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/typing-gap-fill.html",[],function(){return function(a){for(var b='<div class="ets-act-tpg-main">',c=a.paragraphs,d=0,e=0;e<c.length;e++)for(var f=c[e],g=0;g<f.length;g++){var h=f[g];h&&h._toAs?(d++,b+='\n    <span class="ets-act-tpg-cell ets-act-tpg-n">\n        <span class="ets-act-tpg-cm">\n            <input class="ets-act-tpg-input" autocomplete="off" type="text" data-id="'+h.txt+'" data-at-id="'+h.txt+'" data-weave="school-ui-activity/shared/textchange/main" size="10" tabindex="'+d+'"/>\n            <span class="ets-act-tpg-txt ets-act-tpg-none"></span>\n            <span class="ets-act-tpg-idc"></span>\n        </span>\n    </span>\n'):b+="\n    "+h.txt+"    \n"}return b+='</div>\n<div class="ets-act-tpg-shadow ets-act-tpg-none"></div>'}}),define("troopjs-requirejs/template!school-ui-activity/shared/toggle-slide/main.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};return b+='\n<div class="ets-act-wgt-ts-ctn ets-none">\n    <div class="ets-act-wgt-ci">\n        <span '+c(462460,"Show correct answers")+'></span>\n    </div>\n    <div class="ets-act-wgt-ts" data-at-id="btn-show-correct-answer" data-show="true">\n        <div class="ets-act-wgt-ts-sd">\n            <ul class="ets-cf">\n                <li class="ets-act-wgt-ts-hd">\n                    <span '+c(462461,"YES")+'></span>\n                </li>\n                <li class="ets-act-wgt-ts-sh">\n                    <span '+c(462462,"NO")+'></span>\n                </li>\n            </ul>\n        </div>\n        <div class="ets-act-wgt-ts-sd">\n            <div class="ets-act-wgt-ts-kb"></div>\n        </div>\n    </div>\n</div>'}}),define("school-ui-activity/shared/toggle-slide/main",["jquery","poly","troopjs-ef/component/widget","template!./main.html"],function(a,b,c,d){"use strict";function e(){var a=this;return a.html(d).tap(f.bind(a))}function f(){var a=this;a.$element.find(i).delegate(j,"click",g.bind(a))}function g(){var a=this,b=a.$element,c=b.find(j),d=c.data("show"),e=c.find(k);e.is(":animated")||(e.animate({left:d?n:0},l),c.find("ul").animate({marginLeft:d?0:m},l,function(){c.data("show",!d),a.publish("activity/correctanswer/show",d)}))}function h(a){var b=this,c=b.$element,d=c.find(i);a.show?"true"!=d.is(":visible")&&(a.style&&d.css(a.style),d.fadeIn()):d.fadeOut()}var i=".ets-act-wgt-ts-ctn",j=".ets-act-wgt-ts",k=".ets-act-wgt-ts-kb",l=250,m=-78,n=44;return c.extend({"sig/initialize":function(){return e.call(this)},"hub/activity/widget/toggleslide/toggle":function(){g.call(this)},"hub/activity/widget/toggleslide/show":function(a){h.call(this,a)}})}),define("school-ui-activity/activity/typing-gap-fill/typing-gap-fill",["jquery","jquery.ui","poly","when","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","school-ui-shared/utils/browser-check","template!./typing-gap-fill.html","school-ui-activity/util/activity-util","school-ui-activity/shared/typing-helper/main","jquery.jscrollpane","jquery.mousewheel","json2","school-ui-activity/shared/toggle-slide/main"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(b){var c=null;return a.each(this._json._correctAns,function(a,d){if(d._id==b)return c=d.txt,!1}),c}function m(){var a=this;return a.html(i,a._json).tap(n.bind(a))}function n(){var a=this;p.call(a),q.call(a),r.call(a),s.call(a),a._hasScoring&&t.call(a),ca=C.bind(a.$element.find(U)),da=w.bind(a.$element.find(U)),a._json.isGradeMode&&a.append('<div class="ets-act-tpg-b" data-weave="school-ui-activity/shared/toggle-slide/main"></div>')}function o(b){var c=".jspPane";return b.bind("jsp-initialised",function(){function d(){var a=b.find(c).height();parseInt(a)!=parseInt(f)&&b.jScrollPane(),f=a,K=setTimeout(d,100)}b.unbind("jsp-initialised");var e=b.find(".jspDrag");L=setTimeout(function(){j.blink.call(a,e)},5e3),M=setTimeout(function(){j.blink.call(a,e)},3e4),b.bind("jsp-scroll-y",function(){b.unbind("jsp-scroll-y"),window.clearTimeout(L),window.clearTimeout(M)});var f=b.find(c).height();K=setTimeout(d,100)})}function p(){var a=this,b=a.$element,c=b.find(U),d=b.parent().hasClass(T),e=c.height(),f=430-(a._hasScoring?61:0)-(d?0:85);e>f?(c.css("height",f-22),b.find(V).show()):c.css("height",f),o(c).jScrollPane()}function q(){this.$element.find(W).bind("focus",function(){a(this).closest(Y).addClass(O)}).bind("blur",function(){a(this).closest(Y).removeClass(O)})}function r(){var a=this,b=a.$element;ea=x.bind(a),b.find(W).bind(_,v),b.find(Y).delegate("input","keydown keypress",function(a){a.stopPropagation()})}function s(){this.$element.find(X).attr("unselectable","on").attr("onselectstart","return false;")}function t(){var a=this;a.$element.find(U).delegate(Z,"click",function(){a.publish("activity/widget/toggleslide/toggle")})}function u(a){function b(a,c){ca();var d=a.get(0),e=parseInt(d.getAttribute&&d.getAttribute("size")||d.size);if(!e||c&&20==e||!c&&10==e)return void da();a.attr("size",c?++e:--e),J=setTimeout(function(){b(a,c)},15)}var c=a.val(),d=a.data("expand");(d&&c.length<=10||!d&&c.length>10)&&(a.data("expand",!d),clearTimeout(J),b(a,!d))}function v(){u(a(this)),ea()}function w(){try{this.data("jsp").scrollByY(0)}catch(a){}}function x(){var b=this,c=b.$element,d=b._item,e=0,f=c.find(W);f.each(function(){a.trim(a(this).val())&&e++}),e<f.length?d.answered(!1):d.answered(!0)}function y(a){var b=this,c=b._item;window.clearTimeout(I),a?(z.call(b),H=c.answered(),c.answered(!1)):(A.call(b),c.answered(H))}function z(){var b=this;b.$element.find(Y).each(function(){var c=a(this);if(!c.hasClass(Q)){c.addClass(R);var d=c.find(W).addClass(S).data("id");c.find(X).text(l.call(b,d)).removeClass(S)}})}function A(){var a=this,b=a.$element,c=b.find(Z).removeClass(R);c.find(X).addClass(S),c.find(W).removeClass(S),B.call(a)}function B(){var a=this,b=a.$element,c=b.find($);c.find("span").addClass(S);var d=c.find(W);d.removeClass(S).data("expand",0).attr("size",10),d.val(""),c.removeClass(P),ca()}function C(){N&&this.addClass("notExists")}function D(b){var c=b.originalEvent.touches[0],d=a(b.currentTarget);d.data(aa,c.clientX).data(ba,d.scrollLeft())}function E(b){a(b.currentTarget).removeData([aa,ba])}function F(b){b.preventDefault();var c=b.originalEvent.touches[0],d=c.clientX,e=a(b.currentTarget),f=e.data(aa),g=e.data(ba);if(void 0!==f&&void 0!==g){var h=d-f;e.scrollLeft(g-h)}}function G(){this.$element.on("touchstart",".ets-act-tpg-input",D).on("touchend",".ets-act-tpg-input",E).on("touchmove",".ets-act-tpg-input",F)}var H,I,J,K,L,M,N="msie"===h.browser,O="ets-act-tpg-h",P="ets-act-tpg-ic",Q="ets-act-tpg-sc",R="ets-act-tpg-e",S="ets-act-tpg-none",T="ets-act-tpg-noaudio",U=".ets-act-tpg-main",V=".ets-act-tpg-shadow",W="input",X=".ets-act-tpg-txt",Y=".ets-act-tpg-n",Z=".ets-act-tpg-e",$=".ets-act-tpg-ic",_="EFTextChange",aa="_clientX",ba="_scrollLeft",ca=function(){},da=function(){},ea=function(){};return e.extend({"sig/start":function(){"ios"===h.os&&G.call(this)},"sig/finalize":function(){window.clearTimeout(I),window.clearTimeout(K),window.clearTimeout(J),window.clearTimeout(L),window.clearTimeout(M),H=null;var a=this;a.audioPlayer&&a.audioPlayer.pause()},"sig/render":function(){return d.all([m.call(this),k.readyPromise])},"hub/activity/template/typing-gap-fill/load":function(a){var b=this;return b._json=a.json,b._item=a.item,b._super=a._super,b._hasScoring=a.hasScoring,b._json._originalScoring=JSON.stringify(b._json.scoring),b.signal("render")},"hub/activity/correctanswer/show":function(a){y.call(this,a)},"hub/activity/check/answer":function(){var b=this,c=b.$element,d=b._json.content.evalLogic&&2==b._json.content.evalLogic,e=!0,h=[],i=b._json.scoring.items.reduce(function(a,b){return a.concat(b.gaps)},[]);c.find(W).each(function(c,g){var j=a(g),l=j.data("id"),m=k.cleanTypingAnswer(j.val()),n=m;d||(n=n.toLowerCase());var o=f.findById(i,l),p=k.prepareTypingSolution(o.txt),q=p.indexOf(n)>=0;e=e&&q,b.displayInputCorrectness(j,m,q),h.push(l)}),h.sort();var j=g.makeTypingInteraction(e,h.join("+")),l=b.publish("typing-gap-fill/interaction",j);e?(b._json.content._isCorrect=!0,b.publish("activity/widget/toggleslide/show",!1),l.then(function(){b._item.completed(!0)})):(b.publish("activity/widget/toggleslide/show",{show:!0}),b._item.answered(!1),I=window.setTimeout(function(){B.call(b)},2500))},displayInputCorrectness:function(b,c,d){var e=b.closest(Y);if(b.addClass(S),d){var f=a("<span>").text(c);e.removeClass().addClass(Q).empty().append(f)}else e.find(X).text(c).removeClass(S),e.addClass(P)},"hub/activity/template/typing-gap-fill/show-non-graded-feedback":function(){var b=this;b.$element.find(W).each(function(c,d){var e=a(d),f=k.cleanTypingAnswer(e.val());b.displayInputCorrectness(e,f,!0)})}})}),define("school-ui-activity/activity/typing-gap-fill/main",["jquery","poly","when","school-ui-activity/activity/base/main","troopjs-core/component/factory","template!./main.html","string.split","underscore","jquery.ui","jquery.transit","./typing-gap-fill"],function(a,b,c,d,e,f){"use strict";function g(){var b=this,c=b._json,d=[],e=c.filterOptions.questionNo,f=c.content.evalLogic&&2==c.content.evalLogic,g=b.hasScoring;e<c.content.items.length&&c.content.items.splice(e-1,c.content.items.length-e);var h=[];if(a.each(c.content.items,function(b,c){h.push(c._id);var e=[],f=split(c.txt.replace(/\n/g,""),/(<strike(?:.*?)>.*?<\/strike>)/);a.each(f,function(b,c){var d={},f=c.match(/^<strike(?:.*?)>(.*?)<\/strike>$/);f?(d._toAs=!0,d.txt=f[1]):d.txt=a.trim(c),e.push(d)}),d.push(e)}),c.paragraphs=d,c.isGradeMode=g,g){for(var i=c.scoring.items.length-1;i>=0;i--){var j=c.scoring.items[i];a.inArray(j._id,h)<0&&c.scoring.items.splice(i,1)}c._correctAns=[],a.each(c.scoring.items,function(b,d){a.each(d.gaps,function(b,d){null!=d.txt&&(d.txt=a.trim(d.txt.replace(/\n/g,"").replace(/<.*?>/gi,"")),c._correctAns.push({_id:d._id,txt:d.txt.split("/")[0]}),!f&&(d.txt=d.txt.toLowerCase()))})})}}function h(){var a=this;return a._htmlPromise||(a._htmlPromise=a.html(f,a._json)),a._htmlPromise.then(function(){return a.publish("activity/template/typing-gap-fill/load",{item:a.items(),json:a._json,hasScoring:a.hasScoring,_super:a})})}var i={"sig/initialize":function(){var a=this;a.hasScoring?a.items().completed(!1):a.type(d.ACT_TYPE.PRACTICE),g.call(a)},"sig/finalize":function(){this._htmlPromise=null},"sig/render":function(){return h.call(this)},"hub/typing-gap-fill/interaction":function(a){return this.publishInteraction(a)},completed:e.around(function(a){return function(b){var c=this;return!c.hasScoring&&b&&c.publish("activity/template/typing-gap-fill/show-non-graded-feedback"),a.call(this,b)}})};return d.extend(function(){},i)}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-table/main.html",[],function(){return function(a){var b="";return b+='\n<div class="ets-act-tpt">\n    ',a.references.aud&&(b+='\n    <div class="ets-act-hd-ap">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n    </div>\n    '),b+='\n    <div class="ets-act-tpt-main" data-weave="school-ui-activity/activity/typing-table/typing-table">\n    </div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-activity/activity/typing-table/typing-table.html",[],function(){return function(a){var b="",c=a.tables,d=a.tablesAttr[a.curPage],e=c[a.curPage],f=e.length,g=e[f-1]&&e[f-1].length;b+='\n<table class="ets-act-tpt-t">\n    ';for(var h=0;h<f;h++){b+='\n        <tr class="'+(h==f-1?"ets-act-tpt-last":"ets-act-tpt-tr-m")+'">\n            ';for(var i=0;i<g;i++)b+="\n\t\t\t\t",void 0!=d[h][i]&&(b+='\n                <td class="'+(i==g-1?"ets-act-tpt-last":"ets-act-tpt-m")+'" '+(d[h][i]?d[h][i]:"")+" >\n                    ",e[h][i]&&(null!=e[h][i]._toAnswer?b+='\n                            <div class="ets-act-tpt-input ets-act-tpt-n" data-r="'+h+'" data-c="'+i+'">\n                                <input type="text" data-id="'+e[h][i]._toAnswer+'" data-at-id="'+e[h][i]._toAnswer+'" data-weave="school-ui-activity/shared/textchange/main" maxlength=\'200\'/>\n                                <span class="ets-act-tpt-txt ets-none"></span>\n                            </div>\n                            ':b+="\n                                "+e[h][i]+"\n                            "),b+="\n                </td>\n\t\t        "),b+="\n            ";b+="\n        </tr>\n    "}return b+='\n</table>\n<div class="ets-act-tpt-b" data-weave="school-ui-activity/shared/toggle-slide/main"></div>'}}),define("school-ui-activity/activity/typing-table/typing-table",["jquery","jquery.ui","jquery.gudstrap","poly","when","troopjs-ef/component/widget","school-ui-activity/util/scoring","school-ui-activity/util/interaction","template!./typing-table.html","school-ui-activity/shared/typing-helper/main","json2","school-ui-activity/shared/toggle-slide/main"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(b){var c=null;return a.each(this._json._correctAns,function(a,d){if(d._id==b)return c=d.txt,!1}),c}function m(){var a=this;return a.html(i,a._json).tap(n.bind(a))}function n(){var a=this;o.call(a),p.call(a),q.call(a),r.call(a),s.call(a),a._hasScoring&&t.call(a)}function o(){var a=this,b=a.$element,c=b.find(H),d=a._json.tables[a._json.curPage],e=d[d.length-1]&&d[d.length-1].length;c.css({width:e*O+2*P})}function p(){this.$element.find(M).bind("focus",function(){a(this).parent().addClass(C)}).bind("blur",function(){a(this).parent().removeClass(C)})}function q(){var a=this;a.$element.find(M).bind(N,u.bind(a))}function r(){this.$element.find(L).attr("unselectable","on").attr("onselectstart","return false;")}function s(){a(I).find(L).tooltip({animation:!0,trigger:"hover"})}function t(){var a=this;a.$element.find(H).delegate(K,"click",function(){a.publish("activity/widget/toggleslide/toggle")})}function u(){var b=this,c=b.$element,d=b._item,e=0;c.find(M).each(function(){a.trim(a(this).val())&&e++}),e<b._json.content.items[b._json.curPage].gaps.length?d.answered(!1):d.answered(!0)}function v(a){window.clearTimeout(B);var b=this,c=b._item;a?(w.call(b),A=c.answered(),c.answered(!1)):(x.call(b),c.answered(A))}function w(){var b=this;b.$element.find(I).each(function(){var c=a(this);if(!c.hasClass(D)){c.addClass(F),c.find(M).addClass(G);var d=l.call(b,c.find(M).data("id"));c.find(L).text(d).removeClass(G).attr("data-original-title",d)}})}function x(){var a=this,b=a.$element,c=b.find(K).removeClass(F);c.find(L).addClass(G),c.find(M).removeClass(G),y.call(a)}
function y(){var a=this,b=a.$element,c=b.find(J);c.find(L).addClass(G);var d=c.find(M);d.removeClass(G),d.val(""),c.removeClass(E)}function z(){}var A,B,C="ets-act-tpt-h",D="ets-act-tpt-c",E="ets-act-tpt-ic",F="ets-act-tpt-e",G="ets-none",H=".ets-act-tpt-t",I=".ets-act-tpt-n",J="."+E,K="."+F,L=".ets-act-tpt-txt",M="input",N="EFTextChange",O=190,P=3,Q={"sig/render":function(){return e.all([m.call(this),j.readyPromise])},"sig/finalize":function(){window.clearTimeout(B)},"hub/activity/template/typing-table/load":function(a){var b=this;return b._json=a.json,b._super=a._super,b._item=a.item,b._isLastItem=a.isLastItem,b._hasScoring=a.hasScoring,b._json._originalScoring=k.stringify(b._json.scoring),b.signal("render")},"hub/activity/correctanswer/show":function(a){v.call(this,a)},"hub/activity/check/answer":function(){var b=this,c=b.$element,d=b._json.content.evalLogic&&2==b._json.content.evalLogic,e=!0,f=[];c.find(M).each(function(c,h){var i=a(h),k=i.data("id"),l=b._json.curPage,m=j.cleanTypingAnswer(i.val()),n=m;d||(n=n.toLowerCase());var o=g.findById(b._json.scoring.items[l].gaps,k),p=j.prepareTypingSolution(o.txt),q=p.indexOf(n)>=0;e=e&&q,b.displayInputCorrectness(i,m,q),f.push(k)}),f.sort();var i=h.makeTypingInteraction(e,f.join("+")),k=b.publish("typing-table/interaction",i);e?(b._isLastItem&&(b._json.content._isCorrect=!0),b.publish("activity/widget/toggleslide/show",!1),k.then(function(){b._item.completed(!0)})):(b.publish("activity/widget/toggleslide/show",{show:!0,style:{marginRight:(c.width()-c.find(H).width())/2}}),b._item.answered(!1),B=window.setTimeout(function(){y.call(b)},1500))},displayInputCorrectness:function(a,b,c){var d=a.parent();d.find(L).text(b).removeClass(G).attr("data-original-title",b),c?d.removeClass(E).addClass(D):d.addClass(E)},"hub/activity/template/typing-table/show-non-graded-feedback":function(){var b=this;b.$element.find(M).each(function(c,d){var e=a(d),f=j.cleanTypingAnswer(e.val());b.displayInputCorrectness(e,f,!0)})}};return f.extend(z,Q)}),define("school-ui-activity/activity/typing-table/main",["jquery","poly","../base/main","troopjs-core/component/factory","when","template!./main.html","underscore","jquery.ui","jquery.transit","./typing-table"],function(a,b,c,d,e,f){"use strict";function g(){var b=this,c=b._json,d=c.filterOptions.questionNo,e=c.content.evalLogic&&2==c.content.evalLogic,f=b.hasScoring;d<c.content.items.length&&c.content.items.splice(d-1,c.content.items.length-d);var g=[];if(c.tables=[],c.tablesAttr=[],a.each(c.content.items,function(a,b){g.push(b._id);for(var d=[],e=[],f=b.txt.replace(/\n/g,""),h=j.exec(f);h;){for(var i=[],l=[],m=h[1],n=k.exec(m);n;){var o={},p=/<strike(?:.*?)>(.*?)<\/strike>/gi.exec(n[1]);p?o._toAnswer=p[1]:o=n[1];var q=/<td(.*?)>/.exec(n[0]);i.push(o),l.push(q[1]),n=k.exec(m)}d.push(i),e.push(l),h=j.exec(f)}c.tables.push(d),c.tablesAttr.push(e)}),f){for(var h=c.scoring.items.length-1;h>=0;h--){var i=c.scoring.items[h];a.inArray(i._id,g)<0&&c.scoring.items.splice(h,1)}c._correctAns=[],a.each(c.scoring.items,function(b,d){a.each(d.gaps,function(b,d){null!=d.txt&&(d.txt=a.trim(d.txt.replace(/\n/g,"").replace(/<.*?>/gi,"")),c._correctAns.push({_id:d._id,txt:d.txt.split("/")[0]}),!e&&(d.txt=d.txt.toLowerCase()))})})}c.curPage=0,b.length(c.tables.length),b.index(c.curPage)}function h(){var a=this;return a.publish("activity/step/render",a.index(),a.length()),a._htmlPromise||(a._htmlPromise=a.html(f,a._json)),a._htmlPromise.then(function(){return a.publish("activity/template/typing-table/load",{item:a.items(),isLastItem:a.index()===a.length()-1,json:a._json,hasScoring:a.hasScoring,_super:a})})}function i(){}var j=/<tr(?:.*?)>(.*?)<\/tr>/gi,k=/<td(?:.*?)>(.*?)<\/td>/gi,l={"sig/initialize":function(){var a=this;a.hasScoring?a.items().completed(!1):a.type(c.ACT_TYPE.PRACTICE),g.call(a)},"sig/finalize":function(){this._htmlPromise=null},"sig/render":function(){var a=this;return h.call(a)},"hub/typing-table/interaction":function(a){return this.publishInteraction(a)},completed:d.around(function(a){return function(b){var c=this;return!c.hasScoring&&b&&c.publish("activity/template/typing-table/show-non-graded-feedback"),a.call(this,b)}}),nextStep:function(){var a=this;a.index(++a._json.curPage),h.call(a)}};return c.extend(i,l)}),define("troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-exercise/main.html",[],function(){return function(a){var b="",a=a||{},c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"},d=a.references.aud||a.isGraded,e=a.content.modelText,f=function(){return d&&!e?"ets-act-wtc-l_ne":!d&&e?"ets-act-wtc-nl_e":d||e?"ets-act-wtc-l_e":"ets-act-wtc-nl_ne"}();return b+='\n<div class="ets-act-wtc">\n    ',d&&(b+='\n    <div class="ets-act-wtc-l ets-act-wtc-grade_l">\n        ',a.references.aud&&(b+='\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n        '),b+="\n        ",a.isGraded&&(b+="\n        <div class='ets-act-wtc-fb'>\n            <div class=\"ets-act-wtc-fb-nsmtd ets-act-wtc-fb-none\">\n                <p "+c(461312,"Your answer will be sent to a teacher for review")+'></p>\n            </div>\n            <div class="ets-act-wtc-fb-smtd ets-act-wtc-fb-none">\n                <div class="ets-act-wtc-fbh"></div>\n                <p class=\'ets-act-wtc-fbt\' '+c(461313,"Submitted")+"></p>\n                <p class='ets-act-wtc-fbc' "+c(423933,"Unfortunately, due to increasing student numbers, your writing assignment might take a little longer than usual to be graded. Please check your writing carefully before you click 'Submit', and make sure you follow the recommended word limit.")+"></p>\n                \x3c!--<p class='ets-act-wtc-fbc' "+c(461314,"Teacher feedback should be sent to you be email within 48 hours.")+'></p>--\x3e\n                <div class="ets-act-wtc-fbf"></div>\n            </div>\n            <div class="ets-act-wtc-fb-psd ets-act-wtc-fb-none">\n                <p class=\'ets-act-wtc-fbt\' '+c(461315,"Passed")+"></p>\n                <p class='ets-act-wtc-fbc'>\x3c!--Passed 2012.09.22 (9:15pm)--\x3e</p>\n            </div>\n            <div class=\"ets-act-wtc-fb-npsd ets-act-wtc-fb-none\">\n                <p class='ets-act-wtc-fbt' "+c(461316,"Not passed")+"></p>\n                <p class='ets-act-wtc-fbc'>\x3c!--Not passed: 2012.09.26 (6:00pm)--\x3e</p>\n            </div>\n        </div>\n        "),b+="\n    </div>\n    "),b+="\n    <div class='ets-act-wtc-r "+f+'\'>\n        <div class="ets-act-wtc-rl ets-left"></div>\n        <div class="ets-act-wtc-rm ets-left">\n            <div class=\'ets-act-wtc-ip ets-left\'>\n                <textarea data-weave="school-ui-activity/shared/textchange/main" readonly="readonly" data-at-id="txt-single-textbox"></textarea>\n            </div>\n            ',e&&(b+="\n            <div class='ets-act-wtc-expctn ets-left'>\n                <div class='ets-act-wtc-exp ets-left'>\n                    <div class='ets-act-wtc-exptxt'>\n                        "+a.content.modelText+'\n                    </div>\n                </div>\n                <div class=\'ets-act-wtc-exptg\' data-show=\'true\'></div>\n                <div class="ets-act-wtc-arctn">\n                    <span class="ets-act-wtc-ar"></span>\n                    <span class="ets-act-wtc-artxt" '+c(461311,"Show model answer")+"></span>\n                </div>\n            </div>\n            "),b+='\n        </div>\n        <div class="ets-act-wtc-rr ets-left"></div>\n        <p class="ets-act-wtc-wdscnt ets-act-wtc-clear"><span '+c(150691,"Words typed:")+'></span> <span class="ets-act-wtc-wdsnum">0</span></p>\n        ',e&&(b+='\n        <p class="ets-act-wtc-ic ets-act-wtc-clear ets-none" '+c(461317,"Compare your answer with the model text.")+"></p>\n        "),b+="\n    </div>\n</div>"}}),define("school-ui-activity/activity/writing-challenge-exercise/main",["jquery","when","school-ui-activity/activity/base/main","troopjs-core/component/factory","school-ui-activity/util/interaction","school-ui-shared/utils/progress-state","template!./main.html","underscore","jquery.jscrollpane","jquery.mousewheel","jquery.ui","jquery.transit"],function(a,b,c,d,e,f,g){"use strict";function h(){var a=this,c=a.getWritingHist().then(function(b){m.call(a,b)}),d=a.getProgress().then(function(b){o.call(a,b)}),e=a.html(g,a._json).then(function(){i.call(a)});return b.all([c,d,e])}function i(){var a=this,b=a.$element,c=b.find(A);b.find("p,span").attr("unselectable","on").attr("onselectstart","return false;"),b.find(z).bind("click",function(){c.focus()}),c.bind(T,function(){j.call(a)}),b.delegate(B,S,function(){k.call(a)}),b.find(D).jScrollPane().find("span").removeAttr("style")}function j(){var b=this,c=b.$element,d=c.find(A),e=d.val();if(e.length>x){for(var f=Math.min(e.length,u?u.length:0),g=0;g<f&&e.charAt(g)==u.charAt(g);g++);var h={start:g,end:g};d.val(u),d.scrollTop(v),setTimeout(function(){l(d.get(0),h)},0)}else u=e;v=d.scrollTop();var i=u.split(y);i&&(i=a.grep(i,function(b){return a.trim(b).length>0}));var j=i?i.length:0;j!=w&&(c.find(F).text(j),w=j),b.isDefaultState&&(void 0!=b._json.minWordCount&&void 0!=b._json.maxWordCount?(b.items().answered(j>=b._json.minWordCount),j>=b._json.minWordCount&&j<=b._json.maxWordCount?c.find(E).removeClass(N).addClass(O):c.find(E).removeClass(O).addClass(N)):b.items().answered(j)),b._json._writingContent=u}function k(a,b){var c=this,d=c.$element,e=d.find(B),f=d.find(C).stop(),g=d.find(M).stop();a=null!=a?a:"true"==e.data(P).toString();var h=a?0:-1*f.width();h||g.hide(),f.animate({"margin-left":h},300,function(){h&&g.fadeIn(),e.data(P,!a),b&&b()})}function l(a,b){if(b&&a)if(a.setSelectionRange)a.focus(),a.setSelectionRange(b.start,b.end);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveStart("character",b.start),c.moveEnd("character",b.end),c.select()}}function m(a){var b=this;b.hasHistory=a.history&&a.history.length,b.isDefaultState=!b.hasHistory&&a.feedback.toUpperCase()==U.notPassed,b.notPassed=b.hasHistory&&a.feedback.toUpperCase()==U.notPassed,b.isDefaultState?(p.call(b),q.call(b,!0)):(p.call(b,a.feedback.toUpperCase()),n.call(b,a.history),b.notPassed?(b.isDefaultState=!0,j.call(b),q.call(b,!0)):(b.publishInteraction(e.makeAlreadySubmittedWritingInteraction()),j.call(b),s.call(b),b.items().completed(!0)))}function n(a){this.$element.find(A).val(a)}function o(a){this.isActivityPassed=a&&f.hasPassed(a.state)}function p(a){function b(){switch(a){case U.waiting:d.find(J).fadeIn(Q);break;case U.notPassed:d.find(K).fadeIn(Q);break;case U.passed:d.find(L).fadeIn(Q);break;default:d.find(I).fadeIn(Q)}}var c=this,d=c.$element,e=d.find(H);e.length?e.fadeOut(Q,b):b()}function q(a){var b=this.$element,c=b.find(A);return a?c.removeAttr(R):c.attr(R,R),c}function r(){var a=this;a.publishInteraction(e.makeSubmitWritingInteraction()).then(function(){s.call(a),a.items().completed(!0),a.completed(!0),p.call(a,U.waiting)})}function s(){var a=this,b=a.$element;q.call(a,!1),k.call(a,!0,function(){b.find(E).hide(),b.find(G).fadeIn()})}function t(){v=0,u="",w=0}var u,v,w,x=2e4,y=/[,;.!:(\s)*\n\?]/g,z=".ets-act-wtc-ip",A="textarea",B=".ets-act-wtc-exptg",C=".ets-act-wtc-expctn",D=".ets-act-wtc-exptxt",E=".ets-act-wtc-wdscnt",F=".ets-act-wtc-wdsnum",G=".ets-act-wtc-ic",H=".ets-act-wtc-fb-none:visible",I=".ets-act-wtc-fb-nsmtd",J=".ets-act-wtc-fb-smtd",K=".ets-act-wtc-fb-npsd",L=".ets-act-wtc-fb-psd",M=".ets-act-wtc-arctn",N="ets-act-wtc-wdscnt-error",O="ets-act-wtc-wdscnt-correct",P="show",Q="fast",R="readonly",S="click",T="EFTextChange",U={waiting:"WAITING",notPassed:"NOPASS",passed:"PASSED"},V={"sig/initialize":function(){var a=this;a.type(c.ACT_TYPE.EXERCISE),t(a._json),a.items().savable(!0)},"sig/render":function(){return h.call(this)},activityCompleted:d.around(function(a){return function(){this.isDefaultState?a.apply(this,arguments):this.isActivityPassed||(this._json._writingContent=void 0,a.apply(this,arguments))}}),"hub/activity/check/answer":function(){this._json._writingContent&&r.call(this)}};return c.extend(V)}),define("troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-practice/main.html",[],function(){return function(a){var b="",a=a||{},c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"},d=a.references.aud,e=a.content.modelText,f=function(){return d&&!e?"ets-act-wtc-l_ne":!d&&e?"ets-act-wtc-nl_e":d||e?"ets-act-wtc-l_e":"ets-act-wtc-nl_ne"}();return b+='\n<div class="ets-act-wtc">\n     ',a.references.aud&&(b+='\n    <div class="ets-act-wtc-l ets-act-wtc-nongrade_l">\n        <div class="ets-act-ap-wrap"><div data-at-id="btn-audio-start" class="ets-act-ap">\n            <audio data-weave="school-ui-shared/widget/audio-player/main" preload="none"\n                   data-src="'+a.references.aud.url+'" type="audio/mpeg"\n                   class="ets-ap"></audio>\n        </div></div>\n    </div>\n    '),b+="\n    <div class='ets-act-wtc-r "+f+'\'>\n        <div class="ets-act-wtc-rl ets-left"></div>\n        <div class="ets-act-wtc-rm ets-left">\n            <div class=\'ets-act-wtc-ip ets-left\'>\n                <textarea data-weave="school-ui-activity/shared/textchange/main" readonly="readonly" data-at-id="txt-single-textbox"></textarea>\n            </div>\n            ',e&&(b+="\n            <div class='ets-act-wtc-expctn ets-left'>\n                <div class='ets-act-wtc-exp ets-left'>\n                    <div class='ets-act-wtc-exptxt'>\n                        "+a.content.modelText+'\n                    </div>\n                </div>\n                <div class=\'ets-act-wtc-exptg\' data-show=\'true\'></div>\n                <div class="ets-act-wtc-arctn">\n                    <span class="ets-act-wtc-ar"></span>\n                    <span class="ets-act-wtc-artxt" '+c(461311,"Show model answer")+"></span>\n                </div>\n            </div>\n            "),b+='\n        </div>\n        <div class="ets-act-wtc-rr ets-left"></div>\n        <p class="ets-act-wtc-wdscnt ets-act-wtc-clear"><span '+c(150691,"Words typed:")+'></span> <span class="ets-act-wtc-wdsnum">0</span></p>\n        ',e&&(b+='\n        <p class="ets-act-wtc-ic ets-act-wtc-clear ets-none" '+c(461317,"Compare your answer with the model text.")+"></p>\n        "),b+="\n    </div>\n</div>"}}),define("school-ui-activity/activity/writing-challenge-practice/main",["jquery","when","school-ui-activity/activity/base/main","troopjs-core/component/factory","school-ui-shared/utils/progress-state","template!./main.html","underscore","jquery.jscrollpane","jquery.mousewheel","jquery.ui","jquery.transit"],function(a,b,c,d,e,f){"use strict";function g(){var a=this,c=a.getWritingHist().then(function(b){o.call(a,b)}),d=a.getProgress().then(function(b){q.call(a,b)}),e=a.html(f,a._json).then(function(){h.call(a)});return b.all([c,d,e])}function h(){var a=this,b=a.$element,c=b.find(y);b.find("p,span").attr("unselectable","on").attr("onselectstart","return false;"),b.find(A).bind("click",function(){c.focus()}),c.bind(K,i.bind(a)),b.delegate(z,J,function(){j.call(a)}),b.find(C).jScrollPane().find("span").removeAttr("style")}function i(){var b=this,c=b.$element,d=c.find(y),e=d.val();if(e.length>w){for(var f=Math.min(e.length,t?t.length:0),g=0;g<f&&e.charAt(g)==t.charAt(g);g++);var h={start:g,end:g};d.val(t),d.scrollTop(u),setTimeout(function(){k(d.get(0),h)},0)}else t=e;u=d.scrollTop();var i=t.split(x);i&&(i=a.grep(i,function(b){return a.trim(b).length>0}));var j=i?i.length:0;j!=v&&(c.find(E).text(j),v=j),b.isDefaultState&&b.items().answered(j),b._json._writingContent=t}function j(a,b){var c=this,d=c.$element,e=d.find(z).stop(),f=d.find(B),g=d.find(G).stop();a=null!=a?a:"true"==e.data(H).toString();var h=a?0:-1*f.width();h||g.hide(),f.animate({"margin-left":h},300,function(){h&&g.fadeIn(),e.data(H,!a),b&&b()})}function k(a,b){if(b&&a)if(a.setSelectionRange)a.focus(),a.setSelectionRange(b.start,b.end);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveStart("character",b.start),c.moveEnd("character",b.end),c.select()}}function l(a){var b=this.$element,c=b.find(y);return a?c.removeAttr(I):c.attr(I,I),c}function m(){n.call(this),this.items().completed(!0)}function n(){var a=this,b=a.$element;l.call(a,!1),j.call(a,!0,function(){b.find(D).hide(),b.find(F).fadeIn()})}function o(a){var b=this;b.hasHistory=a.history&&a.history.length,b.isDefaultState=!b.hasHistory,b.isDefaultState?l.call(b,!0):p.call(b,a.history)}function p(a){var b=this;b.$element.find(y).val(a),i.call(b),n.call(b),b.items().completed(!0)}function q(a){this.isActivityPassed=a&&e.hasPassed(a.state)}function r(){var a=this,b=a.$element;a._json._writingContent="",a.hasHistory=!1,a.isDefaultState=!0,a.completed(!1),l.call(a,!0).val("").focus(),i.call(a),j.call(a,!1,function(){b.find(F).hide(),b.find(D).fadeIn()})}function s(){u=0,t="",v=0}var t,u,v,w=2e4,x=/[,\;.!:(\s)*\n\?]/g,y=".ets-act-wtc-ip textarea",z=".ets-act-wtc-exptg",A=".ets-act-wtc-ip",B=".ets-act-wtc-expctn",C=".ets-act-wtc-exptxt",D=".ets-act-wtc-wdscnt",E=".ets-act-wtc-wdsnum",F=".ets-act-wtc-ic",G=".ets-act-wtc-arctn",H="show",I="readonly",J="click",K="EFTextChange",L={"sig/initialize":function(){var a=this;a.type(c.ACT_TYPE.PRACTICE),s(a._json),a.items().savable(!0)},"sig/render":function(){return g.call(this)},activityCompleted:d.around(function(a){return function(){this.isDefaultState?(a.apply(this,arguments),this._onAnswerChecked()):this.isActivityPassed||(this._json._writingContent=void 0,a.apply(this,arguments),this._onAnswerChecked())}}),retryActivity:function(){r.call(this)},_onAnswerChecked:function(){var a=this;a._json._writingContent&&m.call(a)}};return c.extend(L)}),define("school-ui-activity/application",["compose","jquery","troopjs-utils/deferred","troopjs-utils/when","troopjs-utils/tr","troopjs-utils/grep","troopjs-utils/uri","troopjs-ef/widget/application","troopjs-ef/data/cache","troopjs-core/route/router","troopjs-core/remote/ajax","troopjs-ef/service/query","school-ui-study/service/config","school-ui-study/service/context","school-ui-study/service/load"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,f){var g=this,h=e.call(g[u],function(b,d){return c(function(c){b.signal(a,c)})});return f&&d.apply(b,h).then(f.resolve,f.reject,f.notify),g.publish("application/signal/"+a,f),g}function q(){var a=this,c=a[s],d=a[w];if(c&&d&&(c[t]||{}).id!==d.id&&c[v]){var e=!1;b.each(c[v],function(a,b){if(d.id===b.id)return e=!0,!1}),e||(window.location.hash="",window.location.reload())}}var r=/^\w+!/,s="context",t="currentEnrollment",u="services",v="enrollments",w="reqEnrollment";return h.extend(function(a,c){var d=b(window),e=i();this[u]=[j(d),k(),l(e),m(e),n(),o()]},{"sig/initialize":p,"sig/finalize":p,"sig/start":p,"sig/stop":p,"hub:memory/route":function(a,b){var c=this;c.update(c[s],c.uri=b)},"hub:memory/context":function(a,b){var c=this,d=arguments[arguments.length-1];c.update(c[s]=b,c.uri,d),d||q.call(c)},"hub:memory/load/enrollment":function(a,b){var c=this;c[w]=b,q.call(c)},update:function(a,b,d){var f=this;a&&b&&(d||!b.path)&&t in a&&c(function(b){f.query(a[t].id,b)}).done(function(a){b.path=g.Path(e.call(["school",a,a.course,a.level,a.unit],function(a,b){return a=a||"",a.id?a.id.replace(r,""):a})),f.route(b)})}})}),define("troopjs-requirejs/template!school-ui-activity/launcher/launcher.html",[],function(){return function(a){return'<div class="ets-act-bd-activity">\n\t\x3c!--render activity here--\x3e\n</div>\n<div class="ets-act-bd-ft" data-weave="school-ui-activity/shared/question-number/main"></div>'}}),define("school-ui-activity/launcher/main",["jquery","troopjs-ef/component/widget","when","school-ui-shared/utils/typeid-parser","template!./launcher.html"],function(a,b,c,d,e){return b.extend(function(a,b,c){var d=this;d._json=c.activityContent,d.target=c.target,d._option=c},{"sig/start":function(){var a=this;return a.html(e).then(function(){return a.$element.find(".ets-act-bd-activity").data("option",a._option).attr("data-at-id","activity-container").attr("data-at-activity-id",d.parseId(a._option.act_id)).attr("data-weave",a.target+"(option)").weave()})},"sig/finalize":function(){var a=this;delete a._json,delete a._option}})}),define("school-ui-activity/shared/asr/asr-blurbs",["troopjs-core/pubsub/hub"],function(a){"use strict";var b={ASRSwitchTyping:"467532",ASRSwitchSelecting:"467436",ASRSwitchNext:"467435",ASRClientErrSkip:"468589",ASRClientErrType:"468590",ASRClientErrSelect:"468591",IntroTitle:"492075",IntroDes:"492076",IntroButton:"492077",Checking:"492078",CheckingDes:"492079",MicFail:"492080",MicFailDes:"492081",MicFailCheckButton:"492082",SkipReason1:"492083",SkipReason2:"492084",SkipReason3:"492085",PriSetDes:"492086",PriSetOpen:"492087",PriSetAllow:"492088",PriSetRem:"492089",PriSetClose:"492090",PriSetBut:"492091",ReadyGo:"492092",ReadyGoDes:"492093",ReadyGoBut:"492094",Other:"450011",ASRAlterMsg:"626864",ASRAlterSkipMsg:"626863",TOPIC_NOT_RECOGNIZE:"626843",TOPIC_TOO_HIGH:"626845",TOPIC_TOO_LOW:"626847",TOPIC_TOO_SLOWLY:"626849",TOPIC_TOO_FAST:"626851",TOPIC_MIC_NO_VOICE:"626853",TOPIC_TECH_ERROR:"626855",TOPIC_RETRY:"626859",TOPIC_3_FAIL:"626862",MSG_NOT_RECOGNIZE:"626844",MSG_CHECK_MIC_HIGH:"626846",MSG_CHECK_MIC_LOW:"626848",MSG_TRY_FASTER:"626850",MSG_TRY_SLOWLY:"626852",MSG_CHECK_NOT_MUTE:"626854",MSG_TIMEOUT:"626856",MSG_FLASH_ERROR:"626857",MSG_SERVER_ERROR:"626858",MSG_INCORRECT_PRONUN:"626860",MSG_INCORRECT_ANSWER:"626861",MSG_SKIP:"626863",MSG_TRY_NON_SPEAKING:"626864"},c={},d=Object.keys(b),e=d.map(function(a){return"blurb!"+b[a]});return c.loadedPromise=a.publish("query",e).then(function(a){return d.forEach(function(b,d){c[b]=a[d].translation}),c}),c}),define("school-ui-activity/shared/asr/asr-config",[],function(){return{LIMIT_FAILED_TIMES:3,DEBUG_ASR_ENABLED:location.search.indexOf("debugasr")>=0}}),define("school-ui-activity/shared/asr/guid",[],function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)}).toUpperCase()}}),define("troopjs-requirejs/template!school-ui-activity/shared/asr/asr-debug/asr-debug.html",[],function(){return function(a){for(var b="<h1>ASR DEBUGGER TOOL</h1>\n<p>------------------------------------------------------------------------</p>\n",c=0;c<a.length;c++)!function(a,c){b+='\n\t<button class="asr-debug-submit" data-errorcode="'+a+'">'+c+"("+a+")</button>\n"}(a[c].code,a[c].msg);return b+="\n\n",b+='\n<p>------------------------------------------------------------------------</p>\n<input style="width: 400px" id="correctAnswerUrl" type="text" placeholder="CORRECT_ANSWER_URL"/>\n<button class="asr-debug-submit" data-action=\'recorder\'>SUBMIT</button>'}}),define("school-ui-activity/shared/asr/asr-debug/main",["jquery","when","troopjs-ef/component/widget","../guid","template!./asr-debug.html"],function(a,b,c,d,e){"use strict";var f,g,h;return c.extend({"hub:memory/asr/inited":function(a){var b=this;b.recorderService=a;var c=[{code:80,msg:"NO_VOICE"},{code:85,msg:"VOICE_TOO_LOW"},{code:6,msg:"VOICE_TOO_HIGH"},{code:86,msg:"VOICE_TOO_HIGH"},{code:61,msg:"GET_RESULT_TIMEOUT"},{code:1,msg:"DICTIONARY_ERROR"}];b.html(e,c)},"hub:memory/asr/debuggerTool":function(a,b){f=b.pronsXML,g=a,h=b},"dom:.asr-debug-submit/click":function(c){var e=this,i=d();e.publish("asr/set/guid",i),e.publish("asr/set/callback",g,i),e.publish("asr/set/source",h,i);var j,k=a(c.currentTarget),l=k.data("errorcode");if(l)j=e.query("ccl!'school.serverasr.nonstreaming.flash.relativepath'").spread(function(a){var b=a.value.replace("recorder.swf","");return e.publish("ajax",{url:b+l+".txt"}).then(function(a){return{xml:a,audioUrl:b+l+".wav"}})});else{if(!f)return;j=b.resolve({xml:f,audioUrl:e.$element.find("#correctAnswerUrl").val()})}j.then(function(a){e.publish("asr/service/setting",{pronsXML:a.xml}),e.recorderService.getRecorder().testClientRecording(i,"/asr/handlers",a.xml,"ASR.asrHubProxy",88888888,99999999,!1,a.audioUrl)})}})}),define("school-ui-activity/shared/asr/asr-states",[],function(){return{START:"START",COMPLETE:"COMPLETE",FEEDBACK:"FEEDBACK",FAILED:"FAILED",ERROR:"ERROR",NOMIC:"NOMIC",UNMUTED:"UNMUTED",MUTED:"MUTED"}}),define("school-ui-activity/shared/asr/asr-logger",["jquery","json2","./asr-config"],function(a,b,c){"use strict";var d={};return window.console?d.log=function(a){window.console.log("JS: "+b.stringify(a))}:d.log=function(){},c.DEBUG_ASR_ENABLED&&(d.log=function(c){return function(d){"object"==typeof d&&(d=b.stringify(d)),a(".ets-fn-asr-console").append("<li>"+d+"</li>"),c(d)}}(d.log)),d}),define("school-ui-activity/shared/asr/asr-trace-event-type",[],function(){return{DEFAULT:70,START:71,PREPARE:72,STOP:73,COMPLETE:74,PROCESSING:75,CALLBACK_COMPLETE:76,RECORDING_COMPLETE:77,INTERUPT:78,EVALUTE:79,SERVER_UNAVALIABLE:80,CONTEXT_NULL:81,READY_FOR_RECORD:83,UI_TIMEOUT:84,SEND_GRAMMAR_XML:101,AUDIO_DURATION:103,AUDIO_ENCODE_TIME:104,TOTAL_TIME:108,FLASH_ERROR:85}}),define("school-ui-activity/shared/asr/asr-trace",["module","jquery","json2","troopjs-ef/component/gadget","school-ui-shared/utils/browser-check","school-ui-shared/utils/typeid-parser","./asr-logger","./asr-trace-event-type"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b,c){if(a&&this._isReady){var d,e,f=this,i=b||h.DEFAULT,k=c,l=a;d=3,e={ProcessGuid:l,student_id:n,Activity_id:m,CustomerOS:r,Broswer:q,AsrType:d,Token:o,EventLevel:t,EventType:i,EventDesc:k},f.publish(u,j(e)).ensure(function(a){g.log("ASR Event, type: "+i+", desc: "+c+", Response is : "+(a&&a.responseText))})}}function j(a){var b=["ProcessGuid="+a.ProcessGuid,"student_id="+a.student_id,"Activity_id="+a.Activity_id,"CustomerOS="+a.CustomerOS,"Broswer="+a.Broswer,"NativeAsrVersion="+a.NativeAsrVersion,"AsrType="+a.AsrType,"Token="+a.Token,"EventLevel="+a.EventLevel,"EventType="+a.EventType,"EventDesc="+a.EventDesc].join("&");return{type:"GET",url:p.asrLogUrl,headers:p.headers,cache:!1,data:b,processData:!1,contentType:s}}function k(){this._isReady=!1,l.call(this)}function l(){n&&m&&(this._isReady=!0)}var m,n,o,p=b.extend({asrLogUrl:"/services/school/courseware/LogAsrTracking.ashx",headers:{}},a.config()||{}),q=e.browser+e.version,r=navigator.platform,s="application/json; charset=utf-8",t=3,u="ajax",v={"hub:memory/context":function(a){a&&(n=f.parseId(a.user.id),l.call(this))},"hub:memory/start/load/activity":function(a){a&&(m=f.parseId(a.id),l.call(this))},log:i};return d.extend(k,v)}),define("school-ui-activity/shared/asr/asr-service-failed-type",[],function(){return{WARN:"warn",MSG:"message",CONN:"connect",EVA:"evaluate",COMM:"common",CRASH:"crash"}}),define("school-ui-activity/shared/asr/asr-service",["module","jquery","when","troopjs-ef/component/service","troopjs-core/pubsub/hub","school-ui-shared/utils/typeid-parser","json2","school-ui-shared/utils/browser-check","./asr-states","./asr-ui-states","./asr-blurbs","./asr-config","./asr-logger","./asr-trace","./asr-trace-event-type","./asr-service-failed-type","./asr-service-message-type","underscore"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a){if(!a)return b;if("msie"===h.browser&&parseInt(h.version,10)<=9&&"[object String]"===Object.prototype.toString.call(a)){var c=new ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(a),b(c)}return b(a)}function t(a){var b,c={80:"NO_VOICE",3:"VOICE_TOO_SLOW",4:"VOICE_TOO_FAST",5:"VOICE_TOO_LOW",85:"VOICE_TOO_LOW",6:"VOICE_TOO_HIGH",86:"VOICE_TOO_HIGH",7:"CAN_NOT_RECOGNIZE",8:"CAN_NOT_RECOGNIZE"},d=parseInt(a,10);return d&&(b=c[d]&&q[c[d]]?q[c[d]]:"SERVER_ERROR"),b}function u(a,b,c,d){a.publish(I+b,c,d)}function v(a){if(a){var b,c=["text","txt"];return c.forEach(function(c){if(a[c])return b=a[c].replace(/-/g," - ").replace(/\s+/g," ").split(" "),!1}),b}}function w(a){return g.parse(g.stringify(a))}function x(a,b){var c=w(a),d=H[D],e=G[D];if(d)if(0===c.length){d=d.join(" ").replace(/\s{1}-\s{1}/g,"-").split(" ");for(var f={sentence:d.join(" "),score:0,words:[]},g=0;g<d.length;g++)f.words.push({word:d[g],score:0});c.push(f)}else{c[0].sentence=d.join(" ");for(var h=c[0].words,i=0,j=0;i<h.length&&j<d.length;)"-"!=d[j]?(h[i].word=d[j],i++,j++):(i>0&&(h[i-1].word+="-"),j++)}delete H[D],c._hasError=b,r.isFunction(e)&&e(c)}function y(a){var b=[j.BROKEN,j.DOWN];return r.indexOf(b,a)>-1}function z(a){a&&(m.log(a),this.trace(o.TOTAL_TIME,a.totalTime).trace(o.AUDIO_DURATION,a.audioDuration).trace(o.AUDIO_ENCODE_TIME,a.encodeTime))}function A(){return this.publish("tech-check/request",[{id:"flash-setting"},{id:"chrome-auth"}])}var B,C,D,E={},F={flv:void 0,recordMaxLength:6e5,autostopTime:5,micGain:80,silenceLevel:5,asrServerAddress:"rtmp://speechtest.englishtown.com:1935/asrstreaming",asrServerResultUrl:"/asr/Evaluate.ashx",activityId:"",memberId:"",disableScoreRecording:!1,beforeDelay:5,afterDelay:2,level:60,length:600,asrThreshold:70},G={},H={},I="asr/ui/",J=b.extend({asrEvalzipBaseUrl:window.location.protocol+"//"+window.location.host,asrEvalzipPathPrefix:"/asr/handlers"},a.config()||{});return d.extend(function(){this.state(j.DISABLE),this.setFailedTimes(null,!0),this.traceInstance=n.create()},{displayName:"server-client","sig/start":function(){return this.publish("asr/service/started"),this.state(j.NORMAL),c.all([k.loadedPromise,this.traceInstance.start()])},"sig/stop":function(){G={},this.state()===j.RECORDING&&(this.stopRecord(),this.reset())},"hub:memory/asr/inited":function(a){this.recorderService=a},"hub/asr/service/setting":function(a){this.setting(a)},"hub/asr/reset":function(){this.reset()},"hub/asr/set/common/failed/times":function(a){this.state()===j.NORMAL&&this.state(a,this.setFailedTimes(p.COMM))},"hub/asr/reset/failed/times":function(){var a=[j.PROCESSING,j.PREPARING,j.RECORDING];r.indexOf(a,this.state())>-1||this.setFailedTimes(null,!0)},"hub/before/loadActivity":function(){this.reset(),this.setFailedTimes(0,!0)},"hub/asr/enable":function(){var a=this,b=a.state();if(a.GUID(null),y(b)&&!a._reseted)return b===j.BROKEN&&a.setFailedTimes(null,!0),void m.log("Can't force ASR enable, current state is: "+b);a.state(j.NORMAL),a._reseted=!1,m.log("Force ASR enable")},"hub/asr/disable":function(){var a=this;a.state()===j.BROKEN&&a.setFailedTimes(null,!0),a.GUID(null),clearTimeout(C),a.state(j.DISABLE),m.log("Force ASR disable")},"hub/asr/isEnabled":function(){return this.isASREnabled()},"hub/asr/start/record":function(a,b,c){this.startRecord(a,b,c)},"hub/asr/stop/record":function(){this.stopRecord()},"hub/asr/show/message":function(a){var b=this;b.state()===j.NORMAL&&b.message(a)},"hub/asr/startPlayback":function(){var a=this.state(),b=[j.NORMAL,j.COMMON,j.HINT,j.WARNING,j.ERROR];this.isPlaying||-1===b.indexOf(a)||(this.state(j.DISABLE),this.isPlaying=!0,this.startPlayback())},"hub/asr/stopPlayback":function(){this.state()===j.DISABLE&&(this.isPlaying=!1,this.state(j.NORMAL),this.stopPlayback())},"hub:memory/start/load/activity":function(a){a&&(F.activityId=f.parseId(a.id))},"hub:memory/load/level":function(a){var b=this;a&&b.query("ccl!'school.asr.threshold.setting'").spread(function(b){var c=g.parse(b.value)||{default:70},d=a.levelNo;F.asrThreshold=c.levelNo&&c.levelNo[d]||c.default})},"hub:memory/context":function(a){var b=this,c=/.*?(?=\:\/\/)/i;F.memberId=f.parseId(a.user.id),b.query('ccl!"school.AsrServerAddress"').spread(function(a){F.asrServerAddress=a&&a.value,b.defaultProtocol=F.asrServerAddress.match(c)[0]})},"hub/asr/playback/status/changed":function(a){switch(a){case"START":break;case"COMPLETE":this.isPlaying=!1,this.state(j.NORMAL),this.publish("audio/shell/play/complete",this.GUID())}},"hub/asr/set/guid":function(a){this.GUID(a)},"hub/asr/set/callback":function(a,b){G[b]=a},
"hub/asr/set/source":function(a,b){H[b]=v(a)},state:function(a,b){b=b||0;var c=this,d=[].slice.call(arguments,0),e=c.isPlaying,f=E[p.CRASH]>0,g=b<l.LIMIT_FAILED_TIMES;return a&&a!==B&&(d[0]=B=f||g||e?a:a=j.BROKEN,d.unshift("asr/ui/states/changed"),c.publish.apply(c,d),a===j.PROCESSING?c._processTimeout=setTimeout(function(){c.message(q.TIMEOUT),c.trace(o.UI_TIMEOUT,"UI processing timeout!"),c.GUID(null)},3e4):clearTimeout(c._processTimeout)),B},message:function(a){var b,c=this,d=c.setFailedTimes(p.MSG);switch(clearTimeout(C),a=a.toUpperCase(),d>=l.LIMIT_FAILED_TIMES?a=q.FALLBACK:C=setTimeout(function(){var a=c.state();a!==j.WARNING&&a!==j.ERROR||c.state(j.NORMAL)},5e3),a){case q.FALLBACK:b=j.BROKEN;break;case q.INCORRECT_ANSWER:u(c,"hint",k.TOPIC_RETRY,k.MSG_INCORRECT_ANSWER),b=j.HINT;break;case q.INCORRECT_PRONUN:u(c,"hint",k.TOPIC_RETRY,k.MSG_INCORRECT_PRONUN),b=j.HINT;break;case q.VOICE_TOO_SLOW:u(c,"warning",k.TOPIC_TOO_SLOWLY,k.MSG_TRY_FASTER),b=j.WARNING;break;case q.VOICE_TOO_FAST:u(c,"warning",k.TOPIC_TOO_FAST,k.MSG_TRY_SLOWLY),b=j.WARNING;break;case q.VOICE_TOO_HIGH:u(c,"warning",k.TOPIC_TOO_HIGH,k.MSG_CHECK_MIC_HIGH),b=j.WARNING;break;case q.VOICE_TOO_LOW:u(c,"warning",k.TOPIC_TOO_LOW,k.MSG_CHECK_MIC_LOW),b=j.WARNING;break;case q.NO_VOICE:u(c,"warning",k.TOPIC_MIC_NO_VOICE,k.MSG_CHECK_NOT_MUTE),b=j.WARNING;break;case q.CAN_NOT_RECOGNIZE:u(c,"warning",k.TOPIC_NOT_RECOGNIZE,k.MSG_NOT_RECOGNIZE),b=j.WARNING;break;case q.TIMEOUT:u(c,"error",k.TOPIC_TECH_ERROR,k.MSG_TIMEOUT),b=j.ERROR;break;case q.FLASH_ERROR:u(c,"error",k.TOPIC_TECH_ERROR,k.MSG_FLASH_ERROR),b=j.ERROR;break;case q.SERVER_ERROR:default:u(c,"error",k.TOPIC_TECH_ERROR,k.MSG_SERVER_ERROR),b=j.ERROR}b===j.WARNING||b===j.HINT?c.publish("asr/ui/playback",!0):c.publish("asr/ui/playback",!1),c.state(b)},setFailedTimes:function(a,b,c){var d,e;if(c=c||1,a)E[a]+=b?0:c;else if(b)for(d in p)r.has(p,d)&&(e=p[d],E[e]=0);return this.getFailedTimes()},getFailedTimes:function(){var a,b,c=0;for(a in p)r.has(p,a)&&(b=p[a],c+=E[b]);return c},GUID:function(a){return(!D||void 0!==a&&D!==a)&&(D=a),D},setting:function(a){var b=this;return b._settings=b._settings||r.extend({},F),a?r.extend(b._settings,a):b._settings},callback:function(a){return G[a||D]},recognizeComplete:function(a){if(D){var c=this,d=[],e=s(a),f=e.attr("error")||e.find("TPResult").attr("error"),h=e.attr("error")||e.find("TPResult").attr("reason")||"",i=F.asrThreshold;f?(m.log("Error:"+f+" Reason: "+h),c.message(t(f)),x(d,!0)):(e.find("Sentence").each(function(){var a=b(this),c={sentence:a.attr("trans"),index:Number(a.attr("id")),similarity:Number(a.attr("score"))};c.words=[],a.find("Word").each(function(){var a=b(this);c.words.push({word:a.attr("trans"),similarity:Number(a.attr("score"))})}),d.push(c)}),m.log("threshold:"+i),r.each(d,function(a){r.each(a.words,function(a){a.score=a.similarity<i?0:100}),a.score=a.similarity<i?0:100,m.log("similarity:"+g.stringify(a))}),c.state(j.NORMAL),x(d),c.trace(o.RECORDING_COMPLETE,"RecognizeCompleted"))}},startRecord:function(a,b,c){var d=this,e=d.setting();if(!this.isASREnabled())return void d.state(j.DOWN,d.setFailedTimes(p.CRASH,!1,l.LIMIT_FAILED_TIMES));d.setting(c),d.state(j.PREPARING),d.GUID(a),G[D]=G[D]||b,H[D]=v(c),setTimeout(function(){d.state()===j.RECORDING?d.stopRecord():(d._startTime=(new Date).getTime(),d.trace(o.START,"Start")),d.trace(o.SEND_GRAMMAR_XML,"Send ASR grammar xml text");var b=d.recorderService&&d.recorderService.getRecorder();b&&b.startClientRecording?b.startClientRecording(a,J.asrEvalzipBaseUrl+J.asrEvalzipPathPrefix,e.pronsXML,"ASR.asrHubProxy",e.memberId,e.activityId,e.disableScoreRecording):d.state(j.NORMAL)})},stopRecord:function(){this.state(j.PROCESSING),this.isASREnabled()&&this.recorderService.getRecorder().stopClientRecording()},startPlayback:function(){this.isASREnabled()&&this.recorderService.getRecorder().startClientPlayback("ASR.playStatusCallback")},stopPlayback:function(){this.isASREnabled()&&this.recorderService.getRecorder().stopClientPlayback()},isASREnabled:function(){var a=this.recorderService&&this.recorderService.getRecorder(),b=Boolean(a)&&null!==a.stopClientPlayback;return m.log("Check ASR: "+b),b},reset:function(){var a=this;clearTimeout(C),a.GUID(null),a.isPlaying=!1,a._reseted=!0,a._settings=null,a.state()===j.RECORDING&&a.stopRecord(),clearInterval(this._asrInterval),this.setFailedTimes(p.EVA,!0)},"hub/asr/record/success":function(a){var b=this.GUID(),c=this,d=a[0];if(b&&a)switch(clearInterval(this._asrInterval),m.log("recorder response status, state is: "+a[0]+", message is: "+a[1]),d){case i.START:c.trace(o.READY_FOR_RECORD,c._startTime?(new Date).getTime()-c._startTime:0),delete c._startTime,c.state(j.RECORDING),c._asrInterval=setInterval(function(){var a=c.recorderService&&c.recorderService.getRecorder();if(!a||!a.getMicActivity)return void clearInterval(c._asrInterval);var b=a.getMicActivity();c.publish("asr/ui/recording",b)},100);break;case i.COMPLETE:c.publish("asr/recording/stopped"),c.state(j.PROCESSING),c.trace(o.COMPLETE,"Complete");break;case i.FEEDBACK:c.onRecordFeedback.apply(c,a);break;case i.FAILED:c.onRecordFailed.apply(c,a);break;case i.ERROR:c.message(q.FLASH_ERROR),c.trace(o.FLASH_ERROR,a[1]||"Unknown Flash Error!");break;case i.NOMIC:c.state(j.NORMAL),A.call(c);break;case i.UNMUTED:c.state(j.NORMAL);break;case i.MUTED:c.state(j.NORMAL),A.call(c)}},onRecordFeedback:function(a,b){var c=this,d=c.setting(),e=c.callback();z.call(c,b),d.pronsXML&&b?c.recognizeComplete(b.result):(e&&e(),c.state(j.NORMAL))},onRecordFailed:function(){var a=this;a.publish("asr/connection/failed"),a.state()===j.PROCESSING&&a.message(q.FLASH_ERROR),a.trace(o.SERVER_UNAVALIABLE,"ASR Server Unavaliable")},trace:function(a,b){return this.traceInstance.log(this.GUID(),a,b),this}})}),define("school-ui-activity/shared/asr/asr-recorder-service-html5",["require","jquery","when","troopjs-ef/component/service","./asr-states","asr-core"],function(a,b,c,d,e,f){function g(){var a=this,b=Array.prototype.slice.call(arguments);a.publish(k,b)}function h(a,b,c,d,h,i,j,k){var l=this;return f.startClientRecording({basename:a,files:[{filename:a+".context",content:c}],onlyPlayback:Boolean(j),audioElement:k}).then(function(c){return g.call(l,e.START,a),c.resultPromise.then(function(c){if(g.call(l,e.COMPLETE,a),j)return void g.call(l,e.FEEDBACK,null);var d=Date.now(),f=0;c.timers&&(d=c.timers.endRecording||d,f=(c.timers.zip||d)-d);var k=b+"/evalzip.ashx?guid="+a+"&student_id="+h+"&activity_id="+i;l.publish("ajax",{type:"POST",url:k,contentType:"application/zip",data:c.zip,processData:!1,dataType:"text"}).then(function(a){var b=Date.now()-d;g.call(l,e.FEEDBACK,{result:a[0],totalTime:b,encodeTime:f,audioDuration:c.duration,audioSize:c.zip.size})},function(a,b,c){g.call(l,e.FAILED,c)})})},function(a){g.call(l,e.ERROR,a)})}function i(){var a=this,c=b.extend({},f);c.startClientRecording=function(b,c,d,e,f,g,i){h.call(a,b,c,d,e,f,g,i,null)},c.testClientRecording=function(b,c,d,f,i,j,k,l){var m=document.createElement("audio");m.controls=!1,m.preload="auto",m.muted=!0,m.addEventListener("ended",function(){document.body.removeChild(m)}),m.addEventListener("error",function(b){document.body.removeChild(m),g.call(a,e.ERROR,b)}),m.addEventListener("canplaythrough",function e(){m.removeEventListener("canplaythrough",e),m.pause(),setTimeout(function(){m.muted=!1,m.currentTime=0,h.call(a,b,c,d,f,i,j,k,m)},0)}),m.src=l,document.body.appendChild(m),m.play()},c.startClientPlayback=function(){a.publish(l,"START"),f.startClientPlayback().then(function(){a.publish(l,"COMPLETE")})},this[j]=c}var j="_recorder",k="asr/record/success",l="asr/playback/status/changed";return d.extend({"sig/start":function(){return i.call(this)},getRecorder:function(){return this[j]}})}),define("school-ui-activity/util/ccl-cache-server",[],function(){return"http:"===location.protocol?"ccl!'configuration.servers.cache'":"ccl!'configuration.servers.cachesecure'"}),define("school-ui-activity/shared/asr/asr-recorder-service-flash",["require","jquery","when","troopjs-ef/component/service","school-ui-shared/utils/browser-check","school-ui-activity/util/ccl-cache-server","./asr-logger"],function(a,b,c,d,e,f,g){function h(){return this.query(f).spread(function(a){return a&&a.value||""})}function i(){return this.query(s).spread(function(a){return a&&a.value})}function j(){return c.promise(function(b){a(["swfobject"],b)})}function k(a){var d=this,f=window.ASR=window.ASR||{};return f.asrHubProxy=function(){var a=[].slice.call(arguments,0);a.length?d.publish(t,a):d.publish(u)},f.playStatusCallback=function(a){d.publish(v,a)},c.all([h.call(d),i.call(d),j()]).spread(function(f,g,h){a.append(b("<div></div>",{id:n}));var i=c.promise(function(a){window.asrRecorderInit=a}),j={init:"asrRecorderInit"},k={},l={},s=f+g;return"msie"===e.browser&&(s+="?"+ +new Date),k.quality="high",k.bgcolor="#ffffff",k.allowscriptaccess="always",k.allowfullscreen="true",k.allowDomain="true",k.wmode="transparent",l.id=o,l.name=o,l.align="middle",h.embedSWF(s,n,q,r,"10.0.0","playerproductinstall.swf",j,k,l,function(a){d[m]=a.ref}),h.createCSS(p,"display:block;text-align:left;"),i}).otherwise(function(a){throw g.log("Server ASR Exception:"+(a&&a.stack)||a),a})}var l="_asrFlashContainer",m="_recorder",n="ets-asr-recorder",o="asr-recorder",p="#asr-recorder",q="500",r="500",s='ccl!"school.serverasr.nonstreaming.flash.relativepath"',t="asr/record/success",u="asr/record/failed",v="asr/playback/status/changed";return d.extend({"sig/start":function(){return k.call(this,this[l])},setContainer:function(a){this[l]=a},getRecorder:function(){return this[m]},"hub/asr/flash/init/append-to":function(a){var b=this;a&&(b[l].find(p).remove(),a.append('<div id="ets-asr-recorder"></div>'),k.call(b,a))}})}),define("school-ui-activity/shared/asr/asr-init",["jquery","when","troopjs-ef/component/widget","./asr-service","./asr-recorder-service-html5","./asr-recorder-service-flash","asr-core"],function(a,b,c,d,e,f,g){"use strict";return c.extend({"sig/start":function(){var a,b=this;g.isAvailable()?a=e.create():(a=f.create(),a.setContainer(b.$element)),a.start().then(function(){return b.publish("asr/inited",a)}).then(function(){return d.create().start()})}})}),define("troopjs-requirejs/template!school-ui-activity/shared/asr/asr-ui.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"};return b+='\n<div class="ets-act-asr ets-disabled" data-at-id="btn-asr-record">\n\t<div class="ets-act-playback"></div>\n\t<div class="ets-act-asr-button" data-action="record"><div class="ets-act-asr-loading"></div></div>\n\t<div class="ets-act-asr-pop ets-tip" data-at-id="pnl-message-asr-tip">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<span data-at-id="lbl-asr-tip-topic" '+c("512394","Click to record your answer")+'></span>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-message">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<span '+c("467533","Wait. Connecting...")+'></span>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-volume" data-at-id="pnl-message-asr-volume">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<span data-at-id="lbl-asr-volume-topic" '+c("512393","Click to stop recording")+'></span>\n\t\t\t<div class="ets-act-asr-indicator"><span></span></div>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-warning-pop ets-warning" data-at-id="pnl-message-asr-warning">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<h4 data-at-id="lbl-asr-warning-topic"></h4>\n\t\t\t<p data-at-id="lbl-asr-warning-content"></p>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-error-pop ets-error" data-at-id="pnl-message-asr-error">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<h4 data-at-id="lbl-asr-error-topic"></h4>\n\t\t\t<p data-at-id="lbl-asr-error-content"></p>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-hint-pop ets-hint" data-at-id="pnl-message-asr-hint">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<h4 data-at-id="lbl-asr-hint-topic"></h4>\n\t\t\t<p data-at-id="lbl-asr-hint-content"></p>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-hint-pop ets-broken" data-at-id="pnl-message-asr-switch-typing">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<h4 data-at-id="lbl-asr-switch-topic"><span '+c("626862","Sorry, it seems that we have trouble recognizing your voice")+'></span></h4>\n\t\t\t<p data-at-id="lbl-asr-switch-content" '+c("626864","Do you want to try this activity in non-speaking mode instead?")+' ></p>\n\t\t\t<div class="ets-btn ets-btn-blue ets-btn-shadowed" data-action="switch" data-at-id="btn-switch-typing-yes">\n\t\t\t\t<span '+c("506853","Yes")+' ></span>\n\t\t\t</div>\n\t\t\t<div class="ets-btn ets-btn-blue ets-btn-shadowed" data-action="cancel" data-at-id="btn-switch-typing-no">\n\t\t\t\t<span '+c("506854","No")+' ></span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-asr-pop ets-error-pop ets-down" data-at-id="pnl-message-asr-down">\n\t\t<div class="ets-hd"></div>\n\t\t<div class="ets-bd">\n\t\t\t<h4><span '+c("467530","Speech recognition error")+'></span></h4>\n\t\t\t<p>The speech recognition is not working now.</p>\n\t\t\t<div class="ets-btn-small ets-btn-blue ets-btn-shadowed" data-action="down">\n\t\t\t\t<span '+c("150652","OK")+"></span>\n\t\t\t</div>&nbsp;\n\t\t</div>\n\t</div>\n</div>"}}),define("school-ui-activity/shared/asr/asr-ui",["jquery","jquery.ui","troopjs-ef/component/widget","underscore","template!./asr-ui.html","./asr-ui-states","./asr-blurbs","./asr-config","./asr-service","./guid","school-ui-shared/utils/browser-check"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(){var a=this;if(a[p])return a._$asr&&a._$asr.length||(a._$asr=a[p].find(r),a._$fallBackContent=a._$asr.find(s),a._$brokenContent=a._$asr.find(t),a._$asr.find(u).hide()),a._$asr}function m(){this.publish("asr/reset/failed/times")}function n(b){var c=this,d=a(v);d.unweave().then(function(){return d.data("option",{_playHandler:function(){c.publish("asr/startPlayback")},_pauseHandler:function(){c.publish("asr/stopPlayback")},guid:b}).attr("data-weave","school-ui-activity/shared/audio/audio-shell(option)").weave()})}function o(){a(".ets-asr-debug").remove(),a("<div></div>").addClass("ets-asr-debug").attr("data-weave","school-ui-activity/shared/asr/asr-debug/main").appendTo("body").weave()}var p="$element",q="_id",r=".ets-act-asr",s=".ets-down .ets-bd > p",t=".ets-broken .ets-bd > p",u=".ets-act-asr-pop.ets-message",v=".ets-act-playback",w={TYPING:"TYPING",SELECT:"SELECT",NEXT:"NEXT"},x={asrFallbackType:w.NEXT,asrFallbackCb:a.noop,asrFailCb:a.noop,needResetASRFailedTimes:!1,asrEnableTip:!1},y={state:function(a){return a&&this._state!==a&&(this._state=a,this.updateUI(a)),this._state},option:function(a){return(!this._option||a&&this._option[q]!==a[q])&&(this._option=a),this._option||{prons:""}},setting:function(a){var b=this;return b._setting=b._setting||d.extend({},x),a?d.extend(b._setting,a):b._setting},toggleCls:function(a){var b=this;if(b._$asr){var c=a?"ets-act-asr "+a:"ets-act-asr";b._$asr.attr("class",c)}},updateUI:function(a){var b=this,c=b.setting(),d=c.asrFallbackType.toUpperCase();switch(a=a||b.state()){case f.BROKEN:switch(d){case w.NEXT:this._$brokenContent.text(g.ASRAlterSkipMsg);break;case w.TYPING:case w.SELECT:this._$brokenContent.text(g.ASRAlterMsg)}b.toggleCls("ets-broken");break;case f.DISABLE:b.toggleCls("ets-disabled",!0);break;case f.DOWN:switch(d){case w.NEXT:b._$fallBackContent.text(g.ASRSwitchNext);break;case w.TYPING:b._$fallBackContent.text(g.ASRSwitchTyping);break;case w.SELECT:b._$fallBackContent.text(g.ASRSwitchSelecting)}b.toggleCls("ets-down"),c.asrFailCb&&c.asrFailCb();break;case f.NORMAL:b.toggleCls(c.asrEnableTip?"ets-tip":"");break;case f.PREPARING:b.toggleCls("ets-preparing ");break;case f.PROCESSING:b.toggleCls("ets-processing ");break;case f.RECORDING:b.toggleCls("ets-recording ");break;case f.WARNING:b.toggleCls("ets-warning");break;case f.ERROR:b.toggleCls("ets-error");break;case f.HINT:b.toggleCls("ets-hint")}}};return c.extend(function(){var a=this;a.html(e).then(function(){var b=a[p];b&&(a._$indicator=b.find(".ets-act-asr-indicator span"),h.DEBUG_ASR_ENABLED&&o.call(a))})},{"sig/start":function(){return g.loadedPromise},"sig/stop":function(){this.publish("asr/reset")},"hub/asr/ui/setting":function(a,b,c){var d,e=this;e.option(b),a&&"function"==typeof a&&(e._asrCB=function(){var c=a||function(){};return 0!=b.playback&&n.call(e,e._guid),function(a){a&&a[0]&&(a[0][q]=e.option()[q]),c(a,e._guid)}}()),c&&(d=e.setting(c)),d.needResetASRFailedTimes&&m.call(e),e.updateUI(),e.publish("asr/debuggerTool",e._asrCB,e.option())},"hub:memory/asr/service/started":function(){var a=this;l.call(this),a.state(f.NORMAL),a.publish("asr/enable"),"safari"===k.browser&&parseFloat(k.version,10)>=7&&a.publish("asr/flash/init/append-to",a[p].find(".ets-act-asr-button"))},"hub/asr/ui/states/changed":function(a,b){void 0!==b&&(this._failedTimes=b),this.state(a)},"hub/asr/ui/warning":function(a,b){var c=this;c._$asr.addClass("ets-warning").find(".ets-warning .ets-bd > h4").text(a||"").end().find(".ets-warning .ets-bd > p").text(b||""),c.updateUI()},"hub/asr/ui/error":function(a,b){this._$asr.addClass("ets-error").find(".ets-error .ets-bd > h4").text(a||"").end().find(".ets-error .ets-bd > p").text(b||"")},"hub/asr/ui/hint":function(a,b){this._$asr.addClass("ets-hint").find(".ets-hint .ets-bd > h4").text(a||"").end().find(".ets-hint .ets-bd > p").text(b||"")},"hub/asr/ui/recording":function(a){var b=this;b._$indicator||(b._$indicator=b[p].find(".ets-act-asr-indicator span")),b._$indicator.css("width",a+"%")},"hub/asr/ui/playback":function(a){var b=this;if(0!=b.option().playback){var c=b[p].find(v);void 0===a?c.toggleClass("ets-act-open"):!0===a?c.addClass("ets-act-open"):c.removeClass("ets-act-open")}},'dom:[data-action="record"]/click':function(){var a=this,b=[f.PROCESSING,f.PREPARING,f.DISABLE],c=a.state()===f.DOWN&&a._failedTimes>h.LIMIT_FAILED_TIMES-1;if(-1===d.indexOf(b,a.state())&&!c)switch(a.state()){case f.WARNING:case f.HINT:case f.ERROR:a.toggleCls();case f.COMMON:case f.DOWN:case f.STOP_REPLAY:case f.NORMAL:a._guid=j(),a.publish("asr/start/record",a._guid,a._asrCB,a.option()),a.publish("asr/ui/playback",!1);break;case f.RECORDING:a.publish("asr/stop/record",a._guid)}},'dom:[data-action="down"]/click':function(){var a=this,b=this.setting();a.toggleCls("ets-disabled"),a[p].effect("fade",500,function(){b.asrFallbackCb&&b.asrFallbackCb()}).remove()},'dom:[data-action="switch"]/click':function(){var a=this;switch(a.setting().asrFallbackType.toUpperCase()){case w.NEXT:a.publish("activity-container/nextActivity");break;case w.TYPING:case w.SELECT:a[p].find('[data-action="down"]').click()}},'dom:[data-action="cancel"]/click':function(){var a=this;a.state(f.NORMAL),a.publish("asr/ui/states/changed",f.NORMAL),m.call(a)}},y)}),define("troopjs-requirejs/template!school-ui-activity/shared/audio/audio-shell.html",[],function(){return function(a){return'<div class="ets-ap-shell">\n    <div class="ets-ap ets-ap-small">\n        <button data-action="play"></button>\n    </div>\n</div>  '}}),define("school-ui-activity/shared/audio/audio-shell",["jquery","troopjs-ef/component/widget","template!./audio-shell.html"],function(a,b,c){"use strict";function d(a){this.$apShell||(this.$apShell=this.$element.find(e)),a?this.$apShell.addClass(f):this.$apShell.removeClass(f)}var e=".ets-ap-shell",f="ets-pause",g={NORMAL:"NORMAL",PLAYING:"PLAYING"};return b.extend(function(b,c,d){d?(this._playHandler=d._playHandler,this._pauseHandler=d._pauseHandler,this._guid=d.guid):this._playHandler=this._pauseHandler=a.noop},{"sig/initialize":function(){return this.html(c)},state:function(a){return a&&this._state!=a&&(this._state=a),this._state||g.NORMAL},"dom:button/click":function(b){if(!a(b.currentTarget).closest(".ets-ap").hasClass("ets-disabled"))switch(this.state()){case g.NORMAL:this._playHandler(),this.state(g.PLAYING),d.call(this,!0);break;case g.PLAYING:this._pauseHandler(),this.state(g.NORMAL),d.call(this)}},"hub/audio/shell/play/complete":function(){var a=this;a.state(g.NORMAL),setTimeout(function(){d.call(a)},0)},"hub/asr/start/record":function(){this.$element.find(".ets-ap").addClass("ets-disabled")},"hub/asr/recording/stopped":function(){this.$element.find(".ets-ap").removeClass("ets-disabled")}})}),define("troopjs-requirejs/template!school-ui-activity/shared/automation-test/automation-test.html",[],function(){return function(a){return'<input type="hidden" data-at-id="assets" />'}}),define("school-ui-activity/shared/automation-test/main",["json2","troopjs-ef/component/widget","template!./automation-test.html"],function(a,b,c){return b.extend(function(b,d,e){var f="{}";switch(typeof e){case"string":f=e;break;case"object":f=a.stringify(e)}this.html(c),b.find("[data-at-id=assets]").val(f)})}),define("school-ui-activity/shared/checkbox/main",["jquery","when","troopjs-ef/component/widget"],function(a,b,c){"use strict";function d(){var a=this;a.$input.prop("checked")?a.$wrapper.addClass(j):a.$wrapper.removeClass(j)}function e(){var a=this;return a[f].find(i).length?(a[f].find(i).wrap(),a.$input=a[f].find(i),a.$input.wrap(g),a.$wrapper=a[f].find(h),b.resolve()):b.reject(new Error("No found checkbox element"))}var f="$element",g="<span class='ets-checkbox'></span>",h=".ets-checkbox",i='input[type="checkbox"]',j="ets-checkbox-checked";return c.extend({"sig/initialize":function(){return e.call(this)},"sig/start":function(){var a=this;d.call(a)},"dom/mouseenter":function(){this.$wrapper.addClass("ets-checkbox-hover")},"dom/mouseleave":function(){this.$wrapper.removeClass("ets-checkbox-hover")},"dom/click":function(){var a=this;a.$input.prop("checked",!a.$input.prop("checked")),d.call(a)}})}),define("troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper.html",[],function(){return function(a){return'<div class="ets-act-ep-bd" data-at-id="pnl-epaper-container">\n\t<div class="ets-act-ep-main">\n\t\t<div class="ets-act-ep-content-wrap">\n\t\t\t<div class="ets-act-ep-content ets-hidden">\n\t\t\t\t\x3c!--put epaper content here--\x3e\n\t\t\t\t'+a+'\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ets-act-ep-handler" data-at-id="btn-epaper-toggle">\n\t\t\t<i class="ets-act-ep-arr"></i>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-ep-bd-shadow"></div>\n</div>'}}),define("troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper-fixed.html",[],function(){return function(a){return'<div class="ets-act-ep-bd ets-act-ep-fixed" data-at-id="pnl-epaper-container">\n    <div class="ets-act-ep-main">\n        <div class="ets-act-ep-content-wrap">\n            <div class="ets-act-ep-content ets-hidden">\n                \x3c!--put epaper content here--\x3e\n                '+a+"\n            </div>\n        </div>\n    </div>\n</div>"}}),define("school-ui-activity/shared/epaper/main",["jquery","jquery.mousewheel","when","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","template!./epaper.html","template!./epaper-fixed.html","jquery.jscrollpane"],function(a,b,c,d,e,f,g){"use strict";function h(){var b=this;if(!b[q]){var d=this._settings.expandWidth,e=this.expanded?"-=":"+=",f=this.expanded?"removeClass":"addClass";i.call(this,this.expanded),b[q]=!0,c.promise(function(a,b){n.animate({width:e+d},w).promise().then(a,b)}).then(function(){b[q]=!1,a(this)[f](t),b.expanded=!b.expanded,b.expanded||b.publish("epaper/collapse")})}}function i(a){this.publish(a?E:D)}function j(a){return c.promise(function(b){var c=new Image;c.onload=function(){b({width:c.width,height:c.height})},c.onerror=function(){b({width:null,height:null})},c.src=a})}function k(a){return'<img src="'+a+' " alt="" />'}function l(a){var b=this,d=b[p],e="fixed"===b._refereces._epaperType?g:f;a=a||C,this.expanded=!1;var i=(a.match(x)||[]).map(function(a){return a.replace(y,"")});return this.html(e,a).then(function(){n=d.find(s);var a=i.map(function(a){return a=a.replace(/'/g,"%27").replace(/"/g,"%34"),o&&(a=a+"?_"+(new Date).getTime()),j(a).then(function(b){d.find('img[src="'+a+'"]').attr({height:b.height||"auto",width:b.width||"auto"})})});return b._settings.autoExpand&&e===f&&(b._timeout=setTimeout(function(){h.call(b)},v)),c.all(a)}).then(function(){d.find(r).jScrollPane().find("img").removeAttr("height width").end().removeClass(u)})}function m(){var a=this,b=a._refereces,c=b[A]&&b[A].content?b[A].content:b[z]&&b[z].url&&k(b[z].url);a.renderDfd.resolve(c)}var n,o="msie"===e.browser&&parseInt(e.version,10)<=8,p="$element",q="_animatingToggle",r=".ets-act-ep-content",s=".ets-act-ep-bd",t="ets-expanded",u="ets-hidden",v=600,w=400,x=/(?:(src\s*=\s*[\|'|"]*)(.*?\.(jpg|png)))/g,y=/src\s*[=|'|"]+|url\s*\(['|"]*/g,z="imgPap",A="htmlPap",B={expandWidth:652,autoExpand:!0},C="Failed loading content. Please try again later.",D="activity/epaper/expanding",E="activity/epaper/folding";return d.extend(function(b,d,e,f){if(!e)throw"You must supply epaper content!";var g=this;g._refereces=e,g._settings=a.extend(!0,B,f),g[q]=!1,this.renderDfd=c.defer(),this.renderDfd.promise.then(function(a){l.call(g,a)})},{"hub:memory/course-property/load/courseTypeCode":function(){m.call(this)},"sig/start":function(){var a=this;m.call(a)},"sig/stop":function(){clearTimeout(this._timeout),n&&n.stop(!0,!0)},"dom:.ets-act-ep-handler/touchstart":function(a){a.preventDefault(),h.call(this,!0)},"dom:.ets-act-ep-handler/click":function(a){a.preventDefault(),h.call(this,!0)}})}),define("troopjs-requirejs/template!school-ui-activity/shared/question-number/main.html",[],function(){return function(a){var b='<div class="ets-wgt-qs">\n    <p class="ets-wgt-qs-desc" data-weave=\'troopjs-ef/blurb/widget\' data-blurb-id=\'467836\' data-text-en=\'question\'></p>\n    <ul class="ets-wgt-qs-index">\n        <li class="ets-wgt-qs-index-left">\n            <ul><li class="ets-wgt-qs-num">'+a._preIndex.charAt(0)+"</li>\n            ";return a._curIndex.charAt(0)!=a._preIndex.charAt(0)&&(b+='\n                <li class="ets-wgt-qs-num ets-wgt-qs-num-cur">'+a._curIndex.charAt(0)+"</li>\n            "),b+='\n            </ul>\n        </li>\n        <li class="ets-wgt-qs-index-right">\n            <ul><li class="ets-wgt-qs-num">'+a._preIndex.charAt(1)+"</li>\n            ",a._curIndex.charAt(1)!=a._preIndex.charAt(1)&&(b+='\n                <li class="ets-wgt-qs-num ets-wgt-qs-num-cur">'+a._curIndex.charAt(1)+"</li>\n            "),b+='\n            </ul>\n        </li>\n    </ul>\n    <span class="ets-wgt-qs-split"></span>\n    <ul class="ets-wgt-qs-total">\n        <li class="ets-wgt-qs-num">'+a._total.charAt(0)+'</li>\n        <li class="ets-wgt-qs-num">'+a._total.charAt(1)+"</li>\n    </ul>\n</div>"}}),define("school-ui-activity/shared/question-number/main",["jquery","troopjs-ef/component/widget","template!./main.html"],function(a,b,c){"use strict";function d(){var a=this;return a.$element.find(g).hide(),a.html(c,a._json).tap(f.bind(a))}function e(){var a=this,b=a.$element;null!=b&&0!==b.length&&b.find(g).stop().delay(800).fadeOut()}function f(){var a=this,b=a.$element;b.stop().fadeIn(500,function(){var c=b.find(i).find("li");c.length>1&&c.eq(0).delay(100).animate({marginTop:-c.eq(0).height()},function(){var c=b.find(h).find("li");c.length>1?c.eq(0).delay(100).animate({marginTop:-c.eq(0).height()},function(){e.call(a)}):e.call(a)})})}var g=".ets-wgt-qs",h=".ets-wgt-qs-index-left",i=".ets-wgt-qs-index-right";return b.extend({"sig/render":function(){return d.call(this)},"hub/activity/step/render":function(a,b){if(b>1){a++;var c=this;c._json=c._json||{};var d=c._json;return d._total=b,d._total=d._total<10?d._total="0"+d._total:d._total=d._total.toString(),d._preIndex=a-1,d._preIndex<10?d._preIndex="0"+d._preIndex:d._preIndex=d._preIndex.toString(),d._curIndex=a<10?"0"+a:a.toString(),c.signal("render")}}})}),define("troopjs-requirejs/template!school-ui-activity/shared/rolling-number/rolling-number.html",[],function(){return function(a){return'<ul class="ets-ar-tp">\r\n\t<li class="ets-ar-tp-left">\r\n\t\t<ul><li class="ets-ar-num ets-ar-num-left" data="0" data-at-id="lbl-remaining-left">0</li></ul>\r\n\t</li>\r\n\t<li class="ets-ar-tp-right">\r\n\t\t<ul><li class="ets-ar-num ets-ar-num-right" data="0" data-at-id="lbl-remaining-right">0</li></ul>\r\n\t</li>\r\n</ul>\r\n<span class="ets-ar-title" data-weave="troopjs-ef/blurb/widget" data-blurb-id="464921" data-text-en="Answers Remaining"></span>'}}),define("school-ui-activity/shared/rolling-number/main",["jquery","poly","when","troopjs-ef/component/widget","template!./rolling-number.html"],function(a,b,c,d,e){"use strict";function f(){var a=this._targetNumber,b=this,c=b.$element;c.find(n).html('<li class="'+i+" "+j+'" data="'+Math.floor(a/10)+'">'+Math.floor(a/10)+"</li>"),c.find(o).html('<li class="'+i+" "+k+'" data="'+a%10+'">'+a%10+"</li>"),c.find(l).attr("data-at-id","lbl-remaining-left"),c.find(m).attr("data-at-id","lbl-remaining-right")}function g(){var b=this._currentNum,d=this._step,e=this._targetNumber,f=Math.floor(b/10),g=Math.floor(e/10),h=e%10,p=0,q="",r="",s=0,t=0,u=0,v=this,w=v.$element;if(!(b<this._settings.min)){var x,y;if(e>=b){if(s=-24,g!==f)for(y=g;y>f;y--)q+='<li class="'+i+" "+j+'" data="'+y+'">'+y+"</li>";for(x=e;x>b;x--)p=x%10,r+='<li class="'+i+" "+k+'" data="'+p+'">'+p+"</li>";""!==q&&(a(q).insertBefore(l),w.find(n).css("margin-top",s*(g-f)+"px")),a(r).insertBefore(m),w.find(o).css("margin-top",s*d+"px"),u=t="0px"}else{if(s=24,g!==f)for(y=f-1;y>=g;y--)q+='<li class="'+i+" "+j+'" data="'+y+'">'+y+"</li>";for(x=b-1;x>=e;x--)p=x%10,r+='<li class="'+i+" "+k+'" data="'+p+'">'+p+"</li>";""!==q&&a(q).insertAfter(l),a(r).insertAfter(m),t=-(f-g)*s+"px",u=-d*s+"px"}w.find(l).attr("data-at-id","lbl-remaining-left"),w.find(m).attr("data-at-id","lbl-remaining-right");return c.all([function(){if(!q)return c.resolve();var a=w.find(l).not(w.find(l+"[data='"+g+"']").first());return c.promise(function(b){w.find(n).animate({"margin-top":t},150,function(){a.remove(),a=null,w.find(n).css("margin-left","0px"),w.find(n).css("margin-top","0px"),b()})})}(),function(){var a=w.find(m).not(w.find(m+"[data='"+h+"']").first());return c.promise(function(b){w.find(o).animate({"margin-top":u},150,function(){a.remove(),a=null,w.find(o).css("margin-top","0px"),b()})})}()])}}var h={length:2,step:1,max:99,min:0,type:"gray",action:"set"},i="ets-ar-num",j="ets-ar-num-left",k="ets-ar-num-right",l="."+j,m="."+k,n=".ets-ar-tp-left ul",o=".ets-ar-tp-right ul";return d.extend(function(b,c,d){this._settings=a.extend({},h,d),this._targetNumber=this._settings.min,this._step=this._settings.step,this._currentNum=this._targetNumber,"white"===this._settings.type&&b.addClass("ets-ar-white")},{"sig/initialize":function(){var a=this;return a.html(e,a._settings).tap(f.bind(this))},"dom/rolling-number/switch-answers-num":function(a,b){var d=null,e=this._settings,h=b.action,i=b.step;switch(this._step=i,h.toLowerCase()){case"add":this._targetNumber+i<=e.max&&(this._targetNumber+=i,d=g.call(this),this._currentNum=this._targetNumber);break;case"sub":this._targetNumber-i>=e.min&&(this._targetNumber-=i,d=g.call(this),this._currentNum=this._targetNumber);break;case"set":i>=e.min&&i<=e.max&&(this._targetNumber=i,d=g.call(this),this._currentNum=this._targetNumber);break;case"reset":this._targetNumber+=i,this._currentNum=this._targetNumber,f.call(this)}return d||c.resolve()}})}),define("troopjs-requirejs/template!school-ui-activity/shared/summary/summary.html",[],function(){return function(a){var b="",c=function(a,b){return"data-weave='troopjs-ef/blurb/widget' data-blurb-id='"+a+"' data-text-en='"+b+"'"}
;return b+='\n<div class="ets-act-summary">\n\t<div class="ets-act-summary-main ets-cf">\n\t\t<div class="ets-act-summary-main-correct">\n\t\t\t<div class="ets-act-summary-num-correct">'+a.correctNum+'</div>\n\t\t\t<br>\n\t\t\t<h4 class="ets-correct"><span '+c(480845,"correct answers")+'></span></h4>\n\t\t</div>\n\t\t<div class="ets-act-summary-main-skipped">\n\t\t\t<div class="ets-act-summary-num-skipped">'+a.skippedNum+'</div>\n\t\t\t<br>\n\t\t\t<h4 class="ets-skipped"><span '+c(480846,"skipped answers")+'></span></h4>\n\t\t</div>\n\t</div>\n\t<div class="ets-act-summary-result" >\n\t\t',a.passed?b+="\n\t\t<h2><span "+c(480844,"Result")+"></span>: <span class=\"ets-pass\" data-at-id='lbl-result-state-message' "+c(461315,"Passed")+"></span></h2>\n\t\t":b+="\n\t\t<h2><span "+c(480844,"Result")+"></span>: <span class=\"ets-fail\" data-at-id='lbl-result-state-message' "+c(461316,"Not passed")+"></span></h2>\n\t\t<p><span data-at-id='lbl-result-need-passed-message' "+c(465093,"you need")+' data-values=\'{"number":'+a.passNum+"}' ></span></p>\n\t\t",b+="\n\t</div>\n</div>"}}),define("school-ui-activity/shared/summary/main",["jquery","compose","underscore","troopjs-ef/component/widget","template!./summary.html"],function(a,b,c,d,e){"use strict";function f(a,b,c){this._content=c}function g(){var a=this;if(a.$element)return a.html(e,a._content)}var h={"sig/start":function(){return g.call(this)}};return d.extend(f,h)}),define("school-ui-activity/shared/textchange/main",["jquery","troopjs-ef/component/widget","school-ui-shared/utils/browser-check"],function(a,b,c){"use strict";function d(a){var b=a.originalEvent;if(b!==f&&(!g||9!==h||"keydown"!==b.type||46==b.keyCode||8==b.keyCode||b.ctrlKey&&(90==b.keyCode||89==b.keyCode))&&(!b.propertyName||"value"==b.propertyName))return!0}function e(a){setTimeout(function(){a.trigger(j)},0)}var f,g="msie"===c.browser,h=parseInt(c.version,10),i=function(){return g?h<9?"propertychange keyup":9===h?"keydown cut change":"input propertychange":"input"}(),j="EFTextChange";return b.extend({"sig/initialize":function(){var b=this,c=b.$element,f=c.get(0);g&&9===h&&f.attachEvent&&f.attachEvent("oncontextmenu",function(){return!1})&&f.attachEvent("onpropertychange",function(b){d(a.Event(b))&&e(c)}),c.bind(i,function(a){d(a)&&e(c)})}})}),define("troopjs-requirejs/template!school-ui-activity/shared/tooltip/main.html",[],function(){return function(a){return'<div class="ets-tooltip-content">\n</div>\n<div class="ets-tooltip-footer"></div>'}}),define("school-ui-activity/shared/tooltip/main",["jquery","troopjs-ef/component/widget","school-ui-shared/utils/browser-check","template!./main.html"],function(a,b,c,d){"use strict";function e(){var b=this;return b.html(d).then(function(){b._content.length&&b[g].find(h).prepend(a(b._content))})}function f(){var a=this;"msie"===c.browser&&parseInt(c.version,10)<=8&&a[g].addClass(i)}var g="$element",h=".ets-tooltip-content",i="ets-tooltip-ie8";return b.extend(function(){var b=this;b._content=a.trim(b[g].html())},{"sig/initialize":function(){return e.call(this)},"sig/start":function(){f.call(this)}})});
//# sourceMappingURL=app-built.min.js.map
