{
  "version": 3,
  "sources": [
    "activity/base/item.js",
    "activity/base/main.js",
    "util/scoring.js",
    "util/interaction.js",
    "troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/flashcard-choice.html",
    "activity/flashcard-choice/flashcard-choice.js",
    "troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/main.html",
    "activity/flashcard-choice/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/flashcard-exercise.html",
    "shared/typing-helper/main.js",
    "shared/asr/asr-service-message-type.js",
    "shared/asr/asr-ui-states.js",
    "activity/flashcard-exercise/flashcard-exercise.js",
    "troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/main.html",
    "activity/flashcard-exercise/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/flashcard-presentation/flashcard-presentation.html",
    "activity/flashcard-presentation/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/grouping/grouping.html",
    "activity/grouping/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/language-comparison/language-comparison.html",
    "activity/language-comparison/v1.js",
    "activity/language-comparison/v2.js",
    "util/content-converter.js",
    "troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/language-presentation-new.html",
    "activity/language-presentation-new/language-presentation-new.js",
    "troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/main.html",
    "activity/language-presentation-new/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/language-presentation/language-presentation.html",
    "troopjs-requirejs/template!school-ui-activity/activity/language-presentation/content-audio.html",
    "util/activity-util.js",
    "activity/language-presentation/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/matching-pic-audio/main.html",
    "activity/matching-pic-audio/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/matching-text-long-text/main.html",
    "activity/matching-text-long-text/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/matching-text-pic/main.html",
    "activity/matching-text-pic/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/matching-text-text/main.html",
    "activity/matching-text-text/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/main.html",
    "activity/movie-presentation/continuousMovie.js",
    "troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/screen-word.html",
    "activity/movie-presentation/screen-word.js",
    "troopjs-requirejs/template!school-ui-activity/activity/movie-question/movie-question.html",
    "activity/movie-question/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/multiple-choice-media.html",
    "activity/multiple-choice-media/multiple-choice-media.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/main.html",
    "activity/multiple-choice-media/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/multiple-choice-text.html",
    "activity/multiple-choice-text/multiple-choice-text.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/main.html",
    "activity/multiple-choice-text/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/multiple-select-media.html",
    "activity/multiple-select-media/multiple-select-media.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/main.html",
    "activity/multiple-select-media/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/multiple-select-text.html",
    "activity/multiple-select-text/multiple-select-text.js",
    "troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/main.html",
    "activity/multiple-select-text/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/no-template/no-template.html",
    "activity/no-template/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/main.html",
    "troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/role-play-audio.html",
    "activity/role-play-audio/role-play-audio.js",
    "activity/role-play-audio/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/role-play-video/main.html",
    "troopjs-requirejs/template!school-ui-activity/activity/role-play-video/role-play-video.html",
    "activity/role-play-video/role-play-video.js",
    "activity/role-play-video/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/sequencing-image.html",
    "activity/sequencing-image/sequencing-image.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/main.html",
    "activity/sequencing-image/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical.html",
    "activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/main.html",
    "activity/sequencing-paragraph-vertical/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal.html",
    "activity/sequencing-word-horizontal/sequencing-word-horizontal.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/main.html",
    "activity/sequencing-word-horizontal/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical.html",
    "activity/sequencing-word-vertical/sequencing-word-vertical.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/main.html",
    "activity/sequencing-word-vertical/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/choose-picture/main.html",
    "activity/sharing-pic-desc/choose-picture/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/describe/main.html",
    "activity/sharing-pic-desc/describe/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/main.html",
    "activity/sharing-pic-desc/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/picture-wall/main.html",
    "activity/sharing-pic-desc/picture-wall/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge-new/main.html",
    "activity/speaking-challenge-new/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge/main.html",
    "activity/speaking-challenge/main.js",
    "activity/text-select/const.js",
    "troopjs-requirejs/template!school-ui-activity/activity/text-select/main.html",
    "activity/text-select/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/text-select/text-select.html",
    "activity/text-select/text-select.js",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/main.html",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/typing-drag-drop.html",
    "activity/typing-drag-drop/typing-drag-drop.js",
    "activity/typing-drag-drop/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/main.html",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/typing-gap-fill.html",
    "troopjs-requirejs/template!school-ui-activity/shared/toggle-slide/main.html",
    "shared/toggle-slide/main.js",
    "activity/typing-gap-fill/typing-gap-fill.js",
    "activity/typing-gap-fill/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-table/main.html",
    "troopjs-requirejs/template!school-ui-activity/activity/typing-table/typing-table.html",
    "activity/typing-table/typing-table.js",
    "activity/typing-table/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-exercise/main.html",
    "activity/writing-challenge-exercise/main.js",
    "troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-practice/main.html",
    "activity/writing-challenge-practice/main.js",
    "application.js",
    "troopjs-requirejs/template!school-ui-activity/launcher/launcher.html",
    "launcher/main.js",
    "shared/asr/asr-blurbs.js",
    "shared/asr/asr-config.js",
    "shared/asr/guid.js",
    "troopjs-requirejs/template!school-ui-activity/shared/asr/asr-debug/asr-debug.html",
    "shared/asr/asr-debug/main.js",
    "shared/asr/asr-states.js",
    "shared/asr/asr-logger.js",
    "shared/asr/asr-trace-event-type.js",
    "shared/asr/asr-trace.js",
    "shared/asr/asr-service-failed-type.js",
    "shared/asr/asr-service.js",
    "shared/asr/asr-recorder-service-html5.js",
    "util/ccl-cache-server.js",
    "shared/asr/asr-recorder-service-flash.js",
    "shared/asr/asr-init.js",
    "troopjs-requirejs/template!school-ui-activity/shared/asr/asr-ui.html",
    "shared/asr/asr-ui.js",
    "troopjs-requirejs/template!school-ui-activity/shared/audio/audio-shell.html",
    "shared/audio/audio-shell.js",
    "troopjs-requirejs/template!school-ui-activity/shared/automation-test/automation-test.html",
    "shared/automation-test/main.js",
    "shared/checkbox/main.js",
    "troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper.html",
    "troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper-fixed.html",
    "shared/epaper/main.js",
    "troopjs-requirejs/template!school-ui-activity/shared/question-number/main.html",
    "shared/question-number/main.js",
    "troopjs-requirejs/template!school-ui-activity/shared/rolling-number/rolling-number.html",
    "shared/rolling-number/main.js",
    "troopjs-requirejs/template!school-ui-activity/shared/summary/summary.html",
    "shared/summary/main.js",
    "shared/textchange/main.js",
    "troopjs-requirejs/template!school-ui-activity/shared/tooltip/main.html",
    "shared/tooltip/main.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3bA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7RA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3cA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChXA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvEA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxGA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrXA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7VA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrXA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjVA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtKA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA,ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7LA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/JA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrOA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1MA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrJA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChBA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpEA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5PA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AChPA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClVA;AACA;AACA;AACA;AACA,ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5NA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5EA;AACA;AACA;AACA;AACA,ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5eA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/QA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtiBA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA,ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClwBA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpGA;AACA;AACA;AACA;AACA;AACA;AACA,ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7KA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACTA;AACA;AACA;AACA;AACA;AACA;AACA,ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvLA;AACA;AACA;AACA;AACA;AACA,ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvfA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AClEA;AACA;AACA,ACFA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjNA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxEA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/FA;AACA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "app-built.js",
  "sourcesContent": [
    "define('school-ui-activity/activity/base/item',[\n\t'when',\n\t\"troopjs-core/component/factory\",\n\t'troopjs-core/pubsub/hub'\n], function (when, Factory, hub) {\n\n\tvar TOPIC_ITEMPROP = \"activity/item/prop/changed/\";\n\tvar PROMISE_SUFFIX = 'Promise';\n\n\tvar PROP = {\n\t\t/* Return true or false, indicates if current answer is intact so that it can be checked by scoring.compute */\n\t\tANSWERED: 'answered',\n\t\t/* indicates if current activity enabled instance feedback */\n\t\tINSTANT_FEEDBACK: 'instantFeedback',\n\t\t/* indicates if current activity is savable */\n\t\tSAVABLE: 'savable',\n\t\t/* indicates if current activity is completed */\n\t\tCOMPLETED: 'completed'\n\t};\n\n\tvar methods = {\n\t\t_pubProps: function () {\n\t\t\tvar me = this;\n\t\t\tvar promises = [];\n\t\t\tfor (var key in PROP) {\n\t\t\t\tif (!PROP.hasOwnProperty(key)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// compulsory publish the change\n\t\t\t\tvar currentValue = methods[PROP[key]].call(me);\n\t\t\t\tvar promise = methods[PROP[key] + PROMISE_SUFFIX].call(me, currentValue, false);\n\t\t\t\tpromises.push(promise);\n\t\t\t}\n\t\t\treturn when.all(promises);\n\t\t}\n\t};\n\n\t// setup state APIs\n\tfor (var key in PROP) {\n\t\tif (!PROP.hasOwnProperty(key)) {\n\t\t\treturn;\n\t\t}\n\n\t\tmethods[PROP[key]] = (function (key) {\n\t\t\t/*\n\t\t\t * @param silent true to not publishing, false to force publishing, undefined\n\t\t\t * indicates that the publishing happen only when the value is updated.\n\t\t\t */\n\t\t\treturn function (value, silent) {\n\t\t\t\tvar _key = this['_' + key];\n\n\t\t\t\tif (arguments.length >= 1 && (silent === false || value !== _key)) {\n\t\t\t\t\tthis['_' + key] = value;\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\thub.publish(TOPIC_ITEMPROP + PROP[key], value, this._index, this);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn _key;\n\t\t\t};\n\t\t})(key);\n\n\t\tmethods[PROP[key] + PROMISE_SUFFIX] = (function (key) {\n\t\t\t/*\n\t\t\t * @param silent true to not publishing, false to force publishing, undefined\n\t\t\t * indicates that the publishing happen only when the value is updated.\n\t\t\t */\n\t\t\treturn function (value, silent) {\n\t\t\t\tvar previousValue = this['_' + key];\n\n\t\t\t\tif (arguments.length >= 1 && (silent === false || value !== previousValue)) {\n\t\t\t\t\tthis['_' + key] = value;\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\treturn hub.publish(TOPIC_ITEMPROP + PROP[key], value, this._index, this)\n\t\t\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\t\t\treturn previousValue;\n\t\t\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\t\t\t//ignore error\n\t\t\t\t\t\t\t\t\treturn previousValue;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn when.resolve(previousValue);\n\t\t\t};\n\t\t})(key);\n\n\t}\n\n\treturn Factory(function (index/*, json*/) {\n\n\t\tthis._index = index;\n\n\t\tthis[PROP.ANSWERED](false, true);\n\t\tthis[PROP.INSTANT_FEEDBACK](false, true);\n\t\tthis[PROP.SAVABLE](false, true);\n\t\tthis[PROP.COMPLETED](false, true);\n\n\t}, methods);\n});\n",
    "/**\n * @class Activity/Base\n * Base class of activity widget\n * Defined the interfaces that activity must implement.\n\n * Constructor:\n ($element, name, json, iScoring)\n json - The json that contains all information about activity, such as template code, contents...etc\n iScoring - The object which implemented compute(deferred) method, the compute(deferred) should resolve deferred with\n json that contains result of checking answer\n\n * Abstract Methods:\n nextStep(deferred) - Switch to next sub question\n\n * Public Methods:\n checkAnswer(deferred) - Trigger answer checking, activity reveal the state of user's answer.\n\n * Available Channels/Topics:\n activity/set/result - calls _setResult()\n activity/get/result - calls _getResult()\n activity/check/answer - calls checkAnswer(deferred)\n activity/next/step - switch to next sub question\n\n\n */\ndefine('school-ui-activity/activity/base/main',[\n\t\"jquery\",\n\t\"when\",\n\t\"compose\",\n\t\"troopjs-ef/component/widget\",\n\t\"troopjs-core/pubsub/hub\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"json2\",\n\t\"./item\"\n], function ActivityBaseModule($, when, Compose, Widget, Hub, Parser, JSON, Item) {\n\t\"use strict\";\n\n\tvar TOPIC_LOAD_ENROLLMENT = 'load/enrollment';\n\n\tvar PROP_JSON = '_json',\n\t\tPROP_START_TIME = '_startTime',\n\t\tPROP_SOURCE = \"_source\",\n\t\tPROP_ISCORING = '_scoring',\n\t\tPROP_ENROLLMENT_LOADED = '_enrollmentLoaded',\n\t\tPROP_ONANSWERCHECKED = '_onAnswerChecked';\n\n\tvar MUST_HAS = [\n\t\tPROP_JSON,\n\t\tPROP_ISCORING,\n\t\tPROP_ONANSWERCHECKED\n\t];\n\n\tvar ACT_ID = \"act_id\",\n\t\tACT_TEMPLATE_ID = \"act_template_id\",\n\t\tACT_CONTENT = \"activityContent\",\n\t\tSTU_ID = \"studentCourseId\",\n\t\tSCORING = \"scoring\",\n\t\tIS_CORRECT = \"_isCorrect\",\n\t\tHAS_PASSED = \"hasPassed\",\n\t\tLEARNING = \"LEARNING\",\n\t\tEXERCISE = \"EXERCISE\",\n\t\tWRITING_CONTENT = \"_writingContent\";\n\n\tvar ACT_TYPE = {\n\t\t/* indicates current activity is a 'LEARNING' activtiy or not  */\n\t\tLEARNING: 2,\n\t\t/* indicates current activity is a 'EXERCISE' activtiy or not */\n\t\tEXERCISE: 1,\n\t\t/* indicates current activity is a 'PRACTICE' activtiy or not */\n\t\tPRACTICE: 3\n\t};\n\n\t/**\n\t * Properties:\n\t * (BELOW API SHOULD NOT BE CHANGED ONCE STABLIZED)\n\t * BELOW API SHOULD NOT BE CHANGED ONCE STABLIZED\n\t */\n\tvar PROP = {\n\t\t/* indicates if current activity is completed */\n\t\tCOMPLETED: 'completed',\n\t\t/* indicates current sub question index */\n\t\tINDEX: 'index',\n\t\t/* indicates how many sub question does current activity has */\n\t\tLENGTH: 'length',\n\t\t/* indicates current act type, 1. exercise, 2. learning 3. practice */\n\t\tTYPE: 'type'\n\t};\n\tvar PROMISE_SUFFIX = 'Promise';\n\n\tvar ENUM_SCORING_TYPE = {\n\t\t\"ASR\": \"asr\",\n\t\t\"GP\": \"grouping\",\n\t\t\"DEFAULT\": \"default\"\n\t};\n\n\n\tvar ENUM_ASR_FALLBACK_TYPE = {\n\t\tTYPING: \"TYPING\",\n\t\tSELECT: \"SELECT\",\n\t\tNEXT: \"NEXT\"\n\t};\n\n\tvar TOPIC_PROP = \"activity/prop/changed/\",\n\t\tTOPIC_ACT_SUBMIT_SCORE = \"activity/submit/score\",\n\t\tTOPIC_RENDER_ACT = \"render/activity\";\n\n\tvar baseLength, baseIndex, baseIndexPromise, currentInstance;\n\n\tfunction submitScore() {\n\t\tif (this._submitted === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._submitted = true;\n\n\t\tvar content = this._json.content,\n\t\t\thasPassed = !this.hasScoring || typeof content === \"undefined\" || content[IS_CORRECT],\n\t\t\tisGradedWriting = this.type() === ACT_TYPE.EXERCISE && this._json[WRITING_CONTENT],\n\t\t\tscore = (hasPassed || isGradedWriting) ? 100 : 0,\n\t\t\twritingContent = this._json[WRITING_CONTENT];\n\n\t\tvar details = {\n\t\t\tactId: this[ACT_ID],\n\t\t\tstartTime: this[PROP_START_TIME],\n\t\t\tcompleteTime: new Date().getTime()\n\t\t};\n\n\t\tthis.publish(TOPIC_ACT_SUBMIT_SCORE, score, writingContent, details);\n\t}\n\n\t// define the member methods\n\tvar methods = {\n\t\t\"sig/start\": function onStart() {\n\t\t\tvar me = this;\n\t\t\tme[PROP_START_TIME] = new Date().getTime();\n\n\t\t\tvar platformVersionPromise = me\n\t\t\t\t.query(\"student_platform_version!current\")\n\t\t\t\t.spread(function doneQuery(platformVersion) {\n\t\t\t\t\tme.platformVersion = platformVersion && platformVersion.version;\n\t\t\t\t});\n\n\t\t\t//don't use hub:memory for following topic to avoid deadlock in sig/render\n\t\t\tHub.subscribe(TOPIC_LOAD_ENROLLMENT, me, me.onLoadEnrollment);\n\t\t\tvar loadEnrollmentPromise = Hub.reemit(TOPIC_LOAD_ENROLLMENT, false, me, me.onLoadEnrollment);\n\n\t\t\treturn when.all([platformVersionPromise, loadEnrollmentPromise])\n\t\t\t\t.then(function () {\n\t\t\t\t\treturn me.signal('render');\n\t\t\t\t});\n\t\t},\n\t\t\"sig/stop\": function onStop() {\n\t\t\tvar me = this;\n\t\t\tHub.unsubscribe(TOPIC_LOAD_ENROLLMENT, me, me.onLoadEnrollment);\n\t\t},\n\t\t\"onLoadEnrollment\": function onLoadEnrollment(enrollment) {\n\t\t\tvar me = this;\n\t\t\tif (enrollment) {\n\t\t\t\tme[STU_ID] = Parser.parseId(enrollment.id);\n\t\t\t}\n\t\t\tme[PROP_ENROLLMENT_LOADED].resolve();\n\t\t},\n\t\t//Want activityCompleted to be overridable\n\t\t\"activityCompleted\": function activityCompleted(hasCompelted) {\n\t\t\t//For learning activity, student need click 'Next' to submit score.\n\t\t\tif (hasCompelted && this.type() !== ACT_TYPE.LEARNING && currentInstance === this) {\n\t\t\t\tsubmitScore.call(this);\n\t\t\t}\n\t\t},\n\t\t//Want retryActivity to be overridable\n\t\t\"retryActivity\": function () {\n\t\t\treturn this.publish(TOPIC_RENDER_ACT, this[ACT_ID]);\n\t\t},\n\n\t\t\"hub/activity/next/step\": function onNextStep() {\n\t\t\tif (currentInstance !== this) return;\n\n\t\t\tthis.hasScoring || this.items(this.index()).completed(true);\n\t\t\treturn this.nextStep();\n\t\t},\n\t\t\"hub/activity/submit/score/proxy\": function onActivityMoveon() {\n\t\t\tif (this.type() === ACT_TYPE.LEARNING && currentInstance === this) {\n\t\t\t\tsubmitScore.call(this);\n\t\t\t}\n\t\t},\n\t\t\"hub/activity/retry\": function onNextStep() {\n\t\t\tif (currentInstance !== this) return;\n\n\t\t\treturn this.retryActivity();\n\t\t},\n\t\t\"hub:memory/activity/prop/changed/type\": function onTypeChanged(type) {\n\t\t\tif (type !== ACT_TYPE.EXERCISE && currentInstance === this) {\n\t\t\t\tthis.hasScoring = false;\n\t\t\t}\n\t\t},\n\t\t// Automatically score submitting\n\t\t\"hub/activity/prop/changed/completed\": function (hasCompelted) {\n\t\t\tthis.activityCompleted(hasCompelted);\n\t\t},\n\t\t\"hub/activity-container/bottom-bar/item/completed\": function (state, itemIndex) {\n\t\t\tthis.publish(\"activity/item/prop/changed/completed\", state, itemIndex);\n\t\t},\n\t\t\"hub/activity/item/prop/changed/completed\": function onItemCompleted(itemCompleted, itemIndex, _self) {\n\t\t\tif (_self && this._items[itemIndex] !== _self) return;\n\n\t\t\tthis.items(itemIndex).completed(itemCompleted);\n\n\t\t\tvar allCompleted = true;\n\t\t\tfor (var l = this.length(); l--;) {\n\t\t\t\tif (!this.items(l).completed()) {\n\t\t\t\t\tallCompleted = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (allCompleted) {\n\t\t\t\tthis.completed(true);\n\t\t\t}\n\t\t},\n\t\t/*\n\t\t Use a common way to add automation testing asset dom.\n\t\t */\n\t\tattachATAssetDom: function (data) {\n\t\t\tvar me = this;\n\n\t\t\tif (data) {\n\t\t\t\treturn $('<div class=\"ets-hidden\" data-weave=\"school-ui-activity/shared/automation-test/main(assets)\"></div>')\n\t\t\t\t\t.data(\"assets\", data)\n\t\t\t\t\t.appendTo(me.$element)\n\t\t\t\t\t.weave();\n\t\t\t} else {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\t\t},\n\n\t\tscoringType: function (type) {\n\t\t\tif (type) {\n\t\t\t\tthis._scoringType = type;\n\t\t\t}\n\t\t\treturn this._scoringType || ENUM_SCORING_TYPE.DEFAULT;\n\t\t},\n\n\t\tpublishInteraction: function(interaction) {\n\t\t\treturn this.publish('activity/interaction', $.extend(interaction, {\n\t\t\t\tactivityId: this[ACT_ID]\n\t\t\t}));\n\t\t},\n\n\t\tgetWritingHist: function () {\n\t\t\tvar me = this;\n\t\t\treturn me[PROP_ENROLLMENT_LOADED].promise.then(function () {\n\t\t\t\tvar act_id = Parser.parseId(me[ACT_ID]);\n\t\t\t\tif (me[STU_ID]) {\n\t\t\t\t\tvar query;\n\t\t\t\t\tif (me.platformVersion === \"2.0\") {\n\t\t\t\t\t\tquery = \"integration_student_writing!\" + act_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquery = \"writing_status!\" + me[STU_ID] + \";\" + act_id;\n\t\t\t\t\t}\n\t\t\t\t\treturn me.query(query)\n\t\t\t\t\t\t.spread(function (writingInfo) {\n\t\t\t\t\t\t\treturn writingInfo;\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn when.resolve(null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tgetProgress: function () {\n\t\t\tvar me = this;\n\t\t\treturn me[PROP_ENROLLMENT_LOADED].promise.then(function () {\n\t\t\t\tvar actId = Parser.parseId(me[ACT_ID]);\n\t\t\t\tif (me[STU_ID]) {\n\t\t\t\t\tvar query;\n\t\t\t\t\tif (me.platformVersion === \"2.0\") {\n\t\t\t\t\t\tquery = \"student_activity_progress!\" + actId;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquery = 'progress!' + me[STU_ID] + ';activity;' + actId;\n\t\t\t\t\t}\n\t\t\t\t\treturn me.query(query).spread(function (activityProgress) {\n\t\t\t\t\t\treturn activityProgress;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn when.resolve(null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\treturn when.resolve();\n\t\t},\n\n\t\titems: function getItem(index) {\n\n\t\t\tif (arguments.length < 1) {\n\t\t\t\tindex = this.index();\n\t\t\t}\n\n\t\t\tif (!this._items[index]) {\n\t\t\t\tthis._items[index] = new Item(index, this._json);\n\t\t\t}\n\n\t\t\treturn this._items[index];\n\t\t}\n\t};\n\n\t// setup state APIs\n\tfor (var key in PROP) {\n\t\tif (!PROP.hasOwnProperty(key)) {\n\t\t\treturn;\n\t\t}\n\n\t\tmethods[PROP[key]] = (function (key) {\n\t\t\treturn function (value) {\n\t\t\t\tvar _key = this['_' + key];\n\t\t\t\tif (arguments.length >= 1 && value !== _key) {\n\t\t\t\t\tthis['_' + key] = value;\n\t\t\t\t\tthis.publish(TOPIC_PROP + PROP[key], value);\n\t\t\t\t}\n\n\t\t\t\treturn _key;\n\t\t\t};\n\t\t})(key);\n\n\t\tmethods[PROP[key] + PROMISE_SUFFIX] = (function (key) {\n\t\t\treturn function (value) {\n\t\t\t\tvar previousValue = this['_' + key];\n\t\t\t\tif (arguments.length >= 1 && value !== previousValue) {\n\t\t\t\t\tthis['_' + key] = value;\n\t\t\t\t\treturn this.publish(TOPIC_PROP + PROP[key], value)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\treturn previousValue;\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t\t//ignore error\n\t\t\t\t\t\t\treturn previousValue;\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn when.resolve(previousValue);\n\t\t\t};\n\t\t})(key);\n\n\t}\n\n\t// overwrite the baseLength to automatically create sub item instance when\n\t// length get set\n\tbaseLength = methods[PROP.LENGTH];\n\n\tmethods[PROP.LENGTH] = function (value) {\n\n\t\tif (value != undefined &&\n\t\t\ttypeof value == 'number') {\n\t\t\tfor (var l = value; l--;) {\n\t\t\t\tthis.items(l);\n\t\t\t}\n\t\t}\n\n\t\treturn baseLength.apply(this, arguments);\n\t};\n\n\tbaseIndex = methods[PROP.INDEX];\n\n\tmethods[PROP.INDEX] = function (value) {\n\t\tif (value != undefined &&\n\t\t\ttypeof value == 'number') {\n\n\t\t\tif (value >= this.length()) {\n\t\t\t\tthrow this + ': new index() is greater or equal to length()';\n\t\t\t}\n\n\t\t\tvar item = this.items(value);\n\n\t\t\titem._pubProps();\n\t\t}\n\t\treturn baseIndex.apply(this, arguments);\n\t};\n\n\tbaseIndexPromise = methods[PROP.INDEX + PROMISE_SUFFIX];\n\n\tmethods[PROP.INDEX + PROMISE_SUFFIX] = function (value) {\n\t\tvar args = arguments, me = this;\n\t\tif (value != undefined &&\n\t\t\ttypeof value == 'number') {\n\n\t\t\tif (value >= this.length()) {\n\t\t\t\treturn when.reject(new Error(this + ': new index() is greater or equal to length()'));\n\t\t\t}\n\n\t\t\tvar item = this.items(value);\n\n\t\t\treturn item._pubProps()\n\t\t\t\t.then(function () {\n\t\t\t\t\treturn baseIndexPromise.apply(me, args);\n\t\t\t\t});\n\t\t}\n\t\treturn baseIndexPromise.apply(me, args);\n\t};\n\n\t// setup must-have methods\n\tfor (var l = MUST_HAS.length; l--;) {\n\t\tmethods[MUST_HAS[l]] = Compose.required;\n\t}\n\n\tvar ret = Widget.extend(function ($element, name, option) {\n\n\t\tcurrentInstance = this;\n\t\tthis._items = [];\n\t\tthis[PROP_SOURCE] = option[ACT_CONTENT];\n\t\t// http://jsfiddle.net/TESeT/1/\n\t\t//this[PROP_JSON] = JSON.parse(JSON.stringify(option[ACT_CONTENT]));\n\t\ttry {\n\t\t\tthis[PROP_JSON] = JSON.parse(JSON.stringify(option[ACT_CONTENT]));\n\t\t}\n\t\tcatch (err) {\n\t\t\tthrow \"JSON parse error. Invalid JSON string.\"\n\t\t}\n\t\tthis[PROP_ISCORING] = option[SCORING];\n\t\tthis[ACT_ID] = option[ACT_ID];\n\t\tthis[ACT_TEMPLATE_ID] = option[ACT_TEMPLATE_ID];\n\t\tthis[HAS_PASSED] = option[HAS_PASSED];\n\n\t\tthis[PROP.COMPLETED](false);\n\t\tthis[PROP.INDEX](0);\n\t\tthis[PROP.LENGTH](1);\n\t\tthis._score = 100;\n\n\t\tif (this.hasScoring = !!option[ACT_CONTENT].scoring) {\n\t\t\tthis.type(ACT_TYPE[EXERCISE]);\n\t\t} else {\n\t\t\tthis.type(ACT_TYPE[LEARNING]);\n\t\t}\n\n\t\tthis[PROP_ENROLLMENT_LOADED] = when.defer();\n\n\t}, methods);\n\n\tret.ACT_TYPE = ACT_TYPE;\n\tret.SCORING_TYPE = ENUM_SCORING_TYPE;\n\tret.ASR_FALLBACK_TYPE = ENUM_ASR_FALLBACK_TYPE;\n\treturn ret;\n});\n\n",
    "define('school-ui-activity/util/scoring',[\n], function () {\n\t'use strict';\n\n\tvar BASE_ASR_SCORE = 70;\n\n\tfunction findById(array, id) {\n\t\tvar index;\n\t\tvar length = array.length;\n\t\tfor (index = 0; index < length; ++index) {\n\t\t\tvar element = array[index];\n\t\t\tif (element._id && element._id === id) {\n\t\t\t\treturn element;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t// ASR_MIN_PASSED_QUESTIONS_RATE and BASE_ASR_SCORE happen to both be \"70%\" at the moment\n\t// but they have different purposes and may have different values in the future\n\n\treturn {\n\t\tASR_MIN_PASSED_QUESTIONS_RATE: 0.7,\n\t\tBASE_ASR_SCORE: BASE_ASR_SCORE,\n\t\tfindById: findById,\n\t\tisPhraseCorrect: function(phrase) {\n\t\t\treturn phrase.score >= BASE_ASR_SCORE;\n\t\t},\n\t\tisWordCorrect: function(word) {\n\t\t\treturn word.score >= BASE_ASR_SCORE;\n\t\t},\n\t\tisQuestionOptionCorrect: function (json, question, selectedOptionId) {\n\t\t\tvar solution = findById(json.scoring[question.collection], question.id);\n\t\t\tvar solutionOption = findById(solution.options, selectedOptionId);\n\t\t\treturn Boolean(solutionOption.selected);\n\t\t}\n\t};\n});\n\n",
    "define('school-ui-activity/util/interaction',[\n\t'./scoring'\n], function (Scoring) {\n\t'use strict';\n\n\tvar PROP_CORRECT = 'correct';\n\tvar PROP_ID = 'id';\n\tvar PROP_ANSWER_ID = 'answerId';\n\n\tfunction newInteraction(correct, interactionId) {\n\t\tvar interaction = {};\n\t\tinteraction[PROP_CORRECT] = Boolean(correct);\n\t\tinteraction[PROP_ID] = interactionId;\n\t\treturn interaction;\n\t}\n\n\treturn {\n\t\tmakeMatchingInteraction: function (correct, solutionId, otherId) {\n\t\t\tvar interaction = newInteraction(correct, solutionId);\n\t\t\tinteraction[PROP_ANSWER_ID] = otherId;\n\t\t\treturn interaction;\n\t\t},\n\t\tmakeChoiceInteraction: function (json, questionIndex, selectedOptionId, questionCollection) {\n\t\t\tquestionCollection = questionCollection || 'questions';\n\t\t\tvar currentQuestion = json.content[questionCollection][questionIndex];\n\t\t\tvar questionId = currentQuestion._id;\n\t\t\tvar correct = Scoring.isQuestionOptionCorrect(json, {\n\t\t\t\tid: questionId,\n\t\t\t\tcollection: questionCollection\n\t\t\t}, selectedOptionId);\n\n\t\t\tvar interaction = newInteraction(correct, questionId);\n\t\t\tinteraction[PROP_ANSWER_ID] = selectedOptionId;\n\t\t\treturn interaction;\n\t\t},\n\t\tmakeGroupingInteraction: function (correct, groupId, itemId) {\n\t\t\tvar interaction = newInteraction(correct, itemId);\n\t\t\tinteraction[PROP_ANSWER_ID] = groupId;\n\t\t\treturn interaction;\n\t\t},\n\t\tmakeSequencingInteraction: function (correct, sequenceId) {\n\t\t\treturn newInteraction(correct, sequenceId);\n\t\t},\n\t\tmakeTextSelectInteraction: function (correct, phraseId, optionIndex, wordId) {\n\t\t\tvar interactionId;\n\t\t\tif (typeof optionIndex === 'number') {\n\t\t\t\tinteractionId = [phraseId, optionIndex];\n\t\t\t} else {\n\t\t\t\tinteractionId = phraseId;\n\t\t\t}\n\t\t\tvar interaction = newInteraction(correct, interactionId);\n\t\t\tinteraction[PROP_ANSWER_ID] = wordId;\n\t\t\treturn interaction;\n\t\t},\n\t\tmakeSubmitWritingInteraction: function () {\n\t\t\treturn newInteraction(true, \"Writing\");\n\t\t},\n\t\tmakeAlreadySubmittedWritingInteraction: function () {\n\t\t\treturn newInteraction(true, \"Writing\");\n\t\t},\n\t\tmakeAsrInteraction: function (correct, phraseId) {\n\t\t\treturn newInteraction(correct, phraseId);\n\t\t},\n\t\tmakeAsrFallbackInteraction: function (correct, phraseId) {\n\t\t\treturn newInteraction(correct, phraseId);\n\t\t},\n\t\tmakeTypingInteraction: function (correct, gapId) {\n\t\t\treturn newInteraction(correct, gapId);\n\t\t},\n\t\tmakeSkipInteraction: function(questionId) {\n\t\t\treturn newInteraction(false, questionId);\n\t\t}\n\t};\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/flashcard-choice.html',[],function() { return function template(data) { var o = \"\";\nvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n\\n<div class=\\\"ets-act-fce\\\">\\n\\t<div class=\\\"ets-act-fce-main\\\">\\n\\t\\t<div class=\\\"ets-act-fce-bd\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-stack\\\">\\n\\t\\t\\t\\t\";\n\t\t\t\tvar data = data || {};\n\t\t\t\tvar cards = data.cards;\n\t\t\t\tvar correctRequired = data.correctRequired;\n\t\t\t\tfor(var i = 0; i < cards.length; i++){\n\t\t\t\t\twriteItem(cards[i], i);o += \"\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-fce-ctrl\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t\\t\\t<div data-at-id=\\\"btn-skip\\\" class=\\\"ets-act-fce-btn ets-act-btn-skip ets-btn-skip\\\"><span \" +blurb(450011,\"Skip\")+ \"></span></div>\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-fce-number\\\">\\n\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-fce-number-current\\\"></span> / <span class=\\\"ets-act-fce-number-total\\\"></span>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-fce-ft\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-choice\\\">\\n\\t\\t\\t\\t\";\n\t\t\t\tfor(var i = 0; i < cards.length; i++){\n\t\t\t\t\twriteOption(cards[i], i);o += \"\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\t\\n\\t<!-- Activity Summary Start-->\\n\\t<div class=\\\"ets-act-summary-wrap\\\"></div>\\n\\t<!-- Activity Summary End-->\\n</div>\\n\\n\"; function writeItem(data, index) { \n\tvar index = parseInt(index) + 1;\n\to += \"\\n\\t<div class=\\\"ets-act-fce-card \";if (index > 4) {o += \"ets-candidate \";} else {o += \" ets-stack-\" +index+ \" \";}o += \"\\\" id=\\\"ets-act-fce-card\" +data._id+ \"\\\" data-id=\\\"\" +data._id+ \"\\\" data-at-id=\\\"\" +data._id+ \"\\\">\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<img src=\\\"\" +data.image.url+ \"\\\" />\\n\\t\\t</div>\\n        <div class=\\\"ets-icon\\\">\\n            <span></span>\\n        </div>\\n\\t\\t<div class=\\\"ets-ft\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-word ets-audio-only\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-audio\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap ets-ap-small\\\">\\n\\t\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t\\t       data-src=\\\"\" +data.audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t\\t       data-at-id=\\\"answer_audio_\" +data._id+ \"\\\"\\n\\t\\t\\t\\t\\t\\t       class=\\\"ets-ap ets-ap-small ets-ap-nobar\\\"></audio>\\n\\t\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\"; } o += \"\\n\\n\"; function writeOption(data, index) { \n\tvar index = parseInt(index) + 1;\n\to += \"\\n\\t<ul class=\\\"ets-options ets-cf ets-none\\\" id=\\\"\" +data._id+ \"\\\" data-id=\\\"\" +data._id+ \"\\\">\\n\\t\\t\";for (var l = 0; l < data.options.length; l ++) {o += \"\\n\\t\\t<li id=\\\"\" +data.options[l]._id+ \"\\\"  data-id=\\\"\" +data.options[l]._id+ \"\\\" data-at-id=\\\"\" +data.options[l]._id+ \"\\\"><span>\" +data.options[l].text+ \"</span></li>\\n\\t\\t\";}o += \"\\n\\t</ul>\\n\"; }  return o; }; });\n",
    "define('school-ui-activity/activity/flashcard-choice/flashcard-choice',[\n\t'jquery',\n\t'jquery.ui',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'school-ui-activity/util/scoring',\n\t'template!./flashcard-choice.html'\n], function ($, ui$, poly, when, Widget, Interaction, Scoring, tTemplate) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\tvar HUB_REMOVE_INTRO_TITLE = \"dispose/reference\";\n\n\tvar SEL_FCE_MAIN = \".ets-act-fce-main\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_FIRST = \"ets-stack-1\",\n\t\tCLS_SECOND = \"ets-stack-2\",\n\t\tCLS_THIRD = \"ets-stack-3\",\n\t\tCLS_FOURTH = \"ets-stack-4\",\n\t\tCLS_CANDIDATE = \"ets-candidate\",\n\t\tCLS_DONE = \"ets-done\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\n\t\tSEL_AUDIO = \".ets-ap\",\n\n\t\tSEL_FIRST_CARD = \".ets-act-fce-card.ets-stack-1\",\n\t\tSEL_SECOND_CARD = \".ets-act-fce-card.ets-stack-2\",\n\t\tSEL_THIRD_CARD = \".ets-act-fce-card.ets-stack-3\",\n\t\tSEL_FOURTH_CARD = \".ets-act-fce-card.ets-stack-4\",\n\t\tSEL_CANDIDATE = \".ets-act-fce-card.ets-candidate\",\n\t\tSEL_BTN_SKIP = \".ets-act-fce-btn.ets-btn-skip\",\n\t\tSEL_QUESTION = \".ets-act-fce-choice > .ets-options\",\n\n\t\tSEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\",\n\n\t\tSEL_COUNT_CURRENT = \".ets-act-fce-number-current\",\n\t\tSEL_COUNT_TOTAL = \".ets-act-fce-number-total\",\n\n\t\tSEL_SUMMARY_PASS = \".ets-act-fce-summary > .ets-hd > .ets-pass\",\n\t\tSEL_SUMMARY_FAIL = \".ets-act-fce-summary > .ets-hd > .ets-fail\",\n\n\t\tSEL_SUMMARY_REQUIRE_MSG = \".ets-act-fce-summary > .ets-ft > p\",\n\n\t\tSEL_CORRECT_ICON = \".ets-icon span\",\n\n\t\tSWITCH_DELAY = 800,\n\t\tFEEDBACK_DELAY = 500;\n\n\t// Constructor\n\tfunction Ctor() {\n\t\tthis.currentCardIndex = 0;\n\t}\n\n\t// # Render\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar flashcards = this._json.content.flashCards;\n\n\t\tthis.totalCards = this._json.content.flashCards.length;\n\n\t\tif (!flashcards || !flashcards.length) {\n\t\t\treturn when.reject(new Error(this.toString() + EX_JSON_FORMAT));\n\t\t}\n\n\t\tme.correctRequired = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * me.totalCards);\n\t\tme.correctCount = 0;\n\t\tme.incorrectCount = me.totalCards;\n\n\t\tme.html(tTemplate, {cards: this._json.content.flashCards, correctRequired: me.correctRequired})\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_BTN_SKIP).click(function () {\n\t\t\tif ($(this).hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.publishSkipInteraction(me.currentCardIndex)\n\t\t\t\t.then(function () {\n\t\t\t\t\tswitchCard.call(me);\n\t\t\t\t})\n\t\t});\n\n\t\tme.$activeCard = $el.find(SEL_FIRST_CARD);\n\t\tme.$activeQuestion = $el.find(SEL_QUESTION).filter(function () {\n\t\t\treturn $(this).data(\"id\") == me.$activeCard.data(\"id\");\n\t\t});\n\t\t$el.find(SEL_QUESTION).addClass(CLS_NONE);\n\t\tme.$activeQuestion.removeClass(CLS_NONE);\n\n\t\t$el.find(SEL_QUESTION + \" li\").click(function () {\n\t\t\tonClickOption.call(me, $(this));\n\t\t});\n\n\t\t$el.find(SEL_COUNT_TOTAL).text(me.totalCards);\n\t\t$el.find(SEL_COUNT_CURRENT).text(me.currentCardIndex + 1);\n\t}\n\n\tfunction switchCard() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t// send pause to all audio in activity\n\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\n\t\tif (me.currentCardIndex + 1 >= me.totalCards) {\n\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_NONE);\n\t\t\tme._item.completed(true);\n\t\t\t$el.find(SEL_FCE_MAIN).fadeOut(200, function () {\n\t\t\t\tviewSummary.call(me);\n\t\t\t});\n\t\t} else {\n\t\t\tvar $firstCard = $el.find(SEL_FIRST_CARD),\n\t\t\t\t$secondCard = $el.find(SEL_SECOND_CARD),\n\t\t\t\t$thirdCard = $el.find(SEL_THIRD_CARD),\n\t\t\t\t$fourthCard = $el.find(SEL_FOURTH_CARD),\n\t\t\t\t$candidate = $($el.find(SEL_CANDIDATE).first());\n\n\t\t\tme.currentCardIndex++;\n\t\t\t$el.find(SEL_COUNT_TOTAL).text(me.totalCards);\n\t\t\t$el.find(SEL_COUNT_CURRENT).text(me.currentCardIndex + 1);\n\n\n\t\t\t$firstCard.animate({left: \"+=150\", top: \"-=100\", opacity: \"0\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_FIRST).addClass(CLS_DONE);\n\t\t\t\t$el.find(SEL_BTN_SKIP).removeClass(CLS_DISABLED);\n\t\t\t});\n\n\t\t\t$secondCard.animate({top: \"0\", left: \"12\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_SECOND).addClass(CLS_FIRST);\n\t\t\t\tif (me.currentCardIndex < me.totalCards) {\n\t\t\t\t\tme.$activeCard = $el.find(SEL_FIRST_CARD);\n\t\t\t\t\tme.$activeQuestion = $el.find(SEL_QUESTION).filter(function () {\n\t\t\t\t\t\treturn $(this).data(\"id\") == me.$activeCard.data(\"id\");\n\t\t\t\t\t});\n\t\t\t\t\t$el.find(SEL_QUESTION).addClass(CLS_NONE);\n\t\t\t\t\tme.$activeQuestion.removeClass(CLS_NONE);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$thirdCard.animate({top: \"6\", left: \"6\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_THIRD).addClass(CLS_SECOND);\n\t\t\t});\n\n\t\t\t$fourthCard.animate({top: \"12\", left: \"0\", opacity: \"1\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_FOURTH).addClass(CLS_THIRD);\n\t\t\t});\n\n\t\t\t$candidate.removeClass(CLS_CANDIDATE).addClass(CLS_FOURTH);\n\t\t}\n\t}\n\n\tfunction viewSummary() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tvar passed = me.isPassed();\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\n\t\t$(this).removeClass(CLS_NONE).removeAttr('style');\n\n\t\tif (passed) {\n\t\t\t$el.find(SEL_SUMMARY_PASS).removeClass(CLS_NONE);\n\t\t\t$el.find(SEL_SUMMARY_FAIL).addClass(CLS_NONE);\n\n\t\t\t$el.find(SEL_SUMMARY_REQUIRE_MSG).addClass(CLS_NONE);\n\t\t}\n\n\t\t//Render activity summary widget\n\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t.data(\"settings\",\n\t\t\t{\n\t\t\t\tpassed: passed,\n\t\t\t\tcorrectNum: me.correctCount,\n\t\t\t\tskippedNum: me.incorrectCount,\n\t\t\t\tpassNum: me.correctRequired\n\t\t\t})\n\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t.weave();\n\t}\n\n\tfunction onClickOption($selectedOption) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif ($selectedOption.hasClass(CLS_DISABLED) || me.optionFreezed) {\n\t\t\treturn;\n\t\t}\n\n\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_DISABLED);\n\n\t\tvar optionId = $selectedOption.data(\"id\");\n\t\tvar checkResult = me.checkAnswer(me.currentCardIndex, optionId);\n\t\tme.displayInteractionResult(checkResult, $selectedOption);\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/activity/template/flashcardchoice/load\": function (options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._super = options._super;\n\t\t\tme._interacted = false;\n\t\t\t// set instant feedback on\n\t\t\tme._item.instantFeedback(true);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\tcheckAnswer: function (questionIndex, optionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, questionIndex, optionId, 'flashCards');\n\t\t\tvar correct = interaction.correct;\n\n\t\t\tif (correct) {\n\t\t\t\tme.correctCount++;\n\t\t\t\tme.incorrectCount--;\n\t\t\t\tme._json.content._isCorrect = me.isPassed();\n\t\t\t}\n\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\t\t\treturn {\n\t\t\t\tcorrect: correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t},\n\t\tdisplayInteractionResult: function (checkResult, $selectedOption) {\n\t\t\tvar me = this;\n\t\t\tvar $el = this.$element;\n\t\t\tvar $correctIcon = me.$activeCard.find(SEL_CORRECT_ICON);\n\n\t\t\tme.optionFreezed = true;\n\n\t\t\tif (checkResult.correct) {\n\t\t\t\tme.$activeCard.addClass(CLS_CORRECT);\n\t\t\t\t$selectedOption.addClass(CLS_CORRECT);\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tcheckResult.promise.then(function () {\n\t\t\t\t\t\tswitchCard.call(me);\n\t\t\t\t\t\tme.optionFreezed = false;\n\t\t\t\t\t});\n\t\t\t\t}, SWITCH_DELAY);\n\t\t\t} else {\n\t\t\t\t$selectedOption.addClass(CLS_INCORRECT);\n\t\t\t\tme.$activeCard.addClass(CLS_INCORRECT);\n\t\t\t\t$correctIcon.effect('shake', {distance: 8, times: 3}, 100, function () {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tme.$activeCard.removeClass(CLS_INCORRECT);\n\t\t\t\t\t\t$selectedOption.removeClass(CLS_INCORRECT).addClass(CLS_DISABLED);\n\t\t\t\t\t\tme.optionFreezed = false;\n\t\t\t\t\t\t$el.find(SEL_BTN_SKIP).removeClass(CLS_DISABLED);\n\t\t\t\t\t}, FEEDBACK_DELAY);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tpublishSkipInteraction: function (questionIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.flashCards[questionIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\treturn me._super.publishInteraction(interaction);\n\t\t},\n\t\tisPassed: function () {\n\t\t\tvar me = this;\n\t\t\treturn me.correctCount >= me.correctRequired;\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/flashcard-choice/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-fce-wrap\\\" data-weave=\\\"school-ui-activity/activity/flashcard-choice/flashcard-choice\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/flashcard-choice/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'template!./main.html',\n\t'./flashcard-choice'\n], function activityTemplateModule($, when, Widget, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_FLASHCARD_CHOICE_LOAD = \"activity/template/flashcardchoice/load\";\n\n\tfunction Ctor() {\n\t}\n\n\tfunction render() {\n\n\t\tvar me = this;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_FLASHCARD_CHOICE_LOAD, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.length(1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/flashcard-exercise.html',[],function() { return function template(data) { var o = \"\";\nvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n\\n<div class=\\\"ets-act-fce\\\">\\n\\t<div class=\\\"ets-act-fce-main\\\">\\n\\t\\t<div class=\\\"ets-act-fce-bd\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-stack\\\">\\n\\t\\t\\t\\t\";\n\t\t\t\tvar data = data || {};\n\t\t\t\tvar cards = data.cards;\n\t\t\t\tvar correctRequired = data.correctRequired;\n\t\t\t\tfor(var i = 0; i < cards.length; i++){\n\t\t\t\t\twriteItem(cards[i], i);o += \"\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-fce-ctrl\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t\\t\\t<div data-at-id=\\\"btn-skip\\\" class=\\\"ets-act-fce-btn ets-act-btn-skip ets-btn-skip\\\"><span \" +blurb(450011,\"Skip\")+ \"></span></div>\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-fce-number\\\">\\n\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-fce-number-current\\\">4</span> / <span class=\\\"ets-act-fce-number-total\\\">6</span>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-fce-ft\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-mic\\\">\\n\\t\\t\\t\\t <div data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-fce-typing ets-none\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-fce-typing-box\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-input\\\"><input type=\\\"text\\\" name=\\\"\\\" data-at-id=\\\"answer_input\\\" class=\\\"ets-act-fce-typing-input\\\" /> <div data-at-id=\\\"submit\\\" class=\\\"ets-btn ets-btn-blue ets-act-fce-typing-check ets-disabled\\\"><span \" +blurb(443583, \"DONE\")+ \"></span></div></div>\\n\\t\\t\\t\\t\\t<i class=\\\"ets-icon-correct-s\\\"></i> <i class=\\\"ets-icon-incorrect-s\\\"></i>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\t<!-- Activity Summary Start-->\\n\\t<div class=\\\"ets-act-summary-wrap\\\"></div>\\n\\t<!-- Activity Summary End-->\\n</div>\\n\\n\\n\"; function writeItem(data, index) {\n\tvar index = parseInt(index) + 1;\n\to += \"\\n\\t<div class=\\\"ets-act-fce-card \";if (index > 4) {o += \"ets-candidate \";} else {o += \" ets-stack-\" +index+ \" \";}o += \"\\\" id=\\\"ets-act-fce-card\" +data._id+ \"\\\" data-at-id=\\\"\" +data._id+ \"\\\">\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<img src=\\\"\" +data.image.url+ \"\\\" />\\n\\t\\t</div>\\n        <div class=\\\"ets-icon\\\">\\n            <span></span>\\n        </div>\\n\\t\\t<div class=\\\"ets-ft\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fce-word\\\">\\n\\t\\t\\t\\t\";if (data.audio) {o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-audio\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap ets-ap-small\\\">\\n\\t\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t\\t       data-src=\\\"\" +data.audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t\\t       data-at-id=\\\"answer_audio_\" +data._id+ \"\\\"\\n\\t\\t\\t\\t\\t\\t       class=\\\"ets-ap ets-ap-small ets-ap-nobar\\\"></audio>\\n\\t\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-text \";if (data.txt.length > 26) {o += \" ets-text-long\";}o += \"\\\"><span>\" +data.txt+ \"</span></div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\"; }  return o; }; });\n",
    "define('school-ui-activity/shared/typing-helper/main',[\n\t'jquery',\n\t'json2',\n\t'underscore',\n\t'school-ui-shared/utils/ccl',\n\t'when'\n], function ($, JSON, _, ccl, when) {\n\t\"use strict\";\n\n\tvar helper = {};\n\n\tvar cleanSpaces = function(text) {\n\t\treturn $.trim(text.replace(/\\s+/g, ' '));\n\t};\n\n\t/** adapt to multiple character\n\t * like story: spc-2850 and ANATELE-1052\n\t * To support multiple char in the user input answer and scoring.\n\t * like char \" ` \" is same with \" ' \"  in user story spc-2850\n\t * like some char looks same but with different unicode: ANATELE-1052\n\t */\n\tvar replaceRegexDict;\n\tvar replaceRegexDictPromise = when.promise(function (resolve, reject) {\n\t\tvar CCL_TYPING_REPLACE_DICT = 'ccl!\"e13.activity.typing.replaceDict\"';\n\t\tccl.query(CCL_TYPING_REPLACE_DICT).spread(function (replace_JSON) {\n\t\t\t// transform string JSON to really JSON and Regex\n\t\t\ttry {\n\n\t\t\t\treplaceRegexDict = JSON.parse(replace_JSON.value);\n\n\t\t\t\tif (replaceRegexDict) {\n\t\t\t\t\t$.each(replaceRegexDict, function (key, value) {\n\t\t\t\t\t\tvar pattern;\n\t\t\t\t\t\tvar flags;\n\n\t\t\t\t\t\tif (value.indexOf('/') == 0) {\n\t\t\t\t\t\t\tvar lastIndex = value.lastIndexOf(\"/\");\n\t\t\t\t\t\t\tpattern = value.substring(1, lastIndex);\n\t\t\t\t\t\t\tflags = value.substring(lastIndex + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpattern = value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treplaceRegexDict[key] = new RegExp(pattern, flags);\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(replaceRegexDict);\n\t\t\t\t} else {\n\t\t\t\t\t// if this function is closed, it would not block any things.\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\t// if CCL value is not correct, or some error here, it likes no this module at all,\n\t\t\t\t// Would not block any things.\n\t\t\t\t// TODO: throw up to the error log\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t});\n\n\tvar replaceMultipleCharacters = function (str) {\n\t\t//Assume replaceRegexDict already loaded\n\t\tif (_.isString(str)) {\n\t\t\t$.each(replaceRegexDict, function (keyValue, regex) {\n\t\t\t\tstr = str.replace(regex, keyValue);\n\t\t\t});\n\t\t}\n\t\treturn str;\n\t};\n\n\thelper.readyPromise = replaceRegexDictPromise;\n\n\thelper.prepareTypingSolution = function prepareTypingSolution(solution) {\n\t\treturn solution.split('/').map(cleanSpaces).map(replaceMultipleCharacters);\n\t};\n\thelper.cleanTypingAnswer = function prepareTypingSolution(answer) {\n\t\treturn replaceMultipleCharacters(cleanSpaces(answer));\n\t};\n\n\treturn helper;\n});\n",
    "define('school-ui-activity/shared/asr/asr-service-message-type',[],function () {\n\treturn {\n\t\tVOICE_TOO_SLOW: \"VOICE_TOO_SLOW\",\n\t\tVOICE_TOO_FAST: \"VOICE_TOO_FAST\",\n\t\tVOICE_TOO_LOW: \"VOICE_TOO_LOW\",\n\t\tVOICE_TOO_HIGH: \"VOICE_TOO_HIGH\",\n\t\tCAN_NOT_RECOGNIZE: \"CAN_NOT_RECOGNIZE\",\n\t\tTIMEOUT: \"TIMEOUT\",\n\t\tNO_VOICE: \"NO_VOICE\",\n\t\tFLASH_ERROR: \"FLASH_ERROR\",\n\t\tSERVER_ERROR: \"SERVER_ERROR\",\n\t\tINCORRECT_ANSWER: \"INCORRECT_ANSWER\",\n\t\tINCORRECT_PRONUN: \"INCORRECT_PRONUN\",\n\t\tFALLBACK: \"FALLBACK\"\n\t}\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-ui-states',[],function () {\n\treturn {\n\t\t/*\n\t\t \"COMMON\" state is not a ASR internal state,\n\t\t it's controlled by external widget, like activity.\n\t\t Bad requirements make this happens.\n\t\t For example: LanguageComparation have a strange\n\t\t requirement which need set ASR failed when record a wrong answer.\n\t\t Details in https://jira.englishtown.com/browse/SPC-2921.\n\t\t */\n\t\tCOMMON: \"COMMON\",\n\t\tSTART: \"START\",\n\t\tSTOP: \"STOP\",\n\t\tNORMAL: \"NORMAL\",\n\t\tDISABLE: \"DISABLE\",\n\t\tRECORDING: \"RECORDING\",\n\t\tPROCESSING: \"PROCESSING\",\n\t\tPREPARING: \"PREPARING\",\n\t\tWARNING: \"WARNING\",\n\t\tERROR: \"ERROR\",\n\t\tHINT: \"HINT\",\n\t\tDOWN: \"DOWN\",\n\t\tBROKEN: \"BROKEN\",\n\t\tSTART_REPLAY: \"START_REPLAY\",\n\t\tSTOP_REPLAY: \"STOP_REPLAY\"\n\t};\n});\n\n",
    "// # Task Module\ndefine('school-ui-activity/activity/flashcard-exercise/flashcard-exercise',[\n\t\"jquery\",\n\t\"jquery.ui\",\n\t\"poly\",\n\t\"when\",\n\t\"troopjs-ef/component/widget\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./flashcard-exercise.html\",\n\t\"school-ui-activity/shared/typing-helper/main\",\n\t\"school-ui-shared/enum/rating-source-type\",\n\t\"school-ui-activity/shared/asr/asr-service-message-type\",\n\t\"school-ui-activity/shared/asr/asr-ui-states\"\n], function (\n\t$,\n\tui$,\n\tpoly,\n\twhen,\n\tWidget,\n\tScoring,\n\tInteraction,\n\ttTemplate,\n\tTypingHelper,\n\tratingSouceType,\n\tMSGType,\n\tASRUIStatus\n) {\n\t\"use strict\";\n\n\t// Constants\n\tvar HUB = 'hub/';\n\tvar TOPIC_FLASHCARD_EXERCISE_LOAD = \"activity/template/flashcardexercise/load\";\n\tvar TOPIC_ASR_STOP_PLAYBACK = \"asr/stopPlayback\";\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_FCE_MAIN = \".ets-act-fce-main\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_FIRST = \"ets-stack-1\",\n\t\tCLS_SECOND = \"ets-stack-2\",\n\t\tCLS_THIRD = \"ets-stack-3\",\n\t\tCLS_FOURTH = \"ets-stack-4\",\n\t\tCLS_CANDIDATE = \"ets-candidate\",\n\t\tCLS_DONE = \"ets-done\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_AUDIO_ONLY = \"ets-audio-only\",\n\n\t\tSEL_ASR_CONTAINER = \".ets-act-fce-mic\",\n\t\tSEL_FIRST_CARD = \".ets-act-fce-card.ets-stack-1\",\n\t\tSEL_SECOND_CARD = \".ets-act-fce-card.ets-stack-2\",\n\t\tSEL_THIRD_CARD = \".ets-act-fce-card.ets-stack-3\",\n\t\tSEL_FOURTH_CARD = \".ets-act-fce-card.ets-stack-4\",\n\t\tSEL_CANDIDATE = \".ets-act-fce-card.ets-candidate\",\n\t\tSEL_BTN_SKIP = \".ets-act-fce-btn.ets-btn-skip\",\n\n\t\tSEL_TYPING_CONTAINER = \".ets-act-fce-typing\",\n\t\tSEL_TYPING_BOX = \".ets-act-fce-typing-box\",\n\t\tSEL_TYPING_INPUT = \".ets-act-fce-typing-input\",\n\t\tSEL_TYPING_CHECK = \".ets-act-fce-typing-check\",\n\n\t\tSEL_AUDIO = \".ets-ap\",\n\n\t\tSEL_WORD = \".ets-act-fce-word\",\n\n\t\tSEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\",\n\n\t\tSEL_COUNT_CURRENT = \".ets-act-fce-number-current\",\n\t\tSEL_COUNT_TOTAL = \".ets-act-fce-number-total\",\n\n\t\tHUB_ASR_SET = \"asr/ui/setting\",\n\t\tHUB_REMOVE_INTRO_TITLE = \"dispose/reference\",\n\n\t\tSEL_CORRECT_ICON = \".ets-icon span\",\n\n\t\tSWITCH_DELAY = 800,\n\t\tFEEDBACK_DELAY = 500;\n\n\tvar CCL_ASR_ENABLED = 'ccl!\"school.asr.enabled\"';\n\n\t// Constructor\n\tfunction Ctor() {\n\t\tthis.currentCardIndex = 0;\n\t\tthis.correctCount = {};\n\t\tthis.incorrectCount = {};\n\t\tthis.totalCards = {};\n\t\tthis.$activeCard = {};\n\t\tthis.$activeQuestion = {};\n\t\tthis.answerMode = 'ASR';\n\t\tthis.asrDisabled = false;\n\t\tthis.asrMode = ratingSouceType[\"ASR_SPEAKING\"];\n\t}\n\n\t// # Render\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar flashcards = this._json.content.flashCards;\n\n\t\tif (!flashcards || !flashcards.length) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\tme.totalCards = this._json.content.flashCards.length;\n\n\t\t//Init summary page card numbers\n\t\tme.correctRequired = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * me.totalCards);\n\t\tme.correctCount = 0;\n\t\tme.incorrectCount = me.totalCards;\n\n\t\tif (flashcards && flashcards[0] && flashcards[0].pronsXML) {\n\t\t\tme.hasPronsXML = true;\n\t\t}\n\n\t\treturn me.html(tTemplate, {cards: flashcards, correctRequired: me.correctRequired});\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = this.$element,\n\t\t\tenableSwitchASRMode = !me.asrDisabled\n\t\t\t\t&& !me._json.asrDisabled\n\t\t\t\t&& me.hasPronsXML\n\t\t\t\t&& window.location.search.indexOf(\"non-asr\") < 0;\n\n\t\t$el.find(SEL_BTN_SKIP).click(function () {\n\t\t\tif ($(this).hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.publish(\"asr/disable\");\n\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\tme.publishSkipInteraction(me.currentCardIndex)\n\t\t\t\t.then(function () {\n\t\t\t\t\tswitchCard.call(me);\n\t\t\t\t\tme.publish(\"asr/enable\");\n\t\t\t\t});\n\t\t});\n\n\t\tme.$activeCard = $el.find(SEL_FIRST_CARD);\n\n\t\t$el.find(SEL_COUNT_TOTAL).text(me.totalCards);\n\t\t$el.find(SEL_COUNT_CURRENT).text(me.currentCardIndex + 1);\n\n\t\tme.publish(HUB_ASR_SET, onASRRecognized.bind(me), me._json.content.flashCards[me.currentCardIndex], {\n\t\t\tasrFallbackType: \"TYPING\",\n\t\t\tasrFallbackCb: switchAnswerMode.bind(me, \"TYPING\"),\n\t\t\tneedResetASRFailedTimes: true,\n\t\t\tasrEnableTip: true\n\t\t});\n\n\t\tif (!enableSwitchASRMode) {\n\t\t\tswitchAnswerMode.call(me, \"TYPING\");\n\t\t\tme.asrMode = ratingSouceType[\"ASR_TYPING\"];\n\t\t}\n\t}\n\n\n\tfunction switchAnswerMode(mode) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tswitch (mode) {\n\t\t\tcase 'ASR':\n\t\t\t\tme.answerMode = 'ASR';\n\t\t\t\t$el.find(SEL_TYPING_CONTAINER).addClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).removeClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_WORD).removeClass(CLS_AUDIO_ONLY);\n\t\t\t\t$el.find(SEL_TYPING_CHECK).unbind('click');\n\t\t\t\t$el.find(SEL_TYPING_INPUT).unbind('change');\n\t\t\t\tme._super.scoringType('asr');\n\t\t\t\tbreak;\n\t\t\tcase 'TYPING':\n\t\t\t\tme.answerMode = 'TYPING';\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).addClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_TYPING_CONTAINER).removeClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_WORD).addClass(CLS_AUDIO_ONLY);\n\t\t\t\tme._super.scoringType('default');\n\n\t\t\t\t$el.find(SEL_TYPING_CHECK).click(function () {\n\t\t\t\t\tonClickCheck.call(me);\n\t\t\t\t});\n\n\t\t\t\tonInputFocus.call(me);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction onASRRecognized(asrResult) {\n\t\tvar me = this;\n\t\tvar phraseResult = asrResult[0];\n\t\tvar checkResult = me.checkAnswer(me.currentCardIndex, phraseResult);\n\t\tme.displayInteractionResult(checkResult, asrResult);\n\t}\n\n\tfunction switchCard() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t// send pause to all audio in activity\n\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\n\t\tif (me.currentCardIndex + 1 >= me.totalCards) {\n\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_NONE);\n\t\t\tme._json.content._isCorrect = me.isActivityPassed();\n\t\t\tme._item.completed(true);\n\t\t\t$el.find(SEL_FCE_MAIN).fadeOut(200, function () {\n\t\t\t\tviewSummary.call(me);\n\t\t\t});\n\t\t} else {\n\t\t\tvar $firstCard = $el.find(SEL_FIRST_CARD),\n\t\t\t\t$secondCard = $el.find(SEL_SECOND_CARD),\n\t\t\t\t$thirdCard = $el.find(SEL_THIRD_CARD),\n\t\t\t\t$fourthCard = $el.find(SEL_FOURTH_CARD),\n\t\t\t\t$candidate = $($el.find(SEL_CANDIDATE).first());\n\n\t\t\tme.currentCardIndex++;\n\n\t\t\t$el.find(SEL_COUNT_CURRENT).text(me.currentCardIndex + 1);\n\n\t\t\t$firstCard.animate({left: \"+=150\", top: \"-=100\", opacity: \"0\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_FIRST).addClass(CLS_DONE);\n\t\t\t});\n\n\t\t\t$secondCard.animate({top: \"0\", left: \"12\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_SECOND).addClass(CLS_FIRST);\n\t\t\t\tme.$activeCard = $el.find(SEL_FIRST_CARD);\n\t\t\t});\n\n\t\t\t$thirdCard.animate({top: \"6\", left: \"6\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_THIRD).addClass(CLS_SECOND);\n\t\t\t});\n\n\t\t\t$fourthCard.animate({top: \"12\", left: \"0\", opacity: \"1\"}, 300, function () {\n\t\t\t\t$(this).removeAttr(\"style\").removeClass(CLS_FOURTH).addClass(CLS_THIRD);\n\t\t\t});\n\n\t\t\t$candidate.removeClass(CLS_CANDIDATE).addClass(CLS_FOURTH);\n\n\t\t\t$el.find(SEL_TYPING_INPUT).removeAttr(\"readonly\").val('');\n\t\t\t$el.find(SEL_TYPING_CHECK).addClass(CLS_DISABLED);\n\n\t\t\tme.publish(\n\t\t\t\tHUB_ASR_SET,\n\t\t\t\tonASRRecognized.bind(me),\n\t\t\t\tme._json.content.flashCards[me.currentCardIndex],\n\t\t\t\t{\n\t\t\t\t\tasrEnableTip: true\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t}\n\n\tfunction viewSummary() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t//Render activity summary widget\n\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t.data(\"settings\",\n\t\t\t{\n\t\t\t\tpassed: me.isActivityPassed(),\n\t\t\t\tcorrectNum: me.correctCount,\n\t\t\t\tskippedNum: me.incorrectCount,\n\t\t\t\tpassNum: me.correctRequired\n\t\t\t})\n\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t.weave();\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\t}\n\n\tfunction onClickCheck() {\n\t\tvar me = this,\n\t\t\t$el = this.$element,\n\t\t\t$check = $el.find(SEL_TYPING_CHECK),\n\t\t\t$input = $el.find(SEL_TYPING_INPUT);\n\n\t\tif (!this.answerMode == \"TYPING\" || $check.hasClass(CLS_DISABLED)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar answer = $input.val();\n\t\tvar checkResult = me.checkTypingAnswer(me.currentCardIndex, answer);\n\t\tme.displayInteractionResult(checkResult);\n\t}\n\n\tfunction onInputFocus() {\n\t\tvar me = this,\n\t\t\t$el = this.$element,\n\t\t\t$check = $el.find(SEL_TYPING_CHECK),\n\t\t\t$input = $el.find(SEL_TYPING_INPUT);\n\n\n\t\t$input.keyup(function (e) {\n\t\t\tif (e.which == 13) {\n\t\t\t\tonClickCheck.call(me);\n\t\t\t} else {\n\t\t\t\tif ($.trim($input.val()).length > 0) {\n\t\t\t\t\t$check.removeClass(CLS_DISABLED);\n\t\t\t\t} else {\n\t\t\t\t\t$check.addClass(CLS_DISABLED);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn when.all([\n\t\t\t\trender.call(this),\n\t\t\t\tTypingHelper.readyPromise\n\t\t\t]);\n\t\t},\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\tme.query(CCL_ASR_ENABLED).spread(function (asrEnabledCcl) {\n\t\t\t\tme.asrDisabled = !(asrEnabledCcl && asrEnabledCcl.value === 'true');\n\t\t\t});\n\t\t},\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tif (!state) return;\n\t\t\t// this.state(state);\n\t\t\tvar $el = this.$element,\n\t\t\t\t$skipButton = $el.find(SEL_BTN_SKIP);\n\t\t\tswitch (state) {\n\t\t\t\tcase ASRUIStatus.RECORDING:\n\t\t\t\tcase ASRUIStatus.PROCESSING:\n\t\t\t\tcase ASRUIStatus.PREPARING:\n\t\t\t\tcase ASRUIStatus.DISABLE:\n\t\t\t\t\t$skipButton.addClass(CLS_DISABLED);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t\"hub/rating/sourceType\": function () {\n\t\t\treturn [this.asrMode];\n\t\t},\n\t\t\"dom:.ets-ap/media/play\": function () {\n\t\t\tthis.publish(TOPIC_ASR_STOP_PLAYBACK);\n\t\t},\n\t\tisActivityPassed: function () {\n\t\t\tvar me = this;\n\t\t\treturn me.correctCount >= me.correctRequired;\n\t\t},\n\t\tcheckAnswer: function (flashcardIndex, phraseResult) {\n\t\t\tvar me = this;\n\t\t\tvar correct = Scoring.isPhraseCorrect(phraseResult);\n\n\t\t\tif (correct) {\n\t\t\t\tme.incrementCorrectCount();\n\t\t\t}\n\n\t\t\tvar promise = this._super.publishInteraction(\n\t\t\t\tInteraction.makeAsrInteraction(correct, phraseResult._id));\n\n\t\t\treturn {\n\t\t\t\tcorrect: correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t},\n\t\tcheckTypingAnswer: function (flashcardIndex, answer) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar flashcard = json.content.flashCards[flashcardIndex];\n\t\t\tvar solution = Scoring.findById(json.scoring.flashCards, flashcard._id);\n\t\t\tvar cleanedAnswer = TypingHelper.cleanTypingAnswer(answer).toLowerCase();\n\t\t\tvar expectedAnswer = TypingHelper.cleanTypingAnswer(solution.answer).toLowerCase();\n\t\t\tvar correct = (expectedAnswer === cleanedAnswer);\n\n\t\t\tif (correct) {\n\t\t\t\tme.incrementCorrectCount();\n\t\t\t}\n\n\t\t\tvar promise = this._super.publishInteraction(\n\t\t\t\tInteraction.makeAsrFallbackInteraction(correct, flashcard._id));\n\n\t\t\treturn {\n\t\t\t\tcorrect: correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t},\n\t\tpublishSkipInteraction: function (flashcardIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.flashCards[flashcardIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\treturn me._super.publishInteraction(interaction);\n\t\t},\n\t\tincrementCorrectCount: function () {\n\t\t\tvar me = this;\n\t\t\tme.correctCount++;\n\t\t\tme.incorrectCount--;\n\t\t},\n\t\tdisplayInteractionResult: function (checkResult, asrResult) {\n\t\t\tvar me = this;\n\t\t\tvar json = this._json;\n\t\t\tvar $el = this.$element;\n\t\t\tvar $typingBox = $el.find(SEL_TYPING_BOX);\n\t\t\tvar $input = $el.find(SEL_TYPING_INPUT);\n\t\t\tvar $correctIcon = me.$activeCard.find(SEL_CORRECT_ICON);\n\n\t\t\tif (checkResult.correct) {\n\t\t\t\tme.$activeCard.addClass(CLS_CORRECT);\n\t\t\t\t$typingBox.addClass(CLS_CORRECT);\n\t\t\t\t$input.attr(\"disabled\", \"disabled\");\n\t\t\t\tme.publish(\"asr/disable\");\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tcheckResult.promise.then(function () {\n\t\t\t\t\t\tswitchCard.call(me);\n\t\t\t\t\t\t$typingBox.removeClass(CLS_CORRECT);\n\t\t\t\t\t\t$input.removeAttr(\"disabled\").focus();\n\t\t\t\t\t\tme.publish(\"asr/enable\");\n\t\t\t\t\t});\n\t\t\t\t}, SWITCH_DELAY);\n\t\t\t} else {\n\t\t\t\tme.$activeCard.addClass(CLS_INCORRECT);\n\t\t\t\t$typingBox.addClass(CLS_INCORRECT);\n\t\t\t\t$input.attr(\"disabled\", \"disabled\");\n\n\t\t\t\tif (asrResult && !asrResult._hasError) {\n\t\t\t\t\tme.publish(\"asr/show/message\", MSGType.INCORRECT_PRONUN);\n\t\t\t\t}\n\n\t\t\t\t$correctIcon.effect('shake', {distance: 8, times: 3}, 100, function () {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tme.$activeCard.removeClass(CLS_INCORRECT);\n\t\t\t\t\t\t$typingBox.removeClass(CLS_INCORRECT);\n\t\t\t\t\t\t$input.removeAttr(\"disabled\").focus();\n\t\t\t\t\t\t//show asr message\n\t\t\t\t\t}, FEEDBACK_DELAY);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tmethods[HUB + TOPIC_FLASHCARD_EXERCISE_LOAD] = function (parent, options) {\n\t\tvar me = this;\n\n\t\tme._json = options.json;\n\t\tme._item = options.item;\n\t\tme._super = parent;\n\n\t\tme._interacted = false;\n\t\t// set instant feedback on\n\t\tme._item.instantFeedback(true);\n\n\t\treturn me.signal('render').then(function () {\n\t\t\tonRendered.call(me);\n\t\t});\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/flashcard-exercise/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-fce-wrap\\\" data-weave=\\\"school-ui-activity/activity/flashcard-exercise/flashcard-exercise\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/flashcard-exercise/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'school-ui-activity/shared/typing-helper/main',\n\t'./flashcard-exercise',\n\t'template!./main.html'\n], function activityTemplateModule($, when, Widget, TypingHelper, FlashcardExercise, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_FLASHCARD_EXERCISE_LOAD = \"activity/template/flashcardexercise/load\";\n\n\tfunction Ctor() {\n\t\tthis.scoringType(Widget.SCORING_TYPE.ASR);\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me._htmlPromise) {\n\t\t\tme._htmlPromise = me.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn me._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_FLASHCARD_EXERCISE_LOAD, me, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.length(1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tdelete this._htmlPromise;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/flashcard-presentation/flashcard-presentation.html',[],function() { return function template(data) { var o = \"\";\n\tvar cards = data.flashCards;\n \tvar len = cards.length;\n \tvar CLS_DISTANT = '';\n \tif (len < 10) {\n \t\tCLS_DISTANT = \"ets-distant\";\n \t}\no += \"\\n<div class=\\\"ets-act-fcp\\\">\\n\\t<div class=\\\"ets-act-fcp-main \\\">\\n\\t\\t<ul>\\n\\t\\t\\t\";for(var i=0; i<len; i++){o += \"\\n\\t\\t\\t\\t<li class=\\\"ets-act-fcp-item ets-foggy \" + CLS_DISTANT+ \"\\\" data-at-id=\\\"\" +cards[i]._id+ \"\\\" data-index=\\\"\" +i + \"\\\">\\n\\t\\t\\t\\t\\t<img src=\\\"\" + cards[i].image.url+ \"\\\" alt=\\\"\\\" />\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t\";}o += \"\\n\\t\\t</ul>\\n\\t</div>\\n\\t<div class=\\\"ets-act-fcp-side\\\">\\n\\t\\t<div class=\\\"ets-act-fcp-card-wrap\\\">\\n\\t\\t\\t<div class=\\\"ets-act-fcp-card\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-front\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-img\\\"></div>\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-vocabulary\\\">\\n\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-audio\\\">\\n\\t\\t\\t\\t\\t\\t\\t<div data-at-id=\\\"answer_audio\\\" class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap ets-ap-small\\\">\\n\\t\\t\\t\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t\\t\\t\\t       id=\\\"ets-act-fcp-audio-player\\\"\\n\\t\\t\\t\\t\\t\\t\\t\\t       data-src=\\\"\" +cards[0].audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t\\t\\t\\t       class=\\\"ets-ap ets-ap-small ets-ap-nobar\\\"></audio>\\n\\t\\t\\t\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-text\\\"></div>\\n\\t\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-back ets-none\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-fcp-card-translation\\\">\\n\\t\\t\\t\\t\\t\\t<h4></h4>\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-translation\\\">\\n\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-translation-title\\\"></span> \\n\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-partofspeech\\\"></span>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-pronunciation\\\">\\n\\t\\t\\t\\t\\t\\t\\t<span></span>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-definition\\\">\\n\\t\\t\\t\\t\\t\\t\\t<span></span>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-example\\\">\\n\\t\\t\\t\\t\\t\\t\\t<ol>\\n\\t\\t\\t\\t\\t\\t\\t</ol>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-fcp-card-action ets-none\\\">\\n\\t\\t\\t<div class=\\\"ets-btn ets-btn-white ets-btn-shadowed ets-act-fcp-flip ets-act-fcp-normal\\\" data-at-id=\\\"btn-filp\\\">\\n\\t\\t\\t\\t<span>\\n\\t\\t\\t\\t\\t<i class=\\\"ets-icon-flip\\\"></i>\\n\\t\\t\\t\\t\\t<span class=\\\"ets-act-fcp-info-normal\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='469642' data-text-en='Grammar Notes'></span>\\n\\t\\t\\t\\t\\t<span class=\\\"ets-act-fcp-info-back\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='469643' data-text-en='Flip Back'></span>\\n\\t\\t\\t\\t</span>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-fcp-reminder ets-clear\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='465094' data-text-en='Make sure you try all cards at least once before moving on!'></div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/flashcard-presentation/main',[\n\t'jquery',\n\t'poly',\n\t'underscore',\n\t'../base/main',\n\t\"troopjs-core/pubsub/hub\",\n\t\"jquery.flip\",\n\t\"template!./flashcard-presentation.html\"\n], function FlashCardPresentation($, poly, _, Widget, Hub, flip$, tTemplate) {\n\t\"use strict\";\n\n\t// TODO: constants\n\tvar SEL_ITEM = \".ets-act-fcp-item\",\n\t\tSEL_CARD = \".ets-act-fcp-card\",\n\t\tSEL_CARD_FRONT = \".ets-act-fcp-card-front\",\n\t\tSEL_CARD_BACK = \".ets-act-fcp-card-back\",\n\t\tSEL_CARD_ACTION = \".ets-act-fcp-card-action\",\n\t\tSEL_CARD_IMG = \".ets-act-fcp-card-img\",\n\t\tSEL_CARD_TXT = \".ets-act-fcp-card-text\",\n\t\tSEL_CARD_FLIP = \".ets-act-fcp-flip\",\n\t\tSEL_FOGGY_ITEM = \".ets-act-fcp-item.ets-foggy\",\n\t\tSEL_CARD_TRANS = \".ets-act-fcp-card-translation\",\n\t\tSEL_CARD_TITLE = \"> h4\",\n\t\tSEL_PRONOUNCE = \"> .ets-pronunciation > span\",\n\t\tSEL_TRANS = \"> .ets-translation .ets-translation-title\",\n\t\tSEL_DEFINITION = \"> .ets-definition\",\n\t\tSEL_EXAMPLES = \"> .ets-example ol\",\n\t\tSEL_AUDIO_PLAYER = \"#ets-act-fcp-audio-player\",\n\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\t\tCLS_FOGGY = \"ets-foggy\",\n\t\tCLS_FLIP_BACK = \"ets-act-fcp-back\",\n\n\t\tDURATION_FADE_OUT = 100,\n\t\tDURATION_FADE_IN = 200,\n\n\t\tEN = \"en\",\n\t\tANAT = \"Anat\",\n\n\t\tHUB_CONTEXT = \"context\";\n\n\tfunction flipCard() {\n\t\tvar me = this,\n\t\t\tfliped = me._cardFlipped;\n\n\t\tflip$(me._$card).flip({\n\t\t\tdirection: fliped ? 'lr' : 'rl',\n\t\t\tbgColor: '#eee',\n\t\t\tspeed: 300,\n\t\t\tonEnd: function () {\n\t\t\t\tme._$cardFront.toggleClass(CLS_NONE, !fliped);\n\t\t\t\tme._$cardBack.toggleClass(CLS_NONE, fliped);\n\t\t\t\tme._$btnFlip.toggleClass(CLS_FLIP_BACK, !fliped);\n\t\t\t\tme._$card.removeAttr(\"style\");\n\t\t\t\tme._cardFlipped = !me._cardFlipped;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction selectItem(item) {\n\t\tvar me = this;\n\n\t\tvar $item = $(item);\n\t\tif ($item.hasClass(CLS_ACTIVE)) {\n\t\t\treturn;\n\t\t}\n\t\tclearTimeout(me.playTimeoutId);\n\t\tme._$items.not($item).removeClass(CLS_ACTIVE);\n\t\t$item.addClass(CLS_ACTIVE);\n\t\t$item.removeClass(CLS_FOGGY);\n\n\t\tvar $img = $item.find(\"img\").clone();\n\t\tvar index = $item.data(\"index\");\n\t\tvar data = me._json.content.flashCards[index];\n\t\tvar audioSrc = data.audio.url;\n\t\tvar text = data.txt;\n\n\t\tvar $phImg = this._$phImage;\n\t\tvar fadeInImg = function () {\n\t\t\t$phImg.hide().html($img).fadeIn(DURATION_FADE_IN);\n\t\t};\n\t\tif ($phImg.children().length) {\n\t\t\t$phImg.fadeOut(DURATION_FADE_OUT, fadeInImg);\n\t\t} else {\n\t\t\tfadeInImg();\n\t\t}\n\n\t\tme._$phText.text(text);\n\n\t\tswitchTrans.call(me, data);\n\t\tif (me._cardFlipped) {\n\t\t\tflipCard.call(me);\n\t\t}\n\n\t\t//Pause a while before play, for a smooth user experience\n\t\tme.playTimeoutId = setTimeout(function () {\n\t\t\t$(SEL_AUDIO_PLAYER).trigger(\"player/play\", audioSrc);\n\t\t}, 500);\n\n\t\t//Move on when all cards read\n\t\tif (!this.$element.find(SEL_FOGGY_ITEM).length) {\n\t\t\tthis.items().completed(true);\n\t\t}\n\t}\n\n\tfunction switchTrans(data) {\n\t\tvar trans = data.translation,\n\t\t\ttitle = data.txt,\n\t\t\tme = this;\n\n\t\tif (!trans) return;\n\n\t\tvar tagPre = \"<li><span>\",\n\t\t\ttagMid = \"</span></li><li><span>\",\n\t\t\ttagSuff = \"</span></li>\",\n\t\t\tbr = \"<br/>&nbsp;&nbsp;&nbsp;&nbsp;\",\n\t\t\tpron = $.trim(trans.phoneticSpelling),\n\t\t\tsampleSentences = [];\n\n\t\tif (_.isArray(trans.sampleSentences)) {\n\t\t\ttrans.sampleSentences.forEach(function (smpl) {\n\t\t\t\tvar sentence,\n\t\t\t\t\ttrans = \"\";\n\n\t\t\t\tif (!smpl) return;\n\n\t\t\t\tif (_.isObject(smpl)) {\n\t\t\t\t\tif (me.isNeedShowTrans && smpl[\"value\"] != smpl[\"key\"]) {\n\t\t\t\t\t\ttrans = br + ['<span class=\"ets-translation\">', smpl[\"value\"], '</span>'].join('');\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrans = \"\";\n\t\t\t\t\t}\n\t\t\t\t\tsentence = smpl[\"key\"] + trans;\n\n\t\t\t\t\tsampleSentences.push(sentence);\n\t\t\t\t} else {\n\t\t\t\t\tsampleSentences.push(smpl);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar samplesHTML = sampleSentences.length\n\t\t\t? (tagPre + sampleSentences.join(tagMid) + tagSuff)\n\t\t\t: \"\";\n\n\t\t//Check whether have '/' in prons, if not, wrap '/'.\n\t\tpron = (pron.length && pron.indexOf(\"/\") !== 0) ? ('/' + pron + '/') : pron;\n\n\t\tthis._$trans\n\t\t\t.find(SEL_CARD_TITLE)\n\t\t\t.text(title)\n\t\t\t.end()\n\t\t\t.find(SEL_TRANS)\n\t\t\t.text(trans.translation == title ? \"\" : trans.translation)\n\t\t\t.end()\n\t\t\t/*\n\t\t\t //currently, content not supply a partofspeech\n\t\t\t .find(SEL_TRANS_POSPE)\n\t\t\t .text(trans.partofspeech)\n\t\t\t .end()\n\t\t\t */\n\t\t\t.find(SEL_DEFINITION)\n\t\t\t.text(trans.definition)\n\t\t\t.end()\n\t\t\t.find(SEL_EXAMPLES)\n\t\t\t.html(samplesHTML)\n\t\t\t.end()\n\t\t\t.find(SEL_PRONOUNCE)\n\t\t\t.text(pron);\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\t\t\tme._cardFlipped = false;\n\t\t\tme.type(Widget.ACT_TYPE.LEARNING);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tvar $el = this.$element,\n\t\t\t\tisENCulture,\n\t\t\t\tisAnatPartner,\n\t\t\t\tme = this;\n\n\t\t\tme.isNeedShowTrans = true;\n\n\t\t\tfunction onContext(context) {\n\t\t\t\tif (context) {\n\t\t\t\t\tisENCulture = context.cultureCode === EN;\n\t\t\t\t\tisAnatPartner = context.partnerCode === ANAT;\n\n\t\t\t\t\tme.isNeedShowTrans = !isENCulture && !isAnatPartner;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tHub.subscribe(HUB_CONTEXT, Hub, onContext);\n\t\t\tHub.reemit(HUB_CONTEXT, false, Hub, onContext);\n\t\t\tHub.unsubscribe(HUB_CONTEXT, Hub, onContext);\n\n\t\t\treturn me.renderPromise = me\n\t\t\t\t.html(tTemplate, {\n\t\t\t\t\tflashCards: me._json.content.flashCards,\n\t\t\t\t\thasPassed: me.hasPassed\n\t\t\t\t})\n\t\t\t\t.then(function () {\n\t\t\t\t\tme._$items = $el.find(SEL_ITEM);\n\t\t\t\t\tme._$card = $el.find(SEL_CARD);\n\t\t\t\t\tme._$cardFront = $el.find(SEL_CARD_FRONT);\n\t\t\t\t\tme._$cardBack = $el.find(SEL_CARD_BACK);\n\t\t\t\t\tme._$phImage = $el.find(SEL_CARD_IMG);\n\t\t\t\t\tme._$phText = $el.find(SEL_CARD_TXT);\n\t\t\t\t\tme._$btnFlip = $el.find(SEL_CARD_FLIP);\n\t\t\t\t\tme._$trans = $el.find(SEL_CARD_TRANS);\n\n\t\t\t\t\tselectItem.call(me, me._$items[0]);\n\n\t\t\t\t\tif (me._json.templateCode === \"FlaPreFlip\" && me._json.canFlipCard) {\n\t\t\t\t\t\t$el.find(SEL_CARD_ACTION).removeClass(CLS_NONE);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\t\"sig/finalize\": function onInitialize() {\n\t\t\tvar me = this;\n\n\t\t\tvar $card = flip$(me._$card);\n\t\t\t//1. clear potencial timer to avoid submit wrong score\n\t\t\t$card.stop(true, true);\n\n\t\t\tme.renderPromise && me.renderPromise.ensure(function () {\n\t\t\t\tme._$items = null;\n\t\t\t\tme._$card = null;\n\t\t\t\tme._$cardFront = null;\n\t\t\t\tme._$cardBack = null;\n\t\t\t\tme._$phImage = null;\n\t\t\t\tme._$phText = null;\n\t\t\t\tme._$btnFlip = null;\n\t\t\t\tme._$trans = null;\n\t\t\t});\n\t\t},\n\t\t\"dom:.ets-act-fcp-item/click\": function onSwitchCrad($event) {\n\t\t\tselectItem.call(this, $event.currentTarget);\n\t\t},\n\t\t\"dom:.ets-act-fcp-flip/click\": function onSwitchCrad() {\n\t\t\tflipCard.call(this);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/grouping/grouping.html',[],function() { return function template(data) { var o = \"\";\n    var wordItems = data.wordItems;\n    var wordGroups = data.wordGroups;\n    var references = data.references;\n    var itemsLen = wordItems.length;\n    var groupsLen = wordGroups.length;\n    var stripClass = data.isCopyMode ? 'ets-act-grp-strip-copy' : 'ets-act-grp-strip-move';\no += \"\\n\";if (references.aud) {o += \"\\n<div class=\\\"ets-act-grp-audio\\\">\\n    <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n        <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n               data-src=\\\"\" +references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n               class=\\\"ets-ap\\\"></audio>\\n    </div></div>\\n</div>\\n\";}o += \"\\n<div class=\\\"ets-act-grp\\\">\\n    <div class=\\\"ets-act-grp-droparea\\\">\\n        \";for(var i=0; i < groupsLen; i++){o += \"\\n            <section>\\n                <h5><span>\" + wordGroups[i].txt+ \"</span></h5>\\n                <div class=\\\"ets-act-grp-target\\\" data-group=\\\"\" + wordGroups[i]._id+ \"\\\" data-at-id=\\\"\" + wordGroups[i]._id+ \"\\\"></div>\\n            </section>\\n        \";}o += \"\\n    </div>\\n\\n    <div class=\\\"ets-act-grp-originarea\\\">\\n        \";for(var i=0; i < itemsLen; i++){o += \"\\n            <div class=\\\"ets-act-grp-strip \" +stripClass+ \"\\\" data-group=\\\"\" + wordItems[i]._id+ \"\\\" data-at-id=\\\"\" + wordItems[i]._id+ \"\\\"><p>\" + wordItems[i].txt+ \"</p></div>\\n        \";}o += \"\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/grouping/main',[\n\t'jquery',\n\t'school-ui-activity/activity/base/main',\n\t'troopjs-core/component/factory',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t'template!./grouping.html',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'underscore'\n], function groupingMoveModule($, Widget, Factory, Scoring, Interaction, tTemplate, $ui, $uiTouchPunch, _) {\n\t\"use strict\";\n\n\t/**\n\t grouping move and copy mode\n\t */\n\tvar SEL_DROP_AREA = \".ets-act-grp-droparea\",\n\t\tSEL_ORIGIN_AREA = \".ets-act-grp-originarea\",\n\t\tSEL_TARGET = \".ets-act-grp-target\",\n\t\tSEL_ACTIVITY_BODY = \".ets-act-bd\",\n\t\tSEL_STRIP = \".ets-act-grp-strip\",\n\t\tSEL_ETS_ACT_BD_MAIN = \"div.ets-act-bd-main\",\n\n\t\tCLS_TARGET = \"ets-act-grp-target\",\n\t\tCLS_STRIP_MOVE = \"ets-act-grp-strip-move\",\n\t\tCLS_STRIP_COPY = \"ets-act-grp-strip-copy\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tCLS_HOVER = \"ets-hover\",\n\t\tCLS_ACCEPTED = \"ets-accepted\",\n\t\tCLS_GRADE_COMPLETED = \"ets-act-grade-completed\",\n\t\tCLS_STRIP_DISABLED = \"ets-act-strip-disabled\",\n\t\tSLIDETIME = {\"correct\": 500, \"incorrect\": 800};\n\n\t/**\n\t filter data that from service\n\t */\n\tfunction filterByGrade(data) {\n\t\tvar me = this;\n\t\t//specified correct items number which display on the page.\n\t\tvar optionNo = me._allItemsCount = data.filterOptions.optionNo;\n\t\t//specified distractor items number.\n\t\tvar distNo = data.filterOptions.distNo;\n\t\tvar filteredDistItems = [];\n\t\tvar filteredCount = 0;\n\t\tvar copyData = $.extend(true, {}, data);\n\t\tvar scoringDistItems = me._source.scoring.items;\n\t\tvar copyScoringGroups = $.extend(true, {}, me._source.scoring.groups);\n\t\t//the rest items which are filtered from scoring.group items.\n\t\tvar restGroupItems = [];\n\t\tcopyData.content.items = [];\n\t\tif (distNo > 0) {\n\t\t\tscoringDistItems = _.shuffle(scoringDistItems);\n\t\t\tfilteredDistItems = scoringDistItems.slice(0, distNo);\n\t\t\tcopyData.content.items = copyData.content.items.concat(filteredDistItems);\n\t\t}\n\t\t$.each(me._source.scoring.groups, function (p, v) {\n\t\t\tfilteredCount = filteredCount + v.items.length;\n\t\t});\n\t\t// specified correct items number larger than the account of scoring.group's items\n\t\tif (optionNo >= filteredCount) {\n\t\t\t$.each(me._source.scoring.groups, function (p, v) {\n\t\t\t\tcopyData.content.items = copyData.content.items.concat(v.items);\n\t\t\t});\n\t\t\tme._allItemsCount = filteredCount;\n\t\t} else {\n\t\t\twhile (optionNo > 0) {\n\t\t\t\t$.each(copyScoringGroups, function (p, v) {\n\t\t\t\t\tv.items = _.shuffle(v.items);\n\t\t\t\t\tif (v.items && v.items.length) {\n\t\t\t\t\t\tcopyData.content.items.push(v.items.shift());\n\t\t\t\t\t\toptionNo--;\n\t\t\t\t\t}\n\t\t\t\t\tif (optionNo <= 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t//merge not used items in scoring.groups\n\t\t\t$.each(copyScoringGroups, function (p, v) {\n\t\t\t\tif (v.items && v.items.length) {\n\t\t\t\t\trestGroupItems = restGroupItems.concat(v.items);\n\t\t\t\t}\n\t\t\t});\n\t\t\t//delete items which are existed in data.scoring.groups by filtering restGroupItems array.\n\t\t\t$.each(data.scoring.groups, function (p, v) {\n\t\t\t\tif (restGroupItems.length === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (v.items && v.items.length) {\n\t\t\t\t\tv.items = $.grep(v.items, function (m) {\n\t\t\t\t\t\tvar retain = true;\n\t\t\t\t\t\t$.each(restGroupItems, function (i, j) {\n\t\t\t\t\t\t\tif (m._id === j._id) {\n\t\t\t\t\t\t\t\tretain = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn retain;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t$.each(copyData.content.items, function (p, v) {\n\t\t\t$.each(data.content.items, function (m, n) {\n\t\t\t\tif (v._id === n._id) {\n\t\t\t\t\tv.txt = n.txt;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tdelete data.scoring.items;\n\t\tdata.content.items = _.shuffle(copyData.content.items);\n\t\tdata.content.items = _.uniq(data.content.items, false, function (p) {\n\t\t\treturn p.txt;\n\t\t});\n\t\treturn data;\n\t}\n\n\tfunction filterByNonGrade(data) {\n\t\tvar optionNo = data.filterOptions.optionNo;\n\t\tvar copyData = $.extend(true, {}, data);\n\t\tdata.content.items = _.shuffle(copyData.content.items).slice(0, optionNo);\n\t\tdata.content.items = _.uniq(data.content.items, false, function (p) {\n\t\t\treturn p.txt;\n\t\t});\n\t\treturn data;\n\t}\n\n\tfunction filterData(data) {\n\t\treturn this.hasScoring ? filterByGrade.call(this, data)\n\t\t\t: filterByNonGrade.call(this, data);\n\t}\n\n\t/**\n\t drop items which be drag to current container .\n\t */\n\tfunction startDroppable() {\n\t\tvar me = this;\n\t\tvar $groupTargetArea = this.$element.find(SEL_TARGET);\n\t\tvar $groupOriginArea = this.$element.find(SEL_ORIGIN_AREA);\n\t\t$groupTargetArea.droppable({\n\t\t\taccept: SEL_STRIP,\n\t\t\thoverClass: CLS_HOVER,\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $target = $(this),\n\t\t\t\t\t$strip = ui.draggable;\n\t\t\t\tdropStrip.call(me, $strip, $target);\n\t\t\t}\n\t\t});\n\n\t\t$.each($groupOriginArea.find(SEL_STRIP), function (p, v) {\n\t\t\tvar $el = $(v);\n\t\t\tvar isCopyMode = me._isCopyMode;\n\t\t\t$el.draggable({\n\t\t\t\tcontainment: SEL_ACTIVITY_BODY,\n\t\t\t\trevert: \"invalid\",\n\t\t\t\trevertDuration: 300,\n\t\t\t\tsnapMode: \"inner\",\n\t\t\t\tstack: isCopyMode ? \"\" : \"div.ets-act-grp-strip\",\n\t\t\t\thelper: isCopyMode ? 'clone' : 'original',\n\t\t\t\tcancel: \"\",\n\t\t\t\tscroll: false,\n\t\t\t\tstop: function (/*event, ui*/) {\n\t\t\t\t\tvar $me = $(this);\n\t\t\t\t\tif (!$me.parent().hasClass(CLS_TARGET)) {\n\t\t\t\t\t\t$me.animate({\"left\": 0, \"top\": 0}, 500);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: function (event, ui) {\n\t\t\t\t\tvar $me = $(this);\n\t\t\t\t\tif (isCopyMode) {\n\t\t\t\t\t\tui.helper.removeClass(CLS_STRIP_COPY).addClass(CLS_STRIP_MOVE);\n\t\t\t\t\t}\n\t\t\t\t\tif ($me.parent().hasClass(CLS_TARGET)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction cloneModeDrop(correct, $strip, $target) {\n\t\tvar me = this;\n\t\tvar $stripClone = $strip.clone();\n\t\t$stripClone.removeClass(CLS_STRIP_COPY).addClass(CLS_STRIP_MOVE);\n\t\t$target.prepend($stripClone.css({\"left\": 0, \"top\": 0}));\n\t\tif (correct) {\n\t\t\tme.hasScoring && $stripClone.addClass(CLS_CORRECT);\n\t\t\twindow.setTimeout(function () {\n\t\t\t\tslideCorrectStrip.call(me, $stripClone);\n\t\t\t}, SLIDETIME.correct);\n\t\t} else {\n\t\t\t$stripClone.addClass(CLS_INCORRECT);\n\t\t\twindow.setTimeout(function () {\n\t\t\t\t$stripClone.removeClass(CLS_INCORRECT);\n\t\t\t\tslideIncorrectCloneStrip.call(me, $stripClone, $strip, $target);\n\t\t\t}, SLIDETIME.incorrect);\n\t\t}\n\t}\n\n\tfunction moveModeDrop(correct, $strip, $target) {\n\t\tvar me = this;\n\t\t$target.prepend($strip.css({\"left\": 0, \"top\": 0}));\n\t\tif (correct) {\n\t\t\tme.hasScoring && $strip.addClass(CLS_CORRECT);\n\t\t\twindow.setTimeout(function () {\n\t\t\t\tslideCorrectStrip.call(me, $strip);\n\t\t\t}, SLIDETIME.correct);\n\t\t} else {\n\t\t\t$strip.addClass(CLS_INCORRECT);\n\t\t\twindow.setTimeout(function () {\n\t\t\t\tme.$element.find(SEL_ORIGIN_AREA).append($strip.removeClass(CLS_INCORRECT));\n\t\t\t\tslideIncorrectStrip.call(me, $strip, $target);\n\t\t\t}, SLIDETIME.incorrect);\n\t\t}\n\t}\n\n\tfunction slideCorrectStrip($strip) {\n\t\t$strip.animate(\n\t\t\t{\n\t\t\t\ttop: 60\n\t\t\t},\n\t\t\t500,\n\t\t\tfunction () {\n\t\t\t\t$(this).addClass(CLS_ACCEPTED);\n\t\t\t\tvar stripId = $strip.attr('data-group');\n\t\t\t\tif ($strip.siblings('[data-group=\"' + stripId + '\"]').length > 0) {\n\t\t\t\t\t$strip.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tfunction slideIncorrectStrip($strip, $target) {\n\t\tvar distance = {\n\t\t\t\"left\": $target.offset().left - $strip.offset().left,\n\t\t\t\"top\": $target.offset().top - $strip.offset().top\n\t\t};\n\t\t$strip.css({\"left\": distance.left, \"top\": distance.top})\n\t\t\t.animate({\"left\": 0, \"top\": 0}, 500);\n\t}\n\n\tfunction slideIncorrectCloneStrip($stripClone, $strip, $target) {\n\t\tvar me = this;\n\t\tvar distance = {\n\t\t\t\"sLeft\": $strip.position().left,\n\t\t\t\"sTop\": $strip.position().top,\n\t\t\t\"tLeft\": $target.position().left,\n\t\t\t\"tTop\": $target.position().top\n\t\t};\n\t\tme.$element.find(SEL_ORIGIN_AREA).append($stripClone.css({\"position\": \"absolute\"}));\n\t\t$stripClone.css({\"left\": distance.tLeft, \"top\": distance.tTop})\n\t\t\t.animate({\"left\": distance.sLeft, \"top\": distance.sTop},\n\t\t\t\t500,\n\t\t\t\tfunction () {\n\t\t\t\t\t$stripClone.remove();\n\t\t\t\t});\n\t}\n\n\tfunction dropStrip($strip, $target) {\n\t\tvar me = this;\n\t\tvar correct;\n\t\tvar stripId = $strip.data(\"group\");\n\t\tvar targetId = $target.data(\"group\");\n\t\tcorrect = me.checkAnswer(stripId, targetId);\n\t\tme.displayInteractionResult(correct, $strip, $target)\n\t}\n\n\t/**\n\t call completeGroup when all items are dragged to relative container\n\t */\n\tfunction completeGrouping() {\n\t\tvar me = this;\n\t\tif (!me.hasScoring) {\n\t\t\tme.items().answered(true);\n\t\t\treturn false;\n\t\t}\n\t\tvar json = me._json;\n\t\tjson.content._isCorrect = true;\n\t\tvar $selDropArea = me.$element.find(SEL_DROP_AREA);\n\t\tvar $originalArea = me.$element.find(SEL_ORIGIN_AREA);\n\t\t$selDropArea.addClass(CLS_GRADE_COMPLETED).hide().fadeIn('slow');\n\t\tdisabledStrip.call(me);\n\t\t$originalArea.children().length === 0 && $originalArea.remove();\n\t\tme.$element.parents(SEL_ETS_ACT_BD_MAIN).css({\"vertical-align\": \"top\"});\n\t\tme.items().completed(true);\n\t\tme.publish(\"activity-container/resize\");\n\t}\n\n\tfunction disabledStrip() {\n\t\tvar $originalArea = this.$element.find(SEL_ORIGIN_AREA);\n\t\t$originalArea.find(SEL_STRIP).draggable(\"disable\");\n\t\t$originalArea.addClass(CLS_STRIP_DISABLED);\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tme._isCopyMode = (me._json.templateCode == \"GroupCopy\");\n\t\tvar data = {\n\t\t\twordItems: me._json.content.items,\n\t\t\twordGroups: me._json.content.groups,\n\t\t\treferences: me._json.references,\n\t\t\tisCopyMode: me._isCopyMode\n\t\t};\n\n\t\treturn me.html(tTemplate, data)\n\t\t\t.then(function () {\n\t\t\t\tstartDroppable.call(me);\n\t\t\t\treturn me.attachATAssetDom(me._json.content.items);\n\t\t\t});\n\t}\n\n\tvar extendOptions = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.hasScoring || this.type(Widget.ACT_TYPE.PRACTICE);\n\t\t\tthis.items().instantFeedback(true);\n\n\t\t\tfilterData.call(this, this._json);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"completed\": Factory.around(function (base) {\n\t\t\treturn function () {\n\t\t\t\tbase.apply(this, arguments);\n\t\t\t\tthis._COMPLETED && disabledStrip.call(this);\n\t\t\t};\n\t\t}),\n\t\tcheckAnswer: function (stripId, targetId) {\n\t\t\tvar me = this;\n\n\t\t\tif (!me.hasScoring) {\n\t\t\t\twindow.setTimeout(function () {\n\t\t\t\t\tcompleteGrouping.call(me);\n\t\t\t\t}, SLIDETIME.correct);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar json = me._json;\n\t\t\tvar solution = Scoring.findById(json.scoring.groups, targetId);\n\t\t\tvar correctStrip = Scoring.findById(solution.items, stripId);\n\t\t\tvar correct = Boolean(correctStrip);\n\n\t\t\tvar alreadyAnswered = false;\n\t\t\tif (correct) {\n\t\t\t\tme._storeGroup[targetId] = me._storeGroup[targetId] || [];\n\t\t\t\tif (_.indexOf(me._storeGroup[targetId], stripId) === -1) {\n\t\t\t\t\tme._storeGroup[targetId].push(stripId);\n\t\t\t\t\tme._allItemsCount--;\n\t\t\t\t} else {\n\t\t\t\t\talreadyAnswered = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!alreadyAnswered) {\n\t\t\t\tvar promise = me.publishInteraction(\n\t\t\t\t\tInteraction.makeGroupingInteraction(correct, targetId, stripId));\n\t\t\t\tif (me._allItemsCount == 0) {\n\t\t\t\t\twindow.setTimeout(function () {\n\t\t\t\t\t\tpromise.then(function(){\n\t\t\t\t\t\t\tcompleteGrouping.call(me);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, SLIDETIME.correct);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $strip, $target) {\n\t\t\tvar me = this;\n\t\t\tif (me._isCopyMode) {\n\t\t\t\tcloneModeDrop.call(me, correct, $strip, $target);\n\t\t\t} else {\n\t\t\t\tmoveModeDrop.call(me, correct, $strip, $target);\n\t\t\t}\n\t\t}\n\t};\n\treturn Widget.extend(function () {\n\t\tthis._allItemsCount = 0;\n\t\tthis._storeGroup = {};\n\t}, extendOptions);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/language-comparison/language-comparison.html',[],function() { return function template(data) { var o = \"\";\tvar data = data || {},\r\n\t\tme = this,\r\n\t\tphrases = data.content.phrases[me.index()],\r\n\t\taudioUrl = phrases.audio.url,\r\n\t\ttext = phrases.text,\r\n\t\ttranslation = phrases.translation;\r\n\r\n\tvar outBlurb = function(id,en){\r\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\r\n\t    return res;\r\n\t};\r\no += \"\\r\\n\\r\\n<div class=\\\"ets-act-lnc ets-cf\\\">\\r\\n\\t<div class=\\\"ets-act-lnc-main\\\">\\r\\n\\t\\t<div class=\\\"ets-act-btn-skip ets-act-lnc-skip\\\">\\r\\n\\t\\t\\t<span \" +outBlurb(450011,\"Skip\")+ \"></span>\\r\\n\\t\\t</div>\\r\\n\\t\\t<div class=\\\"ets-act-lnc-content\\\">\\r\\n\\t\\t\\t<div class=\\\"ets-act-lnc-play\\\">\\r\\n\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-content\\\">\\r\\n\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-container\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-tip ets-none\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-tip-top\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-tip-mid\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-lnc-tip-msg\\\" \" +outBlurb(462459,\"Listen to the audio\")+ \"></span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-tip-bottom\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-btn\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t       data-src=\\\"\" +audioUrl+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t       class=\\\"ets-ap\\\" controls=\\\"controls\\\"></audio>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t</div></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-sentences\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-original\\\">\" +text+ \"</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-play-translation\\\">\" +translation+ \"</div>\\t\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t</div>\\r\\n\\r\\n\\t\\t\\t<div class=\\\"ets-act-lnc-record\\\">\\r\\n\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-content\\\">\\r\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg ets-first-time\\\">\\r\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-btn\\\" data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-tip ets-away\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-tip-top\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-tip-mid\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-lnc-tip-msg ets-act-lnc-tip-msg-repeat\\\" \" +outBlurb(465087,\"Try to repeat the phrase\")+ \"></span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-tip-bottom\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-container ets-away\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-title\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-title-top\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-title-bottom\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-title-content-container\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-lnc-record-msg-title-content ets-act-lnc-record-msg-title-content-correct\\\" \" +outBlurb(480559,\"Correct\")+ \">Correct</span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<span class=\\\"ets-act-lnc-record-msg-title-content ets-act-lnc-record-msg-title-content-wrong\\\" \" +outBlurb(480560,\"Try again!\")+ \"></span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t</div>\\t\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-content-container-top\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-content-container-inner\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-ap-lnc-record\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-content\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-record-msg-content-container-bottom\\\"></div>\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t<div class=\\\"ets-act-lnc-new-icon\\\"></div>\\r\\n\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t</div>\\r\\n\\t\\t\\t<div class=\\\"ets-act-lnc-number\\\">\\r\\n                <span class=\\\"ets-act-lnc-number-current\\\"></span> / <span class=\\\"ets-act-lnc-number-total\\\"></span>\\r\\n            </div>\\r\\n\\t\\t</div>\\r\\n\\t</div>\\r\\n\\t\\r\\n\\t<!-- Activity Summary Start-->\\r\\n\\t<div class=\\\"ets-act-summary-wrap\\\"></div>\\r\\n\\t<!-- Activity Summary End-->\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/language-comparison/v1',[\n\t\"jquery\",\n\t\"when\",\n\t\"poly\",\n\t\"school-ui-activity/activity/base/main\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./language-comparison.html\",\n\t\"school-ui-shared/enum/rating-source-type\",\n\t\"school-ui-activity/shared/asr/asr-service-message-type\",\n\t\"school-ui-activity/shared/asr/asr-ui-states\",\n\t\"school-ui-shared/utils/update-helper\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"school-ui-shared/enum/activity-event-type\"\n], function MultipleChoiceModule($, when, poly, Widget, Scoring, Interaction, tTemplate, ratingSourceType, MSGType, ASRUIStatus, updateHelper, parser, activityEventType) {\n\t\"use strict\";\n\n\t// declare variables\n\tvar CLS_NONE = \"ets-none\",\n\t\tCLS_WRONG = 'ets-wrong',\n\t\tCLS_CORRECT = 'ets-correct',\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_AWAY = \"ets-away\";\n\n\tvar SEL_BTN_SKIP = \".ets-act-lnc-skip\",\n\t\tSEL_AUDIO = \".ets-ap\",\n\t\tSEL_LNC_RECORD = \".ets-ap-lnc-record\",\n\t\tSEL_LNC_PLAY_TIP = \".ets-act-lnc-play-tip\",\n\t\tSEL_LNC_RECORD_TIP = \".ets-act-lnc-record-tip\",\n\t\tSEL_LNC_RECORD_CONTENT = \".ets-act-lnc-record-content\",\n\t\tSEL_LNC_RECORD_MSG_CONTAINER = \".ets-act-lnc-record-msg-container\",\n\t\tSEL_LNC_RECORD_MSG_CONTENT = \".ets-act-lnc-record-msg-content\",\n\n\t\tSEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\",\n\n\t\tSEL_LNC_NUMBER_CURRENT = '.ets-act-lnc-number-current',\n\t\tSEL_LNC_NUMBER_TOTAL = '.ets-act-lnc-number-total',\n\t\tSEL_LNC_MAIN = \".ets-act-lnc-main\",\n\t\tSEL_LNC_PLAY_TRANSLATION = \".ets-act-lnc-play-translation\",\n\t\tSEL_LNC_RECORD_MSG_TTITLE_CONTENT_CORRECT = \".ets-act-lnc-record-msg-title-content-correct\",\n\t\tSEL_LNC_RECORD_MSG_TTITLE_CONTENT_WRONG = \".ets-act-lnc-record-msg-title-content-wrong\";\n\n\tvar IS_CORRECT = \"_isCorrect\",\n\t\tIS_QUESTION_PASSED,\n\t\tPROP_ID = \"_id\";\n\n\tvar ACT_ID = \"act_id\",\n\t\tACT_TEMPLATE_ID = \"act_template_id\";\n\n\tvar MAP_ABTEST_EVENTTYPE = {\n\t\t\"V1\": activityEventType[\"lngCompRetryTimesV1\"],\n\t\t\"V2\": activityEventType[\"lngCompRetryTimesV2\"]\n\t};\n\n\tvar MAP_ABTEST_EVENTATTR = {\n\t\t\"pass\": \"|pass\",\n\t\t\"fail\": \"|fail\",\n\t\t\"skip\": \"|skip\",\n\t\t\"warning\": \"|warning\",\n\t\t\"broken\": \"|broken\"\n\t};\n\n\tvar HUB_ASR_SET = \"asr/ui/setting\",\n\t\tHUB_ASR_DISABLE = \"asr/disable\",\n\t\tHUB_ASR_STOP_PLAYBACK = \"asr/stopPlayback\",\n\t\tHUB_ASR_PLAYBACK = \"asr/startPlayback\",\n\t\tHUB_REMOVE_INTRO_TITLE = \"dispose/reference\";\n\n\tvar WIDGET_PATH_AUDIO_SHELL = \"school-ui-activity/shared/audio/audio-shell\";\n\n\tvar CCL_ASR_ENABLED = 'ccl!\"school.asr.enabled\"';\n\n\t/**\n\t * Shuffle origin json data\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length() - 1);\n\n\t\tme.items().instantFeedback(true);\n\n\t\treturn me.html(tTemplate, me._json).then(function () {\n\t\t\tonRendered.call(me);\n\t\t});\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\tphrases = me._json.content.phrases[me.index()],\n\t\t\ttext = phrases.text,\n\t\t\ttranslation = phrases.translation;\n\n\t\tme._firstTimePlay = true;\n\t\tme._firstTimeRecord = true;\n\t\tme._playMediaElement = \"\";\n\t\tme._recordMediaElement = \"\";\n\t\tme._asrState = 'NORMAL';\n\t\t//Remove English translation if viewing site in English\n\t\tif (text.replace(/\\’/g, \"'\") === translation.replace(/\\’/g, \"'\")) {\n\t\t\t$el.find(SEL_LNC_PLAY_TRANSLATION).hide();\n\t\t}\n\n\t\t$el.find(SEL_BTN_SKIP).click(function () {\n\t\t\tif ($(this).hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlogActEvent.call(me, \"skip\");\n\t\t\tif (me.index() + 1 !== me.length()) {\n\t\t\t\tme.publishSkipInteraction(me.index())\n\t\t\t\t\t.then(function(){\n\t\t\t\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\t\t\t\tme.nextStep();\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (me.index() != 0) {\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_AWAY);\n\t\t}\n\t\trenderQuestionNumber.call(me);\n\t\tif (me.asrDisabled || window.location.search.indexOf(\"non-asr\") > 0) {\n\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_DISABLED);\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_NONE);\n\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\tme.index(me.length() - 1);\n\t\t\tme.completed(true);\n\t\t\tme.publish(\"asr/disable\");\n\t\t} else {\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).removeClass(CLS_NONE);\n\t\t\t//set ASR recording data\n\t\t\tme.publish(HUB_ASR_SET, onASRRecognized.bind(me), me._json.content.phrases[me.index()], {\n\t\t\t\tasrFallbackType: Widget.ASR_FALLBACK_TYPE.NEXT,\n\t\t\t\tasrFallbackCb: function () {\n\t\t\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_DISABLED);\n\t\t\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\t\t\tme.index(me.length() - 1);\n\t\t\t\t\tme.completed(true);\n\t\t\t\t},\n\t\t\t\tneedResetASRFailedTimes: true\n\t\t\t});\n\t\t}\n\t}\n\n\t//Question number\n\tfunction renderQuestionNumber() {\n\t\tvar me = this,\n\t\t\t$el = me.$element;\n\t\t$el.find(SEL_LNC_NUMBER_CURRENT).text(me.index() + 1);\n\t\t$el.find(SEL_LNC_NUMBER_TOTAL).text(me.length() - 1);\n\t}\n\n\t//ASR recognize success\n\tfunction onASRRecognized(asrResult, guid) {\n\t\tif (asrResult._hasError) return;\n\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\trecordMsg = \"\",\n\t\t\t$skipButton = $el.find(SEL_BTN_SKIP),\n\t\t\t$recordContent = $el.find(SEL_LNC_RECORD_CONTENT),\n\t\t\t$msgContainer = $el.find(SEL_LNC_RECORD_MSG_CONTAINER),\n\t\t\t$msgTips = $el.find(SEL_LNC_RECORD_TIP),\n\t\t\tphraseIndex = me.index();\n\n\t\tvar phraseResult = asrResult[0];\n\n\t\tvar correct = this.checkAnswer(phraseIndex, phraseResult);\n\n\t\tvar words = phraseResult.words;\n\t\tif (!words) return;\n\n\t\tfor (var wordIndex = 0; wordIndex < words.length; wordIndex++) {\n\t\t\tvar wordCorrect = Scoring.isWordCorrect(words[wordIndex]);\n\t\t\trecordMsg += \"<span class='\" + (wordCorrect ? '' : CLS_WRONG) + \"'>\" + words[wordIndex].word + \"</span>\";\n\t\t}\n\n\t\t$el.find(SEL_LNC_RECORD_MSG_CONTENT).html(recordMsg);\n\n\t\t$msgTips.addClass(CLS_AWAY);\n\n\t\tif (correct) {\n\t\t\t//passed\n\t\t\t$skipButton.addClass(CLS_DISABLED);\n\t\t\t$recordContent.removeClass(CLS_WRONG).addClass(CLS_CORRECT);\n\t\t\t$el.find(SEL_LNC_RECORD_MSG_TTITLE_CONTENT_CORRECT).removeClass(CLS_NONE);\n\t\t\t$el.find(SEL_LNC_RECORD_MSG_TTITLE_CONTENT_WRONG).addClass(CLS_NONE);\n\t\t} else {\n\t\t\t//failed\n\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t$recordContent.addClass(CLS_WRONG).removeClass(CLS_CORRECT);\n\t\t\t$el.find(SEL_LNC_RECORD_MSG_TTITLE_CONTENT_WRONG).removeClass(CLS_NONE);\n\t\t\t$el.find(SEL_LNC_RECORD_MSG_TTITLE_CONTENT_CORRECT).addClass(CLS_NONE);\n\t\t}\n\t\trecord.call(me, guid);\n\t\t$msgContainer.removeClass(CLS_AWAY);\n\n\t\tlogActEvent.call(me, \"passOrFail\");\n\t}\n\n\t//record player init when first time and reset record src\n\tfunction record(guid) {\n\t\tvar me = this, $record = me.$element.find(SEL_LNC_RECORD);\n\n\t\t$record\n\t\t\t.unweave()\n\t\t\t.then(function () {\n\t\t\t\treturn $record\n\t\t\t\t\t.data(\"option\", {\n\t\t\t\t\t\t\"_playHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"_pauseHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"guid\": guid\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"data-weave\", WIDGET_PATH_AUDIO_SHELL + \"(option)\")\n\t\t\t\t\t.weave();\n\t\t\t});\n\t}\n\n\t//Come to last question\n\tfunction comeToLast() {\n\t\tvar me = this;\n\t\tvar totalLength = me.length() - 1;//since there is a fake summary page there,so here need to subtract 1\n\t\tvar passNum = me._answersCorrectness.reduce(function (count, correct) {\n\t\t\treturn correct ? count + 1 : count;\n\t\t}, 0);\n\t\tvar failNum = totalLength - passNum;\n\t\tvar passNeedNum = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * totalLength);\n\t\tvar isPassed = passNum >= passNeedNum;\n\n\t\tviewSummary.call(me, isPassed, passNum, failNum, passNeedNum);\n\n\t\tme._json.content._isCorrect = isPassed;\n\t\treturn completeItem.call(me, true);\n\t}\n\n\t//setup summary page,including isPassed?\n\t//pass number, fail number ,and how many correct answers will be pass\n\tfunction viewSummary(passed, correctNum, skippedNum, passNum) {\n\t\tvar me = this,\n\t\t\t$el = me.$element;\n\n\t\tme.$element.find(SEL_LNC_MAIN).fadeOut(300, function () {\n\t\t\t//Render activity summary widget\n\t\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t\t.data(\"settings\",\n\t\t\t\t{\n\t\t\t\t\tpassed: passed,\n\t\t\t\t\tcorrectNum: correctNum,\n\t\t\t\t\tskippedNum: skippedNum,\n\t\t\t\t\tpassNum: passNum\n\t\t\t\t})\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t\t.weave();\n\t\t});\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\t}\n\n\t//item complete status change\n\tfunction completeItem(status) {\n\t\tvar me = this;\n\t\tvar itemIndex = me.index();\n\t\tvar answeredPromise = me.items(itemIndex).answeredPromise(status);\n\t\tvar completedPromise = me.items(itemIndex).completedPromise(status);\n\t\treturn when.all([answeredPromise, completedPromise]);\n\t}\n\n\tfunction logActEvent(eventAttr) {\n\t\tvar me = this;\n\t\tvar phraseIndex = me.index();\n\t\tvar phrase = me._json.content.phrases[phraseIndex];\n\t\tvar isCurrentQuestionPassed = Boolean(me._answersCorrectness[phraseIndex]);\n\t\tif (IS_QUESTION_PASSED[phraseIndex]) {\n\t\t\tif (eventAttr === \"passOrFail\") {\n\t\t\t\teventAttr = isCurrentQuestionPassed ? \"pass\" : \"fail\";\n\t\t\t}\n\t\t\tupdateHelper.logActEvent({\n\t\t\t\t\"activityId\": parser.parseId(me[ACT_TEMPLATE_ID] || me[ACT_ID]),\n\t\t\t\t\"eventDescr\": phrase[PROP_ID] + MAP_ABTEST_EVENTATTR[eventAttr],\n\t\t\t\t\"eventTypeId\": MAP_ABTEST_EVENTTYPE[me.feedbackVersion]\n\t\t\t});\n\t\t}\n\t\tif (isCurrentQuestionPassed) {\n\t\t\tIS_QUESTION_PASSED[phraseIndex] = isCurrentQuestionPassed;\n\t\t}\n\t}\n\n\tvar extendOptions = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this,\n\t\t\t\titemsLength = me._json.content.phrases.length;\n\t\t\tme.scoringType(Widget.SCORING_TYPE.ASR);\n\n\t\t\t/*\n\t\t\t *since there is a summary page there, and deal with it as a item like other question\n\t\t\t *so fake a item here.\n\t\t\t */\n\t\t\tme.length(itemsLength + 1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tif (this.index() >= this.length() - 1) return;\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tif (me._summaryTimer > 0) {\n\t\t\t\twindow.clearTimeout(me._summaryTimer);\n\t\t\t}\n\t\t},\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\tme.query(CCL_ASR_ENABLED).spread(function (asrEnabledCcl) {\n\t\t\t\tme.asrDisabled = !(asrEnabledCcl && asrEnabledCcl.value === 'true');\n\n\t\t\t\tIS_QUESTION_PASSED = [];\n\t\t\t});\n\t\t},\n\t\tcheckAnswer: function (phraseIndex, phraseResult) {\n\t\t\tvar me = this;\n\t\t\tvar correct = Scoring.isPhraseCorrect(phraseResult);\n\n\t\t\tme._answersCorrectness[phraseIndex] = correct;\n\n\t\t\tthis.publishInteraction(Interaction.makeAsrInteraction(correct, phraseResult._id))\n\t\t\t\t.then(function () {\n\t\t\t\t\tcompleteItem.call(me, correct);\n\t\t\t\t});\n\n\t\t\treturn correct;\n\t\t},\n\t\tpublishSkipInteraction: function (phraseIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.phrases[phraseIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\treturn me.publishInteraction(interaction)\n\t\t\t\t.then(function () {\n\t\t\t\t\tcompleteItem.call(me, true);\n\t\t\t\t});\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tvar index = this.index(),\n\t\t\t\tme = this;\n\n\t\t\tme.publish(HUB_ASR_DISABLE);\n\n\t\t\tif (index > me.length() - 2) {\n\t\t\t\treturn when.resolve();\n\t\t\t} else if (index === me.length() - 2) {\n\t\t\t\treturn me.indexPromise(index + 1)\n\t\t\t\t\t.then(comeToLast.bind(me));\n\t\t\t} else {\n\t\t\t\treturn me.indexPromise(index + 1)\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\treturn me.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t})\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\treturn me.signal('render');\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tif (!state) return;\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$skipButton = $el.find(SEL_BTN_SKIP);\n\n\t\t\tme._asrState = state;\n\n\t\t\tfunction layoutBack() {\n\t\t\t\t$el.find(SEL_LNC_RECORD_MSG_CONTAINER).addClass(CLS_AWAY);\n\t\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t}\n\n\t\t\t// asr status\n\t\t\tswitch (state) {\n\t\t\t\tcase ASRUIStatus.NORMAL:\n\t\t\t\t\tif (me._firstTimePlay === false) {\n\t\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).removeClass(CLS_AWAY);\n\t\t\t\t\t}\n\t\t\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.RECORDING:\n\t\t\t\tcase ASRUIStatus.PROCESSING:\n\t\t\t\t\t$skipButton.addClass(CLS_DISABLED);\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.PREPARING:\n\t\t\t\t\tme.items(me.index()).answered(false);\n\t\t\t\t\t$skipButton.addClass(CLS_DISABLED);\n\n\t\t\t\t\tif (me._firstTimeRecord) {\n\t\t\t\t\t\tme._firstTimeRecord = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_MSG_CONTAINER).addClass(CLS_AWAY);\n\n\t\t\t\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.BROKEN:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tlogActEvent.call(me, \"broken\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.WARNING:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tlogActEvent.call(me, \"warning\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.HINT:\n\t\t\t\tcase ASRUIStatus.ERROR:\n\t\t\t\tcase ASRUIStatus.DOWN:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.DISABLE:\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t\"hub/rating/sourceType\": function () {\n\t\t\treturn [ratingSourceType[\"ASR_SPEAKING\"]];\n\t\t},\n\t\t\"dom:.ets-ap/media/play\": function () {\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element;\n\n\t\t\t// stop playback when play audio\n\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\n\t\t\tif (me._firstTimePlay) {\n\t\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_AWAY);\n\t\t\t\tif (me._asrState === \"NORMAL\" && me._firstTimeRecord) {\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).removeClass(CLS_AWAY);\n\t\t\t\t}\n\t\t\t\tme._firstTimePlay = false;\n\t\t\t}\n\t\t}\n\t};\n\n\treturn Widget.extend(function ($element) {\n\t\tthis._playMediaElement;\n\t\tthis._recordMediaElement;\n\t\tthis._firstTimePlay;\n\t\tthis._firstTimeRecord;\n\t\tthis._asrState;\n\t\tthis.asrDisabled = false;\n\t\tthis.feedbackVersion = $element.data(\"option\").abtestVersion;\n\t\tthis._answersCorrectness = [];\n\t}, extendOptions);\n});\n\n",
    "define('school-ui-activity/activity/language-comparison/v2',[\n\t\"jquery\",\n\t\"poly\",\n\t\"when\",\n\t\"school-ui-activity/activity/base/main\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./language-comparison.html\",\n\t\"school-ui-shared/enum/rating-source-type\",\n\t\"school-ui-activity/shared/asr/asr-service-message-type\",\n\t\"school-ui-activity/shared/asr/asr-ui-states\",\n\t\"school-ui-shared/utils/update-helper\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"school-ui-shared/enum/activity-event-type\"\n], function MultipleChoiceModule(\n\t$,\n\tpoly,\n\twhen,\n\tWidget,\n\tScoring,\n\tInteraction,\n\ttTemplate,\n\tratingSourceType,\n\tMSGType,\n\tASRUIStatus,\n\tupdateHelper,\n\tparser,\n\tactivityEventType\n) {\n\t\"use strict\";\n\n\t// declare variables\n\tvar CLS_NONE = \"ets-none\",\n\t\tCLS_WRONG = 'ets-wrong',\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_AWAY = \"ets-away\",\n\t\tCLS_NEW_CORRECT = \"ets-act-lnc-new-correct\",\n\t\tCLS_NEW_INCORRECT = \"ets-act-lnc-new-incorrect\";\n\n\tvar SEL_BTN_SKIP = \".ets-act-lnc-skip\",\n\t\tSEL_AUDIO = \".ets-ap\",\n\t\tSEL_LNC_RECORD = \".ets-ap-lnc-record\",\n\t\tSEL_LNC_PLAY_TIP = \".ets-act-lnc-play-tip\",\n\t\tSEL_LNC_RECORD_TIP = \".ets-act-lnc-record-tip\",\n\t\tSEL_LNC_RECORD_CONTENT = \".ets-act-lnc-record-content\",\n\t\tSEL_LNC_RECORD_MSG_CONTAINER = \".ets-act-lnc-record-msg-container\",\n\t\tSEL_LNC_RECORD_MSG_CONTENT = \".ets-act-lnc-record-msg-content\",\n\n\t\tSEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\",\n\n\t\tSEL_LNC_NUMBER_CURRENT = '.ets-act-lnc-number-current',\n\t\tSEL_LNC_NUMBER_TOTAL = '.ets-act-lnc-number-total',\n\t\tSEL_LNC_MAIN = \".ets-act-lnc-main\",\n\t\tSEL_LNC_PLAY_TRANSLATION = \".ets-act-lnc-play-translation\";\n\n\tvar IS_CORRECT = \"_isCorrect\",\n\t\tIS_QUESTION_PASSED,\n\t\tPROP_ID = \"_id\";\n\n\tvar ACT_ID = \"act_id\",\n\t\tACT_TEMPLATE_ID = \"act_template_id\";\n\n\tvar MAP_ABTEST_EVENTTYPE = {\n\t\t\"V1\": activityEventType[\"lngCompRetryTimesV1\"],\n\t\t\"V2\": activityEventType[\"lngCompRetryTimesV2\"]\n\t};\n\n\tvar MAP_ABTEST_EVENTATTR = {\n\t\t\"pass\": \"|pass\",\n\t\t\"fail\": \"|fail\",\n\t\t\"skip\": \"|skip\",\n\t\t\"warning\": \"|warning\",\n\t\t\"broken\": \"|broken\"\n\t};\n\n\tvar HUB_ASR_SET = \"asr/ui/setting\",\n\t\tHUB_ASR_DISABLE = \"asr/disable\",\n\t\tHUB_ASR_STOP_PLAYBACK = \"asr/stopPlayback\",\n\t\tHUB_ASR_PLAYBACK = \"asr/startPlayback\",\n\t\tHUB_REMOVE_INTRO_TITLE = \"dispose/reference\";\n\n\tvar WIDGET_PATH_AUDIO_SHELL = \"school-ui-activity/shared/audio/audio-shell\";\n\n\tvar CCL_ASR_ENABLED = 'ccl!\"school.asr.enabled\"';\n\n\t/**\n\t * Shuffle origin json data\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length() - 1);\n\n\t\tme.items().instantFeedback(true);\n\n\t\treturn me.html(tTemplate, me._json).then(function () {\n\t\t\tonRendered.call(me);\n\t\t});\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\tphrases = me._json.content.phrases[me.index()],\n\t\t\ttext = phrases.text,\n\t\t\ttranslation = phrases.translation;\n\n\t\tme._firstTimePlay = true;\n\t\tme._firstTimeRecord = true;\n\t\tme._playMediaElement = \"\";\n\t\tme._recordMediaElement = \"\";\n\t\tme._asrState = 'NORMAL';\n\t\t//Remove English translation if viewing site in English\n\t\tif (text.replace(/\\’/g, \"'\") === translation.replace(/\\’/g, \"'\")) {\n\t\t\t$el.find(SEL_LNC_PLAY_TRANSLATION).hide();\n\t\t}\n\n\t\t$el.find(SEL_BTN_SKIP).click(function () {\n\t\t\tif ($(this).hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlogActEvent.call(me, \"skip\");\n\t\t\tif (me.index() + 1 !== me.length()) {\n\t\t\t\tme.publishSkipInteraction(me.index())\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\t\t\t\tme.nextStep();\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tif (me.index() != 0) {\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_AWAY);\n\t\t}\n\t\trenderQuestionNumber.call(me);\n\t\tif (me.asrDisabled || window.location.search.indexOf(\"non-asr\") > 0) {\n\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_DISABLED);\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_NONE);\n\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\tme.index(me.length() - 1);\n\t\t\tme.completed(true);\n\t\t\tme.publish(\"asr/disable\");\n\t\t} else {\n\t\t\t$el.find(SEL_LNC_PLAY_TIP).removeClass(CLS_NONE);\n\t\t\t//set ASR recording data\n\t\t\tme.publish(HUB_ASR_SET, onASRRecognized.bind(me), me._json.content.phrases[me.index()], {\n\t\t\t\tasrFallbackType: Widget.ASR_FALLBACK_TYPE.NEXT,\n\t\t\t\tasrFallbackCb: function () {\n\t\t\t\t\t$el.find(SEL_BTN_SKIP).addClass(CLS_DISABLED);\n\t\t\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\t\t\tme.index(me.length() - 1);\n\t\t\t\t\tme.completed(true);\n\t\t\t\t},\n\t\t\t\tneedResetASRFailedTimes: true\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction showASRMessage(msgType) {\n\t\tthis.publish(\"asr/show/message\", MSGType[msgType]);\n\t}\n\n\t//Question number\n\tfunction renderQuestionNumber() {\n\t\tvar me = this,\n\t\t\t$el = me.$element;\n\t\t$el.find(SEL_LNC_NUMBER_CURRENT).text(me.index() + 1);\n\t\t$el.find(SEL_LNC_NUMBER_TOTAL).text(me.length() - 1);\n\t}\n\n\t//ASR recognize success\n\tfunction onASRRecognized(asrResult, guid) {\n\t\tif (asrResult._hasError) return;\n\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\trecordMsg = \"\",\n\t\t\t$skipButton = $el.find(SEL_BTN_SKIP),\n\t\t\t$recordContent = $el.find(SEL_LNC_RECORD_CONTENT),\n\t\t\t$msgTips = $el.find(SEL_LNC_RECORD_TIP),\n\t\t\tphraseIndex = me.index();\n\n\t\tvar phraseResult = asrResult[0];\n\n\t\tvar correct = this.checkAnswer(phraseIndex, phraseResult);\n\n\t\tvar words = phraseResult.words;\n\t\tif (!words) return;\n\n\t\tfor (var wordIndex = 0; wordIndex < words.length; wordIndex++) {\n\t\t\tvar wordCorrect = Scoring.isWordCorrect(words[wordIndex]);\n\t\t\trecordMsg += \"<span class='\" + (wordCorrect ? '' : CLS_WRONG) + \"'>\" + words[wordIndex].word + \"</span>\";\n\t\t}\n\n\t\t$el.find(SEL_LNC_RECORD_MSG_CONTENT).html(recordMsg);\n\t\t$msgTips.addClass(CLS_AWAY);\n\n\t\t$skipButton.toggleClass(CLS_DISABLED, correct);\n\t\t$recordContent.toggleClass(CLS_NEW_CORRECT, correct);\n\t\t$recordContent.toggleClass(CLS_NEW_INCORRECT, !correct);\n\t\tif (!correct && asrResult && !asrResult._hasError) {\n\t\t\t//if the asr result got a score\n\t\t\tshowASRMessage.call(me, \"INCORRECT_PRONUN\");\n\t\t}\n\t\trecord.call(me, guid);\n\n\t\tlogActEvent.call(me, \"passOrFail\");\n\t}\n\n\t//record player init when first time and reset record src\n\tfunction record(guid) {\n\t\tvar me = this, $record = me.$element.find(SEL_LNC_RECORD);\n\n\t\t$record\n\t\t\t.unweave()\n\t\t\t.then(function () {\n\t\t\t\treturn $record\n\t\t\t\t\t.data(\"option\", {\n\t\t\t\t\t\t\"_playHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"_pauseHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"guid\": guid\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"data-weave\", WIDGET_PATH_AUDIO_SHELL + \"(option)\")\n\t\t\t\t\t.weave();\n\t\t\t});\n\t}\n\n\t//Come to last question\n\tfunction comeToLast() {\n\t\tvar me = this;\n\t\tvar totalLength = me.length() - 1;//since there is a fake summary page there,so here need to subtract 1\n\t\tvar passNum = me._answersCorrectness.reduce(function (count, correct) {\n\t\t\treturn correct ? count + 1 : count;\n\t\t}, 0);\n\t\tvar failNum = totalLength - passNum;\n\t\tvar passNeedNum = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * totalLength);\n\t\tvar isPassed = passNum >= passNeedNum;\n\n\t\tviewSummary.call(me, isPassed, passNum, failNum, passNeedNum);\n\n\t\tme._json.content._isCorrect = isPassed;\n\t\treturn me.items().completedPromise(true);\n\t}\n\n\t//setup summary page,including isPassed?\n\t//pass number, fail number ,and how many correct answers will be pass\n\tfunction viewSummary(passed, correctNum, skippedNum, passNum) {\n\t\tvar me = this,\n\t\t\t$el = me.$element;\n\n\t\tme.$element.find(SEL_LNC_MAIN).fadeOut(300, function () {\n\t\t\t//Render activity summary widget\n\t\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t\t.data(\"settings\",\n\t\t\t\t{\n\t\t\t\t\tpassed: passed,\n\t\t\t\t\tcorrectNum: correctNum,\n\t\t\t\t\tskippedNum: skippedNum,\n\t\t\t\t\tpassNum: passNum\n\t\t\t\t})\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t\t.weave();\n\t\t});\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\t}\n\n\t//item complete status change\n\tfunction completeItem(status) {\n\t\tvar me = this;\n\t\tvar answeredPromise = me.items(me.index()).answeredPromise(status);\n\t\tvar completedPromise = me.items(me.index()).completedPromise(status);\n\t\treturn when.all([answeredPromise, completedPromise]);\n\t}\n\n\tfunction logActEvent(eventAttr) {\n\t\tvar me = this;\n\t\tvar phraseIndex = me.index();\n\t\tvar phrase = me._json.content.phrases[phraseIndex];\n\t\tvar isCurrentQuestionPassed = Boolean(me._answersCorrectness[phraseIndex]);\n\t\tif (IS_QUESTION_PASSED[phraseIndex]) {\n\t\t\tif (eventAttr === \"passOrFail\") {\n\t\t\t\teventAttr = isCurrentQuestionPassed ? \"pass\" : \"fail\";\n\t\t\t}\n\t\t\tupdateHelper.logActEvent({\n\t\t\t\t\"activityId\": parser.parseId(me[ACT_TEMPLATE_ID] || me[ACT_ID]),\n\t\t\t\t\"eventDescr\": phrase[PROP_ID] + MAP_ABTEST_EVENTATTR[eventAttr],\n\t\t\t\t\"eventTypeId\": MAP_ABTEST_EVENTTYPE[me.feedbackVersion]\n\t\t\t});\n\t\t}\n\t\tif (isCurrentQuestionPassed) {\n\t\t\tIS_QUESTION_PASSED[phraseIndex] = isCurrentQuestionPassed;\n\t\t}\n\t}\n\n\tvar extendOptions = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this,\n\t\t\t\titemsLength = me._json.content.phrases.length;\n\t\t\tme.scoringType(Widget.SCORING_TYPE.ASR);\n\n\t\t\t/*\n\t\t\t *since there is a summary page there, and deal with it as a item like other question\n\t\t\t *so fake a item here.\n\t\t\t */\n\t\t\tme.length(itemsLength + 1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tif (this.index() >= this.length() - 1) return;\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tif (me._summaryTimer > 0) {\n\t\t\t\twindow.clearTimeout(me._summaryTimer);\n\t\t\t}\n\t\t},\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\tme.query(CCL_ASR_ENABLED).spread(function (asrEnabledCcl) {\n\t\t\t\tme.asrDisabled = !(asrEnabledCcl && asrEnabledCcl.value === 'true');\n\n\t\t\t\tIS_QUESTION_PASSED = [];\n\t\t\t});\n\t\t},\n\t\tcheckAnswer: function (phraseIndex, phraseResult) {\n\t\t\tvar me = this;\n\t\t\tvar correct = Scoring.isPhraseCorrect(phraseResult);\n\n\t\t\tme._answersCorrectness[phraseIndex] = correct;\n\n\t\t\tthis.publishInteraction(Interaction.makeAsrInteraction(correct, phraseResult._id))\n\t\t\t\t.then(function () {\n\t\t\t\t\tcompleteItem.call(me, correct);\n\t\t\t\t});\n\n\t\t\treturn correct;\n\t\t},\n\t\tpublishSkipInteraction: function (phraseIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.phrases[phraseIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\treturn me.publishInteraction(interaction)\n\t\t\t\t.then(function () {\n\t\t\t\t\tcompleteItem.call(me, true);\n\t\t\t\t});\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tvar index = this.index(),\n\t\t\t\tme = this;\n\n\t\t\tme.publish(HUB_ASR_DISABLE);\n\n\t\t\tif (index > me.length() - 2) {\n\t\t\t\treturn when.resolve();\n\t\t\t} else if (index === me.length() - 2) {\n\t\t\t\treturn me.indexPromise(index + 1)\n\t\t\t\t\t.then(completeItem.bind(me, true))\n\t\t\t\t\t.then(comeToLast.bind(me, \"comeFromClick\"));\n\t\t\t} else {\n\t\t\t\treturn me.indexPromise(index + 1)\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\treturn me.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t})\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\treturn me.signal('render');\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tif (!state) return;\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$skipButton = $el.find(SEL_BTN_SKIP),\n\t\t\t\t$recordContent = $el.find(SEL_LNC_RECORD_CONTENT);\n\n\t\t\tme._asrState = state;\n\n\t\t\tfunction layoutBack() {\n\t\t\t\t$el.find(SEL_LNC_RECORD_MSG_CONTAINER).addClass(CLS_AWAY);\n\t\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t}\n\n\t\t\t// asr status\n\t\t\tswitch (state) {\n\t\t\t\tcase ASRUIStatus.NORMAL:\n\t\t\t\t\tif (me._firstTimePlay === false) {\n\t\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).removeClass(CLS_AWAY);\n\t\t\t\t\t}\n\t\t\t\t\t$skipButton.removeClass(CLS_DISABLED);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.RECORDING:\n\t\t\t\tcase ASRUIStatus.PROCESSING:\n\t\t\t\t\t$skipButton.addClass(CLS_DISABLED);\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\t$recordContent.removeClass(CLS_NEW_CORRECT).removeClass(CLS_NEW_INCORRECT);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.PREPARING:\n\t\t\t\t\tme.items(me.index()).answered(false);\n\t\t\t\t\t$skipButton.addClass(CLS_DISABLED);\n\n\t\t\t\t\tif (me._firstTimeRecord) {\n\t\t\t\t\t\tme._firstTimeRecord = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_MSG_CONTAINER).addClass(CLS_AWAY);\n\n\t\t\t\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\n\t\t\t\t\t$recordContent.removeClass(CLS_NEW_CORRECT).removeClass(CLS_NEW_INCORRECT);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.BROKEN:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tlogActEvent.call(me, \"broken\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.WARNING:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tlogActEvent.call(me, \"warning\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.HINT:\n\t\t\t\tcase ASRUIStatus.ERROR:\n\t\t\t\tcase ASRUIStatus.DOWN:\n\t\t\t\t\tlayoutBack();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ASRUIStatus.DISABLE:\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).addClass(CLS_AWAY);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t\"hub/rating/sourceType\": function () {\n\t\t\treturn [ratingSourceType[\"ASR_SPEAKING\"]];\n\t\t},\n\t\t\"dom:.ets-ap/media/play\": function () {\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element;\n\n\t\t\t// stop playback when play audio\n\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\n\t\t\tif (me._firstTimePlay) {\n\t\t\t\t$el.find(SEL_LNC_PLAY_TIP).addClass(CLS_AWAY);\n\t\t\t\tif (me._asrState === \"NORMAL\" && me._firstTimeRecord) {\n\t\t\t\t\t$el.find(SEL_LNC_RECORD_TIP).removeClass(CLS_AWAY);\n\t\t\t\t}\n\t\t\t\tme._firstTimePlay = false;\n\t\t\t}\n\t\t}\n\t};\n\n\treturn Widget.extend(function ($element) {\n\t\tthis._playMediaElement;\n\t\tthis._recordMediaElement;\n\t\tthis._firstTimePlay;\n\t\tthis._firstTimeRecord;\n\t\tthis._asrState;\n\t\tthis.asrDisabled = false;\n\t\tthis.feedbackVersion = $element.data(\"option\").abtestVersion;\n\t\tthis._answersCorrectness = [];\n\t}, extendOptions);\n});\n\n",
    "define('school-ui-activity/util/content-converter',[], function () {\n\t'use strict';\n\n\tfunction timeStrToSeconds(strTime) {\n\t\t/*\n\t\t acceptable format:\n\t\t hh:mm:ss.nnn\n\t\t mm:ss.nnn\n\t\t ss.nnn\n\t\t */\n\t\tvar times = strTime.split(/[:.]/);\n\t\tvar MAX_PARTS = 4;\n\t\tfor (var i = 0, missingParts = MAX_PARTS - times.length; i < missingParts; i++) {\n\t\t\ttimes.unshift(0);\n\t\t}\n\n\t\tvar strHours = times[0];\n\t\tvar strMinutes = times[1];\n\t\tvar strSeconds = times[2];\n\t\tvar strMilliSeconds = times[3];\n\n\t\tvar MILLISECONDS_DIGITS = 3;\n\t\tstrMilliSeconds = strMilliSeconds + '000';\n\t\tstrMilliSeconds = strMilliSeconds.substr(0, MILLISECONDS_DIGITS);\n\n\t\tvar SECONDS_PER_HOUR = 3600;\n\t\tvar SECONDS_PER_MINUTE = 60;\n\t\tvar MILLISECONDS_PER_SECOND = 1000;\n\t\treturn parseInt(strHours, 10) * SECONDS_PER_HOUR +\n\t\t\tparseInt(strMinutes, 10) * SECONDS_PER_MINUTE +\n\t\t\tparseInt(strSeconds, 10) +\n\t\t\tparseInt(strMilliSeconds, 10) / MILLISECONDS_PER_SECOND;\n\t}\n\n\treturn {\n\t\ttimeStrToSeconds: timeStrToSeconds,\n\n\t\tscriptsToSubtitles: function (scripts) {\n\t\t\treturn scripts.map(function (item) {\n\t\t\t\treturn {\n\t\t\t\t\ttext: item.txt,\n\t\t\t\t\tstart: timeStrToSeconds(item.startTime),\n\t\t\t\t\tend: timeStrToSeconds(item.endTime)\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\n\t\tquestionsToEndTimes: function (questions) {\n\t\t\treturn questions.map(function (item) {\n\t\t\t\treturn timeStrToSeconds(item.timeline || item.endTime);\n\t\t\t});\n\t\t},\n\n\t\tquestionsToTimeRanges: function (questions) {\n\t\t\treturn questions.map(function (item) {\n\t\t\t\treturn [\n\t\t\t\t\ttimeStrToSeconds(item.startTime),\n\t\t\t\t\ttimeStrToSeconds(item.endTime)\n\t\t\t\t];\n\t\t\t});\n\t\t}\n\t}\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/language-presentation-new.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\t\n\tvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n\\n<div class=\\\"ets-act-lpn\\\">\\n\\t<div class=\\\"ets-act-lpn-bd\\\">\\n\\t\\t<div class=\\\"ets-act-lpn-view-wrap\\\">\\n\\t\\t\\t<div class=\\\"ets-act-lpn-view\\\" id=\\\"ets-act-lpn-view\\\">\\n\\t\\t\\t\\t\";\n\t\t\t\t\tif (data.content.title) {\n\t\t\t\to += \"\\n\\t\\t\\t\\t<div class=\\\"ets-act-lpn-section\\\" data-section=\\\"1\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-lpn-start\\\">\\n\\t\\t\\t\\t\\t\\t\\t<h2>\" +data.content.title+ \"</h2>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\";}o += \"\\n\\n\\t\\t\\t\\t\";\n\t\t\t\t\tif (data.content.grammarVideo && data.content.grammarVideo.videoUrl) {\n\t\t\t\t\t\twriteGrammarVideo(data.content.grammarVideo, 1);\n\n\t\t\t\t\t\tfor (var i=0; i < data.content.presentations.length; i++ ) {\n\t\t\t\t\t\t\tvar n = i+2;\n\t\t\t\t\t\t\twriteSection(data.content.presentations[i], n);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (var i=0; i < data.content.presentations.length; i++ ) {\n\t\t\t\t\t\t\tvar n = i+1;\n\t\t\t\t\t\t\twriteSection(data.content.presentations[i], n);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\to += \"\\n\\t\\t\\t\\t\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t\\n\\t\\t<div class=\\\"ets-act-lpn-tabs\\\" id=\\\"ets-act-lpn-tabs\\\">\\n\\t\\t\\t<div class=\\\"ets-act-lpn-tabs-path\\\">\\n\\t\\t\\t\\t<span></span>\\n\\t\\t\\t</div>\\n\\t\\t\\t\";\tvar totalSections;\n\t\t\t\tif (data.content.grammarVideo && data.content.grammarVideo.videoUrl) {\n\t\t\t\t\ttotalSections = data.content.presentations.length + 1;\n\t\t\t\t} else {\n\t\t\t\t\ttotalSections = data.content.presentations.length;\n\t\t\t\t}\n\t\t\t o += \"\\n\\t\\t\\t<ul class=\\\"ets-total-\" +totalSections+ \"\\\">\\n\\t\\t\\t\\t\";\n\t\t\t\t\tfor (var i=0; i < totalSections; i++ ) {\n\t\t\t\t\t\tvar n = i + 1,\n\t\t\t\t\t\t\talphabets = [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\"],\n\t\t\t\t\t\t\ttxt = alphabets[i];\n\t\t\t\t\t\to += \"\\n\\t\\t\\t\\t\\t\\t<li data-section=\\\"\" +n+ \"\\\">\\n\\t\\t\\t\\t\\t\\t\\t<span>\\n\\t\\t\\t\\t\\t\\t\\t<!--[if lte IE 7]>\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-act-iefix-wrap\\\">\\n\\t\\t\\t\\t\\t\\t    <div class=\\\"ets-act-iefix-offset\\\">\\n\\t\\t\\t\\t\\t\\t        <div class=\\\"ets-act-iefix-inner\\\">\\n\\t\\t\\t\\t\\t\\t<![endif]-->\\n\\t\\t\\t\\t\\t\\t\\t\" +txt+ \"\\n\\t\\t\\t\\t\\t\\t\\t<!--[if lte IE 7]>\\n\\t\\t\\t\\t\\t\\t        </div>\\n\\t\\t\\t\\t\\t\\t    </div>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t<![endif]-->\\n\\t\\t\\t\\t\\t\\t\\t</span>\\n\\t\\t\\t\\t\\t\\t</li>\\n\\t\\t\\t\\t\\t\";}\n\t\t\t\to += \"\\n\\t\\t\\t</ul>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\\n\"; function writeGrammarVideo(section, n) { o += \"\\n\\t<div class=\\\"ets-act-lpn-section\\\" data-section=\\\"\" +n+ \"\\\">\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<div class=\\\"ets-act-lpn-grammar-video\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-vp-wrap\\\"><!--<div data-weave=\\\"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\\\"></div>--></div>\\n\\t\\t\\t\\t\";if (section.audioUrl && section.audioUrl.url) {o += \"\\n\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t       data-pause-other-players=\\\"false\\\"\\n\\t\\t\\t\\t       src=\\\"\" +section.audioUrl.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t       class=\\\"ets-ap ets-ap-nobar\\\"></audio>\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\"; } o += \"\\n\\n\"; function writeSection(section, n) { o += \"\\n\\t\\t<div class=\\\"ets-act-lpn-section\\\" data-section=\\\"\" +n+ \"\\\">\\n\\t\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-lpn-grammar\\\">\\n\\t\\t\\t\\t\\t\" +section.text+ \"\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/language-presentation-new/language-presentation-new',[\n\t'jquery',\n\t'jquery.ui',\n\t'poly',\n\t'troopjs-ef/component/widget',\n\t\"jquery.easing\",\n\t\"jquery.scrollto\",\n\t\"jquery.viewport\",\n\t'jquery.mousewheel',\n\t'markdownjs',\n\t\"mediaelement-plugin-ef\",\n\t\"school-ui-activity/util/content-converter\",\n\t'template!./language-presentation-new.html',\n\t\"school-ui-shared/utils/browser-check\",\n\t'mediaelement-and-player'\n], function ($,\n             ui$,\n             poly,\n             Widget,\n             easing,\n             scrollto,\n             viewport,\n             mousewheel,\n             md,\n             mejsPlugin,\n             converter,\n             tTemplate,\n\t\t\t browserCheck,\n\t\t\t mejs) {\n\t\"use strict\";\n\n\t// Constants\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_GRAMMAR_VIDEO_AP = \".ets-act-lpn-grammar-video .ets-ap\";\n\tvar SEL_VIEW = \"#ets-act-lpn-view\";\n\tvar SEL_SECTION = \".ets-act-lpn-section\";\n\tvar SEL_TAB = \"#ets-act-lpn-tabs > ul > li\";\n\tvar SEL_AUDIO = \".ets-ap\";\n\tvar SEL_LP_GRAMMAR = \".ets-act-lpn-grammar\";\n\tvar SEL_VIDEO_CONTAINER = \".ets-act-vp-wrap\";\n\n\tvar CLS_CURRENT = \"ets-current\";\n\tvar CLS_ACTIVE = \"ets-active\";\n\tvar CLS_PLAYING = \"ets-playing\";\n\tvar CLS_ARABIC_FIX = \"ets-ui-arabic-fix\";\n\n\tvar PROP_CULTURE_CODE = \"cultureCode\";\n\n\tfunction arabicFix(data) {\n\t\tdata.content.presentations.forEach(function (v) {\n\t\t\tvar $html = $(\"<div>\" + v.text + \"</div>\");\n\t\t\t$html.find(\"p,td,strong\").each(function () {\n\t\t\t\tvar $this = $(this);\n\t\t\t\tvar fixText = $this.text();\n\t\t\t\tArray.prototype.every.call(fixText, function (char) {\n\t\t\t\t\tif (char.charCodeAt(0) > 160) {\n\t\t\t\t\t\t$this.addClass(CLS_ARABIC_FIX);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t});\n\t\t\tv.text = $html.html();\n\t\t});\n\t}\n\n\t// # Render\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me._json || !me[PROP_CULTURE_CODE]) return;\n\n\t\tvar data = me._json;\n\n\t\tif (!data) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\tfilterData.call(me, data);\n\n\t\tif (/^ar/.test(me[PROP_CULTURE_CODE])) {\n\t\t\tarabicFix(data);\n\t\t}\n\n\t\treturn me\n\t\t\t.html(tTemplate, data)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction filterData(data) {\n\t\tfor (var i = 0; i < data.content.presentations.length; i++) {\n\t\t\tdata.content.presentations[i].text = data.content.presentations[i].text.replace(/(^\\s*)|(\\s*$)/g, \"\");\n\n\t\t\t//Parse markdown to html\n\t\t\tdata.content.presentations[i].text = md.toHTML(data.content.presentations[i].text);\n\t\t}\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * 1. Enable droppable\n\t * 2. Bind double click strip\n\t * 3. Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tif (me._json.content.grammarVideo && me._json.content.grammarVideo.videoUrl) {\n\t\t\tinitGrammerVideo.call(me);\n\t\t}\n\n\t\tinitScroll.call(me);\n\t\tinitMedia.call(me);\n\t}\n\n\tfunction scriptsToSubtitles(scripts) {\n\t\t// language-presentation-new scripts have a different format than other activities scripts\n\t\treturn scripts.map(function (item) {\n\t\t\treturn {\n\t\t\t\thtml: md.toHTML(item.text),\n\t\t\t\tstart: converter.timeStrToSeconds(item.StartTime),\n\t\t\t\tend: converter.timeStrToSeconds(item.EndTime)\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction initGrammerVideo() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tvar videoInfo = {\n\t\t\tvideo: me._json.content.grammarVideo.videoUrl\n\t\t};\n\n\t\tvar options = {\n\t\t\tfeatures: ['Subtitles', 'SwitchQuality'],\n\t\t\tsubtitles: scriptsToSubtitles(me._json.content.grammarVideo.scripts),\n\t\t\tshowToggleSubtitlesButton: false,\n\t\t\tpauseOtherPlayers:browserCheck.device!=='tablet'\n\t\t};\n\n\t\tvar $video = $el.find(SEL_VIDEO_CONTAINER);\n\n\t\t$video.data({\n\t\t\t'videoInfo': videoInfo,\n\t\t\t'options': options,\n\t\t\t'successCallback': onVideoPlayerReady.bind(me)\n\t\t})\n\t\t\t.attr('data-weave', 'school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)')\n\t\t\t.weave();\n\t}\n\n\tfunction onVideoPlayerReady(videoMediaElement, domObject, player) {\n\t\tvar me = this;\n\t\tvar $el = me.$element;\n\t\tvar isTablet = browserCheck.device === 'tablet';\n\t\tvar $videoParent = $(domObject).parents(\".ets-vp\");\n\n\t\tme.grammarVideoMediaElement = videoMediaElement;\n\n\t\tplayer.enableSubtitles();\n\n\t\t// try to fix tablet can not play audio issue , check detail for SPC-7914\n\t\tif(isTablet){\n\t\t\t$el.find('.mejs-overlay-button, .ets-act-lpn-grammar-video .mejs-play').on('click', function(){\n\t\t\t\tvar audioElement = $el.find('.ets-act-lpn-grammar-video audio')[0];\n\t\t\t\tif(!audioElement)return;\n\t\t\t\tif(audioElement.paused){\n\t\t\t\t\taudioElement.play();\n\t\t\t\t}else{\n\t\t\t\t\taudioElement.pause();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvideoMediaElement.addEventListener('pause', function () {\n\t\t\t$videoParent.removeClass(CLS_PLAYING);\n\t\t});\n\n\t\tvideoMediaElement.addEventListener('play', function () {\n\t\t\t$videoParent.addClass(CLS_PLAYING);\n\t\t});\n\n\t\tif (me._json.content.grammarVideo.audioUrl) {\n\t\t\tvideoMediaElement.addEventListener('pause', function () {\n\t\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/pause');\n\t\t\t});\n\n\t\t\tvideoMediaElement.addEventListener('playing', function () {\n\t\t\t\t// try to fix tablet can not play audio issue , check detail for SPC-7914\n\t\t\t\tif(isTablet){\n\t\t\t\t\tvar audioElement = $el.find('.ets-act-lpn-grammar-video audio')[0];\n\t\t\t\t\tObject.keys(mejs.players).forEach(function(key){\n\t\t\t\t\t\tvar mediaElement =   mejs.players[key].media;\n\t\t\t\t\t\tif(mediaElement !== videoMediaElement && mediaElement !== audioElement\n\t\t\t\t\t\t&& !mediaElement.paused && !mediaElement.ended ){\n\t\t\t\t\t\t\tmediaElement.pause();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}else{\n\t\t\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/play');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvideoMediaElement.addEventListener('ended', function () {\n\t\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/end');\n\t\t\t});\n\n\t\t\tvideoMediaElement.addEventListener('seeked', function () {\n\t\t\t\tvar currentTime = videoMediaElement.currentTime;\n\t\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/seek', currentTime);\n\t\t\t});\n\n\t\t\tvideoMediaElement.addEventListener('volumechange', function () {\n\t\t\t\tvar volume = videoMediaElement.volume;\n\t\t\t\tvar muted = videoMediaElement.muted;\n\t\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/volume', {\n\t\t\t\t\tvolume: volume,\n\t\t\t\t\tmuted: muted\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tvar initVolume = videoMediaElement.volume;\n\t\t\tvar initMuted = videoMediaElement.muted;\n\t\t\t$el.find(SEL_GRAMMAR_VIDEO_AP).trigger('player/volume', {\n\t\t\t\tvolume: initVolume,\n\t\t\t\tmuted: initMuted\n\t\t\t});\n\t\t}\n\t}\n\n\n\tfunction initMedia() {\n\t\tvar $el = this.$element;\n\n\t\t$el.find(SEL_LP_GRAMMAR).each(function (i, item) {\n\t\t\tvar $item = $(item);\n\t\t\tvar str = convertLegacyAudioTag($item.html());\n\t\t\tstr = replaceURLWithAudioTag(str);\n\t\t\tstr = replaceURLWithImageTag(str);\n\t\t\t$item.html(str);\n\n\t\t\t//Weave audio widget\n\t\t\t$item.find(\"[data-weave]\").weave();\n\t\t});\n\t}\n\n\tfunction replaceURLWithAudioTag(text) {\n\t\tvar expAudio = /((?:https?:)?\\/\\/.*?.(?:mp3|ogg|webm))/ig;\n\t\ttext = text.replace(expAudio, [\n\t\t\t'<div class=\"ets-act-ap-wrap\"><div data-at-id=\"btn-audio-start\" class=\"ets-act-ap ets-ap-smaller\">',\n\t\t\t'<audio data-weave=\"school-ui-shared/widget/audio-player/main\" preload=\"none\" data-src=\"$1\" type=\"audio/mpeg\" class=\"ets-ap ets-ap-smaller ets-ap-nobar\"></audio>',\n\t\t\t'</div></div>'\n\t\t].join(''));\n\t\treturn text;\n\t}\n\n\tfunction replaceURLWithImageTag(text) {\n\t\tvar expImage = /((?:https?:)?\\/\\/.*?.(?:jpg|png|gif|jpeg|bmp))/ig;\n\t\ttext = text.replace(expImage, \"<img src='$1' />\");\n\t\treturn text;\n\t}\n\n\tfunction convertLegacyAudioTag(html) {\n\t\tvar $temp = $(\"<div></div>\");\n\t\t$temp.html(html);\n\t\tvar audioPlaceholder = $temp.find(\".flashplaceholder\");\n\t\taudioPlaceholder.each(function () {\n\t\t\t$(this).removeAttr(\"name width height class id\");\n\t\t\t$(this).text().trim();\n\t\t});\n\n\t\treturn $temp.html();\n\t}\n\n\tfunction scrollToSection(activity) {\n\t\tvar me = activity,\n\t\t\t$el = me.$element;\n\t\tif ($(this).hasClass(CLS_ACTIVE)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar index = $(this).index();\n\n\t\tme._super.index(index);\n\n\t\tif (index >= $(this).siblings().length) {\n\t\t\tme._super.completed(true);\n\t\t} else {\n\t\t\tme._super.completed(false);\n\t\t}\n\t\t$(this).addClass(CLS_ACTIVE).siblings(SEL_TAB).removeClass(CLS_ACTIVE);\n\t\tvar currentSection = $(this).data(\"section\");\n\t\tvar $targetSection = $(SEL_SECTION).filter(function () {\n\t\t\treturn $(this).data(\"section\") == currentSection\n\t\t});\n\t\t$(SEL_VIEW).stop().scrollTo($targetSection, 300);\n\n\t\tif (me.grammarVideoMediaElement && me.grammarVideoMediaElement.played) {\n\t\t\tsetTimeout(function () {\n\t\t\t\tme.grammarVideoMediaElement.pause();\n\t\t\t}, 100);\n\t\t}\n\n\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\t}\n\n\tfunction initScroll() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_TAB).click(function () {\n\t\t\tscrollToSection.call(this, me);\n\t\t});\n\n\t\t//scroll to first tab\n\t\tscrollToSection.call($($el.find(SEL_TAB).get(0)), me);\n\n\t\t$el.find(SEL_VIEW).viewport({\n\t\t\ttargets: SEL_SECTION,\n\t\t\tonViewChange: function (elements/*, detail*/) {\n\t\t\t\t$.each(elements, function (i, element) {\n\t\t\t\t\tvar currentSection = $(element).data('section');\n\t\t\t\t\tvar $targetTab = $el.find(SEL_TAB).filter(function () {\n\t\t\t\t\t\treturn $(this).data(\"section\") == currentSection\n\t\t\t\t\t});\n\n\t\t\t\t\t$el.find(SEL_TAB).removeClass(CLS_ACTIVE);\n\t\t\t\t\t$targetTab.addClass(CLS_ACTIVE);\n\n\t\t\t\t\t$el.find(SEL_VIEW).removeClass(CLS_CURRENT);\n\t\t\t\t\t$(element).addClass(CLS_CURRENT);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t}\n\n\tvar methods = {\n\t\t\"hub/activity/template/lpn/load\": function (parent, options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\n\t\t\tme._super = parent;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(false);\n\n\t\t\treturn render.call(me);\n\t\t},\n\t\t\"hub/activity/template/lpn/next\": function (index) {\n\t\t\tscrollToSection.call($(this.$element.find(SEL_TAB).get(index)), this);\n\t\t},\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tvar me = this;\n\t\t\tcontext && context[PROP_CULTURE_CODE] && (me[PROP_CULTURE_CODE] = context[PROP_CULTURE_CODE]);\n\t\t\trender.call(me);\n\t\t}\n\t};\n\n\treturn Widget.extend(methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/language-presentation-new/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-lpn-wrap\\\" data-weave=\\\"school-ui-activity/activity/language-presentation-new/language-presentation-new\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/language-presentation-new/main',[\n\t'jquery',\n\t'underscore',\n\t'when',\n\t'../base/main',\n\t'./language-presentation-new',\n\t'template!./main.html'\n], function activityTemplateModule($, _, when, Widget, lpn, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_LPN_LOAD = \"activity/template/lpn/load\";\n\tvar TOPIC_ACT_LPN_NEXT = 'activity/template/lpn/next';\n\n\tfunction Ctor() {\n\t\tfilterData.call(this);\n\t}\n\n\tfunction filterData() {\n\t\tvar totalSections,\n\t\t\tme = this,\n\t\t\tdata = me._json;\n\t\tif (data.content.grammarVideo && data.content.grammarVideo.videoUrl) {\n\t\t\ttotalSections = data.content.presentations.length + 1;\n\t\t} else {\n\t\t\ttotalSections = data.content.presentations.length;\n\t\t}\n\t\tme.length(totalSections);\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_LPN_LOAD, me, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\treturn this.publish(TOPIC_ACT_LPN_NEXT, this.index() + 1);\n\t\t},\n\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/language-presentation/language-presentation.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-lan-pre\\\">\\n    <div class=\\\"ets-act-lan-title\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='450030' data-text-en='Language Focus'></div>\\n    <div class=\\\"ets-act-lnp-view\\\" id=\\\"ets-act-lnp-view\\\">\\n        <div class=\\\"ets-act-lnp-scroll\\\">\\n            <div class=\\\"ets-act-lnp-section ets-section-grammer\\\" data-section=\\\"1\\\">\\n                <!--[if lt IE 8]><div class=\\\"ets-bd\\\"><![endif]-->\\n                <!--[if IE 8]><div class=\\\"ets-bd ets-ie8-fix\\\"><![endif]-->\\n                <!--[if gt IE 8]><div class=\\\"ets-bd\\\"><![endif]-->\\n                <!--[if !IE]><!-->\\n                <div class=\\\"ets-bd\\\">\\n                <!--<![endif]-->\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/language-presentation/content-audio.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap ets-ap-smaller\\\">\\n\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t       data-src=\\\"\" +data.audioUrl+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t       class=\\\"ets-ap ets-ap-smaller ets-ap-nobar\\\"></audio>\\n</div></div>\"; return o; }; });\n",
    "define('school-ui-activity/util/activity-util',[\n\t'jquery',\n\t\"school-ui-shared/utils/browser-check\"\n], function ($, browserCheck) {\n\tvar Util = {};\n\t/**\n\t * remove video player\n\t */\n\tUtil.clearVideo = function (player) {\n\t\tUtil.clearMedia(player);\n\t};\n\t/**\n\t * remove audio player\n\t */\n\tUtil.clearAudio = function (player) {\n\t\tUtil.clearMedia(player);\n\t};\n\t/**\n\t * Safe way to remove mediaelement player\n\t */\n\tUtil.clearMedia = function (player) {\n\t\tif (parseInt(browserCheck.version, 10) <= 8 && player && player.container) {\n\t\t\tvar id = player.container.find('object').attr('id');\n\t\t\t$('<div></div>', {\n\t\t\t\tid: id,\n\t\t\t\tstyle: 'display: none;'\n\t\t\t}).appendTo('body');\n\t\t\t//This div will receive and ignore flash messages in IE8, see SPC-5835 and SPC-5868\n\t\t}\n\n\t\ttry {\n\t\t\tplayer.dispose();\n\t\t} catch (ex) {\n\t\t}\n\t};\n\tUtil.blink = function ($target) {\n\t\tthis.fn._blink = this.fn._blink || function () {\n\t\t\t\treturn this.fadeOut({duration: 400, queue: true})\n\t\t\t\t\t.fadeIn({duration: 400, queue: true});\n\t\t\t};\n\t\treturn $target._blink()._blink()._blink()._blink();\n\t};\n\treturn Util;\n});\n",
    "define('school-ui-activity/activity/language-presentation/main',[\n\t'jquery',\n\t'school-ui-activity/activity/base/main',\n\t'template!./language-presentation.html',\n\t'template!./content-audio.html',\n\t'jquery.ui',\n\t'school-ui-activity/util/activity-util',\n\t'jquery.jscrollpane',\n\t'jquery.mousewheel'\n], function languagePresentationModule($, Widget, tTemplate, aTemplate, ui, Util) {\n\t\"use strict\";\n\n\t/**\n\t language presentation\n\t */\n\n\tvar SEL_SOURCE_AUDIO = \"span.flashplaceholder\",\n\t\tSEL_ETS_ACT_LNP_SCROLL = \".ets-act-lnp-scroll\",\n\t\tSEL_ETS_BD = \".ets-bd\";\n\n\tvar _timeoutToChangeScrollbarAlphaFirst,\n\t\t_timeoutToChangeScrollbarAlphaSecond;\n\n\tfunction initMediaPlayer() {\n\t\tvar me = this;\n\t\tvar previousAudioUrl;\n\n\t\t//Remove extra space before audio button\n\t\tme.$element.find(SEL_SOURCE_AUDIO).each(function () {\n\t\t\tvar str = $(this).parent().html().replace(\"&nbsp;<span\", \"<span\");\n\t\t\t$(this).parent().html(str);\n\t\t});\n\n\t\tme.$element.find(SEL_SOURCE_AUDIO).each(function () {\n\t\t\tvar audioStr = $(this).attr(\"name\");\n\t\t\tif (previousAudioUrl == audioStr) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tpreviousAudioUrl = audioStr;\n\t\t\tvar audioUrl = audioStr.split(/[=|&]/)[1];\n\t\t\tvar audioHtml = $.trim(aTemplate({\"audioUrl\": audioUrl}));\n\t\t\t$(this).replaceWith($(audioHtml));\n\t\t});\n\t\treturn me.$element.find(\"[data-weave]\").weave();\n\t}\n\n\tfunction initScrollPanelEvent($pane) {\n\t\treturn $pane.bind('jsp-initialised', function () {\n\t\t\tvar $dragbar = $pane.find('.jspDrag'),\n\t\t\t\teventScroll = 'jsp-scroll-y';\n\t\t\t_timeoutToChangeScrollbarAlphaFirst = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 5000);\n\n\t\t\t_timeoutToChangeScrollbarAlphaSecond = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 30000);\n\n\t\t\t$pane.bind(eventScroll, function () {\n\t\t\t\t$pane.unbind(eventScroll);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction customScrollBar() {\n\t\tvar me = this,\n\t\t\t$pane = me.$element.find(SEL_ETS_ACT_LNP_SCROLL);\n\t\tinitScrollPanelEvent($pane).jScrollPane({\n\t\t\tcontentWidth: \"0\"\n\t\t});\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = {\n\t\t\tcontent: me._json.content.txt\n\t\t};\n\n\t\treturn me.html(tTemplate, data)\n\t\t\t.then(function () {\n\t\t\t\tme.$element.find(SEL_ETS_BD).html(data.content);\n\t\t\t\treturn initMediaPlayer.call(me);\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\tcustomScrollBar.call(me);\n\t\t\t});\n\t}\n\n\tvar extendOptions = {\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().completed(true);\n\t\t\treturn render.call(this);\n\t\t}\n\t};\n\treturn Widget.extend(function () {\n\n\t}, extendOptions);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/matching-pic-audio/main.html',[],function() { return function template(data) { var o = \"\";\n    var audios = data.audios;\n    var pics = data.pics;\no += \"\\n\\n<div class=\\\"ets-act-mpa\\\">\\n\\n    <div class=\\\"ets-targets\\\">\\n        <ul class=\\\"ets-cf\\\">\\n            \"; for (var i = 0, len = audios.length; i < len; i++) { o += \"\\n            <li \"; if(i === len - 1){ o += \"class=\\\"last\\\"\"; } o += \">\\n                <div class=\\\"ets-mb-top ets-mb-top-small\\\" data-at-id=\\\"\" + audios[i]._id + \"\\\" data-audio-id=\\\"\" + audios[i]._id + \"\\\">\\n                    <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n                        <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                               data-src=\\\"\" +audios[i].audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                               class=\\\"ets-ap\\\"></audio>\\n                    </div></div>\\n                </div>\\n                <div class=\\\"ets-placeholder\\\"></div>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n\\n    <div class=\\\"ets-options\\\">\\n        <ul class=\\\"ets-cf\\\">\\n            \"; for (var i = 0, len = pics.length; i < len; i++) { o += \"\\n            <li \"; if(i === len - 1){ o += \"class=\\\"last\\\"\"; } o += \">\\n                <div class=\\\"ets-mb-bottom ets-mb-bottom-large\\\" data-at-id=\\\"\" + pics[i]._id + \"\\\" data-pic-id=\\\"\" + pics[i]._id + \"\\\" data-index=\\\"\" + i + \"\\\">\\n                    <i class=\\\"ets-indicator\\\"></i>\\n                    <img src=\\\"\" + pics[i].image.url + \"\\\" alt=\\\"\\\" width=\\\"127\\\" height=\\\"97\\\">\\n                    <div class=\\\"ets-img-shadow\\\"></div>\\n                </div>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/matching-pic-audio/main',[\n\t'jquery',\n\t'when',\n\t'school-ui-activity/activity/base/main',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./main.html\",\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'jquery.transit'\n], function mpaMain($, when, Widget, Scoring, Interaction, tTemplate) {\n\t\"use strict\";\n\n\t// declaire variables\n\n\tvar $ROOT;\n\tvar $ORIGIN_UL;\n\n\tvar SEL_MPA = \".ets-act-mpa\",\n\t\tSEL_OPTION = '.ets-options',\n\t\tSEL_OPTION_UL = '.ets-options ul',\n\t\tSEL_MB_TOP = '.ets-mb-top',\n\t\tSEL_MB_BOTTOM = '.ets-mb-bottom',\n\t\tSEL_PLACEHOLDER = '.ets-placeholder',\n\t\tSEL_DROPPABLE_AREA = '.ets-targets li';\n\n\tvar CLS_INCORRECT = 'ets-incorrect',\n\t\tCLS_CORRECT = 'ets-correct',\n\t\tCLS_HOVER = 'ets-hover',\n\t\tCLS_DROPPED = 'ets-mb-dropped',\n\t\tCLS_MOVING = 'ets-moving';\n\n\tvar draggableSetting = {\n\t\tcontainment: SEL_MPA,\n\t\tscroll: false,\n\t\trevert: 'invalid',\n\t\tstart: function (/*event, ui*/) {\n\t\t\tvar $me = $(this);\n\t\t\t$me.addClass(CLS_MOVING);\n\t\t\tif ($me.hasClass(CLS_DROPPED)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$me.closest('li').siblings()\n\t\t\t\t.css({\n\t\t\t\t\t'z-index': 0,\n\t\t\t\t\t'position': 'relative'\n\t\t\t\t});\n\t\t\t$me.css('z-index', 1);\n\t\t},\n\t\tstop: function (/*event, ui*/) {\n\t\t\tvar $me = $(this);\n\t\t\t$me.removeClass(CLS_MOVING);\n\n\t\t\t$me.closest('li').siblings()\n\t\t\t\t.css({\n\t\t\t\t\t'z-index': '',\n\t\t\t\t\t'position': 'static'\n\t\t\t\t});\n\t\t\t$me.css('z-index', '');\n\t\t}\n\t};\n\n\t/**\n\t * Move picture back to origin position\n\t * @api private\n\t */\n\tfunction backToOriginPosition($answer) {\n\t\tvar index = $answer.attr('data-index');\n\t\tvar $li = $ORIGIN_UL.find('li').eq(index);\n\t\tvar originPos = $li.position();\n\t\tvar currentPos = $answer.position();\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t$answer\n\t\t\t\t.css('z-index', 1)\n\t\t\t\t.removeClass(CLS_DROPPED)\n\t\t\t\t.addClass(CLS_MOVING)\n\t\t\t\t.animate({\n\t\t\t\t\tleft: originPos.left - currentPos.left,\n\t\t\t\t\ttop: originPos.top - currentPos.top\n\t\t\t\t}, function () {\n\t\t\t\t\t$answer.removeClass(CLS_MOVING).next().show();\n\t\t\t\t\t$li.html($answer.css({\n\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\ttop: 'auto',\n\t\t\t\t\t\t'z-index': 'auto'\n\t\t\t\t\t}));\n\t\t\t\t\t$li.find(SEL_MB_BOTTOM).draggable(draggableSetting);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Filter Distractors\n\t **/\n\tfunction filterDist(data) {\n\t\tvar me = this;\n\n\t\tvar dists = data.scoring.pics;\n\n\t\tif (!dists) {\n\t\t\treturn data;\n\t\t}\n\t\tdata.dists = [];\n\n\t\t_.each(dists, function (dist) {\n\t\t\tdata.dists.push(_.find(data.content.pics, function (pic) {\n\t\t\t\treturn dist._id == pic._id;\n\t\t\t}));\n\n\t\t\tdata.content.pics = _.reject(data.content.pics, function (pic) {\n\t\t\t\treturn dist._id == pic._id;\n\t\t\t});\n\t\t});\n\n\t\tdelete me._json.scoring.pics;\n\n\t\treturn data;\n\t}\n\n\n\t/**\n\t * Filter source data\n\t * # Shuffle template data items\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\tvar me = this;\n\t\tif (!data.pics) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Shuffle pics items and add distraction\n\t\tif (data.dists) {\n\t\t\tvar distNo = me._json.filterOptions.distNo;\n\t\t\tfor (var i = 0, length = 5 - data.pics.length; i < length; i++) {\n\t\t\t\tif (i >= distNo) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (data.dists[i]) {\n\t\t\t\t\tdata.pics.push(data.dists[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdata.pics = _.shuffle(data.pics);\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Paging data\n\t * @api private\n\t */\n\tfunction pagination(data) {\n\t\tvar me = this;\n\t\tvar maxPairs = Math.min(data.filterOptions.questionNo, data.content.audios.length);\n\t\tvar contentLength;\n\t\tvar audios;\n\t\tvar maxPage = Math.ceil(maxPairs / 5);\n\t\tvar pairs;\n\n\t\tvar temp,\n\t\t\ttempPics,\n\t\t\ttempAuds,\n\t\t\tnewAuds = [];\n\n\t\tcontentLength = data.scoring.audios.length;\n\t\taudios = data.scoring.audios;\n\n\t\tif (contentLength > maxPairs) {\n\t\t\t// Filter pairs\n\t\t\tpairs = _.shuffle(audios).slice(0, maxPairs);\n\t\t} else {\n\t\t\tpairs = _.shuffle(audios);\n\t\t}\n\n\t\tme.length(maxPage);\n\n\t\tvar perPage = Math.ceil(maxPairs / maxPage);\n\n\t\tfor (var pageIndex = 0; pageIndex < maxPage; ++pageIndex) {\n\t\t\ttemp = {};\n\t\t\ttempAuds = temp.audios = [];\n\t\t\ttempPics = temp.pics = [];\n\n\t\t\tvar pairIndex = pageIndex * perPage, pairIndexEnd = (pageIndex + 1) * perPage;\n\t\t\tfor (; pairIndex < pairIndexEnd; pairIndex++) {\n\t\t\t\tvar pair = pairs[pairIndex];\n\t\t\t\tif (pair) {\n\t\t\t\t\ttempAuds.push(_.find(data.content.audios, function (audio) {\n\t\t\t\t\t\treturn pair._id == audio._id;\n\t\t\t\t\t}));\n\t\t\t\t\ttempPics.push(_.find(data.content.pics, function (pic) {\n\t\t\t\t\t\treturn pair.pic._id == pic._id;\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemp.references = data.references;\n\t\t\ttemp.dists = data.dists;\n\t\t\tnewAuds = newAuds.concat(tempAuds);\n\n\t\t\tme._templateData.push(filterData.call(me, temp));\n\t\t}\n\t\tme._json.content.audios = newAuds;\n\t}\n\n\t/**\n\t * Shuffle items when sequence change\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// Render widget\n\t\treturn me.html(tTemplate, me._templateData[me.index()])\n\t\t\t.then(function () {\n\t\t\t\tonRendered.call(me);\n\n\t\t\t\t$ROOT = $(SEL_MPA);\n\t\t\t\t$ORIGIN_UL = $ROOT.find(SEL_OPTION_UL);\n\t\t\t\t$ROOT.find(SEL_OPTION + ' ' + SEL_MB_BOTTOM).draggable(draggableSetting);\n\t\t\t\t$ROOT.find(SEL_DROPPABLE_AREA).droppable(me.droppableSetting);\n\n\t\t\t\t//for automation testing\n\t\t\t\treturn me.attachATAssetDom(me._templateData[me.index()]);\n\t\t\t});\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tme._currentPairs += me._templateData[me.index()].audios.length;\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme._templateData = [];\n\t\tme._currentPairs = 0;\n\t\tme._correctAnswers = 0;\n\n\t\tme.droppableSetting = {\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $pic = ui.draggable;\n\t\t\t\tvar $audio = $me.find(SEL_MB_TOP);\n\t\t\t\tvar $placeholder = $me.find(SEL_PLACEHOLDER);\n\t\t\t\tvar placholderPosition = $placeholder.position();\n\t\t\t\tvar answerPositon = $pic.position();\n\n\t\t\t\t// place the target back to its position\n\t\t\t\t$audio.animate({\n\t\t\t\t\ttop: 0\n\t\t\t\t}, 'fast');\n\n\n\t\t\t\t//insert dragging item before placeholder\n\t\t\t\t$pic.animate({\n\t\t\t\t\tleft: parseInt($pic.css('left')) + (placholderPosition.left - answerPositon.left),\n\t\t\t\t\ttop: parseInt($pic.css('top')) + (placholderPosition.top - answerPositon.top)\n\t\t\t\t}, 'fast', function () {\n\t\t\t\t\t$placeholder.before($pic.addClass(CLS_DROPPED).css({\n\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\ttop: 'auto'\n\t\t\t\t\t})).hide();\n\n\t\t\t\t\t$pic.draggable(\"destroy\");\n\t\t\t\t\t$me.droppable('disable');\n\n\t\t\t\t\tvar audioId = $audio.attr('data-audio-id');\n\t\t\t\t\tvar picId = $pic.attr('data-pic-id');\n\n\t\t\t\t\tvar correct = me.checkAnswer(audioId, picId);\n\n\t\t\t\t\tme.displayInteractionResult(correct, audioId, picId);\n\t\t\t\t});\n\t\t\t},\n\t\t\tover: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $top = $me.find(SEL_MB_TOP);\n\t\t\t\t$me.prev().addClass(CLS_HOVER);\n\t\t\t\tif ($top.is(\":animated\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$top.animate({\n\t\t\t\t\ttop: 10\n\t\t\t\t}, 'fast');\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $top = $me.find(SEL_MB_TOP);\n\t\t\t\t$top.removeClass(CLS_HOVER);\n\t\t\t\t$top.animate({\n\t\t\t\t\ttop: 0\n\t\t\t\t}, 'fast');\n\t\t\t}\n\t\t};\n\t}, {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\n\t\t\tpagination.call(me, filterDist.call(me, $.extend(true, {}, me._json)));\n\n\t\t\tme.items().instantFeedback(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\tcheckAnswer: function (audioId, picId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar pic = Scoring.findById(json.content.pics, picId);\n\t\t\tvar solution = Scoring.findById(json.scoring.audios, audioId);\n\t\t\tvar correct = pic && solution && (solution.pic._id === pic._id);\n\n\t\t\tif (correct) {\n\t\t\t\tme._correctAnswers += 1;\n\t\t\t}\n\n\t\t\tvar promise = me.publishInteraction(Interaction.makeMatchingInteraction(correct, audioId, picId));\n\n\t\t\tif (me._correctAnswers === me._currentPairs) {\n\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar item = me.items();\n\t\t\t\t\titem.answered(true);\n\t\t\t\t\titem.completed(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t},\n\t\tdisplayInteractionResult: function (correct, audioId, picId) {\n\t\t\tvar $audio = $('[data-audio-id=\"' + audioId + '\"]');\n\t\t\tvar $pic = $('[data-pic-id=\"' + picId + '\"]');\n\t\t\tvar $li = $audio.closest('li');\n\t\t\tif (correct) {\n\t\t\t\t$li.addClass(CLS_CORRECT);\n\t\t\t} else {\n\t\t\t\t$li.addClass(CLS_INCORRECT);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t$audio.css('z-index', 'auto');\n\t\t\t\t\t$li.removeClass(CLS_INCORRECT);\n\n\t\t\t\t\tbackToOriginPosition($pic)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\t$li.droppable('enable');\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t},\n\t\tnextStep: function () {\n\t\t\tvar me = this;\n\t\t\tme.index(me.index() + 1);\n\t\t\tme.items().instantFeedback(true);\n\t\t\treturn render.call(me);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/matching-text-long-text/main.html',[],function() { return function template(data) { var o = \"\";\nvar targets = data.targets;\nvar sources = data.sources;\no += \"\\n<div class=\\\"ets-act-mtl ets-cf\\\">\\n    \"; if (data.references.aud) { o += \"\\n    <div class=\\\"ets-references\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap ets-ap-bottom-right\\\"></audio>\\n        </div></div>\\n    </div>\\n    \"; } o += \"\\n\\n    <div class=\\\"ets-targets\\\">\\n        <ul>\\n            \"; for (var i = 0, len = targets.length; i < len; i++) { o += \"\\n            <li class=\\\"ets-droppable-line\\\">\\n                <ul class=\\\"ets-cf\\\">\\n                    <li class=\\\"ets-first\\\">\\n                        <span class=\\\"ets-mtl-left\\\" data-at-id=\\\"\" + targets[i]._id + \"\\\" data-target-id=\\\"\" + targets[i]._id + \"\\\">\\n                            <span>\\n                                <div>\\n                                    <div>\" + targets[i].txt + \"</div>\\n                                </div>\\n                            </span>\\n                        </span>\\n                    </li>\\n                    <li class=\\\"ets-last\\\"></li>\\n                </ul>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n\\n    <div class=\\\"ets-options\\\">\\n        <ul>\\n            \"; for (var i = 0, len = sources.length; i < len; i++) { o += \"\\n            <li>\\n                <span class=\\\"ets-mtl-right\\\" data-at-id=\\\"\" + sources[i]._id + \"\\\" data-source-id=\\\"\" + sources[i]._id + \"\\\" data-index=\\\"\" + i + \"\\\">\\n                    <i class=\\\"ets-indicator\\\"></i>\\n                    <span>\\n                        <div>\\n                            <div>\" + sources[i].txt + \"</div>\\n                        </div>\\n                    </span>\\n                    <i class=\\\"ets-bottom-shadow\\\"></i>\\n                </span>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/matching-text-long-text/main',[\n\t'jquery',\n\t\"when\",\n\t'school-ui-activity/activity/base/main',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"school-ui-shared/utils/browser-check\",\n\t\"template!./main.html\",\n\t'underscore',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch'\n], function MatchingTextText($, when, Widget, Scoring, Interaction, browserCheck, template, _) {\n\t'use strict';\n\n\tvar PAGINATE = 6;\n\n\tvar SEL_MTL = '.ets-act-mtl';\n\tvar SEL_TARGET = '.ets-targets';\n\tvar SEL_OPTION = '.ets-options';\n\tvar SEL_OPTION_UL = '.ets-options ul';\n\tvar SEL_DROPPABLE = '.ets-droppable-line ul';\n\tvar SEL_MTL_RIGHT = '.ets-mtl-right';\n\tvar SEL_MTL_LEFT = '.ets-mtl-left';\n\tvar SEL_FIRST = '.ets-first';\n\tvar SEL_LAST = '.ets-last';\n\tvar SEL_REF = '.ets-references';\n\n\tvar CLS_MOVING = 'ets-moving';\n\tvar CLS_DROPPED = 'ets-dropped';\n\tvar CLS_CORRECT = 'ets-correct';\n\tvar CLS_INCORRECT = 'ets-incorrect';\n\n\tvar draggableOptions = {\n\t\trevert: 'invalid',\n\t\tcontainment: SEL_MTL,\n\t\tscroll: false\n\t};\n\n\n\t/**\n\t * Move picture back to origin position\n\t * @api private\n\t */\n\tfunction backToOriginPosition($source) {\n\t\tvar me = this;\n\t\tvar index = $source.attr('data-index');\n\t\tvar $optionLi = me.$element.find(SEL_OPTION_UL).find('li').eq(index);\n\t\tvar optionPos = $optionLi.offset();\n\t\tvar $currentLi = $source.parent();\n\t\tvar currentPos = $currentLi.offset();\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t$source.addClass('ets-moving').animate({\n\t\t\t\tleft: optionPos.left - currentPos.left,\n\t\t\t\ttop: optionPos.top - currentPos.top\n\t\t\t}, function () {\n\t\t\t\t$optionLi.append($source.removeAttr('style').removeClass(CLS_MOVING + ' ' + CLS_DROPPED));\n\t\t\t\t$optionLi.find(SEL_MTL_RIGHT).draggable(draggableOptions);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Filter Distractors\n\t **/\n\tfunction filterDist(data) {\n\t\tvar me = this;\n\n\t\tvar dists = data.scoring.sources;\n\n\t\tif (!dists) {\n\t\t\treturn data;\n\t\t}\n\t\tdata.dists = [];\n\n\t\t_.each(dists, function (dist) {\n\t\t\tdata.dists.push(_.find(data.content.sources, function (source) {\n\t\t\t\treturn dist._id == source._id;\n\t\t\t}));\n\n\t\t\tdata.content.sources = _.reject(data.content.sources, function (source) {\n\t\t\t\treturn dist._id == source._id;\n\t\t\t});\n\t\t});\n\n\t\tdelete me._json.scoring.sources;\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle template data items\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\tvar me = this;\n\t\tif (!data.sources) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Shuffle pics items and add distraction\n\t\tif (data.dists) {\n\t\t\tvar distNo = me._json.filterOptions.distNo;\n\t\t\tfor (var i = 0, length = 5 - data.sources.length; i < length; i++) {\n\t\t\t\tif (i >= distNo) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (data.dists[i]) {\n\t\t\t\t\tdata.sources.push(data.dists[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdata.sources = _.shuffle(data.sources);\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Paginate data\n\t * @api private\n\t */\n\tfunction pagination(data) {\n\t\tvar me = this;\n\t\tvar maxPairs = Math.min(data.filterOptions.questionNo, data.content.targets.length);\n\t\tvar contentLength = data.scoring.targets.length;\n\t\tvar maxPage = Math.ceil(maxPairs / PAGINATE);\n\t\tvar pairs;\n\n\t\tvar temp,\n\t\t\ttempTargets,\n\t\t\ttempSources,\n\t\t\tnewSources = [];\n\n\t\tif (contentLength >= maxPairs) {\n\t\t\t// Filter pairs\n\t\t\tpairs = _.shuffle(data.scoring.targets).slice(0, maxPairs);\n\n\t\t\t// update scoring.targets so that scoring can calculate correctly\n\t\t\tme._json.scoring.targets = pairs;\n\t\t} else {\n\t\t\tpairs = _.shuffle(data.scoring.targets);\n\t\t}\n\n\t\tme.length(maxPage);\n\n\t\tvar perPage = Math.ceil(maxPairs / maxPage);\n\n\t\tfor (var pageIndex = 0; pageIndex < maxPage; ++pageIndex) {\n\t\t\ttemp = {};\n\t\t\ttempTargets = temp.targets = [];\n\t\t\ttempSources = temp.sources = [];\n\n\t\t\tvar pairIndex = pageIndex * perPage, pairIndexEnd = (pageIndex + 1) * perPage;\n\t\t\tfor (; pairIndex < pairIndexEnd; pairIndex++) {\n\t\t\t\tvar pair = pairs[pairIndex];\n\t\t\t\tif (pair) {\n\t\t\t\t\ttempTargets.push(_.find(data.content.targets, function (target) {\n\t\t\t\t\t\treturn pair._id == target._id;\n\t\t\t\t\t}));\n\t\t\t\t\ttempSources.push(_.find(data.content.sources, function (source) {\n\t\t\t\t\t\treturn pair.source.txt == source.txt;\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemp.dists = data.dists;\n\t\t\ttemp.references = data.references;\n\t\t\tnewSources = newSources.concat(tempSources);\n\n\t\t\tme._templateData.push(filterData.call(me, temp));\n\t\t}\n\t\tme._json.content.sources = newSources;\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\treturn me.html(template, me._templateData[me.index()])\n\t\t\t.then(function () {\n\t\t\t\tonRendered.call(me);\n\t\t\t\treturn me.attachATAssetDom(me._templateData[me.index()]);\n\t\t\t});\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tme._currentPairs += me._templateData[me.index()].targets.length;\n\n\t\tme.$element.find(SEL_OPTION + ' ' + SEL_MTL_RIGHT).css('position', 'relative').draggable(draggableOptions);\n\t\tme.$element.find(SEL_OPTION).on('mousedown mouseup', SEL_MTL_RIGHT, function (e) {\n\t\t\tvar $me = $(this);\n\t\t\tif (e.type === 'mousedown') {\n\t\t\t\t$me.addClass(CLS_MOVING);\n\t\t\t} else {\n\t\t\t\t$me.removeClass(CLS_MOVING);\n\t\t\t}\n\t\t});\n\n\t\tme.$element.find(SEL_DROPPABLE).droppable(me._droppableOptions);\n\n\t\t// prevent user select\n\t\tif (browserCheck.browser === \"msie\") {\n\t\t\tme.$element.find(SEL_TARGET).add(SEL_OPTION).on('selectstart', function () {\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\t// let audio player vertical align to center\n\t\tif (me._json.references.aud) {\n\t\t\tme.$element.find(SEL_REF).css({\n\t\t\t\t'padding-top': (me.$element.find(SEL_MTL).height() - 75) / 2\n\t\t\t});\n\t\t}\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme._templateData = [];\n\t\tme._currentPairs = 0;\n\t\tme._correctAnswers = 0;\n\n\t\tme._droppableOptions = {\n\t\t\thoverClass: \"ets-drop-hover\",\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $me = $(this).animate({\n\t\t\t\t\tleft: 0\n\t\t\t\t}, 'fast', function () {\n\t\t\t\t\t$me.css('position', 'static');\n\t\t\t\t});\n\t\t\t\tvar $source = ui.draggable;\n\t\t\t\tvar $target = $me.find(SEL_FIRST + ' ' + SEL_MTL_LEFT);\n\t\t\t\tvar $li = $me.find(SEL_LAST);\n\n\t\t\t\tvar targetPos = $li.offset();\n\t\t\t\tvar originPos = ui.offset;\n\n\t\t\t\t$source.addClass('ets-moving').animate({\n\t\t\t\t\tleft: parseInt($source.css('left')) + (targetPos.left - originPos.left),\n\t\t\t\t\ttop: parseInt($source.css('top')) + (targetPos.top - originPos.top)\n\t\t\t\t}, 'fast', function () {\n\t\t\t\t\t$source.removeClass(CLS_MOVING).addClass(CLS_DROPPED);\n\t\t\t\t\t$li.html($source.removeAttr('style'));\n\n\t\t\t\t\t$me.droppable('disable');\n\n\t\t\t\t\t$source.draggable('destroy');\n\n\t\t\t\t\tvar sourceId = $source.attr('data-source-id');\n\t\t\t\t\tvar targetId = $target.attr('data-target-id');\n\n\t\t\t\t\tvar correct = me.checkAnswer(sourceId, targetId);\n\n\t\t\t\t\tme.displayInteractionResult(correct, $source, $target);\n\t\t\t\t});\n\t\t\t},\n\t\t\tover: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\n\t\t\t\tif ($me.is(\":animated\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$me.css({position: 'relative'}).animate({\n\t\t\t\t\tleft: 10\n\t\t\t\t}, 'fast');\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\n\t\t\t\t$me.animate({\n\t\t\t\t\tleft: 0\n\t\t\t\t}, 'fast', function () {\n\t\t\t\t\t$me.css('position', 'static');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}, {\n\t\t'sig/initialize': function () {\n\t\t\tvar me = this;\n\n\t\t\tpagination.call(me, filterDist.call(me, me._json));\n\t\t},\n\t\t'sig/render': function () {\n\t\t\tthis.items().instantFeedback(true);\n\n\t\t\treturn render.call(this);\n\t\t},\n\t\tcheckAnswer: function (sourceId, targetId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar source = Scoring.findById(json.content.sources, sourceId);\n\t\t\tvar solution = Scoring.findById(json.scoring.targets, targetId);\n\t\t\tvar correct = source && solution && (solution.source.txt === source.txt);\n\n\t\t\tif (correct) {\n\t\t\t\tme._correctAnswers += 1;\n\t\t\t}\n\n\t\t\tvar promise = me.publishInteraction(Interaction.makeMatchingInteraction(correct, targetId, sourceId));\n\n\t\t\tif (me._correctAnswers === me._currentPairs) {\n\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar item = me.items();\n\t\t\t\t\titem.answered(true);\n\t\t\t\t\titem.completed(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $source, $target) {\n\t\t\tvar me = this;\n\n\t\t\tvar $ul = $target.closest('ul');\n\n\t\t\tif (correct) {\n\t\t\t\t$ul.addClass(CLS_CORRECT);\n\t\t\t} else {\n\t\t\t\t$ul.addClass(CLS_INCORRECT);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t$target.css('z-index', 'auto');\n\t\t\t\t\t$ul.removeClass(CLS_INCORRECT);\n\n\t\t\t\t\tbackToOriginPosition.call(me, $source)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\t$target.closest('ul')\n\t\t\t\t\t\t\t\t.droppable('enable');\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t},\n\t\tnextStep: function () {\n\t\t\tvar me = this;\n\t\t\tme.index(me.index() + 1);\n\t\t\tme.items().instantFeedback(true);\n\t\t\trender.call(me);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/matching-text-pic/main.html',[],function() { return function template(data) { var o = \"\";\n    var pics = data.pics;\n    var texts = data.texts;\no += \"\\n\\n<div class=\\\"ets-act-mtp\\\">\\n    \"; if (data.references.aud) { o += \"\\n    <div class=\\\"ets-references\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n    \"; } o += \"\\n\\n    <div class=\\\"ets-targets\\\">\\n        <ul class=\\\"ets-cf\\\">\\n            \";for (var i = 0, len = pics.length; i < len; i++) {o += \"\\n            <li \"; if(i === len - 1){ o += \"class=\\\"last\\\"\"; } o += \">\\n                <div class=\\\"ets-mb-top\\\" data-at-id=\\\"\" + pics[i]._id + \"\\\" data-pic-id=\\\"\" + pics[i]._id + \"\\\">\\n                    <img src=\\\"\" + pics[i].image.url + \"\\\" alt=\\\"\\\" width=\\\"127\\\" height=\\\"97\\\">\\n                    <div class=\\\"ets-img-shadow\\\"></div>\\n                </div>\\n                <div class=\\\"ets-placeholder\\\">\\n                </div>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n\\n    <div class=\\\"ets-options\\\">\\n        <ul class=\\\"ets-cf\\\">\\n            \";for (var i = 0, len = texts.length; i < len; i++) {o += \"\\n            <li \"; if(i === len - 1){ o += \"class=\\\"last\\\"\"; } o += \">\\n                <div class=\\\"ets-mb-bottom\\\" data-at-id=\\\"\" + texts[i]._id + \"\\\" data-text-id=\\\"\" + texts[i]._id + \"\\\" data-index=\\\"\" + i + \"\\\">\\n                    <i class=\\\"ets-indicator\\\"></i>\\n                    <span>\" + texts[i].txt + \"</span>\\n                </div>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/matching-text-pic/main',[\n\t'jquery',\n\t'when',\n\t'school-ui-activity/activity/base/main',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./main.html\",\n\t'underscore',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'jquery.transit'\n], function mpaMain($, when, Widget, Scoring, Interaction, tTemplate) {\n\t\"use strict\";\n\n\tvar $ROOT;\n\tvar $ORIGIN_UL;\n\n\tvar SEL_MTP = \".ets-act-mtp\",\n\t\tSEL_OPTION = '.ets-options',\n\t\tSEL_OPTION_UL = '.ets-options ul',\n\t\tSEL_MB_TOP = '.ets-mb-top',\n\t\tSEL_MB_BOTTOM = '.ets-mb-bottom',\n\t\tSEL_PLACEHOLDER = '.ets-placeholder',\n\t\tSEL_DROPPABLE_AREA = '.ets-targets li';\n\n\tvar CLS_INCORRECT = 'ets-incorrect',\n\t\tCLS_CORRECT = 'ets-correct',\n\t\tCLS_HOVER = 'ets-hover',\n\t\tCLS_DROPPED = 'ets-mb-dropped',\n\t\tCLS_MOVING = 'ets-moving',\n\t\tCLS_MB_MEDIUM = 'ets-mb-bottom-medium',\n\t\tCLS_PH_MEDIUM = 'ets-placeholder-medium';\n\n\tvar draggableSetting = {\n\t\tcontainment: SEL_MTP,\n\t\tscroll: false,\n\t\trevert: 'invalid',\n\t\tstart: function (/*event, ui*/) {\n\t\t\tvar $me = $(this);\n\t\t\t$me.addClass(CLS_MOVING);\n\t\t\tif ($me.hasClass(CLS_DROPPED)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$me.closest('li').siblings()\n\t\t\t\t.css({\n\t\t\t\t\t'z-index': 0,\n\t\t\t\t\t'position': 'relative'\n\t\t\t\t});\n\t\t\t$me.css('z-index', 1);\n\t\t},\n\t\tstop: function (/*event, ui*/) {\n\t\t\tvar $me = $(this);\n\t\t\t$me.removeClass(CLS_MOVING);\n\t\t\t$me.closest('li').siblings()\n\t\t\t\t.css({\n\t\t\t\t\t'z-index': '',\n\t\t\t\t\t'position': 'static'\n\t\t\t\t});\n\t\t\t$me.css('z-index', '');\n\t\t}\n\t};\n\n\n\t/**\n\t * Move picture back to origin position\n\t * @api private\n\t */\n\tfunction backToOriginPosition($answer) {\n\t\tvar index = $answer.attr('data-index');\n\t\tvar $li = $ORIGIN_UL.find('li').eq(index);\n\t\tvar originPos = $li.position();\n\t\tvar currentPos = $answer.position();\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t$answer.css('z-index', 1).removeClass(CLS_DROPPED)\n\t\t\t\t.addClass(CLS_MOVING).animate({\n\t\t\t\t\tleft: originPos.left - currentPos.left,\n\t\t\t\t\ttop: originPos.top - currentPos.top\n\t\t\t\t}, function () {\n\t\t\t\t\t$answer.removeClass(CLS_MOVING).next().show();\n\t\t\t\t\t$li.html($answer.css({\n\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\ttop: 'auto',\n\t\t\t\t\t\t'z-index': 'auto'\n\t\t\t\t\t}));\n\t\t\t\t\t$li.find(SEL_MB_BOTTOM).draggable(draggableSetting);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Filter Distractors\n\t **/\n\tfunction filterDist(data) {\n\t\tvar me = this;\n\t\tvar dists = data.scoring.texts;\n\n\t\tif (!dists) {\n\t\t\treturn data;\n\t\t}\n\t\tdata.dists = [];\n\n\t\t_.each(dists, function (dist) {\n\t\t\tdata.dists.push(_.find(data.content.texts, function (text) {\n\t\t\t\treturn dist._id == text._id;\n\t\t\t}));\n\n\t\t\tdata.content.texts = _.reject(data.content.texts, function (text) {\n\t\t\t\treturn dist._id == text._id;\n\t\t\t});\n\t\t});\n\n\t\tdelete me._json.scoring.texts;\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle template data items\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\tvar me = this;\n\t\tif (!data.texts) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Shuffle pics items and add distraction\n\t\tif (data.dists) {\n\t\t\tvar distNo = me._json.filterOptions.distNo;\n\t\t\tfor (var i = 0, length = 5 - data.texts.length; i < length; i++) {\n\t\t\t\tif (i >= distNo) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (data.dists[i]) {\n\t\t\t\t\tdata.texts.push(data.dists[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdata.texts = _.shuffle(data.texts);\n\n\t\treturn data;\n\t}\n\n\tfunction pagination(data) {\n\t\tvar me = this;\n\t\tvar maxPairs = Math.min(data.filterOptions.questionNo, data.content.pics.length);\n\t\tvar contentLength = data.scoring.pics.length;\n\t\tvar maxPage = Math.ceil(maxPairs / 5);\n\t\tvar pairs;\n\n\t\tvar temp,\n\t\t\ttempPics,\n\t\t\ttempTexts,\n\t\t\tnewPics = [];\n\n\t\tif (contentLength >= maxPairs) {\n\t\t\t// Filter pairs\n\t\t\tpairs = _.shuffle(data.scoring.pics).slice(0, maxPairs);\n\t\t} else {\n\t\t\tpairs = _.shuffle(data.scoring.pics);\n\t\t}\n\n\t\tme.length(maxPage);\n\n\t\tvar perPage = Math.ceil(maxPairs / maxPage);\n\n\n\t\tfor (var pageIndex = 0; pageIndex < maxPage; ++pageIndex) {\n\t\t\ttemp = {};\n\t\t\ttempPics = temp.pics = [];\n\t\t\ttempTexts = temp.texts = [];\n\n\t\t\tvar pairIndex = pageIndex * perPage, pairIndexEnd = (pageIndex + 1) * perPage;\n\t\t\tfor (; pairIndex < pairIndexEnd; pairIndex++) {\n\t\t\t\tvar pair = pairs[pairIndex];\n\t\t\t\tif (pair) {\n\t\t\t\t\ttempPics.push(_.find(data.content.pics, function (pic) {\n\t\t\t\t\t\treturn pair._id == pic._id;\n\t\t\t\t\t}));\n\t\t\t\t\ttempTexts.push(_.find(data.content.texts, function (text) {\n\t\t\t\t\t\treturn pair.text._id == text._id;\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemp.dists = data.dists;\n\t\t\ttemp.references = data.references;\n\t\t\tnewPics = newPics.concat(tempPics);\n\n\t\t\tme._templateData.push(filterData.call(me, temp));\n\t\t}\n\n\t\tme._json.content.pics = newPics;\n\t}\n\n\t/**\n\t * Shuffle items when sequence change\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// Render widget\n\t\treturn me.html(tTemplate, me._templateData[me.index()])\n\t\t\t.then(function () {\n\t\t\t\tonRendered.call(me);\n\n\t\t\t\t$ROOT = $(SEL_MTP);\n\t\t\t\t$ORIGIN_UL = $ROOT.find(SEL_OPTION_UL);\n\t\t\t\t$ROOT.find(SEL_OPTION + ' ' + SEL_MB_BOTTOM).draggable(draggableSetting);\n\t\t\t\t$ROOT.find(SEL_DROPPABLE_AREA).droppable(me.droppableSetting);\n\n\t\t\t\treturn me.attachATAssetDom(me._templateData[me.index()]);\n\t\t\t});\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # enlarge the height of matching block bottom by add a class, if neccessary\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tvar $mb = $(SEL_MB_BOTTOM);\n\t\tvar $span = $mb.children('span');\n\n\t\tme._currentPairs += me._templateData[me.index()].pics.length;\n\n\t\tif ($span.length) {\n\t\t\t$span.each(function () {\n\t\t\t\tif ($(this).height() > 32) {\n\t\t\t\t\t$mb.addClass(CLS_MB_MEDIUM);\n\t\t\t\t\t$(SEL_PLACEHOLDER).addClass(CLS_PH_MEDIUM);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme._templateData = [];\n\t\tme._currentPairs = 0;\n\t\tme._correctAnswers = 0;\n\n\t\tme.droppableSetting = {\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $text = ui.draggable;\n\t\t\t\tvar $pic = $me.find(SEL_MB_TOP);\n\t\t\t\tvar $placeholder = $me.find(SEL_PLACEHOLDER);\n\t\t\t\tvar placholderPosition = $placeholder.position();\n\t\t\t\tvar answerPositon = $text.position();\n\n\t\t\t\t// place the target back to its position\n\t\t\t\t$pic.animate({\n\t\t\t\t\ttop: 0\n\t\t\t\t}, 'fast');\n\n\t\t\t\t//insert dragging item before placeholder\n\t\t\t\t$text.animate({\n\t\t\t\t\tleft: parseInt($text.css('left')) + (placholderPosition.left - answerPositon.left),\n\t\t\t\t\ttop: parseInt($text.css('top')) + (placholderPosition.top - answerPositon.top)\n\t\t\t\t}, 'fast', function () {\n\t\t\t\t\t$placeholder.before($text.addClass(CLS_DROPPED).css({\n\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\ttop: 'auto'\n\t\t\t\t\t})).hide();\n\n\t\t\t\t\t$text.draggable(\"destroy\");\n\t\t\t\t\t$me.droppable('disable');\n\n\t\t\t\t\tvar picId = $pic.attr('data-pic-id');\n\t\t\t\t\tvar textId = $text.attr('data-text-id');\n\n\t\t\t\t\tvar correct = me.checkAnswer(picId, textId);\n\n\t\t\t\t\tme.displayInteractionResult(correct, $pic, $text);\n\t\t\t\t});\n\t\t\t},\n\t\t\tover: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $top = $me.find(SEL_MB_TOP);\n\t\t\t\t$me.prev().addClass(CLS_HOVER);\n\t\t\t\tif ($top.is(\":animated\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$top.animate({\n\t\t\t\t\ttop: 10\n\t\t\t\t}, 'fast');\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tvar $top = $me.find(SEL_MB_TOP);\n\t\t\t\t$top.removeClass(CLS_HOVER);\n\t\t\t\t$top.animate({\n\t\t\t\t\ttop: 0\n\t\t\t\t}, 'fast');\n\t\t\t}\n\t\t};\n\t}, {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\n\t\t\tpagination.call(me, filterDist.call(me, $.extend(true, {}, me._json)));\n\n\t\t\tme.items().instantFeedback(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\tcheckAnswer: function (picId, textId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar text = Scoring.findById(json.content.texts, textId);\n\t\t\tvar solution = Scoring.findById(json.scoring.pics, picId);\n\t\t\tvar correct = text && solution && (solution.text._id === text._id);\n\n\t\t\tif (correct) {\n\t\t\t\tme._correctAnswers += 1;\n\t\t\t}\n\n\t\t\tvar promise = me.publishInteraction(Interaction.makeMatchingInteraction(correct, picId, textId));\n\n\t\t\tif (me._correctAnswers === me._currentPairs) {\n\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar item = me.items();\n\t\t\t\t\titem.answered(true);\n\t\t\t\t\titem.completed(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $pic, $text) {\n\t\t\tvar me = this;\n\t\t\tvar json = this._json;\n\n\t\t\tvar $li = $pic.closest('li');\n\t\t\tif (correct) {\n\t\t\t\t$li.addClass(CLS_CORRECT);\n\t\t\t} else {\n\t\t\t\t$li.addClass(CLS_INCORRECT);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t$pic.css('z-index', 'auto');\n\t\t\t\t\t$li.removeClass(CLS_INCORRECT);\n\t\t\t\t\tbackToOriginPosition($text)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\t$pic.closest('li').droppable('enable');\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t},\n\t\tnextStep: function () {\n\t\t\tvar me = this;\n\t\t\tme.index(me.index() + 1);\n\t\t\tme.items().instantFeedback(true);\n\t\t\treturn render.call(me);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/matching-text-text/main.html',[],function() { return function template(data) { var o = \"\";\nvar targets = data.targets;\nvar sources = data.sources;\no += \"\\n<div class=\\\"ets-act-mtt ets-cf\\\">\\n\\n    \"; if (data.references.aud) { o += \"\\n    <div class=\\\"ets-references\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n    \"; } o += \"\\n\\n    <div class=\\\"ets-targets\\\">\\n\\n        <ul class=\\\"ets-droppable\\\">\\n            \"; for (var i = 0, len = targets.length; i < len; i++) { o += \"\\n            <li class=\\\"ets-droppable-line\\\">\\n                <ul class=\\\"ets-cf\\\">\\n                    <li class=\\\"ets-first\\\">\\n                        <span class=\\\"ets-word-puzzle ets-undraggable\\\" data-at-id=\\\"\" + targets[i]._id + \"\\\" data-target-id=\\\"\" + targets[i]._id + \"\\\">\\n                            <span>\\n                                <div>\\n                                    <div>\" + targets[i].txt + \"</div>\\n                                </div>\\n                            </span>\\n                        </span>\\n                    </li>\\n                    <li class=\\\"ets-last\\\"></li>\\n                </ul>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n\\n    </div>\\n\\n    <div class=\\\"ets-options\\\">\\n        <ul>\\n            \"; for (var i = 0, len = sources.length; i < len; i++) { o += \"\\n            <li class=\\\"ets-last\\\">\\n                <span class=\\\"ets-word-puzzle\\\" data-at-id=\\\"\" + sources[i]._id + \"\\\" data-source-id=\\\"\" + sources[i]._id + \"\\\" data-index=\\\"\" + i + \"\\\" data-action=\\\"draggable/option\\\">\\n                    <i class=\\\"ets-indicator\\\"></i>\\n                    <span>\\n                        <div>\\n                            <div>\" + sources[i].txt + \"</div>\\n                        </div>\\n                    </span>\\n                    <i class=\\\"ets-bottom-shadow\\\"></i>\\n                </span>\\n            </li>\\n            \"; } o += \"\\n        </ul>\\n    </div>\\n\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/matching-text-text/main',[\n\t'jquery',\n\t\"poly\",\n\t\"when\",\n\t'school-ui-activity/activity/base/main',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"school-ui-shared/utils/browser-check\",\n\t\"template!./main.html\",\n\t'underscore',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch'\n], function MatchingTextText($, poly, when, Widget, Scoring, Interaction, browserCheck, template, _) {\n\t'use strict';\n\n\tvar PAGINATE = 6;\n\n\tvar SEL_MTT = '.ets-act-mtt';\n\tvar SEL_TARGET = '.ets-targets';\n\tvar SEL_OPTION = '.ets-options';\n\tvar SEL_PUZZLE = '.ets-word-puzzle';\n\tvar SEL_DROPPABLE = '.ets-droppable ul';\n\tvar SEL_OPTION_UL = '.ets-options ul';\n\n\tvar CLS_MOVING = 'ets-moving';\n\tvar CLS_CORRECT = 'ets-correct';\n\tvar CLS_INCORRECT = 'ets-incorrect';\n\tvar CLS_UNDRAGGABLE = 'ets-undraggable';\n\n\tvar draggableOptions = {\n\t\trevert: 'invalid',\n\t\tcontainment: SEL_MTT,\n\t\tscroll: false,\n\t\tzIndex: 2\n\t};\n\n\t/**\n\t * Move picture back to origin position\n\t * @api private\n\t */\n\tfunction backToOriginPosition($source) {\n\t\tvar me = this;\n\t\tvar index = $source.attr('data-index');\n\t\tvar $li = me.$element.find(SEL_OPTION_UL).find('li').eq(index);\n\t\tvar originPos = $li.position();\n\t\tvar currentPos = $source.position();\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t$source\n\t\t\t\t.css('z-index', 1)\n\t\t\t\t.addClass(CLS_MOVING)\n\t\t\t\t.animate({\n\t\t\t\t\tleft: originPos.left - currentPos.left,\n\t\t\t\t\ttop: originPos.top - currentPos.top\n\t\t\t\t}, function () {\n\t\t\t\t\t$source\n\t\t\t\t\t\t.removeClass(CLS_MOVING + \" \" + CLS_UNDRAGGABLE)\n\t\t\t\t\t\t.next()\n\t\t\t\t\t\t.show();\n\t\t\t\t\t$li.html($source.css({\n\t\t\t\t\t\tleft: 'auto',\n\t\t\t\t\t\ttop: 'auto',\n\t\t\t\t\t\t'z-index': 'auto'\n\t\t\t\t\t}));\n\t\t\t\t\t$li.find(SEL_PUZZLE).draggable(draggableOptions);\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Filter Distractors\n\t **/\n\tfunction filterDist(data) {\n\t\tvar me = this;\n\n\t\tvar dists = data.scoring.sources;\n\n\t\tif (!dists) {\n\t\t\treturn data;\n\t\t}\n\t\tdata.dists = [];\n\n\t\t_.each(dists, function (dist) {\n\t\t\tdata.dists.push(_.find(data.content.sources, function (source) {\n\t\t\t\treturn dist._id == source._id;\n\t\t\t}));\n\n\t\t\tdata.content.sources = _.reject(data.content.sources, function (source) {\n\t\t\t\treturn dist._id == source._id;\n\t\t\t});\n\t\t});\n\n\t\tdelete me._json.scoring.sources;\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle template data items\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\tvar me = this;\n\t\tif (!data.sources) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Shuffle pics items and add distraction\n\t\tif (data.dists) {\n\t\t\tvar distNo = me._json.filterOptions.distNo;\n\t\t\tfor (var i = 0, length = 5 - data.sources.length; i < length; i++) {\n\t\t\t\tif (i >= distNo) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (data.dists[i]) {\n\t\t\t\t\tdata.sources.push(data.dists[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdata.sources = _.shuffle(data.sources);\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Paginate data\n\t * @api private\n\t */\n\tfunction pagination(data) {\n\t\tvar me = this;\n\t\tvar maxPairs = Math.min(data.filterOptions.questionNo, data.content.targets.length);\n\t\tvar contentLength = data.scoring.targets.length;\n\t\tvar maxPage = Math.ceil(maxPairs / PAGINATE);\n\t\tvar pairs;\n\n\t\tvar temp,\n\t\t\ttempTargets,\n\t\t\ttempSources,\n\t\t\tnewSources = [];\n\n\t\tif (contentLength >= maxPairs) {\n\t\t\t// Filter pairs\n\t\t\tpairs = _.shuffle(data.scoring.targets).slice(0, maxPairs);\n\n\t\t\t// update scoring.targets so that scoring can calculate correctly\n\t\t\tme._json.scoring.targets = pairs;\n\t\t} else {\n\t\t\tpairs = _.shuffle(data.scoring.targets);\n\t\t}\n\n\t\tme.length(maxPage);\n\n\t\tvar perPage = Math.ceil(maxPairs / maxPage);\n\n\t\tfor (var pageIndex = 0; pageIndex < maxPage; ++pageIndex) {\n\t\t\ttemp = {};\n\t\t\ttempTargets = temp.targets = [];\n\t\t\ttempSources = temp.sources = [];\n\n\t\t\tvar pairIndex = pageIndex * perPage, pairIndexEnd = (pageIndex + 1) * perPage;\n\t\t\tfor (; pairIndex < pairIndexEnd; ++pairIndex) {\n\t\t\t\tvar pair = pairs[pairIndex];\n\t\t\t\tif (pair) {\n\t\t\t\t\ttempTargets.push(_.find(data.content.targets, function (target) {\n\t\t\t\t\t\treturn pair._id == target._id;\n\t\t\t\t\t}));\n\t\t\t\t\ttempSources.push(_.find(data.content.sources, function (source) {\n\t\t\t\t\t\treturn pair.source.txt == source.txt;\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemp.dists = data.dists;\n\t\t\ttemp.references = data.references;\n\t\t\tnewSources = newSources.concat(tempSources);\n\n\t\t\tme._templateData.push(filterData.call(me, temp));\n\t\t}\n\t\tme._json.content.sources = newSources;\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\treturn me.html(template, me._templateData[me.index()])\n\t\t\t.then(function () {\n\t\t\t\tme.attachATAssetDom(me._templateData[me.index()]);\n\t\t\t\tonRendered.call(me);\n\t\t\t});\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tme._currentPairs += me._templateData[me.index()].targets.length;\n\n\t\tme.$element.find(SEL_OPTION + ' ' + SEL_PUZZLE).css('position', 'relative').draggable(draggableOptions);\n\t\tme.$element.find(SEL_OPTION).on('mousedown mouseup', SEL_PUZZLE, function (e) {\n\t\t\tvar $me = $(this);\n\t\t\tif (e.type === 'mousedown') {\n\t\t\t\t$me.addClass(CLS_MOVING);\n\t\t\t} else {\n\n\t\t\t\t$me.removeClass(CLS_MOVING);\n\t\t\t}\n\t\t});\n\n\t\tme.$element.find(SEL_DROPPABLE).droppable(me._droppableOptions);\n\n\t\t// prevent user select\n\t\tif (browserCheck.browser === \"msie\") {\n\t\t\tme.$element.find(SEL_TARGET).add(SEL_OPTION).on('selectstart', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t}\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme._templateData = [];\n\t\tme._currentPairs = 0;\n\t\tme._correctAnswers = 0;\n\n\t\tme._droppableOptions = {\n\t\t\thoverClass: \"ets-drop-hover\",\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $me = $(this).css('position', 'static');\n\t\t\t\tvar $source = ui.draggable;\n\t\t\t\tvar $target = $me.find('.ets-first .ets-word-puzzle');\n\t\t\t\tvar $li = $me.find('.ets-last');\n\n\t\t\t\tvar targetPos = $li.position();\n\t\t\t\tvar originPos = $source.position();\n\n\t\t\t\t$source.addClass(CLS_MOVING).animate({\n\t\t\t\t\tleft: parseInt($source.css('left')) + (targetPos.left - originPos.left) + 2,\n\t\t\t\t\ttop: parseInt($source.css('top')) + (targetPos.top - originPos.top)\n\t\t\t\t}, function () {\n\t\t\t\t\t$li.html($source.removeAttr('style').removeClass(CLS_MOVING));\n\n\t\t\t\t\t$me.droppable('disable');\n\t\t\t\t\t$source.addClass(CLS_UNDRAGGABLE).draggable('destroy');\n\n\t\t\t\t\tvar sourceId = $source.attr('data-source-id');\n\t\t\t\t\tvar targetId = $target.attr('data-target-id');\n\n\t\t\t\t\tvar correct = me.checkAnswer(sourceId, targetId);\n\n\t\t\t\t\tme.displayInteractionResult(correct, $source, $target);\n\t\t\t\t});\n\t\t\t},\n\t\t\tover: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tif ($me.is(\":animated\")) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$me.css({position: 'relative'}).animate({\n\t\t\t\t\tleft: 10\n\t\t\t\t}, 'fast');\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t\tvar $me = $(this);\n\n\t\t\t\t$me.animate({\n\t\t\t\t\tleft: 0\n\t\t\t\t}, 'fast');\n\t\t\t}\n\t\t};\n\t}, {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\n\t\t\tpagination.call(me, filterDist.call(me, me._json));\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().instantFeedback(true);\n\n\t\t\treturn render.call(this);\n\t\t},\n\t\tcheckAnswer: function (sourceId, targetId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar source = Scoring.findById(json.content.sources, sourceId);\n\t\t\tvar solution = Scoring.findById(json.scoring.targets, targetId);\n\t\t\tvar correct = source && solution && (solution.source.txt === source.txt);\n\n\t\t\tif (correct) {\n\t\t\t\tme._correctAnswers += 1;\n\t\t\t}\n\n\t\t\tvar promise = me.publishInteraction(Interaction.makeMatchingInteraction(correct, targetId, sourceId));\n\n\t\t\tif (me._correctAnswers === me._currentPairs) {\n\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar item = me.items();\n\t\t\t\t\titem.answered(true);\n\t\t\t\t\titem.completed(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $source, $target) {\n\t\t\tvar me = this;\n\t\t\tvar $ul = $target.closest('ul');\n\t\t\tif (correct) {\n\t\t\t\t$ul.addClass(CLS_CORRECT);\n\t\t\t} else {\n\t\t\t\t$ul.addClass(CLS_INCORRECT);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t$target.css('z-index', 'auto');\n\t\t\t\t\t$ul.removeClass(CLS_INCORRECT);\n\n\t\t\t\t\tbackToOriginPosition.call(me, $source)\n\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\t$target.closest('ul').droppable('enable');\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t},\n\t\tnextStep: function () {\n\t\t\tvar me = this;\n\t\t\tme.index(me.index() + 1);\n\t\t\tthis.items().instantFeedback(true);\n\t\t\treturn render.call(me);\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/main.html',[],function() { return function template(data) { var o = \"\"; var words = data.content.words; o += \"\\n<div class=\\\"ets-act-mvp ets-cf\\\">\\n    <div class=\\\"ets-movie\\\" data-at-id=\\\"video\\\">\\n        <!--<div data-weave=\\\"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\\\"></div>-->\\n    </div>\\n\\n    <div class=\\\"ets-word-list\\\">\\n        <ul>\\n            \";for (var i = 0, len = words.length; i < len; i++) {o += \"\\n            <li class=\\\"\" +(i === 0 ? 'ets-first' : '')+ \"\\\" data-at-id=\\\"answer\\\">\\n                <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                       class=\\\"ets-ap ets-ap-small ets-ap-nobar\\\"\\n                       data-src=\\\"\" +words[i].translation.audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                       controls=\\\"controls\\\"></audio>\\n\\n                <div class=\\\"ets-words-info\\\">\\n                    <p class=\\\"ets-word\\\">\" +words[i].txt+ \"</p>\\n                    \";if(words[i].txt.replace(/\\’/g,\"'\") !== words[i].translation.translation.replace(/\\’/g,\"'\")){o += \"\\n                        <p class=\\\"ets-translation\\\">\" +words[i].translation.translation+ \"</p>\\n                    \";}o += \"\\n                </div>\\n            </li>\\n            \";}o += \"\\n        </ul>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/movie-presentation/continuousMovie',[\n\t\"jquery\",\n\t\"poly\",\n\t\"mediaelement-plugin-ef\",\n\t\"school-ui-activity/util/content-converter\",\n\t\"school-ui-activity/activity/base/main\",\n\t\"template!./main.html\"\n], function mpaMain($, poly, mejs, converter, Widget, tTemplate) {\n\t\"use strict\";\n\tvar $ELEMENT = \"$element\";\n\n\tvar CLS_ACTIVE = \"ets-active\";\n\n\tvar SEL_MOVIE = \".ets-movie\";\n\tvar SEL_WORD_LIST = \".ets-word-list\";\n\tvar SEL_WORD_LI = \"li\";\n\tvar SEL_MEJS_TIME_SEPARATOR = \".mejs-time-separator-item\";\n\n\tvar DURATION_WORD_ACTIVE = 1000;\n\tvar DURATION_WORDLIST_SCROLL = 500;\n\n\tfunction showWord(index) {\n\t\tvar me = this;\n\t\tvar $li = me.$wordlist.find(SEL_WORD_LI).eq(index);\n\t\t$li.show();\n\t\t$li.attr(\"data-at-status\", \"shown\");\t//for automation testing\n\t}\n\n\tfunction activeWord(index) {\n\t\tvar me = this;\n\t\tvar $li = me.$wordlist.find(SEL_WORD_LI).eq(index);\n\n\t\tif (!$li.hasClass(CLS_ACTIVE)) {\n\t\t\t$li.addClass(CLS_ACTIVE);\n\n\t\t\tsetTimeout(function () {\n\t\t\t\t$li.removeClass(CLS_ACTIVE);\n\t\t\t}, DURATION_WORD_ACTIVE);\n\t\t}\n\t}\n\n\tfunction scrollWordIntoView(index) {\n\t\tvar me = this;\n\t\tvar $li = me.$wordlist.find(SEL_WORD_LI).eq(index);\n\t\tvar liTop = $li.position().top;\n\t\tvar liHeight = $li.outerHeight(true);\n\t\tvar liBottom = liTop + liHeight;\n\t\tvar wordlistHeight = me.$wordlist.height();\n\n\t\tif (liTop < 0) {\n\t\t\tme.$wordlist.animate({\n\t\t\t\tscrollTop: liTop\n\t\t\t}, DURATION_WORDLIST_SCROLL);\n\t\t}\n\t\telse if (liBottom > wordlistHeight) {\n\t\t\tvar scrollDownDistance = liBottom - wordlistHeight;\n\t\t\tme.$wordlist.animate({\n\t\t\t\tscrollTop: me.$wordlist.scrollTop() + scrollDownDistance\n\t\t\t}, DURATION_WORDLIST_SCROLL);\n\t\t}\n\t}\n\n\tfunction onVPSuccess(mediaElement, domObject, player) {\n\t\tvar me = this;\n\t\tvar $mediaElement = mejs.$(mediaElement);\n\n\t\t$mediaElement.on(\"restrict_time_range_ended\", function (evt, rangeInfo) {\n\t\t\tif (rangeInfo.index < me.timeSepCount) {\n\t\t\t\tshowWord.call(me, rangeInfo.index);\n\t\t\t\tscrollWordIntoView.call(me, rangeInfo.index);\n\t\t\t\tactiveWord.call(me, rangeInfo.index);\n\n\t\t\t\tvar $currentTimeSeparator = me[$ELEMENT].find(SEL_MEJS_TIME_SEPARATOR + \":eq(\" + rangeInfo.index + \")\");\n\t\t\t\t$currentTimeSeparator.addClass(CLS_ACTIVE);\n\t\t\t}\n\t\t});\n\n\t\t$mediaElement.one(\"ended\", function () {\n\t\t\t$mediaElement.off(\"restrict_time_range_ended\");\n\n\t\t\tplayer.disableRestrictPlayingTimeRange();\n\t\t\tmediaElement.pause();\n\t\t\tmediaElement.setCurrentTime(0);\n\t\t\t$mediaElement.on(\"time_range_changed\", function (evt, rangeInfo) {\n\t\t\t\tif (rangeInfo.oldIndex < me.timeSepCount && rangeInfo.oldIndex + 1 === rangeInfo.newIndex) {\n\t\t\t\t\tscrollWordIntoView.call(me, rangeInfo.oldIndex);\n\t\t\t\t\tactiveWord.call(me, rangeInfo.oldIndex);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn me\n\t\t\t.html(tTemplate, me._json)\n\t\t\t.tap(function () {\n\t\t\t\tme.$wordlist = me[$ELEMENT].find(SEL_WORD_LIST)\n\t\t\t})\n\t\t\t.tap(initVideoPlayer.bind(me));\n\t}\n\n\tfunction initVideoPlayer() {\n\t\tvar me = this;\n\t\tvar data = me._json.content;\n\n\t\t//video info\n\t\tvar videoInfo = {\n\t\t\tvideo: data.video,\n\t\t\tposter: data.poster\n\t\t};\n\n\t\t//options\n\t\tvar features = [\"TimeRanges\", \"Subtitles\", \"SwitchQuality\"];\n\t\tvar subtitles = converter.scriptsToSubtitles(data.scripts);\n\t\tvar timeRangeSeparators = converter.questionsToEndTimes(data.words);\n\t\tme.timeSepCount = timeRangeSeparators.length;\n\n\t\tvar options = {\n\t\t\tfeatures: features,\n\t\t\tsubtitles: subtitles,\n\t\t\ttimeRangeSeparators: timeRangeSeparators,\n\t\t\trestrictPlayingTimeRange: true,\n\t\t\trestrictDeviationBefore: 0.5,\n\t\t\tcontinueOnEndOfRestrictRange: true\n\t\t};\n\n\t\t//success callback\n\t\tvar successCallback = function () {\n\t\t\tonVPSuccess.apply(me, arguments);\n\t\t};\n\n\t\t//start to init\n\t\tvar $video = me[$ELEMENT].find(SEL_MOVIE);\n\t\t$video.data({\n\t\t\t\"videoInfo\": videoInfo,\n\t\t\t\"options\": options,\n\t\t\t\"successCallback\": successCallback\n\t\t});\n\t\t$video.attr(\"data-weave\", \"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\");\n\t\t$video.weave();\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function onInit() {\n\t\t\tvar me = this;\n\t\t\tme.$wordlist = null;\n\t\t\tme.timeSepCount = -1;\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().completed(true);\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"dom:.ets-ap/media/play\": function (event) {\n\t\t\t$(event.target).closest(\"li\").addClass(CLS_ACTIVE);\n\t\t},\n\t\t\"dom:.ets-ap/media/pause\": function (event) {\n\t\t\t$(event.target).closest(\"li\").removeClass(CLS_ACTIVE);\n\t\t},\n\t\t\"dom:.ets-ap/media/ended\": function (event) {\n\t\t\t$(event.target).closest(\"li\").removeClass(CLS_ACTIVE);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/movie-presentation/screen-word.html',[],function() { return function template(data) { var o = \"<table class=\\\"ets-screen-inner\\\">\\n    <tr>\\n        <td>\\n            <p class=\\\"ets-word\\\">\" +data.txt+ \"</p>\\n            \";if(data.txt.replace(/\\’/g,\"'\") !== data.translation.translation.replace(/\\’/g,\"'\")){o += \"\\n                <p class=\\\"ets-translation\\\">\" +data.translation.translation+ \"</p>\\n            \";}o += \"\\n        </td>\\n    </tr>\\n</table>  \"; return o; }; });\n",
    "define('school-ui-activity/activity/movie-presentation/screen-word',['jquery',\n    'troopjs-core/component/widget',\n    \"troopjs-utils/deferred\",\n    \"template!./screen-word.html\"], function mpaMain($, Widget, Deferred, tTemplate) {\n    'use strict';\n\n    function render(deferred) {\n        var me = this;\n        me.html(tTemplate, me._content, deferred);\n    }\n\n    return Widget.extend(function (el, module, content) {\n        var me = this;\n\n        me._content = content;\n    }, {\n        'sig/initialize': function (signal, deferred) {\n            var me = this;\n\n            render.call(me, deferred);\n        }\n    });\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/movie-question/movie-question.html',[],function() { return function template(data) { var o = \"\";\tvar data = data || {}; \n\tvar questions = data.content.questions;\no += \"\\n<div class=\\\"ets-act-mvq ets-cf\\\">\\n\\t<div class=\\\"ets-act-mvq-movie\\\">\\n\\t\\t<div class=\\\"ets-movie\\\" data-at-id=\\\"video\\\"><!--<div data-weave=\\\"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\\\"></div>--></div>\\n\\t\\t<span data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464922\\\" data-text-en=\\\"Replay this video segment\\\" class=\\\"ets-act-mvq-replay-blurb ets-none\\\"></span>\\n\\t</div>\\n\\n\\t<div class=\\\"ets-act-mvq-ques\\\">\\n\\t\\t\"; for(var i = 0; i < questions.length; i++) { o += \"\\n\\t\\t<div class=\\\"ets-act-mvq-que ets-none\\\">\\n\\t\\t\\t<span class=\\\"ets-act-mvq-que-title\\\">\" +questions[i].txt+ \"</span>\\n\\t\\t\\t<ul class=\\\"ets-act-mvq-answers\\\" data-at-id=\\\"\" +questions[i]._id+ \"\\\">\\n\\t\\t\\t\\t\"; for(var j = 0; j < questions[i].options.length; j++) { o += \"\\n\\t\\t\\t\\t\\t<li class=\\\"ets-act-mvq-answer ets-table\\\" data-at-id=\\\"\" +questions[i]._id+ \"_\" +questions[i].options[j]._id+ \"\\\" data-option-id=\\\"\" +questions[i].options[j]._id+ \"\\\" data-index=\\\"\" +j+ \"\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\n\\t\\t\\t\\t\\t\\t\\t<span>\" +questions[i].options[j].txt+ \"</span>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</li>\\n\\t\\t\\t\\t\"; } o += \"\\n\\t\\t\\t</ul>\\n\\t\\t</div>\\n\\t\\t\"; } o += \"\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/movie-question/main',[\n\t\"jquery\",\n\t\"poly\",\n\t\"when\",\n\t\"mediaelement-plugin-ef\",\n\t\"school-ui-activity/util/content-converter\",\n\t'school-ui-activity/util/interaction',\n\t\"school-ui-activity/activity/base/main\",\n\t\"template!./movie-question.html\"\n], function MultipleChoiceModule($, poly, when, mejs, converter, Interaction, Widget, tTemplate) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\n\t// declaire variables\n\tvar CLS_ACTIVE = \"ets-active\";\n\tvar CLS_NONE = \"ets-none\";\n\tvar CLS_WRONG = \"ets-wrong\";\n\tvar CLS_CORRECT = \"ets-correct\";\n\tvar CLS_DISABLED = \"ets-disabled\";\n\tvar CLS_MOVIE_REPLAY = \"ets-movie-replay\";\n\n\tvar SEL_MOVIE_CONTAINER = \".ets-act-mvq-movie\";\n\tvar SEL_MOVIE = \".ets-movie\";\n\tvar SEL_MEJS_OVERLAY_PLAY = \".mejs-overlay-play\";\n\tvar SEL_MEJS_TIME_SEPARATOR = \".mejs-time-separator-item\";\n\tvar SEL_QUESTION_CONTAINER = \".ets-act-mvq-ques\";\n\tvar SEL_QUESTION = \".ets-act-mvq-que\";\n\tvar SEL_ANSWER_CONTAINER = \".ets-act-mvq-answers\";\n\tvar SEL_REPLAY_BLURB = \".ets-act-mvq-replay-blurb\";\n\n\tvar DURATION_ANIMATION = 500;\n\tvar DURATION_ANSWER_CORRECT = 1500;\n\tvar DURATION_ANSWER_WRONG = 1000;\n\n\tfunction updateToPlayState() {\n\t\tvar me = this;\n\t\tme.needReplay = false;\n\n\t\tvar $movie = me[$ELEMENT].find(SEL_MOVIE);\n\t\t$movie.removeClass(CLS_MOVIE_REPLAY);\n\t}\n\n\tfunction updateToReplayState() {\n\t\tvar me = this;\n\t\tme.needReplay = true;\n\n\t\tvar $movie = me[$ELEMENT].find(SEL_MOVIE);\n\t\t$movie.addClass(CLS_MOVIE_REPLAY);\n\t}\n\n\t/**\n\t * Added custom callback when video is ready\n\t * @api private\n\t */\n\tfunction onVPSuccess(mediaElement, domObject, player) {\n\t\tvar me = this;\n\n\t\tme.player = player;\n\t\tme.mediaElement = mediaElement;\n\n\t\tme[$ELEMENT].find(SEL_REPLAY_BLURB).appendTo(me[$ELEMENT].find(SEL_MEJS_OVERLAY_PLAY));\n\t\tupdateToPlayState.call(me);\n\n\t\tvar $mediaElement = mejs.$(mediaElement);\n\t\t$mediaElement.on(\"restrict_time_range_ended\", function (evt, rangeInfo) {\n\t\t\tif (!rangeInfo.continueOnEnd) {\n\t\t\t\tvar $currentTimeSeparator = me[$ELEMENT].find(SEL_MEJS_TIME_SEPARATOR + \":eq(\" + me.currentQuestionIndex + \")\");\n\t\t\t\tif (!$currentTimeSeparator.hasClass(CLS_ACTIVE)) {\n\t\t\t\t\t$currentTimeSeparator.addClass(CLS_ACTIVE);\n\t\t\t\t\tshowQuestion.call(me, me.currentQuestionIndex);\n\t\t\t\t}\n\t\t\t\tupdateToReplayState.call(me);\n\t\t\t}\n\t\t});\n\n\t\t$mediaElement.on(\"play\", function () {\n\t\t\tif (me.needReplay) {\n\t\t\t\tme.needReplay = false;\n\t\t\t\tplayer.restartCurrentTimeRange();\n\t\t\t\tmediaElement.play();\n\t\t\t\tupdateToPlayState.call(me);\n\t\t\t}\n\t\t});\n\n\t\t$mediaElement.one(\"ended\", function () {\n\t\t\tplayer.pause();\n\t\t\tplayer.disableRestrictPlayingTimeRange();\n\t\t\tmediaElement.setCurrentTime(0);\n\t\t\tupdateToPlayState.call(me);\n\t\t});\n\t}\n\n\t/**\n\t * show question when time point reach to the cube point\n\t * @api private\n\t */\n\tfunction showQuestion(index) {\n\t\tvar me = this;\n\t\tvar $movieContainer = me[$ELEMENT].find(SEL_MOVIE_CONTAINER);\n\n\t\tvar $questionContainer = me[$ELEMENT].find(SEL_QUESTION_CONTAINER);\n\t\t$questionContainer.addClass(CLS_ACTIVE);\n\t\tvar $currentQuestion = $questionContainer.find(SEL_QUESTION + \":eq(\" + index + \")\");\n\n\t\tif (me.currentQuestionIndex === 0) {\n\t\t\t$currentQuestion.removeClass(CLS_NONE);\n\t\t\t$movieContainer.animate({right: \"150\"}, DURATION_ANIMATION);\n\t\t\t$questionContainer.animate({marginLeft: \"180\"}, DURATION_ANIMATION);\n\t\t} else {\n\t\t\t$currentQuestion.fadeIn();\n\t\t}\n\n\t\t$currentQuestion.find(SEL_ANSWER_CONTAINER).attr(\"data-at-status\", \"shown\");\n\n\t\t//only left current question data in scoring node of json data which benefit for scoring logic\n\t\tvar scoreQuestions = me._json.scoring.questions;\n\t\tscoreQuestions.splice(index + 1);\n\t\tscoreQuestions.slice(0, index);\n\t}\n\n\t/**\n\t * close question when answer correct\n\t * @api private\n\t */\n\tfunction closeQuestion(index) {\n\t\tvar me = this;\n\n\t\t//recover scoring data of original data\n\t\tme._json.scoring.questions = me._source.scoring.questions.slice();\n\n\t\treturn me[$ELEMENT]\n\t\t\t.find(SEL_QUESTION + \":eq(\" + index + \")\").fadeOut()\n\t\t\t.promise()\n\t\t\t.then(function () {\n\t\t\t\tcloseQuestionDone.call(me);\n\t\t\t});\n\t}\n\n\tfunction closeQuestionDone() {\n\t\tvar me = this;\n\n\t\tvar previousQuestionIndex = me.currentQuestionIndex;\n\t\tme.currentQuestionIndex++;\n\n\t\tvar isComplete;\n\t\tvar isSameStopAsPrevious;\n\t\tif (me.currentQuestionIndex === me._json.content.questions.length) {\n\t\t\tme._json.content._isCorrect = true;\n\t\t\tisComplete = true;\n\t\t}\n\t\telse if (me.timeRangeSeparators[previousQuestionIndex] === me.timeRangeSeparators[me.currentQuestionIndex]) {\n\t\t\tisSameStopAsPrevious = true;\n\t\t}\n\n\t\tif (isSameStopAsPrevious) {\n\t\t\tshowQuestion.call(me, me.currentQuestionIndex, me);\n\t\t\tme.player.nextTimeRange();\n\t\t}\n\t\telse {\n\t\t\tupdateToPlayState.call(me);\n\t\t\tif (Math.abs(me.mediaElement.currentTime - me.timeRangeSeparators[previousQuestionIndex]) < 0.1) {\n\t\t\t\tme.player.nextTimeRange();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmejs.$(me.mediaElement).one(\"time_range_changed\", function () {\n\t\t\t\t\tme.player.disableContinueOnEndOfRestrictRange();\n\t\t\t\t});\n\t\t\t\tme.player.enableContinueOnEndOfRestrictRange();\n\t\t\t}\n\t\t\tme.mediaElement.play();\n\n\t\t\t//if last quesiton answer correct, bottom button changes to be next and try again\n\t\t\tisComplete && me.items().completed(true);\n\t\t}\n\t}\n\n\tfunction onAnswerSelected(evt) {\n\t\tvar me = this;\n\n\t\tvar $currentAnswer = $(evt.currentTarget);\n\t\tif ($currentAnswer.hasClass(CLS_WRONG) || $currentAnswer.hasClass(CLS_CORRECT) ||\n\t\t\t$currentAnswer.hasClass(CLS_DISABLED) || me.answerTimeoutHandler) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar currentQuestion = me._json.content.questions[me.currentQuestionIndex];\n\t\tvar optionId = $currentAnswer.data('option-id');\n\t\tvar checkResult = me.checkAnswer(me.currentQuestionIndex, optionId);\n\t\tif (checkResult.correct) {\n\t\t\tcurrentQuestion.pass = true;\n\t\t\t$currentAnswer.addClass(CLS_CORRECT);\n\t\t\tme.answerTimeoutHandler = setTimeout(function () {\n\t\t\t\tcheckResult.promise.then(function () {\n\t\t\t\t\treturn closeQuestion.call(me, me.currentQuestionIndex);\n\t\t\t\t}).then(function () {\n\t\t\t\t\tme.answerTimeoutHandler = 0;\n\t\t\t\t});\n\t\t\t}, DURATION_ANSWER_CORRECT);\n\t\t} else {\n\t\t\t$currentAnswer.addClass(CLS_WRONG);\n\t\t\tme.answerTimeoutHandler = setTimeout(function () {\n\t\t\t\t$currentAnswer.removeClass(CLS_WRONG).addClass(CLS_DISABLED);\n\t\t\t\tme.answerTimeoutHandler = 0;\n\t\t\t}, DURATION_ANSWER_WRONG);\n\t\t}\n\t}\n\n\t/**\n\t * Shuffle origin json data\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn me.html(tTemplate, me._json)\n\t\t\t.tap(initVideoPlayer.bind(me));\n\t}\n\n\tfunction initVideoPlayer() {\n\t\tvar me = this;\n\t\tvar data = me._json.content;\n\n\t\t//video info\n\t\tvar videoInfo = {\n\t\t\tvideo: data.video\n\t\t};\n\n\t\t//options\n\t\tvar features = [\"TimeRanges\", \"Subtitles\", \"SwitchQuality\"];\n\t\tvar subtitles = converter.scriptsToSubtitles(data.scripts);\n\t\tvar timeRangeSeparators = converter.questionsToEndTimes(data.questions);\n\t\tme.timeRangeSeparators = timeRangeSeparators;\n\n\t\tvar options = {\n\t\t\tfeatures: features,\n\t\t\tsubtitles: subtitles,\n\t\t\ttimeRangeSeparators: timeRangeSeparators,\n\t\t\trestrictPlayingTimeRange: true,\n\t\t\tallowPlayingBeforeRestrictRange: true,\n\t\t\tcontinueOnEndOfRestrictRange: false\n\t\t};\n\n\t\t//success callback\n\t\tvar successCallback = function () {\n\t\t\tonVPSuccess.apply(me, arguments);\n\t\t};\n\n\t\t//start to init\n\t\tvar $video = me[$ELEMENT].find(SEL_MOVIE);\n\t\t$video.data({\n\t\t\t\"videoInfo\": videoInfo,\n\t\t\t\"options\": options,\n\t\t\t\"successCallback\": successCallback\n\t\t});\n\t\t$video.attr(\"data-weave\", \"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\");\n\t\t$video.weave();\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\t\tme.currentQuestionIndex = 0;\n\t\tme.answerTimeoutHandler = 0;\n\t\tme.player = null;\n\t\tme.mediaElement = null;\n\t\tme.needReplay = false;\n\t}, {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this;\n\t\t\tme.items().instantFeedback(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tclearTimeout(me.answerTimeoutHandler);\n\t\t},\n\t\t\"checkAnswer\": function (questionIndex, optionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, questionIndex, optionId);\n\t\t\tvar promise = me.publishInteraction(interaction);\n\t\t\treturn {\n\t\t\t\tcorrect: interaction.correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t},\n\t\t\"dom:.ets-act-mvq-answer/click\": function (/*evt*/) {\n\t\t\tonAnswerSelected.apply(this, arguments);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/multiple-choice-media.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\tvar txt = data.content.questions[this._index].txt;\n\tvar medias = data.content.questions[this._index].options;\n\tvar questionAudio = data.content.questions[this._index].audio;\no += \"\\n<div class=\\\"ets-act-mcm ets-act-multiple ets-cf\\\">\\n\\t<div class=\\\"ets-act-mcm-content\\\">\\n\\t\\t<div class=\\\"ets-act-mt-top\\\">\\n\\t\\t\\t\";if (questionAudio) { o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t       data-src=\\\"\" +questionAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t       class=\\\"ets-ap\\\"></audio>\\n\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\";}o += \"\\n\\t\\t\\t<div class=\\\"ets-act-mt-title-container\\\">\\n\\t\\t\\t\\t<span class=\\\"ets-act-mt-title\\\">\" + txt + \"</span>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<ul class=\\\"ets-act-mcm-options\\\">\\n\\t\\t\\t\"; for (var i= 0;i< medias.length;i++) {o += \"\\n\\t\\t\\t\\t<li class=\\\"ets-act-mcm-option\\\" data-at-id=\\\"\" + medias[i]._id + \"\\\" data-answer=\\\"\" + medias[i]._id + \"\\\" data-index=\\\"\" +i+ \"\\\">\\n\\t\\t\\t\\t\\t<img src=\\\"\" + medias[i].image.url + \"\\\" width=\\\"162\\\"  height=\\\"117\\\"/>\\n\\t\\t\\t\\t\\t<span class=\\\"ets-icon-correct-s ets-none\\\"></span>\\n\\t\\t\\t\\t\\t<span class=\\\"ets-icon-incorrect-s ets-none\\\"></span>\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t\"; } o += \"\\n\\t\\t</ul>\\t\\t\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-choice-media/multiple-choice-media',[\n\t'jquery',\n\t'poly',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./multiple-choice-media.html'\n], function MultipleChoiceMediaModule($, poly, Widget, Interaction, tMCMedia) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar CLS_ACT = \"ets-act\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_WRONG = \"ets-wrong\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_MT_LAY = \"ets-act-mt-lay\",\n\t\tCLS_MT_SINGLE_LAY = \"ets-act-mt-single-lay\",\n\t\tCLS_MT_COMMON_LAY = \"ets-act-mt-common-lay\",\n\t\tCLS_MT_AP_CONTENT_GAP = \"ets-act-mt-ap-content-gap\";\n\n\tvar SEL_OPTION = \".ets-act-mcm-option\",\n\t\tSEL_ICON_CORRECT = \".ets-icon-correct-s\",\n\t\tSEL_ICON_INCORRECT = \".ets-icon-incorrect-s\",\n\t\tSEL_MCM_OPTIONS = \".ets-act-mcm-options\",\n\t\tSEL_ACT_MCM_CONTENT = \".ets-act-mcm-content\";\n\n\tvar HUB = 'hub/';\n\tvar TOPIC_MULTIPLE_CHOICE_MEDIA_LOAD = \"activity/template/multiplechoicemedia/load\";\n\n\tvar SHOW_CORRECTNESS_DURATION = 2000;\n\n\t// Constructor\n\tfunction Ctor() {\n\n\t}\n\n\t/**\n\t * Shuffle origin json data\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\t// TODO: Re-render according to this._json\n\t\t// Render widget\n\t\tvar me = this,\n\t\t\toriginData = me._json,\n\t\t\tquetionsData = originData.content.questions[me._index];\n\n\t\tme.optionWrongT = 0;\n\t\tme.selectIsCorrect = false;\n\n\t\tfor (var j = 0; j < quetionsData.options.length; j++) {\n\t\t\tquetionsData.options[j].selected = false;\n\t\t}\n\n\t\treturn me.html(tMCMedia, originData)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init answers remaining\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\tcommonAudio = me._json.references.aud;\n\n\t\tme.answersNum = 1;\n\n\t\tswitch (me._optionsNum) {\n\t\t\tcase 2 :\n\t\t\tcase 4 :\n\t\t\t\t$el.find(SEL_MCM_OPTIONS).addClass(CLS_MT_LAY);\n\t\t\t\tbreak;\n\t\t\tcase 1 :\n\t\t\t\t$el.find(SEL_MCM_OPTIONS).addClass(CLS_MT_SINGLE_LAY);\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\t$el.find(SEL_MCM_OPTIONS).addClass(CLS_MT_COMMON_LAY);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (commonAudio) {\n\t\t\t$el.find(SEL_ACT_MCM_CONTENT).addClass(CLS_MT_AP_CONTENT_GAP);\n\t\t}\n\t}\n\n\tvar methods = ({\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(this._correctTimer);\n\t\t\twindow.clearTimeout(this.optionWrongT);\n\t\t},\n\t\t\"dom:.ets-act-mcm-option/click\": function ($event) {\n\t\t\t//mark json data based on user's chose\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$opTg = $($event.currentTarget),\n\t\t\t\t$options = $el.find(SEL_OPTION),\n\t\t\t\titem = me._item;\n\n\t\t\tif ($opTg.hasClass(CLS_CORRECT) || $opTg.hasClass(CLS_WRONG) || $opTg.hasClass(CLS_DISABLED) || me.optionWrongT != 0 || me.selectIsCorrect) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//non-graded mode\n\t\t\tif (!me._hasScoring) {\n\t\t\t\titem.answered(true);\n\t\t\t\tif (me._index === me._length - 1) {\n\t\t\t\t\titem.completed(true);\n\t\t\t\t\tme._super.nextStep();\n\t\t\t\t}\n\n\t\t\t\tif ($opTg.hasClass(CLS_ACT)) {\n\t\t\t\t\t$opTg.removeClass(CLS_ACT);\n\t\t\t\t\tme.answersNum++;\n\t\t\t\t} else {\n\t\t\t\t\t$options.removeClass(CLS_ACT);\n\t\t\t\t\t$opTg.addClass(CLS_ACT);\n\t\t\t\t\tif (me.answersNum === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.answersNum--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {//graded mode\n\t\t\t\tvar selectOptionId = $opTg.data('answer');\n\t\t\t\tvar correct = me.checkAnswer(selectOptionId);\n\t\t\t\tif (correct) {\n\t\t\t\t\t$opTg.addClass(CLS_CORRECT);\n\t\t\t\t\t$opTg.find(SEL_ICON_CORRECT).removeClass(CLS_NONE);\n\t\t\t\t\tme.selectIsCorrect = true;\n\t\t\t\t} else {\n\t\t\t\t\t$opTg.addClass(CLS_WRONG);\n\t\t\t\t\t$opTg.find(SEL_ICON_INCORRECT).removeClass(CLS_NONE);\n\t\t\t\t\tme.optionWrongT = setTimeout(function () {\n\t\t\t\t\t\t$opTg.toggleClass(CLS_DISABLED + ' ' + CLS_WRONG);\n\t\t\t\t\t\t$opTg.find(SEL_ICON_INCORRECT).addClass(CLS_NONE);\n\t\t\t\t\t\tme.optionWrongT = 0;\n\t\t\t\t\t}, SHOW_CORRECTNESS_DURATION);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcheckAnswer: function (selectOptionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, me._index, selectOptionId);\n\t\t\tvar correct = interaction.correct;\n\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\tif (correct) {\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar isLastQuestion = (me._index === me._length - 1);\n\t\t\t\t\tif (isLastQuestion) {\n\t\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\t}\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t\tme._correctTimer = setTimeout(function () {\n\t\t\t\t\t\tme._super.nextStep();\n\t\t\t\t\t}, isLastQuestion ? 0 : SHOW_CORRECTNESS_DURATION);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t}\n\t});\n\n\tmethods[HUB + TOPIC_MULTIPLE_CHOICE_MEDIA_LOAD] = function (options) {\n\t\tvar me = this;\n\n\t\tme._super = options._super;\n\t\tme._json = me._super._json;\n\t\tme._item = me._super.items();\n\t\tme._index = me._super.index();\n\t\tme._length = me._super.length();\n\t\tme._hasScoring = me._super.hasScoring;\n\t\tme._optionsNum = me._json.content.questions[me._index].options.length;\n\n\t\treturn me.signal('render');\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-media/main.html',[],function() { return function template(data) { var o = \"\";\r\n\tvar data = data || {};\r\n\tvar commonAudio = data.references.aud;\r\no += \"\\r\\n<div class=\\\"ets-act-mt-container\\\">\\r\\n\\t\";if (commonAudio) { o += \"\\r\\n\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t\\t\\t       data-src=\\\"\" +commonAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t\\t\\t       class=\\\"ets-ap ets-com-ap\\\"></audio>\\r\\n\\t\\t\\t</div></div>\\r\\n\\t\\t</div>\\r\\n\\t\";}o += \"\\r\\n\\t<div class=\\\"ets-act-mcm-wrap\\\" data-weave=\\\"school-ui-activity/activity/multiple-choice-media/multiple-choice-media\\\">\\r\\n\\t</div>\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-choice-media/main',[\n\t'jquery',\n\t'underscore',\n\t'when',\n\t'../base/main',\n\t'./multiple-choice-media',\n\t'template!./main.html'\n], function MultipleChoiceModule($, _, when, Widget, MultipleChoiceMedia, tTemplate) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar SEL_ACT_MCM_WRAP = \".ets-act-mcm-wrap\";\n\n\tvar TOPIC_MULTIPLE_CHOICE_MEDIA_LOAD = \"activity/template/multiplechoicemedia/load\";\n\n\tfunction Ctor() {\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle question & media items\n\t * # Random and select specified numbers of options\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\t// TODO: restructuring json data for later rendering\n\t\tif (!data.content.questions) {\n\t\t\tthrow \"the json data can't find questions node in multiple-choice-media\";\n\t\t}\n\n\t\tvar oldData = this._json,\n\t\t\tfilterOpNum = oldData.filterOptions.optionNo,\n\t\t\tisRandom = oldData.filterOptions.random,\n\t\t\twrongNum,\n\t\t\tcorNum,\n\t\t\tquestionsData = oldData.content.questions,\n\t\t\tcontOptions,\n\t\t\tscrOptions,\n\t\t\ttmpSrcOptions,\n\t\t\ttmpConOptions,\n\t\t\ttmpConOptKeys;\n\n\t\tif (!this.hasScoring && isRandom) {\n\t\t\t_.each(questionsData, function (qVal, qInd) {\n\t\t\t\tdata.content.questions[qInd].options = _.shuffle(questionsData[qInd].options);\n\t\t\t\tif (filterOpNum < qVal.options.length) {\n\t\t\t\t\tdata.content.questions[qInd].options.splice(filterOpNum, qVal.options.length - filterOpNum);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvar scoringData = oldData.scoring.questions;\n\t\t\t_.each(scoringData, function (sqValue, sqIndex) {\n\t\t\t\tcontOptions = isRandom ? _.shuffle(questionsData[sqIndex].options) : questionsData[sqIndex].options;\n\t\t\t\tscrOptions = isRandom ? _.shuffle(sqValue.options) : sqValue.options;\n\t\t\t\ttmpSrcOptions = [];\n\t\t\t\ttmpConOptKeys = [];\n\t\t\t\ttmpConOptions = [];\n\t\t\t\tcorNum = 1;\n\t\t\t\twrongNum = filterOpNum - corNum;\n\t\t\t\t_.each(scrOptions, function (opVal) {\n\t\t\t\t\tif ((opVal.selected && corNum && corNum--) || (!opVal.selected && wrongNum && wrongNum--)) {\n\t\t\t\t\t\ttmpSrcOptions.push(opVal);\n\t\t\t\t\t\ttmpConOptKeys.push(opVal._id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t_.each(contOptions, function (val) {\n\t\t\t\t\tif (_.indexOf(tmpConOptKeys, val._id) >= 0) {\n\t\t\t\t\t\ttmpConOptions.push(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdata.scoring.questions[sqIndex].options = tmpSrcOptions;\n\t\t\t\tdata.content.questions[sqIndex].options = tmpConOptions;\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate, this._json)\n\t\t\t\t.then(function () {\n\t\t\t\t\t// After the basic outer html is rendered, we cache some elements\n\t\t\t\t\t// that will be used later.\n\t\t\t\t\tme._$wrapper = me.$element.find(SEL_ACT_MCM_WRAP);\n\t\t\t\t\treturn me.attachATAssetDom(me._json.content.questions);\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._htmlPromise.then(function () {\n\t\t\treturn me.publish(TOPIC_MULTIPLE_CHOICE_MEDIA_LOAD, {\n\t\t\t\t_super: me\n\t\t\t});\n\t\t});\n\t}\n\n\t// ## Member Methods\n\t// Member methods are needed in order to correctly go through the whole process\n\t// of activity, now we are going to implements those members which will be called\n\t// at certain point of the activiting progress.\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.type(Widget.ACT_TYPE.EXERCISE);\n\t\t\tthis.length(this._json.content.questions.length);\n\t\t\tfilterData.call(this, this._json);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().instantFeedback(true);\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/multiple-choice-text.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\tvar txt = data.content.questions[this._index].txt;\n\tvar texts = data.content.questions[this._index].options;\n\tvar questionAudio = data.content.questions[this._index].audio;\n\tvar autoWeightBtnBg = data._layoutType === \"right\";\no += \"\\n<div class=\\\"ets-act-mct ets-act-multiple ets-cf\\\">\\n\\t<div class=\\\"ets-act-mct-content\\\">\\n\\t\\t<div class=\\\"ets-act-mt-top\\\">\\n\\t\\t\\t\";if (questionAudio) { o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t       data-src=\\\"\" +questionAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t       class=\\\"ets-ap\\\"></audio>\\n\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\";}o += \"\\n\\t\\t\\t<div class=\\\"ets-act-mt-title-container\\\">\\n\\t\\t\\t\\t<span class=\\\"ets-act-mt-title\\\">\" + txt + \"</span>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<ul class=\\\"ets-act-mct-options\\\">\\n\\t\\t\\t\"; for (var i = 0;i < texts.length;i++) { o += \"\\n\\t\\t\\t\\t<li class=\\\"ets-act-mct-option\\\" data-at-id=\\\"\" + texts[i]._id + \"\\\" data-answer=\\\"\" + texts[i]._id + \"\\\" data-index=\\\"\" +i+ \"\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\n\\t\\t\\t\\t\\t\\t<span>\" + texts[i].txt + \"</span>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\"; if (autoWeightBtnBg) {o += \"\\n\\t\\t\\t\\t\\t<span class=\\\"ets-act-mct-option-bg\\\"></span>\\n\\t\\t\\t\\t\\t\";} o += \"\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t\"; } o += \"\\n\\t\\t</ul>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-choice-text/multiple-choice-text',[\n\t'jquery',\n\t'poly',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./multiple-choice-text.html'\n], function MultipleChoiceTextModule($, poly, Widget, Interaction, tMCText) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar CLS_ACT = \"ets-act\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_WRONG = \"ets-wrong\",\n\t\tCLS_DISABLED = \"ets-disabled\";\n\n\tvar SEL_OPTION = \".ets-act-mct-option\";\n\n\tvar HUB = 'hub/';\n\tvar TOPIC_MULTIPLE_CHOICE_TEXT_LOAD = \"activity/template/multiplechoicetext/load\";\n\n\tvar SHOW_CORRECTNESS_DURATION = 2000;\n\n\t// Constructor\n\tfunction Ctor() {\n\n\t}\n\n\t/**\n\t * Shuffle origin json data\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\t// TODO: Re-render according to this._json\n\t\t// Render widget\n\t\tvar me = this,\n\t\t\toriginData = me._json,\n\t\t\tquetionsData = originData.content.questions[me._index];\n\n\t\tme.optionWrongT = 0;\n\t\tme.selectIsCorrect = false;\n\n\t\tfor (var j = 0; j < quetionsData.options.length; j++) {\n\t\t\tquetionsData.options[j].selected = false;\n\t\t}\n\n\t\treturn me.html(tMCText, originData)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init answers remaining\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tme.answersNum = 1;\n\t}\n\n\tvar methods = ({\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(this._correctTimer);\n\t\t\twindow.clearTimeout(this.optionWrongT);\n\t\t},\n\t\t\"dom:.ets-act-mct-option/click\": function ($event) {\n\t\t\t//mark json data based on user's chose\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$opTg = $($event.currentTarget),\n\t\t\t\t$options = $el.find(SEL_OPTION),\n\t\t\t\tcurrentQuestion = me._json.content.questions[me._index],\n\t\t\t\titem = me._item;\n\n\t\t\tif ($opTg.hasClass(CLS_CORRECT) || $opTg.hasClass(CLS_WRONG) || $opTg.hasClass(CLS_DISABLED) || me.optionWrongT != 0 || me.selectIsCorrect) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//non-graded mode\n\t\t\tif (!me._hasScoring) {\n\t\t\t\titem.answered(true);\n\t\t\t\tif (me._index === me._length - 1) {\n\t\t\t\t\titem.completed(true);\n\t\t\t\t\tme._super.nextStep();\n\t\t\t\t}\n\n\t\t\t\tif ($opTg.hasClass(CLS_ACT)) {\n\t\t\t\t\t$opTg.removeClass(CLS_ACT);\n\t\t\t\t\tme.answersNum++;\n\t\t\t\t} else {\n\t\t\t\t\t$options.removeClass(CLS_ACT);\n\t\t\t\t\t$opTg.addClass(CLS_ACT);\n\t\t\t\t\tif (me.answersNum === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.answersNum--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {//graded mode\n\t\t\t\tvar selectOptionId = $opTg.data('answer');\n\t\t\t\tvar correct = me.checkAnswer(selectOptionId);\n\t\t\t\tif (correct) {\n\t\t\t\t\t$opTg.addClass(CLS_CORRECT);\n\t\t\t\t\tme.selectIsCorrect = true;\n\t\t\t\t} else {\n\t\t\t\t\t$opTg.addClass(CLS_WRONG);\n\t\t\t\t\tme.optionWrongT = setTimeout(function () {\n\t\t\t\t\t\t$opTg.toggleClass(CLS_DISABLED + ' ' + CLS_WRONG);\n\t\t\t\t\t\tme.optionWrongT = 0;\n\t\t\t\t\t}, SHOW_CORRECTNESS_DURATION);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcheckAnswer: function (selectOptionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, me._index, selectOptionId);\n\t\t\tvar correct = interaction.correct;\n\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\tif (correct) {\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tvar isLastQuestion = (me._index === me._length - 1);\n\t\t\t\t\tif (isLastQuestion) {\n\t\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\t}\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t\tme._correctTimer = setTimeout(function () {\n\t\t\t\t\t\tme._super.nextStep();\n\t\t\t\t\t}, isLastQuestion ? 0 : SHOW_CORRECTNESS_DURATION);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn correct;\n\t\t}\n\t});\n\n\tmethods[HUB + TOPIC_MULTIPLE_CHOICE_TEXT_LOAD] = function (options) {\n\t\tvar me = this;\n\n\t\tme._super = options._super;\n\t\tme._json = me._super._json;\n\t\tme._item = me._super.items();\n\t\tme._index = me._super.index();\n\t\tme._length = me._super.length();\n\t\tme._hasScoring = me._super.hasScoring;\n\t\tme._optionsNum = me._json.content.questions[me._index].options.length;\n\n\t\treturn me.signal('render');\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-choice-text/main.html',[],function() { return function template(data) { var o = \"\";\r\n\tvar data = data || {};\r\n\tvar commonAudio = data.references.aud;\r\no += \"\\r\\n<div class=\\\"ets-act-mt-container\\\">\\r\\n\\t\";if (commonAudio) { o += \"\\r\\n\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t\\t       data-src=\\\"\" +commonAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t\\t       class=\\\"ets-ap ets-mt-com-ap\\\"></audio>\\r\\n\\t\\t</div></div>\\r\\n\\t\";}o += \"\\r\\n\\t<div class=\\\"ets-act-mct-wrap\\\" data-weave=\\\"school-ui-activity/activity/multiple-choice-text/multiple-choice-text\\\">\\r\\n\\t</div>\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-choice-text/main',[\n\t'jquery',\n\t'when',\n\t'underscore',\n\t'../base/main',\n\t'./multiple-choice-text',\n\t'template!./main.html'\n], function MultipleChoiceModule($, when, _, Widget, MultipleChoiceText, tTemplate) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar SEL_ACT_MCT_WRAP = \".ets-act-mct-wrap\",\n\t\tCLS_ACTIVITY_RIGHT = \"ets-act-activity-right\",\n\t\tLAYOUT_TYPE = \"_layoutType\";\n\n\tvar TOPIC_MULTIPLE_CHOICE_TEXT_LOAD = \"activity/template/multiplechoicetext/load\";\n\n\tfunction Ctor($element, name, options) {\n\t\toptions[LAYOUT_TYPE] === \"right\" && $element.addClass(CLS_ACTIVITY_RIGHT);\n\t\tthis._json[LAYOUT_TYPE] = options[LAYOUT_TYPE];\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle Shuffle question & text items\n\t * # Random and select specified numbers of options\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\t// TODO: restructuring json data for later rendering\n\t\tif (!data.content.questions) {\n\t\t\tthrow \"the json data can't find questions node in multiple-choice-text\";\n\t\t}\n\n\t\tvar oldData = this._json,\n\t\t\tfilterOpNum = oldData.filterOptions.optionNo,\n\t\t\tisRandom = oldData.filterOptions.random,\n\t\t\twrongNum,\n\t\t\tcorNum,\n\t\t\tquestionsData = oldData.content.questions,\n\t\t\tcontOptions,\n\t\t\tscrOptions,\n\t\t\ttmpSrcOptions,\n\t\t\ttmpConOptions,\n\t\t\ttmpConOptKeys;\n\n\t\tif (!this.hasScoring && isRandom) {\n\t\t\t_.each(questionsData, function (qVal, qInd) {\n\t\t\t\tdata.content.questions[qInd].options = _.shuffle(questionsData[qInd].options);\n\t\t\t\tif (filterOpNum < qVal.options.length) {\n\t\t\t\t\tdata.content.questions[qInd].options.splice(filterOpNum, qVal.options.length - filterOpNum);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvar scoringData = oldData.scoring.questions;\n\t\t\t_.each(scoringData, function (sqValue, sqIndex) {\n\t\t\t\tcontOptions = isRandom ? _.shuffle(questionsData[sqIndex].options) : questionsData[sqIndex].options;\n\t\t\t\tscrOptions = isRandom ? _.shuffle(sqValue.options) : sqValue.options;\n\t\t\t\ttmpSrcOptions = [];\n\t\t\t\ttmpConOptKeys = [];\n\t\t\t\ttmpConOptions = [];\n\t\t\t\tcorNum = 1;\n\t\t\t\twrongNum = filterOpNum - corNum;\n\t\t\t\t_.each(scrOptions, function (opVal) {\n\t\t\t\t\tif ((opVal.selected && corNum && corNum--) || (!opVal.selected && wrongNum && wrongNum--)) {\n\t\t\t\t\t\ttmpSrcOptions.push(opVal);\n\t\t\t\t\t\ttmpConOptKeys.push(opVal._id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t_.each(contOptions, function (val) {\n\t\t\t\t\tif (_.indexOf(tmpConOptKeys, val._id) >= 0) {\n\t\t\t\t\t\ttmpConOptions.push(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdata.scoring.questions[sqIndex].options = tmpSrcOptions;\n\t\t\t\tdata.content.questions[sqIndex].options = tmpConOptions;\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate, this._json)\n\t\t\t\t.then(function () {\n\t\t\t\t\t// After the basic outer html is rendered, we cache some elements\n\t\t\t\t\t// that will be used later.\n\t\t\t\t\tme._$wrapper = me.$element.find(SEL_ACT_MCT_WRAP);\n\t\t\t\t\treturn me.attachATAssetDom(me._json.content.questions);\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_MULTIPLE_CHOICE_TEXT_LOAD, {\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\n\t// ## Member Methods\n\t// Member methods are needed in order to correctly go through the whole process\n\t// of activity, now we are going to implements those members which will be called\n\t// at certain point of the activiting progress.\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.type(Widget.ACT_TYPE.EXERCISE);\n\t\t\tthis.length(this._json.content.questions.length);\n\n\t\t\tfilterData.call(this, this._json);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().instantFeedback(true);\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\t\t\treturn this.signal('render');\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/multiple-select-media.html',[],function() { return function template(data) { var o = \"\";\r\n\tvar data = data || {};\r\n\tvar txt = data.content.questions[this._index].txt;\r\n\tvar medias = data.content.questions[this._index].options;\r\n\tvar questionAudio = data.content.questions[this._index].audio;\r\no += \"\\r\\n<div class=\\\"ets-act-msm ets-act-multiple ets-cf\\\">\\r\\n\\t<div class=\\\"ets-act-msm-content\\\">\\r\\n\\t\\t<div class=\\\"ets-act-mt-top\\\">\\r\\n\\t\\t\\t\";if (questionAudio) { o += \"\\r\\n\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t\\t\\t           data-src=\\\"\" +questionAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t\\t\\t           class=\\\"ets-ap\\\"></audio>\\r\\n\\t\\t\\t\\t</div></div>\\r\\n\\t\\t\\t\";}o += \"\\r\\n\\t\\t\\t<div class=\\\"ets-act-mt-title-container\\\">\\r\\n\\t\\t\\t\\t<span class=\\\"ets-act-mt-title\\\">\" + txt + \"</span>\\r\\n\\t\\t\\t</div>\\r\\n\\t\\t</div>\\r\\n\\t\\t<ul class=\\\"ets-act-msm-options\\\">\\r\\n\\t\\t\\t\"; for (var i= 0;i< medias.length;i++) {o += \"\\r\\n\\t\\t\\t\\t<li class=\\\"ets-act-msm-option\\\" data-at-id=\\\"\" + medias[i]._id + \"\\\" data-answer=\\\"\" + medias[i]._id + \"\\\" data-index=\\\"\" +i+ \"\\\">\\r\\n\\t\\t\\t\\t\\t<img src=\\\"\" + medias[i].image.url + \"\\\" width=\\\"162\\\"  height=\\\"117\\\"/>\\r\\n\\t\\t\\t\\t\\t<span class=\\\"ets-icon-correct-s ets-none\\\"></span>\\r\\n\\t\\t\\t\\t\\t<span class=\\\"ets-icon-incorrect-s ets-none\\\"></span>\\r\\n\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t\"; } o += \"\\r\\n\\t\\t\\t<div class=\\\"ets-ar ets-clear\\\"></div>\\r\\n\\t\\t</ul>\\r\\n\\t</div>\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-select-media/multiple-select-media',[\n\t'jquery',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./multiple-select-media.html'\n], function MultipleSelectMediaModule($, poly, when, Widget, Interaction, tMSMedia) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar CLS_ACT = \"ets-act\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_WRONG = \"ets-wrong\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_ANIMATE = \"ets-animate\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_MT_LAY = \"ets-act-mt-lay\",\n\t\tCLS_MT_SINGLE_LAY = \"ets-act-mt-single-lay\",\n\t\tCLS_MT_COMMON_LAY = \"ets-act-mt-common-lay\",\n\t\tCLS_MT_AP_CONTENT_GAP = \"ets-act-mt-ap-content-gap\";\n\n\tvar SEL_AR = \".ets-ar\",\n\t\tSEL_OPTION = \".ets-act-msm-option\",\n\t\tSEL_ICON_CORRECT = \".ets-icon-correct-s\",\n\t\tSEL_ICON_INCORRECT = \".ets-icon-incorrect-s\",\n\t\tSEL_MSM_OPTIONS = \".ets-act-msm-options\",\n\t\tSEL_ACT_MSM_CONTENT = \".ets-act-msm-content\";\n\n\tvar SWITCH_ANSWERS_NUM = \"rolling-number/switch-answers-num\";\n\tvar HUB = 'hub/';\n\tvar TOPIC_MULTIPLE_SELECT_MEDIA_LOAD = \"activity/template/multipleselectmedia/load\";\n\n\tvar SHOW_CORRECTNESS_DURATION = 2000;\n\n\t// Constructor\n\tfunction Ctor() {\n\n\t}\n\n\t/**\n\t * Shuffle origin json data\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\t// TODO: Re-render according to this._json\n\t\t// Render widget\n\t\tvar me = this,\n\t\t\toriginData = me._json,\n\t\t\tquetionsData = originData.content.questions[me._index],\n\t\t\tanswersScroNum = 0;\n\n\t\tme.optionWrongT = 0;\n\t\tme.selectIsCorrect = false;\n\t\tme._onlyOneAnswer = false;\n\n\t\tfor (var j = 0; j < quetionsData.options.length; j++) {\n\t\t\tquetionsData.options[j].selected = false;\n\t\t}\n\n\t\tif (me._hasScoring) {\n\t\t\tvar scoringOptions = originData.scoring.questions[me._index].options;\n\t\t\tfor (var i = 0; i < scoringOptions.length; i++) {\n\t\t\t\tif (scoringOptions[i].selected) {\n\t\t\t\t\tanswersScroNum++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tme.answersNum = Math.min(originData.filterOptions.correctOptionNo, answersScroNum);\n\n\t\treturn me.html(tMSMedia, originData);\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init answers remaining\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = me.$element,\n\t\t\tcommonAudio = me._json.references.aud;\n\n\t\tswitch (me._optionsNum) {\n\t\t\tcase 2 :\n\t\t\tcase 4 :\n\t\t\t\t$el.find(SEL_MSM_OPTIONS).addClass(CLS_MT_LAY);\n\t\t\t\tbreak;\n\t\t\tcase 1 :\n\t\t\t\t$el.find(SEL_MSM_OPTIONS).addClass(CLS_MT_SINGLE_LAY);\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\t$el.find(SEL_MSM_OPTIONS).addClass(CLS_MT_COMMON_LAY);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (commonAudio) {\n\t\t\t$el.find(SEL_ACT_MSM_CONTENT).addClass(CLS_MT_AP_CONTENT_GAP);\n\t\t}\n\n\t\tif (!me._hasScoring || me.answersNum === 1) {\n\t\t\t$el.find(SEL_AR).addClass(CLS_NONE);\n\t\t\tme._onlyOneAnswer = true;\n\t\t\treturn when.resolve();\n\t\t} else {\n\t\t\t//Init answers remainning\n\t\t\treturn $el.find(SEL_AR)\n\t\t\t\t.data(\"setting\", {\n\t\t\t\t\tlength: 2\n\t\t\t\t})\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/rolling-number/main(setting)\")\n\t\t\t\t.attr(\"data-at-id\", \"pnl-answer-remaining\")\n\t\t\t\t.weave()\n\t\t\t\t.then(function () {\n\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"reset\", step: me.answersNum });\n\t\t\t\t});\n\t\t}\n\t}\n\n\tvar methods = ({\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(this._correctTimer);\n\t\t\twindow.clearTimeout(this.optionWrongT);\n\t\t},\n\t\t\"dom:.ets-act-msm-option/click\": function ($event) {\n\t\t\t//mark json data based on user's chose\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$opTg = $($event.currentTarget),\n\t\t\t\t$options = $el.find(SEL_OPTION),\n\t\t\t\titem = me._item;\n\n\t\t\tif ($opTg.hasClass(CLS_CORRECT) || $opTg.hasClass(CLS_WRONG) || $opTg.hasClass(CLS_DISABLED) || me.optionWrongT != 0 || me.selectIsCorrect || $opTg.hasClass(CLS_ANIMATE)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//non-graded mode\n\t\t\tif (!me._hasScoring) {\n\t\t\t\t$opTg.toggleClass(CLS_ACT);\n\t\t\t\titem.answered(true);\n\t\t\t\tif (me._index === me._length - 1) {\n\t\t\t\t\titem.completed(true);\n\t\t\t\t\tme._super.nextStep();\n\t\t\t\t}\n\t\t\t} else {//graded mode\n\t\t\t\tvar selectOptionId = $opTg.data('answer');\n\t\t\t\tvar checkResult = me.checkAnswer(selectOptionId);\n\t\t\t\tif (checkResult.correct) {\n\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"sub\", step: 1 });\n\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t}\n\n\t\t\t\t\t$opTg.addClass(CLS_CORRECT);\n\t\t\t\t\t$opTg.find(SEL_ICON_CORRECT).removeClass(CLS_NONE);\n\n\t\t\t\t\tme.answersNum--;\n\t\t\t\t\tif (me.answersNum === 0) {\n\t\t\t\t\t\tme.selectIsCorrect = true;\n\t\t\t\t\t\tvar isLastQuestion = (me._index === me._length - 1);\n\t\t\t\t\t\tif (isLastQuestion) {\n\t\t\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcheckResult.promise.then(function () {\n\t\t\t\t\t\t\tme._item.completed(true);\n\t\t\t\t\t\t\tme._correctTimer = setTimeout(function () {\n\t\t\t\t\t\t\t\tme._super.nextStep();\n\t\t\t\t\t\t\t}, isLastQuestion ? 0 : SHOW_CORRECTNESS_DURATION);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"sub\", step: 1 });\n\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t}\n\n\t\t\t\t\t$opTg.addClass(CLS_WRONG);\n\t\t\t\t\t$opTg.find(SEL_ICON_INCORRECT).removeClass(CLS_NONE);\n\t\t\t\t\tme.optionWrongT = setTimeout(function () {\n\t\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"add\", step: 1 });\n\t\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$opTg.toggleClass(CLS_DISABLED + ' ' + CLS_WRONG);\n\t\t\t\t\t\t$opTg.find(SEL_ICON_INCORRECT).addClass(CLS_NONE);\n\t\t\t\t\t\tme.optionWrongT = 0;\n\t\t\t\t\t}, SHOW_CORRECTNESS_DURATION);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcheckAnswer: function (selectOptionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, me._index, selectOptionId);\n\t\t\tvar correct = interaction.correct;\n\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\treturn {\n\t\t\t\tcorrect: correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t}\n\t});\n\n\tmethods[HUB + TOPIC_MULTIPLE_SELECT_MEDIA_LOAD] = function (options) {\n\t\tvar me = this;\n\n\t\tme._super = options._super;\n\t\tme._json = me._super._json;\n\t\tme._item = me._super.items();\n\t\tme._index = me._super.index();\n\t\tme._length = me._super.length();\n\t\tme._hasScoring = me._super.hasScoring;\n\t\tme._optionsNum = me._json.content.questions[me._index].options.length;\n\n\t\treturn render.call(me)\n\t\t\t.then(onRendered.bind(me));\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-select-media/main.html',[],function() { return function template(data) { var o = \"\";\r\n\tvar data = data || {};\r\n\tvar commonAudio = data.references.aud;\r\no += \"\\r\\n<div class=\\\"ets-act-mt-container\\\">\\r\\n\\t\";if (commonAudio) { o += \"\\r\\n\\t\\t<div class=\\\"ets-table-hack\\\">\\r\\n\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t\\t\\t       data-src=\\\"\" +commonAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t\\t\\t       class=\\\"ets-ap ets-com-ap\\\"></audio>\\r\\n\\t\\t\\t</div></div>\\r\\n\\t\\t</div>\\r\\n\\t\";}o += \"\\r\\n\\t<div class=\\\"ets-act-msm-wrap\\\" data-weave=\\\"school-ui-activity/activity/multiple-select-media/multiple-select-media\\\">\\r\\n\\t</div>\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-select-media/main',[\n\t'jquery',\n\t'underscore',\n\t'when',\n\t'../base/main',\n\t'./multiple-select-media',\n\t'template!./main.html'\n], function MultipleSelectModule($, _, when, Widget, MultipleSelectMedia, tTemplate) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar SEL_ACT_MSM_WRAP = \".ets-act-msm-wrap\";\n\n\tvar TOPIC_MULTIPLE_SELECT_MEDIA_LOAD = \"activity/template/multipleselectmedia/load\";\n\n\tfunction Ctor() {\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle question & media items\n\t * # Random and select specified numbers of options\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\tif (!data.content.questions) {\n\t\t\tthrow \"the json data can't find questions node in multiple-select-media\";\n\t\t}\n\n\t\tvar oldData = this._json,\n\t\t\tfilterOpNum = oldData.filterOptions.optionNo,\n\t\t\twrongNum,\n\t\t\tcorNum,\n\t\t\tquestionsData = oldData.content.questions,\n\t\t\tcontOptions,\n\t\t\tscrOptions,\n\t\t\ttmpSrcOptions,\n\t\t\ttmpConOptions,\n\t\t\ttmpConOptKeys;\n\n\t\tif (!this.hasScoring) {\n\t\t\t_.each(questionsData, function (qVal, qInd) {\n\t\t\t\tdata.content.questions[qInd].options = _.shuffle(questionsData[qInd].options);\n\t\t\t\tif (filterOpNum < qVal.options.length) {\n\t\t\t\t\tdata.content.questions[qInd].options.splice(filterOpNum, qVal.options.length - filterOpNum);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvar scoringData = oldData.scoring.questions;\n\t\t\t_.each(scoringData, function (sqValue, sqIndex) {\n\t\t\t\tcontOptions = _.shuffle(questionsData[sqIndex].options);\n\t\t\t\tscrOptions = _.shuffle(sqValue.options);\n\t\t\t\ttmpSrcOptions = [];\n\t\t\t\ttmpConOptKeys = [];\n\t\t\t\ttmpConOptions = [];\n\t\t\t\tcorNum = oldData.filterOptions.correctOptionNo;\n\t\t\t\twrongNum = filterOpNum - corNum;\n\t\t\t\t_.each(scrOptions, function (opVal) {\n\t\t\t\t\tif ((opVal.selected && corNum && corNum--) || (!opVal.selected && wrongNum && wrongNum--)) {\n\t\t\t\t\t\ttmpSrcOptions.push(opVal);\n\t\t\t\t\t\ttmpConOptKeys.push(opVal._id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t_.each(contOptions, function (val) {\n\t\t\t\t\tif (_.indexOf(tmpConOptKeys, val._id) >= 0) {\n\t\t\t\t\t\ttmpConOptions.push(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdata.scoring.questions[sqIndex].options = tmpSrcOptions;\n\t\t\t\tdata.content.questions[sqIndex].options = tmpConOptions;\n\t\t\t});\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate, this._json)\n\t\t\t\t.then(function () {\n\t\t\t\t\t// After the basic outer html is rendered, we cache some elements\n\t\t\t\t\t// that will be used later.\n\t\t\t\t\tme._$wrapper = me.$element.find(SEL_ACT_MSM_WRAP);\n\t\t\t\t\treturn me.attachATAssetDom(me._json.content.questions);\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\tme.publish(TOPIC_MULTIPLE_SELECT_MEDIA_LOAD, {\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t// ## Member Methods\n\t// Member methods are needed in order to correctly go through the whole process\n\t// of activity, now we are going to implements those members which will be called\n\t// at certain point of the activiting progress.\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.type(Widget.ACT_TYPE.EXERCISE);\n\t\t\tthis.length(this._json.content.questions.length);\n\n\t\t\tfilterData.call(this, this._json);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().instantFeedback(true);\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/multiple-select-text.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\tvar txt = data.content.questions[this._index].txt;\n\tvar texts = data.content.questions[this._index].options;\n\tvar questionAudio = data.content.questions[this._index].audio;\n\tvar autoWeightBtnBg = data._layoutType === \"right\";\no += \"\\n<div class=\\\"ets-act-mst ets-act-multiple ets-cf\\\">\\n\\t<div class=\\\"ets-act-mst-content\\\">\\n\\t\\t<div class=\\\"ets-act-mt-top\\\">\\n\\t\\t\\t\";if (questionAudio) { o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t           data-src=\\\"\" +questionAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t           class=\\\"ets-ap\\\"></audio>\\n\\t\\t\\t\\t</div></div>\\n\\t\\t\\t\";}o += \"\\n\\t\\t\\t<div class=\\\"ets-act-mt-title-container\\\">\\n\\t\\t\\t\\t<span class=\\\"ets-act-mt-title\\\">\" + txt + \"</span>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<ul class=\\\"ets-act-mst-options\\\">\\n\\t\\t\\t\"; for (var i = 0;i < texts.length;i++) { o += \"\\n\\t\\t\\t\\t<li class=\\\"ets-act-mst-option\\\" data-at-id=\\\"\" + texts[i]._id + \"\\\" data-answer=\\\"\" + texts[i]._id + \"\\\" data-index=\\\"\" +i+ \"\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-table-hack\\\">\\n\\t\\t\\t\\t\\t\\t<span>\" + texts[i].txt + \"</span>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\"; if (autoWeightBtnBg) {o += \"\\n\\t\\t\\t\\t\\t<span class=\\\"ets-act-mst-option-bg\\\"></span>\\n\\t\\t\\t\\t\\t\";} o += \"\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t\"; } o += \"\\n\\t\\t\\t<div class=\\\"ets-ar ets-clear\\\"></div>\\n\\t\\t</ul>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-select-text/multiple-select-text',['jquery',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./multiple-select-text.html'\n], function MultipleSelectTextModule($, poly, when, Widget, Interaction, tMSText) {\n\t\"use strict\";\n\n\t// declare variables\n\tvar CLS_ACT = \"ets-act\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_WRONG = \"ets-wrong\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_ANIMATE = \"ets-animate\";\n\n\tvar SEL_AR = \".ets-ar\",\n\t\tSEL_OPTION = \".ets-act-mst-option\";\n\n\tvar LAYOUT_TYPE = \"_layoutType\";\n\n\tvar SWITCH_ANSWERS_NUM = \"rolling-number/switch-answers-num\";\n\tvar HUB = 'hub/';\n\tvar TOPIC_MULTIPLE_SELECT_TEXT_LOAD = \"activity/template/multipleselecttext/load\";\n\n\tvar SHOW_CORRECTNESS_DURATION = 2000;\n\n\t// Constructor\n\tfunction Ctor() {\n\n\t}\n\n\t/**\n\t * Shuffle origin json data\n\t * # Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\t// TODO: Re-render according to this._json\n\t\t// Render widget\n\t\tvar me = this,\n\t\t\toriginData = me._json,\n\t\t\tquetionsData = originData.content.questions[me._index],\n\t\t\tanswersScroNum = 0;\n\n\t\tme.optionWrongT = 0;\n\t\tme.selectIsCorrect = false;\n\t\tme._onlyOneAnswer = false;\n\n\t\tfor (var j = 0; j < quetionsData.options.length; j++) {\n\t\t\tquetionsData.options[j].selected = false;\n\t\t}\n\n\t\tif (me._hasScoring) {\n\t\t\tvar scoringOptions = originData.scoring.questions[me._index].options;\n\t\t\tfor (var i = 0; i < scoringOptions.length; i++) {\n\t\t\t\tif (scoringOptions[i].selected) {\n\t\t\t\t\tanswersScroNum++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tme.answersNum = Math.min(originData.filterOptions.correctOptionNo, answersScroNum);\n\n\t\treturn me.html(tMSText, originData);\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init answers remaining\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = me.$element;\n\n\t\tif (!me._hasScoring || me.answersNum === 1) {\n\t\t\t$el.find(SEL_AR).addClass(CLS_NONE);\n\t\t\tme._onlyOneAnswer = true;\n\t\t\treturn when.resolve();\n\t\t} else {\n\t\t\t//Init answers remainning\n\t\t\treturn $el.find(SEL_AR)\n\t\t\t\t.data(\"setting\", {\n\t\t\t\t\tlength: 2,\n\t\t\t\t\ttype: this._json[LAYOUT_TYPE] === \"right\" ? \"white\" : \"gray\"\n\t\t\t\t})\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/rolling-number/main(setting)\")\n\t\t\t\t.attr(\"data-at-id\", \"pnl-answer-remaining\")\n\t\t\t\t.weave()\n\t\t\t\t.then(function () {\n\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"reset\", step: me.answersNum });\n\t\t\t\t});\n\t\t}\n\t}\n\n\tvar methods = ({\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(this._correctTimer);\n\t\t\twindow.clearTimeout(this.optionWrongT);\n\t\t},\n\t\t\"dom:.ets-act-mst-option/click\": function ($event) {\n\t\t\t//mark json data based on user's chose\n\t\t\tvar me = this,\n\t\t\t\t$el = me.$element,\n\t\t\t\t$opTg = $($event.currentTarget),\n\t\t\t\t$options = $el.find(SEL_OPTION),\n\t\t\t\titem = me._item;\n\n\t\t\tif ($opTg.hasClass(CLS_CORRECT) || $opTg.hasClass(CLS_WRONG) || $opTg.hasClass(CLS_DISABLED) || me.optionWrongT != 0 || me.selectIsCorrect || $opTg.hasClass(CLS_ANIMATE)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//non-graded mode\n\t\t\tif (!me._hasScoring) {\n\t\t\t\t$opTg.toggleClass(CLS_ACT);\n\t\t\t\titem.answered(true);\n\t\t\t\tif (me._index === me._length - 1) {\n\t\t\t\t\titem.completed(true);\n\t\t\t\t\tme._super.nextStep();\n\t\t\t\t}\n\t\t\t} else {//graded mode\n\t\t\t\tvar selectOptionId = $opTg.data('answer');\n\t\t\t\tvar checkResult = me.checkAnswer(selectOptionId);\n\t\t\t\tif (checkResult.correct) {\n\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"sub\", step: 1 });\n\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t}\n\n\t\t\t\t\t$opTg.addClass(CLS_CORRECT);\n\n\t\t\t\t\tme.answersNum--;\n\t\t\t\t\tif (me.answersNum === 0) {\n\t\t\t\t\t\tme.selectIsCorrect = true;\n\t\t\t\t\t\tvar isLastQuestion = (me._index === me._length - 1);\n\t\t\t\t\t\tif (isLastQuestion) {\n\t\t\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcheckResult.promise.then(function () {\n\t\t\t\t\t\t\tme._item.completed(true);\n\t\t\t\t\t\t\tme._correctTimer = setTimeout(function () {\n\t\t\t\t\t\t\t\tme._super.nextStep();\n\t\t\t\t\t\t\t}, isLastQuestion ? 0 : SHOW_CORRECTNESS_DURATION);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"sub\", step: 1 });\n\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t}\n\n\t\t\t\t\t$opTg.addClass(CLS_WRONG);\n\t\t\t\t\tme.optionWrongT = setTimeout(function () {\n\t\t\t\t\t\tif (!me._onlyOneAnswer) {\n\t\t\t\t\t\t\t$options.addClass(CLS_ANIMATE);\n\t\t\t\t\t\t\t$el.find(SEL_AR).trigger(SWITCH_ANSWERS_NUM, { action: \"add\", step: 1 });\n\t\t\t\t\t\t\t$options.removeClass(CLS_ANIMATE);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$opTg.toggleClass(CLS_DISABLED + ' ' + CLS_WRONG);\n\t\t\t\t\t\tme.optionWrongT = 0;\n\t\t\t\t\t}, SHOW_CORRECTNESS_DURATION);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcheckAnswer: function (selectOptionId) {\n\t\t\tvar me = this;\n\t\t\tvar json = me._json;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(json, me._index, selectOptionId);\n\t\t\tvar correct = interaction.correct;\n\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\treturn {\n\t\t\t\tcorrect: correct,\n\t\t\t\tpromise: promise\n\t\t\t};\n\t\t}\n\t});\n\n\tmethods[HUB + TOPIC_MULTIPLE_SELECT_TEXT_LOAD] = function (options) {\n\t\tvar me = this;\n\n\t\tme._super = options._super;\n\t\tme._json = me._super._json;\n\t\tme._item = me._super.items();\n\t\tme._index = me._super.index();\n\t\tme._length = me._super.length();\n\t\tme._hasScoring = me._super.hasScoring;\n\t\tme._optionsNum = me._json.content.questions[me._index].options.length;\n\n\t\treturn render.call(me)\n\t\t\t.then(onRendered.bind(me));\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/multiple-select-text/main.html',[],function() { return function template(data) { var o = \"\";\r\n\tvar data = data || {};\r\n\tvar commonAudio = data.references.aud;\r\no += \"\\r\\n<div class=\\\"ets-act-mt-container\\\">\\r\\n\\t\";if (commonAudio) { o += \"\\r\\n\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\r\\n\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\r\\n\\t\\t           data-src=\\\"\" +commonAudio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\r\\n\\t\\t           class=\\\"ets-ap ets-mt-com-ap\\\"></audio>\\r\\n\\t\\t</div></div>\\r\\n\\t\";}o += \"\\r\\n\\t<div class=\\\"ets-act-mst-wrap\\\" data-weave=\\\"school-ui-activity/activity/multiple-select-text/multiple-select-text\\\">\\r\\n\\t</div>\\r\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/multiple-select-text/main',[\n\t'jquery',\n\t'underscore',\n\t'when',\n\t'../base/main',\n\t'./multiple-select-text',\n\t'template!./main.html'\n], function MultipleSelectModule($, _, when, Widget, MultipleSelectText, tTemplate) {\n\t\"use strict\";\n\n\t// declare variables\n\tvar SEL_ACT_MST_WRAP = \".ets-act-mst-wrap\",\n\t\tCLS_ACTIVITY_RIGHT = \"ets-act-activity-right\",\n\t\tLAYOUT_TYPE = \"_layoutType\";\n\n\tvar TOPIC_MULTIPLE_SELECT_TEXT_LOAD = \"activity/template/multipleselecttext/load\";\n\n\tfunction Ctor($element, name, options) {\n\t\toptions[LAYOUT_TYPE] === \"right\" && $element.addClass(CLS_ACTIVITY_RIGHT);\n\t\tthis._json[LAYOUT_TYPE] = options[LAYOUT_TYPE];\n\t}\n\n\t/**\n\t * Filter source data\n\t * # Shuffle question & text items\n\t * # Random and select specified numbers of options\n\t * @api private\n\t */\n\tfunction filterData(data) {\n\t\t// TODO: restructuring json data for later rendering\n\t\tif (!data.content.questions) {\n\t\t\tthrow \"the json data can't find questions node in multiple-select-text\";\n\t\t}\n\n\t\tvar oldData = this._json,\n\t\t\tfilterOpNum = oldData.filterOptions.optionNo,\n\t\t\tisRandom = oldData.filterOptions.random,\n\t\t\twrongNum,\n\t\t\tcorNum,\n\t\t\tquestionsData = oldData.content.questions,\n\t\t\tcontOptions,\n\t\t\tscrOptions,\n\t\t\ttmpSrcOptions,\n\t\t\ttmpConOptions,\n\t\t\ttmpConOptKeys;\n\n\t\tif (!this.hasScoring && isRandom) {\n\t\t\t_.each(questionsData, function (qVal, qInd) {\n\t\t\t\tdata.content.questions[qInd].options = _.shuffle(questionsData[qInd].options);\n\t\t\t\tif (filterOpNum < qVal.options.length) {\n\t\t\t\t\tdata.content.questions[qInd].options.splice(filterOpNum, qVal.options.length - filterOpNum);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvar scoringData = oldData.scoring.questions;\n\t\t\t_.each(scoringData, function (sqValue, sqIndex) {\n\t\t\t\tcontOptions = isRandom ? _.shuffle(questionsData[sqIndex].options) : questionsData[sqIndex].options;\n\t\t\t\tscrOptions = isRandom ? _.shuffle(sqValue.options) : sqValue.options;\n\t\t\t\ttmpSrcOptions = [];\n\t\t\t\ttmpConOptKeys = [];\n\t\t\t\ttmpConOptions = [];\n\t\t\t\tcorNum = oldData.filterOptions.correctOptionNo;\n\t\t\t\twrongNum = filterOpNum - corNum;\n\t\t\t\t_.each(scrOptions, function (opVal) {\n\t\t\t\t\tif ((opVal.selected && corNum && corNum--) || (!opVal.selected && wrongNum && wrongNum--)) {\n\t\t\t\t\t\ttmpSrcOptions.push(opVal);\n\t\t\t\t\t\ttmpConOptKeys.push(opVal._id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t_.each(contOptions, function (val) {\n\t\t\t\t\tif (_.indexOf(tmpConOptKeys, val._id) >= 0) {\n\t\t\t\t\t\ttmpConOptions.push(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdata.scoring.questions[sqIndex].options = tmpSrcOptions;\n\t\t\t\tdata.content.questions[sqIndex].options = tmpConOptions;\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate, me._json)\n\t\t\t\t.then(function () {\n\t\t\t\t\t// After the basic outer html is rendered, we cache some elements\n\t\t\t\t\t// that will be used later.\n\t\t\t\t\tme._$wrapper = me.$element.find(SEL_ACT_MST_WRAP);\n\t\t\t\t\treturn me.attachATAssetDom(me._json.content.questions);\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_MULTIPLE_SELECT_TEXT_LOAD, {\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t// ## Member Methods\n\t// Member methods are needed in order to correctly go through the whole process\n\t// of activity, now we are going to implements those members which will be called\n\t// at certain point of the activiting progress.\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.type(Widget.ACT_TYPE.EXERCISE);\n\t\t\tthis.length(this._json.content.questions.length);\n\n\t\t\tfilterData.call(this, this._json);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tthis.items().instantFeedback(true);\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/no-template/no-template.html',[],function() { return function template(data) { var o = \"<div>\\n\\t<p>Activity not available now. Please skip this activity to continue.</p>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/no-template/main',[\n\t'school-ui-activity/activity/base/main',\n\t\"template!./no-template.html\"\n], function noTemplateModule(Widget, tTemplate) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.items().completed(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn this.html(tTemplate);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-rpa-wrap\\\" data-weave=\\\"school-ui-activity/activity/role-play-audio/role-play-audio\\\"></div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/role-play-audio/role-play-audio.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\tvar correctRequired = data.correctRequired;\n\tvar data = data.data;\n\t\n\tvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n\\n\\n<div class=\\\"ets-act-rpa\\\">\\n\\t<div class=\\\"ets-act-rpa-bd\\\">\\n\\t\\t<div class=\\\"ets-act-rpa-side\\\">\\n\\t\\t\\t<div class=\\\"ets-act-rpa-questions\\\">\\n\\t\\t\\t\\t<h4><span \" +blurb(150634,\"Question\")+ \"></span> <strong>1</strong> / \" + data.content.questions.length+ \"</h4>\\n\\t\\t\\t\\t\";\n\t\t\t        var items = data.content.questions;\n\t\t\t        for (var i = 0; i < items.length; i++) {\n\t\t\t            writeItem(items[i], i);\n\t\t\t        }\n\t\t\t    o += \"\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-rpa-mic ets-none\\\">\\n\\t\\t\\t\\t<div data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-rpa-main\\\">\\n\\t\\t\\n\\t\\t\\t<div class=\\\"ets-act-rpa-audio-overlay\\\"><span class=\\\"ets-act-rpa-audio-start\\\" data-at-id=\\\"btn-audio-start\\\"></span></div>\\n\\t\\t\\t<div class=\\\"ets-act-rpa-image\\\">\\n\\t\\t\\t\\t\";\n\t\t\t        var items = data.content.questions;\n\t\t\t        for (var i = 0; i < items.length; i++) {\n\t\t\t            writeImage(items[i], i);\n\t\t\t        }\n\t\t\t    o += \"\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-rpa-audio-player\\\">\\n\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t       src=\\\"\" +data.content.questions[0].audio.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t       class=\\\"ets-ap ets-ap-nobar\\\"></audio>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-rpa-audio-control\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-rpa-btn-replay\\\" data-at-id=\\\"replay\\\"><span \" +blurb(467622,\"Replay this segment\")+ \"></span></div>\\n\\t\\t\\t\\t<div class=\\\"ets-act-rpa-btn-skip\\\" data-at-id=\\\"btn-skip\\\"><span \" +blurb(467623,\"Skip this segment\")+ \"></span></div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\n\\t<!-- Activity Summary Start-->\\n\\t<div class=\\\"ets-act-summary-wrap\\\"></div>\\n\\t<!-- Activity Summary End-->\\n</div>\\n\\n\"; function writeItem(data, i) { \n\t\tvar m = i + 1;\n\t\tvar mapIndexes = {\n\t\t\t'0' : 'A',\n\t\t\t'1' : 'B',\n\t\t\t'2' : 'C',\n\t\t\t'3' : 'D',\n\t\t\t'4' : 'E',\n\t\t\t'5' : 'F'\n\t\t};\n\t\to += \"\\n\\t\\t<ul class=\\\"ets-act-rpa-question\\\" data-order=\\\"\" + m+ \"\\\" data-id=\\\"\" + data._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"\\\" data-start-time=\\\"\" + data.startTime+ \"\\\" data-end-time=\\\"\" + data.endTime+ \"\\\">\\n\\t\\t\\t\";\n\t\t        var options = data.options;\n\t\t        for (var j = 0; j < options.length; j++) {\n\t\t        \tvar n = j + 1;o += \"\\n\\t\\t            <li class=\\\"ets-act-rpa-answer ets-nth-\" + n+ \"\\\" data-id=\\\"\" + options[j]._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"_\" + options[j]._id+ \"\\\"><b>\" +mapIndexes[j]+ \"</b><i class=\\\"ets-mark-correct\\\"></i><i class=\\\"ets-mark-incorrect\\\"></i><span>\" + options[j].txt+ \"</span></li>\\n\\t\\t    \";}o += \"\\n\\t\\t\\t\\n\\t\\t</ul>\\n\"; } o += \"\\n\\n\"; function writeImage(data, i) {\n\t\to += \"\\n\\t\\t<img src=\\\"\" +data.image.url+ \"\\\" alt=\\\"\\\" width=\\\"640\\\" height=\\\"360\\\" data-index='\" +i+ \"' />\\n\"; }  return o; }; });\n",
    "define('school-ui-activity/activity/role-play-audio/role-play-audio',[\n\t\"jquery\",\n\t\"jquery.ui\",\n\t\"poly\",\n\t\"troopjs-ef/component/widget\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./role-play-audio.html\",\n\t\"school-ui-shared/enum/rating-source-type\",\n\t\"school-ui-activity/shared/asr/asr-service-message-type\",\n\t\"school-ui-activity/shared/asr/asr-ui-states\"\n], function ($, ui$, poly, Widget, Scoring, Interaction, tTemplate, ratingSouceType, MSGType, ASRUIStatus) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_ACT_BODY = \".ets-act-rpa-bd\",\n\t\tSEL_AUDIO = \".ets-ap\",\n\t\tSEL_MAIN = \".ets-act-rpa-main\",\n\t\tSEL_SIDE = \".ets-act-rpa-side\",\n\t\tSEL_IMAGE = \".ets-act-rpa-image img\",\n\t\tSEL_QUESTION = \".ets-act-rpa-question\",\n\t\tSEL_ANSWER = \".ets-act-rpa-answer\",\n\t\tSEL_BTN_START = \".ets-act-rpa-audio-start\",\n\t\tSEL_BTN_REPLAY = \".ets-act-rpa-btn-replay\",\n\t\tSEL_BTN_SKIP = \".ets-act-rpa-btn-skip\",\n\t\tSEL_QUESTIONS = \".ets-act-rpa-questions\",\n\t\tSEL_QUESTION_ACTIVE = \".ets-act-rpa-question.ets-active\",\n\t\tSEL_QUESTION_NUMBER = \".ets-act-rpa-questions h4 strong\",\n\t\tSEL_ASR_CONTAINER = \".ets-act-rpa-mic > div\",\n\t\tSEL_RPA_MIC = \".ets-act-rpa-mic\",\n\t\tSEL_AUDIO_CONTROL = \".ets-act-rpa-audio-control\",\n\t\tSEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\",\n\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_NONE = \"ets-none\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\t\tCLS_SELECT_MODE = \"ets-select-mode\",\n\t\tFEEDBACK_DELAY = 1500,\n\t\tasrMode = ratingSouceType[\"ASR_SPEAKING\"];\n\n\tvar HUB_ASR_SET = \"asr/ui/setting\",\n\t\tHUB_REMOVE_INTRO_TITLE = \"dispose/reference\";\n\n\tvar CCL_ASR_ENABLED = 'ccl!\"school.asr.enabled\"';\n\n\tfunction Ctor() {\n\t\tvar me = this;\n\t\tme.answerMode = {};\n\t\tme.questionShown = false;\n\t\tme.isLastQuestion = false;\n\t\tme.isFirstQuestion = true;\n\t\tme.totalQuestions = {};\n\t\t/*Total question numbers*/\n\t\tme.currentQuestion = {};\n\t\t/*Current question*/\n\t\tme.currentQuestionIndex = {};\n\t\tme.$currentQuestion = {};\n\t\tme.correctCount = {};\n\t\tme.incorrectCount = {};\n\t\tme.correctRequired = {};\n\t\tme.asrDisabled = false;\n\t\tme.timeouts = [];\n\t}\n\n\t// # Render\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\tthis.totalQuestions = this._json.content.questions.length;\n\n\t\tif (!data) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\tme.correctRequired = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * me.totalQuestions);\n\t\tme.correctCount = 0;\n\t\tme.incorrectCount = me.totalQuestions;\n\n\t\treturn this.html(tTemplate, {data: data, correctRequired: me.correctRequired})\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * 1. Enable droppable\n\t * 2. Bind double click strip\n\t * 3. Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = this.$element,\n\t\t\tenableASRSwitch = !me.asrDisabled\n\t\t\t\t&& !me._json.asrDisabled\n\t\t\t\t&& window.location.search.indexOf(\"non-asr\") < 0;\n\n\t\tme.publish(HUB_ASR_SET, onASRRecognized.bind(me), me._json.content.questions[0], {\n\t\t\tasrFallbackType: \"SELECT\",\n\t\t\tasrFallbackCb: switchAnswerMode.bind(me, \"SELECT\"),\n\t\t\tneedResetASRFailedTimes: true,\n\t\t\tasrEnableTip: true\n\t\t});\n\n\t\t//Bind Start\n\t\t$el.find(SEL_BTN_START).click(function () {\n\t\t\tstart.call(me);\n\t\t});\n\n\t\t$el.find(SEL_BTN_REPLAY).click(function () {\n\t\t\tif (!me.audioControlEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\treplay.call(me);\n\t\t});\n\n\t\t$el.find(SEL_BTN_SKIP).click(function () {\n\t\t\tif (!me.audioControlEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\tif (me.isNonGraded()) {\n\t\t\t\tmoveOn.call(me);\n\t\t\t} else {\n\t\t\t\tme.publishSkipInteraction(me.currentQuestionIndex);\n\t\t\t}\n\t\t});\n\n\t\t//Init Activity\n\t\tinit.call(me);\n\n\t\tif (!enableASRSwitch) {\n\t\t\tswitchAnswerMode.call(me, \"SELECT\");\n\t\t\tasrMode = ratingSouceType[\"ASR_SELECTION\"];\n\t\t}\n\n\t\t//Set current question index\n\t\tme.currentQuestionIndex = 0;\n\n\t\t//Set current question\n\t\tme.currentQuestion = me._json.content.questions[me.currentQuestionIndex];\n\n\t\t//Set current question jquery object\n\t\tme.$currentQuestion = $el.find(SEL_QUESTION_ACTIVE);\n\n\t\t$el.find(SEL_IMAGE).filter(function () {\n\t\t\treturn $(this).data(\"index\") == 0;\n\t\t}).show();\n\t}\n\n\tfunction onASRRecognized(asrResult) {\n\t\tvar me = this;\n\n\t\tif (asrResult && asrResult.length > 0) {\n\t\t\tvar $selectedOption = $(me.$currentQuestion.find(SEL_ANSWER).filter(function () {\n\t\t\t\treturn $(this).data('id').split('_')[1] == asrResult[0].index;\n\t\t\t})[0]);\n\t\t\tvar optionId = $selectedOption.data('id');\n\n\t\t\t//For non-grade activities, no check answer, mark correct and move on.\n\t\t\tif (me.isNonGraded()) {\n\t\t\t\t$selectedOption.addClass(CLS_CORRECT);\n\t\t\t\tdisableRecord.call(me);\n\n\t\t\t\tvar moveOnTimeout = setTimeout(function () {\n\t\t\t\t\tmoveOn.call(me);\n\t\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t\tme.timeouts.push(moveOnTimeout);\n\n\t\t\t\tme.correctCount++;\n\t\t\t\tme.incorrectCount--;\n\t\t\t} else if (asrResult[0].score < 100) {\n\t\t\t\t//below threshold\n\t\t\t\tshowASRMessage.call(me, \"INCORRECT_PRONUN\");\n\t\t\t} else {\n\t\t\t\tvar correct = me.checkAnswer(me.currentQuestionIndex, optionId);\n\t\t\t\tme.displayInteractionResult(correct, $selectedOption, asrResult);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction switchAnswerMode(mode) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tswitch (mode) {\n\t\t\tcase 'ASR':\n\t\t\t\tme.answerMode = 'ASR';\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).removeClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_QUESTIONS).removeClass(CLS_SELECT_MODE);\n\t\t\t\t$el.find(SEL_QUESTIONS + \" li\").unbind('click');\n\t\t\t\tme._super.scoringType('asr');\n\t\t\t\tbreak;\n\t\t\tcase 'SELECT':\n\t\t\tdefault:\n\t\t\t\tme.answerMode = 'SELECT';\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).addClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_QUESTIONS).addClass(CLS_SELECT_MODE);\n\t\t\t\t$el.find(SEL_QUESTIONS + \" li\").click(function () {\n\t\t\t\t\tonClickOption.call(me, $(this));\n\t\t\t\t});\n\t\t\t\tme._super.scoringType('default');\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction onClickOption($selectedOption) {\n\t\tvar me = this;\n\n\t\tif ($selectedOption.hasClass(CLS_DISABLED) || me.optionFreezed) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar optionId = $selectedOption.data(\"id\");\n\n\t\tdisableAudioControl.call(me);\n\n\t\t//For non-grade activities, no check answer, mark correct and move on.\n\t\tif (me.isNonGraded()) {\n\t\t\tme.optionFreezed = true;\n\t\t\t$selectedOption.addClass(CLS_CORRECT);\n\t\t\tdisableRecord.call(me);\n\n\t\t\tvar moveOnTimeout = setTimeout(function () {\n\t\t\t\tmoveOn.call(me);\n\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\tme.timeouts.push(moveOnTimeout);\n\n\t\t\tme.correctCount++;\n\t\t\tme.incorrectCount--;\n\t\t} else {\n\t\t\tvar correct = me.checkAnswer(me.currentQuestionIndex, optionId);\n\t\t\tme.displayInteractionResult(correct, $selectedOption);\n\t\t}\n\t}\n\n\tfunction showQuestion() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (!me.questionShown) {\n\t\t\tme.questionShown = true;\n\t\t\tme.optionFreezed = false;\n\t\t\tif (me.isFirstQuestion) {\n\t\t\t\t$el.find(SEL_MAIN).animate({left: \"0\"}, 300);\n\t\t\t\t$el.find(SEL_SIDE).animate({right: \"0\"}, 300);\n\t\t\t\tme.isFirstQuestion = false;\n\t\t\t} else {\n\t\t\t\t//in ie8 , animation fadeout or fadein will cause png image has a black border.\n\t\t\t\t(navigator.userAgent.indexOf('MSIE 8.0') > 0) ?\n\t\t\t\t\t$el.find(SEL_SIDE).show() :\n\t\t\t\t\t$el.find(SEL_SIDE).fadeIn('slow');\n\t\t\t}\n\t\t\t$el.find(SEL_RPA_MIC).show();\n\t\t}\n\t}\n\n\tfunction hideQuestion() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (me.questionShown) {\n\t\t\tme.questionShown = false;\n\t\t\t//in ie8 , animation fadeout or fadein will cause png image has a black border.\n\t\t\t(navigator.userAgent.indexOf('MSIE 8.0') > 0) ?\n\t\t\t\t$el.find(SEL_SIDE).hide() :\n\t\t\t\t$el.find(SEL_SIDE).fadeOut('slow');\n\t\t\t$el.find(SEL_RPA_MIC).hide();\n\t\t}\n\t}\n\n\tfunction onSectionEnd() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (me.currentQuestionIndex < me.totalQuestions) {\n\t\t\t$el.find(SEL_AUDIO).trigger('player/pause');\n\t\t\tenableRecord.call(me);\n\t\t\tshowQuestion.call(me);\n\t\t\tenableAudioControl.call(me);\n\t\t\t//for automation test\n\t\t\t$el.find(SEL_QUESTION + \"[data-order=\" + (me.currentQuestionIndex + 1) + \"]\")\n\t\t\t\t.attr(\"data-at-status\", \"shown\");\n\t\t} else {\n\t\t\tme.actStarted = false;\n\t\t\tdisableAudioControl.call(me);\n\t\t}\n\n\t}\n\n\tfunction enableAudioControl() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\t$el.find(SEL_AUDIO_CONTROL).removeClass(CLS_DISABLED);\n\t\tme.audioControlEnabled = true;\n\t}\n\n\tfunction disableAudioControl() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_AUDIO_CONTROL).addClass(CLS_DISABLED);\n\t\tme.audioControlEnabled = false;\n\t}\n\n\tfunction enableRecord() {\n\t\tthis.publish(\"asr/enable\");\n\n\t}\n\n\tfunction disableRecord() {\n\t\tthis.publish(\"asr/disable\");\n\n\t}\n\n\tfunction start() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_AUDIO).trigger('player/play');\n\t\t$el.find(SEL_BTN_START).hide(0);\n\t\tme.actStarted = true;\n\n\t\tdisableRecord.call(me);\n\t\tdisableAudioControl.call(me);\n\t\thideQuestion.call(me);\n\t}\n\n\tfunction replay() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (!me.audioControlEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tme.$currentQuestion = $el.find(SEL_QUESTION_ACTIVE);\n\t\t$el.find(SEL_AUDIO).trigger('player/play', me.currentQuestion.audio.url);\n\n\t\tdisableRecord.call(me);\n\t\tdisableAudioControl.call(me);\n\t}\n\n\n\tfunction moveOn() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (me.currentQuestionIndex + 1 < me.totalQuestions) {\n\t\t\tme.currentQuestionIndex++;\n\t\t\tme.currentQuestion = me._json.content.questions[me.currentQuestionIndex];\n\n\t\t\tvar nextQuestionTimeout = setTimeout(function () {\n\t\t\t\t//Moveon to next question\n\t\t\t\tme.$currentQuestion.removeClass(CLS_ACTIVE).next().addClass(CLS_ACTIVE);\n\t\t\t\tme.$currentQuestion = me.$currentQuestion.next();\n\n\t\t\t\t$el.find(SEL_QUESTION_NUMBER).text(me.currentQuestionIndex + 1);\n\t\t\t}, 500);\n\n\t\t\tme.timeouts.push(nextQuestionTimeout);\n\n\t\t\t$el.find(SEL_IMAGE).hide();\n\t\t\t$el.find(SEL_IMAGE).filter(function () {\n\t\t\t\treturn $(this).data(\"index\") == me.currentQuestionIndex;\n\t\t\t}).show();\n\n\t\t\t$el.find(SEL_AUDIO).trigger('player/play', me.currentQuestion.audio.url);\n\t\t\tme.publish(HUB_ASR_SET,\n\t\t\t\tonASRRecognized.bind(me),\n\t\t\t\tme.currentQuestion,\n\t\t\t\t{\n\t\t\t\t\tasrEnableTip: true\n\t\t\t\t});\n\n\t\t\tdisableRecord.call(me);\n\t\t\tdisableAudioControl.call(me);\n\t\t\thideQuestion.call(me);\n\n\t\t} else {\n\t\t\tvar nonGraded = me.isNonGraded();\n\n\t\t\tvar passed;\n\t\t\tif (nonGraded) {\n\t\t\t\tpassed = true;\n\t\t\t} else {\n\t\t\t\tpassed = me.correctCount >= me.correctRequired;\n\t\t\t\tme._json.content._isCorrect = passed;\n\t\t\t}\n\n\t\t\t$el.find(SEL_ACT_BODY).fadeOut(300, function () {\n\t\t\t\t$(this).addClass(CLS_NONE).removeAttr('style');\n\t\t\t\tviewSummary.call(me, passed);\n\t\t\t});\n\n\n\t\t\tif (nonGraded) {\n\t\t\t\tme._item.answered(true);\n\t\t\t} else {\n\t\t\t\tme._item.completed(true);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar init = function () {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\t$el.find(SEL_QUESTION).removeClass(CLS_ACTIVE);\n\t\t$el.find(SEL_QUESTION + \":first\").addClass(CLS_ACTIVE);\n\t\t$el.find(SEL_BTN_START).show(0);\n\t\t$el.find(SEL_QUESTION_NUMBER).text(\"1\");\n\t\tthis.actStarted = false;\n\t\tdisableRecord.call(me);\n\n\t\tdisableAudioControl.call(me);\n\t};\n\n\tfunction viewSummary(passed) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t//Render activity summary widget\n\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t.data(\"settings\",\n\t\t\t{\n\t\t\t\tpassed: passed,\n\t\t\t\tcorrectNum: me.correctCount,\n\t\t\t\tskippedNum: me.incorrectCount,\n\t\t\t\tpassNum: me.correctRequired\n\t\t\t})\n\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t.weave();\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\t}\n\n\tfunction showASRMessage(msgType) {\n\t\tthis.publish(\"asr/show/message\", MSGType[msgType]);\n\t}\n\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\t//Clear timeouts when finalize\n\t\t\t$.each(this.timeouts, function (i, timeout) {\n\t\t\t\twindow.clearTimeout(timeout);\n\t\t\t});\n\t\t},\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\treturn me.query(CCL_ASR_ENABLED)\n\t\t\t\t.spread(function (asrEnabledCcl) {\n\t\t\t\t\tme.asrDisabled = !(asrEnabledCcl && asrEnabledCcl.value === 'true');\n\t\t\t\t});\n\t\t},\n\t\t\"hub/activity/template/rpa/load\": function (parent, options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\n\t\t\tme._super = parent;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(true);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tvar me = this;\n\t\t\tif (!state || !me.actStarted) return;\n\t\t\tswitch (state) {\n\t\t\t\tcase ASRUIStatus.RECORDING:\n\t\t\t\tcase ASRUIStatus.PROCESSING:\n\t\t\t\tcase ASRUIStatus.PREPARING:\n\t\t\t\tcase ASRUIStatus.DISABLE:\n\t\t\t\t\tdisableAudioControl.call(me);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tenableAudioControl.call(me);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t\"hub/rating/sourceType\": function () {\n\t\t\treturn [asrMode];\n\t\t},\n\t\t\"dom:.ets-ap/media/ended\": function() {\n\t\t\tonSectionEnd.call(this);\n\t\t},\n\t\tcheckAnswer: function (questionIndex, optionId) {\n\t\t\tvar me = this;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(me._json, questionIndex, optionId);\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\tif (interaction.correct) {\n\t\t\t\tme.correctCount++;\n\t\t\t\tme.incorrectCount--;\n\n\t\t\t\tvar moveOnTimeout = setTimeout(function () {\n\t\t\t\t\tpromise.then(function(){\n\t\t\t\t\t\tmoveOn.call(me);\n\t\t\t\t\t});\n\t\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t\tme.timeouts.push(moveOnTimeout);\n\t\t\t}\n\n\t\t\treturn interaction.correct;\n\t\t},\n\t\tpublishSkipInteraction: function(questionIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.questions[questionIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\tme._super.publishInteraction(interaction)\n\t\t\t\t.then(function () {\n\t\t\t\t\tmoveOn.call(me);\n\t\t\t\t});\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $selectedOption, asrResult) {\n\t\t\tvar me = this;\n\n\t\t\tme.optionFreezed = true;\n\n\t\t\tif (correct) {\n\t\t\t\t$selectedOption.addClass(CLS_CORRECT);\n\t\t\t\tdisableRecord.call(me);\n\t\t\t} else {\n\t\t\t\t$selectedOption.addClass(CLS_INCORRECT);\n\n\t\t\t\tif (asrResult && !asrResult._hasError) {\n\t\t\t\t\tshowASRMessage.call(me, \"INCORRECT_ANSWER\");\n\t\t\t\t}\n\n\t\t\t\tvar retryTimeout = setTimeout(function () {\n\t\t\t\t\t$selectedOption.removeClass(CLS_INCORRECT).addClass(CLS_DISABLED);\n\t\t\t\t\tme.optionFreezed = false;\n\n\t\t\t\t\tif (!asrResult) {\n\t\t\t\t\t\tenableAudioControl.call(me);\n\t\t\t\t\t}\n\t\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t\tme.timeouts.push(retryTimeout);\n\t\t\t}\n\t\t},\n\t\tisNonGraded: function () {\n\t\t\treturn this._super.type() == 3;\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "define('school-ui-activity/activity/role-play-audio/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'template!./main.html',\n\t'./role-play-audio'\n], function activityTemplateModule($, when, Widget, tTemplate, rpa) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_RPA_LOAD = \"activity/template/rpa/load\";\n\n\tfunction Ctor() {\n\t\tthis.scoringType(Widget.SCORING_TYPE.ASR);\n\t\tthis._htmlPromise = null;\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_RPA_LOAD, me, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.hasScoring || this.type(Widget.ACT_TYPE.PRACTICE);\n\t\t\tthis.items().instantFeedback(true);\n\n\t\t\tthis.length(1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/role-play-video/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-rpv-wrap\\\" data-weave=\\\"school-ui-activity/activity/role-play-video/role-play-video\\\"></div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/role-play-video/role-play-video.html',[],function() { return function template(data) { var o = \"\";\n\tvar data = data || {};\n\tvar correctRequired = data.correctRequired;\n\tvar data = data.data;\n\t\n\tvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n\\n\\n<div class=\\\"ets-act-rpv\\\">\\n\\t<div class=\\\"ets-act-rpv-bd\\\">\\n\\t\\t<div class=\\\"ets-act-rpv-side\\\">\\n\\t\\t\\t<div class=\\\"ets-act-rpv-questions\\\">\\n\\t\\t\\t\\t<h4><span \" +blurb(150634,\"Question\")+ \"></span> <strong>1</strong> / \" + data.content.questions.length+ \"</h4>\\n\\t\\t\\t\\t\";\n\t\t\t        var items = data.content.questions;\n\t\t\t        for (var i = 0; i < items.length; i++) {\n\t\t\t            writeItem(items[i], i);\n\t\t\t        }\n\t\t\t    o += \"\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-act-rpv-mic ets-none\\\">\\n\\t\\t\\t\\t<div data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-rpv-main\\\">\\n\\t\\t\\t<div class=\\\"ets-act-vp-wrap\\\"><!--<div data-weave=\\\"school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)\\\"></div>--></div>\\n\\t\\t\\t<div class=\\\"ets-act-rpv-video-control\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-rpv-btn-replay\\\" data-at-id=\\\"replay\\\"><span \" +blurb(467622,\"Replay this segment\")+ \"></span></div>\\n\\t\\t\\t\\t<div class=\\\"ets-act-rpv-btn-skip\\\" data-at-id=\\\"btn-skip\\\"><span \" +blurb(467623,\"Skip this segment\")+ \"></span></div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\t\\n\\t<!-- Activity Summary Start-->\\n\\t<div class=\\\"ets-act-summary-wrap\\\"></div>\\n\\t<!-- Activity Summary End-->\\n\\t\\n</div>\\n\\n\"; function writeItem(data, i) { \n\t\tvar m = i + 1;\n\t\tvar mapIndexes = {\n\t\t\t'0' : 'A',\n\t\t\t'1' : 'B',\n\t\t\t'2' : 'C',\n\t\t\t'3' : 'D',\n\t\t\t'4' : 'E',\n\t\t\t'5' : 'F'\n\t\t};\n\t\to += \"\\n\\t\\t<ul class=\\\"ets-act-rpv-question\\\" data-order=\\\"\" + m+ \"\\\" data-id=\\\"\" + data._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"\\\" data-start-time=\\\"\" + data.startTime+ \"\\\" data-end-time=\\\"\" + data.endTime+ \"\\\">\\n\\t\\t\\t\";\n\t\t        var options = data.options;\n\t\t        for (var j = 0; j < options.length; j++) {\n\t\t        \tvar n = j + 1;o += \"\\n\\t\\t            <li class=\\\"ets-act-rpv-answer ets-nth-\" + n+ \"\\\" data-id=\\\"\" + options[j]._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"_\" + options[j]._id+ \"\\\"><b>\" +mapIndexes[j]+ \"</b><i class=\\\"ets-mark-correct\\\"></i><i class=\\\"ets-mark-incorrect\\\"></i><span>\" + options[j].txt+ \"</span></li>\\n\\t\\t    \";}o += \"\\n\\t\\t\\t\\n\\t\\t</ul>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/role-play-video/role-play-video',[\n\t\"jquery\",\n\t\"jquery.ui\",\n\t\"jquery.easing\",\n\t\"poly\",\n\t\"troopjs-ef/component/widget\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"mediaelement-plugin-ef\",\n\t\"school-ui-activity/util/activity-util\",\n\t\"school-ui-shared/enum/rating-source-type\",\n\t\"school-ui-activity/shared/asr/asr-service-message-type\",\n\t\"school-ui-activity/shared/asr/asr-ui-states\",\n\t\"school-ui-activity/util/content-converter\",\n\t\"template!./role-play-video.html\"\n], function (\n\t$,\n\tui$,\n\teasing,\n\tpoly,\n\tWidget,\n\tScoring,\n\tInteraction,\n\tmejs,\n\tUtil,\n\tratingSouceType,\n\tMSGType,\n\tASRUIStatus,\n\tconverter,\n\ttTemplate\n) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_ACT_BODY = \".ets-act-rpv-bd\";\n\tvar SEL_MAIN = \".ets-act-rpv-main\";\n\tvar SEL_SIDE = \".ets-act-rpv-side\";\n\tvar SEL_QUESTION = \".ets-act-rpv-question\";\n\tvar SEL_ANSWER = \".ets-act-rpv-answer\";\n\tvar SEL_QUESTIONS = \".ets-act-rpv-questions\";\n\tvar SEL_QUESTION_NUMBER = \".ets-act-rpv-questions h4 strong\";\n\tvar SEL_ASR_CONTAINER = \".ets-act-rpv-mic > div\";\n\tvar SEL_RPV_MIC = \".ets-act-rpv-mic\";\n\tvar SEL_VIDEO_CONTROL = \".ets-act-rpv-video-control\";\n\tvar SEL_ACT_SUMMARY_PLACEHOLDER = \".ets-act-summary-wrap\";\n\tvar SEL_VIDEO_CONTAINER = \".ets-act-vp-wrap\";\n\n\tvar CLS_CORRECT = \"ets-correct\";\n\tvar CLS_INCORRECT = \"ets-incorrect\";\n\tvar CLS_DISABLED = \"ets-disabled\";\n\tvar CLS_NONE = \"ets-none\";\n\tvar CLS_ACTIVE = \"ets-active\";\n\tvar CLS_SELECT_MODE = \"ets-select-mode\";\n\tvar CLS_VP_PLAYED = \"ets-vp-played\";\n\n\tvar FEEDBACK_DELAY = 1500;\n\tvar MOVEON_DELAY = 500;\n\tvar DURATION_ANIMATION = 300;\n\n\tvar CCL_ASR_ENABLED = 'ccl!\"school.asr.enabled\"';\n\n\tvar HUB_ASR_SET = \"asr/ui/setting\",\n\t\tHUB_REMOVE_INTRO_TITLE = \"dispose/reference\",\n\t\tasrMode = ratingSouceType[\"ASR_SPEAKING\"];\n\n\tfunction Ctor() {\n\t\tvar me = this;\n\t\tme.answerMode = {};\n\t\tme.questionShown = false;\n\t\tme.outOfLastQuestion = false;\n\t\tme.firstQuestionShown = false;\n\t\tme.questionCount = 0;\n\t\tme.currentQuestion = {};\n\t\tme.currentQuestionIndex = -1;\n\t\tme.$currentQuestion = {};\n\t\tme.correctCount = {};\n\t\tme.incorrectCount = {};\n\t\tme.correctRequired = {};\n\t\tme.mediaElement = {};\n\t\tme.asrDisabled = false;\n\t\tme.timeouts = [];\n\t\tme.actStarted = false;\n\t}\n\n\t// # Render\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\tthis.questionCount = this._json.content.questions.length;\n\n\t\tif (!data) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\tme.correctRequired = Math.ceil(Scoring.ASR_MIN_PASSED_QUESTIONS_RATE * me.questionCount);\n\t\tme.correctCount = 0;\n\t\tme.incorrectCount = me.questionCount;\n\n\t\treturn this.html(tTemplate, {data: data, correctRequired: me.correctRequired})\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * 1. Enable droppable\n\t * 2. Bind double click strip\n\t * 3. Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\tenableASRSwitch = !me.asrDisabled\n\t\t\t\t&& !me._json.asrDisabled\n\t\t\t\t&& window.location.search.indexOf(\"non-asr\") < 0;\n\n\t\tme.publish(HUB_ASR_SET, onASRRecognized.bind(me), me._json.content.questions[0], {\n\t\t\tasrFallbackType: \"SELECT\",\n\t\t\tasrEnableSwitch: enableASRSwitch,\n\t\t\tasrFallbackCb: switchAnswerMode.bind(me, \"SELECT\"),\n\t\t\tneedResetASRFailedTimes: true,\n\t\t\tasrEnableTip: true\n\t\t});\n\n\t\tinitVideoPlayer.call(me);\n\n\t\t//Init Activity\n\t\tdisableRecord.call(me);\n\t\tdisableVideoControl.call(me);\n\n\t\tif (!enableASRSwitch) {\n\t\t\tswitchAnswerMode.call(me, \"SELECT\");\n\t\t\tasrMode = ratingSouceType[\"ASR_SELECTION\"];\n\t\t}\n\n\t\tpointToQuestion.call(me, 0);\n\t}\n\n\tfunction pointToQuestion(index) {\n\t\tvar me = this;\n\t\tvar $el = me.$element;\n\n\t\tme.currentQuestionIndex = index;\n\t\tme.currentQuestion = me._json.content.questions[index];\n\t\tme.$currentQuestion = $el.find(SEL_QUESTION + \":eq(\" + index + \")\");\n\t\t$el.find(SEL_QUESTION_NUMBER).text(index + 1);\n\t}\n\n\tfunction onASRRecognized(asrResult) {\n\t\tvar me = this;\n\n\t\tif (asrResult && asrResult.length > 0) {\n\t\t\tvar $selectedOption = $(me.$currentQuestion.find(SEL_ANSWER).filter(function () {\n\t\t\t\treturn $(this).data('id').split('_')[1] == asrResult[0].index;\n\t\t\t})[0]);\n\t\t\tvar optionId = $selectedOption.data('id');\n\n\t\t\tif (asrResult[0].score < 100) {\n\t\t\t\t//below threshold\n\t\t\t\tshowASRMessage.call(me, \"INCORRECT_PRONUN\");\n\t\t\t} else {\n\t\t\t\tvar correct = me.checkAnswer(me.currentQuestionIndex, optionId);\n\t\t\t\tme.displayInteractionResult(correct, $selectedOption, asrResult);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction switchAnswerMode(mode) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tswitch (mode) {\n\t\t\tcase 'ASR':\n\t\t\t\tme.answerMode = 'ASR';\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).removeClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_QUESTIONS).removeClass(CLS_SELECT_MODE);\n\t\t\t\t$el.find(SEL_QUESTIONS + \" li\").unbind('click');\n\t\t\t\tme._super.scoringType('asr');\n\t\t\t\tbreak;\n\t\t\tcase 'SELECT':\n\t\t\tdefault:\n\t\t\t\tme.answerMode = 'SELECT';\n\t\t\t\t$el.find(SEL_ASR_CONTAINER).addClass(CLS_NONE);\n\t\t\t\t$el.find(SEL_QUESTIONS).addClass(CLS_SELECT_MODE);\n\t\t\t\t$el.find(SEL_QUESTIONS + \" li\").click(function () {\n\t\t\t\t\tonClickOption.call(me, $(this));\n\t\t\t\t});\n\t\t\t\tme._super.scoringType('default');\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction onClickOption($selectedOption) {\n\t\tvar me = this;\n\t\tif ($selectedOption.hasClass(CLS_DISABLED) || me.optionFreezed) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar optionId = $selectedOption.data(\"id\");\n\n\t\tdisableVideoControl.call(me);\n\n\t\tvar correct = me.checkAnswer(me.currentQuestionIndex, optionId);\n\t\tme.displayInteractionResult(correct, $selectedOption);\n\t}\n\n\tfunction showQuestion() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (!me.questionShown) {\n\t\t\tme.questionShown = true;\n\t\t\tme.optionFreezed = false;\n\t\t\tme.$currentQuestion.addClass(CLS_ACTIVE).siblings().removeClass(CLS_ACTIVE);\n\n\t\t\tif (!me.firstQuestionShown) {\n\t\t\t\tme.firstQuestionShown = true;\n\t\t\t\t$el.find(SEL_MAIN).animate({left: \"0\"}, DURATION_ANIMATION);\n\t\t\t\t$el.find(SEL_SIDE).animate({right: \"0\"}, DURATION_ANIMATION);\n\t\t\t} else {\n\t\t\t\t$el.find(SEL_SIDE).fadeIn(DURATION_ANIMATION);\n\t\t\t}\n\n\t\t\t$el.find(SEL_RPV_MIC).show();\n\t\t}\n\t}\n\n\tfunction hideQuestion() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (me.questionShown) {\n\t\t\tme.questionShown = false;\n\t\t\t$el.find(SEL_SIDE).fadeOut(DURATION_ANIMATION);\n\t\t\t$el.find(SEL_RPV_MIC).hide();\n\t\t}\n\t}\n\n\tfunction initVideoPlayer() {\n\t\tvar me = this;\n\t\tvar $el = this.$element;\n\t\tvar data = me._json.content || {};\n\n\t\t//video info\n\t\tvar videoInfo = {\n\t\t\tvideo: data.video\n\t\t};\n\n\t\t//options\n\t\tvar features = ['TimeRanges'];\n\t\tvar timeRanges = converter.questionsToTimeRanges(data.questions);\n\t\tvar options = {\n\t\t\tfeatures: features,\n\t\t\ttimeRanges: timeRanges,\n\t\t\trestrictPlayingTimeRange: true,\n\t\t\tallowPlayingBeforeRestrictRange: true,\n\t\t\tcontinueOnEndOfRestrictRange: true\n\t\t};\n\n\t\t//success callback\n\t\tvar successCallback = function () {\n\t\t\tonVideoPlayerReady.apply(me, arguments);   //this: instance of widget \"video-player/main\"\n\t\t};\n\n\t\t//start to init\n\t\tvar $video = $el.find(SEL_VIDEO_CONTAINER);\n\t\t$video.data({\n\t\t\t'videoInfo': videoInfo,\n\t\t\t'options': options,\n\t\t\t'successCallback': successCallback\n\t\t});\n\t\t$video.attr('data-weave', 'school-ui-shared/widget/video-player/main(videoInfo, options, successCallback)');\n\t\t$video.weave();\n\t}\n\n\tfunction onVideoPlayerReady(mediaElement, domObject, player) {\n\t\tvar me = this;\n\t\tvar $el = me.$element;\n\n\t\tme.mediaElement = mediaElement;\n\t\tme.$mediaElement = mejs.$(mediaElement);\n\t\tme.player = player;\n\n\t\tme.$mediaElement.one(\"play\", function () {\n\t\t\tme.actStarted = true;\n\t\t\tplayer.options.clickToPlayPause = false;\n\t\t\t$el.find(SEL_VIDEO_CONTAINER).addClass(CLS_VP_PLAYED);\n\t\t});\n\n\t\tme.$mediaElement.on(\"restrict_time_range_ended\", function () {\n\t\t\tme.mediaElement.pause();\n\t\t\tonTimeRangeEnded.call(me);\n\t\t});\n\t}\n\n\tfunction onTimeRangeEnded() {\n\t\tvar me = this;\n\n\t\tif (!me.outOfLastQuestion) {\n\t\t\tenableRecord.call(me);\n\t\t\tenableVideoControl.call(me);\n\t\t\tshowQuestion.call(me);\n\t\t\tupdateAutomationTestStatus.call(me);\n\t\t}\n\t}\n\n\tfunction updateAutomationTestStatus() {\n\t\tvar me = this;\n\t\t//for automation test\n\t\tme.$element.find(SEL_QUESTION + \"[data-order=\" + (me.currentQuestionIndex + 1) + \"]\")\n\t\t\t.attr(\"data-at-status\", \"shown\");\n\t}\n\n\tfunction enableVideoControl() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_VIDEO_CONTROL).removeClass(CLS_DISABLED);\n\t\tme.videoControlEnabled = true;\n\t}\n\n\tfunction disableVideoControl() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t$el.find(SEL_VIDEO_CONTROL).addClass(CLS_DISABLED);\n\t\tme.videoControlEnabled = false;\n\t}\n\n\tfunction enableRecord() {\n\t\tthis.publish(\"asr/enable\");\n\t}\n\n\tfunction disableRecord() {\n\t\tthis.publish(\"asr/disable\");\n\t}\n\n\tfunction replay() {\n\t\tvar me = this;\n\t\tme.player.goToTimeRange(me.currentQuestionIndex, true);\n\t\tme.mediaElement.play();\n\t\tdisableRecord.call(me);\n\t\tdisableVideoControl.call(me);\n\t}\n\n\tfunction moveOn() {\n\t\tvar me = this;\n\n\t\tdisableRecord.call(me);\n\t\tdisableVideoControl.call(me);\n\t\thideQuestion.call(me);\n\n\t\tif (me.currentQuestionIndex + 1 < me.questionCount) {\n\t\t\tvar nextQuestionTimeoutHandler = setTimeout(function () {   //wait for animation done\n\t\t\t\tpointToQuestion.call(me, me.currentQuestionIndex + 1);  //me.currentQuestionIndex will be increased\n\n\t\t\t\tme.publish(\n\t\t\t\t\tHUB_ASR_SET,\n\t\t\t\t\tonASRRecognized.bind(me),\n\t\t\t\t\tme.currentQuestion,\n\t\t\t\t\t{\n\t\t\t\t\t\tasrEnableTip: true\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tme.player.goToTimeRange(me.currentQuestionIndex);\n\t\t\t\tme.mediaElement.play();\n\t\t\t}, MOVEON_DELAY);\n\t\t\tme.timeouts.push(nextQuestionTimeoutHandler);\n\t\t} else {\n\t\t\tme.outOfLastQuestion = true;\n\t\t\tif (me.mediaElement.currentTime === 0 || me.mediaElement.duration - me.mediaElement.currentTime < 1) {\n\t\t\t\t//View summary if video ends, or close to end\n\t\t\t\tactivityComplete.call(me);\n\t\t\t} else {\n\t\t\t\t//otherwise play rest of the video\n\t\t\t\tme.$mediaElement.one('ended', function () {\n\t\t\t\t\tactivityComplete.call(me);\n\t\t\t\t});\n\n\t\t\t\tvar playRestTimeout = setTimeout(function () {\n\t\t\t\t\thideQuestion.call(me);\n\t\t\t\t\tme.mediaElement.play();\n\t\t\t\t}, MOVEON_DELAY);\n\t\t\t\tme.timeouts.push(playRestTimeout);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction viewSummary(passed) {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\t$el.find(SEL_ACT_BODY).fadeOut(DURATION_ANIMATION, function () {\n\t\t\t$(this).addClass(CLS_NONE).removeAttr('style');\n\n\t\t\t//Render activity summary widget\n\t\t\t$el.find(SEL_ACT_SUMMARY_PLACEHOLDER)\n\t\t\t\t.data(\"settings\",\n\t\t\t\t{\n\t\t\t\t\tpassed: passed,\n\t\t\t\t\tcorrectNum: me.correctCount,\n\t\t\t\t\tskippedNum: me.incorrectCount,\n\t\t\t\t\tpassNum: me.correctRequired\n\t\t\t\t})\n\t\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/summary/main(settings)\")\n\t\t\t\t.weave();\n\t\t});\n\n\t\t//Remove instructions on feedback page\n\t\tme.publish(HUB_REMOVE_INTRO_TITLE);\n\t}\n\n\tfunction activityComplete() {\n\t\tvar me = this;\n\t\tvar passed = me.correctCount >= me.correctRequired;\n\t\tme._json.content._isCorrect = passed;\n\t\tviewSummary.call(me, passed);\n\t\tme._item.completed(true);\n\t\tme.actStarted = false;\n\t}\n\n\tfunction showASRMessage(msgType) {\n\t\tthis.publish(\"asr/show/message\", MSGType[msgType]);\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\t//Clear timeouts when finalize\n\t\t\t$.each(this.timeouts, function (i, timeout) {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t});\n\t\t},\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\treturn \tme.query(CCL_ASR_ENABLED).spread(function (asrEnabledCcl) {\n\t\t\t\tme.asrDisabled = !(asrEnabledCcl && asrEnabledCcl.value === 'true');\n\t\t\t});\n\t\t},\n\t\t\"dom/destroy\": function () {\n\t\t\tvar me = this;\n\t\t\t// Clear video flash\n\t\t\t// See SPC-382, SU-2323 and SU-2316 for old issues relative to clearing video\n\t\t\t// See SPC-5835 for issue after migration to troopjs2\n\t\t\tUtil.clearVideo(me.mediaElement);\n\t\t},\n\t\t/**\n\t\t * End of clear video flash.\n\t\t */\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tvar me = this;\n\t\t\tif (state && me.actStarted) {\n\t\t\t\t// this.state(state);\n\t\t\t\tswitch (state) {\n\t\t\t\t\tcase ASRUIStatus.RECORDING:\n\t\t\t\t\tcase ASRUIStatus.PROCESSING:\n\t\t\t\t\tcase ASRUIStatus.PREPARING:\n\t\t\t\t\tcase ASRUIStatus.DISABLE:\n\t\t\t\t\t\tdisableVideoControl.call(me);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tenableVideoControl.call(me);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"hub/rating/sourceType\": function () {\n\t\t\treturn [asrMode];\n\t\t},\n\n\t\t\"dom:.ets-act-rpv-btn-replay/click\": function () {\n\t\t\tvar me = this;\n\t\t\tif (me.videoControlEnabled) {\n\t\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\t\treplay.call(me);\n\t\t\t}\n\t\t},\n\t\t\"dom:.ets-act-rpv-btn-skip/click\": function () {\n\t\t\tvar me = this;\n\t\t\tif (me.videoControlEnabled) {\n\t\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\t\tme.publishSkipInteraction(me.currentQuestionIndex);\n\t\t\t}\n\t\t},\n\t\t\"hub/activity/template/rpv/load\": function (parent, options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\n\t\t\tme._super = parent;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(true);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\tcheckAnswer: function (questionIndex, optionId) {\n\t\t\tvar me = this;\n\t\t\tvar interaction = Interaction.makeChoiceInteraction(me._json, questionIndex, optionId);\n\t\t\tvar promise = me._super.publishInteraction(interaction);\n\n\t\t\tif (interaction.correct) {\n\t\t\t\tme.correctCount++;\n\t\t\t\tme.incorrectCount--;\n\n\t\t\t\tvar moveOnTimeout = setTimeout(function () {\n\t\t\t\t\tpromise.then(function(){\n\t\t\t\t\t\tmoveOn.call(me);\n\t\t\t\t\t});\n\t\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t\tme.timeouts.push(moveOnTimeout);\n\t\t\t}\n\n\t\t\treturn interaction.correct;\n\t\t},\n\t\tpublishSkipInteraction: function (questionIndex) {\n\t\t\tvar me = this;\n\t\t\tvar questionId = me._json.content.questions[questionIndex]._id;\n\t\t\tvar interaction = Interaction.makeSkipInteraction(questionId);\n\t\t\tme._super.publishInteraction(interaction)\n\t\t\t\t.then(function () {\n\t\t\t\t\tmoveOn.call(me);\n\t\t\t\t});\n\t\t},\n\t\tdisplayInteractionResult: function (correct, $selectedOption, asrResult) {\n\t\t\tvar me = this;\n\n\t\t\tme.optionFreezed = true;\n\n\t\t\tif (correct) {\n\t\t\t\t$selectedOption.addClass(CLS_CORRECT);\n\t\t\t\tdisableRecord.call(me);\n\t\t\t} else {\n\t\t\t\t$selectedOption.addClass(CLS_INCORRECT);\n\n\t\t\t\tif (asrResult && !asrResult._hasError) {\n\t\t\t\t\tshowASRMessage.call(me, \"INCORRECT_ANSWER\");\n\t\t\t\t}\n\n\t\t\t\tvar retryTimeout = setTimeout(function () {\n\t\t\t\t\t$selectedOption.removeClass(CLS_INCORRECT).addClass(CLS_DISABLED);\n\t\t\t\t\tme.optionFreezed = false;\n\n\t\t\t\t\tif (!asrResult) {\n\t\t\t\t\t\tenableVideoControl.call(me);\n\t\t\t\t\t}\n\t\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t\tme.timeouts.push(retryTimeout);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "define('school-ui-activity/activity/role-play-video/main',[\n\t'jquery',\n\t'underscore',\n\t'../base/main',\n\t'template!./main.html',\n\t'when',\n\t'./role-play-video'\n], function activityTemplateModule($, _, Widget, tTemplate, when, rpv) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_RPV_LOAD = \"activity/template/rpv/load\";\n\n\treturn Widget.extend(function Ctor() {\n\t\tthis.scoringType(Widget.SCORING_TYPE.ASR);\n\t\tthis._htmlPromise = null;\n\t}, {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.length(1);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tvar me = this;\n\n\t\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t\t// to make sure there is no code error when render() is called after finalization.\n\t\t\tif (!me.$element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._htmlPromise) {\n\t\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t\t}\n\n\t\t\treturn me._htmlPromise.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_RPV_LOAD, me, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: me._json\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/sequencing-image.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-sqi\\\">\\n\\t\";\n\tvar data = data || {};\n\tif (data.references.aud) { o += \"\\n\\t<div class=\\\"ets-act-sqi-side\\\">\\n\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t           data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t           class=\\\"ets-ap\\\"></audio>\\n\\t\\t</div></div>\\n\\t</div>\\n\\t\";}o += \"\\n\\t<div class=\\\"ets-act-sqi-main\\\">\\n\\t\\t<div class=\\\"ets-act-sqi-droparea\\\">\\n\\t\\t\";\n\t        var items = data.content.sequences;\n\t        for (var i = 1; i <= items.length; i++) {\n\t        \tif (i < items.length) {o += \"\\n\\t            <div class=\\\"ets-act-sqi-droppable ets-nth-\" + i+ \"\\\"></div>\\n\\t            \";} else {o += \"\\n\\t            <div class=\\\"ets-act-sqi-droppable ets-nth-\" + i+ \" ets-last\\\"></div>\\n\\t            \";}o += \"\\n\\t    \";}o += \"\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-sqi-originarea\\\">\\n\\t\\t\\t\";\n\t\t        var items = data.content.sequences;\n\t\t        for (var i = 1; i <= items.length; i++) {\n\t\t        \twriteItem(items[i - 1]);\n\t\t\t\t}\n\t\t    o += \"\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\"; function writeItem(data) { o += \"\\n\\t\\t<div class=\\\"ets-act-sqi-origin ets-nth-\" + i+ \"\\\">\\n\\t\\t\\t<div id=\\\"\" + data._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"\\\" class=\\\"ets-act-sqi-item ets-nth-\" + i+ \"\\\">\\n\\t\\t\\t\\t\"; if (data.image) { o += \"\\n\\t\\t\\t\\t\\t<img src=\\\"\" + data.image.url+ \"\\\" />\\n\\t\\t\\t\\t\";} else {o += \"\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\";}o += \"\\n\\t\\t\\t\\t<div class=\\\"ets-act-act-sqi-item-cover\\\"></div>\\n\\t\\t\\t\\t<i class=\\\"ets-icon-correct-s\\\"></i>\\n\\t\\t\\t\\t<i class=\\\"ets-icon-incorrect-s\\\"></i>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/sequencing-image/sequencing-image',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./sequencing-image.html'\n], function ($, ui$, $uiTouchPunch, Widget, Interaction, tTemplate) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_DROP_AREA = \".ets-act-sqi-droparea\",\n\t\tSEL_ORIGIN_AREA = \".ets-act-sqi-originarea\",\n\t\tSEL_ACTIVITY_BODY = \".ets-act-bd\",\n\t\tSEL_DROPPABLE = \".ets-act-sqi-droppable\",\n\t\tSEL_ITEM = \".ets-act-sqi-item\",\n\t\tSEL_ITEM_CORRECT = \".ets-correct\",\n\t\tSEL_ITEM_INCORRECT = \".ets-incorrect\",\n\t\tSEL_ACTIVE = \".ets-active\",\n\t\tSEL_ORIGIN = \".ets-act-sqi-origin\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tCLS_HOVER = \"ets-hover\",\n\t\tCLS_DROPPED = \"ets-dropped\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\t\tFEEDBACK_DELAY = 1500;\n\n\tfunction Ctor() {\n\n\t}\n\n\t// # Render\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\tif (!data) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\treturn this.html(tTemplate, data)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * 1. Enable droppable\n\t * 2. Bind double click strip\n\t * 3. Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\t//Enable droppable\n\t\tenableDroppable.call(me);\n\t}\n\n\n\t/**\n\t * Return if same jquery element\n\t * @api private\n\t */\n\tfunction isSamejQueryElement(a, b) {\n\t\treturn (a.length === b.length && a.length === a.filter(b).length);\n\t}\n\n\t/**\n\t * Return if same jquery element\n\t * @api private\n\t */\n\tfunction enableDroppable() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\t$el.find(SEL_DROPPABLE).droppable({\n\t\t\taccept: SEL_ITEM,\n\t\t\thoverClass: CLS_HOVER,\n\t\t\tover: function (event, ui) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tif ($me.find(SEL_ITEM).length > 0) {\n\t\t\t\t\tvar $existingItem = $me.find(SEL_ITEM);\n\t\t\t\t\tif (!isSamejQueryElement($existingItem, $(ui.draggable)) && !$existingItem.hasClass(CLS_CORRECT)) {\n\t\t\t\t\t\t//$existingItem.transition({ x: '-15px', y: '15px', opacity: \"0.6\", easing: 'snap'});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$me.removeClass(CLS_HOVER);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t//\tvar $me = $(this);\n\t\t\t//\tvar $existingItem = $me.find(SEL_ITEM);\n\t\t\t//\tif ($existingItem.length > 0) {\n\t\t\t//\t\t$existingItem.transition({ x: '0px', y: '0px', opacity: \"1\", easing: 'snap' });\n\t\t\t//\t}\n\t\t\t},\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tvar $me = $(this);\n\t\t\t\tif ($me.find(SEL_ITEM).length > 0) {\n\t\t\t\t\tvar $existingItem = $me.find(SEL_ITEM);\n\t\t\t\t\tif (!$existingItem.hasClass(CLS_CORRECT)) {\n\t\t\t\t\t\t$($el.find(SEL_ORIGIN_AREA).find(SEL_ORIGIN).filter(function () {\n\t\t\t\t\t\t\treturn $(this).html() == false\n\t\t\t\t\t\t})[0]).append($existingItem);\n\n\t\t\t\t\t\t$(this).append($(ui.draggable).removeAttr(\"style\").addClass(CLS_DROPPED));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$(this).append($(ui.draggable).removeAttr(\"style\").addClass(CLS_DROPPED));\n\t\t\t\t}\n\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t\trefreshOriginArea.call(me);\n\t\t\t}\n\t\t});\n\n\t\t$el.find(SEL_ORIGIN).droppable({\n\t\t\taccept: SEL_ITEM,\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tif ($(this).find(SEL_ITEM).length > 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$(this).append($(ui.draggable));\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t\trefreshOriginArea.call(me);\n\t\t\t}\n\t\t});\n\n\t\t$el.find(SEL_ITEM).draggable({\n\t\t\tcancel: SEL_ITEM_CORRECT + \", \" + SEL_ITEM_INCORRECT,\n\t\t\tcontainment: SEL_ACTIVITY_BODY,\n\t\t\tactiveClass: SEL_ACTIVE,\n\t\t\trevert: true,\n\t\t\tstart: function () {\n\t\t\t\t$(this).addClass(CLS_ACTIVE);\n\t\t\t},\n\t\t\tstop: function () {\n\t\t\t\t$(this).removeAttr(\"style\");\n\t\t\t\t$(this).removeClass(CLS_ACTIVE);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction refreshDropArea() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\tif ($el.find(SEL_DROPPABLE + \":empty\").length < 1) {\n\t\t\tonSequenceComplete.call(me);\n\t\t} else {\n\t\t\tme._item.answered(false);\n\t\t}\n\t}\n\n\tfunction refreshOriginArea() {\n\t\tvar $el = this.$element;\n\t\tvar $items = $el.find(SEL_ORIGIN_AREA).find(SEL_ITEM);\n\t\t$items.removeAttr(\"style\").removeClass(CLS_DROPPED + \" \" + CLS_INCORRECT);\n\t}\n\n\n\t/**\n\t * Return incorrect items\n\t * 1. Move strips start from the first incorrect strip back to origin area\n\t * 2. Refresh origin area\n\t * 3. Disable check answer\n\t * @api private\n\t */\n\tfunction returnIncorrectItems() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\tvar $incorrectItems = $el.find(SEL_DROP_AREA).find(SEL_ITEM_INCORRECT);\n\n\t\t$($el.find(SEL_ORIGIN_AREA).find(SEL_ORIGIN).filter(function () {\n\t\t\treturn $(this).html() == false\n\t\t})).each(function (i) {\n\t\t\t$(this).append($incorrectItems[i]);\n\t\t});\n\n\t\t//$(SEL_ORIGIN_AREA).append($incorrectItems);\n\n\t\trefreshOriginArea.call(me);\n\n\t\tme._item.answered(false);\n\t}\n\n\t/**\n\t * When all strips are in drop area\n\t * 1. Update item's position property based on ui sequence\n\t * 2. Enable check answer\n\t * @api private\n\t */\n\tfunction onSequenceComplete() {\n\t\tvar me = this;\n\t\tme._item.answered(true);\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/activity/template/sqi/load\": function (options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\t\t\tme._super = options._super;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(false);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar allCorrect = true;\n\t\t\tvar $el = this.$element;\n\n\t\t\tvar $items = $el.find(SEL_DROP_AREA).find(SEL_ITEM);\n\t\t\tme._json.scoring.sequences.forEach(function (expectedItem, index) {\n\t\t\t\tvar $item = $items.eq(index);\n\t\t\t\tvar correct = expectedItem._id === $item.attr('id');\n\t\t\t\t$item.addClass(correct ? CLS_CORRECT : CLS_INCORRECT);\n\t\t\t\tallCorrect = allCorrect && correct;\n\t\t\t});\n\n\t\t\twindow.setTimeout(function () {\n\t\t\t\treturnIncorrectItems.call(me)\n\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\t//only one sequence, there is not specific id\n\t\t\tvar promise = me._super.publishInteraction(\n\t\t\t\tInteraction.makeSequencingInteraction(allCorrect, \"SeqImgId\"));\n\n\t\t\tpromise.then(function () {\n\t\t\t\tif (allCorrect) {\n\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\tme._item.answered(true);\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t} else {\n\t\t\t\t\tme._item.answered(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-image/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"et-act-sqi-wrap\\\" data-weave=\\\"school-ui-activity/activity/sequencing-image/sequencing-image\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sequencing-image/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'./sequencing-image',\n\t'template!./main.html'\n], function activityTemplateModule($, when, Widget, sqi, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_SQI_LOAD = \"activity/template/sqi/load\";\n\n\tfunction Ctor() {\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_SQI_LOAD, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.length(1);\n\t\t},\n\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-spv\\\">\\n\\t\";\n\tvar data = data || {};\n\tif (data.references.aud) { o += \"\\n\\t<div class=\\\"ets-act-spv-side\\\">\\n\\t\\t<div class=\\\"ets-act-spv-side-bd\\\">\\n\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t       data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t       class=\\\"ets-ap\\\"></audio>\\n\\t\\t\\t</div></div>\\n\\t\\t</div>\\n\\t</div>\\n\\t\";}o += \"\\n\\t<div class=\\\"ets-act-spv-main\\\">\\n\\t\\t<div class=\\\"ets-act-spv-list-wrap\\\">\\n\\t\\t    <ul class=\\\"ets-act-spv-list\\\">\\n\\t\\t    \";\n\t\t        var items = data.content.sequences;\n\t\t        for (var i = 0; i < items.length; i++) {\n\t\t            writeItem(items[i]);\n\t\t        }\n\t\t    o += \"\\n\\t\\t    </ul>\\n\\t    </div>\\n\\t</div>\\n</div>\\n\"; function writeItem(data) { \n\tif (data.isLock) {\n\t\tdata.lockClass = \"ets-correct ets-locked\";\n\t} else {\n\t\tdata.lockClass = \"\"\n\t}\n\to += \"\\n\\t\\n\\t\\t\\t\\t<li id=\\\"\" + data._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"\\\" class=\\\"ets-act-spv-item \" + data.lockClass+ \"\\\" data-position=\\\"\" + data.position+ \"\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\" + data.item+ \"<div class=\\\"ets-bd-handle\\\"></div><div class=\\\"ets-bd-correct\\\"></div><div class=\\\"ets-bd-incorrect\\\"></div><div class=\\\"ets-bd-lock\\\"></div></div>\\n\\t\\t\\t\\t\\t<div class=\\\"ets-ft\\\"></div>\\n\\t\\t\\t\\t</li>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./sequencing-paragraph-vertical.html'\n], function ($, ui$, $uiTouchPunch, Widget, Interaction, tTemplate) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar CLS_ITEM_CORRECT = \"ets-correct\",\n\t\tCLS_ITEM_INCORRECT = \"ets-incorrect\",\n\t\tCLS_SEQ_PLACEHOLDER = \"ets-act-spv-list-placeholder\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\t\tCLS_FREEZED = \"ets-freezed\",\n\t\tCLS_SCROLLABLE = \"ets-scrollable\",\n\n\t\tSEL_SEQ_MAIN = \".ets-act-spv-main\",\n\t\tSEL_SEQ_SIDE = \".ets-act-spv-side\",\n\t\tSEL_SEQ_LIST = \".ets-act-spv-list\",\n\t\tSEL_SEQ_ITEMS = \".ets-act-spv-list > .ets-act-spv-item\",\n\t\tSEL_ITEM_LOCKED = \".ets-locked\",\n\t\tSEL_ITEM_CORRECT = \".ets-correct\",\n\t\tSEL_ITEM_INCORRECT = \".ets-incorrect\",\n\t\tSEL_SORTABLE_CONTAINMENT = \".ets-ui-acc-bd-main\",\n\n\t\tFEEDBACK_DELAY = 1500;\n\n\tfunction Ctor() {\n\n\t}\n\n\t// # Render\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\tif (!data) {\n\t\t\tthrow this.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\tthis.html(tTemplate, data)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init media player\n\t * # Show check answer button\n\t * # Disable dragging items\n\t * # Fade in activity\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\t//Disable dragging when activity init\n\t\tvar _$items = $el.find(SEL_SEQ_ITEMS);\n\t\tif (_$items) {\n\t\t\t_$items.addClass(CLS_FREEZED);\n\t\t\tme.actLocked = true;\n\t\t} else {\n\t\t\tthrow \"Sequecing data not found\";\n\t\t}\n\n\t\tif (!me._json.references.aud) {\n\t\t\tenableDragging.call(me);\n\t\t}\n\n\t\tadjustLayout.call(me);\n\n\t\tremoveInlineStyles.call(me);\n\t}\n\n\t/**\n\t * Adjust style\n\t * # Adust side padding to audio vertically middle\n\t * # Make list scrollable if height exceed container\n\t * @api private\n\t */\n\tfunction adjustLayout() {\n\t\tvar $el = this.$element;\n\t\tvar $side = $(SEL_SEQ_SIDE),\n\t\t\t$main = $(SEL_SEQ_MAIN);\n\t\t$side.css(\"padding-top\", ($main.outerHeight() - 75) / 2);\n\n\t\tif ($el.find(SEL_SEQ_LIST).outerHeight() >= 416) {\n\t\t\t$el.find(SEL_SEQ_LIST).addClass(CLS_SCROLLABLE);\n\t\t}\n\t}\n\n\t/**\n\t * Remove inline styles\n\t * # Remove inline styles from authoring tool\n\t * @api private\n\t */\n\tfunction removeInlineStyles() {\n\t\tvar $el = this.$element;\n\n\t\t$el.find(SEL_SEQ_ITEMS).find(\"p, span\").removeAttr(\"style\");\n\t}\n\n\n\t/**\n\t * Enable dragging\n\t * # Enable dragging\n\t * # Bind sortable\n\t * @api private\n\t */\n\tfunction enableDragging() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tif (!me.actLocked) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar _$items = $el.find(SEL_SEQ_ITEMS);\n\t\t_$items.removeClass(CLS_FREEZED);\n\t\tme.actLocked = false;\n\n\t\t//Sortable\n\t\t$el.find(SEL_SEQ_LIST).sortable({\n\t\t\tcontainment: SEL_SORTABLE_CONTAINMENT,\n\t\t\tcancel: SEL_ITEM_LOCKED + ', ' + SEL_ITEM_CORRECT + ', ' + SEL_ITEM_INCORRECT,\n\t\t\taxis: 'y',\n\t\t\tplaceholder: CLS_SEQ_PLACEHOLDER,\n\t\t\tstart: function (event, ui) {\n\t\t\t\t$(ui.item).addClass(CLS_ACTIVE);\n\t\t\t\t//Make placeholder the same height as drag item\n\t\t\t\tvar sortable = $(this).data(\"ui-sortable\");\n\t\t\t\tsortable.placeholder.outerHeight(sortable.currentItem.height() - 10);\n\n\t\t\t\t$(SEL_ITEM_CORRECT, this).each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t$this.data('pos', $this.index());\n\t\t\t\t});\n\t\t\t},\n\t\t\tchange: function () {\n\t\t\t\tvar $sortable = $(this);\n\t\t\t\tvar $statics = $(SEL_ITEM_CORRECT, this).detach();\n\t\t\t\tvar $helper = $('<li></li>').prependTo(this);\n\t\t\t\t$statics.each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\tvar target = $this.data('pos');\n\n\t\t\t\t\t$this.insertAfter($('li', $sortable).eq(target));\n\t\t\t\t});\n\t\t\t\t$helper.remove();\n\t\t\t},\n\t\t\tupdate: function () {\n\t\t\t\tonSequenceChanged.call(me);\n\t\t\t},\n\t\t\tstop: function (event, ui) {\n\t\t\t\t$(ui.item).removeClass(CLS_ACTIVE);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Update data when sequence change\n\t * # Update sequece position property\n\t * @api private\n\t */\n\tfunction onSequenceChanged() {\n\t\tvar me = this;\n\n\t\tme._item.answered(true);\n\t}\n\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/activity/template/spv/load\": function (options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\t\t\tme._super = options._super;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(false);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar allCorrect = true;\n\t\t\tvar $el = this.$element;\n\n\t\t\tvar $items = $el.find(SEL_SEQ_ITEMS);\n\t\t\tme._json.scoring.sequences.forEach(function (expectedItem, index) {\n\t\t\t\tvar $item = $items.eq(index);\n\t\t\t\tvar correct = expectedItem._id === $item.attr('id');\n\t\t\t\t$item.toggleClass(CLS_ITEM_CORRECT, correct);\n\t\t\t\t$item.toggleClass(CLS_ITEM_INCORRECT, !correct);\n\t\t\t\tallCorrect = allCorrect && correct;\n\t\t\t});\n\t\t\tif(!allCorrect){\n\t\t\t\twindow.setTimeout(function () {\n\t\t\t\t\t$items.removeClass(CLS_ITEM_INCORRECT);\n\t\t\t\t}, FEEDBACK_DELAY);\n\t\t\t}\n\n\t\t\t//only one sequence, there is not specific id\n\t\t\tvar promise = me._super.publishInteraction(\n\t\t\t\tInteraction.makeSequencingInteraction(allCorrect, \"SeqParVerId\"));\n\n\t\t\tpromise.then(function () {\n\t\t\t\tif (allCorrect) {\n\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\tme._item.answered(true);\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t} else {\n\t\t\t\t\tme._item.answered(false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t'dom:.ets-ap/media/play': function () {\n\t\t\tenableDragging.call(this);\n\t\t},\n\t\t//Also listen for \"playing\" in case \"play\" is not well sent\n\t\t'dom:.ets-ap/media/playing': function () {\n\t\t\tenableDragging.call(this);\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-paragraph-vertical/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"et-act-spv-wrap\\\" data-weave=\\\"school-ui-activity/activity/sequencing-paragraph-vertical/sequencing-paragraph-vertical\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sequencing-paragraph-vertical/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'./sequencing-paragraph-vertical',\n\t'template!./main.html'\n], function activityTemplateModule($, when, Widget, spv, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_SPV_LOAD = \"activity/template/spv/load\";\n\n\tfunction Ctor() {\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\n\t\tvar me = this;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_SPV_LOAD, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.length(1);\n\t\t},\n\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-swh-droparea ets-cf\\\">\\n\\t\\n</div>\\n\\n<div class=\\\"ets-act-swh-originarea\\\">\\n\\t\";\n        var items = data.words;\n        for (var i = 0; i < items.length; i++) {\n            writeItem(items[i]);\n        }\n    o += \"\\n</div>\\n\\n\"; function writeItem(data) { o += \"\\n\\t\\t<div class=\\\"ets-act-swh-strip\\\" data-at-id=\\\"\" + data._id+ \"\\\">\\n\\t\\t\\t<div class=\\\"ets-l\\\"></div>\\n\\t\\t\\t<div class=\\\"ets-c\\\">\" + data.txt+ \"</div>\\n\\t\\t\\t<div class=\\\"ets-r\\\"></div>\\n\\t\\t</div>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t'template!./sequencing-word-horizontal.html'\n], function ($, $ui, $uiTouchPunch, Widget, Scoring, Interaction, tTemplate) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar SEL_DROP_AREA = \".ets-act-swh-droparea\",\n\t\tSEL_ORIGIN_AREA = \".ets-act-swh-originarea\",\n\t\tSEL_ACTIVITY_BODY = \".ets-act-bd\",\n\t\tSEL_STRIP = \".ets-act-swh-strip\",\n\t\tSEL_STRIP_CORRECT = \".ets-correct\",\n\t\tSEL_STRIP_INCORRECT = \".ets-incorrect\",\n\t\tSEL_ACTIVE = \".ets-active\",\n\t\tCLS_ORIGIN_AREA = \"ets-act-swh-originarea\",\n\t\tCLS_DROP_AREA = \"ets-act-swh-droparea\",\n\t\tCLS_PLACEHOLDER = \"ets-act-swh-placeholder\",\n\t\tCLS_BEGIN = \"ets-begin\",\n\t\tCLS_END = \"ets-end\",\n\t\tCLS_CORRECT = \"ets-correct\",\n\t\tCLS_INCORRECT = \"ets-incorrect\",\n\t\tFEEDBACK_DELAY = 1500,\n\t\tHELPER = \"<div class='ets-act-swh-strip'></div>\";\n\n\tvar LAST_TOUCH_DATE = \"_lastTouchDate\";\n\tvar DOUBLE_CLICK_DURATION = 250;\n\n\tfunction Ctor() {\n\n\t}\n\n\t// # Render\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = me._phrase;\n\n\t\tif (!data) {\n\t\t\tthrow me.toString() + EX_JSON_FORMAT;\n\t\t}\n\n\t\treturn me.html(tTemplate, data)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * 1. Enable sortable\n\t * 2. Bind double click strip\n\t * 3. Init media player\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\t//Enable sortable\n\t\tenableSortable.call(me);\n\n\t\t//Bind double click\n\t\tbindDoubleClickItem.call(me);\n\n\t\tsetStripeWidth.call(me);\n\t}\n\n\tfunction setStripeWidth() {\n\t\t$(SEL_STRIP).each(function (i, item) {\n\t\t\tvar l = $(item).find(\".ets-l\").outerWidth(),\n\t\t\t\tc = $(item).find(\".ets-c\").outerWidth(),\n\t\t\t\tr = $(item).find(\".ets-r\").outerWidth();\n\n\t\t\t$(item).css(\"width\", l + c + r + 1);\n\t\t});\n\t}\n\n\n\t/**\n\t * Enable sortable\n\t * 1. Sortable droparea and origin area\n\t * 2. Refresh droparea and origin area when stop dragging\n\t * @api private\n\t */\n\tfunction enableSortable() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\t\t$el.find(SEL_ORIGIN_AREA).sortable({\n\t\t\tcancel: SEL_STRIP_CORRECT + \",\" + SEL_STRIP_INCORRECT,\n\t\t\tcontainment: SEL_ACTIVITY_BODY,\n\t\t\tactiveClass: SEL_ACTIVE,\n\t\t\tconnectWith: SEL_DROP_AREA,\n\t\t\tplaceholder: CLS_PLACEHOLDER,\n\t\t\ttolerance: 'pointer',\n\t\t\t// revert: true,\n\t\t\tstart: function () {\n\t\t\t\t$(SEL_DROP_AREA).find(SEL_STRIP_CORRECT).each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t$this.data('pos', $this.index() + 1);\n\t\t\t\t});\n\t\t\t},\n\t\t\tchange: function () {\n\t\t\t\tvar $statics = $(SEL_STRIP_CORRECT, $(SEL_DROP_AREA)).detach();\n\t\t\t\tvar $helper = $(HELPER).prependTo($(SEL_DROP_AREA));\n\t\t\t\t$statics.each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\tvar target = $this.data('pos');\n\t\t\t\t\t$this.insertAfter($(SEL_STRIP, $(SEL_DROP_AREA)).eq(parseInt(target) - 1));\n\t\t\t\t});\n\t\t\t\t$helper.remove();\n\t\t\t},\n\t\t\tstop: function () {\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t\trefreshOriginArea.call(me);\n\t\t\t\tsetStripeWidth.call(me);\n\t\t\t}\n\t\t});\n\n\t\t$el.find(SEL_DROP_AREA).sortable({\n\t\t\tcancel: SEL_STRIP_CORRECT + \",\" + SEL_STRIP_INCORRECT,\n\t\t\tcontainment: SEL_ACTIVITY_BODY,\n\t\t\tactiveClass: SEL_ACTIVE,\n\t\t\tconnectWith: SEL_ORIGIN_AREA,\n\t\t\tplaceholder: CLS_PLACEHOLDER,\n\t\t\ttolerance: 'pointer',\n\t\t\tstart: function (/*event, ui*/) {\n\t\t\t\t$(SEL_STRIP_CORRECT, this).each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t$this.data('pos', $this.index() + 1);\n\t\t\t\t});\n\t\t\t},\n\t\t\tchange: function () {\n\t\t\t\tvar $sortable = $(this);\n\t\t\t\tvar $statics = $(SEL_STRIP_CORRECT, this).detach();\n\t\t\t\tvar $helper = $(HELPER).prependTo(this);\n\t\t\t\t$statics.each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\tvar target = $this.data('pos');\n\t\t\t\t\t$this.insertAfter($(SEL_STRIP, $sortable).eq(parseInt(target) - 1));\n\t\t\t\t});\n\t\t\t\t$helper.remove();\n\t\t\t},\n\t\t\tstop: function () {\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t\trefreshOriginArea.call(me);\n\t\t\t\tsetStripeWidth.call(me);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Refresh drop area:\n\t * 1. Add special class to first and last item\n\t * 2. Enable check answer when all strip are in droparea\n\t * 3. Unbind double click to droparea strips\n\t * @api private\n\t */\n\tfunction refreshDropArea() {\n\t\tvar me = this;\n\t\tvar $items = $(SEL_DROP_AREA).find(SEL_STRIP);\n\n\t\tif ($items.length > 0) {\n\t\t\t$items.removeClass(CLS_BEGIN + \" \" + CLS_END).removeAttr(\"style\");\n\t\t\t$items.first().addClass(CLS_BEGIN);\n\t\t\t//Enable check answer\n\t\t\tme._item.answered(false);\n\t\t}\n\t\tif ($items.length === me._phrase.words.length) {\n\t\t\t//Enable check answer\n\t\t\tonSequenceComplete.call(me);\n\t\t\t$items.last().addClass(CLS_END);\n\t\t}\n\t}\n\n\t/**\n\t * Refresh origin area:\n\t * 1. Reset origin area strip classes\n\t * 3. Bind double click to strips\n\t * @api private\n\t */\n\tfunction refreshOriginArea() {\n\t\tvar $strips = $(SEL_ORIGIN_AREA).find(SEL_STRIP);\n\n\t\tif ($strips.length > 0) {\n\t\t\t$strips.removeClass([CLS_BEGIN, CLS_END, CLS_CORRECT, CLS_INCORRECT].join(' '))\n\t\t\t\t.removeAttr(\"style\");\n\t\t}\n\t}\n\n\t/**\n\t * Return incorrect items\n\t * 1. Move strips start from the first incorrect strip back to origin area\n\t * 2. Refresh origin area\n\t * 3. Disable check answer\n\t * @api private\n\t */\n\tfunction returnIncorrectItems() {\n\t\tvar me = this;\n\t\tvar firstIncorrectItemIndex = $(SEL_DROP_AREA).find(SEL_STRIP_INCORRECT).first().index(),\n\t\t\t$items = $(SEL_DROP_AREA).find(SEL_STRIP),\n\t\t\t$returnItems = [];\n\n\t\tif (firstIncorrectItemIndex >= 0) {\n\t\t\t$items.each(function (index, item) {\n\t\t\t\tif (index >= firstIncorrectItemIndex) {\n\t\t\t\t\t$returnItems.push(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$(SEL_ORIGIN_AREA).append($returnItems);\n\n\t\t\trefreshOriginArea.call(me);\n\t\t\tsetStripeWidth.call(me);\n\t\t}\n\t}\n\n\t/**\n\t * Bind double click\n\t * 1. Move strip to droparea when double click\n\t * 2. Refresh drop area\n\t * @api private\n\t */\n\tfunction bindDoubleClickItem() {\n\t\tvar me = this;\n\n\t\t$(SEL_STRIP).on(\"dblclick customdblclick\", function () {\n\t\t\tvar $el = $(this);\n\n\t\t\tif ($el.parent().hasClass(CLS_ORIGIN_AREA)) {\n\t\t\t\t$(SEL_DROP_AREA).append($el);\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t} else if ($el.parent().hasClass(CLS_DROP_AREA)) {\n\t\t\t\tif ($el.hasClass(CLS_CORRECT)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$(SEL_ORIGIN_AREA).append($el);\n\t\t\t\trefreshOriginArea.call(me);\n\t\t\t\trefreshDropArea.call(me);\n\t\t\t}\n\n\t\t\tsetStripeWidth.call(me);\n\t\t});\n\n\t\t$(SEL_STRIP).on('touchstart', function (evt) {\n\t\t\tevt.preventDefault();\n\t\t\tvar $el = $(this);\n\n\t\t\tvar lastTouchDate = $el.data(LAST_TOUCH_DATE);\n\t\t\tvar touchDate = new Date().getTime();\n\t\t\tif (!lastTouchDate) {\n\t\t\t\t$el.data(LAST_TOUCH_DATE, touchDate);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar duration = touchDate - lastTouchDate;\n\t\t\tif (duration <= DOUBLE_CLICK_DURATION) {\n\t\t\t\t$el.trigger('customdblclick');\n\t\t\t\t$el.removeData(LAST_TOUCH_DATE);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$el.data(LAST_TOUCH_DATE, touchDate);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tfunction onSequenceComplete() {\n\t\tvar me = this;\n\t\tme._item.answered(true);\n\t}\n\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'hub/activity/template/swh/load': function (options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._index = options.index;\n\t\t\tme._phrase = me._json.content.phrases[me._index];\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\t\t\tme._super = options._super;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(false);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar allCorrect = true;\n\t\t\tvar $el = this.$element;\n\t\t\tvar $strips = $el.find(SEL_DROP_AREA).find(SEL_STRIP);\n\t\t\tvar solution = Scoring.findById(me._json.scoring.phrases, me._phrase._id);\n\t\t\tvar expectedTexts = solution.blanks.map(function (blank) {\n\t\t\t\treturn blank.word.txt;\n\t\t\t});\n\n\t\t\t$strips.each(function (index) {\n\t\t\t\tvar $strip = $(this);\n\t\t\t\tvar stripText = $strip.find(\".ets-c\").text();\n\t\t\t\tvar correct = expectedTexts[index] === stripText;\n\t\t\t\t$strip.addClass(correct ? CLS_CORRECT : CLS_INCORRECT);\n\t\t\t\tallCorrect = allCorrect && correct;\n\t\t\t});\n\n\t\t\twindow.setTimeout(function () {\n\t\t\t\treturnIncorrectItems.call(me)\n\t\t\t}, FEEDBACK_DELAY);\n\n\t\t\tvar promise = me._super.publishInteraction(\n\t\t\t\tInteraction.makeSequencingInteraction(allCorrect, me._phrase._id));\n\n\t\t\tpromise.then(function () {\n\t\t\t\tif (allCorrect) {\n\t\t\t\t\tif (me._index === me._json.content.phrases.length - 1) {\n\t\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\t}\n\t\t\t\t\tme._item.answered(true);\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t} else {\n\t\t\t\t\tme._item.answered(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-horizontal/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-swh ets-cf\\\">\\n\\t\";\n\tvar data = data || {};\n\tif (data.references.aud) { o += \"\\n\\t<div class=\\\"ets-act-swh-audio\\\">\\n\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t       data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t       class=\\\"ets-ap\\\"></audio>\\n\\t\\t</div></div>\\n\\t</div>\\n\\t\";}o += \"\\n\\t\\n\\t<div class=\\\"et-act-swh-main\\\" data-weave=\\\"school-ui-activity/activity/sequencing-word-horizontal/sequencing-word-horizontal\\\"></div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sequencing-word-horizontal/main',[\n\t'jquery',\n\t'../base/main',\n\t'when',\n\t'poly',\n\t'underscore',\n\t'./sequencing-word-horizontal', //maybe for load optimization???\n\t'template!./main.html'\n], function activityTemplateModule($, Widget, when, poly, _, swh, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_SWH_LOAD = \"activity/template/swh/load\";\n\n\tfunction Ctor() {\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me._htmlPromise) {\n\t\t\tme._htmlPromise = me\n\t\t\t\t.html(tTemplate, me._json);\n\t\t}\n\n\t\treturn me._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_SWH_LOAD, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tindex: me.index(),\n\t\t\t\t\tjson: me._json,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tfunction randomWords(data) {\n\t\tdata.content.phrases.forEach(function (phrase) {\n\t\t\tif (phrase.words) {\n\t\t\t\tphrase.words = _.shuffle(phrase.words);\n\t\t\t}\n\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this;\n\t\t\tme.length(me._json.content.phrases.length);\n\t\t\trandomWords.call(me, this._json);\n\t\t},\n\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-swv\\\">\\n\\t\";\n\tvar data = data || {};\n\tif (data.references.aud) { o += \"\\n\\t<div class=\\\"ets-act-swv-side\\\">\\n\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t       data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t       class=\\\"ets-ap\\\"></audio>\\n\\t\\t</div></div>\\n\\t</div>\\n\\t\";}o += \"\\n\\t<div class=\\\"ets-act-swv-main\\\">\\n\\t\\t<div class=\\\"ets-act-swv-list-wrap\\\">\\n\\t\\t    <ul class=\\\"ets-act-swv-list\\\">\\n\\t\\t    \";\n\t\t        var items = data.content.sequences;\n\t\t        for (var i = 0; i < items.length; i++) {\n\t\t            writeItem(items[i]);\n\t\t        }\n\t\t    o += \"\\n\\t\\t    </ul>\\n\\t    </div>\\n\\t    <div class=\\\"ets-act-swv-label\\\">\\n\\t\\t\\t<div class=\\\"ets-arrow\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-bd\\\"></div>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-label\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-hd\\\">\" +data.content.labels.top+ \"</div>\\n\\t\\t\\t\\t<div class=\\\"ets-ft\\\">\" +data.content.labels.bottom+ \"</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\\n\"; function writeItem(data) { \n\tif (data.isLock) {\n\t\tdata.lockClass = \"ets-correct ets-locked\";\n\t} else {\n\t\tdata.lockClass = \"\"\n\t}\no += \"\\n\\t\\t\\t\\t<li id=\\\"\" + data._id+ \"\\\" data-at-id=\\\"\" + data._id+ \"\\\" class=\\\"ets-act-swv-item \" + data.lockClass+ \"\\\" data-position=\\\"\" + data.position+ \"\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"ets-bd\\\">\" + data.item+ \"</div>\\n\\t\\t\\t\\t</li>\\n\"; }  return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'template!./sequencing-word-vertical.html'\n], function ($, ui$, $uiTouchPunch, when, Widget, Interaction, tTemplate) {\n\t\"use strict\";\n\n\t// Constants\n\n\tvar EX_JSON_FORMAT = \": json format is incorrect.\";\n\n\tvar CLS_ITEM_LOCKED = \"ets-locked\",\n\t\tCLS_ITEM_CORRECT = \"ets-correct\",\n\t\tCLS_ITEM_INCORRECT = \"ets-incorrect\",\n\t\tCLS_SEQ_PLACEHOLDER = \"ets-act-swv-list-placeholder\",\n\t\tCLS_ACTIVE = \"ets-active\",\n\n\t\tSEL_SEQ_SIDE = \".ets-act-swv-side\",\n\t\tSEL_SEQ_MAIN = \".ets-act-swv-main\",\n\t\tSEL_SEQ_LIST = \".ets-act-swv-list\",\n\t\tSEL_SEQ_ITEMS = \".ets-act-swv-list > .ets-act-swv-item\",\n\t\tSEL_ITEM_LOCKED = \".ets-act-swv-item.ets-locked\",\n\t\tSEL_ITEM_CORRECT = \".ets-act-swv-item.ets-correct\",\n\t\tSEL_ITEM_INCORRECT = \".ets-act-swv-item.ets-incorrect\",\n\t\tSEL_SORTABLE_CONTAINMENT = \".ets-ui-acc-bd-main\",\n\t\tSEL_LABEL = \".ets-act-swv-label\",\n\n\t\tFEEDBACK_DELAY = 1500;\n\n\tfunction Ctor() {\n\n\t}\n\n\t// # Render\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar data = this._json;\n\n\t\tif (!data) {\n\t\t\twhen.reject(new Error(this.toString() + EX_JSON_FORMAT));\n\t\t}\n\n\t\treturn this.html(tTemplate, data)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init media player\n\t * # Show check answer button\n\t * # Disable dragging items\n\t * # Fade in activity\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\t//Disable dragging when activity init\n\t\tvar _$items = $(SEL_SEQ_ITEMS);\n\t\tif (_$items) {\n\t\t\t_$items.addClass(CLS_ITEM_LOCKED);\n\t\t\tme.actLocked = true;\n\t\t} else {\n\t\t\tthrow \"Sequecing data not found\";\n\t\t}\n\n\t\tif (!me._json.references.aud) {\n\t\t\tenableDragging.call(me);\n\t\t}\n\n\t\tadjustLayout.call(me);\n\t}\n\n\t/**\n\t * Adjust style\n\t * # Adust side padding to audio vertically middle\n\t * @api private\n\t */\n\tfunction adjustLayout() {\n\t\tvar $el = this.$element;\n\t\tvar $side = $(SEL_SEQ_SIDE),\n\t\t\t$main = $(SEL_SEQ_MAIN),\n\t\t\t$label = $el.find(SEL_LABEL),\n\t\t\t$sequence = $el.find(SEL_SEQ_MAIN);\n\t\t$side.css(\"padding-top\", ($main.outerHeight() - 75) / 2);\n\t\t$label.css(\"height\", $sequence.outerHeight());\n\t}\n\n\t/**\n\t * Enable dragging\n\t * # Enable dragging\n\t * # Bind sortable\n\t * @api private\n\t */\n\tfunction enableDragging() {\n\t\tvar me = this,\n\t\t\t$el = this.$element;\n\n\t\tvar _$items = $el.find(SEL_SEQ_ITEMS);\n\t\t_$items.each(function () {\n\t\t\tif (!$(this).hasClass(CLS_ITEM_CORRECT)) {\n\t\t\t\t$(this).removeClass(CLS_ITEM_LOCKED);\n\t\t\t}\n\t\t});\n\n\t\tme.actLocked = false;\n\n\t\t//Sortable\n\t\t$el.find(SEL_SEQ_LIST).sortable({\n\t\t\tcontainment: SEL_SORTABLE_CONTAINMENT,\n\t\t\tcancel: SEL_ITEM_LOCKED + ', ' + SEL_ITEM_CORRECT + ', ' + SEL_ITEM_INCORRECT,\n\t\t\taxis: 'y',\n\t\t\tplaceholder: CLS_SEQ_PLACEHOLDER,\n\t\t\tstart: function (event, ui) {\n\t\t\t\t$(ui.item).addClass(CLS_ACTIVE);\n\t\t\t\t//Make placeholder the same height as drag item\n\t\t\t\tvar sortable = $(this).data(\"ui-sortable\");\n\t\t\t\tsortable.placeholder.outerHeight(sortable.currentItem.height() - 10);\n\n\t\t\t\t$(SEL_ITEM_CORRECT, this).each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t$this.data('pos', $this.index());\n\t\t\t\t});\n\t\t\t},\n\t\t\tchange: function () {\n\t\t\t\tvar $sortable = $(this);\n\t\t\t\tvar $statics = $(SEL_ITEM_CORRECT, this).detach();\n\t\t\t\tvar $helper = $('<li></li>').prependTo(this);\n\t\t\t\t$statics.each(function () {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\tvar target = $this.data('pos');\n\n\t\t\t\t\t$this.insertAfter($('li', $sortable).eq(target));\n\t\t\t\t});\n\t\t\t\t$helper.remove();\n\t\t\t},\n\t\t\tupdate: function () {\n\t\t\t\tonSequenceChanged.call(me);\n\t\t\t},\n\t\t\tstop: function (event, ui) {\n\t\t\t\t$(ui.item).removeClass(CLS_ACTIVE);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Update data when sequence change\n\t * # Update sequence position property\n\t * @api private\n\t */\n\tfunction onSequenceChanged() {\n\t\tvar me = this;\n\n\t\tme._item.answered(true);\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/activity/template/swv/load\": function (options) {\n\t\t\tvar me = this;\n\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._interacted = false;\n\t\t\tme._super = options._super;\n\n\t\t\t// set instant feedback off\n\t\t\tme._item.instantFeedback(false);\n\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar allCorrect = true;\n\t\t\tvar $el = this.$element;\n\n\t\t\tvar $items = $el.find(SEL_SEQ_ITEMS);\n\t\t\tme._json.scoring.sequences.forEach(function (expectedItem, index) {\n\t\t\t\tvar $item = $items.eq(index);\n\t\t\t\tvar correct = expectedItem._id === $item.attr('id');\n\t\t\t\t$item.toggleClass(CLS_ITEM_CORRECT, correct);\n\t\t\t\t$item.toggleClass(CLS_ITEM_INCORRECT, !correct);\n\t\t\t\tallCorrect = allCorrect && correct;\n\t\t\t});\n\t\t\tif(!allCorrect){\n\t\t\t\twindow.setTimeout(function () {\n\t\t\t\t\t$items.removeClass(CLS_ITEM_INCORRECT);\n\t\t\t\t}, FEEDBACK_DELAY);\n\t\t\t}\n\n\t\t\t//only one sequence, there is not specific id\n\t\t\tvar promise = me._super.publishInteraction(\n\t\t\t\tInteraction.makeSequencingInteraction(allCorrect, \"SeqWordVerId\"));\n\n\t\t\tpromise.then(function () {\n\t\t\t\tif (allCorrect) {\n\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t\tme._item.answered(true);\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t} else {\n\t\t\t\t\tme._item.answered(false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\"dom:.ets-ap/media/play\": function () {\n\t\t\tenableDragging.call(this);\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sequencing-word-vertical/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"et-act-swv-wrap\\\" data-weave=\\\"school-ui-activity/activity/sequencing-word-vertical/sequencing-word-vertical\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sequencing-word-vertical/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'./sequencing-word-vertical',\n\t'template!./main.html'\n], function activityTemplateModule($, when, Widget, swv, tTemplate) {\n\t\"use strict\";\n\n\tvar TOPIC_ACT_SWV_LOAD = \"activity/template/swv/load\";\n\n\tfunction Ctor() {\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\t// No matter when render() is called, it always check if the $element is exist,\n\t\t// to make sure there is no code error when render() is called after finalization.\n\t\tif (!me.$element) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If it is the first time be called, it renders the basic outer html of\n\t\t// current activity.\n\t\tif (!this._htmlPromise) {\n\t\t\tthis._htmlPromise = this.html(tTemplate());\n\t\t}\n\n\t\tvar data = this._json;\n\n\t\treturn this._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish(TOPIC_ACT_SWV_LOAD, {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: data,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tthis.hasScoring || this.type(Widget.ACT_TYPE.PRACTICE);\n\n\t\t\tif (this.type() == Widget.ACT_TYPE.PRACTICE) {\n\t\t\t\tthis.items().answered(true);\n\t\t\t}\n\n\t\t\tthis.length(1);\n\t\t},\n\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\tif (this.index() >= this.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tthis.index(this.index() + 1);\n\n\t\t\treturn this.signal('render');\n\t\t},\n\n\t\t_onAnswerChecked: function () {\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/choose-picture/main.html',[],function() { return function template(data) { var o = \"\";\nvar images = data.content.stockImages;\no += \"\\n<div class=\\\"ets-create-profile\\\">\\n    <div class=\\\"ets-images-area\\\">\\n\\n        <div class=\\\"ets-tooltip\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n            <!-- TODO: should from authoring tool -->\\n            <span>\" + data.content.descriptionTips + \"</span>\\n        </div>\\n\\n\\n        <div class=\\\"ets-tooltip ets-tooltip-error\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n        </div>\\n\\n        <div class=\\\"ets-gallery\\\">\\n            <ul class=\\\"ets-cf\\\">\\n                \"; for(var i=0; i<images.length; i++) { o += \"\\n                <li>\\n                    <a href=\\\"#\\\" class=\\\"ets-gallery-item\\\">\\n                        <img src=\\\"\" +images[i].url + \"\\\">\\n                        <span class=\\\"ets-shadow\\\"></span>\\n                    </a> \\n                </li>\\n                \"; } o += \"\\n            </ul>\\n        </div>\\n\\n        <div class=\\\"ets-uploading\\\">\\n            <div class=\\\"ets-progress\\\">\\n                <div class=\\\"ets-progress-bg\\\">\\n                    <div class=\\\"ets-current-progress\\\"></div>\\n                </div>\\n            </div>\\n            <p data-blurb-id=\\\"443582\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Uploading\\\"></p>\\n        </div>\\n\\n    \\n        <div class=\\\"ets-reupload\\\">\\n            <form action=\\\"#\\\" method=\\\"POST\\\" enctype=\\\"multipart/form-data\\\">\\n                \"; if (!data.isiPad) { o += \"\\n                <div>\\n                    <div class=\\\"ets-btn ets-btn-blue ets-btn-shadowed\\\">\\n                        <span data-blurb-id=\\\"467433\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Upload another picture\\\"></span>\\n                        <input type=\\\"file\\\" name=\\\"UploadImage\\\" class=\\\"ets-file\\\"/>\\n                    </div>\\n                </div>\\n                \"; } o += \"\\n                <div>\\n                    <div class=\\\"ets-btn ets-btn-white ets-btn-shadowed ets-select-library\\\">\\n                        <span data-blurb-id=\\\"443595\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\"  data-text-en=\\\"Select a picture from library\\\"></span>\\n                    </div>\\n                </div>\\n            </form>\\n        </div>\\n\\n        \"; if (!data.isiPad && data.enableUpload) { o += \"\\n        <div class=\\\"ets-upload\\\">\\n            <form action=\\\"#\\\" method=\\\"POST\\\" enctype=\\\"multipart/form-data\\\">\\n                <span data-blurb-id=\\\"462924\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"or\\\">or</span> \\n                <span class=\\\"upload-btn\\\">\\n                    <a href=\\\"#\\\"><span data-blurb-id=\\\"467429\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"upload your own picture\\\"></span><input type=\\\"file\\\" name=\\\"UploadImage\\\" class=\\\"ets-file\\\"/></a>\\n                </span>\\n            </form>\\n        </div>\\n        \"; } o += \"\\n    </div>\\n    \\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sharing-pic-desc/choose-picture/main',[\n\t'jquery',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/utils/browser-check\",\n\t'template!./main.html',\n\t'school-ui-shared/utils/typeid-parser',\n\t'jquery.form',\n\t'jquery.ui'\n], function ($, poly, when, Widget, browserCheck, tTemplate, idParser) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar SEL_UPLOAD = 'input[type=\"file\"]';\n\tvar SEL_CURRENT_PROGRESS = '.ets-current-progress';\n\tvar SEL_TOOLTIP = '.ets-tooltip:not(.ets-tooltip-error)';\n\tvar SEL_ERROR_TOOLTIP = '.ets-tooltip-error';\n\tvar SEL_TOOLTIP_CONTENT = '.ets-tooltip-content';\n\n\tvar CLS_SHOW_UPLOADING = 'ets-show-uploading';\n\tvar CLS_SHOW_REUPLOAD = 'ets-show-reupload';\n\n\tvar IS_IE = browserCheck.browser === \"msie\";\n\n\tvar URL = {\n\t\tUPLOAD: \"/services/schoolupload/SharingPictureDescr/UploadHandler.ashx?NeatUpload_PostBackID=\" + (new Date()).getTime()\n\t};\n\n\tvar HUB_SHOW_DESCR = 'activity/sharing-pic-desc/show/describe-srceen';\n\n\t/*!\n\t * widget blurb\n\t */\n\tvar BLURB = \"blurb!\",\n\t\tBLURB_GENERAL_ERROR = BLURB + \"467616\",\n\t\tBLURB_ERROR_TOO_BIG = BLURB + \"467614\",\n\t\tBLURB_DIMENSITION_INCORRECT = BLURB + \"467613\",\n\t\tBLURB_FILE_TYPE_INCORRECT = BLURB + \"467618\";\n\n\tvar BLURB_LIST = {};\n\tBLURB_LIST[BLURB_GENERAL_ERROR] = 'Upload file error: An unexpected error occurred. Please try it again or later!';\n\tBLURB_LIST[BLURB_ERROR_TOO_BIG] = 'Upload file error: The image size is too big, please select image no more than:';\n\tBLURB_LIST[BLURB_DIMENSITION_INCORRECT] = 'The image is too small. The minimum dimension is';\n\tBLURB_LIST[BLURB_ERROR_TOO_BIG] = 'The file you have uploaded is not supported. Please upload an image of the type JPG, GIF or PNG.';\n\n\tfunction getBlurb(status) {\n\t\tswitch (status) {\n\t\t\tcase 800:\n\t\t\t\treturn BLURB_LIST[BLURB_ERROR_TOO_BIG]; //UploadFileToBig\n\t\t\tcase 900:\n\t\t\t\treturn BLURB_LIST[BLURB_DIMENSITION_INCORRECT] + ' 80px*80px'; //UploadFileDimensionIncorrect //todo: using configvalue\n\t\t\tcase 500:\n\t\t\t\treturn BLURB_LIST[BLURB_GENERAL_ERROR]; //UploadFileUnhandledError\n\t\t\tcase 406:\n\t\t\t\treturn BLURB_LIST[BLURB_FILE_TYPE_INCORRECT]; //UploadFileTypeIncorrect\n\t\t\tcase 403:\n\t\t\t\treturn BLURB_LIST[BLURB_GENERAL_ERROR]; //UnAuthorized\n\t\t\tcase 404:\n\t\t\t\treturn BLURB_LIST[BLURB_GENERAL_ERROR]; //UploadFileNotExists\n\t\t\tdefault:\n\t\t\t\treturn BLURB_LIST[BLURB_GENERAL_ERROR];\n\t\t}\n\t}\n\n\n\tfunction toggleUpload() {\n\t\tvar me = this;\n\t\tme[$ELEMENT].removeClass(CLS_SHOW_REUPLOAD).toggleClass(CLS_SHOW_UPLOADING);\n\t}\n\n\t// Toggle reupload area\n\tfunction toggleReupload() {\n\t\tvar me = this;\n\t\tme[$ELEMENT].removeClass(CLS_SHOW_UPLOADING).toggleClass(CLS_SHOW_REUPLOAD);\n\t}\n\n\tfunction showErrorTooltip(msg) {\n\t\tvar me = this;\n\t\tme[$ELEMENT].find(SEL_TOOLTIP).hide();\n\t\tme[$ELEMENT].find(SEL_ERROR_TOOLTIP)\n\t\t\t.show()\n\t\t\t.find(SEL_TOOLTIP_CONTENT).text(msg);\n\t}\n\n\tfunction hideErrorTooltip() {\n\t\tvar me = this;\n\t\tme[$ELEMENT].find(SEL_TOOLTIP).show();\n\t\tme[$ELEMENT].find(SEL_ERROR_TOOLTIP).hide();\n\t}\n\n\tfunction uploadSubmit(e) {\n\t\tvar me = this;\n\t\tvar $target = $(e.target);\n\t\tvar file = $(e.target).val();\n\t\t// If file is empty just quick return\n\t\tif (!file) {\n\t\t\treturn;\n\t\t}\n\n\t\t$target.closest('form').ajaxSubmit({\n\t\t\turl: URL.UPLOAD,\n\t\t\tdataType: 'JSON',\n\t\t\tdata: {\n\t\t\t\t'ActivityId': me._ActivityId,\n\t\t\t\t'StudentId': me._StudentId,\n\t\t\t\t'CultureCode': me._cultureCode\n\t\t\t},\n\t\t\tbeforeSend: function () {\n\t\t\t\thideErrorTooltip.call(me);\n\t\t\t\ttoggleUpload.call(me);\n\t\t\t\t// Fallback uploading progress animation for IE\n\t\t\t\tif (IS_IE) {\n\t\t\t\t\tstartAnimate(me.$currentProgress);\n\t\t\t\t}\n\t\t\t},\n\t\t\tuploadProgress: function (e, pos, total, percent) {\n\t\t\t\tme.$currentProgress.width(percent + '%');\n\t\t\t},\n\t\t\tsuccess: function (res) {\n\t\t\t\tif (IS_IE) {\n\t\t\t\t\tstopAnimate(me.$currentProgress);\n\t\t\t\t}\n\n\t\t\t\tswitch (res.Status) {\n\t\t\t\t\tcase 200: //success\n\t\t\t\t\t\ttoggleUpload.call(me);\n\t\t\t\t\t\tme.publish(HUB_SHOW_DESCR, {\n\t\t\t\t\t\t\turl: res.ImagePath,\n\t\t\t\t\t\t\tisLibrary: false,\n\t\t\t\t\t\t\tcropped: false,\n\t\t\t\t\t\t\tfrom: 'choose-picture'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 800: //UploadFileToBig\n\t\t\t\t\tcase 900: //UploadFileDimensionIncorrect\n\t\t\t\t\tcase 500: //UploadFileUnhandledError\n\t\t\t\t\tcase 406: //UploadFileTypeIncorrect\n\t\t\t\t\tcase 403: //UnAuthorized\n\t\t\t\t\tcase 404: //UploadFileNotExists\n\t\t\t\t\t\tshowErrorTooltip.call(me, getBlurb(res.Status));\n\t\t\t\t\t\ttoggleReupload.call(me);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Clear input file's value\n\t\t\t\t$target.closest('form')[0].reset();\n\t\t\t},\n\t\t\terror: function (jqXHR) {\n\t\t\t\tswitch (jqXHR.status) {\n\t\t\t\t\tcase 504:\n\t\t\t\t\tcase 413:\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tvar msg = BLURB_LIST[BLURB_ERROR_TOO_BIG] + ' 1024KB';\n\t\t\t\t\t\tshowErrorTooltip.call(me, msg);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tshowErrorTooltip.call(me, BLURB_LIST[BLURB_GENERAL_ERROR]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttoggleReupload.call(me);\n\n\t\t\t\t// Clear input file's value\n\t\t\t\t$target.closest('form')[0].reset();\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction startAnimate($el) {\n\t\t$el.animate({\n\t\t\tleft: '-10px'\n\t\t}, function () {\n\t\t\t$el.css({\n\t\t\t\tleft: 0\n\t\t\t});\n\t\t\tstartAnimate($el);\n\t\t});\n\t}\n\n\tfunction stopAnimate($el) {\n\t\t$el.stop(true, true);\n\t}\n\n\tfunction loadBlurb() {\n\t\tvar me = this;\n\t\tvar blurbList = BLURB_LIST;\n\n\t\tvar q = Object.keys(BLURB_LIST);\n\t\treturn me.query(q)\n\t\t\t.spread(function doneQuery() {\n\t\t\t\t$.each(arguments, function (i, blurb) {\n\t\t\t\t\tvar translation = blurb && blurb.translation;\n\t\t\t\t\tif (translation) {\n\t\t\t\t\t\tblurbList[blurb.id] = translation;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn when.resolve()\n\t\t\t.then(function () {\n\t\t\t\treturn me.query('ccl!\"school.sharingTemplate.upload.enable\"')\n\t\t\t\t\t.spread(function (enableUpload) {\n\t\t\t\t\t\tme._json.enableUpload = enableUpload && enableUpload.value === \"true\";\n\t\t\t\t\t})\n\t\t\t\t\t.otherwise(function ignoreError() {\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\treturn me.html(tTemplate, me._json)\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\tme.$upload = me[$ELEMENT].find(SEL_UPLOAD);\n\n\t\t\t\t\t\tme.$upload.each(function () {\n\t\t\t\t\t\t\t$(this).on('change', $.proxy(uploadSubmit, me));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.$currentProgress = me[$ELEMENT].find(SEL_CURRENT_PROGRESS);\n\t\t\t\t\t});\n\t\t\t});\n\n\t}\n\n\t// Constructor\n\tfunction ctor(el, module, json) {\n\t\tvar me = this;\n\t\tvar isiPad = /ipad/ig.test(navigator.userAgent);\n\n\t\tme._json = json;\n\t\tme._json.isiPad = isiPad;\n\t\t// Default culture code is 'en'\n\t\tme._cultureCode = 'en';\n\n\t\t// Load blurb\n\t\tloadBlurb.call(me);\n\t}\n\n\t// Methods\n\tvar methods = {\n\t\t'sig/initialize': function () {\n\t\t\tvar me = this;\n\n\t\t\treturn render.call(me);\n\t\t},\n\t\t'hub:memory/context': function (context) {\n\t\t\tvar me = this;\n\t\t\tme._cultureCode = context.cultureCode;\n\t\t\tme._StudentId = idParser.parseId(context.user.id);\n\t\t},\n\t\t'hub:memory/start/load/activity': function (activity) {\n\t\t\tvar me = this;\n\t\t\tme._ActivityId = idParser.parseId(activity.id);\n\t\t},\n\n\t\t'dom:.ets-gallery-item/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\tvar me = this;\n\t\t\tvar url = $($e.currentTarget).find('img').attr('src');\n\t\t\tme.publish(HUB_SHOW_DESCR, {\n\t\t\t\turl: url,\n\t\t\t\tisLibrary: true,\n\t\t\t\tfrom: 'choose-picture'\n\t\t\t});\n\t\t},\n\t\t'dom:.ets-select-library/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\tvar me = this;\n\t\t\ttoggleReupload.call(me);\n\t\t\thideErrorTooltip.call(me);\n\t\t}\n\t};\n\n\treturn Widget.extend(ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/describe/main.html',[],function() { return function template(data) { var o = \"\";  \n    var outputBlurb = function (id,en) {\n        var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n        return res;\n    };\no += \"\\n<div class=\\\"ets-act-st ets-cf\\\">\\n    <div class=\\\"ets-create-profile\\\">\\n        <div class=\\\"ets-profile-image\\\">\\n            <div class=\\\"ets-tooltip ets-tooltip-error\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n            </div>\\n\\n            <div class=\\\"ets-corp-area\\\" >\\n                <img src=\\\"\\\">\\n            </div>\\n            <div class=\\\"ets-btn-change\\\">\\n                <div class=\\\"ets-btn ets-btn-white ets-btn-shadowed ets-btn-change-button\\\">\\n                    <span \" + outputBlurb(467430,\"Change Picture\") + \"></span>\\n                </div>\\n            </div>\\n            <div class=\\\"ets-edit-entry ets-none\\\">\\n                <div class=\\\"ets-btn ets-btn-white ets-btn-shadowed ets-edit-entry-button\\\">\\n                    <span \" + outputBlurb(467434,\"Edit your entry\") + \" ></span>\\n                </div>\\n            </div>\\n        </div>\\n        <div class=\\\"ets-describe-area ets-none\\\">\\n            <div class=\\\"ets-tooltip ets-none\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n                <span>\" + data.content.pickImgTips + \"</span>\\n            </div>\\n\\n            <textarea id=\\\"input-describe\\\" cols=\\\"30\\\" rows=\\\"10\\\" data-weave=\\\"school-ui-activity/shared/textchange/main\\\"></textarea>\\n             \\n            <div class=\\\"share-info\\\">\\n                <label for=\\\"agree-share\\\" data-weave=\\\"school-ui-activity/shared/checkbox/main\\\">\\n                    <input type=\\\"checkbox\\\" id=\\\"agree-share\\\" name=\\\"agree-share\\\" checked=\\\"checked\\\">\\n                    <i class=\\\"icon-people\\\"></i> <span data-blurb-id=\\\"467432\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Share my post with other students\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"ets-btn ets-btn-blue ets-btn-shadowed ets-disabled ets-describe-submit-button\\\"\\n                 data-action=\\\"submit\\\">\";/* data-action=\"submit\" is used by tests */o += \"\\n                <span data-blurb-id=\\\"462455\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Submit\\\"></span>\\n            </div>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sharing-pic-desc/describe/main',[\n\t'jquery',\n\t'poly',\n\t'when',\n\t'troopjs-utils/merge',\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/utils/browser-check\",\n\t'template!./main.html',\n\t'school-ui-shared/utils/typeid-parser',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'jquery.counter'\n], function ($, poly, when, merge, Widget, browserCheck, tTemplate, idParser) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar PREVIEW_WIDTH = 310;\n\tvar PREVIEW_HEIGHT = 310;\n\tvar THUMBNAIL_WIDTH = 110;\n\tvar THUMBNAIL_HEIGHT = 110;\n\n\tvar WARN_TEXT_LENGTH = 190;\n\n\tvar SEL_PREVIEW_IMG = '.ets-corp-area img';\n\tvar SEL_DESCRIBE_AREA = '.ets-describe-area';\n\tvar SEL_TEXTAREA = 'textarea';\n\tvar SEL_SUBMIT = '.ets-btn-blue';\n\tvar SEL_COUNTER = '#input-describe_counter';\n\tvar SEL_PROFILE_IMG = '.ets-profile-image';\n\tvar SEL_TEXTAREA_TOOLTIP = '.ets-describe-area .ets-tooltip';\n\tvar SEL_GENERAL_TOOLTIP = '.ets-profile-image .ets-tooltip';\n\tvar SEL_TOOLTIP_CONTENT = '.ets-tooltip-content';\n\tvar SEL_AGREE_SHARE = '#agree-share';\n\tvar SEL_CHANGE_PICTURE = \".ets-btn-change\";\n\tvar SEL_EDIT_ENTRY = \".ets-edit-entry\";\n\n\tvar CLS_NONE = 'ets-none';\n\tvar CLS_WARNING = 'ets-warning';\n\tvar CLS_DISABLED = 'ets-disabled';\n\tvar CLS_FOCUS = 'ets-focus';\n\tvar CLS_SUCCESS = 'ets-tooltip-success';\n\tvar CLS_ERROR = 'ets-tooltip-error';\n\tvar CLS_CHECKBOX = 'ets-checkbox-checked';\n\tvar CLS_TOOLTIP_IE8 = 'ets-tooltip-ie8';\n\n\n\tvar HUB_SHOW_CHOOSE = \"activity/sharing-pic-desc/show/choose-picture-screen\";\n\tvar HUB_SHOW_WALL = 'activity/sharing-pic-desc/show/picture-wall-screen';\n\tvar HUB_ENABLE_NEXT = 'activity/sharing-pic-desc/enable/next';\n\n\t/*!\n\t * widget blurb\n\t */\n\tvar BLURB = \"blurb!\",\n\t\tBLURB_GENERAL_ERROR = BLURB + \"467616\",\n\t\tBLURB_SAVE_ERROR = BLURB + \"467617\",\n\t\tBLURB_COMPLETE = BLURB + \"467615\";\n\n\tvar BLURB_LIST = {};\n\tBLURB_LIST[BLURB_GENERAL_ERROR] = 'Upload file error: An unexpected error occurred. Please try it again or later!';\n\tBLURB_LIST[BLURB_SAVE_ERROR] = 'There is an unexpected error occured when save your entity. Please try it again or later!';\n\tBLURB_LIST[BLURB_COMPLETE] = 'Completed. Good job!';\n\n\tfunction showCompleteTooltip() {\n\t\tvar me = this;\n\t\tme.$generalTooltip.addClass(CLS_SUCCESS).removeClass(CLS_ERROR)\n\t\t\t.show()\n\t\t\t.find(SEL_TOOLTIP_CONTENT).text(BLURB_LIST[BLURB_COMPLETE]);\n\t}\n\n\tfunction hideGeneralTooltip() {\n\t\tvar me = this;\n\t\tme.$generalTooltip.hide();\n\t}\n\n\tfunction showErrorTooltip(msg) {\n\t\tvar me = this;\n\t\tme.$generalTooltip.addClass(CLS_ERROR).removeClass(CLS_SUCCESS)\n\t\t\t.show()\n\t\t\t.find(SEL_TOOLTIP_CONTENT).text(msg);\n\t}\n\n\tfunction hideErrorTooltip() {\n\t\tvar me = this;\n\t\tme.$generalTooltip.addClass(CLS_ERROR).removeClass(CLS_SUCCESS)\n\t\t\t.hide();\n\t}\n\n\tfunction showPreview() {\n\t\tvar me = this;\n\t\tvar url = me._json.url;\n\t\tvar img = new Image();\n\n\t\tif (browserCheck.browser === \"msie\") {\n\t\t\timg.onreadystatechange = onload;\n\t\t} else {\n\t\t\timg.onload = onload;\n\t\t}\n\n\t\timg.src = url;\n\n\t\tfunction onload() {\n\t\t\tme.$previewImage.attr('src', url);\n\t\t\tif (me._json.isLibrary || me._json.cropped) {\n\t\t\t\tme.$previewImage.css({\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: '100%'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.$previewImage.css(\"cursor\", 'move');\n\n\t\t\tvar width = me.$previewImage.width() - PREVIEW_WIDTH;\n\t\t\tvar height = me.$previewImage.height() - PREVIEW_HEIGHT;\n\n\t\t\tme.$previewImage.draggable({\n\t\t\t\tdrag: function (e, ui) {\n\n\t\t\t\t\tif (ui.position.left >= 0) {\n\t\t\t\t\t\tui.position.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (ui.position.top >= 0) {\n\t\t\t\t\t\tui.position.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (ui.position.left <= -width) {\n\t\t\t\t\t\tui.position.left = -width;\n\t\t\t\t\t}\n\t\t\t\t\tif (ui.position.top <= -height) {\n\t\t\t\t\t\tui.position.top = -height;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\tfunction destroyDraggable() {\n\t\tvar me = this;\n\n\t\tif (me.$previewImage.data('ui-draggable')) {\n\t\t\tme.$previewImage.draggable('destroy');\n\t\t} //draggable not initialized if \"me._json.isLibrary || me._json.cropped\", don't destroy\n\n\t\tme.$previewImage.removeAttr('style');\n\t}\n\n\tfunction showDescribeArea() {\n\t\tvar me = this;\n\n\t\tif (typeof me._json.describe !== 'undefined') {\n\t\t\tvar _desc = me._json.describe.replace(/(<|(?:&lt;))/g, '$1 ');\n\t\t\tvar _descDecode = $('<div/>').html(_desc).text();\n\t\t\tme.$textarea.val(_descDecode.replace(/((<|(?:&lt;))\\s)/g, '$2'));\n\t\t\tdelete me._json.describe;\n\t\t}\n\n\t\tif (typeof me._json.isPrivate !== 'undefined' && me._json.isPrivate) {\n\t\t\tme.$agreeShare.parent('span').removeClass(CLS_CHECKBOX);\n\t\t\tme.$agreeShare.prop('checked', false);\n\t\t}\n\t\telse {\n\t\t\tme.$agreeShare.parent('span').addClass(CLS_CHECKBOX);\n\t\t\tme.$agreeShare.prop('checked', true);\n\t\t}\n\n\t\ttoggleSubmitButton.call(me, me.$textarea.val().length);\n\n\t\tme.$describeArea.show(\"slide\", {\n\t\t\tdirection: \"left\"\n\t\t}, 'normal', function () {\n\t\t\tme.$textarea.focus();\n\t\t\tif (me.$textareaTooltip.hasClass(CLS_TOOLTIP_IE8)) {\n\t\t\t\tme.$textareaTooltip.css('top', (-1) * (me.$textareaTooltip.height())).show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tme.$textareaTooltip.css('top', (-1) * (me.$textareaTooltip.height() + 10)).show();\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction hideDescribeArea() {\n\t\tvar me = this;\n\n\t\treturn when.promise(function (resolve) {\n\t\t\tme.$textareaTooltip.hide();\n\t\t\t//hide describe area\n\t\t\tme.$describeArea.hide(\"slide\", {\n\t\t\t\tdirection: \"left\"\n\t\t\t}, 'slow', resolve);\n\t\t});\n\t}\n\n\tfunction getCroppedImage(imageUrl) {\n\t\tvar me = this;\n\n\t\tfunction onDone() {\n\t\t\tdestroyDraggable.call(me);\n\t\t\tme.$previewImage.attr('src', url)\n\t\t\t\t.css({\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: '100%'\n\t\t\t\t});\n\t\t}\n\n\t\tif (me._json.isLibrary) {\n\t\t\treturn when.resolve().tap(onDone);\n\t\t}\n\n\t\tvar url = imageUrl;\n\n\t\tvar image = new Image;\n\t\timage.src = url;\n\n\t\treturn when.promise(function (resolve) {\n\t\t\t$(image).one('load', resolve);\n\t\t}).tap(onDone);\n\t}\n\n\tfunction zoomOutPreview() {\n\t\tvar me = this;\n\n\t\treturn when.promise(function (resolve) {\n\t\t\tme[$ELEMENT].find(SEL_PROFILE_IMG)\n\t\t\t\t.animate({\n\t\t\t\t\twidth: THUMBNAIL_WIDTH,\n\t\t\t\t\theight: THUMBNAIL_HEIGHT\n\t\t\t\t}, 'normal', function () {\n\t\t\t\t\tme._isShrink = true;\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.find(SEL_CHANGE_PICTURE).addClass(CLS_NONE);\n\t\t});\n\t}\n\n\tfunction zoomInPreview() {\n\t\tvar me = this;\n\n\t\treturn when.promise(function (resolve) {\n\t\t\tme[$ELEMENT].find(SEL_PROFILE_IMG)\n\t\t\t\t.animate({\n\t\t\t\t\twidth: PREVIEW_WIDTH,\n\t\t\t\t\theight: PREVIEW_HEIGHT\n\t\t\t\t}, 'normal', function () {\n\t\t\t\t\tme._isShrink = false;\n\t\t\t\t\t$(this).find(SEL_CHANGE_PICTURE).removeClass(CLS_NONE);\n\t\t\t\t\tme.$previewImage.css({\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: '100%'\n\t\t\t\t\t});\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t});\n\t}\n\n\tfunction toggleSubmitButton(textLength) {\n\t\tvar me = this;\n\t\tif (textLength) {\n\t\t\tme.$submit.removeClass(CLS_DISABLED);\n\t\t} else {\n\t\t\tme.$submit.addClass(CLS_DISABLED);\n\t\t}\n\t}\n\n\tfunction saveEntity(data) {\n\t\tvar me = this;\n\n\t\tvar left = parseInt(me.$previewImage.css('left'), 10) || 0;\n\t\tvar top = parseInt(me.$previewImage.css('top'), 10) || 0;\n\n\t\tvar ajaxData = merge.call({\n\t\t\t\"data\": JSON.stringify({\n\t\t\t\t\"activity_id\": me.activity_id,\n\t\t\t\t\"descr\": $.trim(me.$textarea.val()),\n\t\t\t\t\"imagePath\": me._json.url,\n\t\t\t\t\"isPrivate\": !me.$agreeShare.prop('checked'),\n\t\t\t\t\"height\": PREVIEW_HEIGHT,\n\t\t\t\t\"width\": PREVIEW_WIDTH,\n\t\t\t\t\"xAxis\": -left,\n\t\t\t\t\"yAxis\": -top,\n\t\t\t\t\"isFromLibrary\": me._json.isLibrary\n\t\t\t})\n\t\t}, me._saveAndCropImage);\n\n\t\treturn me.publish(\"ajax\", ajaxData)\n\t\t\t.tap(hideErrorTooltip.bind(me))\n\t\t\t.then(function (res) {\n\t\t\t\tme.publish(HUB_ENABLE_NEXT);\n\t\t\t\tif (res && res[0].saveResult) {\n\t\t\t\t\tdata.imageUrl = res[0].cropedFileName;\n\t\t\t\t}\n\n\t\t\t\twhen\n\t\t\t\t\t.all([\n\t\t\t\t\t\thideDescribeArea.call(me),\n\t\t\t\t\t\tgetCroppedImage.call(me, data.imageUrl)\n\t\t\t\t\t])\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\tif (me._noOthers) {\n\t\t\t\t\t\t\tshowCompleteTooltip.call(me);\n\t\t\t\t\t\t\tme.$changePicture.addClass(CLS_NONE);\n\t\t\t\t\t\t\tme.$editEntry.removeClass(CLS_NONE);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tzoomOutPreview.call(me)\n\t\t\t\t\t\t\t\t.then(function () {\n\t\t\t\t\t\t\t\t\tme.publish(HUB_SHOW_WALL, data);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.otherwise(function () {\n\t\t\t\tshowErrorTooltip.call(me, BLURB_LIST[BLURB_SAVE_ERROR]);\n\t\t\t});\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn me.html(tTemplate, me._content)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tme.$textarea = me[$ELEMENT].find(SEL_TEXTAREA);\n\t\tme.$textarea.counter({\n\t\t\tgoal: 200\n\t\t});\n\n\t\tme.$submit = me[$ELEMENT].find(SEL_SUBMIT);\n\t\tme.$describeArea = me[$ELEMENT].find(SEL_DESCRIBE_AREA);\n\t\tme.$previewImage = me[$ELEMENT].find(SEL_PREVIEW_IMG);\n\t\tme.$textareaTooltip = me[$ELEMENT].find(SEL_TEXTAREA_TOOLTIP);\n\t\tme.$generalTooltip = me[$ELEMENT].find(SEL_GENERAL_TOOLTIP);\n\t\tme.$agreeShare = me[$ELEMENT].find(SEL_AGREE_SHARE);\n\t\tme.$editEntry = me[$ELEMENT].find(SEL_EDIT_ENTRY);\n\t\tme.$changePicture = me[$ELEMENT].find(SEL_CHANGE_PICTURE);\n\t}\n\n\tfunction showWithoutAnimation() {\n\t\tvar me = this;\n\t\tif (me._json) {\n\t\t\tshowPreview.call(me);\n\t\t\tshowDescribeArea.call(me);\n\t\t}\n\t}\n\n\tfunction showWithAnimation() {\n\t\tvar me = this;\n\n\t\tzoomInPreview.call(me)\n\t\t\t.then(showDescribeArea.bind(me));\n\t}\n\n\tfunction showCompleted() {\n\t\tvar me = this;\n\n\t\tme.$changePicture.addClass(CLS_NONE);\n\t\tme.$editEntry.removeClass(CLS_NONE);\n\t\tshowPreview.call(me);\n\t\tshowCompleteTooltip.call(me);\n\t}\n\n\tfunction loadBlurb() {\n\t\tvar me = this;\n\t\tvar blurbList = BLURB_LIST;\n\n\t\tvar q = Object.keys(BLURB_LIST);\n\t\treturn me.query(q)\n\t\t\t.spread(function doneQuery() {\n\t\t\t\t$.each(arguments, function (i, blurb) {\n\t\t\t\t\tvar translation = blurb && blurb.translation;\n\t\t\t\t\tif (translation) {\n\t\t\t\t\t\tblurbList[blurb.id] = translation;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\n\t// Constructor\n\tfunction ctor(module, el, content) {\n\t\tvar me = this;\n\t\tme._isShrink = false;\n\t\tme._json = null;\n\t\tme._content = content;\n\t\t// Load blurb\n\t\tloadBlurb.call(me);\n\t}\n\n\t// Methods\n\tvar methods = {\n\t\t'sig/initialize': function () {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'hub/activity/sharing-pic-desc/describe/reload': function (data) {\n\t\t\tvar me = this;\n\t\t\tvar isNoOthersCompleted = me._noOthers && (data && data.from !== 'choose-picture');\n\t\t\tme._json = data;\n\n\t\t\t// If the preview is shrinked,\n\t\t\t// then zoom in it and show describe area\n\t\t\tif (me._isShrink) {\n\t\t\t\tshowWithAnimation.call(me);\n\t\t\t} else {\n\n\t\t\t\tif (isNoOthersCompleted) {\n\t\t\t\t\tshowCompleted.call(me);\n\t\t\t\t} else {\n\t\t\t\t\tshowWithoutAnimation.call(me);\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\t\t'dom:.ets-btn-change-button/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\tvar me = this;\n\n\t\t\tme.$generalTooltip.hide();\n\n\t\t\tvar hideDescribeAreaPromise;\n\t\t\tif (me.$describeArea.is(':visible')) {\n\t\t\t\thideDescribeAreaPromise = hideDescribeArea.call(me);\n\t\t\t} else {\n\t\t\t\thideDescribeAreaPromise = when.resolve();\n\t\t\t}\n\n\t\t\thideDescribeAreaPromise.then(function () {\n\t\t\t\tdestroyDraggable.call(me);\n\t\t\t\thideErrorTooltip.call(me);\n\t\t\t\tme.publish(HUB_SHOW_CHOOSE);\n\t\t\t});\n\t\t},\n\t\t'dom:.ets-edit-entry-button/click': function () {\n\t\t\tvar me = this;\n\t\t\tme.$changePicture.removeClass(CLS_NONE);\n\t\t\tme.$editEntry.addClass(CLS_NONE);\n\t\t\thideGeneralTooltip.call(me);\n\t\t\tshowDescribeArea.call(me);\n\t\t},\n\t\t'dom:#input-describe/EFTextChange': function () {\n\t\t\tvar me = this;\n\t\t\tvar textLength = $.trim(me.$textarea.val()).length;\n\n\t\t\tif (textLength > WARN_TEXT_LENGTH) {\n\t\t\t\tme[$ELEMENT].find(SEL_COUNTER).addClass(CLS_WARNING);\n\t\t\t} else {\n\t\t\t\tme[$ELEMENT].find(SEL_COUNTER).removeClass(CLS_WARNING);\n\t\t\t}\n\n\t\t\ttoggleSubmitButton.call(me, textLength);\n\t\t},\n\t\t'dom:.ets-describe-submit-button/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\tvar me = this;\n\n\t\t\tif (me.$submit.hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar data = {\n\t\t\t\timageUrl: me.$previewImage.attr('src'),\n\t\t\t\tdescribe: me.$textarea.val(),\n\t\t\t\tisPrivate: !me.$agreeShare.prop('checked')\n\t\t\t};\n\n\t\t\tsaveEntity.call(me, data);\n\t\t},\n\n\t\t'dom:#input-describe/focusin': function () {\n\t\t\tvar me = this;\n\t\t\tme.$describeArea.addClass(CLS_FOCUS);\n\t\t},\n\t\t'dom:#input-describe/focusout': function () {\n\t\t\tvar me = this;\n\t\t\tme.$describeArea.removeClass(CLS_FOCUS);\n\t\t},\n\t\t'hub:memory/start/load/activity': function (activity) {\n\t\t\tthis.activity_id = idParser.parseId(activity.id);\n\t\t},\n\t\t'hub:memory/activity/sharing-pic-desc/describe/no/others': function () {\n\t\t\tthis._noOthers = true;\n\t\t},\n\t\t'hub:memory/context': function (context) {\n\t\t\tthis._saveAndCropImage = context.api['action/sharingpicturedescr/SaveAndCropImage'];\n\t\t}\n\t};\n\n\treturn Widget.extend(ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-st ets-cf\\\">\\n    <div class=\\\"ets-choose-picture-screen ets-none\\\"></div>\\n    <div class=\\\"ets-share-and-describe-screen ets-none\\\"></div>\\n    <div class=\\\"ets-picture-wall-screen ets-none\\\" data-weave=\\\"school-ui-activity/activity/sharing-pic-desc/picture-wall/main\\\"></div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sharing-pic-desc/main',[\n\t'jquery',\n\t'when',\n\t'../base/main',\n\t'template!./main.html'\n], function ($, when, Widget, tTemplate) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar WID_CHOOSE_PIC = 'school-ui-activity/activity/sharing-pic-desc/choose-picture/main';\n\tvar WID_DESCRIBE = \"school-ui-activity/activity/sharing-pic-desc/describe/main\";\n\n\tvar SEL_PIC_SCREEN = '.ets-choose-picture-screen';\n\tvar SEL_DESC_SCREEN = '.ets-share-and-describe-screen';\n\tvar SEL_PIC_WALL = '.ets-picture-wall-screen';\n\n\tvar CLS_NONE = 'ets-none';\n\n\tvar HUB_DESCRIBE = \"activity/sharing-pic-desc/describe/reload\";\n\tvar HUB_PICTURE_WALL = \"activity/sharing-pic-desc/picture-wall/reload\";\n\tvar HUB_ENABLE_NEXT = \"activity/sharing-pic-desc/enable/next\";\n\n\t// Switch screen\n\tfunction switchScreen(sel, hub, data) {\n\t\tvar me = this;\n\t\tme[$ELEMENT].find(sel).removeClass(CLS_NONE).siblings().addClass(CLS_NONE);\n\n\t\tif (hub) {\n\t\t\tme.publish(hub, data);\n\t\t}\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn me.html(tTemplate, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\twhen.resolve()\n\t\t\t.then(function () {\n\t\t\t\treturn me[$ELEMENT].find(SEL_PIC_SCREEN)\n\t\t\t\t\t.data('json', me._json)\n\t\t\t\t\t.attr('data-weave', WID_CHOOSE_PIC + \"(json)\")\n\t\t\t\t\t.weave()\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\treturn me[$ELEMENT].find(SEL_DESC_SCREEN)\n\t\t\t\t\t.data('json', me._json)\n\t\t\t\t\t.attr('data-weave', WID_DESCRIBE + '(json)')\n\t\t\t\t\t.weave();\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\t// If this activity has bee passed,\n\t\t\t\t// then use the picture wall directly\n\t\t\t\tif (me.hasPassed) {\n\t\t\t\t\tswitchScreen.call(me, SEL_PIC_WALL, HUB_PICTURE_WALL);\n\t\t\t\t\tme.publish(HUB_ENABLE_NEXT);\n\t\t\t\t} else {\n\t\t\t\t\tswitchScreen.call(me, SEL_PIC_SCREEN);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t// Methods\n\tvar methods = {\n\t\t'sig/render': function () {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'hub/activity/sharing-pic-desc/show/describe-srceen': function (data) {\n\t\t\tvar me = this;\n\t\t\tswitchScreen.call(me, SEL_DESC_SCREEN, HUB_DESCRIBE, data);\n\t\t},\n\t\t'hub/activity/sharing-pic-desc/show/choose-picture-screen': function () {\n\t\t\tvar me = this;\n\t\t\tswitchScreen.call(me, SEL_PIC_SCREEN)\n\t\t},\n\t\t'hub/activity/sharing-pic-desc/show/picture-wall-screen': function (data) {\n\t\t\tvar me = this;\n\t\t\tswitchScreen.call(me, SEL_PIC_WALL, HUB_PICTURE_WALL, data);\n\t\t},\n\t\t'hub/activity/sharing-pic-desc/enable/next': function () {\n\t\t\t// Enable NEXT button\n\t\t\tthis.items().completed(true);\n\t\t}\n\t};\n\n\treturn Widget.extend(methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/sharing-pic-desc/picture-wall/main.html',[],function() { return function template(data) { var o = \"\";\n    var others = data.others;\n    var myself = data.myself;\n    var imagePath;\n    function getImagePath(isFromLibrary, imgPath) {\n        if(imgPath.indexOf('http:') < 0) { //todo: delete the line after 15-1 release\n            imgPath = (isFromLibrary ? data.cacheServer : data.uploadCacheServer) + imgPath;\n        }\n        return imgPath;\n    }\no += \"\\n<ul class=\\\"ets-profile-wall ets-cf\\\">\\n    \"; for (var i = 0, len = others.length; i < len; i++ ) {\n        imagePath = getImagePath(others[i].isFromLibrary, others[i].imagePath);\n    o += \"\\n    <li \"; if (i === 9) { o += \"class=\\\"ets-add-margin-right\\\"\"; } o += \">\\n        <a href=\\\"#\\\" student-id=\\\"\" + others[i].studentId + \"\\\" class=\\\"ets-profile-wall-item\\\">\\n            <img src=\\\"\" + imagePath + \"\\\">\\n            <div class=\\\"ets-shadow\\\"></div>\\n        </a>\\n\\n        <div class=\\\"ets-tooltip ets-left-arrow\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n            <p>\" + others[i].descr + \"</p>\\n\\n            <div class=\\\"ets-person-info\\\">\\n                <img src=\\\"\" + others[i].avatar + \"\\\" width=\\\"40\\\" height=\\\"40\\\" alt=\\\"\\\">\\n                <div class=\\\"ets-info\\\">\\n                    <p class=\\\"ets-name\\\">\" +others[i].firstName+ \"</p>\\n                    \"; if (others[i].countryFlag) { o += \"\\n                    <p class=\\\"ets-location\\\">\\n                        <img src=\\\"/_imgs/friends/flags/\" + others[i].countryFlag + \".gif\\\" width=\\\"16\\\" height=\\\"11\\\"/>\\n                        <span>\" + others[i].country + \"</span>\\n                    </p>\\n                    \"; } o += \"\\n                </div>\\n            </div>\\n        </div>\\n\\n    </li>\\n    \"; } o += \"\\n    \"; for (var j = i; j < 20; j++) { o += \"\\n    <li class=\\\"ets-profile-placeholder \"; if (j === 9) { o += \"ets-add-margin-right\"; } o += \"\\\">\\n        <a class=\\\"ets-profile-wall-item-placeholder\\\">\\n            <div class=\\\"ets-shadow\\\"></div>\\n        </a>\\n    </li>\\n    \"; } o += \"\\n</ul>\\n<div class=\\\"ets-profile-me\\\">\\n    <a href=\\\"#\\\" class=\\\"ets-profile-wall-item\\\">\\n        <img src=\\\"\"; if (myself && myself.imagePath) { o += \"\" + getImagePath(myself.isFromLibrary, myself.imagePath) + '?' + (new Date).getTime(); } o += \"\\\">\\n        <div class=\\\"ets-shadow\\\"></div>\\n    </a>\\n    \\n    <div class=\\\"ets-tooltip ets-left-arrow\\\" data-weave=\\\"school-ui-activity/shared/tooltip/main\\\">\\n        <p>\"; if (myself && myself.descr) { o += \"\" + myself.descr; } o += \"</p>\\n\\n        <div class=\\\"ets-person-info\\\">\\n            <img src=\\\"\" + myself.avatar+ \"\\\" width=\\\"40\\\" height=\\\"40\\\" alt=\\\"\\\">\\n                <div class=\\\"ets-info\\\">\\n                    <p class=\\\"ets-name\\\">\" + myself.firstName + \"</p>\\n                    \"; if (myself.countryFlag) { o += \"\\n                    <p class=\\\"ets-location\\\">\\n                        <img src=\\\"/_imgs/friends/flags/\" + myself.countryFlag + \".gif\\\" width=\\\"16\\\" height=\\\"11\\\"/>\\n                        <span>\" + myself.country + \"</span>\\n                    </p>\\n                    \"; } o += \"\\n                </div>\\n        </div>\\n\\n        <div class=\\\"ets-tooltip-btns\\\">\\n            <span class=\\\"ets-btn-small ets-btn-white ets-btn-shadow ets-profile-edit-button\\\">\\n                <span data-blurb-id=\\\"467434\\\" data-text-en=\\\"Edit your entry\\\"></span>\\n            </span>\\n        </div>\\n    </div>\\n</div>\\n\\n<div class=\\\"ets-msg-box\\\">\\n    <div class=\\\"ets-content\\\">\\n        <h3 data-blurb-id=\\\"467619\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"See what other students like\\\"></h3>\\n        <p data-blurb-id=\\\"467620\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"There are thousands of other students learning English at Englishtown. Take a minute to browse around and see what food the other students in the school like.\\\"></p>\\n        <p data-blurb-id=\\\"467621\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Click on the pictures to read their stories.\\\"></p>\\n\\n        <div class=\\\"ets-btn ets-btn-blue ets-btn-shadowed ets-msg-box-close-button\\\">\\n            <span data-blurb-id=\\\"462940\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-text-en=\\\"Close\\\">\\n            </span>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/sharing-pic-desc/picture-wall/main',[\n\t\"jquery\",\n\t\"poly\",\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'template!./main.html',\n\t'school-ui-shared/utils/typeid-parser',\n\t'jquery.ui'\n], function DemoModule($, poly, when, Widget, template, idParser) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar SEL_ME = '.ets-profile-me';\n\tvar SEL_ME_IMG = '.ets-profile-me img';\n\tvar SEL_ME_LINK = '.ets-profile-me a';\n\tvar SEL_PROFILE_WALL = '.ets-profile-wall';\n\tvar SEL_PROFILES = '.ets-profile-wall li';\n\tvar SEL_MSG = '.ets-msg-box';\n\tvar SEL_DESC = '.ets-tooltip-content > p:eq(0)';\n\tvar SEL_ST = '.ets-act-st';\n\n\tvar CLS_NONE = 'ets-none';\n\tvar CLS_ON = 'ets-on';\n\tvar CLS_ACT = 'ets-act-sharing-pic-desc';\n\n\tvar STARTED = '_started';\n\n\tvar HUB_DESCRIBE_SHOW = \"activity/sharing-pic-desc/show/describe-srceen\";\n\tvar HUB_NO_OTHERS = 'activity/sharing-pic-desc/describe/no/others';\n\n\tfunction loadProfiles() {\n\t\tvar me = this;\n\n\t\tfunction loadSharedPictureDescrs() {\n\t\t\treturn me._activityLoaded.promise\n\t\t\t\t.then(function () {\n\t\t\t\t\tvar q = \"sharing_picture_descr!\" + me.activity_id;\n\t\t\t\t\treturn me.query(q)\n\t\t\t\t})\n\t\t\t\t.spread(function (sharingData) {\n\t\t\t\t\treturn sharingData;\n\t\t\t\t});\n\t\t}\n\n\t\tfunction loadUploadCacheServer() {\n\t\t\treturn me.query('ccl!\"school.sharingTemplate.upload.cacheServer\"')\n\t\t\t\t.spread(function (cclUploadCacheServer) {\n\t\t\t\t\treturn cclUploadCacheServer;\n\t\t\t\t});\n\t\t}\n\n\t\treturn when.all([\n\t\t\tloadSharedPictureDescrs(),\n\t\t\tloadUploadCacheServer()\n\t\t]).spread(function (sharingData, cclUploadCacheServer) {\n\t\t\tif (!me[STARTED]) {\n\t\t\t\treturn when.reject();\n\t\t\t}\n\n\t\t\tif (!sharingData || !sharingData.pictureWall || sharingData.pictureWall.length < 3) {\n\t\t\t\tme.publish(HUB_NO_OTHERS);\n\t\t\t}\n\n\t\t\tme._json.others = sharingData.pictureWall;\n\t\t\tme._json.myself = sharingData.studentSharing;\n\t\t\tme._json.uploadCacheServer = cclUploadCacheServer.value;\n\t\t});\n\t}\n\n\tfunction updateMyProfile(data) {\n\t\tvar me = this;\n\n\t\tme[$ELEMENT].find(SEL_ME + \" a > img\").attr('src', data.imageUrl);\n\t\tme[$ELEMENT].find([SEL_ME, SEL_DESC].join(' ')).text(data.describe);\n\n\t\tme._json.myself.descr = data.describe;\n\t\tme._json.myself.isPrivate = data.isPrivate;\n\n\t\tif (!me[$ELEMENT].find(SEL_ME).hasClass(CLS_ON)) {\n\t\t\tshowMySelf.call(me);\n\t\t}\n\n\t\treturn when.resolve();\n\t}\n\n\n\tfunction closeCompleteMsg() {\n\t\tvar me = this;\n\t\tme[$ELEMENT].find(SEL_MSG).fadeOut('fast', function () {\n\t\t\t$(this).remove();\n\t\t});\n\t}\n\n\tfunction showMySelf() {\n\t\tvar me = this;\n\n\t\tme[$ELEMENT].find(SEL_ME_LINK).trigger('click');\n\t}\n\n\tfunction endingAnimation() {\n\t\tvar me = this;\n\t\tme[$ELEMENT].addClass(CLS_NONE);\n\t\treturn when.resolve();\n\t}\n\n\tfunction backToDescribScreen() {\n\t\tvar me = this;\n\t\tme.publish(HUB_DESCRIBE_SHOW, {\n\t\t\turl: me[$ELEMENT].find(SEL_ME_IMG).attr('src'),\n\t\t\tisLibrary: me._json.myself.isFromLibrary,\n\t\t\tdescribe: me._json.myself.descr,\n\t\t\tisPrivate: me._json.myself.isPrivate,\n\t\t\tcropped: true\n\t\t});\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\treturn me.html(template, me._json)\n\t\t\t.then(function () {\n\t\t\t\tme[$ELEMENT].find('.ets-tooltip-btns [data-blurb-id]')\n\t\t\t\t\t.attr('data-weave', 'troopjs-ef/blurb/widget')\n\t\t\t\t\t.weave();\n\t\t\t\tme.$profileWall = me[$ELEMENT].find(SEL_PROFILE_WALL);\n\n\t\t\t\t$(document.body).on('click.' + CLS_ACT, function (e) {\n\t\t\t\t\tme.$profileWall.css('zIndex', '');\n\n\t\t\t\t\tme[$ELEMENT].find(SEL_ME).removeClass(CLS_ON);\n\t\t\t\t\tme[$ELEMENT].find(SEL_PROFILES).removeClass(CLS_ON);\n\t\t\t\t});\n\t\t\t}).then(me._dfdRendered.resolve);\n\t}\n\n\tfunction ctor() {\n\t\tvar me = this;\n\t\tme._json = {};\n\t\tme.edge = me[$ELEMENT].closest(SEL_ST).offset().left + 980;\n\t\tme._contextLoaded = when.defer();\n\t\tme._activityLoaded = when.defer();\n\t\tme._dfdRendered = when.defer();\n\t}\n\n\t// Log visit this picture's user\n\t// TODO: log api will be wrapped in etroop service later\n\tfunction logVisit($target) {\n\t\tvar me = this;\n\n\t\tvar studentId = $target.attr(\"student-id\");\n\t\tme._contextLoaded.promise\n\t\t\t.then(function () {\n\t\t\t\tvar params = {\n\t\t\t\t\tvisitor_id: me._json.myself.studentId,\n\t\t\t\t\tactivity_id: me.activity_id,\n\t\t\t\t\tstudent_id: studentId,\n\t\t\t\t\t'StudentId': me._StudentId\n\t\t\t\t};\n\t\t\t\tif (params.visitor_id && params.activity_id && params.student_id) {\n\t\t\t\t\t$.get(\"/services/school/social/SharingPictureDescr/picturevisit\", params);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tvar methods = {\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\n\t\t\tme[STARTED] = true;\n\n\t\t\t//don't wait loadProfile to return so hub:memory/start/load/activity can be called\n\t\t\tloadProfiles.call(me)\n\t\t\t\t.then(render.bind(me));\n\n\t\t\treturn when.resolve();\n\t\t},\n\t\t\"sig/stop\": function () {\n\t\t\tvar me = this;\n\t\t\tme[STARTED] = false;\n\t\t\t$(document.body).off('click.' + CLS_ACT);\n\t\t},\n\n\t\t\"hub/activity/sharing-pic-desc/picture-wall/reload\": function (data) {\n\t\t\tvar me = this;\n\t\t\tme._dfdRendered.promise.then(function () {\n\t\t\t\tif (!me._json.others.length) {\n\t\t\t\t\tme[$ELEMENT].addClass(CLS_NONE);\n\t\t\t\t\tbackToDescribScreen.call(me);\n\t\t\t\t}\n\n\t\t\t\tif (data) {\n\t\t\t\t\tupdateMyProfile.call(me, data);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t'hub/st/picture-wall/show/myself': function () {\n\t\t\tvar me = this;\n\n\t\t\tme.$element.find(SEL_ME_LINK).trigger('click');\n\t\t},\n\t\t'hub:memory/context': function (context) {\n\t\t\tvar me = this;\n\t\t\tme._StudentId = idParser.parseId(context.user.id);\n\t\t\tme._json.cacheServer = context.cacheServer;\n\t\t\tme._contextLoaded.resolve();\n\t\t},\n\t\t'dom:.ets-profile-wall-item-placeholder/click': function (event) {\n\t\t\tevent.preventDefault();\n\t\t},\n\t\t'dom:.ets-profile-wall-item/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\t$e.stopPropagation();\n\t\t\tvar me = this;\n\t\t\tvar $target = $($e.currentTarget);\n\t\t\tvar $tooltip = $target.next();\n\t\t\tvar isMe = $target.closest(SEL_ME).length ? true : false;\n\t\t\tvar $parent = isMe ? $target.closest(SEL_ME) : $target.closest('li');\n\n\t\t\tcloseCompleteMsg.call(this);\n\n\t\t\tif (isMe) {\n\t\t\t\t$parent.toggleClass(CLS_ON);\n\t\t\t\tme[$ELEMENT].find(SEL_PROFILES).removeClass(CLS_ON);\n\t\t\t} else {\n\t\t\t\tme.$profileWall.css('zIndex', 2);\n\t\t\t\t$parent.siblings().removeClass(CLS_ON).end()\n\t\t\t\t\t.toggleClass(CLS_ON);\n\t\t\t\tme[$ELEMENT].find(SEL_ME).removeClass(CLS_ON);\n\t\t\t\t//track click pciture event log\n\t\t\t\tlogVisit.call(me, $target);\n\t\t\t}\n\n\n\t\t\tvar height = $tooltip.height();\n\t\t\tvar width = $tooltip.width();\n\n\t\t\t$tooltip.css('margin-top', -(height / 2));\n\n\t\t\tif (me.edge - $tooltip.offset().left < width) {\n\t\t\t\t$tooltip.addClass('ets-right-arrow');\n\t\t\t}\n\t\t},\n\t\t\"dom:.ets-profile-edit-button/click\": function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\t$e.stopPropagation();\n\t\t\tvar me = this;\n\n\t\t\tendingAnimation.call(me)\n\t\t\t\t.then(backToDescribScreen.bind(me));\n\t\t},\n\t\t'hub:memory/start/load/activity': function (activity) {\n\t\t\tthis.activity_id = idParser.parseId(activity.id);\n\t\t\tthis._activityLoaded.resolve();\n\t\t},\n\t\t'dom:.ets-msg-box-close-button/click': function ($e) {\n\t\t\t$e.preventDefault();\n\t\t\t$e.stopPropagation();\n\t\t\tvar me = this;\n\n\t\t\tcloseCompleteMsg.call(me);\n\n\t\t\t//show my profile\n\t\t\tshowMySelf.call(me);\n\t\t}\n\t};\n\n\n\treturn Widget.extend(ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge-new/main.html',[],function() { return function template(data) { var o = \"\";\nvar isAudioInputAvailable = data.references && data.references.aud && data.references.aud.url;\nvar isModelAudioInputAvailable = data.modelAud && data.modelAud.url;\no += \"\\n<div class=\\\"gud text-center\\\">\\n\\n    <div class=\\\"ets-act-spc-new ets-cf\\\">\\n\\n        \"; if (isModelAudioInputAvailable) { o += \"\\n            <div class=\\\"glyphicon glyphicon-volume-up active js-toggle\\\">\\n                <div class=\\\"tooltip-volume-up \\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"655958\\\">Listen to a model audio to what it sounds like</div>\\n            </div>\\n         \"; } o += \"\\n\\n\\n        <div class=\\\"ets-act-spc-l\\\">\\n\\n            \\n            <div class=\\\"ets-act-spc-content asr-output ets-act-disabled-\" + Boolean(isAudioInputAvailable) + \"\\\">\\n                <!-- asr component -->\\n                <div class=\\\"title\\\"><strong data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"655954\\\">Record your Audio</strong></div>\\n                <div class=\\\"ets-act-spc-asr\\\">\\n                    <div data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\n                    <div class=\\\"ets-tooltip\\\">\\n                        <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464924\\\">\\n                            Press to record\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                <div class=\\\"ets-act-record\\\">\\n                    <div class=\\\"ets-tooltip ets-tooltip-green\\\">\\n                        <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464925\\\">\\n                            Listen to your recording. You can record again or press DONE.\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                \"; if (isAudioInputAvailable) { o += \"\\n                    <div class=\\\"icon-replay-audioin please-play\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"655956\\\">Re-play Audio</div>\\n                \"; } o += \"\\n            </div>\\n\\n            \"; if (isAudioInputAvailable) { o += \"\\n                <div class=\\\"ets-act-spc-content audio-input\\\">\\n                    <!-- audio-input component-->\\n                        <div class=\\\"title\\\"><strong data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"655957\\\" >Listen to this audio</strong></div>\\n\\n                        <div class=\\\"swing-container\\\">\\n                            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                                   data-src=\\\"\" + data.references.aud.url + \"\\\" class=\\\"ets-ap\\\" type=\\\"audio/mpeg\\\"\\n                                   controls=\\\"controls\\\"></audio>\\n\\n                           <div class=\\\"ets-tooltip\\\">\\n                                <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464923\\\"></div>\\n                            </div>\\n\\n                        </div>\\n\\n\\n                </div>\\n             \"; } o += \"\\n\\n        </div>\\n\\n        <div class=\\\"ets-act-spc-r\\\">\\n\\n        \\n            \"; if (isModelAudioInputAvailable) { o += \"\\n                <div class=\\\"glyphicon glyphicon-arrow-left active js-toggle\\\"></div>\\n\\n                    <!-- model-audio-input component-->\\n\\n                <div class=\\\"ets-act-spc-content model-audio-input\\\" >\\n                    <div class=\\\"title\\\"><strong data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"655955\\\">Model Audio</strong></div>\\n\\n                    <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                           data-src=\\\"\" + data.modelAud.url + \"\\\" class=\\\"ets-ap\\\" type=\\\"audio/mpeg\\\"\\n                           controls=\\\"controls\\\"></audio>\\n                </div>\\n\\n                \\n            \"; } o += \"\\n\\n         </div>\\n\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/speaking-challenge-new/main',[\n\t'jquery',\n\t'poly',\n\t'school-ui-activity/activity/base/main',\n\t'template!./main.html',\n\t'school-ui-shared/enum/rating-source-type'\n], function ($, poly, Widget, tTemplate, ratingSouceType) {\n\t'use strict';\n\n\tvar $ELEMENT = '$element';\n\n\tvar ELEMENTS_CACHE = '_elementsCache';\n\tvar AUDIO_STATE = '_audioState';\n\tvar MODEL_AUDIO_STATE = '_audioState';\n\n\tvar SEL_RIGHT = '.ets-act-spc-r';\n\tvar SEL_ASR = '.ets-act-spc-asr';\n\tvar SEL_MEJS = '.mejs-container';\n\tvar SEL_RECORD = '.ets-act-record';\n\tvar SEL_TOOLTIP = '.ets-tooltip';\n\tvar SEL_TOOLTIP_RECORD = '.ets-tooltip-green';\n\tvar SEL_AP = '.ets-ap';\n\tvar ICON_VALUE = '.glyphicon-volume-up';\n\tvar AUDIO_INPUT = '.audio-input';\n\tvar MODEL_AUDIO_INPUT = '.model-audio-input';\n\tvar ASR_OUTPUT = '.asr-output';\n\tvar CLS_AP_CONTAINER = 'ets-ap-con';\n\tvar CLS_DISABLED = 'ets-disabled';\n\n\tvar HUB_ASR_SETTING = 'asr/ui/setting';\n\tvar HUB_ASR_STOP_PLAYBACK = 'asr/stopPlayback';\n\tvar HUB_ASR_PLAYBACK = 'asr/startPlayback';\n\tvar WIDGET_PATH_AUDIO_SHELL = 'school-ui-activity/shared/audio/audio-shell';\n\n\tvar IS_CORRECT = '_isCorrect';\n\n\n\tfunction initChainFn() {\n\t\tvar me = this;\n\t\tfor (var i = 0, l = arguments.length; i < l; ++i) {\n\t\t\targuments[i][0].call(me, arguments[i][1]);\n\t\t}\n\t}\n\n\n\tfunction findElem(selector) {\n\t\tvar me = this;\n\t\tvar $childElement = me[ELEMENTS_CACHE][selector];\n\t\tif ($childElement) { // cached elements always have length > 0\n\t\t\treturn $childElement;\n\t\t}\n\t\t$childElement = me[$ELEMENT].find(selector);\n\t\tif ($childElement.length > 0) {\n\t\t\tme[ELEMENTS_CACHE][selector] = $childElement;\n\t\t}\n\t\treturn $childElement;\n\t}\n\n\tfunction setupASR() {\n\t\tvar me = this;\n\t\tme.publish(HUB_ASR_SETTING, function (result, guid) {\n\t\t\tshowRecord.call(me, guid);\n\t\t}, {\n\t\t\tprons: '',\n\t\t\tautostopTime: 180000,\n\t\t\tdisableScoreRecording: true,\n\t\t\tplayback: false\n\t\t}, {\n\t\t\tasrFailCb: function () {\n\t\t\t\tme._json.content = {};\n\t\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\t\tme.completed(true);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction toggleAudioInTooltip(isShow) {\n\t\tvar me = this;\n\n\t\tvar $elem = findElem.call(me, [AUDIO_INPUT, SEL_TOOLTIP].join(' '));\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isShow && !me._isOpen) {\n\t\t\t$elem.fadeIn();\n\t\t} else {\n\t\t\t$elem.fadeOut();\n\t\t}\n\t}\n\n\tfunction toogleModelAudioInButton(isActive) {\n\t\tvar me = this;\n\n\t\tvar $elem = findElem.call(me, SEL_MEJS);\n\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isActive) {\n\t\t\t$elem.addClass('mejs-disabled');\n\t\t\t$elem.find('.mejs-playpause-button').children().prop('disabled', true);\n\t\t} else {\n\t\t\t$elem.removeClass('mejs-disabled');\n\t\t\t$elem.find('.mejs-playpause-button').children().prop('disabled', false);\n\t\t}\n\t}\n\n\n\tfunction toggleASRTooltip(isShow) {\n\t\tvar me = this;\n\n\t\tvar $elem =findElem.call(me, [SEL_ASR, SEL_TOOLTIP].join(' '));\n\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isShow) {\n\t\t\t$elem.fadeIn();\n\t\t} else {\n\t\t\t$elem.fadeOut();\n\t\t}\n\t}\n\n\tfunction toggleModelAudioInTooltip(isShow) {\n\t\tvar me = this;\n\n\t\tvar $elem = findElem.call(me, '.tooltip-volume-up');\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isShow) {\n\t\t\t$elem.delay(500).fadeOut();\n\t\t} else {\n\t\t\t$elem.delay(500).fadeIn();\n\t\t}\n\t}\n\n\tfunction togglePauseAudio(isPause) {\n\t\tvar me = this;\n\t\tvar $elem = findElem.call(me, '.icon-replay-audioin');\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isPause) {\n\t\t\t$elem.addClass('please-pause');\n\t\t} else {\n\t\t\t$elem.removeClass('please-pause');\n\t\t}\n\n\t}\n\n\tfunction toggleReplyAudio(isActive) {\n\t\tvar me = this;\n\t\tvar $elem = findElem.call(me, '.icon-replay-audioin');\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isActive) {\n\t\t\t$elem.removeClass('status-disabled');\n\t\t} else {\n\t\t\t$elem.addClass('status-disabled');\n\t\t}\n\t}\n\n\tfunction toggleRecordTooltip(isShow) {\n\t\tvar me = this;\n\n\t\t//init selector\n\t\tvar $elem = findElem.call(me, SEL_TOOLTIP_RECORD);\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isShow) {\n\t\t\t$elem.fadeIn();\n\t\t} else {\n\t\t\t$elem.fadeOut();\n\t\t}\n\t}\n\n\tfunction recordSlideOut($el) {\n\t\tvar me = this;\n\n\t\tvar $asr = findElem.call(me, SEL_ASR);\n\t\tif ($asr.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t$el.animate({\n\t\t\t'margin-left': -72,\n\t\t\t'opacity': 1\n\t\t}, 'slow', function () {\n\t\t\ttoggleRecordTooltip.call(me, true);\n\t\t\tsetTimeout(function () {\n\t\t\t\ttoggleRecordTooltip.call(me, false);\n\t\t\t}, 5000);\n\n\t\t\t$asr.css({\n\t\t\t\t'z-index': 'auto'\n\t\t\t});\n\t\t});\n\n\t\t$asr.animate({\n\t\t\t'margin-left': -15\n\t\t}, 'slow');\n\t}\n\n\tfunction replaceRecord(guid) {\n\t\tvar me = this;\n\n\t\tvar $record = findElem.call(me, SEL_RECORD);\n\t\tvar $asr = findElem.call(me, SEL_ASR);\n\t\tif ($record.length === 0 || $asr.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t$record.animate({\n\t\t\t'margin-left': -41,\n\t\t\t'opacity': 0.5\n\t\t}, 'slow', function () {\n\t\t\t$(this).children('.' + CLS_AP_CONTAINER).remove();\n\t\t\tme._hasRecord = false;\n\t\t\tshowRecord.call(me, guid);\n\t\t});\n\n\t\t$asr.css({\n\t\t\t'z-index': 1\n\t\t}).animate({\n\t\t\t'margin-left': -38\n\t\t}, 'slow');\n\t}\n\n\tfunction createNewRecord(guid) {\n\t\tvar me = this;\n\n\t\tvar $record = findElem.call(me, SEL_RECORD);\n\t\tif ($record.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t$record.prepend('<div class=\"' + CLS_AP_CONTAINER + '\"></div>'); //recordered audio\n\n\t\tvar $container = me[$ELEMENT].find('.' + CLS_AP_CONTAINER);\n\t\t$container\n\t\t\t.unweave()\n\t\t\t.then(function () {\n\t\t\t\treturn $container\n\t\t\t\t\t.data('option', {\n\t\t\t\t\t\t'_playHandler': function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t\ttoggleRecordTooltip.call(me, false);\n\t\t\t\t\t\t\ttoggleReplyAudio.call(me, false);\n\t\t\t\t\t\t\ttoogleModelAudioInButton.call(me, false);\n\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'_pauseHandler': function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t\ttoggleReplyAudio.call(me, true);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'guid': guid\n\t\t\t\t\t})\n\t\t\t\t\t.attr('data-weave', WIDGET_PATH_AUDIO_SHELL + '(option)')\n\t\t\t\t\t.weave();\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\trecordSlideOut.call(me, $record); //animate recorded audio\n\n\t\t\t\tme._hasRecord = true;\n\t\t\t\tme.items().answered(true);\n\t\t\t});\n\t}\n\n\tfunction showRecord(guid) {\n\t\tvar me = this;\n\t\tif (me._hasRecord) {\n\t\t\treplaceRecord.call(this, guid);\n\t\t} else {\n\t\t\tcreateNewRecord.call(this, guid);\n\t\t}\n\t}\n\n\tfunction animateIcon() {\n\t\tvar me = this;\n\t\tvar t = 800;\n\t\tvar $audio = findElem.call(me, AUDIO_INPUT);\n\t\tvar $asr = findElem.call(me, ASR_OUTPUT);\n\t\tif ($audio.length === 0 || $asr.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t$audio.find('.title').fadeOut();\n\n\t\tif (isIE() === 8) {\n\t\t\t$audio.find('.swing-container').fadeOut(t);\n\t\t} else {\n\t\t\t$audio.find('.swing-container').hide(t);//swing animation\n\t\t\t$audio.find('button').addClass('transform'); //css3 animation  only for moder browser\n\t\t}\n\n\t\t$asr.show({duration: t, easing: 'linear'});\n\t}\n\n\tfunction isIE() {\n\t\tvar myNav = navigator.userAgent.toLowerCase();\n\t\treturn (myNav.indexOf('msie') !== -1) ? parseInt(myNav.split('msie')[1]) : false;\n\t}\n\n\tfunction toggleIcon(isActive) {\n\t\tvar me = this;\n\n\t\tvar $elem = findElem.call(me, ICON_VALUE);\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isActive) {\n\t\t\t$elem.addClass('active');\n\t\t} else {\n\t\t\t$elem.removeClass('active');\n\t\t}\n\t}\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\t\tme[ELEMENTS_CACHE] = {};\n\t\treturn me.html(tTemplate, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction setASRstatus(state) {\n\t\tvar me = this;\n\t\tme.publish('asr/ui/states/changed', state);\n\n\t\tvar $elem = findElem.call(me, [SEL_RECORD, SEL_AP].join(' '));\n\n\t\tif ($elem.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (state === 'DISABLE') {\n\t\t\t$elem.addClass(CLS_DISABLED);\n\t\t\ttoggleRecordTooltip.call(me, false);\n\t\t} else {\n\t\t\t$elem.removeClass(CLS_DISABLED);\n\t\t}\n\t}\n\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tvar $modelAudioContainer = me[$ELEMENT].find(MODEL_AUDIO_INPUT).find(SEL_MEJS);\n\t\t$modelAudioContainer.find('.mejs-volume-button').remove();\n\t\t$modelAudioContainer.find('.mejs-horizontal-volume-slider').remove();\n\n\t\tvar audioContainer = me[$ELEMENT].find(AUDIO_INPUT).find(SEL_MEJS);\n\t\taudioContainer.find('.mejs-time').remove();\n\t\taudioContainer.find('.mejs-time-rail').remove();\n\t\taudioContainer.find('.mejs-volume-button').remove();\n\t\taudioContainer.find('.mejs-horizontal-volume-slider').remove();\n\n\t\t//init ASR\n\t\tsetupASR.call(me);\n\t}\n\n\t// ## Constructor\n\tfunction Ctor() {\n\t\tvar me = this;\n\n\t\tme.type(2);\n\n\t\tme._hasRecord = false;\n\t\tme._isOpen = false;\n\t\tme._state = '';\n\n\t\tme[ELEMENTS_CACHE] = {};\n\t\tme[AUDIO_STATE] = null;\n\t\tme[MODEL_AUDIO_STATE] = null;\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/stop': function onStop() {\n\t\t\tvar me = this;\n\t\t\tme[ELEMENTS_CACHE] = {};\n\n\t\t\t// Stop the record if leave the activity\n\t\t\tvar $record = me[$ELEMENT].find('.' + CLS_AP_CONTAINER);\n\n\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\treturn $record.unweave();\n\t\t},\n\n\n\t\t'hub/asr/ui/states/changed': function (state) {\n\t\t\tvar me = this;\n\t\t\tme._state = state;\n\n\t\t\tif (state === 'PREPARING') {\n\t\t\t\tinitChainFn.call(me, [toggleRecordTooltip, false], [toggleASRTooltip, false], [toggleReplyAudio, false]);\n\t\t\t}\n\n\t\t\tif (state === 'WARNING' || state === 'ERROR' || state === 'DOWN') {\n\t\t\t\ttoggleASRTooltip.call(me, false);\n\t\t\t}\n\n\t\t\tif (state === 'RECORDING') {\n\t\t\t\ttoogleModelAudioInButton.call(me, false);\n\t\t\t}\n\n\t\t\tif (state === 'PROCESSING') {\n\t\t\t\ttoggleReplyAudio.call(me, true);\n\t\t\t}\n\n\t\t\tif (state === 'PREPARING' || state === 'DISABLE') {\n\t\t\t\ttoggleIcon.call(me, false);\n\t\t\t}\n\n\t\t\tif (state === 'NORMAL') {\n\t\t\t\tinitChainFn.call(me, [toogleModelAudioInButton, true], [toggleReplyAudio, true], [toggleIcon, true]);\n\t\t\t}\n\t\t},\n\n\t\t'hub/activity/epaper/expanding': function () {\n\t\t\tvar me = this;\n\t\t\tinitChainFn.call(me, [toggleIcon, false], [toggleASRTooltip, false], [toggleModelAudioInTooltip, false]);\n\t\t},\n\n\t\t'hub/activity/epaper/folding': function () {\n\t\t\tvar me = this;\n\t\t\tinitChainFn.call(me, [toggleIcon, true], [toggleModelAudioInTooltip, true], [toggleRecordTooltip, false]);\n\n\t\t\tif (me._state !== 'RECORDING') {\n\t\t\t\ttoggleASRTooltip.call(this, true);\n\t\t\t}\n\t\t},\n\n\t\t'hub/rating/sourceType': function () {\n\t\t\treturn [ratingSouceType['ASR_SPEAKING']];\n\t\t},\n\n\t\t'hub/audio/shell/play/complete': function (/*guid*/) {\n\t\t\tvar me = this;\n\t\t\ttoggleReplyAudio.call(me, true);\n\t\t},\n\n\t\t'dom:.js-toggle/click': function(event) {\n\t\t\tvar me = this;\n\t\t\tvar $button = $(event.currentTarget);\n\t\t\tif (!$button.hasClass('active')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar $modelPlayer = findElem.call(this, [MODEL_AUDIO_INPUT, SEL_AP].join(' '));\n\t\t\tfindElem.call(me, SEL_RIGHT).animate(\n\t\t\t\t{'margin-left': !me._isOpen ? 453 : 0},\n\t\t\t\t{\n\t\t\t\t\t'duration': 'slow',\n\t\t\t\t\t'complete': function () {\n\t\t\t\t\t\tme._isOpen = !me._isOpen;\n\n\t\t\t\t\t\tif (me._isOpen) {\n\t\t\t\t\t\t\t$modelPlayer.trigger('player/play');\n\t\t\t\t\t\t\ttoggleAudioInTooltip.call(me, false);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (me._state !== 'RECORDING') {\n\t\t\t\t\t\t\t\t$modelPlayer.trigger('player/pause');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttoggleAudioInTooltip.call(me, true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttoggleModelAudioInTooltip.call(me, !me._isOpen);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\t'dom:.icon-replay-audioin/click': function (event) {\n\t\t\tvar $button = $(event.currentTarget);\n\t\t\tif ($button.hasClass('status-disabled')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar $player = findElem.call(this, [AUDIO_INPUT, SEL_AP].join(' '));\n\t\t\tif ($button.hasClass('please-pause')) {\n\t\t\t\t$player.trigger('player/pause');\n\t\t\t} else {\n\t\t\t\t$player.trigger('player/play');\n\t\t\t}\n\t\t},\n\t\t'dom:.model-audio-input .ets-ap/media/play': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[MODEL_AUDIO_STATE] = e['type'];\n\t\t\tinitChainFn.call(me, [setASRstatus, 'DISABLE'], [toggleASRTooltip, false], [toggleRecordTooltip, false])\n\t\t},\n\t\t'dom:.model-audio-input .ets-ap/media/pause': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[MODEL_AUDIO_STATE] = e['type'];\n\t\t\tsetASRstatus.call(me, 'NORMAL');\n\n\t\t\tsetTimeout(function () {\n\t\t\t\t//if the next event for audio-in not play, then appeat tooltip\n\t\t\t\ttoggleASRTooltip.call(me, me[AUDIO_STATE] !== 'play');\n\t\t\t}, 0);\n\t\t},\n\t\t'dom:.model-audio-input .ets-ap/media/ended': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[MODEL_AUDIO_STATE] = e['type'];\n\t\t\tinitChainFn.call(me, [setASRstatus, 'NORMAL'], [toggleASRTooltip, true]);\n\t\t},\n\t\t'dom:.audio-input .ets-ap/media/play': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[AUDIO_STATE] = event['type'];\n\t\t\tinitChainFn.call(me, [setASRstatus, 'DISABLE'], [toggleIcon, false], [toggleModelAudioInTooltip, false], [toggleASRTooltip, false], [togglePauseAudio, true], [toggleAudioInTooltip, false]);\n\t\t},\n\t\t'dom:.audio-input .ets-ap/media/pause': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[AUDIO_STATE] = event['type'];\n\t\t\tinitChainFn.call(me, [setASRstatus, 'NORMAL'], [toggleIcon, true], [toggleModelAudioInTooltip, true], [togglePauseAudio, false]);\n\n\t\t\tsetTimeout(function () {\n\t\t\t\t//if the next event 'ended', dont appear tooltip\n\t\t\t\ttoggleAudioInTooltip.call(me, me[AUDIO_STATE] !== 'ended');\n\t\t\t}, 0);\n\n\t\t\tsetTimeout(function () {\n\t\t\t\t//if the next event for model-audio not play, then appeat tooltip\n\t\t\t\ttoggleASRTooltip.call(me, me[MODEL_AUDIO_STATE] !== 'play')\n\t\t\t}, 0);\n\t\t},\n\t\t'dom:.audio-input .ets-ap/media/ended': function (event) {\n\t\t\tvar me = this;\n\t\t\tme[AUDIO_STATE] = event['type'];\n\t\t\tinitChainFn.call(me, [setASRstatus, 'NORMAL'], [toggleASRTooltip, true], [toggleIcon, true], [toggleModelAudioInTooltip, true], [togglePauseAudio, false], [toggleAudioInTooltip, false], [animateIcon, null])\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/speaking-challenge/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-spc ets-cf\\\">\\n    \"; if (data.references.aud) { o += \"\\n    <div class=\\\"ets-act-spc-l\\\">\\n        <div class=\\\"ets-act-spc-content\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" + data.references.aud.url + \"\\\" class=\\\"ets-ap\\\" type=\\\"audio/mpeg\\\"\\n                   controls=\\\"controls\\\"></audio>\\n\\n            <div class=\\\"ets-tooltip\\\">\\n                <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464923\\\">\\n                    First, you listen to the dailog\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n    \"; } o += \"\\n    <div class=\\\"ets-act-spc-r\\\">\\n\\n        <div class=\\\"ets-act-spc-content\\\">\\n            <!-- asr component -->\\n            <div class=\\\"ets-act-spc-asr\\\">\\n                <div data-weave=\\\"school-ui-activity/shared/asr/asr-ui\\\"></div>\\n                <div class=\\\"ets-tooltip\\\">\\n                    <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464924\\\">\\n                        Press to record\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <div class=\\\"ets-act-record\\\">\\n                <div class=\\\"ets-tooltip ets-tooltip-green\\\">\\n                    <div class=\\\"ets-tooltip-content\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464925\\\">\\n                        Listen to your recording. You can record again or press DONE.\\n                    </div>\\n                </div>\\n            </div>\\n            \\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/speaking-challenge/main',[\n\t'jquery',\n\t'poly',\n\t'school-ui-activity/activity/base/main',\n\t\"template!./main.html\",\n\t'school-ui-shared/enum/rating-source-type'\n], function ($, poly, Widget, tTemplate, ratingSouceType) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar SEL_LEFT = '.ets-act-spc-l';\n\tvar SEL_RIGHT = '.ets-act-spc-r';\n\tvar SEL_ASR = '.ets-act-spc-asr';\n\tvar SEL_MEJS = '.mejs-container';\n\tvar SEL_RECORD = '.ets-act-record';\n\tvar SEL_TOOLTIP = '.ets-tooltip';\n\tvar SEL_TOOLTIP_RECORD = '.ets-tooltip-green';\n\n\tvar CLS_AP_CONTAINER = \"ets-ap-con\";\n\n\tvar HUB_ASR_SETTING = \"asr/ui/setting\";\n\tvar HUB_ASR_STOP_PLAYBACK = \"asr/stopPlayback\";\n\tvar HUB_ASR_PLAYBACK = \"asr/startPlayback\";\n\tvar WIDGET_PATH_AUDIO_SHELL = \"school-ui-activity/shared/audio/audio-shell\";\n\n\tvar IS_CORRECT = \"_isCorrect\";\n\n\tfunction setupASR() {\n\t\tvar me = this;\n\t\tme.publish(HUB_ASR_SETTING, function (result, guid) {\n\t\t\tshowRecord.call(me, guid);\n\t\t}, {\n\t\t\tprons: \"\",\n\t\t\tautostopTime: 180000,\n\t\t\tdisableScoreRecording: true,\n\t\t\tplayback: false\n\t\t}, {\n\t\t\tasrFailCb: function () {\n\t\t\t\tme._json.content = {};\n\t\t\t\tme._json.content[IS_CORRECT] = true;\n\t\t\t\tme.completed(true);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction hideAudioTooltip() {\n\t\tvar me = this;\n\t\tme._timer = window.setTimeout(function () {\n\t\t\tme[$ELEMENT].find([SEL_LEFT, SEL_TOOLTIP].join(' ')).fadeOut();\n\t\t}, 5000);\n\t}\n\n\tfunction hideRecordTooltip() {\n\t\tvar me = this;\n\t\tme.$recordTooltip.delay(5000).fadeOut();\n\t}\n\n\tfunction showASRTooltip() {\n\t\tif (!this._ASRTooltip && this.$asrTooltip) {\n\t\t\tthis.$asrTooltip.css('display', 'block');\n\t\t\thideASRTooltip.call(this);\n\t\t\tthis._ASRTooltip = true;\n\t\t}\n\t}\n\n\tfunction hideASRTooltip() {\n\t\tvar me = this;\n\t\tme.$asrTooltip.delay(5000).fadeOut();\n\t}\n\n\tfunction showASRSection() {\n\t\tvar me = this;\n\n\t\tif (!me._ASRShowed) {\n\t\t\t// ASR section will slide out after 1000 ms\n\t\t\tme[$ELEMENT].find(SEL_RIGHT)\n\t\t\t\t.delay(1000).animate({\n\t\t\t\t\t'margin-left': 110\n\t\t\t\t}, 'slow', function () {\n\t\t\t\t\t$(this).css('z-index', 2);\n\t\t\t\t\thideASRTooltip.call(me);\n\t\t\t\t});\n\t\t}\n\t}\n\n\tfunction recordSlideOut($el) {\n\t\tvar me = this;\n\t\t$el.animate({\n\t\t\t'margin-left': 8\n\t\t}, 'slow', function () {\n\t\t\tme[$ELEMENT].find(SEL_TOOLTIP_RECORD).fadeIn();\n\t\t\thideRecordTooltip.call(me);\n\t\t\tme.$asr.css({\n\t\t\t\t'z-index': 'auto'\n\t\t\t});\n\t\t});\n\n\t\tme.$asr.animate({\n\t\t\t'margin-left': -61\n\t\t}, 'slow');\n\t}\n\n\tfunction replaceRecord(guid) {\n\t\tvar me = this;\n\n\t\tme.$record.animate({\n\t\t\t'margin-left': -27\n\t\t}, 'slow', function () {\n\t\t\t$(this).children('.' + CLS_AP_CONTAINER).remove();\n\t\t\tme._hasRecord = false;\n\t\t\tshowRecord.call(me, guid);\n\t\t});\n\n\t\tme.$asr.css({\n\t\t\t'z-index': 1\n\t\t}).animate({\n\t\t\t'margin-left': -38\n\t\t}, 'slow');\n\t}\n\n\tfunction createNewRecord(guid) {\n\t\tvar me = this;\n\n\t\tme.$record.prepend('<div class=\"' + CLS_AP_CONTAINER + '\"></div>');\n\n\t\tvar $container = me[$ELEMENT].find(\".\" + CLS_AP_CONTAINER);\n\t\t$container\n\t\t\t.unweave()\n\t\t\t.then(function () {\n\t\t\t\treturn $container\n\t\t\t\t\t.data(\"option\", {\n\t\t\t\t\t\t\"_playHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t\tme[$ELEMENT].find(SEL_TOOLTIP_RECORD).fadeOut();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"_pauseHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"guid\": guid\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"data-weave\", WIDGET_PATH_AUDIO_SHELL + \"(option)\")\n\t\t\t\t\t.weave()\n\t\t\t\t\t.then(function () {\n\t\t\t\t\t\trecordSlideOut.call(me, me.$record);\n\n\t\t\t\t\t\tme._hasRecord = true;\n\t\t\t\t\t\tme.items().answered(true);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tfunction showRecord(guid) {\n\t\tvar me = this;\n\n\t\tif (me._hasRecord) {\n\t\t\t// record slides in\n\t\t\treplaceRecord.call(this, guid);\n\t\t} else {\n\t\t\tcreateNewRecord.call(this, guid);\n\t\t}\n\n\t}\n\n\t// # Render Method\n\n\t// Render method renders the UI according to the json data we\n\t// created in filterData().\n\tfunction render() {\n\t\tvar me = this;\n\n\t\treturn me.html(tTemplate, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\n\t\tvar $container = me[$ELEMENT].find(SEL_MEJS);\n\t\tme._interval = window.setInterval(function () {\n\t\t\tif ($container.is(':visible')) {\n\t\t\t\thideAudioTooltip.call(me);\n\t\t\t\twindow.clearInterval(me._interval);\n\t\t\t}\n\t\t}, 4);\n\n\t\t// remove unneccessary element\n\t\t$container.find('.mejs-time').remove();\n\t\t$container.find('.mejs-time-rail').remove();\n\t\t$container.find('.mejs-volume-button').remove();\n\t\t$container.find('.mejs-horizontal-volume-slider').remove();\n\n\t\t//asr setup\n\t\tsetupASR.call(me);\n\n\t\tme.$record = me[$ELEMENT].find(SEL_RECORD);\n\t\tme.$asr = me[$ELEMENT].find(SEL_ASR);\n\n\t\tme.$asrTooltip = me[$ELEMENT].find([SEL_ASR, SEL_TOOLTIP].join(' '));\n\t\tme.$recordTooltip = me[$ELEMENT].find(SEL_TOOLTIP_RECORD);\n\t}\n\n\t// ## Constructor\n\tfunction Ctor() {\n\t\tvar me = this;\n\n\t\tme.type(3);\n\n\t\tme._ASRShowed = false;\n\t\tme._hasRecord = false;\n\t\tme._ASRTooltip = false;\n\t}\n\n\t// ## methods\n\tvar methods = {\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function () {\n\t\t\tvar me = this;\n\t\t\twindow.clearTimeout(me._timer);\n\t\t\twindow.clearInterval(me._interval);\n\t\t},\n\t\t'sig/stop': function onStop() {\n\t\t\tvar me = this;\n\n\t\t\t// Stop the record if leave the activity\n\t\t\tvar $record = me[$ELEMENT].find('.' + CLS_AP_CONTAINER);\n\n\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\treturn $record.unweave();\n\t\t},\n\n\t\t\"hub/asr/ui/states/changed\": function (state) {\n\t\t\tvar me = this;\n\n\t\t\tif (state === 'PREPARING') {\n\t\t\t\tme.$asr.find(SEL_TOOLTIP).fadeOut();\n\t\t\t\tme.$asrTooltip.hide();\n\t\t\t\tme.$recordTooltip.hide();\n\t\t\t\tme._ASRTooltip = true;\n\t\t\t}\n\t\t},\n\t\t'hub/activity/epaper/expanding': function () {\n\t\t\tshowASRTooltip.call(this);\n\t\t},\n\t\t'hub/rating/sourceType': function () {\n\t\t\treturn [ratingSouceType['ASR_SPEAKING']];\n\t\t},\n\n\n\t\t'dom:.ets-ap/media/play': function() {\n\t\t\t// hide tooltip\n\t\t\tthis[$ELEMENT].find([SEL_LEFT, SEL_TOOLTIP].join(' ')).fadeOut();\n\t\t\t// show ASR section\n\t\t\tshowASRSection.call(this);\n\t\t},\n\t\t'dom:.ets-ap/media/pause': function() {\n\t\t\tshowASRTooltip.call(this);\n\t\t},\n\t\t'dom:.ets-ap/media/ended': function() {\n\t\t\tshowASRTooltip.call(this);\n\t\t}\n\t};\n\n\treturn Widget.extend(Ctor, methods);\n});\n\n",
    "/**\n * # text select shared constant module definition\n */\ndefine('school-ui-activity/activity/text-select/const',{\n\tSLASH: \"/\",\n\tDOUBLE_SLASH: \"//\"\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/text-select/main.html',[],function() { return function template(data) { var o = \"\";\n    var model = data,\n        hasSharedAudio = model.hasSharedAudio,\n        weaver = model.weaver;\no += \"\\n\\n<div class=\\\"ets-act-tsl\\\">\\n    <div class=\\\"ets-act-tsl-main\\\">\\n        \";if(hasSharedAudio) {o += \"\\n        <div class=\\\"ets-act-tsl-audio ets-shared\\\">\\n            <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n                <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                       data-src=\\\"\" +model.ref.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                       class=\\\"ets-ap\\\"></audio>\\n            </div></div>\\n        </div>\\n        \";}o += \"\\n        <div class=\\\"ets-act-tsl-view\\\" data-weave=\\\"school-ui-activity/activity/text-select/text-select\\\"></div>\\n    </div>\\n    \";if(model.isMultiType && model.isGradeMode) {o += \"\\n    <div class=\\\"ets-act-tsl-ft\" +(hasSharedAudio ? ' ets-shrink' : '')+ \"\\\">\\n        <div class=\\\"ets-act-tpg-b\\\" data-weave=\\\"school-ui-activity/shared/toggle-slide/main\\\"></div>\\n        <div class=\\\"ets-ar\\\" data-at-id=\\\"pnl-answer-remaining\\\" data-weave=\\\"school-ui-activity/shared/rolling-number/main\\\"></div>\\n        <div class=\\\"ets-cf\\\"></div>\\n    </div>\\n    \";}o += \"\\n</div>\"; return o; }; });\n",
    "/**\n * text select main module definition\n */\ndefine('school-ui-activity/activity/text-select/main',[\n\t\"jquery\",\n\t\"poly\",\n\t\"when\",\n\t\"school-ui-activity/activity/base/main\",\n\t\"troopjs-core/component/factory\",\n\t\"template!./main.html\",\n\t\"./const\"\n], function TextSelectModule($, poly, when, Widget, Factory, tTemplate, CONST) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\tvar SLASH = CONST.SLASH,\n\t\tDOUBLE_SLASH = CONST.DOUBLE_SLASH;\n\tvar TYPE_MULTIPLE = \"multiple\",     //multiple select in each question(phrase)\n\t\tTYPE_SINGLE = \"single\",         //single select in each question(phrase)\n\t\tMODE_ANY = \"any\",               //select word freely\n\t\tMODE_SOME = \"some\";             //selected word should match answer\n\n\t/*!\n\t * check text select type by scoring correct answer count\n\t * if any one phrase's correct answer count is great than 1/non-grade return \"multiple\" else \"single\"\n\t *\n\t * @param {Object} scoring\n\t * @return {String} \"multiple\"/\"single\"\n\t *\n\t * NOTE: call me BEFORE shuffle data\n\t */\n\tfunction checkType(scoring) {\n\t\tif (!scoring) {\n\t\t\treturn TYPE_MULTIPLE;\n\t\t}\n\n\t\tvar type = TYPE_SINGLE;\n\t\t$.each(scoring.phrases || [], function (i, scroingPhrase) {\n\t\t\tif ((scroingPhrase.items || []).length > 1) {\n\t\t\t\ttype = TYPE_MULTIPLE;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn type;\n\t}\n\n\t/*!\n\t * check the 1st scoring phrase's 1st word\n\t * to match content phrase word to see if it is in select any/given(some) word scenario\n\t *\n\t * CONDITION: correct word's prev/next/self* word is slash(/) text or not\n\t *\n\t * @param {Object} scoring\n\t * @param {Array} phrases\n\t * @return {String} \"any\"/\"some\"\n\t *\n\t * NOTE: this is a safer way and you had BETTER call me BEFORE shuffle data\n\t */\n\tfunction checkMode(scoring, questionPhrases) {\n\t\tvar mode = MODE_ANY;\n\t\tif (!scoring || !scoring.phrases || !scoring.phrases.length) {\n\t\t\treturn mode;\n\t\t}\n\n\t\tfunction getWordNum(wordId) {\n\t\t\treturn +(\"\" + wordId).split(\"_\")[2];\n\t\t}\n\n\t\tvar scoringPhrase = scoring.phrases[0] || {};\n\t\tvar scoringWords = scoringPhrase.items || [];\n\n\t\tvar continuesScoringWordIds = [scoringWords[0]._id];\n\n\t\t// for continuous many answer case\n\t\tfor (var index = 1; index < scoringWords.length; index++) {\n\t\t\tvar prevScoringWordId = scoringWords[index - 1]._id;\n\t\t\tvar nextScoringWordId = scoringWords[index]._id;\n\n\t\t\tif (getWordNum(nextScoringWordId) - getWordNum(prevScoringWordId) === 1) {\n\t\t\t\tcontinuesScoringWordIds.push(nextScoringWordId);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//if continuesScoringWordIds close to SLASH in question words, or includes SLASH, then mode=MODE_SOME\n\t\t$.each(questionPhrases || [], function (i, questionPhrase) {\n\t\t\tif (questionPhrase._id !== scoringPhrase._id) {\n\t\t\t\treturn; //continue to next question phrase\n\t\t\t}\n\n\t\t\tvar questionWords = questionPhrase.items, k = 0;\n\t\t\t$.each(questionWords || [], function (questionWordIndex, questionWord) {\n\t\t\t\tvar text = questionWord.txt || \"\";\n\t\t\t\tif (questionWord._id === continuesScoringWordIds[k]) {\n\t\t\t\t\tif ((questionWords[questionWordIndex - 1] || {}).txt === SLASH ||\n\t\t\t\t\t\t(questionWords[questionWordIndex + 1] || {}).txt === SLASH ||\n\t\t\t\t\t\t(text !== SLASH && text !== DOUBLE_SLASH && text.indexOf(SLASH) >= 0)) {\n\t\t\t\t\t\tmode = MODE_SOME;\n\t\t\t\t\t\treturn false;   //end question word iteration\n\t\t\t\t\t}\n\t\t\t\t\tif (++k >= continuesScoringWordIds.length) {\n\t\t\t\t\t\treturn false;   //end question word iteration\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn false;   //end question phrase iteration\n\t\t});\n\n\t\treturn mode;\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function () {\n\t\t\tvar me = this;\n\t\t\tvar activityContent = me._json || {};\n\t\t\tvar ref = activityContent.references;\n\t\t\tvar filterOptions = activityContent.filterOptions;\n\t\t\tvar scoring = activityContent.scoring;\n\t\t\tvar questionPhrases = (activityContent.content || {}).phrases || [];\n\n\t\t\tme.isGradeMode = Boolean(me.hasScoring);\n\n\t\t\t// init activity type\n\t\t\tme.isMultiType = TYPE_MULTIPLE === checkType(scoring);\n\t\t\tme.isAnyNode = MODE_ANY === checkMode(scoring, questionPhrases);\n\t\t\tme.hasSharedAudio = Boolean(ref && ref.aud && ref.aud.url);\n\n\t\t\t// init question count\n\t\t\tme.questionPhraseCount = Math.min(filterOptions.questionNo, questionPhrases.length);\n\t\t\tif (!me.isMultiType) {\n\t\t\t\tme.questionPhraseCount = 1;\n\t\t\t} else if (!me.hasScoring) {\n\t\t\t\t// set practice type for multiple and non-grade mode text select\n\t\t\t\tme.type(Widget.ACT_TYPE.PRACTICE);\n\t\t\t}\n\t\t\tvar notInstantFeedback = Boolean(me.hasScoring);\n\t\t\tme.items().instantFeedback(!notInstantFeedback);\n\t\t\tme.length(me.questionPhraseCount);\n\t\t},\n\n\t\t\"sig/render\": function () {\n\t\t\tvar me = this;\n\t\t\tvar activityContent = me._json || {};\n\n\t\t\t// publish question number\n\t\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\t\tif (!me[$ELEMENT]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!me._htmlPromise) {\n\t\t\t\tvar data = {\n\t\t\t\t\thasSharedAudio: me.hasSharedAudio,\n\t\t\t\t\tref: activityContent.references,\n\t\t\t\t\tisMultiType: me.isMultiType,\n\t\t\t\t\tisGradeMode: me.isGradeMode\n\t\t\t\t};\n\t\t\t\tme._htmlPromise = me.html(tTemplate, data);\n\t\t\t}\n\n\t\t\treturn me._htmlPromise.then(function () {\n\t\t\t\tvar data = {\n\t\t\t\t\tactivityContent: activityContent,\n\t\t\t\t\thasSharedAudio: me.hasSharedAudio,\n\t\t\t\t\tisMultiType: me.isMultiType,\n\t\t\t\t\tisGradeMode: me.isGradeMode,\n\t\t\t\t\tisAnyMode: me.isAnyNode,\n\t\t\t\t\tquestionPhraseCount: me.questionPhraseCount,\n\t\t\t\t\tquestionPhraseIndex: me.isMultiType ? me.index() : -1,\n\t\t\t\t\titem: me.items()\n\t\t\t\t};\n\t\t\t\tme.publish(\"activity/text-select/render\", data);\n\t\t\t});\n\t\t},\n\n\t\t\"sig/stop\": function () {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\n\t\t\"hub/text-select/interaction\": function (interaction) {\n\t\t\treturn this.publishInteraction(interaction);\n\t\t},\n\n\t\tnextStep: function onNextStep() {\n\t\t\tvar me = this;\n\t\t\tif (me.index() >= me.length() - 1) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tme.index(me.index() + 1);\n\t\t\treturn me.signal(\"render\");\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/text-select/text-select.html',[],function() { return function template(data) { var o = \"\";\n\tvar me = this;\n\tvar model = data;\n\tvar makePhrase = model.makePhrase;\n\tvar isAnyMode = model.isAnyMode;\n\tvar hasSharedAudio = model.hasSharedAudio;\n\tvar renderQuestionPhrases = model.renderQuestionPhrases;\no += \"\\n<div class=\\\"ets-act-tsl-view-main\\\">\\n\\t<div class=\\\"ets-act-tsl-phrases\\\">\";renderPhrases();o += \"</div>\\n</div>\\n\";\nfunction renderPhrases() {\n\tfor(var i = 0, len = renderQuestionPhrases.length; i < len; i++) {\n\t\tvar phrase = renderQuestionPhrases[i];\n\n\t\tvar audioUrl = !hasSharedAudio && phrase.audio ? phrase.audio.url : '';\n\t\tvar phraseTextClass = isAnyMode ? 'ets-any' : 'ets-some';\n\t\tif(audioUrl) {\n\t\t\tphraseTextClass += ' ets-has-audio';\n\t\t}\n\t\tvar firstLastClass = (i === 0 ? ' ets-first' : '') + (i === len - 1 ? ' ets-last' : '');\n\t\to += \"\\n\\t\\t<div class=\\\"ets-act-tsl-phrase\" +firstLastClass+ \"\\\">\\n\\t\\t\\t\";if(audioUrl) {o += \"\\n\\t\\t\\t<div class=\\\"ets-act-tsl-audio\\\">\\n\\t\\t\\t\\t<div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap ets-ap-small\\\">\\n\\t\\t\\t\\t\\t<audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n\\t\\t\\t\\t\\t\\t   data-src=\\\"\" +audioUrl+ \"\\\" type=\\\"audio/mpeg\\\"\\n\\t\\t\\t\\t\\t\\t   class=\\\"ets-ap ets-ap-small ets-ap-nobar\\\"></audio>\\n\\t\\t\\t\\t</div></div>\\n\\t\\t\\t</div>\\n\\t\\t\\t\";}o += \"\\n\\t\\t\\t<div data-phrase-index=\\\"\" +i+ \"\\\" data-phrase-id=\\\"\" +phrase._id+ \"\\\" class=\\\"ets-act-tsl-text ets-doing \" +phraseTextClass+ \"\\\">\\n\\t\\t\\t\\t\" +makePhrase.call(me, phrase, isAnyMode)+ \"\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t\";\n\t}\n}\n return o; }; });\n",
    "define('school-ui-activity/activity/text-select/text-select',[\n\t\"jquery\",\n\t\"when\",\n\t\"underscore\",\n\t\"troopjs-ef/component/widget\",\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"template!./text-select.html\",\n\t\"./const\",\n\t'school-ui-activity/util/activity-util',\n\t\"jquery.jscrollpane\",\n\t\"jquery.mousewheel\"\n], function TextSelectModule($, when, _, Widget, Scoring, Interaction, tTextSelect, CONST, Util) {\n\t\"use strict\";\n\n\tvar UNDEF;\n\tvar $ELEMENT = \"$element\";\n\n\tvar RE_TAG = /<\\w+[^>]*>|<\\/\\w+>/;\n\tvar RE_ONE_CHAR_WORD = /[\\w~@#$%^&*]+/;\n\tvar RE_BORDER_CHAR = /^[()[\\]]$/;\n\tvar RE_BORDER_BEG_CHAR = /^[(\\[]$/;\n\tvar RE_PUNCTUATION = /^[.?;:!]$/;\n\tvar RE_AMP = /&/g;\n\tvar RE_LT = /</g;\n\tvar RE_GT = />/g;\n\n\tvar TAG_SPAN = \"span\";\n\tvar EMPTY = \"\";\n\tvar SPACE = \" \";\n\n\tvar SWITCH_ANSWERS_NUM = \"rolling-number/switch-answers-num\";\n\tvar TOPIC_TOGGLESLIDE_SHOW = \"activity/widget/toggleslide/show\";\n\n\tvar MIN_PHRASE_HEIGHT = 100;\n\n\tvar SLASH = CONST.SLASH;\n\tvar DOUBLE_SLASH = CONST.DOUBLE_SLASH;\n\tvar RE_SLASH = new RegExp(SLASH, 'g');\n\tvar IS_ANY_MODE = \"_isAnyMode\";\n\tvar IS_GRADE_MODE = \"_isGradeMode\";\n\tvar HAS_SHARED_AUDIO = \"_hasSharedAudio\";\n\tvar ACTIVITY_CONTENT = \"_activityContent\";\n\n\tvar DOT = \".\";\n\n\t/* dom data name */\n\tvar DATA_PHRASE_ID = \"phraseId\";\n\tvar DATA_WORD_ID = \"wordId\";\n\tvar DATA_WORD_INDEX = \"wordIndex\";\n\tvar DATA_OTHER_INDEX = \"otherIndex\";\n\tvar DATA_OPTION_GROUP_INDEX = \"option-group-index\";\n\n\t/* dom attr name */\n\tvar ATTR_DATA_OPTION_GROUP_INDEX = \"data-\" + DATA_OPTION_GROUP_INDEX;\n\n\t/* CSS class */\n\tvar CLS_OPTION = \"ets-option\";\n\tvar CLS_SELECTED = \"ets-selected\";\n\tvar CLS_CORRECT = \"ets-correct\";\n\tvar CLS_INCORRECT = \"ets-incorrect\";\n\tvar CLS_DISABLED = \"ets-disabled\";\n\tvar CLS_DOING = \"ets-doing\";\n\tvar CLS_SOME_SEPARATOR = \"ets-some-separator\";\n\tvar CLS_SOME_BORDER = \"ets-some-border\";\n\tvar CLS_PUNCTUATION = \"ets-punctuation\";\n\tvar CLS_MIN_HEIGHT = \"ets-min-height\";\n\tvar CLS_CHECKING = 'ets-checking';\n\tvar CLS_CHK_CORRECT = 'ets-chk-correct';\n\tvar CLS_CHK_DISABLED = 'ets-chk-disabled';\n\n\t/* CSS selector */\n\tvar SEL_TSL_VIEW_MAIN = \".ets-act-tsl-view-main\";\n\tvar SEL_TSL_PHRASE = \".ets-act-tsl-phrase\";\n\tvar SEL_OPTION = DOT + CLS_OPTION;\n\tvar SEL_SELECTED = DOT + CLS_SELECTED;\n\tvar SEL_CORRECT = DOT + CLS_CORRECT;\n\tvar SEL_INCORRECT = DOT + CLS_INCORRECT;\n\tvar SEL_PHRASE = '.ets-act-tsl-text';\n\tvar SEL_DOING = DOT + CLS_DOING;\n\tvar SEL_SOME_SEPARATOR = DOT + CLS_SOME_SEPARATOR;\n\tvar SEL_CHECKING = DOT + CLS_CHECKING;\n\tvar SEL_PARENT_TEXT_SELECT = '.ets-act-tsl';\n\tvar SEL_AR = '.ets-ar';\n\n\t/* widget data keys */\n\tvar ITEM = \"_item\";\n\tvar QUESTION_PHRASE_INDEX = \"_questionPhraseIndex\";\n\tvar QUESTION_PHRASE_COUNT = \"_questionPhraseCount\";\n\tvar ANSWER_COUNT = \"_answerCount\";\n\tvar SELECT_COUNT = \"_selectCount\";\n\tvar ANSWER_COUNT_BY_PHRASE = \"_answerCountByPhrase\";\n\tvar SELECT_COUNT_BY_PHRASE = \"_selectCountByPhrase\";\n\tvar IS_CORRECT = \"_isCorrect\";\n\n\tvar SEPARATOR_ELEMENT = '<' + TAG_SPAN + ' class=\"' + CLS_SOME_SEPARATOR + '\">' + SLASH + '</' + TAG_SPAN + '>';\n\tvar SEPARATOR_WORD = {_id: '', _index: -1, txt: SLASH};\n\n\tvar BORDER_END_CHAR_LIST = {\n\t\t'(': ')',\n\t\t'[': ']'\n\t};\n\n\tvar _timeoutToChangeScrollbarAlphaFirst,\n\t\t_timeoutToChangeScrollbarAlphaSecond;\n\n\t/*!\n\t * make phrase by content phrase\n\t *\n\t * NOTE: depend on widget instance, answer count may be changed\n\t */\n\tfunction makePhrase(phrase, isAnyMode) {\n\t\tvar me = this;\n\t\tvar output = {\n\t\t\tstep: 1,\n\t\t\tjoinedAnswerCount: 0\n\t\t};\n\t\tvar wordHtml = '', words = phrase.items, wordCount = words.length;\n\t\tvar step = 1;\n\n\t\tfor (var wordIndex = 0; wordIndex < wordCount; wordIndex += step) {\n\t\t\toutput.step = step = 1;\n\t\t\tvar word = words[wordIndex];\n\n\t\t\tif (!isAnyMode && RE_BORDER_BEG_CHAR.test(word.txt)) {\n\t\t\t\twordHtml += makeOptionWord.call(me, words, wordIndex, wordCount, isAnyMode, output);\n\t\t\t\tstep = output.step;\n\t\t\t} else {\n\t\t\t\twordHtml += makeWord(word._id, word.txt, wordIndex, isAnyMode);\n\t\t\t}\n\t\t}\n\n\t\tvar joinedAnswerCount = output.joinedAnswerCount;\n\t\tif (joinedAnswerCount > 0) {\n\t\t\tme[ANSWER_COUNT] -= joinedAnswerCount;\n\t\t}\n\t\treturn wordHtml;\n\t}\n\n\t//make Logical word which may be combined by continues word objects\n\tfunction makeWord(wordId, wordText, wordIndex, isAnyMode, otherIndex, hasSeparator) {\n\t\tif (!wordText) {\n\t\t\treturn '';\n\t\t}\n\t\twordText = String(wordText);\n\n\t\tif (!isAnyMode && wordText === SLASH) {\n\t\t\treturn SEPARATOR_ELEMENT;\n\t\t}\n\n\t\tif (RE_TAG.test(wordText)) {\n\t\t\treturn wordText;\n\t\t}\n\n\t\tvar separatorIndex = -1;\n\t\tif (!isAnyMode && wordText !== DOUBLE_SLASH && (separatorIndex = wordText.indexOf(SLASH)) !== -1) {\n\t\t\tif (wordText.indexOf(SLASH, separatorIndex + 1) !== -1) {\n\t\t\t\t// ignore if text contains many slashes\n\t\t\t\tseparatorIndex = -1;\n\t\t\t} else {\n\t\t\t\twordText = wordText.replace(SLASH, '');\n\t\t\t}\n\t\t}\n\n\t\tvar className = '';\n\t\tvar isOneChar = wordText.length === 1;\n\t\tvar isPunctuation = isOneChar && RE_PUNCTUATION.test(wordText);\n\n\t\tif (isAnyMode) {\n\t\t\tif (!isOneChar || wordText === SLASH || RE_ONE_CHAR_WORD.test(wordText)) {\n\t\t\t\tclassName = CLS_OPTION;\n\t\t\t}\n\t\t} else if (hasSeparator && RE_BORDER_CHAR.test(wordText)) {\n\t\t\tclassName = CLS_SOME_BORDER;\n\t\t}\n\t\tif (isPunctuation && className === '') {\n\t\t\tclassName = CLS_PUNCTUATION;\n\t\t}\n\t\tvar otherIndexAttr = otherIndex ? ' data-other-index=\"' + otherIndex + '\"' : '';\n\n\t\twordText = wordText.replace(RE_AMP, \"&amp;\").replace(RE_LT, \"&lt;\").replace(RE_GT, \"&gt;\");\n\t\tvar html = '<' + TAG_SPAN + ' class=\"' + className + '\" data-at-id=\"' + wordId + '\" data-word-id=\"' + wordId + '\" data-word-index=\"' + wordIndex + '\"' + otherIndexAttr + '>' + wordText + '</' + TAG_SPAN + '>';\n\n\t\tvar prefixSpace = isPunctuation ? '' : SPACE;\n\t\tif (separatorIndex === -1) {\n\t\t\treturn prefixSpace + html;\n\t\t}\n\t\telse if (separatorIndex === 0) {\n\t\t\treturn prefixSpace + SEPARATOR_ELEMENT + SPACE + html;\n\t\t}\n\t\telse if (separatorIndex > 0) {\n\t\t\treturn prefixSpace + html + SPACE + SEPARATOR_ELEMENT;\n\t\t}\n\t}\n\n\t/*!\n\t * make option word for given word scenario\n\t *\n\t * NOTE: depend on widget instance, it will update output joinedAnswerCount to fix answer count\n\t *\n\t */\n\tfunction makeOptionWord(words, wordIndex, wordCount, isAnyMode, output) {\n\t\tvar me = this, html = '';\n\n\t\t/*!\n\t\t * join option word together\n\t\t *\n\t\t * @param {Array} words, phrase words\n\t\t * @param {Integer} index, given word border start index\n\t\t * @param {Integer} wordCount, phrase words count\n\t\t * @param {Boolean} isAnyMode\n\t\t * @param {Object} output, output value\n\t\t *\n\t\t * NOTE: it will update output step for loop\n\t\t *\n\t\t * i.e.\n\t\t * [ {txt:\"(\"}, {txt:\"lots\"}, {txt:\"of\"}, {txt:\"/\"}, {txt:\"a\"}, {txt:\"lot\"}, {txt:\")\"} ] ->\n\t\t * [\n\t\t *  [{txt:\"(\"}],\n\t\t *  [{txt:\"lots\"}, {txt:\"of\"}],\n\t\t *  [{txt:\"/\"}],\n\t\t *  [{txt:\"a\"}, {txt:\"lot\"}],\n\t\t *  [{txt:\")\"}]\n\t\t * ]\n\t\t */\n\t\tfunction joinOptionWord(words, startWordIndex, wordCount, isAnyMode, output) {\n\t\t\t// the words[startWordIndex] should be the border start char\n\t\t\tvar word = words[startWordIndex];\n\t\t\tvar text = word.txt;\n\t\t\tvar BORDER_END_CHAR = BORDER_END_CHAR_LIST[text];\n\n\t\t\toutput.step = output.step || 1;\n\t\t\tword._index = startWordIndex; // set word index\n\t\t\tvar optionGroups = [[word]];\n\t\t\tvar optionWordIndex = 1; // start index is 1, 0 is used by border start char\n\t\t\tvar hasSeparator;\n\n\t\t\tfor (var i = startWordIndex + 1; i < wordCount; i++) {\n\t\t\t\toutput.step++;\n\t\t\t\tword = words[i];\n\t\t\t\ttext = word.txt;\n\t\t\t\tword._index = i;\n\n\t\t\t\tif (text === BORDER_END_CHAR) {\n\t\t\t\t\toptionGroups[++optionWordIndex] = [word];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// ignore html tag\n\t\t\t\tif (RE_TAG.test(text)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar isSeparator = text === SLASH;\n\t\t\t\tvar separatorIndex = text.indexOf(SLASH);\n\n\t\t\t\tif (isSeparator) {\n\t\t\t\t\thasSeparator = true;\n\t\t\t\t}\n\n\t\t\t\tif (!isSeparator && separatorIndex !== -1) {\n\t\t\t\t\tword.txt = text.replace(RE_SLASH, '');\n\t\t\t\t}\n\n\t\t\t\tif (isSeparator) {\n\t\t\t\t\tif (optionGroups[optionWordIndex]) {\n\t\t\t\t\t\toptionWordIndex++;\n\t\t\t\t\t}\n\t\t\t\t\toptionGroups[optionWordIndex] = [word];\n\t\t\t\t\toptionWordIndex++;\n\t\t\t\t}\n\t\t\t\telse if (separatorIndex === 0) {\n\t\t\t\t\toptionWordIndex++;\n\t\t\t\t\toptionGroups[optionWordIndex] = [SEPARATOR_WORD];\n\t\t\t\t\toptionWordIndex++;\n\t\t\t\t\toptionGroups[optionWordIndex] = [word];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (!optionGroups[optionWordIndex]) {\n\t\t\t\t\t\toptionGroups[optionWordIndex] = [];\n\t\t\t\t\t}\n\t\t\t\t\toptionGroups[optionWordIndex].push(word);\n\t\t\t\t\tif (separatorIndex > 0) {\n\t\t\t\t\t\toptionWordIndex++;\n\t\t\t\t\t\toptionGroups[optionWordIndex] = [SEPARATOR_WORD];\n\t\t\t\t\t\toptionWordIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!hasSeparator && optionGroups.length > 1) {\n\t\t\t\t/* recover joined word for has brackets but no separator case\n\t\t\t\t * transfer FROM\n\t\t\t\t * [\n\t\t\t\t *  [{txt:\"(\"}],\n\t\t\t\t *  [{txt:\"lots\"}, {txt:\"of\"}, {txt:\"words\"}],\n\t\t\t\t *  [{txt:\")\"}]\n\t\t\t\t * ]\n\t\t\t\t * TO\n\t\t\t\t * [\n\t\t\t\t *  [{txt:\"(\"}], [{txt:\"lots\"}], [{txt:\"of\"}], [{txt:\"words\"}], [{txt:\")\"}]\n\t\t\t\t * ]\n\t\t\t\t */\n\t\t\t\t//ES6 syntax:\n\t\t\t\t//optionGroups = [optionGroups[0], ...optionGroups[1].map(w=>[w]), ...optionGroups.slice(2) ];\n\t\t\t\toptionGroups = [optionGroups[0]].concat(optionGroups[1].map(function (word) {\n\t\t\t\t\treturn [word];\n\t\t\t\t})).concat(optionGroups.slice(2));\n\t\t\t}\n\t\t\toptionGroups.hasSeparator = hasSeparator;\n\t\t\treturn optionGroups;\n\t\t}\n\n\t\tvar joinedAnswerCount = 0;\n\t\tvar optionGroupItems = joinOptionWord(words, wordIndex, wordCount, isAnyMode, output);\n\t\toptionGroupItems.forEach(function (optionGroupItem) {\n\t\t\tvar text = '', optionWordsBuffer = [], answerWordIndexes = [];\n\t\t\toptionGroupItem.forEach(function (word) {\n\t\t\t\tif (isAnswerWord.call(me, word._id)) {\n\t\t\t\t\toptionWordsBuffer.unshift(word);\n\t\t\t\t\tanswerWordIndexes.push(word._index);\n\t\t\t\t} else {\n\t\t\t\t\toptionWordsBuffer.push(word);\n\t\t\t\t}\n\t\t\t\ttext += SPACE + word.txt;\n\t\t\t});\n\t\t\tif (answerWordIndexes.length > 1) {\n\t\t\t\tjoinedAnswerCount += answerWordIndexes.length - 1;\n\t\t\t}\n\n\t\t\t// get the last joined word(first element in array)'s id and index as selected word's id and index\n\t\t\tvar joinedWord = optionWordsBuffer[0];\n\t\t\tif (joinedWord) {\n\t\t\t\ttext = text.trim();\n\t\t\t\thtml += makeWord(joinedWord._id, text, joinedWord._index, isAnyMode, answerWordIndexes.slice(0, -1).join(\",\"), optionGroupItems.hasSeparator);\n\t\t\t}\n\t\t});\n\t\toutput.joinedAnswerCount += joinedAnswerCount;\n\t\treturn html;\n\t}\n\n\t/*!\n\t * check if word is answer or not by word id\n\t *\n\t * NOTE: depend on widget instance\n\t */\n\tfunction isAnswerWord(wordId) {\n\t\tvar me = this;\n\t\tvar scoring = me[ACTIVITY_CONTENT].scoring, isAnswer = false;\n\t\tif (!scoring) {\n\t\t\treturn isAnswer;\n\t\t}\n\n\t\t$.each(scoring.phrases || [], function (i, phrase) {\n\t\t\t$.each(phrase.items || [], function (j, word) {\n\t\t\t\tif (word._id === wordId) {\n\t\t\t\t\tisAnswer = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (isAnswer) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn isAnswer;\n\t}\n\n\tfunction resetRemainingAnswersCount() {\n\t\tvar me = this;\n\t\tvar $el = me[$ELEMENT];\n\t\tvar remaingCount = me[ANSWER_COUNT] - me[SELECT_COUNT];\n\t\t$el.closest(SEL_PARENT_TEXT_SELECT).find(SEL_AR)\n\t\t\t.trigger(SWITCH_ANSWERS_NUM, { action: \"reset\", step: remaingCount });\n\t}\n\n\t/*!\n\t * Called after activity rendered\n\t *\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tvar $widget = me[$ELEMENT];\n\n\t\tvar $tslViewMain = $widget.find(SEL_TSL_VIEW_MAIN);\n\t\tvar $phraseItems = $tslViewMain.find(SEL_TSL_PHRASE);\n\n\t\t// DONT change the following calling order\n\t\tif (!me[IS_ANY_MODE]) {\n\t\t\tinitSomeMode($phraseItems);\n\t\t}\n\t\tif ($phraseItems.length === 1 && $phraseItems.height() < MIN_PHRASE_HEIGHT) {\n\t\t\t$phraseItems.addClass(CLS_MIN_HEIGHT);\n\t\t}\n\t\tinitScrollPanel($tslViewMain);\n\t}\n\n\t/*!\n\t * add word class and option num for given word\n\t */\n\tfunction initSomeMode($phraseItems) {\n\t\tvar $separators = $phraseItems.find(SEL_SOME_SEPARATOR);\n\t\t$separators.next().add($separators.prev()).addClass(CLS_OPTION);\n\t\tvar $words = $phraseItems.find(SEL_OPTION);   //make sure elements order is same as DOM's\n\n\t\t// set option group index for given words\n\t\tvar groupIndex = 0;\n\t\t$words.each(function (i, word) {\n\t\t\tvar $word = $(word);\n\t\t\t$word.attr(ATTR_DATA_OPTION_GROUP_INDEX, groupIndex);\n\t\t\t//option group may have border, and may have not.\n\t\t\t//so only keep groupIndex unchanged if found a separator\n\t\t\tif (!$word.next().hasClass(CLS_SOME_SEPARATOR)) {\n\t\t\t\tgroupIndex++;\n\t\t\t}\n\t\t});\n\t\tvar groupCount = groupIndex;\n\n\t\tfor (var i = 0; i < groupCount; i++) {\n\t\t\tvar $groupWords = $words.filter('[' + ATTR_DATA_OPTION_GROUP_INDEX + '=' + i + ']');\n\t\t\tif ($groupWords.length <= 1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// shuffle option group words\n\t\t\tvar $groupWordWrappers = $groupWords.wrap('<span></span>').parent();\n\t\t\tvar shuffledWords = _.shuffle($groupWords.toArray());\n\t\t\tfor (var groupWordIndex = 0; groupWordIndex < shuffledWords.length; groupWordIndex++) {\n\t\t\t\tvar $wrapper = $groupWordWrappers.eq(groupWordIndex);\n\t\t\t\tvar newElement = shuffledWords[groupWordIndex];\n\t\t\t\t$wrapper.empty().append(newElement);\n\t\t\t}\n\t\t\t$groupWords.unwrap();\n\t\t}\n\t}\n\n\tfunction initScrollPanel($pane) {\n\t\t$pane.one('jsp-initialised', function () {\n\t\t\tvar $dragbar = $pane.find('.jspDrag');\n\n\t\t\t_timeoutToChangeScrollbarAlphaFirst = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 5000);\n\n\t\t\t_timeoutToChangeScrollbarAlphaSecond = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 30000);\n\n\t\t\t$pane.one('jsp-scroll-y', function () {\n\t\t\t\tclearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\t\tclearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t});\n\t\t});\n\n\t\t$pane.jScrollPane({\n\t\t\tenableKeyboardNavigation: false,\n\t\t\tautoReinitialise: false\n\t\t});\n\t}\n\n\tfunction isOption($word) {\n\t\treturn $word.hasClass(CLS_OPTION) && $word.data(DATA_WORD_ID);\n\t}\n\n\treturn Widget.extend({\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t},\n\n\t\t/**\n\t\t * @param {Object} data {activity, hasSharedAudio, isMultiType, isGradeMode, isAnyMode, questionPhraseCount, questionPhraseIndex, item}\n\t\t */\n\t\t\"hub/activity/text-select/render\": function render(data) {\n\t\t\tvar me = this;\n\t\t\tif (me.isAnswerShown) {\n\t\t\t\tme.publish(\"activity/widget/toggleslide/toggle\");\n\t\t\t\tme.isAnswerShown = false;\n\t\t\t}\n\n\t\t\tme[HAS_SHARED_AUDIO] = data.hasSharedAudio;\n\t\t\tme[ITEM] = data.item;\n\t\t\tme[ACTIVITY_CONTENT] = data.activityContent;\n\t\t\tme[IS_GRADE_MODE] = data.isGradeMode;\n\t\t\tme[IS_ANY_MODE] = data.isAnyMode;\n\t\t\tme[QUESTION_PHRASE_COUNT] = data.questionPhraseCount;\n\t\t\tme[QUESTION_PHRASE_INDEX] = data.questionPhraseIndex;\n\n\t\t\t// reset activity status before render\n\t\t\tme._reset(me[QUESTION_PHRASE_INDEX]);\n\n\t\t\t// export makePhrase function\n\t\t\tdata.makePhrase = makePhrase;\n\n\t\t\t// calculate render phrases\n\t\t\tvar questionPhrases = (data.activityContent.content || {}).phrases || [];\n\t\t\tvar renderQuestionPhrases = data.isMultiType ? [questionPhrases[data.questionPhraseIndex]] : questionPhrases.slice(0, data.questionPhraseCount);\n\t\t\tif (renderQuestionPhrases.length > 1 && data.activityContent.filterOptions.random) {\n\t\t\t\trenderQuestionPhrases = _.shuffle(renderQuestionPhrases);\n\t\t\t}\n\t\t\treturn me.html(tTextSelect, $.extend({\n\t\t\t\trenderQuestionPhrases: renderQuestionPhrases\n\t\t\t}, data)).then(function () {\n\t\t\t\t// reset answer reamin after phrase rendered(answer count may be fixed by joining)\n\t\t\t\tresetRemainingAnswersCount.call(me);\n\t\t\t\tonRendered.call(me);\n\t\t\t});\n\t\t},\n\n\t\t\"hub/activity/check/answer\": function () {\n\t\t\tvar me = this;\n\t\t\tif (!me[ITEM].instantFeedback()) {\n\t\t\t\tme[$ELEMENT].find(SEL_SELECTED).each(function (i, wd) {\n\t\t\t\t\tvar $word = $(wd);\n\t\t\t\t\tvar $phrase = $word.closest(SEL_PHRASE);\n\t\t\t\t\tvar optionIndex = $word.data(DATA_OPTION_GROUP_INDEX);\n\t\t\t\t\tvar phraseId = $phrase.data(DATA_PHRASE_ID);\n\t\t\t\t\tvar wordId = $word.data('word-id');\n\t\t\t\t\tvar correct = me.checkAnswer(phraseId, optionIndex, wordId);\n\t\t\t\t\tme.displayInteractionResult(correct, $phrase, $word);\n\t\t\t\t});\n\t\t\t\tme._updateAnsweredState();\n\t\t\t\tme.publish(TOPIC_TOGGLESLIDE_SHOW, { show: !me[ITEM].completed() });\n\t\t\t}\n\t\t},\n\n\t\t\"hub/activity/correctanswer/show\": function (show) {\n\t\t\tvar me = this;\n\t\t\tme.isAnswerShown = show;\n\t\t\tvar $phrases = me[$ELEMENT].find(SEL_PHRASE);\n\t\t\tif (show) {\n\t\t\t\t$phrases\n\t\t\t\t\t.filter(SEL_DOING)\n\t\t\t\t\t.removeClass(CLS_DOING)\n\t\t\t\t\t.addClass(CLS_CHECKING)\n\t\t\t\t\t.each(function (ip, phraseNode) {\n\t\t\t\t\t\tvar $phrase = $(phraseNode);\n\t\t\t\t\t\tvar phraseId = $phrase.data(DATA_PHRASE_ID);\n\t\t\t\t\t\tvar solution = Scoring.findById(me[ACTIVITY_CONTENT].scoring.phrases, phraseId);\n\t\t\t\t\t\t$phrase.find(SEL_OPTION).each(function (iw, wordNode) {\n\t\t\t\t\t\t\tvar $word = $(wordNode);\n\t\t\t\t\t\t\tvar wordId = $word.data('word-id');\n\t\t\t\t\t\t\tvar solutionWord = Scoring.findById(solution.items, wordId);\n\t\t\t\t\t\t\tvar correct = Boolean(solutionWord);\n\t\t\t\t\t\t\t$word.addClass(correct ? CLS_CHK_CORRECT : CLS_CHK_DISABLED);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$phrases\n\t\t\t\t\t.filter(SEL_CHECKING)\n\t\t\t\t\t.removeClass(CLS_CHECKING)\n\t\t\t\t\t.addClass(CLS_DOING)\n\t\t\t\t\t.find(SEL_OPTION)\n\t\t\t\t\t.removeClass(CLS_CHK_CORRECT)\n\t\t\t\t\t.removeClass(CLS_CHK_DISABLED);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t *reset activity status variable\n\t\t */\n\t\t_reset: function onReset(questionPhraseIndex) {\n\t\t\tvar me = this;\n\t\t\tme[SELECT_COUNT] = 0;\n\t\t\tme[ANSWER_COUNT] = 0;\n\t\t\tme[SELECT_COUNT_BY_PHRASE] = {};\n\t\t\tme[ANSWER_COUNT_BY_PHRASE] = {};\n\n\t\t\tvar isCountAll = questionPhraseIndex === -1 || questionPhraseIndex === UNDEF,\n\t\t\t\tactivityContent = me[ACTIVITY_CONTENT], scoring = activityContent.scoring;\n\t\t\tvar questionPhrases = activityContent.content.phrases || [];\n\t\t\tvar index = isCountAll ? 0 : questionPhraseIndex,\n\t\t\t\tendIndex = isCountAll ? me[QUESTION_PHRASE_COUNT] - 1 : questionPhraseIndex;\n\t\t\tfor (; index <= endIndex; index++) {\n\t\t\t\tvar questionPhraseId = questionPhrases[index]._id;\n\t\t\t\tme[SELECT_COUNT_BY_PHRASE][questionPhraseId] = 0;\n\t\t\t\tif (scoring) {\n\t\t\t\t\t$.each(scoring.phrases || [], function (i, scoringPhrase) {\n\t\t\t\t\t\tif (scoringPhrase._id === questionPhraseId) {\n\t\t\t\t\t\t\tvar scoringWordCount = scoringPhrase.items.length;\n\t\t\t\t\t\t\tme[ANSWER_COUNT] += scoringWordCount;\n\t\t\t\t\t\t\tme[ANSWER_COUNT_BY_PHRASE][questionPhraseId] = scoringWordCount;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tme[ANSWER_COUNT] += 1;\n\t\t\t\t\tme[ANSWER_COUNT_BY_PHRASE][questionPhraseId] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * get phrase answer selector array\n\t\t */\n\t\t_getAnswerSelector: function onGetAnswerSelector(phraseIndex, excludeWordId) {\n\t\t\tvar me = this;\n\t\t\tvar activityContent = me[ACTIVITY_CONTENT], scoring = activityContent.scoring, selector = [];\n\t\t\tif (scoring) {\n\t\t\t\tvar phraseId = activityContent.content.phrases[phraseIndex]._id,\n\t\t\t\t\tisIncludeAll = excludeWordId === UNDEF;\n\t\t\t\t$.each(scoring.phrases || [], function (i, scoringPhrase) {\n\t\t\t\t\tif (scoringPhrase._id === phraseId) {\n\t\t\t\t\t\t$.each(scoringPhrase.items || [], function (i, word) {\n\t\t\t\t\t\t\tif (isIncludeAll || word._id !== excludeWordId) {\n\t\t\t\t\t\t\t\tselector.push('[data-word-id=\"' + word._id + '\"]');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn selector;\n\t\t},\n\n\t\t/**\n\t\t * disable other option words when correct option is selected\n\t\t */\n\t\t_disableOtherOption: function onDisableOtherOption($phrase, optionSelector) {\n\t\t\t$phrase\n\t\t\t\t.find(SEL_OPTION)\n\t\t\t\t.filter(optionSelector)\n\t\t\t\t.not(SEL_CORRECT)\n\t\t\t\t.addClass(CLS_DISABLED);\n\t\t},\n\n\t\t_isSelectableWord: function isSelectableWord($word) {\n\t\t\treturn !(\n\t\t\t\t$word.hasClass(CLS_CORRECT) ||\n\t\t\t\t$word.hasClass(CLS_DISABLED) ||\n\t\t\t\t$word.hasClass(CLS_INCORRECT)\n\t\t\t);\n\t\t},\n\n\t\t_coundRemainingAnswers: function () {\n\t\t\tvar me = this;\n\t\t\tvar selectedAndCorrectCount = me[$ELEMENT].find([SEL_SELECTED, SEL_CORRECT].join(',')).length;\n\t\t\treturn Math.max(0, me[ANSWER_COUNT] - selectedAndCorrectCount);\n\t\t},\n\n\t\t_updateAnsweredState: function updateAnsweredState() {\n\t\t\tvar me = this;\n\t\t\tvar $el = me[$ELEMENT];\n\t\t\tvar remainingAnswers = me._coundRemainingAnswers();\n\t\t\tme[ITEM].answered(remainingAnswers === 0);\n\t\t\t$el.closest(SEL_PARENT_TEXT_SELECT).find(SEL_AR)\n\t\t\t\t.trigger(SWITCH_ANSWERS_NUM, { action: \"set\", step: remainingAnswers });\n\t\t},\n\n\t\thandleSelectText: function onSelectText($phrase, $word) {\n\t\t\tvar me = this;\n\t\t\tvar phraseId = $phrase.data(DATA_PHRASE_ID);\n\t\t\tvar isGradeMode = me[IS_GRADE_MODE];\n\t\t\tvar isAnyMode = me[IS_ANY_MODE];\n\t\t\tif (isGradeMode && isAnyMode && !$word.hasClass(CLS_SELECTED)) {\n\t\t\t\tvar remainingAnswers = me._coundRemainingAnswers();\n\t\t\t\tif (remainingAnswers === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tme.disablePreviousIncorrectSelection($phrase, $word);\n\t\t\tif (!me[ITEM].instantFeedback()) { // prevent immediate feedback\n\t\t\t\t$word.toggleClass(CLS_SELECTED);\n\t\t\t\tvar $siblings = $word.siblings(SEL_OPTION).filter(me.getOptionSelector($word));\n\t\t\t\t$siblings.removeClass(CLS_SELECTED);\n\t\t\t\tme._updateAnsweredState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar wordId = $word.data('word-id');\n\t\t\tvar correct;\n\t\t\tif (isGradeMode) {\n\t\t\t\tvar optionIndex = $word.data(DATA_OPTION_GROUP_INDEX);\n\t\t\t\tcorrect = me.checkAnswer(phraseId, optionIndex, wordId);\n\t\t\t} else {\n\t\t\t\tcorrect = true;\n\t\t\t\tme[SELECT_COUNT] += 1;\n\t\t\t\tif (me[SELECT_COUNT] >= me[ANSWER_COUNT]) {\n\t\t\t\t\tme[ITEM].completed(true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tme.displayInteractionResult(correct, $phrase, $word);\n\t\t\tme._updateAnsweredState();\n\t\t},\n\n\t\tcheckAnswer: function (phraseId, optionIndex, wordId) {\n\t\t\tvar me = this;\n\t\t\tvar solution = Scoring.findById(me[ACTIVITY_CONTENT].scoring.phrases, phraseId);\n\t\t\tvar solutionWord = Scoring.findById(solution.items, wordId);\n\t\t\tvar correct = Boolean(solutionWord);\n\t\t\tvar interaction = Interaction.makeTextSelectInteraction(correct, phraseId, optionIndex, wordId);\n\t\t\tvar promise = me.publish(\"text-select/interaction\", interaction);\n\t\t\tif (correct) {\n\t\t\t\tme[SELECT_COUNT] += 1;\n\t\t\t\tme[SELECT_COUNT_BY_PHRASE][phraseId] += 1;\n\t\t\t\tif (me[SELECT_COUNT] >= me[ANSWER_COUNT]) {\n\t\t\t\t\tme[ACTIVITY_CONTENT].content[IS_CORRECT] = true;\n\t\t\t\t\tpromise.then(function(){\n\t\t\t\t\t\tme[ITEM].completed(true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn correct;\n\t\t},\n\n\t\tdisplayInteractionResult: function (correct, $phrase, $word) {\n\t\t\tvar me = this;\n\n\t\t\tme.disableCompletedPhrase($phrase);\n\t\t\t$word.removeClass(CLS_SELECTED);\n\n\t\t\tif (correct) {\n\t\t\t\t$word.addClass(CLS_CORRECT);\n\t\t\t\tif (!me[IS_ANY_MODE]) {\n\t\t\t\t\tme._disableOtherOption($phrase, me.getOptionSelector($word));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$word.addClass(CLS_INCORRECT);\n\t\t\t}\n\t\t},\n\n\t\tdisablePreviousIncorrectSelection: function ($phrase, $word) {\n\t\t\tvar me = this;\n\t\t\tif (me[IS_ANY_MODE]) {\n\t\t\t\t$phrase\n\t\t\t\t\t.find(CONST.SEL_WORD)\n\t\t\t\t\t.filter(SEL_INCORRECT)\n\t\t\t\t\t.removeClass(CONST.CLS_INCORRECT)\n\t\t\t\t\t.addClass(CONST.CLS_DISABLED);\n\t\t\t} else {\n\t\t\t\t$phrase\n\t\t\t\t\t.find(CONST.SEL_WORD)\n\t\t\t\t\t.filter(me.getOptionSelector($word))\n\t\t\t\t\t.filter(SEL_INCORRECT)\n\t\t\t\t\t.removeClass(CONST.CLS_INCORRECT)\n\t\t\t\t\t.addClass(CONST.CLS_DISABLED);\n\t\t\t}\n\t\t},\n\n\t\tdisableCompletedPhrase: function ($phrase) {\n\t\t\tvar me = this;\n\t\t\tvar phraseId = $phrase.data(DATA_PHRASE_ID);\n\t\t\tvar selectCount = me[SELECT_COUNT_BY_PHRASE][phraseId];\n\t\t\tvar answerCount = me[ANSWER_COUNT_BY_PHRASE][phraseId];\n\t\t\tif (selectCount === answerCount) {\n\t\t\t\t$phrase.removeClass(CONST.CLS_DOING);\n\t\t\t}\n\t\t},\n\n\t\tgetOptionSelector: function ($word) {\n\t\t\treturn \"[\" + ATTR_DATA_OPTION_GROUP_INDEX + \"='\" + $word.data(DATA_OPTION_GROUP_INDEX) + \"']\";\n\t\t},\n\n\t\t\"dom:.ets-act-tsl-text/click\": function onSelect($event) {\n\t\t\tvar $word = $($event.target);\n\t\t\tif (!isOption($word)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar me = this;\n\t\t\tvar $phrase = $($event.currentTarget);\n\t\t\tvar phraseIndex = $phrase.data('phraseIndex');\n\n\t\t\tif ($phrase.hasClass(CLS_DOING) && me._isSelectableWord($word)) {\n\t\t\t\tvar wordIndex = $word.data(DATA_WORD_INDEX);\n\t\t\t\tme.handleSelectText($phrase, $word, phraseIndex, wordIndex);\n\t\t\t}\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/main.html',[],function() { return function template(data) { var o = \"\";if(data.references.aud){o += \"\\n    <div class=\\\"ets-act-tpd-hd-ap\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n\";}o += \"\\n<div class=\\\"ets-act-tpd\\\" data-weave=\\\"school-ui-activity/activity/typing-drag-drop/typing-drag-drop\\\"></div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-drag-drop/typing-drag-drop.html',[],function() { return function template(data) { var o = \"\";\n    var paragraphs = data.paragraphs;\n    var dragPieces = data.dragPieces;\no += \"\\n<div class=\\\"ets-act-tpd-main\\\">\\n\";\nfor(var i=0;i<paragraphs.length;i++){\n    var paragraph = paragraphs[i];\n    for(var j=0;j<paragraph.length;j++){\n        var cell = paragraph[j];\n        if(cell._toAs){\n        o += \"\\n            <span class=\\\"ets-act-tpd-gap ets-act-tpd-n\\\" data-at-tag=\\\"droppable\\\" data-at-id=\\\"\" +cell.text+ \"\\\" data-id=\\\"\" +cell.text+ \"\\\"><span class=\\\"ets-act-tpd-cm\\\">\\n                </span>\\n            </span> \\n        \";\n        }else{\n        o += \"\\n            \" +cell.text+ \"\\n        \";\n        }\n    }\n}\no += \"\\n</div>\\n<div class=\\\"ets-act-tpd-shadow ets-act-tpg-none\\\"></div>\\n<div class=\\\"ets-act-tpd-items\\\">\\n    <ul>\\n    \";\n    for(var i=0;i<data.dragPieces.length;i++){\n        var piece = data.dragPieces[i];\n        o += \"\\n        <li>\\n            <span class=\\\"ets-act-tpd-item ets-act-tpd-item-n\\\" data-index=\\\"\" +i+ \"\\\" data-at-tag=\\\"draggable\\\" data-at-id=\\\"\" +piece._id+ \"\\\" data-id=\\\"\" +piece._id+ \"\\\"><span class=\\\"ets-act-tpd-im\\\">\\n                <span class=\\\"ets-act-tpd-txt\\\">\" +piece.txt+ \"\\n                </span><span class=\\\"ets-act-tpd-idc\\\">\\n                </span></span>\\n            </span>\\n        </li>\\n        \";\n    }\n    o += \"\\n    </ul>\\n</div> \"; return o; }; });\n",
    "define('school-ui-activity/activity/typing-drag-drop/typing-drag-drop',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.ui.touch-punch',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/interaction',\n\t'school-ui-shared/utils/browser-check',\n\t'school-ui-activity/util/activity-util',\n\t'template!./typing-drag-drop.html',\n\t\"jquery.jscrollpane\",\n\t\"jquery.mousewheel\"\n], function ($, ui$, $uiTouchPunch, Widget, Interaction, browserCheck, Util, tPd) {\n\t\"use strict\";\n\n\tvar _inDragging,\n\t\t_inDropping,\n\t\t_timeoutToBack,\n\t\t_timeoutToCheckHeight,\n\t\t_timeoutToChangeScrollbarAlphaFirst,\n\t\t_timeoutToChangeScrollbarAlphaSecond,\n\t\t_HEIGHT_MAIN = 430,\n\t\t_HEIGHT_AUDIO = 85,\n\t\t_HEIGHT_SHADOW = 37,\n\t\t_HEIGHT_DRAG_MARGIN = 10,\n\t\t_ISIE = browserCheck.browser === \"msie\",\n\t\t_ISIE_LT8 = _ISIE && parseInt(browserCheck.version) < 8,\n\t\tSTR_DOT = '.',\n\t\tCLS_GAP_HIGHLIGHT = 'ets-act-tpd-h',\n\t\tCLS_ITEM_NORMAL = 'ets-act-tpd-item-n',\n\t\tCLS_ITEM_PLACED = 'ets-act-tpd-item-p',\n\t\tCLS_ITEM_HIGHLIGHT = 'ets-act-tpd-item-h',\n\t\tCLS_ITEM_SIMPLE_CORRECT = 'ets-act-tpd-item-sc',\n\t\tCLS_ITEM_INCORRECT = 'ets-act-tpd-item-ic',\n\t\tSEL_MAIN = '.ets-act-tpd-main',\n\t\tSEL_GAP = '.ets-act-tpd-gap',\n\t\tSEL_GAP_MID = '.ets-act-tpd-cm',\n\t\tSEL_ITEM = '.ets-act-tpd-item',\n\t\tSEL_ITEM_NORMAL = STR_DOT + CLS_ITEM_NORMAL,\n\t\tSEL_ITEM_PLACED = STR_DOT + CLS_ITEM_PLACED,\n\t\tSEL_ITEM_MID = '.ets-act-tpd-im',\n\t\tSEL_ITEMS = '.ets-act-tpd-items',\n\t\tSEL_TXT = '.ets-act-tpd-txt',\n\t\tSEL_SHADOW = '.ets-act-tpd-shadow';\n\n\t/**\n\t * Util function ,remove style attribute from jquery object\n\t */\n\tfunction clearStyle() {\n\t\t$(this).removeAttr('style');\n\t}\n\n\tfunction fixIERender() {\n\t\tif (!_ISIE) {\n\t\t\treturn;\n\t\t}\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t/**\n\t\t * IE is ugly, will not rerender all elements of dom tree, use addClass to force it rerender\n\t\t **/\n\t\t$ROOT.find(SEL_MAIN).addClass('notExists');\n\t}\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\t\treturn me.html(tPd, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Bind input element focus and blur event\n\t * # Bind input text change event\n\t * # Bind Example text click event\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tinitContentSize.call(me);\n\t\tinitScrollPane.call(me);\n\t\tinitDraggable.call(me);\n\t\tinitDroppable.call(me);\n\t}\n\n\tfunction initContentSize() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$dragElements = $ROOT.find(SEL_ITEMS),\n\t\t\t$mainContent = $ROOT.find(SEL_MAIN),\n\t\t\tdragItemsHeight = $dragElements.height() + _HEIGHT_DRAG_MARGIN;\n\n\t\t//Set drag items div with fixed width to avoid layout change when some items dragged out.\n\t\t$dragElements.css({\n\t\t\theight: dragItemsHeight\n\t\t});\n\t\tvar audioHeight = me._hasAudio ? _HEIGHT_AUDIO : 0;\n\n\t\t//Set max height to cover value set by css(max height in css is to avoid content height exceed of 430px)\n\t\t$ROOT.css({\n\t\t\tmaxHeight: _HEIGHT_MAIN - audioHeight\n\t\t});\n\t\tvar contentAvailiableheight = _HEIGHT_MAIN - dragItemsHeight - audioHeight;\n\t\t//Set height or max height for jScrollPane\n\t\tif ($mainContent.height() > contentAvailiableheight) {\n\t\t\t$mainContent.css({\n\t\t\t\tmaxHeight: contentAvailiableheight - _HEIGHT_SHADOW\n\t\t\t});\n\t\t\t$ROOT.find(SEL_SHADOW).show();\n\t\t\tif (_ISIE_LT8) {\n\t\t\t\t$mainContent.css({\n\t\t\t\t\t'overflow-y': 'scroll'\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t$mainContent.css({\n\t\t\t\theight: contentAvailiableheight\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction initScrollPanelEvent($pane) {\n\t\tvar dragBarSelector = '.jspDrag',\n\t\t\tjspaneSelector = '.jspPane',\n\t\t\teventScroll = 'jsp-scroll-y',\n\t\t\teventInitialed = 'jsp-initialised';\n\t\treturn $pane.bind(eventInitialed, function () {\n\t\t\t$pane.unbind(eventInitialed);\n\t\t\tvar $dragbar = $pane.find(dragBarSelector);\n\t\t\t_timeoutToChangeScrollbarAlphaFirst = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 5000);\n\n\t\t\t_timeoutToChangeScrollbarAlphaSecond = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 30000);\n\n\t\t\t$pane.bind(eventScroll, function () {\n\t\t\t\t$pane.unbind(eventScroll);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t});\n\t\t\tvar height = $pane.find(jspaneSelector).height();\n\n\t\t\tfunction checkHeight() {\n\t\t\t\tvar newHeight = $pane.find(jspaneSelector).height();\n\t\t\t\tif (parseInt(newHeight) - parseInt(height)) {\n\t\t\t\t\t$pane.jScrollPane();\n\t\t\t\t}\n\t\t\t\theight = newHeight;\n\t\t\t\t_timeoutToCheckHeight = setTimeout(checkHeight, 100);\n\t\t\t}\n\n\t\t\t_timeoutToCheckHeight = setTimeout(checkHeight, 100);\n\t\t});\n\t}\n\n\tfunction initScrollPane() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$pane = $ROOT.find(SEL_MAIN);\n\t\tif (!(_ISIE_LT8)) {\n\t\t\tinitScrollPanelEvent($pane).jScrollPane();\n\t\t}\n\t}\n\n\tfunction initDraggable() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\n\t\tvar dragOption = {\n\t\t\tstack: SEL_ITEM_NORMAL,\n\t\t\t//containment : '.ets-ui-acc-bd',\n\t\t\tcancel: SEL_ITEM_PLACED,\n\t\t\tappendTo: '.ets-act-bd-main',\n\t\t\trevert: 'invalid',\n\t\t\tstart: function (event, ui) {\n\t\t\t\tif (_inDragging || _inDropping) {\n\t\t\t\t\tui.helper.removeClass(CLS_ITEM_HIGHLIGHT);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t_inDragging = true;\n\t\t\t},\n\t\t\tstop: function (event, ui) {\n\t\t\t\tui.helper.removeClass(CLS_ITEM_HIGHLIGHT);\n\t\t\t\t_inDragging = false;\n\t\t\t},\n\t\t\tdisabled: false\n\t\t};\n\n\t\t$ROOT.find(SEL_ITEMS).find(SEL_ITEM_NORMAL).bind('mousedown', function () {\n\t\t\t$(this).addClass(CLS_ITEM_HIGHLIGHT);\n\t\t}).bind('mouseup', function () {\n\t\t\t$(this).removeClass(CLS_ITEM_HIGHLIGHT);\n\t\t}).draggable(dragOption);\n\t}\n\n\tfunction initDroppable() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\n\t\tvar dropOption = {\n\t\t\taccept: SEL_ITEM,\n\t\t\tactiveClass: CLS_GAP_HIGHLIGHT,\n\t\t\ttolerance: \"intersect\",\n\t\t\tgreedy: true,\n\t\t\tover: function (event, ui) {\n\t\t\t\tvar $gap = $(this).css('zIndex', 1);\n\t\t\t\tvar $gapMid = $gap.find(SEL_GAP_MID);\n\t\t\t\t$gapMid.stop().animate({\n\t\t\t\t\twidth: ui.draggable.find(SEL_ITEM_MID).width() + 6\n\t\t\t\t});\n\t\t\t},\n\t\t\tout: function (/*event, ui*/) {\n\t\t\t\tvar $gap = $(this).css('zIndex', 0);\n\t\t\t\tvar $gapMid = $gap.find(SEL_GAP_MID);\n\t\t\t\t$gapMid.stop().animate({\n\t\t\t\t\twidth: $gap.width()\n\t\t\t\t}, function () {\n\t\t\t\t\t$gapMid.each(clearStyle);\n\t\t\t\t});\n\t\t\t},\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tif (_inDropping) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t_inDropping = true;\n\t\t\t\t}\n\n\t\t\t\t//disable item draggable\n\t\t\t\tvar $item = ui.draggable.draggable({\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\t\t\t\t//disable gap droppable\n\t\t\t\tvar $gap = $(this).droppable({\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\n\t\t\t\t//set gap middle blank to item width subtract 13 to fit for item\n\t\t\t\tvar $gapMid = $gap.find(SEL_GAP_MID);\n\t\t\t\t$gapMid.stop().css({\n\t\t\t\t\twidth: $item.find(SEL_ITEM_MID).width() + 6\n\t\t\t\t});\n\n\t\t\t\t//animate to move drag item into the gap\n\t\t\t\tvar gapOff = $gap.offset();\n\t\t\t\tvar itemOff = $item.offset();\n\t\t\t\tvar deltaOff = {\n\t\t\t\t\tleft: gapOff.left - itemOff.left,\n\t\t\t\t\ttop: gapOff.top - itemOff.top\n\t\t\t\t};\n\t\t\t\t$item.animate({\n\t\t\t\t\tleft: parseInt($item.css('left')) + deltaOff.left + 4,\n\t\t\t\t\ttop: parseInt($item.css('top')) + deltaOff.top + 3\n\t\t\t\t}, 100, function () {\n\t\t\t\t\t//append item to gap\n\t\t\t\t\t$gap.find(SEL_GAP_MID).append($item.each(clearStyle).addClass(CLS_ITEM_PLACED));\n\t\t\t\t\t$gap.css('width', 'auto');\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\thandleInteraction.call(me, $gap, $item);\n\t\t\t\t\t}, 500);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t$ROOT.find(SEL_GAP).droppable(dropOption);\n\t}\n\n\t/*\n\t * Check answer with dragged id and correct answer id\n\t * set result to json data\n\t */\n\tfunction handleInteraction($gap, $item) {\n\t\tvar me = this;\n\t\tvar gapId = $gap.data('id');\n\t\tvar itemId = $item.data('id');\n\n\t\tif (!gapId || !itemId)\n\t\t\treturn;\n\n\t\tvar correct = (gapId === itemId);\n\n\t\tvar promise = me._super.publishInteraction(\n\t\t\tInteraction.makeMatchingInteraction(correct, gapId, itemId));\n\n\t\tif (correct) {\n\t\t\tme._correctAnswers += 1;\n\t\t}\n\t\tif (me._totalAnswers === me._correctAnswers) {\n\t\t\tme._json.content._isCorrect = true;\n\t\t\tpromise.then(function () {\n\t\t\t\tme._item.completed(true);\n\t\t\t});\n\t\t}\n\n\t\tdisplayInteractionResult.call(me, correct, $gap, $item);\n\t}\n\n\t/*\n\t * Animate drag item back to original position\n\t * Finish Drop\n\t */\n\tfunction backToOriginPosition($item) {\n\t\t$item.removeClass(CLS_ITEM_INCORRECT + ' ' + CLS_ITEM_PLACED);\n\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\titemOff = $item.offset(),\n\t\t\t$gap = $item.closest(SEL_GAP),\n\t\t\t$gapMid = $gap.find(SEL_GAP_MID);\n\t\t$gap.css({\n\t\t\twidth: $gap.width()\n\t\t});\n\n\t\t//set gap middle element back to min width\n\t\t$gapMid.animate({\n\t\t\twidth: 50\n\t\t}, function () {\n\t\t\t$gapMid.each(clearStyle);\n\t\t\t$gap.each(clearStyle);\n\t\t});\n\t\t//detach item and append to template root element to normalize position when scrollbar shows\n\t\t$item.detach().css({\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 10\n\t\t}).appendTo($ROOT).offset(itemOff).find(SEL_ITEM_MID).each(clearStyle);\n\t\t//get target li element\n\t\tvar $li = $ROOT.find(SEL_ITEMS).find('li').eq(parseInt($item.data('index'))).css({\n\t\t\t\twidth: $item.width() + 20\n\t\t\t}),\n\t\t\tliOff = $li.offset(),\n\t\t\tdeltaOff = {\n\t\t\t\tleft: liOff.left - itemOff.left,\n\t\t\t\ttop: liOff.top - itemOff.top\n\t\t\t};\n\t\t//animate item back to original position smoothly\n\t\t$item.animate({\n\t\t\tleft: parseInt($item.css('left')) + deltaOff.left + 10,\n\t\t\ttop: parseInt($item.css('top')) + deltaOff.top\n\t\t}, function () {\n\t\t\t//append item to target li element\n\t\t\t$li.append($item.each(clearStyle).css({\n\t\t\t\tposition: 'relative'\n\t\t\t}).draggable({\n\t\t\t\tdisabled: false\n\t\t\t})).each(clearStyle);\n\t\t\t//complete dropping\n\t\t\t_inDropping = false;\n\t\t});\n\t}\n\n\t/**\n\t * Use scoring data to set each gap's style\n\t */\n\tfunction displayInteractionResult(correct, $gap, $item) {\n\t\tvar me = this;\n\n\t\tif (correct) {\n\t\t\tmarkCorrect.call(me, $gap);\n\t\t} else {\n\t\t\tmarkIncorrect.call(me, $gap, $item);\n\t\t}\n\n\t\tfixIERender.call(me);\n\t}\n\n\t/**\n\t * Mark correct gap with correct style\n\t */\n\tfunction markCorrect($gap) {\n\t\t//set correct get to green simple span style\n\t\tvar span = $('<span>').html($gap.find(SEL_TXT).text());\n\t\t$gap.removeClass().each(clearStyle).addClass(CLS_ITEM_SIMPLE_CORRECT).html(span).removeAttr(\"data-at-tag\");\n\t\t_inDropping = false;\n\t}\n\n\t/*\n\t * Mark Incorrect gap with incorrect style\n\t * Call backToOriginPosition function\n\t */\n\tfunction markIncorrect($gap, $item) {\n\t\tvar me = this;\n\t\t//set gap to fixed width to fit for incorrect item\n\t\t$gap.droppable({\n\t\t\tdisabled: false\n\t\t});\n\n\t\t$item.addClass(CLS_ITEM_INCORRECT);\n\t\t_timeoutToBack = window.setTimeout(function () {\n\t\t\tbackToOriginPosition.call(me, $item);\n\t\t}, 500);\n\t}\n\n\treturn Widget.extend({\n\t\t'sig/render': function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(_timeoutToBack);\n\t\t\twindow.clearTimeout(_timeoutToCheckHeight);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t_inDragging = _inDropping = null;\n\t\t},\n\t\t'hub/activity/template/typing-drag-drop/load': function onTemplateLoad(options) {\n\t\t\tvar me = this;\n\n\t\t\tme._super = options._super;\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._hasScoring = options.hasScoring;\n\t\t\tme._hasAudio = me._json.references.aud;\n\t\t\tme._correctAnswers = 0;\n\t\t\tme._totalAnswers = me._json.content.items.reduce(function (count, item) {\n\t\t\t\treturn count + item.gaps.length;\n\t\t\t}, 0);\n\t\t\treturn me.signal('render');\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/activity/typing-drag-drop/main',[\n\t'jquery',\n\t\"poly\",\n\t'underscore',\n\t'school-ui-activity/activity/base/main',\n\t\"template!./main.html\",\n\t'string.split',\n\t'jquery.ui',\n\t'jquery.transit',\n\t'./typing-drag-drop'\n], function mpaMain($, poly, _, Widget, tTdp) {\n\t\"use strict\";\n\n\t/**\n\t * Filter source data\n\t * create paragraphs array from original data\n\t * @api private\n\t */\n\tfunction filterData() {\n\t\tvar me = this,\n\t\t\tdata = me._json,\n\t\t\tdragPieces = [],\n\t\t\tcaseSensitive = me._json.content.evalLogic && (me._json.content.evalLogic == 2),\n\t\t\tscoringItems = data.scoring.items || [],\n\t\t\tcontentItems = data.content.items || [];\n\n\t\tscoringItems.forEach(function (item) {\n\t\t\tdragPieces.push.apply(dragPieces, item.gaps || []);\n\t\t});\n\t\tdragPieces = _.shuffle(dragPieces);\n\t\tdata.dragPieces = dragPieces;\n\t\tdata.paragraphs = [];\n\t\tvar _gapTotal = 0;\n\t\tcontentItems.forEach(function (item) {\n\t\t\tvar paragraph = [];\n\t\t\tvar cells = split(item.txt.replace(/\\n/g, \"\"), /(<strike(?:.*?)>.*?<\\/strike>)/);\n\t\t\t$.each(cells, function (j, cellTxt) {\n\t\t\t\tvar cell = {};\n\t\t\t\tvar matches = cellTxt.match(/^<strike(?:.*?)>(.*?)<\\/strike>$/);\n\t\t\t\tif (matches) {\n\t\t\t\t\tcell._toAs = true;\n\t\t\t\t\tcell.text = matches[1];\n\t\t\t\t\t_gapTotal++;\n\t\t\t\t} else {\n\t\t\t\t\tcell.text = cellTxt;\n\t\t\t\t}\n\t\t\t\tparagraph.push(cell);\n\t\t\t});\n\t\t\tdata.paragraphs.push(paragraph);\n\t\t});\n\n\t\tscoringItems.forEach(function (item) {\n\t\t\titem.gaps.forEach(function (gap) {\n\t\t\t\t//replace html tag and \\n to adapt to existing content\n\t\t\t\tif (gap.txt != null) {\n\t\t\t\t\tgap.txt = $.trim(gap.txt.replace(/\\n/g, '').replace(/<.*?>/ig, ''));\n\t\t\t\t\tif (!caseSensitive) {\n\t\t\t\t\t\tgap.txt = gap.txt.toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tdata._gapTotal = _gapTotal;\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\tif (!me._htmlPromise) {\n\t\t\tme._htmlPromise = me.html(tTdp, me._json);\n\t\t}\n\n\t\treturn me._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish('activity/template/typing-drag-drop/load', {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tjson: me._json,\n\t\t\t\t\thasScoring: me.hasScoring,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\treturn Widget.extend(function () {\n\t}, {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this;\n\t\t\tme.items().instantFeedback(true);\n\t\t\tfilterData.call(me);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tthis._htmlPromise = null;\n\t\t},\n\t\t_onAnswerChecked: function onAnswerChecked() {\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-tpg\";if(!data.references.aud){o += \" ets-act-tpg-noaudio\";}o += \"\\\">\\n    \";\n    if(data.references.aud){\n    o += \"\\n    <div class=\\\"ets-act-hd-ap\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                 data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                 class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n    \";\n    }\n    o += \"\\n   <div data-weave=\\\"school-ui-activity/activity/typing-gap-fill/typing-gap-fill\\\"></div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-gap-fill/typing-gap-fill.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-tpg-main\\\">\";\nvar paragraphs = data.paragraphs,\n    tabindex = 0;\nfor(var paragraphIndex=0;paragraphIndex<paragraphs.length;paragraphIndex++){\n    var paragraph = paragraphs[paragraphIndex];\n    for(var j=0;j<paragraph.length;j++){\n        var cell = paragraph[j];\n        if(cell && cell._toAs){\n            tabindex++;\no += \"\\n    <span class=\\\"ets-act-tpg-cell ets-act-tpg-n\\\">\\n        <span class=\\\"ets-act-tpg-cm\\\">\\n            <input class=\\\"ets-act-tpg-input\\\" autocomplete=\\\"off\\\" type=\\\"text\\\" data-id=\\\"\" +cell.txt+ \"\\\" data-at-id=\\\"\" +cell.txt+ \"\\\" data-weave=\\\"school-ui-activity/shared/textchange/main\\\" size=\\\"10\\\" tabindex=\\\"\" +tabindex+ \"\\\"/>\\n            <span class=\\\"ets-act-tpg-txt ets-act-tpg-none\\\"></span>\\n            <span class=\\\"ets-act-tpg-idc\\\"></span>\\n        </span>\\n    </span>\\n\";\n        }else{\no += \"\\n    \" +cell.txt+ \"    \\n\";\n        }\n    }\n}\no += \"</div>\\n<div class=\\\"ets-act-tpg-shadow ets-act-tpg-none\\\"></div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/toggle-slide/main.html',[],function() { return function template(data) { var o = \"\";\nvar outBlurb = function(id,en){\n    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n    return res;\n};\no += \"\\n<div class=\\\"ets-act-wgt-ts-ctn ets-none\\\">\\n    <div class=\\\"ets-act-wgt-ci\\\">\\n        <span \" +outBlurb(462460,\"Show correct answers\")+ \"></span>\\n    </div>\\n    <div class=\\\"ets-act-wgt-ts\\\" data-at-id=\\\"btn-show-correct-answer\\\" data-show=\\\"true\\\">\\n        <div class=\\\"ets-act-wgt-ts-sd\\\">\\n            <ul class=\\\"ets-cf\\\">\\n                <li class=\\\"ets-act-wgt-ts-hd\\\">\\n                    <span \" +outBlurb(462461,\"YES\")+ \"></span>\\n                </li>\\n                <li class=\\\"ets-act-wgt-ts-sh\\\">\\n                    <span \" +outBlurb(462462,\"NO\")+ \"></span>\\n                </li>\\n            </ul>\\n        </div>\\n        <div class=\\\"ets-act-wgt-ts-sd\\\">\\n            <div class=\\\"ets-act-wgt-ts-kb\\\"></div>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/shared/toggle-slide/main',[\n\t'jquery',\n\t'poly',\n\t'troopjs-ef/component/widget',\n\t\"template!./main.html\"\n], function mpaMain($, poly, Widget, tTs) {\n\t\"use strict\";\n\n\tvar SEL_CONTAINER = '.ets-act-wgt-ts-ctn',\n\t\tSEL_TOGGLE = '.ets-act-wgt-ts',\n\t\tSEL_KNOB = '.ets-act-wgt-ts-kb',\n\t\tNUM_TOGGLE_TIME = 250,\n\t\tNUM_TOGGLE = -78,\n\t\tNUM_KNOB = 44;\n\n\tfunction render() {\n\t\tvar me = this;\n\t\t// Render widget\n\t\treturn me.html(tTs)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_CONTAINER).delegate(SEL_TOGGLE, 'click', toggleSlideClick.bind(me));\n\t}\n\n\t/**\n\t * toggle slide button click handler\n\t */\n\tfunction toggleSlideClick() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$ele = $ROOT.find(SEL_TOGGLE),\n\t\t\tshow = $ele.data('show'),\n\t\t\t$knob = $ele.find(SEL_KNOB);\n\t\tif ($knob.is(':animated')) {\n\t\t\treturn;\n\t\t}\n\t\t$knob.animate({\n\t\t\tleft: (show ? NUM_KNOB : 0)\n\t\t}, NUM_TOGGLE_TIME);\n\t\t$ele.find('ul').animate({\n\t\t\tmarginLeft: (show ? 0 : NUM_TOGGLE)\n\t\t}, NUM_TOGGLE_TIME, function () {\n\t\t\t$ele.data('show', !show);\n\t\t\tme.publish('activity/correctanswer/show', show);\n\t\t});\n\t}\n\n\t/**\n\t * Show or hide\n\t **/\n\tfunction toggleSlideShow(setting) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$container = $ROOT.find(SEL_CONTAINER);\n\t\tif (setting.show) {\n\t\t\tif (!($container.is(':visible') == 'true')) {\n\t\t\t\tsetting.style && $container.css(setting.style);\n\t\t\t\t$container.fadeIn();\n\t\t\t}\n\t\t} else {\n\t\t\t$container.fadeOut();\n\t\t}\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/activity/widget/toggleslide/toggle\": function onToggle() {\n\t\t\ttoggleSlideClick.call(this);\n\t\t},\n\t\t\"hub/activity/widget/toggleslide/show\": function onUIShow(setting) {\n\t\t\ttoggleSlideShow.call(this, setting);\n\t\t}\n\t});\n});\n\n",
    "// # Task Module\ndefine('school-ui-activity/activity/typing-gap-fill/typing-gap-fill',[\n\t'jquery',\n\t'jquery.ui',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t\"school-ui-shared/utils/browser-check\",\n\t'template!./typing-gap-fill.html',\n\t'school-ui-activity/util/activity-util',\n\t'school-ui-activity/shared/typing-helper/main',\n\t'jquery.jscrollpane',\n\t'jquery.mousewheel',\n\t'json2',\n\t'school-ui-activity/shared/toggle-slide/main'\n], function mpaMain($, ui$, poly, when, Widget, Scoring, Interaction, browserCheck, tTpg, Util, TypingHelper) {\n\t\"use strict\";\n\n\tvar _canCheckAnswer;\n\tvar _timeOutToRemoveIncorrect;\n\tvar _timeoutToChangeSize;\n\tvar _timeoutToCheckHeight;\n\tvar _timeoutToChangeScrollbarAlphaFirst;\n\tvar _timeoutToChangeScrollbarAlphaSecond;\n\tvar _ISIE = browserCheck.browser === \"msie\";\n\n\tvar CLS_HIGHLIGHT = 'ets-act-tpg-h';\n\tvar CLS_INCORRECT = 'ets-act-tpg-ic';\n\tvar CLS_CORRECT = 'ets-act-tpg-sc';\n\tvar CLS_EXAMPLE = 'ets-act-tpg-e';\n\tvar CLS_NONE = 'ets-act-tpg-none';\n\tvar CLS_NOAUDIO = 'ets-act-tpg-noaudio';\n\tvar SEL_MAIN = '.ets-act-tpg-main';\n\tvar SEL_SHADOW = '.ets-act-tpg-shadow';\n\tvar SEL_INPUT = 'input';\n\tvar SEL_TXT = '.ets-act-tpg-txt';\n\tvar SEL_NORMAL = '.ets-act-tpg-n';\n\tvar SEL_EXAMPLE = '.ets-act-tpg-e';\n\tvar SEL_INCORRECT = '.ets-act-tpg-ic';\n\tvar EVT_TXTCHANGE = 'EFTextChange';\n\n\tvar DATA_CLIENT_X = '_clientX';\n\tvar DATA_SCROLL_LEFT = '_scrollLeft';\n\n\tvar fixIERenderProxy = function () {\n\t};\n\n\t// fixScrollBarPositionProxy is to fix bug SPC-220\n\tvar fixScrollBarPositionProxy = function () {\n\t};\n\n\tvar computeAnsweredNumberProxy = function () {\n\t};\n\n\n\t/**\n\t * Get correct answer from scoring text with gap's data-id\n\t */\n\tfunction getAnswerFromScoring(id) {\n\t\tvar answer = null;\n\t\t$.each(this._json._correctAns, function (i, gap) {\n\t\t\tif (gap._id == id) {\n\t\t\t\tanswer = gap.txt;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn answer;\n\t}\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\t\t// Render widget\n\t\treturn me.html(tTpg, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\t/**\n\t * On activity rendered\n\t */\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tinitScrollPane.call(me);\n\t\tinitInputFocusHandler.call(me);\n\t\tinitInputChangeHandler.call(me);\n\t\tinitTextSelectHandler.call(me);\n\n\t\t//functions for only grade mode\n\t\tif (me._hasScoring) {\n\t\t\tinitExampleClickHandler.call(me);\n\t\t}\n\t\tfixIERenderProxy = fixIERender.bind(me.$element.find(SEL_MAIN));\n\t\tfixScrollBarPositionProxy = fixScrollBarPosition.bind(me.$element.find(SEL_MAIN));\n\n\t\tif (me._json.isGradeMode) {\n\t\t\tme.append('<div class=\"ets-act-tpg-b\" data-weave=\"school-ui-activity/shared/toggle-slide/main\"></div>');\n\t\t}\n\t}\n\n\tfunction initScrollPanelEvent($pane) {\n\t\tvar dragBarSelector = '.jspDrag',\n\t\t\tjspaneSelector = '.jspPane',\n\t\t\teventScroll = 'jsp-scroll-y',\n\t\t\teventInitialed = 'jsp-initialised';\n\t\treturn $pane.bind(eventInitialed, function () {\n\t\t\t$pane.unbind(eventInitialed);\n\t\t\tvar $dragbar = $pane.find(dragBarSelector);\n\t\t\t_timeoutToChangeScrollbarAlphaFirst = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 5000);\n\n\t\t\t_timeoutToChangeScrollbarAlphaSecond = setTimeout(function () {\n\t\t\t\tUtil.blink.call($, $dragbar);\n\t\t\t}, 30000);\n\n\t\t\t$pane.bind(eventScroll, function () {\n\t\t\t\t$pane.unbind(eventScroll);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t});\n\t\t\tvar height = $pane.find(jspaneSelector).height();\n\n\t\t\tfunction checkHeight() {\n\t\t\t\tvar newHeight = $pane.find(jspaneSelector).height();\n\t\t\t\tif (parseInt(newHeight) != parseInt(height)) {\n\t\t\t\t\t$pane.jScrollPane();\n\t\t\t\t}\n\t\t\t\theight = newHeight;\n\t\t\t\t_timeoutToCheckHeight = setTimeout(checkHeight, 100);\n\t\t\t}\n\n\t\t\t_timeoutToCheckHeight = setTimeout(checkHeight, 100);\n\t\t});\n\t}\n\n\tfunction initScrollPane() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\tvar $pane = $ROOT.find(SEL_MAIN);\n\t\tvar noAudio = $ROOT.parent().hasClass(CLS_NOAUDIO);\n\t\tvar contentHeight = $pane.height();\n\t\tvar contentMaxHeight = 430 - (me._hasScoring ? 61 : 0) - (noAudio ? 0 : 85);\n\t\tif (contentHeight > contentMaxHeight) {\n\t\t\t$pane.css('height', contentMaxHeight - 22);\n\t\t\t$ROOT.find(SEL_SHADOW).show();\n\t\t} else {\n\t\t\t$pane.css('height', contentMaxHeight);\n\t\t}\n\t\tinitScrollPanelEvent($pane).jScrollPane();\n\t}\n\n\tfunction initInputFocusHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_INPUT).bind('focus', function () {\n\t\t\t$(this).closest(SEL_NORMAL).addClass(CLS_HIGHLIGHT);\n\t\t}).bind('blur', function () {\n\t\t\t$(this).closest(SEL_NORMAL).removeClass(CLS_HIGHLIGHT);\n\t\t});\n\t}\n\n\tfunction initInputChangeHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\tcomputeAnsweredNumberProxy = computeAnsweredNumber.bind(me);\n\t\t$ROOT.find(SEL_INPUT).bind(EVT_TXTCHANGE, onTextChange);\n\t\t$ROOT.find(SEL_NORMAL).delegate('input', 'keydown keypress', function (e) {\n\t\t\te.stopPropagation();\n\t\t})\n\t}\n\n\tfunction initTextSelectHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_TXT).attr('unselectable', 'on').attr('onselectstart', 'return false;');\n\t}\n\n\tfunction initExampleClickHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_MAIN).delegate(SEL_EXAMPLE, 'click', function () {\n\t\t\tme.publish(\"activity/widget/toggleslide/toggle\");\n\t\t});\n\t}\n\n\tfunction changeInputSize($inputEle) {\n\t\tvar value = $inputEle.val();\n\n\t\tfunction changeSize($inputEle, expands) {\n\t\t\tfixIERenderProxy();\n\t\t\tvar inputEle = $inputEle.get(0),\n\t\t\t\tsize = parseInt((inputEle.getAttribute && inputEle.getAttribute('size')) || inputEle.size);\n\t\t\tif (!size || (expands && size == 20) || (!expands && size == 10)) {\n\t\t\t\tfixScrollBarPositionProxy();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$inputEle.attr('size', expands ? ++size : --size);\n\t\t\t_timeoutToChangeSize = setTimeout(function () {\n\t\t\t\tchangeSize($inputEle, expands);\n\t\t\t}, 15);\n\t\t}\n\n\t\tvar isExpanded = $inputEle.data('expand');\n\t\tif ((isExpanded && value.length <= 10) || (!isExpanded && value.length > 10)) {\n\t\t\t$inputEle.data('expand', !isExpanded);\n\t\t\tclearTimeout(_timeoutToChangeSize);\n\t\t\tchangeSize($inputEle, !isExpanded);\n\t\t}\n\t}\n\n\tfunction onTextChange() {\n\t\tchangeInputSize($(this));\n\t\tcomputeAnsweredNumberProxy();\n\t}\n\n\tfunction fixScrollBarPosition() {\n\t\ttry {\n\t\t\tthis.data('jsp').scrollByY(0);\n\t\t} catch (ignored) {\n\t\t\t// ignore exception\n\t\t}\n\t}\n\n\tfunction computeAnsweredNumber() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\titem = me._item,\n\t\t\tansweredNumber = 0,\n\t\t\t$inputEles = $ROOT.find(SEL_INPUT);\n\t\t$inputEles.each(function () {\n\t\t\tvar value = $.trim($(this).val());\n\t\t\tif (value) {\n\t\t\t\tansweredNumber++;\n\t\t\t}\n\t\t});\n\t\tansweredNumber < $inputEles.length ? item.answered(false) : item.answered(true);\n\t}\n\n\tfunction toggleCorrectAnswer(show) {\n\t\tvar me = this,\n\t\t\titem = me._item;\n\t\twindow.clearTimeout(_timeOutToRemoveIncorrect);\n\t\tif (show) {\n\t\t\tshowCorrectAnswer.call(me);\n\t\t\t_canCheckAnswer = item.answered();\n\t\t\titem.answered(false);\n\t\t} else {\n\t\t\thideCorrectAnswer.call(me);\n\t\t\titem.answered(_canCheckAnswer);\n\t\t}\n\t}\n\n\tfunction showCorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_NORMAL).each(function () {\n\t\t\tvar $gap = $(this);\n\t\t\tif (!($gap.hasClass(CLS_CORRECT))) {\n\t\t\t\t$gap.addClass(CLS_EXAMPLE);\n\t\t\t\tvar answerId = $gap.find(SEL_INPUT).addClass(CLS_NONE).data('id');\n\t\t\t\t$gap.find(SEL_TXT).text(getAnswerFromScoring.call(me, answerId)).removeClass(CLS_NONE);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction hideCorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$example = $ROOT.find(SEL_EXAMPLE).removeClass(CLS_EXAMPLE);\n\t\t$example.find(SEL_TXT).addClass(CLS_NONE);\n\t\t$example.find(SEL_INPUT).removeClass(CLS_NONE);\n\t\tremoveIncorrectAnswer.call(me);\n\t}\n\n\tfunction removeIncorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$incorrect = $ROOT.find(SEL_INCORRECT);\n\t\t$incorrect.find('span').addClass(CLS_NONE);\n\t\tvar $input = $incorrect.find(SEL_INPUT);\n\t\t$input.removeClass(CLS_NONE).data('expand', 0).attr('size', 10);\n\t\t$input.val('');\n\t\t$incorrect.removeClass(CLS_INCORRECT);\n\t\tfixIERenderProxy();\n\t}\n\n\tfunction fixIERender() {\n\t\tif (!_ISIE) {\n\t\t\treturn;\n\t\t}\n\t\t/**\n\t\t * IE is ugly, will not rerender all elements of dom tree, use addClass to force rerender\n\t\t **/\n\t\tthis.addClass('notExists');\n\t}\n\n\tfunction _onTouchStart($evt) {\n\t\tvar touch = $evt.originalEvent.touches[0];\n\n\t\tvar $input = $($evt.currentTarget);\n\t\t$input\n\t\t\t.data(DATA_CLIENT_X, touch.clientX)\n\t\t\t.data(DATA_SCROLL_LEFT, $input.scrollLeft());\n\t}\n\n\tfunction _onTouchEnd($evt) {\n\t\tvar $input = $($evt.currentTarget);\n\t\t$input.removeData([DATA_CLIENT_X, DATA_SCROLL_LEFT]);\n\t}\n\n\tfunction _onTouchMove($evt) {\n\t\t$evt.preventDefault();\n\n\t\tvar touch = $evt.originalEvent.touches[0];\n\t\tvar currentX = touch.clientX;\n\n\t\tvar $input = $($evt.currentTarget);\n\t\tvar startX = $input.data(DATA_CLIENT_X);\n\t\tvar startScrollLeft = $input.data(DATA_SCROLL_LEFT);\n\t\tif (startX === undefined || startScrollLeft === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar changedX = currentX - startX;\n\t\t$input.scrollLeft(startScrollLeft - changedX);\n\t}\n\n\tfunction fixTextScrollforIOS() {\n\t\tvar me = this;\n\t\tme.$element\n\t\t\t.on('touchstart', '.ets-act-tpg-input', _onTouchStart)\n\t\t\t.on('touchend', '.ets-act-tpg-input', _onTouchEnd)\n\t\t\t.on('touchmove', '.ets-act-tpg-input', _onTouchMove);\n\t}\n\n\treturn Widget.extend({\n\t\t'sig/start': function () {\n\t\t\tif (browserCheck.os === 'ios') {\n\t\t\t\tfixTextScrollforIOS.call(this);\n\t\t\t}\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(_timeOutToRemoveIncorrect);\n\t\t\twindow.clearTimeout(_timeoutToCheckHeight);\n\t\t\twindow.clearTimeout(_timeoutToChangeSize);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaFirst);\n\t\t\twindow.clearTimeout(_timeoutToChangeScrollbarAlphaSecond);\n\t\t\t_canCheckAnswer = null;\n\t\t\tvar me = this;\n\t\t\tme.audioPlayer && me.audioPlayer.pause();\n\t\t},\n\t\t'sig/render': function onRender() {\n\t\t\treturn when.all([\n\t\t\t\trender.call(this),\n\t\t\t\tTypingHelper.readyPromise\n\t\t\t]);\n\t\t},\n\t\t'hub/activity/template/typing-gap-fill/load': function onTemplateLoad(options) {\n\t\t\tvar me = this;\n\t\t\tme._json = options.json;\n\t\t\tme._item = options.item;\n\t\t\tme._super = options._super;\n\t\t\tme._hasScoring = options.hasScoring;\n\t\t\tme._json._originalScoring = JSON.stringify(me._json.scoring);\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/correctanswer/show': function onCorrectAnswerShow(show) {\n\t\t\ttoggleCorrectAnswer.call(this, show);\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar $element = me.$element;\n\t\t\tvar caseSensitive = me._json.content.evalLogic && (me._json.content.evalLogic == 2);\n\t\t\tvar allCorrect = true;\n\n\t\t\tvar inputIds = [];\n\n\t\t\tvar scoringGaps = me._json.scoring.items.reduce(function(list, item) {\n\t\t\t\treturn list.concat(item.gaps);\n\t\t\t}, []);\n\n\t\t\t$element.find(SEL_INPUT).each(function (i, input) {\n\t\t\t\tvar $input = $(input);\n\t\t\t\tvar inputId = $input.data('id');\n\t\t\t\tvar inputText = TypingHelper.cleanTypingAnswer($input.val());\n\t\t\t\tvar answerText = inputText;\n\t\t\t\tif (!caseSensitive) {\n\t\t\t\t\tanswerText = answerText.toLowerCase();\n\t\t\t\t}\n\n\t\t\t\tvar solution = Scoring.findById(scoringGaps, inputId);\n\t\t\t\tvar solutionTexts = TypingHelper.prepareTypingSolution(solution.txt);\n\n\t\t\t\tvar correct = solutionTexts.indexOf(answerText) >= 0;\n\t\t\t\tallCorrect = allCorrect && correct;\n\n\t\t\t\tme.displayInputCorrectness($input, inputText, correct);\n\n\t\t\t\tinputIds.push(inputId);\n\t\t\t});\n\n\t\t\tinputIds.sort();\n\t\t\tvar interaction = Interaction.makeTypingInteraction(allCorrect, inputIds.join('+'));\n\t\t\tvar promise = me.publish(\"typing-gap-fill/interaction\", interaction);\n\n\t\t\tif (allCorrect) {\n\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\tme.publish(\"activity/widget/toggleslide/show\", false);\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.publish(\"activity/widget/toggleslide/show\", {\n\t\t\t\t\tshow: true\n\t\t\t\t});\n\t\t\t\tme._item.answered(false);\n\t\t\t\t//Remove Incorrect style\n\t\t\t\t_timeOutToRemoveIncorrect = window.setTimeout(function () {\n\t\t\t\t\tremoveIncorrectAnswer.call(me);\n\t\t\t\t}, 2500);\n\t\t\t}\n\t\t},\n\t\tdisplayInputCorrectness: function ($input, inputText, correct) {\n\t\t\tvar $cell = $input.closest(SEL_NORMAL);\n\t\t\t$input.addClass(CLS_NONE);\n\t\t\tif (correct) {\n\t\t\t\tvar $span = $('<span>').text(inputText);\n\t\t\t\t$cell.removeClass().addClass(CLS_CORRECT).empty().append($span);\n\t\t\t} else {\n\t\t\t\t$cell.find(SEL_TXT).text(inputText).removeClass(CLS_NONE);\n\t\t\t\t$cell.addClass(CLS_INCORRECT);\n\t\t\t}\n\t\t},\n\t\t'hub/activity/template/typing-gap-fill/show-non-graded-feedback': function () {\n\t\t\tvar me = this;\n\t\t\tvar $element = me.$element;\n\t\t\t$element.find(SEL_INPUT).each(function (i, input) {\n\t\t\t\tvar $input = $(input);\n\t\t\t\tvar inputText = TypingHelper.cleanTypingAnswer($input.val());\n\t\t\t\tme.displayInputCorrectness($input, inputText, true);\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/activity/typing-gap-fill/main',[\n\t'jquery',\n\t'poly',\n\t'when',\n\t'school-ui-activity/activity/base/main',\n\t\"troopjs-core/component/factory\",\n\t\"template!./main.html\",\n\t'string.split',\n\t'underscore',\n\t'jquery.ui',\n\t'jquery.transit',\n\t'./typing-gap-fill'\n], function mpaMain($, poly, when, Widget, Factory, tTpg) {\n\t\"use strict\";\n\n\t/**\n\t * Filter source data\n\t */\n\tfunction filterData() {\n\t\tvar me = this,\n\t\t\tdata = me._json,\n\t\t\tparagraphs = [],\n\t\t\tmaxParagraphs = data.filterOptions.questionNo,\n\t\t\tcaseSensitive = data.content.evalLogic && (data.content.evalLogic == 2),\n\t\t\tisGradeMode = me.hasScoring;\n\n\t\t//item bank\n\t\tif (maxParagraphs < data.content.items.length) {\n\t\t\tdata.content.items.splice(maxParagraphs - 1, data.content.items.length - maxParagraphs);\n\t\t}\n\n\t\t//generate paragraph array for UI render\n\t\tvar paragrapIds = [];\n\t\t$.each(data.content.items, function (i, item) {\n\t\t\tparagrapIds.push(item._id);\n\t\t\tvar paragrap = [],\n\t\t\t\tcells = split(item.txt.replace(/\\n/g, ''), /(<strike(?:.*?)>.*?<\\/strike>)/);\n\t\t\t$.each(cells, function (j, cell) {\n\t\t\t\tvar gap = {},\n\t\t\t\t\tmatches = cell.match(/^<strike(?:.*?)>(.*?)<\\/strike>$/);\n\t\t\t\tif (matches) {\n\t\t\t\t\tgap._toAs = true;\n\t\t\t\t\tgap.txt = matches[1];\n\t\t\t\t} else {\n\t\t\t\t\tgap.txt = $.trim(cell);\n\t\t\t\t}\n\t\t\t\tparagrap.push(gap);\n\t\t\t});\n\t\t\tparagraphs.push(paragrap);\n\t\t});\n\t\tdata.paragraphs = paragraphs;\n\t\tdata.isGradeMode = isGradeMode;\n\t\tif (isGradeMode) {\n\t\t\t//remove none used scoring data to improve scoring performance\n\t\t\tfor (var i = data.scoring.items.length - 1; i >= 0; i--) {\n\t\t\t\tvar item = data.scoring.items[i];\n\t\t\t\tif ($.inArray(item._id, paragrapIds) < 0) {\n\t\t\t\t\tdata.scoring.items.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//_correctAns stores original correct answers,because _scoring may change to lower case when case insensitive\n\t\t\tdata._correctAns = [];\n\t\t\t$.each(data.scoring.items, function (i, item) {\n\t\t\t\t$.each(item.gaps, function (k, gap) {\n\t\t\t\t\t//replace html tag and \\n to adapt to existing content\n\t\t\t\t\tif (gap.txt != null) {\n\t\t\t\t\t\tgap.txt = $.trim(gap.txt.replace(/\\n/g, '').replace(/<.*?>/ig, ''));\n\t\t\t\t\t\tdata._correctAns.push({_id: gap._id, txt: gap.txt.split('/')[0]});\n\t\t\t\t\t\t// Eval Logic\n\t\t\t\t\t\t!caseSensitive && (gap.txt = gap.txt.toLowerCase());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me._htmlPromise) {\n\t\t\tme._htmlPromise = me.html(tTpg, me._json);\n\t\t}\n\n\t\treturn me._htmlPromise.then(function () {\n\t\t\treturn me.publish('activity/template/typing-gap-fill/load', {\n\t\t\t\titem: me.items(),\n\t\t\t\tjson: me._json,\n\t\t\t\thasScoring: me.hasScoring,\n\t\t\t\t_super: me\n\t\t\t});\n\t\t});\n\t}\n\n\tvar extendOptions = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this;\n\t\t\tif (!me.hasScoring) {\n\t\t\t\tme.type(Widget.ACT_TYPE.PRACTICE);\n\t\t\t} else {\n\t\t\t\tme.items().completed(false);\n\t\t\t}\n\n\t\t\tfilterData.call(me);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tme._htmlPromise = null;\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"hub/typing-gap-fill/interaction\": function(interaction) {\n\t\t\treturn this.publishInteraction(interaction);\n\t\t},\n\t\tcompleted: Factory.around(function (base) {\n\t\t\treturn function (isCompleted) {\n\t\t\t\tvar me = this;\n\t\t\t\tif (!me.hasScoring && isCompleted) {\n\t\t\t\t\tme.publish('activity/template/typing-gap-fill/show-non-graded-feedback');\n\t\t\t\t}\n\t\t\t\treturn base.call(this, isCompleted);\n\t\t\t}\n\t\t})\n\t};\n\treturn Widget.extend(function () {\n\t}, extendOptions);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-table/main.html',[],function() { return function template(data) { var o = \"\";\nvar outBlurb = function(id,en){\n    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n    return res;\n};\no += \"\\n<div class=\\\"ets-act-tpt\\\">\\n    \";if(data.references.aud){o += \"\\n    <div class=\\\"ets-act-hd-ap\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n    \";}o += \"\\n    <div class=\\\"ets-act-tpt-main\\\" data-weave=\\\"school-ui-activity/activity/typing-table/typing-table\\\">\\n    </div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/typing-table/typing-table.html',[],function() { return function template(data) { var o = \"\";\n    var items = data.tables;\n\tvar attr = data.tablesAttr[data.curPage];\n    var item = items[data.curPage];\n    var rows = item.length;\n    var cols = item[rows-1] && item[rows-1].length;\no += \"\\n<table class=\\\"ets-act-tpt-t\\\">\\n    \";\n        for(var i = 0 ; i < rows ; i++){\n    o += \"\\n        <tr class=\\\"\" +(i==rows-1?'ets-act-tpt-last':'ets-act-tpt-tr-m')+ \"\\\">\\n            \";\n                for(var j=0;j<cols;j++){\n            o += \"\\n\\t\\t\\t\\t\";\n\t                if(attr[i][j] != undefined) {\n\t            o += \"\\n                <td class=\\\"\" +(j==cols-1?'ets-act-tpt-last':'ets-act-tpt-m')+ \"\\\" \" + (attr[i][j]?attr[i][j]:'')+ \" >\\n                    \";\n                        if(item[i][j]){\n                            if(item[i][j]._toAnswer != null){\n                    o += \"\\n                            <div class=\\\"ets-act-tpt-input ets-act-tpt-n\\\" data-r=\\\"\" +i+ \"\\\" data-c=\\\"\" +j+ \"\\\">\\n                                <input type=\\\"text\\\" data-id=\\\"\" +item[i][j]._toAnswer+ \"\\\" data-at-id=\\\"\" +item[i][j]._toAnswer+ \"\\\" data-weave=\\\"school-ui-activity/shared/textchange/main\\\" maxlength='200'/>\\n                                <span class=\\\"ets-act-tpt-txt ets-none\\\"></span>\\n                            </div>\\n                            \";}else{o += \"\\n                                \" +item[i][j]+ \"\\n                            \";}\n                        }\n                    o += \"\\n                </td>\\n\\t\\t        \";\n\t\t            }\n\t\t        o += \"\\n            \";\n                }\n            o += \"\\n        </tr>\\n    \";\n        }\n    o += \"\\n</table>\\n<div class=\\\"ets-act-tpt-b\\\" data-weave=\\\"school-ui-activity/shared/toggle-slide/main\\\"></div>\"; return o; }; });\n",
    "// # Task Module\ndefine('school-ui-activity/activity/typing-table/typing-table',[\n\t'jquery',\n\t'jquery.ui',\n\t'jquery.gudstrap', //for tooltip\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-activity/util/scoring',\n\t'school-ui-activity/util/interaction',\n\t'template!./typing-table.html',\n\t'school-ui-activity/shared/typing-helper/main',\n\t'json2',\n\t'school-ui-activity/shared/toggle-slide/main'\n], function ($, ui$, gud$, poly, when, Widget, Scoring, Interaction, tTptMain, TypingHelper, JSON) {\n\t\"use strict\";\n\n\tvar _canCheckAnswer,\n\t\t_timeOutToRemoveIncorrect,\n\t\tCLS_HIGHLIGHT = 'ets-act-tpt-h',\n\t\tCLS_CORRECT = 'ets-act-tpt-c',\n\t\tCLS_INCORRECT = 'ets-act-tpt-ic',\n\t\tCLS_EXAMPLE = 'ets-act-tpt-e',\n\t\tCLS_NONE = 'ets-none',\n\t\tSEL_TABLE = '.ets-act-tpt-t',\n\t\tSEL_NORMAL = '.ets-act-tpt-n',\n\t\tSEL_INCORRECT = '.' + CLS_INCORRECT,\n\t\tSEL_EXAMPLE = '.' + CLS_EXAMPLE,\n\t\tSEL_TXT = '.ets-act-tpt-txt',\n\t\tSEL_INPUT = 'input',\n\t\tEVT_TXTCHANGE = 'EFTextChange',\n\t\tNUM_CELL_WIDTH = 190,\n\t\tNUM_SIDE_CELL_WIDTH = 3,\n\t\tNUM_CALLBACK_DELAY = 1500;\n\n\t/**\n\t * Get correct answer from scoring text with gap's data-id\n\t */\n\tfunction getAnswerFromScoring(id) {\n\t\tvar answer = null;\n\t\t$.each(this._json._correctAns, function (i, gap) {\n\t\t\tif (gap._id == id) {\n\t\t\t\tanswer = gap.txt;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn answer;\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\t\treturn me.html(tTptMain, me._json)\n\t\t\t.tap(onRendered.bind(me));\n\t}\n\n\tfunction onRendered() {\n\t\tvar me = this;\n\t\tinitTableWidth.call(me);\n\t\tinitInputFocusHandler.call(me);\n\t\tinitInputChangeHandler.call(me);\n\t\tinitTextSelectHandler.call(me);\n\t\tinitTableCellHoverHandler.call(me);\n\t\t//functions for only grade mode\n\t\tif (me._hasScoring) {\n\t\t\tinitExampleClickHandler.call(me);\n\t\t}\n\t}\n\n\t/**\n\t * Set table to fixed width to avoid single long text break down table layout\n\t */\n\tfunction initTableWidth() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$table = $ROOT.find(SEL_TABLE),\n\t\t\ttable = me._json.tables[me._json.curPage],\n\t\t\tcols = table[table.length - 1] && table[table.length - 1].length;\n\t\t$table.css({\n\t\t\twidth: cols * NUM_CELL_WIDTH + NUM_SIDE_CELL_WIDTH * 2\n\t\t});\n\t}\n\n\t/**\n\t * Bind focus & blur events to input elements\n\t */\n\tfunction initInputFocusHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_INPUT).bind('focus', function () {\n\t\t\t$(this).parent().addClass(CLS_HIGHLIGHT);\n\t\t}).bind('blur', function () {\n\t\t\t$(this).parent().removeClass(CLS_HIGHLIGHT);\n\t\t});\n\t}\n\n\t/**\n\t * Bind value change event to input elements\n\t */\n\tfunction initInputChangeHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_INPUT).bind(EVT_TXTCHANGE, computeAnsweredNumber.bind(me));\n\t}\n\n\t/**\n\t * Disable text selection\n\t */\n\tfunction initTextSelectHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_TXT).attr('unselectable', 'on').attr('onselectstart', 'return false;');\n\t}\n\n\t/**\n\t * Add tooltip to correct and example answer\n\t */\n\tfunction initTableCellHoverHandler() {\n\t\t$(SEL_NORMAL).find(SEL_TXT).tooltip({\n\t\t\tanimation: true,\n\t\t\ttrigger: 'hover'\n\t\t});\n\t}\n\n\t/**\n\t * Example text click handler\n\t */\n\tfunction initExampleClickHandler() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_TABLE).delegate(SEL_EXAMPLE, 'click', function () {\n\t\t\tme.publish(\"activity/widget/toggleslide/toggle\");\n\t\t});\n\t}\n\n\t/**\n\t * Compute answered number to decide whether to enable check answer button\n\t * @api private\n\t */\n\tfunction computeAnsweredNumber() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\titem = me._item,\n\t\t\tansweredNumber = 0;\n\t\t$ROOT.find(SEL_INPUT).each(function () {\n\t\t\t$.trim($(this).val()) && answeredNumber++;\n\t\t});\n\t\tansweredNumber < me._json.content.items[me._json.curPage].gaps.length ?\n\t\t\titem.answered(false) : item.answered(true);\n\t}\n\n\t/**\n\t * Toggle correct answer\n\t * @param show\n\t * @api private\n\t */\n\tfunction toggleCorrectAnswer(show) {\n\t\twindow.clearTimeout(_timeOutToRemoveIncorrect);\n\t\tvar me = this,\n\t\t\titem = me._item;\n\t\tif (show) {\n\t\t\tshowCorrectAnswer.call(me);\n\t\t\t_canCheckAnswer = item.answered();\n\t\t\titem.answered(false);\n\t\t} else {\n\t\t\thideCorrectAnswer.call(me);\n\t\t\titem.answered(_canCheckAnswer);\n\t\t}\n\t}\n\n\t/**\n\t * Show Correct Answer\n\t * @api private\n\t */\n\tfunction showCorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_NORMAL).each(function () {\n\t\t\tvar $cell = $(this);\n\t\t\tif (!($cell.hasClass(CLS_CORRECT))) {\n\t\t\t\t$cell.addClass(CLS_EXAMPLE);\n\t\t\t\t$cell.find(SEL_INPUT).addClass(CLS_NONE);\n\t\t\t\tvar answer = getAnswerFromScoring.call(me, $cell.find(SEL_INPUT).data('id'));\n\t\t\t\t$cell.find(SEL_TXT).text(answer).removeClass(CLS_NONE).attr('data-original-title', answer);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Hide correct answer\n\t * @api private\n\t */\n\tfunction hideCorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$example = $ROOT.find(SEL_EXAMPLE).removeClass(CLS_EXAMPLE);\n\t\t$example.find(SEL_TXT).addClass(CLS_NONE);\n\t\t$example.find(SEL_INPUT).removeClass(CLS_NONE);\n\t\tremoveIncorrectAnswer.call(me);\n\t}\n\n\t/*\n\t * Remove incorrect style,call when after check answer and hide correct answer\n\t * 1.hide span\n\t * 2.clear and show input\n\t * 3.remove incorrect class\n\t */\n\tfunction removeIncorrectAnswer() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$incorrect = $ROOT.find(SEL_INCORRECT);\n\t\t$incorrect.find(SEL_TXT).addClass(CLS_NONE);\n\t\tvar $input = $incorrect.find(SEL_INPUT);\n\t\t$input.removeClass(CLS_NONE);\n\t\t$input.val('');\n\t\t$incorrect.removeClass(CLS_INCORRECT);\n\t}\n\n\tfunction Ctor() {\n\t}\n\n\tvar methods = {\n\t\t'sig/render': function onRender() {\n\t\t\treturn when.all([\n\t\t\t\trender.call(this),\n\t\t\t\tTypingHelper.readyPromise\n\t\t\t]);\n\t\t},\n\t\t'sig/finalize': function onFinalize() {\n\t\t\twindow.clearTimeout(_timeOutToRemoveIncorrect);\n\t\t},\n\t\t'hub/activity/template/typing-table/load': function onTemplateLoad(options) {\n\t\t\tvar me = this;\n\t\t\tme._json = options.json;\n\t\t\tme._super = options._super;\n\t\t\tme._item = options.item;\n\t\t\tme._isLastItem = options.isLastItem;\n\t\t\tme._hasScoring = options.hasScoring;\n\t\t\tme._json._originalScoring = JSON.stringify(me._json.scoring);\n\t\t\treturn me.signal('render');\n\t\t},\n\t\t'hub/activity/correctanswer/show': function onCorrectAnswerShow(show) {\n\t\t\ttoggleCorrectAnswer.call(this, show);\n\t\t},\n\t\t'hub/activity/check/answer': function () {\n\t\t\tvar me = this;\n\t\t\tvar $element = me.$element;\n\t\t\tvar caseSensitive = me._json.content.evalLogic && (me._json.content.evalLogic == 2);\n\t\t\tvar allCorrect = true;\n\n\t\t\tvar gapIds = [];\n\n\t\t\t$element.find(SEL_INPUT).each(function (i, input) {\n\t\t\t\tvar $input = $(input);\n\t\t\t\tvar gapId = $input.data('id');\n\t\t\t\tvar itemIndex = me._json.curPage;\n\t\t\t\tvar inputText = TypingHelper.cleanTypingAnswer($input.val());\n\t\t\t\tvar answerText = inputText;\n\t\t\t\tif (!caseSensitive) {\n\t\t\t\t\tanswerText = answerText.toLowerCase();\n\t\t\t\t}\n\n\t\t\t\tvar solution = Scoring.findById(me._json.scoring.items[itemIndex].gaps, gapId);\n\t\t\t\tvar solutionTexts = TypingHelper.prepareTypingSolution(solution.txt);\n\n\t\t\t\tvar correct = solutionTexts.indexOf(answerText) >= 0;\n\t\t\t\tallCorrect = allCorrect && correct;\n\n\t\t\t\tme.displayInputCorrectness($input, inputText, correct);\n\n\t\t\t\tgapIds.push(gapId);\n\t\t\t});\n\n\t\t\tgapIds.sort();\n\t\t\tvar interaction = Interaction.makeTypingInteraction(allCorrect, gapIds.join('+'));\n\t\t\tvar promise = me.publish(\"typing-table/interaction\", interaction);\n\n\t\t\tif (allCorrect) {\n\t\t\t\tif (me._isLastItem) {\n\t\t\t\t\tme._json.content._isCorrect = true;\n\t\t\t\t}\n\t\t\t\tme.publish(\"activity/widget/toggleslide/show\", false);\n\t\t\t\tpromise.then(function () {\n\t\t\t\t\tme._item.completed(true);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.publish(\"activity/widget/toggleslide/show\", {\n\t\t\t\t\tshow: true,\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tmarginRight: ($element.width() - $element.find(SEL_TABLE).width()) / 2\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tme._item.answered(false);\n\t\t\t\t//Remove Incorrect style\n\t\t\t\t_timeOutToRemoveIncorrect = window.setTimeout(function () {\n\t\t\t\t\tremoveIncorrectAnswer.call(me);\n\t\t\t\t}, NUM_CALLBACK_DELAY);\n\t\t\t}\n\t\t},\n\t\tdisplayInputCorrectness: function ($input, inputText, correct) {\n\t\t\tvar $cell = $input.parent();\n\t\t\t$cell.find(SEL_TXT)\n\t\t\t\t.text(inputText)\n\t\t\t\t.removeClass(CLS_NONE)\n\t\t\t\t.attr('data-original-title', inputText);\n\t\t\tif (correct) {\n\t\t\t\t$cell.removeClass(CLS_INCORRECT).addClass(CLS_CORRECT);\n\t\t\t} else {\n\t\t\t\t$cell.addClass(CLS_INCORRECT);\n\t\t\t}\n\t\t},\n\t\t'hub/activity/template/typing-table/show-non-graded-feedback': function () {\n\t\t\tvar me = this;\n\t\t\tvar $element = me.$element;\n\t\t\t$element.find(SEL_INPUT).each(function (i, input) {\n\t\t\t\tvar $input = $(input);\n\t\t\t\tvar inputText = TypingHelper.cleanTypingAnswer($input.val());\n\t\t\t\tme.displayInputCorrectness($input, inputText, true);\n\t\t\t});\n\t\t}\n\t};\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "define('school-ui-activity/activity/typing-table/main',[\n\t'jquery',\n\t'poly',\n\t'../base/main',\n\t\"troopjs-core/component/factory\",\n\t'when',\n\t'template!./main.html',\n\t'underscore',\n\t'jquery.ui',\n\t'jquery.transit',\n\t'./typing-table'\n], function mpaMain($, poly, Widget, Factory, when, tTpt) {\n\t\"use strict\";\n\n\tvar REG_TR = /<tr(?:.*?)>(.*?)<\\/tr>/ig,\n\t\tREG_TD = /<td(?:.*?)>(.*?)<\\/td>/ig;\n\n\t/**\n\t * Filter source data\n\t * create table array from original data\n\t * @api private\n\t */\n\tfunction filterData() {\n\t\tvar me = this,\n\t\t\tdata = me._json,\n\t\t\tmaxTables = data.filterOptions.questionNo,\n\t\t\tcaseSensitive = data.content.evalLogic && (data.content.evalLogic == 2),\n\t\t\tisGradeMode = me.hasScoring;\n\n\t\t//item bank\n\t\tif (maxTables < data.content.items.length) {\n\t\t\tdata.content.items.splice(maxTables - 1, data.content.items.length - maxTables);\n\t\t}\n\n\t\tvar tableIds = [];\n\t\t//genarate table array from original json data\n\t\tdata.tables = [];\n\t\tdata.tablesAttr = [];\n\n\t\t$.each(data.content.items, function (i, item) {\n\t\t\ttableIds.push(item._id);\n\t\t\tvar table = [],\n\t\t\t\ttableAttr = [],\n\t\t\t\ttableTxt = item.txt.replace(/\\n/g, \"\"),\n\t\t\t\ttrResult = REG_TR.exec(tableTxt);\n\t\t\twhile (trResult) {\n\t\t\t\tvar row = [],\n\t\t\t\t\trowAttr = [],\n\t\t\t\t\ttrTxt = trResult[1],\n\t\t\t\t\ttdResult = REG_TD.exec(trTxt);\n\n\t\t\t\twhile (tdResult) {\n\t\t\t\t\tvar cell = {},\n\t\t\t\t\t\tstkResult = /<strike(?:.*?)>(.*?)<\\/strike>/ig.exec(tdResult[1]);\n\t\t\t\t\tstkResult ?\n\t\t\t\t\t\tcell._toAnswer = stkResult[1] :\n\t\t\t\t\t\tcell = tdResult[1];\n\t\t\t\t\tvar attr = /<td(.*?)>/.exec(tdResult[0]);\n\t\t\t\t\trow.push(cell);\n\t\t\t\t\trowAttr.push(attr[1]);\n\t\t\t\t\ttdResult = REG_TD.exec(trTxt);\n\t\t\t\t}\n\t\t\t\ttable.push(row);\n\t\t\t\ttableAttr.push(rowAttr);\n\t\t\t\ttrResult = REG_TR.exec(tableTxt);\n\t\t\t}\n\n\t\t\tdata.tables.push(table);\n\t\t\tdata.tablesAttr.push(tableAttr);\n\t\t});\n\n\t\tif (isGradeMode) {\n\t\t\t// remove none used scoring data to improve scoring performance\n\t\t\tfor (var i = data.scoring.items.length - 1; i >= 0; i--) {\n\t\t\t\tvar item = data.scoring.items[i];\n\t\t\t\tif ($.inArray(item._id, tableIds) < 0) {\n\t\t\t\t\tdata.scoring.items.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//_correctAns stores original correct answers,because _scoring may change to lower case when case insensitive\n\t\t\tdata._correctAns = [];\n\t\t\t$.each(data.scoring.items, function (i, item) {\n\t\t\t\t$.each(item.gaps, function (k, gap) {\n\t\t\t\t\tif (gap.txt != null) {\n\t\t\t\t\t\tgap.txt = $.trim(gap.txt.replace(/\\n/g, '').replace(/<.*?>/ig, ''));\n\t\t\t\t\t\tdata._correctAns.push({_id: gap._id, txt: gap.txt.split('/')[0]});\n\t\t\t\t\t\t// Eval Logic\n\t\t\t\t\t\t!caseSensitive && (gap.txt = gap.txt.toLowerCase());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tdata.curPage = 0;\n\t\tme.length(data.tables.length);\n\t\tme.index(data.curPage);\n\t}\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tme.publish('activity/step/render', me.index(), me.length());\n\n\t\tif (!me._htmlPromise) {\n\t\t\tme._htmlPromise = me.html(tTpt, me._json);\n\t\t}\n\n\t\treturn me._htmlPromise\n\t\t\t.then(function () {\n\t\t\t\treturn me.publish('activity/template/typing-table/load', {\n\t\t\t\t\titem: me.items(),\n\t\t\t\t\tisLastItem: me.index() === me.length() - 1,\n\t\t\t\t\tjson: me._json,\n\t\t\t\t\thasScoring: me.hasScoring,\n\t\t\t\t\t_super: me\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tfunction Ctor() {\n\t}\n\n\tvar methods = {\n\t\t\"sig/initialize\": function onInitialize() {\n\t\t\tvar me = this;\n\t\t\tif (!me.hasScoring) {\n\t\t\t\tme.type(Widget.ACT_TYPE.PRACTICE);\n\t\t\t} else {\n\t\t\t\tme.items().completed(false);\n\t\t\t}\n\n\t\t\tfilterData.call(me);\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tme._htmlPromise = null;\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\tvar me = this;\n\t\t\treturn render.call(me);\n\t\t},\n\t\t\"hub/typing-table/interaction\": function(interaction) {\n\t\t\treturn this.publishInteraction(interaction);\n\t\t},\n\t\tcompleted: Factory.around(function (base) {\n\t\t\treturn function (isCompleted) {\n\t\t\t\tvar me = this;\n\t\t\t\tif (!me.hasScoring && isCompleted) {\n\t\t\t\t\tme.publish('activity/template/typing-table/show-non-graded-feedback');\n\t\t\t\t}\n\t\t\t\treturn base.call(this, isCompleted);\n\t\t\t}\n\t\t}),\n\t\tnextStep: function () {\n\t\t\tvar me = this;\n\t\t\tme.index(++me._json.curPage);\n\t\t\trender.call(me);\n\t\t}\n\t};\n\treturn Widget.extend(Ctor, methods);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-exercise/main.html',[],function() { return function template(data) { var o = \"\";\nvar data = data || {};\n\nvar outBlurb = function(id,en){\n    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n    return res;\n};\nvar showLeft = data.references.aud || data.isGraded,\n    showExp = data.content.modelText,\n    CLS_CNT = (function(){\n    if(showLeft && !showExp) return 'ets-act-wtc-l_ne';\n    else if(!showLeft && showExp) return 'ets-act-wtc-nl_e';\n    else if(!showLeft && !showExp) return 'ets-act-wtc-nl_ne';\n    else return 'ets-act-wtc-l_e';\n})();\no += \"\\n<div class=\\\"ets-act-wtc\\\">\\n    \";if(showLeft){o += \"\\n    <div class=\\\"ets-act-wtc-l ets-act-wtc-grade_l\\\">\\n        \";if(data.references.aud){o += \"\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n        \";}o += \"\\n        \";if(data.isGraded){o += \"\\n        <div class='ets-act-wtc-fb'>\\n            <div class=\\\"ets-act-wtc-fb-nsmtd ets-act-wtc-fb-none\\\">\\n                <p \" +outBlurb(461312,\"Your answer will be sent to a teacher for review\")+ \"></p>\\n            </div>\\n            <div class=\\\"ets-act-wtc-fb-smtd ets-act-wtc-fb-none\\\">\\n                <div class=\\\"ets-act-wtc-fbh\\\"></div>\\n                <p class='ets-act-wtc-fbt' \" +outBlurb(461313,\"Submitted\")+ \"></p>\\n                <p class='ets-act-wtc-fbc' \" +outBlurb(423933,\"Unfortunately, due to increasing student numbers, your writing assignment might take a little longer than usual to be graded. Please check your writing carefully before you click 'Submit', and make sure you follow the recommended word limit.\")+ \"></p>\\n                <!--<p class='ets-act-wtc-fbc' \" +outBlurb(461314,\"Teacher feedback should be sent to you be email within 48 hours.\")+ \"></p>-->\\n                <div class=\\\"ets-act-wtc-fbf\\\"></div>\\n            </div>\\n            <div class=\\\"ets-act-wtc-fb-psd ets-act-wtc-fb-none\\\">\\n                <p class='ets-act-wtc-fbt' \" +outBlurb(461315,\"Passed\")+ \"></p>\\n                <p class='ets-act-wtc-fbc'><!--Passed 2012.09.22 (9:15pm)--></p>\\n            </div>\\n            <div class=\\\"ets-act-wtc-fb-npsd ets-act-wtc-fb-none\\\">\\n                <p class='ets-act-wtc-fbt' \" +outBlurb(461316,\"Not passed\")+ \"></p>\\n                <p class='ets-act-wtc-fbc'><!--Not passed: 2012.09.26 (6:00pm)--></p>\\n            </div>\\n        </div>\\n        \";}o += \"\\n    </div>\\n    \";}o += \"\\n    <div class='ets-act-wtc-r \" +CLS_CNT+ \"'>\\n        <div class=\\\"ets-act-wtc-rl ets-left\\\"></div>\\n        <div class=\\\"ets-act-wtc-rm ets-left\\\">\\n            <div class='ets-act-wtc-ip ets-left'>\\n                <textarea data-weave=\\\"school-ui-activity/shared/textchange/main\\\" readonly=\\\"readonly\\\" data-at-id=\\\"txt-single-textbox\\\"></textarea>\\n            </div>\\n            \";if(showExp){o += \"\\n            <div class='ets-act-wtc-expctn ets-left'>\\n                <div class='ets-act-wtc-exp ets-left'>\\n                    <div class='ets-act-wtc-exptxt'>\\n                        \" +data.content.modelText+ \"\\n                    </div>\\n                </div>\\n                <div class='ets-act-wtc-exptg' data-show='true'></div>\\n                <div class=\\\"ets-act-wtc-arctn\\\">\\n                    <span class=\\\"ets-act-wtc-ar\\\"></span>\\n                    <span class=\\\"ets-act-wtc-artxt\\\" \" + outBlurb(461311,\"Show model answer\")+ \"></span>\\n                </div>\\n            </div>\\n            \";}o += \"\\n        </div>\\n        <div class=\\\"ets-act-wtc-rr ets-left\\\"></div>\\n        <p class=\\\"ets-act-wtc-wdscnt ets-act-wtc-clear\\\"><span \" +outBlurb(150691,\"Words typed:\")+ \"></span> <span class=\\\"ets-act-wtc-wdsnum\\\">0</span></p>\\n        \";if(showExp){o += \"\\n        <p class=\\\"ets-act-wtc-ic ets-act-wtc-clear ets-none\\\" \" +outBlurb(461317,\"Compare your answer with the model text.\")+ \"></p>\\n        \";}o += \"\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/writing-challenge-exercise/main',[\n\t'jquery',\n\t\"when\",\n\t'school-ui-activity/activity/base/main',\n\t\"troopjs-core/component/factory\",\n\t'school-ui-activity/util/interaction',\n\t\"school-ui-shared/utils/progress-state\",\n\t\"template!./main.html\",\n\t'underscore',\n\t\"jquery.jscrollpane\",\n\t\"jquery.mousewheel\",\n\t'jquery.ui',\n\t'jquery.transit'\n], function mpaMain($, when, Widget, Factory, Interaction, progressState, tWtc) {\n\t\"use strict\";\n\n\tvar UNDEF,\n\t\t_currentText,\n\t\t_scrollTop,\n\t\t_currentWordsNum,\n\t\tNUM_MAX_CHARACTER = 20000,\n\t\tREG_SPLWORDS = /[,;.!:(\\s)*\\n\\?]/g,\n\t\tSEL_INPUTAREA = '.ets-act-wtc-ip',\n\t\tSEL_TEXTAREA = 'textarea',\n\t\tSEL_EXAMPLE_TOGGLE = '.ets-act-wtc-exptg',\n\t\tSEL_EXAMPLE_CONTAINER = '.ets-act-wtc-expctn',\n\t\tSEL_EXAMPLE_TXT = '.ets-act-wtc-exptxt',\n\t\tSEL_WDSNUM_CONTAINER = '.ets-act-wtc-wdscnt',\n\t\tSEL_WDSNUM = '.ets-act-wtc-wdsnum',\n\t\tSEL_COMPARE = '.ets-act-wtc-ic',\n\t\tSEL_FEEDBACK = '.ets-act-wtc-fb-none:visible',\n\t\tSEL_FB_NOT_SMT = '.ets-act-wtc-fb-nsmtd',\n\t\tSEL_FB_SMT = '.ets-act-wtc-fb-smtd',\n\t\tSEL_FB_NOT_PASSED = '.ets-act-wtc-fb-npsd',\n\t\tSEL_FB_PASSED = '.ets-act-wtc-fb-psd',\n\t\tSEL_MODELTEXT = '.ets-act-wtc-arctn',\n\t\tCLS_WDSNUM_ERROR = \"ets-act-wtc-wdscnt-error\",\n\t\tCLS_WDSNUM_CORRECT = \"ets-act-wtc-wdscnt-correct\",\n\t\tSTR_SHOW = 'show',\n\t\tSTR_FAST = 'fast',\n\t\tSTR_READONLY = 'readonly',\n\t\tEVT_CLICK = 'click',\n\t\tEVT_TXTCHANGE = 'EFTextChange',\n\t\tstatusInfo = {\n\t\t\twaiting: 'WAITING',\n\t\t\tnotPassed: 'NOPASS',\n\t\t\tpassed: 'PASSED'\n\t\t};\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar writingPromise = me.getWritingHist().then(function (writing_info) {\n\t\t\tloadHistory.call(me, writing_info);\n\t\t});\n\t\tvar progressPromise = me.getProgress().then(function (act_progress) {\n\t\t\tloadProgress.call(me, act_progress);\n\t\t});\n\t\tvar renderPromise = me.html(tWtc, me._json).then(function () {\n\t\t\tonRendered.call(me);\n\t\t});\n\n\t\treturn when.all([writingPromise, progressPromise, renderPromise]);\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init media player\n\t * # Disable text selection\n\t * # Bind textarea change event\n\t * # Delegate example text toggle event\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$textarea = $ROOT.find(SEL_TEXTAREA);\n\n\t\t//disable text selection\n\t\t$ROOT.find('p,span').attr('unselectable', 'on').attr('onselectstart', 'return false;');\n\t\t$ROOT.find(SEL_INPUTAREA).bind('click', function () {\n\t\t\t$textarea.focus();\n\t\t});\n\t\t$textarea.bind(EVT_TXTCHANGE, function () {\n\t\t\tonTextChanged.call(me);\n\t\t});\n\t\t$ROOT.delegate(SEL_EXAMPLE_TOGGLE, EVT_CLICK, function () {\n\t\t\ttoggleExampleText.call(me);\n\t\t});\n\t\t//JscrollPane and remove text style\n\t\t$ROOT.find(SEL_EXAMPLE_TXT).jScrollPane().find('span').removeAttr('style');\n\t}\n\n\t/**\n\t * On textarea value change\n\t * # check textarea max char length , if exceeded , don't let type\n\t * # compute and refresh words count\n\t * # refresh save/submit button\n\t * @api private\n\t */\n\tfunction onTextChanged() {\n\t\tvar me = this;\n\t\tvar $ROOT = me.$element;\n\t\tvar $textarea = $ROOT.find(SEL_TEXTAREA);\n\t\tvar tVal = $textarea.val();\n\t\tif (tVal.length > NUM_MAX_CHARACTER) {\n\t\t\tvar min = Math.min(tVal.length, _currentText ? _currentText.length : 0);\n\t\t\tfor (var i = 0; i < min; i++) {\n\t\t\t\tif (tVal.charAt(i) != _currentText.charAt(i)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//i is the position will be restore\n\t\t\tvar rangeData = {\n\t\t\t\tstart: i,\n\t\t\t\tend: i\n\t\t\t};\n\t\t\t$textarea.val(_currentText);\n\t\t\t$textarea.scrollTop(_scrollTop);\n\t\t\t//use setTimeout to avoid bug of chrome,can't set cursor position immediately\n\t\t\tsetTimeout(function () {\n\t\t\t\tsetCursorPosition($textarea.get(0), rangeData);\n\t\t\t}, 0);\n\t\t} else {\n\t\t\t_currentText = tVal;\n\t\t}\n\t\t_scrollTop = $textarea.scrollTop();\n\t\tvar tArr = _currentText.split(REG_SPLWORDS);\n\t\ttArr && (tArr = $.grep(tArr, function (n) {\n\t\t\treturn $.trim(n).length > 0;\n\t\t}));\n\t\tvar wordsNum = tArr ? tArr.length : 0;\n\t\tif (wordsNum != _currentWordsNum) {\n\t\t\t$ROOT.find(SEL_WDSNUM).text(wordsNum);\n\t\t\t_currentWordsNum = wordsNum;\n\t\t}\n\t\tif (me.isDefaultState) {\n\t\t\tif (me._json.minWordCount != undefined && me._json.maxWordCount != undefined) {\n\t\t\t\tme.items().answered(wordsNum >= me._json.minWordCount);\n\t\t\t\tif (wordsNum >= me._json.minWordCount && wordsNum <= me._json.maxWordCount) {\n\t\t\t\t\t$ROOT.find(SEL_WDSNUM_CONTAINER)\n\t\t\t\t\t\t.removeClass(CLS_WDSNUM_ERROR)\n\t\t\t\t\t\t.addClass(CLS_WDSNUM_CORRECT);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$ROOT.find(SEL_WDSNUM_CONTAINER)\n\t\t\t\t\t\t.removeClass(CLS_WDSNUM_CORRECT)\n\t\t\t\t\t\t.addClass(CLS_WDSNUM_ERROR);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tme.items().answered(wordsNum);\n\t\t\t}\n\t\t}\n\n\t\tme._json._writingContent = _currentText;\n\t}\n\n\t/**\n\t * Toggle example text\n\t * @api private\n\t */\n\tfunction toggleExampleText(show, callback) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$eye = $ROOT.find(SEL_EXAMPLE_TOGGLE),\n\t\t\t$exampleText = $ROOT.find(SEL_EXAMPLE_CONTAINER).stop(),\n\t\t\t$indicator = $ROOT.find(SEL_MODELTEXT).stop();\n\n\t\tshow = (show != null) ? show : ($eye.data(STR_SHOW).toString() == 'true');\n\t\tvar marginLeft = show ? 0 : $exampleText.width() * -1;\n\t\tmarginLeft || $indicator.hide();\n\t\t$exampleText.animate({\n\t\t\t'margin-left': marginLeft\n\t\t}, 300, function () {\n\t\t\tmarginLeft && $indicator.fadeIn();\n\t\t\t$eye.data(STR_SHOW, !show);\n\t\t\tcallback && callback();\n\t\t});\n\t}\n\n\t/**\n\t * Restore cursor of textarea with position\n\t * @api private\n\t */\n\tfunction setCursorPosition(textarea, rangeData) {\n\t\tif (!rangeData || !textarea) return;\n\t\tif (textarea.setSelectionRange) { // W3C\n\t\t\ttextarea.focus();\n\t\t\ttextarea.setSelectionRange(rangeData.start, rangeData.end);\n\t\t} else if (textarea.createTextRange) { // IE\n\t\t\tvar range = textarea.createTextRange();\n\t\t\trange.collapse(true);\n\t\t\trange.moveStart('character', rangeData.start);\n\t\t\trange.moveEnd('character', rangeData.end);\n\t\t\trange.select();\n\t\t}\n\t}\n\n\tfunction loadHistory(historyFeedback) {\n\t\tvar me = this;\n\t\tme.hasHistory = historyFeedback.history && historyFeedback.history.length;\n\t\tme.isDefaultState = !me.hasHistory && historyFeedback.feedback.toUpperCase() == statusInfo.notPassed;\n\t\tme.notPassed = me.hasHistory && historyFeedback.feedback.toUpperCase() == statusInfo.notPassed;\n\t\tif (me.isDefaultState) {\n\t\t\tshowFeedback.call(me);\n\t\t\tenableTextarea.call(me, true);\n\t\t} else {\n\t\t\tshowFeedback.call(me, historyFeedback.feedback.toUpperCase());\n\t\t\tshowHistoryText.call(me, historyFeedback.history);\n\t\t\tif (me.notPassed) {\n\t\t\t\tme.isDefaultState = true;\n\t\t\t\tonTextChanged.call(me);\n\t\t\t\tenableTextarea.call(me, true);\n\t\t\t} else {\n\t\t\t\tme.publishInteraction(Interaction.makeAlreadySubmittedWritingInteraction());\n\t\t\t\tonTextChanged.call(me);\n\t\t\t\tonActivityDone.call(me);\n\t\t\t\tme.items().completed(true);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction showHistoryText(historyText) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_TEXTAREA).val(historyText);\n\t}\n\n\tfunction loadProgress(activityProgress) {\n\t\tvar me = this;\n\t\tme.isActivityPassed = activityProgress && progressState.hasPassed(activityProgress.state);\n\t}\n\n\t/**\n\t * Show feedback for grade mode\n\t * @api private\n\t */\n\tfunction showFeedback(state) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$currentFeedback = $ROOT.find(SEL_FEEDBACK);\n\n\t\tfunction callback() {\n\t\t\tswitch (state) {\n\t\t\t\tcase statusInfo.waiting:\n\t\t\t\t\t$ROOT.find(SEL_FB_SMT).fadeIn(STR_FAST);\n\t\t\t\t\tbreak;\n\t\t\t\tcase statusInfo.notPassed:\n\t\t\t\t\t$ROOT.find(SEL_FB_NOT_PASSED).fadeIn(STR_FAST);\n\t\t\t\t\tbreak;\n\t\t\t\tcase statusInfo.passed:\n\t\t\t\t\t$ROOT.find(SEL_FB_PASSED).fadeIn(STR_FAST);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$ROOT.find(SEL_FB_NOT_SMT).fadeIn(STR_FAST);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t$currentFeedback.length ? $currentFeedback.fadeOut(STR_FAST, callback) : (callback());\n\t}\n\n\t/**\n\t * Enable or disable Textarea\n\t * @api private\n\t */\n\tfunction enableTextarea(enable) {\n\t\tvar $ROOT = this.$element,\n\t\t\t$textarea = $ROOT.find(SEL_TEXTAREA);\n\t\tif (enable) {\n\t\t\t$textarea.removeAttr(STR_READONLY);\n\t\t} else {\n\t\t\t$textarea.attr(STR_READONLY, STR_READONLY);\n\t\t}\n\t\treturn $textarea;\n\t}\n\n\t/**\n\t * Call when answer checked\n\t * @api private\n\t */\n\tfunction onComplete() {\n\t\tvar me = this;\n\t\tme.publishInteraction(Interaction.makeSubmitWritingInteraction())\n\t\t\t.then(function () {\n\t\t\t\tonActivityDone.call(me);\n\t\t\t\tme.items().completed(true);\n\t\t\t\tme.completed(true);\n\t\t\t\tshowFeedback.call(me, statusInfo.waiting);\n\t\t\t});\n\t}\n\n\tfunction onActivityDone() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\tenableTextarea.call(me, false);\n\t\ttoggleExampleText.call(me, true, function () {\n\t\t\t$ROOT.find(SEL_WDSNUM_CONTAINER).hide();\n\t\t\t$ROOT.find(SEL_COMPARE).fadeIn();\n\t\t});\n\t}\n\n\t/**\n\t * Filter source data\n\t * @api private\n\t */\n\tfunction filterData() {\n\t\t_scrollTop = 0;\n\t\t_currentText = '';\n\t\t_currentWordsNum = 0;\n\t}\n\n\tvar extendsOption = {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\t\t\tme.type(Widget.ACT_TYPE.EXERCISE);\n\t\t\tfilterData(me._json);\n\n\t\t\tvar item = me.items();\n\t\t\titem.savable(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"activityCompleted\": Factory.around(function (base) {\n\t\t\treturn function () {\n\t\t\t\tif (this.isDefaultState) {\n\t\t\t\t\tbase.apply(this, arguments);\n\t\t\t\t}\n\t\t\t\telse if (!this.isActivityPassed) {  //SPC-7453 workaround if submitted writing lost activity progress\n\t\t\t\t\tthis._json._writingContent = UNDEF;\n\t\t\t\t\tbase.apply(this, arguments);\n\t\t\t\t}\n\t\t\t};\n\t\t}),\n\t\t'hub/activity/check/answer': function () {\n\t\t\tif (this._json._writingContent) {\n\t\t\t\tonComplete.call(this);\n\t\t\t}\n\t\t}\n\t};\n\treturn Widget.extend(extendsOption);\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/activity/writing-challenge-practice/main.html',[],function() { return function template(data) { var o = \"\";\nvar data = data || {};\n\nvar outBlurb = function(id,en){\n    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n    return res;\n};\nvar showLeft = data.references.aud;\nvar showExp = data.content.modelText;\nvar CLS_CNT = (function(){\n    if(showLeft && !showExp) return 'ets-act-wtc-l_ne';\n    else if(!showLeft && showExp) return 'ets-act-wtc-nl_e';\n    else if(!showLeft && !showExp) return 'ets-act-wtc-nl_ne';\n    else return 'ets-act-wtc-l_e';\n})();\no += \"\\n<div class=\\\"ets-act-wtc\\\">\\n     \";if(data.references.aud){o += \"\\n    <div class=\\\"ets-act-wtc-l ets-act-wtc-nongrade_l\\\">\\n        <div class=\\\"ets-act-ap-wrap\\\"><div data-at-id=\\\"btn-audio-start\\\" class=\\\"ets-act-ap\\\">\\n            <audio data-weave=\\\"school-ui-shared/widget/audio-player/main\\\" preload=\\\"none\\\"\\n                   data-src=\\\"\" +data.references.aud.url+ \"\\\" type=\\\"audio/mpeg\\\"\\n                   class=\\\"ets-ap\\\"></audio>\\n        </div></div>\\n    </div>\\n    \";}o += \"\\n    <div class='ets-act-wtc-r \" +CLS_CNT+ \"'>\\n        <div class=\\\"ets-act-wtc-rl ets-left\\\"></div>\\n        <div class=\\\"ets-act-wtc-rm ets-left\\\">\\n            <div class='ets-act-wtc-ip ets-left'>\\n                <textarea data-weave=\\\"school-ui-activity/shared/textchange/main\\\" readonly=\\\"readonly\\\" data-at-id=\\\"txt-single-textbox\\\"></textarea>\\n            </div>\\n            \";if(showExp){o += \"\\n            <div class='ets-act-wtc-expctn ets-left'>\\n                <div class='ets-act-wtc-exp ets-left'>\\n                    <div class='ets-act-wtc-exptxt'>\\n                        \" +data.content.modelText+ \"\\n                    </div>\\n                </div>\\n                <div class='ets-act-wtc-exptg' data-show='true'></div>\\n                <div class=\\\"ets-act-wtc-arctn\\\">\\n                    <span class=\\\"ets-act-wtc-ar\\\"></span>\\n                    <span class=\\\"ets-act-wtc-artxt\\\" \" + outBlurb(461311,\"Show model answer\")+ \"></span>\\n                </div>\\n            </div>\\n            \";}o += \"\\n        </div>\\n        <div class=\\\"ets-act-wtc-rr ets-left\\\"></div>\\n        <p class=\\\"ets-act-wtc-wdscnt ets-act-wtc-clear\\\"><span \" +outBlurb(150691,\"Words typed:\")+ \"></span> <span class=\\\"ets-act-wtc-wdsnum\\\">0</span></p>\\n        \";if(showExp){o += \"\\n        <p class=\\\"ets-act-wtc-ic ets-act-wtc-clear ets-none\\\" \" +outBlurb(461317,\"Compare your answer with the model text.\")+ \"></p>\\n        \";}o += \"\\n    </div>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/activity/writing-challenge-practice/main',[\n\t'jquery',\n\t\"when\",\n\t'school-ui-activity/activity/base/main',\n\t\"troopjs-core/component/factory\",\n\t\"school-ui-shared/utils/progress-state\",\n\t\"template!./main.html\",\n\t'underscore',\n\t\"jquery.jscrollpane\",\n\t\"jquery.mousewheel\",\n\t'jquery.ui',\n\t'jquery.transit'\n], function mpaMain($, when, Widget, Factory, progressState, tWtc) {\n\t\"use strict\";\n\n\tvar UNDEF,\n\t\t_currentText,\n\t\t_scrollTop,\n\t\t_currentWordsNum,\n\t\tNUM_MAX_CHARACTER = 20000,\n\t\tREG_SPLWORDS = /[,\\;.!:(\\s)*\\n\\?]/g,\n\t\tSEL_TEXTAREA = '.ets-act-wtc-ip textarea',\n\t\tSEL_EXAMPLE_TOGGLE = '.ets-act-wtc-exptg',\n\t\tSEL_INPUTAREA = '.ets-act-wtc-ip',\n\t\tSEL_EXAMPLE_CONTAINER = '.ets-act-wtc-expctn',\n\t\tSEL_EXAMPLE_TXT = '.ets-act-wtc-exptxt',\n\t\tSEL_WDSNUM_CONTAINER = '.ets-act-wtc-wdscnt',\n\t\tSEL_WDSNUM = '.ets-act-wtc-wdsnum',\n\t\tSEL_COMPARE = '.ets-act-wtc-ic',\n\t\tSEL_MODELTEXT = '.ets-act-wtc-arctn',\n\t\tSTR_SHOW = 'show',\n\t\tSTR_READONLY = 'readonly',\n\t\tEVT_CLICK = 'click',\n\t\tEVT_TXTCHANGE = 'EFTextChange';\n\n\t/**\n\t * Templating and render\n\t * @api private\n\t */\n\tfunction render() {\n\t\tvar me = this;\n\t\tvar writingPromise = me.getWritingHist().then(function (writing_info) {\n\t\t\tloadHistory.call(me, writing_info);\n\t\t});\n\t\tvar progressPromise = me.getProgress().then(function (act_progress) {\n\t\t\tloadProgress.call(me, act_progress);\n\t\t});\n\t\tvar renderPromise = me.html(tWtc, me._json).then(function () {\n\t\t\tonRendered.call(me);\n\t\t});\n\n\t\treturn when.all([writingPromise, progressPromise, renderPromise]);\n\t}\n\n\t/**\n\t * On activity rendered:\n\t * # Init media player\n\t * # Disable text selection\n\t * # Bind textarea change event\n\t * # Delegate example text toggle event\n\t * @api private\n\t */\n\tfunction onRendered() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$textarea = $ROOT.find(SEL_TEXTAREA);\n\n\t\t//disable text selection\n\t\t$ROOT.find('p,span').attr('unselectable', 'on').attr('onselectstart', 'return false;');\n\t\t$ROOT.find(SEL_INPUTAREA).bind('click', function () {\n\t\t\t$textarea.focus();\n\t\t});\n\t\t$textarea.bind(EVT_TXTCHANGE, onTextChanged.bind(me));\n\t\t$ROOT.delegate(SEL_EXAMPLE_TOGGLE, EVT_CLICK, function () {\n\t\t\ttoggleExampleText.call(me);\n\t\t});\n\t\t//JscrollPane and remove text style\n\t\t$ROOT.find(SEL_EXAMPLE_TXT).jScrollPane().find('span').removeAttr('style');\n\t}\n\n\t/**\n\t * On textarea value change\n\t * # check textarea max char length , if exceeded , don't let type\n\t * # compute and refresh words count\n\t * # refresh save/submit button\n\t * @api private\n\t */\n\tfunction onTextChanged() {\n\t\tvar me = this;\n\t\tvar $ROOT = me.$element;\n\t\tvar $textarea = $ROOT.find(SEL_TEXTAREA);\n\t\tvar tVal = $textarea.val();\n\t\tif (tVal.length > NUM_MAX_CHARACTER) {\n\t\t\tvar min = Math.min(tVal.length, _currentText ? _currentText.length : 0);\n\t\t\tfor (var i = 0; i < min; i++) {\n\t\t\t\tif (tVal.charAt(i) != _currentText.charAt(i)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//i is the position will be restore\n\t\t\tvar rangeData = {\n\t\t\t\tstart: i,\n\t\t\t\tend: i\n\t\t\t};\n\t\t\t$textarea.val(_currentText);\n\t\t\t$textarea.scrollTop(_scrollTop);\n\t\t\t//use setTimeout to avoid bug of chrome,can't set cursor position immediately\n\t\t\tsetTimeout(function () {\n\t\t\t\tsetCursorPosition($textarea.get(0), rangeData);\n\t\t\t}, 0);\n\t\t} else {\n\t\t\t_currentText = tVal;\n\t\t}\n\t\t_scrollTop = $textarea.scrollTop();\n\t\tvar tArr = _currentText.split(REG_SPLWORDS);\n\t\ttArr && (tArr = $.grep(tArr, function (n) {\n\t\t\treturn $.trim(n).length > 0;\n\t\t}));\n\t\tvar wordsNum = tArr ? tArr.length : 0;\n\t\tif (wordsNum != _currentWordsNum) {\n\t\t\t$ROOT.find(SEL_WDSNUM).text(wordsNum);\n\t\t\t_currentWordsNum = wordsNum;\n\t\t}\n\t\tif (me.isDefaultState) {\n\t\t\tme.items().answered(wordsNum);\n\t\t}\n\t\tme._json._writingContent = _currentText;\n\t}\n\n\t/**\n\t * Toggle example text\n\t * @api private\n\t */\n\tfunction toggleExampleText(show, callback) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element,\n\t\t\t$eye = $ROOT.find(SEL_EXAMPLE_TOGGLE).stop(),\n\t\t\t$exampleText = $ROOT.find(SEL_EXAMPLE_CONTAINER),\n\t\t\t$indicator = $ROOT.find(SEL_MODELTEXT).stop();\n\n\t\tshow = (show != null) ? show : ($eye.data(STR_SHOW).toString() == 'true');\n\t\tvar marginLeft = show ? 0 : $exampleText.width() * -1;\n\t\tmarginLeft || $indicator.hide();\n\t\t$exampleText.animate({\n\t\t\t'margin-left': marginLeft\n\t\t}, 300, function () {\n\t\t\tmarginLeft && $indicator.fadeIn();\n\t\t\t$eye.data(STR_SHOW, !show);\n\t\t\tcallback && callback();\n\t\t});\n\t}\n\n\t/**\n\t * Restore cursor of textarea with position\n\t * @api private\n\t */\n\tfunction setCursorPosition(textarea, rangeData) {\n\t\tif (!rangeData || !textarea) return;\n\t\tif (textarea.setSelectionRange) { // W3C\n\t\t\ttextarea.focus();\n\t\t\ttextarea.setSelectionRange(rangeData.start, rangeData.end);\n\t\t} else if (textarea.createTextRange) { // IE\n\t\t\tvar range = textarea.createTextRange();\n\t\t\trange.collapse(true);\n\t\t\trange.moveStart('character', rangeData.start);\n\t\t\trange.moveEnd('character', rangeData.end);\n\t\t\trange.select();\n\t\t}\n\t}\n\n\t/**\n\t * Enable or disable Textarea\n\t * @api private\n\t */\n\tfunction enableTextarea(enable) {\n\t\tvar $ROOT = this.$element,\n\t\t\t$textarea = $ROOT.find(SEL_TEXTAREA);\n\t\tif (enable) {\n\t\t\t$textarea.removeAttr(STR_READONLY);\n\t\t} else {\n\t\t\t$textarea.attr(STR_READONLY, STR_READONLY);\n\t\t}\n\t\treturn $textarea;\n\t}\n\n\t/**\n\t * Call when answer checked\n\t * @api private\n\t */\n\tfunction onComplete() {\n\t\tonActivityDone.call(this);\n\t\tthis.items().completed(true);\n\t}\n\n\tfunction onActivityDone() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\tenableTextarea.call(me, false);\n\t\ttoggleExampleText.call(me, true, function () {\n\t\t\t$ROOT.find(SEL_WDSNUM_CONTAINER).hide();\n\t\t\t$ROOT.find(SEL_COMPARE).fadeIn();\n\t\t});\n\t}\n\n\tfunction loadHistory(historyFeedback) {\n\t\tvar me = this;\n\t\tme.hasHistory = historyFeedback.history && historyFeedback.history.length;\n\t\tme.isDefaultState = !me.hasHistory;\n\t\tif (me.isDefaultState) {\n\t\t\tenableTextarea.call(me, true);\n\t\t} else {\n\t\t\tshowHistory.call(me, historyFeedback.history);\n\t\t}\n\t}\n\n\tfunction showHistory(historyText) {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\t$ROOT.find(SEL_TEXTAREA).val(historyText);\n\t\tonTextChanged.call(me);\n\t\tonActivityDone.call(me);\n\t\tme.items().completed(true);\n\t}\n\n\tfunction loadProgress(activityProgress) {\n\t\tvar me = this;\n\t\tme.isActivityPassed = activityProgress && progressState.hasPassed(activityProgress.state);\n\t}\n\n\tfunction retry() {\n\t\tvar me = this,\n\t\t\t$ROOT = me.$element;\n\t\tme._json._writingContent = '';\n\t\tme.hasHistory = false;\n\t\tme.isDefaultState = true;\n\t\tme.completed(false);\n\t\tenableTextarea.call(me, true).val('').focus();\n\t\tonTextChanged.call(me);\n\n\t\ttoggleExampleText.call(me, false, function () {\n\t\t\t$ROOT.find(SEL_COMPARE).hide();\n\t\t\t$ROOT.find(SEL_WDSNUM_CONTAINER).fadeIn();\n\t\t});\n\t}\n\n\t/**\n\t * Filter source data\n\t * @api private\n\t */\n\tfunction filterData() {\n\t\t_scrollTop = 0;\n\t\t_currentText = '';\n\t\t_currentWordsNum = 0;\n\t}\n\n\tvar extendsOption = {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\t\t\tme.type(Widget.ACT_TYPE.PRACTICE);\n\n\t\t\tfilterData(me._json);\n\n\t\t\tvar item = me.items();\n\t\t\titem.savable(true);\n\t\t},\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t\"activityCompleted\": Factory.around(function (base) {\n\t\t\treturn function () {\n\t\t\t\tif (this.isDefaultState) {\n\t\t\t\t\tbase.apply(this, arguments);\n\t\t\t\t\tthis._onAnswerChecked();\n\t\t\t\t}\n\t\t\t\telse if (!this.isActivityPassed) {  //SPC-7453 workaround if submitted writing lost activity progress\n\t\t\t\t\tthis._json._writingContent = UNDEF;\n\t\t\t\t\tbase.apply(this, arguments);\n\t\t\t\t\tthis._onAnswerChecked();\n\t\t\t\t}\n\t\t\t};\n\t\t}),\n\t\t\"retryActivity\": function onRetry() {\n\t\t\tretry.call(this);\n\t\t},\n\t\t_onAnswerChecked: function onAnswerChecked() {\n\t\t\tvar me = this;\n\t\t\tif (me._json._writingContent) {\n\t\t\t\tonComplete.call(me);\n\t\t\t}\n\t\t}\n\t};\n\treturn Widget.extend(extendsOption);\n});\n\n",
    "define('school-ui-activity/application',[\n    \"compose\",\n    \"jquery\",\n    \"troopjs-utils/deferred\",\n    \"troopjs-utils/when\",\n    \"troopjs-utils/tr\",\n    \"troopjs-utils/grep\",\n    \"troopjs-utils/uri\",\n    \"troopjs-ef/widget/application\",\n    \"troopjs-ef/data/cache\",\n    \"troopjs-core/route/router\",\n    \"troopjs-core/remote/ajax\",\n    \"troopjs-ef/service/query\",\n    \"school-ui-study/service/config\",\n    \"school-ui-study/service/context\",\n    \"school-ui-study/service/load\"\n], function ApplicationModule(Compose, $, Deferred, when, tr, grep, URI, Application, Cache, Router, Ajax, Query, Config, Context, Load) {\n    \"use strict\";\n\n    var RE = /^\\w+!/;\n    var _URI = \"uri\";\n    var CONTEXT = \"context\";\n    var CURRENT_ENROLLMENT = \"currentEnrollment\";\n    var SERVICES = \"services\";\n    var ENROLLMENTS = \"enrollments\";\n    var REQ_ENROLLMENT = \"reqEnrollment\";\n\n    /**\n     * Forwards signals to services\n     * @param signal Signal\n     * @param deferred Deferred\n     * @returns me\n     */\n    function forward(signal, deferred) {\n        var me = this;\n\n        var services = tr.call(me[SERVICES], function (service, index) {\n            return Deferred(function (dfd) {\n                service.signal(signal, dfd);\n            });\n        });\n\n        if (deferred) {\n            when.apply($, services).then(deferred.resolve, deferred.reject, deferred.notify);\n        }\n\n        me.publish(\"application/signal/\" + signal, deferred);\n\n        return me;\n    }\n\n     /*!\n     * validate if request enrollment belongs to the student\n     * if false, use student current context enrollment\n     *\n     * @param {void}\n     * @return {void}\n     */\n    function validateEnrollment() {\n        var me = this,\n            context = me[CONTEXT],\n            reqEnrollment = me[REQ_ENROLLMENT];\n\n        if(!context || !reqEnrollment ||\n            (context[CURRENT_ENROLLMENT] || {}).id === reqEnrollment.id  ||\n            !context[ENROLLMENTS]) {\n            return;\n        }\n        \n        // check request enrollment\n        var isValidEnrollment = false;\n        $.each(context[ENROLLMENTS], function(index, enrollment) {\n            if(reqEnrollment.id === enrollment.id) {\n                isValidEnrollment = true;\n                return false;\n            }\n        });\n\n        if(!isValidEnrollment) {\n            // refresh no hash page to load student context\n            window.location.hash = \"\";\n            window.location.reload();\n        }\n    }\n\n    return Application.extend(function ($element, name) {\n        var $window = $(window);\n        var cache = Cache();\n\n        this[SERVICES] = [ Router($window), Ajax(), Query(cache), Config(cache), Context(), Load() ];\n    }, {\n        \"sig/initialize\" : forward,\n        \"sig/finalize\" : forward,\n        \"sig/start\" : forward,\n        \"sig/stop\" : forward,\n\n\n        \"hub:memory/route\" : function onRoute(topic, uri) {\n            var me = this;\n\n            me.update(me[CONTEXT], me[_URI] = uri);\n        },\n\n         /**\n         * subscription: hub:memory/context\n         * save context, update context and\n         * validate enrollment if isUpdate is not true\n         *\n         * @param {String} topic\n         * @param {Object} context\n         * @param {Boolean} isUpdate\n         * @return {void}\n         */\n        \"hub:memory/context\" : function onContext(topic, context) {\n            var me = this;\n            var isUpdate = arguments[arguments.length-1];\n\n            me.update(me[CONTEXT] = context, me[_URI], isUpdate);\n\n            if(!isUpdate) {\n                validateEnrollment.call(me);\n            }\n        },\n\n        /**\n         * subscription: hub:memory/load/enrollment\n         * save request enrollment and validate\n         *\n         * @param {String} topic\n         * @param {Object} enrollment\n         * @return {void}\n         */\n        \"hub:memory/load/enrollment\" : function onEnrollment(topic, enrollment) {\n            var me = this;\n\n            me[REQ_ENROLLMENT] = enrollment;\n\n            validateEnrollment.call(me);\n        },\n\n        /**\n         * update context\n         *\n         * @param {Object} context\n         * @param {Object} uri\n         * @param {Boolean} isUpdate\n         * @return {void}\n         */\n        \"update\" : function update(context, uri, isUpdate) {\n            var me = this;\n\n            if (!context || !uri || (!isUpdate && uri.path) || !(CURRENT_ENROLLMENT in context)) {\n                return;\n            }\n\n            // Deferred query\n            Deferred(function deferredQuery(dfdQuery) {\n                me.query(context[CURRENT_ENROLLMENT].id, dfdQuery);\n            })\n            .done(function doneQuery(enrollment) {\n                // Route to school with all parts of the path set\n                uri.path = URI.Path(tr.call([ \"school\", enrollment, enrollment.course, enrollment.level, enrollment.unit ], function (element, i) {\n                    element = element || \"\";\n                    return element.id\n                        ? element.id.replace(RE, \"\")\n                        : element;\n                }));\n\n                me.route(uri);\n            });\n        }\n    });\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/launcher/launcher.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-bd-activity\\\">\\n\\t<!--render activity here-->\\n</div>\\n<div class=\\\"ets-act-bd-ft\\\" data-weave=\\\"school-ui-activity/shared/question-number/main\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/launcher/main',[\n\t\"jquery\",\n\t\"troopjs-ef/component/widget\",\n\t\"when\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t\"template!./launcher.html\"\n], function WrapperModule($, Widget, When, typeidParser, tLauncher) {\n\n\tvar TARGET = \"target\";\n\tvar $ELEMENT = \"$element\";\n\tvar ACT_CONTENT = \"activityContent\";\n\n\treturn Widget.extend(function ($element, name, option) {\n\t\tvar me = this;\n\t\tme._json = option[ACT_CONTENT];\n\t\tme[TARGET] = option[TARGET];\n\t\tme._option = option;\n\t}, {\n\t\t\"sig/start\": function initialize() {\n\t\t\tvar me = this;\n\t\t\treturn me\n\t\t\t\t.html(tLauncher)\n\t\t\t\t.then(function () {\n\t\t\t\t\treturn me[$ELEMENT]\n\t\t\t\t\t\t.find(\".ets-act-bd-activity\")\n\t\t\t\t\t\t.data(\"option\", me._option)\n\t\t\t\t\t\t.attr(\"data-at-id\", \"activity-container\")\n\t\t\t\t\t\t.attr(\"data-at-activity-id\", typeidParser.parseId(me._option.act_id))\n\t\t\t\t\t\t.attr(\"data-weave\", me[TARGET] + \"(option)\")\n\t\t\t\t\t\t.weave();\n\t\t\t\t});\n\t\t},\n\t\t\"sig/finalize\": function onFinalize() {\n\t\t\tvar me = this;\n\t\t\tdelete me._json;\n\t\t\tdelete me._option;\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-blurbs',[\n\t'troopjs-core/pubsub/hub'\n], function (Hub) {\n\t\"use strict\";\n\t/*\n\t Current not supplied blurbs:\n\t asrRecordTxt_noasr: \"Select the correct answer\",\n\t asr_error_dictionary_error: \"'DICTIONARY_ERROR'\",\n\t asr_error_not_recgnized: \"'NOT_RECOGNIZED'\",\n\t asr_not_rec_result: \"Your voice was not recognized.\",\n\n\t New Blurbs:\n\t ASRConnErr, 467529\n\t ASRSpeechErr, 467530\n\t ASRConnErrTryAgain, 467531\n\t ASRSwitchTyping, 467532\n\t ASRWaitConn, 467533\n\t ASRRecording, 467534\n\t ASRWarning: \"443588\"\n\n\t ASRAlterTitle:      \"506850\",\n\t ASRAlterConfirm:    \"506853\",\n\t ASRAlterCancel:     \"506854\",\n\n\t Past Messages:\n\t asr_RecordAgain:        \"429405\", // \"Record again\"\n\t asrTryTxt:              \"150671\", // \"Remaining attempts\"\n\t asr_VolumeHigh:         \"429404\", // \"The volume is too high.\"\n\t asr_VolumeLow:          \"429403\", // \"The volume is too low.\"\n\t asr_download_btn_txt:   \"183275\", // \"Download\"\n\t asr_download_tooltip:   \"183274\", // \"There is a new version of the speech recognition software which has many important updates that will improve your study experience. We strongly recommend you download the new software. Click on 'download' to install. If you don't have admin rights please contact your IT department.\"\n\t asr_error_no_voice:     \"183297\", // \"No voice is detected.\"\n\n\t asr_error_unknown:          \"151181\", // \"Sorry, your voice wasn't recognized. Please try again.\"\n\t asr_error_voice_too_fast:   \"178190\", // \"You're speaking too fast. Please try again more slowly.\"\n\t asr_error_voice_too_high:   \"151179\", // \"The recording is too loud. Try adjusting your distance from the microphone.\"\n\t asr_error_voice_too_low:    \"151180\", // \"Your voice is too low. Please check your microphone distance and make sure the microphone is not covered.\"\n\t asr_error_voice_too_noisy:  \"150929\", // \"We could not recognize your voice.  This may be due to background noise or a faulty microphone.  Please check your settings and try again, or skip this item.\"\n\t asr_error_voice_too_slow:   \"178191\", // \"You're speaking too slowly. Please try again a bit faster.\"\n\t asr_failed:         \"167401\", // \"The speech recognition software is not working right now. Click OK to complete the activity by typing, or skip this activity.\"\n\t asr_sorry:          \"433648\", // \"I'm sorry.\"\n\t asr_repeat:         \"433650\", // \"Please repeat that.\"\n\n\t asr_preparing:      \"151701\", // \"Prepare to start recording\"\n\t asr_processing:     \"151687\", // \"Processing...\"\n\t asr_try_over_times: \"150927\", // \"You have made three incorrect attempts.  Keep trying or skip this item?\"\n\n\t BtnCancel:          \"468592\", // \"Cancel\"\n\t BtnInstallNow:      \"150642\", // \"Install now\"\n\n\t asrDisabledContent:     \"179626\", // \"This activity uses EF Advanced Speech Recognition Software. You are currently studying with Advanced Software Recognition turned off. Please click on “Next” to go to the next activity.\"\n\t asrFailed:              \"167401\", // \"The speech recognition software is not working right now. Click OK to complete the activity by typing, or skip this activity.\"\n\t asrFailedWithoutTyping: \"167512\", // \"We're very sorry, but this activity is not working now.\"\n\t asrRecordTxt:           \"150758\", // \"Record your answer\"\n\t */\n\tvar blurbs = {\n\n\t\t/*E12 ASR blurbs*/\n\t\tASRSwitchTyping: \"467532\", // \"The speech recognition is not working now. Click OK to complete the activity by typing.\"\n\t\tASRSwitchSelecting: \"467436\", // \"The speech recognition software is not working right now. Click OK to complete the activity in a non-speaking mode.\"\n\t\tASRSwitchNext: \"467435\", // \"The speech recognition software is not working right now. Click NEXT to proceed to the next activity.\"\n\n\t\tASRClientErrSkip: \"468589\", // \"This activity uses Advanced Speech Recognition software. Install it now and relaunch your browser, or click Cancel to move on to the next activity.\"\n\t\tASRClientErrType: \"468590\", // \"This activity uses Advanced Speech Recognition software. Install it now and relaunch your browser, or click Cancel for an alternate mode.\"\n\t\tASRClientErrSelect: \"468591\", // \"This activity uses Advanced Speech Recognition software. Install now, or click Cancel for a non-speaking mode. When installed, please restart your browser.\"\n\n\t\t/*\n\t\t *  ASR on-boarding related blurbs.\n\t\t */\n\t\tIntroTitle: \"492075\", // \"Time to practice speaking!\"\n\t\tIntroDes: \"492076\", // \"This activity requires you to record your voice. Make sure that you are in a quiet environment and use a headset with microphone. Let's take a few steps to setup your environment.\"\n\t\tIntroButton: \"492077\", // \"GET STARTED\"\n\t\tChecking: \"492078\", // \"Checking …\"\n\t\tCheckingDes: \"492079\", // \"Please wait. We are analyzing your browser settings.\"\n\t\tMicFail: \"492080\", // \"Check your microphone\"\n\t\tMicFailDes: \"492081\", // \"We can't detect your microphone. Please make sure it is plugged in, then click Check Again.\"\n\t\tMicFailCheckButton: \"492082\", // \"CHECK AGAIN\"\n\t\tSkipReason1: \"492083\", // \"I don't have a microphone/headset.\"\n\t\tSkipReason2: \"492084\", // \"I don't want to speak.\"\n\t\tSkipReason3: \"492085\", // \"Other\"\n\t\tPriSetDes: \"492086\", // \"Allow access to your microphone.\"\n\t\tPriSetOpen: \"492087\", // \"We just opened the Flash Player settings for you here.\"\n\t\tPriSetAllow: \"492088\", // \"Check Allow\"\n\t\tPriSetRem: \"492089\", // \"Check Remember\"\n\t\tPriSetClose: \"492090\", // \"Click Close\"\n\t\tPriSetBut: \"492091\", // \"I HAVE CHECKED MY SETTINGS!\"\n\t\tReadyGo: \"492092\", // \"You are ready to go!\"\n\t\tReadyGoDes: \"492093\", // \"Your environment has been successfully set up! You are now ready to start practice speaking.\"\n\t\tReadyGoBut: \"492094\", // \"Done\"\n\t\tOther: \"450011\", // \"Skip\"\n\n\t\t/*ASR Broken releted*/\n\t\tASRAlterMsg: \"626864\", // \"Do you want to try this activity in non-speaking mode instead?\"\n\t\tASRAlterSkipMsg: \"626863\", // \"Do you want to skip this activity for now?\"\n\n\t\t/* message blurb*/\n\t\tTOPIC_NOT_RECOGNIZE: \"626843\", // \"Sorry, your voice wasn't recognized\"\n\t\tTOPIC_TOO_HIGH: \"626845\", // \"Your voice is too loud\"\n\t\tTOPIC_TOO_LOW: \"626847\", // \"Your voice is too soft\"\n\t\tTOPIC_TOO_SLOWLY: \"626849\", // \"You're speaking too slowly\"\n\t\tTOPIC_TOO_FAST: \"626851\", // \"You're speaking too fast\"\n\t\tTOPIC_MIC_NO_VOICE: \"626853\", // \"Sorry, we think there is a problem with your microphone\"\n\t\tTOPIC_TECH_ERROR: \"626855\", // \"Technical error\"\n\t\tTOPIC_RETRY: \"626859\", // \"Please try again\"\n\t\tTOPIC_3_FAIL: \"626862\", // \"Sorry, it seems that we have trouble recognizing your voice\"\n\t\tMSG_NOT_RECOGNIZE: \"626844\", // \"Check your settings and make sure you are in a quiet place before trying again.\"\n\t\tMSG_CHECK_MIC_HIGH: \"626846\", // \"Please check your microphone settings and try again.\"\n\t\tMSG_CHECK_MIC_LOW: \"626848\", // \"Please check your microphone settings and try again.\"\n\t\tMSG_TRY_FASTER: \"626850\", // \"Please try again a bit faster.\"\n\t\tMSG_TRY_SLOWLY: \"626852\", // \"Please try again more slowly.\"\n\t\tMSG_CHECK_NOT_MUTE: \"626854\", // \"Please check that it is correctly installed and is not muted.\"\n\t\tMSG_TIMEOUT: \"626856\", // \"The server timed out your request. Please try again.\"\n\t\tMSG_FLASH_ERROR: \"626857\", // \"The speech recognition software was unable to connect. Please try again.\"\n\t\tMSG_SERVER_ERROR: \"626858\", // \"The server cannot process your request right now. Please try again.\"\n\t\tMSG_INCORRECT_PRONUN: \"626860\", // \"Pronounce the words more carefully.\"\n\t\tMSG_INCORRECT_ANSWER: \"626861\", // \"That answer is Incorrect.\"\n\t\tMSG_SKIP: \"626863\", // \"Do you want to skip this activity for now?\"\n\t\tMSG_TRY_NON_SPEAKING: \"626864\"  // \"Do you want to try this activity in non-speaking mode instead?\"\n\t};\n\n\tvar translations = {};\n\n\tvar blurbKeys = Object.keys(blurbs);\n\tvar queries = blurbKeys.map(function (key) {\n\t\treturn 'blurb!' + blurbs[key];\n\t});\n\ttranslations.loadedPromise = Hub.publish('query', queries)\n\t\t.then(function (queriedBlurbs) {\n\t\t\tblurbKeys.forEach(function (key, index) {\n\t\t\t\ttranslations[key] = queriedBlurbs[index].translation;\n\t\t\t});\n\t\t\treturn translations;\n\t\t});\n\n\treturn translations;\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-config',[],function(){\n\treturn {\n\t\tLIMIT_FAILED_TIMES: 3,\n\t\tDEBUG_ASR_ENABLED: location.search.indexOf('debugasr') >= 0\n\t};\n});\n\n",
    "define('school-ui-activity/shared/asr/guid',[], function () {\n\treturn function guid() {\n\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n\t\t\tvar r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n\t\t\treturn v.toString(16);\n\t\t}).toUpperCase();\n\t};\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/asr/asr-debug/asr-debug.html',[],function() { return function template(data) { var o = \"<h1>ASR DEBUGGER TOOL</h1>\\n<p>------------------------------------------------------------------------</p>\\n\";\n\tfor (var i = 0; i < data.length; i++) {\n\t\twriteButton(data[i].code, data[i].msg);\n\t}\no += \"\\n\\n\"; function writeButton(code, msg) { o += \"\\n\\t<button class=\\\"asr-debug-submit\\\" data-errorcode=\\\"\" + code + \"\\\">\" + msg + \"(\" + code + \")\" + \"</button>\\n\"; } o += \"\\n<p>------------------------------------------------------------------------</p>\\n<input style=\\\"width: 400px\\\" id=\\\"correctAnswerUrl\\\" type=\\\"text\\\" placeholder=\\\"CORRECT_ANSWER_URL\\\"/>\\n<button class=\\\"asr-debug-submit\\\" data-action='recorder'>SUBMIT</button>\"; return o; }; });\n",
    "define('school-ui-activity/shared/asr/asr-debug/main',[\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'../guid',\n\t'template!./asr-debug.html'\n], function asrDebugModule($, when, Widget, guid, tAsrDebug) {\n\t'use strict';\n\n\tvar $ELEMENT = \"$element\";\n\n\tvar CCL_SCHOOL_ASR_RECORDER = \"ccl!'school.serverasr.nonstreaming.flash.relativepath'\";\n\n\tvar pronsXML,\n\t\tactivityCb,\n\t\tasr_option;\n\n\treturn Widget.extend({\n\t\t\"hub:memory/asr/inited\": function asrInited(recorderService) {\n\t\t\tvar me = this;\n\t\t\tme.recorderService = recorderService;\n\n\t\t\t/*\n\t\t\t var asrErrCdMapping = {\n\t\t\t 80  : 'NO_VOICE',\n\t\t\t 3   : 'VOICE_TOO_SLOW',\n\t\t\t 4   : 'VOICE_TOO_FAST',\n\t\t\t 5   : 'VOICE_TOO_LOW',\n\t\t\t 85  : 'VOICE_TOO_LOW', //the same ad '5',\n\t\t\t 6   : 'VOICE_TOO_HIGH',\n\t\t\t 86  : 'VOICE_TOO_HIGH' //the same ad '6',\n\t\t\t 7   : 'CAN_NOT_RECOGNIZE',\n\t\t\t 8   : 'CAN_NOT_RECOGNIZE'\n\t\t\t };\n\t\t\t */\n\n\t\t\tvar asrErrCdMapping = [\n\t\t\t\t{\n\t\t\t\t\tcode: 80,\n\t\t\t\t\tmsg: 'NO_VOICE'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: 85,\n\t\t\t\t\tmsg: 'VOICE_TOO_LOW'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: 6,\n\t\t\t\t\tmsg: 'VOICE_TOO_HIGH'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: 86,\n\t\t\t\t\tmsg: 'VOICE_TOO_HIGH'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: 61,\n\t\t\t\t\tmsg: 'GET_RESULT_TIMEOUT'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcode: 1,\n\t\t\t\t\tmsg: 'DICTIONARY_ERROR'\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tme.html(tAsrDebug, asrErrCdMapping);\n\t\t},\n\n\t\t\"hub:memory/asr/debuggerTool\": function (cb, option) {\n\t\t\tpronsXML = option.pronsXML;\n\t\t\tactivityCb = cb;\n\t\t\tasr_option = option;\n\t\t},\n\n\t\t\"dom:.asr-debug-submit/click\": function (event) {\n\t\t\tvar me = this;\n\t\t\tvar g = guid();\n\n\t\t\tme.publish(\"asr/set/guid\", g);\n\t\t\tme.publish(\"asr/set/callback\", activityCb, g);\n\t\t\tme.publish(\"asr/set/source\", asr_option, g);\n\n\t\t\tvar $button = $(event.currentTarget);\n\t\t\tvar errorcode = $button.data('errorcode');\n\n\t\t\tvar testOptionsPromise;\n\t\t\tif (errorcode) {\n\t\t\t\ttestOptionsPromise = me.query(CCL_SCHOOL_ASR_RECORDER)\n\t\t\t\t\t.spread(function (ccl) {\n\t\t\t\t\t\tvar folder = ccl.value.replace(\"recorder.swf\", \"\");\n\t\t\t\t\t\treturn me.publish(\"ajax\", {\n\t\t\t\t\t\t\turl: folder + errorcode + \".txt\"\n\t\t\t\t\t\t}).then(function (xml) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\txml: xml,\n\t\t\t\t\t\t\t\taudioUrl: folder + errorcode + \".wav\"\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t} else if (pronsXML) {\n\t\t\t\ttestOptionsPromise = when.resolve({\n\t\t\t\t\txml: pronsXML,\n\t\t\t\t\taudioUrl: me[$ELEMENT].find(\"#correctAnswerUrl\").val()\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttestOptionsPromise.then(function (testOptions) {\n\t\t\t\tme.publish(\"asr/service/setting\", {\n\t\t\t\t\tpronsXML: testOptions.xml\n\t\t\t\t});\n\n\t\t\t\tme.recorderService.getRecorder().testClientRecording(\n\t\t\t\t\tg,\n\t\t\t\t\t'/asr/handlers',\n\t\t\t\t\ttestOptions.xml,\n\t\t\t\t\t\"ASR.asrHubProxy\",\n\t\t\t\t\t88888888,\n\t\t\t\t\t99999999,\n\t\t\t\t\tfalse,\n\t\t\t\t\ttestOptions.audioUrl);\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-states',[],function () {\n\treturn {\n\t\t// For DOM UI indicator\n\t\tSTART: 'START', // Shall only be used to indicate, DOM UI is ok to swtich to \"recording\" mode\n\t\tCOMPLETE: 'COMPLETE', // Shall only be used to indicate, the recording is stopped, ASR evaluation follows.\n\t\tFEEDBACK: \"FEEDBACK\", // Shall only be used to indicate ASR evaluation is done, and <TPResult/> has been retrived from server.\n\n\t\t// For abnormal system error UI indicator\n\t\tFAILED: 'FAILED', // shall only be used to indicate server communication failure\n\t\tERROR: \"ERROR\", // shall be used for any flash internal error, non-server communication related\n\n\t\t// For MIC status UI indicator\n\t\tNOMIC: 'NOMIC', // MIC status\n\t\tUNMUTED: 'UNMUTED', // MIC status\n\t\tMUTED: 'MUTED' // MIC status\n\t};\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-logger',[\n\t\"jquery\",\n\t\"json2\",\n\t\"./asr-config\"\n], function ($, JSON, ASRConfig) {\n\t\"use strict\";\n\n\tvar ASRLogger = {};\n\n\tif (window.console) {\n\t\tASRLogger.log = function (info) {\n\t\t\twindow.console.log(\"JS: \" + JSON.stringify(info));\n\t\t};\n\t} else {\n\t\tASRLogger.log = function () {};\n\t}\n\n\tif (ASRConfig.DEBUG_ASR_ENABLED) {\n\t\tASRLogger.log = (function (log) {\n\t\t\treturn function (info) {\n\t\t\t\ttypeof info === \"object\" && (info = JSON.stringify(info));\n\t\t\t\t$(\".ets-fn-asr-console\").append(\"<li>\" + info + \"</li>\");\n\t\t\t\tlog(info);\n\t\t\t};\n\t\t})(ASRLogger.log);\n\t}\n\n\treturn ASRLogger;\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-trace-event-type',[],function () {\n\treturn {\n\t\t'DEFAULT': 70,\n\t\t'START': 71,\n\t\t'PREPARE': 72,\n\t\t'STOP': 73,\n\t\t'COMPLETE': 74,\n\t\t'PROCESSING': 75,\n\t\t'CALLBACK_COMPLETE': 76,\n\t\t'RECORDING_COMPLETE': 77,\n\t\t'INTERUPT': 78,\n\t\t'EVALUTE': 79,\n\t\t'SERVER_UNAVALIABLE': 80,\n\t\t'CONTEXT_NULL': 81,\n\t\t'READY_FOR_RECORD': 83,\n\t\t'UI_TIMEOUT': 84,\n\n\t\t/*\n\t\t *  NON-STREAMING MODE\n\t\t */\n\t\t'SEND_GRAMMAR_XML': 101,\n\t\t'AUDIO_DURATION': 103,\n\t\t'AUDIO_ENCODE_TIME': 104,\n\t\t'TOTAL_TIME': 108,\n\n\t\t// FLASH INTERNAL ERROR\n\t\t'FLASH_ERROR': 85\n\t};\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-trace',[\n\t'module',\n\t'jquery',\n\t'json2',\n\t'troopjs-ef/component/gadget',\n\t'school-ui-shared/utils/browser-check',\n\t'school-ui-shared/utils/typeid-parser',\n\t'./asr-logger',\n\t'./asr-trace-event-type'\n], function ASRLogModule(\n\tmodule,\n\t$,\n\tJSON,\n\tWidget,\n\tBrowserInfo,\n\tTypeIdParser,\n\tASRLogger,\n\tASREventType\n) {\n\t\"use strict\";\n\n\tvar config = $.extend({\n\t\tasrLogUrl: '/services/school/courseware/LogAsrTracking.ashx',\n\t\theaders: {}\n\t}, module.config() || {});\n\n\t//Variables\n\tvar activity_id,\n\t\tBrowser = BrowserInfo.browser + BrowserInfo.version,\n\t\tCustomerOS = navigator.platform,\n\t\tcontentType = 'application/json; charset=utf-8',\n\t\tEventLevel = 3,\n\t\tstudent_id,\n\t\tAJAX = 'ajax',\n\t\tToken;//asrTrackingToken;\n\n\t/*!\n\t * ASR trace function\n\t * {String} token : ASR session token\n\t * {Number} eventType\n\t * {String} eventDesc\n\t */\n\tfunction trace(token, eventType, eventDesc) {\n\t\tif (!token || !this._isReady) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this,\n\t\t\tEventType = eventType || ASREventType.DEFAULT,\n\t\t\tEventDesc = eventDesc,\n\t\t\tProcessGuid = token,\n\t\t\tasrType,\n\t\t\tparams;\n\t\tasrType = 3;\n\n\t\tparams = {\n\t\t\t'ProcessGuid': ProcessGuid,\n\t\t\t'student_id': student_id,\n\t\t\t'Activity_id': activity_id,\n\t\t\t'CustomerOS': CustomerOS,\n\t\t\t'Broswer': Browser,\n\t\t\t'AsrType': asrType,\n\t\t\t'Token': Token,\n\t\t\t'EventLevel': EventLevel,\n\t\t\t'EventType': EventType,\n\t\t\t'EventDesc': EventDesc\n\t\t};\n\n\t\tme.publish(AJAX, getOldAjaxSet(params))\n\t\t\t.ensure(function (response) {\n\t\t\t\tASRLogger.log(\"ASR Event, type: \" + EventType + \", desc: \" + eventDesc + \", Response is : \" + (response && response.responseText));\n\t\t\t});\n\n\t}\n\n\tfunction getOldAjaxSet(p) {\n\n\t\tvar params = [\n\t\t\t'ProcessGuid=' + p.ProcessGuid,\n\t\t\t'student_id=' + p.student_id,\n\t\t\t'Activity_id=' + p.Activity_id,\n\t\t\t'CustomerOS=' + p.CustomerOS,\n\t\t\t'Broswer=' + p.Broswer,\n\t\t\t'NativeAsrVersion=' + p.NativeAsrVersion,\n\t\t\t'AsrType=' + p.AsrType,\n\t\t\t'Token=' + p.Token,\n\t\t\t'EventLevel=' + p.EventLevel,\n\t\t\t'EventType=' + p.EventType,\n\t\t\t'EventDesc=' + p.EventDesc\n\t\t].join(\"&\");\n\n\t\treturn {\n\t\t\ttype: \"GET\",\n\t\t\turl: config.asrLogUrl,\n\t\t\theaders: config.headers,\n\t\t\tcache: false,\n\t\t\tdata: params,\n\t\t\tprocessData: false,\n\t\t\tcontentType: contentType\n\t\t};\n\t}\n\n\t//Constructor\n\tfunction ctor() {\n\t\tthis._isReady = false;\n\n\t\tsetPhase.call(this);\n\t}\n\n\t//Util functions\n\tfunction setPhase() {\n\t\tif (student_id && activity_id) {\n\t\t\tthis._isReady = true;\n\t\t}\n\t}\n\n\t//Hanlders\n\tvar Hanlders = {\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tif (!context) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstudent_id = TypeIdParser.parseId(context.user.id);\n\t\t\tsetPhase.call(this);\n\t\t},\n\t\t\"hub:memory/start/load/activity\": function (activity) {\n\t\t\tif (!activity) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tactivity_id = TypeIdParser.parseId(activity.id);\n\n\t\t\tsetPhase.call(this);\n\t\t},\n\t\tlog: trace\n\t};\n\n\treturn Widget.extend(ctor, Hanlders);\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-service-failed-type',[],function () {\n\treturn {\n\t\tWARN: \"warn\",\n\t\tMSG: \"message\",\n\t\tCONN: \"connect\",\n\t\tEVA: \"evaluate\",\n\t\tCOMM: \"common\",\n\t\tCRASH: \"crash\"\n\t}\n});\n\n",
    "/* global ActiveXObject */\n/**\n *   ASR Service Widget\n *   ASR is taken as a type of service to external,\n *   the responsiblity of this widget is to supply a uniform\n *   recorder API for different type of ASR engine, like:\n *    Local, Server.\n */\ndefine('school-ui-activity/shared/asr/asr-service',[\n\t'module',\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/service',\n\t\"troopjs-core/pubsub/hub\",\n\t\"school-ui-shared/utils/typeid-parser\",\n\t'json2',\n\t'school-ui-shared/utils/browser-check',\n\t'./asr-states',\n\t'./asr-ui-states',\n\t'./asr-blurbs',\n\t'./asr-config',\n\t'./asr-logger',\n\t'./asr-trace',\n\t'./asr-trace-event-type',\n\t'./asr-service-failed-type',\n\t'./asr-service-message-type',\n\t'underscore'\n], function ASRServiceModule(\n\tmodule,\n\t$,\n\twhen,\n\tService,\n\tHub,\n\tTypeIdParser,\n\tJSON,\n\tbrowserCheck,\n\tFlashStates,\n\tUIStates,\n\tASRBlurbs,\n\tASRConfig,\n\tASRLogger,\n\tASRTrace,\n\tASRTraceType,\n\tASRFailedType,\n\tMSGType,\n\t_\n) {\n\t\"use strict\";\n\n\t/*\n\t * Constant variables\n\t */\n\tvar CCL_ASR_KEY = 'ccl!\"school.AsrServerAddress\"',\n\t\tcurrState,\n\t\tWARNING_TICK = 5000,\n\t\tWARNING_TIMEOUT,\n\t\tasrFailedTypes = {},\n\t\tundef;\n\n\tvar SETTINGS = {\n\t\tflv: undef,\n\t\trecordMaxLength: 600000, // the max recording length is 10mins\n\t\tautostopTime: 5, //measured as seconds\n\t\tmicGain: 80, //asr volume\n\t\tsilenceLevel: 5, //Audio threshold\n\t\tasrServerAddress: \"rtmp://speechtest.englishtown.com:1935/asrstreaming\",\n\t\tasrServerResultUrl: '/asr/Evaluate.ashx', // server evluation service\n\t\tactivityId: \"\",\n\t\tmemberId: \"\",\n\t\tdisableScoreRecording: false, // don't send recording to server for scoring\n\n\t\t/*Local ASR Setting*/\n\t\tbeforeDelay: 5, // number of seconds (integer) to wait before start speaking\n\t\tafterDelay: 2, //number of seconds (integer) to wait after finish speaking\n\t\tlevel: 60, //silence level (dB) to activate actual recording(0~96)\n\t\tlength: 600, //max number of seconds for recording\n\t\tasrThreshold: 70\n\t};\n\n\tvar callbacks = {},\n\t\tsource = {},\n\n\t\tcurrGUID,\n\n\t\tTOPIC_ASR_SERVICE_START = \"asr/service/started\",\n\t\tTOPIC_ASR_UI = \"asr/ui/states/changed\",\n\t\tTOPIC_UI = \"asr/ui/\",\n\t\tTOPIC_AUDIO_PLAY_COMPLETE = \"audio/shell/play/complete\",\n\t\tASRTHRESHOLD_SETTING = \"ccl!'school.asr.threshold.setting'\";\n\n\t/**\n\t * Transform XML document to jQuery dom elment\n\t * @param {Object} xml is XMLDocument\n\t * @returns {Object} jQuery Dom\n\t */\n\n\tfunction xmlToJDom(xml) {\n\t\tif (!xml) {\n\t\t\treturn $;\n\t\t}\n\n\t\tif (browserCheck.browser === \"msie\" && parseInt(browserCheck.version, 10) <= 9 && Object.prototype.toString.call(xml) === \"[object String]\") {\n\t\t\tvar doc = new ActiveXObject('Microsoft.XMLDOM');\n\t\t\tdoc.async = 'false';\n\t\t\tdoc.loadXML(xml);\n\t\t\treturn $(doc);\n\t\t} else {\n\t\t\treturn $(xml);\n\t\t}\n\t}\n\n\t/**\n\t * ASR msg code mapping from error number to error string\n\t * @param {Number} errorCode is error code number\n\t * @returns {String} error string\n\t */\n\n\tfunction getMessageCode(errorCode) {\n\t\t// PC ASR version 4.3 support errorCode,\n\t\t// other early version didn't return errorCode.\n\t\t// It returns error message, goto default error handling.\n\t\tvar asrErrCdMapping = {\n\t\t\t80: 'NO_VOICE',\n\t\t\t3: 'VOICE_TOO_SLOW',\n\t\t\t4: 'VOICE_TOO_FAST',\n\t\t\t5: 'VOICE_TOO_LOW',\n\t\t\t85: 'VOICE_TOO_LOW', //the same ad '5',\n\t\t\t6: 'VOICE_TOO_HIGH',\n\t\t\t86: 'VOICE_TOO_HIGH',//the same ad '6',\n\t\t\t7: 'CAN_NOT_RECOGNIZE',\n\t\t\t8: 'CAN_NOT_RECOGNIZE'\n\t\t};\n\n\t\tvar result,\n\t\t\terrCode = parseInt(errorCode, 10);\n\n\t\tif (errCode) {\n\t\t\tresult = asrErrCdMapping[errCode] && MSGType[asrErrCdMapping[errCode]] ?\n\t\t\t\tMSGType[asrErrCdMapping[errCode]] :\n\t\t\t\t\"SERVER_ERROR\";\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Util function used to publish ASR warning message.\n\t * @param {String} context troop component\n\t * @param {String} topic\n\t * @param {String} msg is warning message\n\t * @returns\n\t */\n\tfunction messagePublishProxy(context, type, topic, msg) {\n\t\tcontext.publish(TOPIC_UI + type, topic, msg);\n\t}\n\n\t/**\n\t * Pre-process origin data to ASR understandable type\n\t * @param {Object} data is source data from Activity\n\t * @returns {Array} processed data\n\t */\n\n\tfunction preProcess(data) {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar propertiesToProcess = [\n\t\t\t\t/*language comparasion*/\n\t\t\t\t\"text\",\n\t\t\t\t/*\n\t\t\t\t Roleplay have special structure:\n\t\t\t\t {\n\t\t\t\t pronsXML: \"...\",\n\t\t\t\t options: {\n\t\t\t\t txt: '...\n\t\t\t\t }\n\t\t\t\t },\n\n\t\t\t\t So currently ASR can not do pre-process.\n\t\t\t\t */\n\t\t\t\t/*FlashCard Excise*/\n\t\t\t\t\"txt\"\n\t\t\t],\n\t\t\tret;\n\n\t\tpropertiesToProcess.forEach(function (propertyKey) {\n\t\t\tif (data[propertyKey]) {\n\t\t\t\tret = data[propertyKey].replace(/-/g, \" - \").replace(/\\s+/g, \" \").split(\" \");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Deep clone a data from a Object\n\t * @param {Object} data\n\t * @returns {Object} is a cloned data\n\t */\n\n\tfunction clone(data) {\n\t\treturn JSON.parse(JSON.stringify(data));\n\t}\n\n\t/**\n\t * Process and compare ASR results before callback Acitivity\n\t * @param {Object} data is ASR recognized results\n\t * @param {Boolean} hasError to indicate ASR recgonized success or not\n\t * @returns\n\t */\n\n\tfunction asrCallBackProxy(data, hasError) {\n\t\tvar _result = clone(data),\n\t\t\ttxt = source[currGUID],\n\t\t\tcallback = callbacks[currGUID];\n\n\t\tif (txt) {\n\t\t\tif (_result.length === 0) {\n\t\t\t\ttxt = txt.join(\" \").replace(/\\s{1}-\\s{1}/g, \"-\").split(\" \");\n\t\t\t\tvar _sentence = {\n\t\t\t\t\tsentence: txt.join(\" \"),\n\t\t\t\t\tscore: 0,\n\t\t\t\t\twords: []\n\t\t\t\t};\n\t\t\t\tfor (var i = 0; i < txt.length; i++) {\n\t\t\t\t\t_sentence.words.push({\n\t\t\t\t\t\tword: txt[i],\n\t\t\t\t\t\tscore: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t_result.push(_sentence);\n\t\t\t} else {\n\t\t\t\t_result[0].sentence = txt.join(\" \");\n\t\t\t\tvar words = _result[0].words;\n\t\t\t\tvar w = 0,\n\t\t\t\t\tt = 0;\n\t\t\t\twhile (w < words.length && t < txt.length) {\n\t\t\t\t\tif (txt[t] == '-') {\n\t\t\t\t\t\tif (w > 0) {\n\t\t\t\t\t\t\twords[w - 1].word += '-';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tt++;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\twords[w].word = txt[t];\n\t\t\t\t\tw++;\n\t\t\t\t\tt++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Cause every 'source' only used once, so need delete\n\t\tdelete source[currGUID];\n\n\t\t_result._hasError = hasError;\n\n\t\tif (_.isFunction(callback)) {\n\t\t\tcallback(_result);\n\t\t}\n\t}\n\n\n\t/**\n\t * Util function used to indicate to persist current state\n\t * @returns {Boolean}\n\t */\n\n\tfunction neeKeepState(state) {\n\t\tvar states = [UIStates.BROKEN, UIStates.DOWN];\n\t\treturn _.indexOf(states, state) > -1;\n\t}\n\n\tvar config = $.extend({\n\t\tasrEvalzipBaseUrl: window.location.protocol + \"//\" + window.location.host,\n\t\tasrEvalzipPathPrefix: '/asr/handlers'\n\t}, module.config() || {});\n\n\tvar TOPIC_ASR_CONN_FAILD = \"asr/connection/failed\";\n\n\t//Const\n\tvar TOPIC_ASR_UI_RECORDING = \"asr/ui/recording\",\n\t\tTOPIC_ASR_RECORDING_STOP = \"asr/recording/stopped\";\n\n\tfunction trackProxy(feedback) {\n\t\tif (!feedback) {\n\t\t\treturn;\n\t\t}\n\n\t\tASRLogger.log(feedback);\n\n\t\tthis.trace(ASRTraceType.TOTAL_TIME, feedback.totalTime)\n\t\t\t.trace(ASRTraceType.AUDIO_DURATION, feedback.audioDuration)\n\t\t\t.trace(ASRTraceType.AUDIO_ENCODE_TIME, feedback.encodeTime);\n\t}\n\n\n\tfunction techcheckRequest() {\n\t\tvar me = this;\n\t\treturn me.publish(\"tech-check/request\", [\n\t\t\t{\n\t\t\t\tid: \"flash-setting\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"chrome-auth\"\n\t\t\t}\n\t\t]);\n\t}\n\n\treturn Service.extend(function () {\n\t\tthis.state(UIStates.DISABLE);\n\t\tthis.setFailedTimes(null, true);\n\t\tthis.traceInstance = ASRTrace.create();\n\t}, {\n\t\t\"displayName\": \"server-client\",\n\n\t\t\"sig/start\": function StartASRService() {\n\t\t\tthis.publish(TOPIC_ASR_SERVICE_START);\n\t\t\tthis.state(UIStates.NORMAL);\n\t\t\treturn when.all([\n\t\t\t\tASRBlurbs.loadedPromise,\n\t\t\t\tthis.traceInstance.start()\n\t\t\t]);\n\t\t},\n\n\t\t\"sig/stop\": function StopASRService() {\n\t\t\t//dispose ASR service\n\t\t\tcallbacks = {};\n\n\t\t\tif (this.state() === UIStates.RECORDING) {\n\t\t\t\tthis.stopRecord();\n\t\t\t\tthis.reset();\n\t\t\t}\n\t\t},\n\n\t\t\"hub:memory/asr/inited\": function asrInited(recorderService) {\n\t\t\t//Do something when asr init finished\n\t\t\tthis.recorderService = recorderService;\n\t\t},\n\n\t\t//only set setting\n\t\t\"hub/asr/service/setting\": function (config) {\n\t\t\tvar me = this;\n\t\t\tme.setting(config);\n\t\t},\n\n\t\t\"hub/asr/reset\": function asrReset() {\n\t\t\tthis.reset();\n\t\t},\n\n\t\t/**\n\t\t *   @description\n\t\t *   This method is used for EXTERNAL change ASR failed times.\n\t\t *   Such as: FlashCard Excise have a requirement which need to\n\t\t *   set a failed time when the answer is wrong.\n\t\t *   (https://jira.englishtown.com/browse/SPC-2926)\n\n\t\t *   !!!Only the ASR state is 'Normal' can set this property.\n\n\t\t * @param {String} topic\n\t\t * @param {String} newState When set a common failed type, there must provide a new state.\n\t\t */\n\t\t\"hub/asr/set/common/failed/times\": function asrSetCommonFailedTimes(newState) {\n\t\t\tif (this.state() !== UIStates.NORMAL) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.state(newState, this.setFailedTimes(ASRFailedType.COMM));\n\t\t},\n\n\t\t\"hub/asr/reset/failed/times\": function asrReset() {\n\t\t\tvar statesCheckList = [\n\t\t\t\tUIStates.PROCESSING,\n\t\t\t\tUIStates.PREPARING,\n\t\t\t\tUIStates.RECORDING\n\t\t\t];\n\n\t\t\tif (_.indexOf(statesCheckList, this.state()) > -1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.setFailedTimes(null, true);\n\t\t},\n\n\t\t\"hub/before/loadActivity\": function () {\n\t\t\tthis.reset();\n\t\t\t//Only when activity reloaded, reset this value\n\t\t\tthis.setFailedTimes(0, true);\n\t\t},\n\n\t\t\"hub/asr/enable\": function asrEnable() {\n\t\t\tvar me = this,\n\t\t\t\tstate = me.state();\n\n\t\t\tme.GUID(null);\n\n\t\t\t/*\n\t\t\t For some state like 'broken', ASR should keep\n\t\t\t the state and can't be changed. This logic only\n\t\t\t applied after recorded that means every reseted\n\t\t\t state should not have this check.\n\t\t\t */\n\n\t\t\tif (neeKeepState(state) && !me._reseted) {\n\t\t\t\tif (state === UIStates.BROKEN) {\n\t\t\t\t\tme.setFailedTimes(null, true);\n\t\t\t\t}\n\n\t\t\t\tASRLogger.log(\"Can't force ASR enable, current state is: \" + state);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.state(UIStates.NORMAL);\n\n\t\t\tme._reseted = false;\n\t\t\tASRLogger.log(\"Force ASR enable\");\n\t\t},\n\n\t\t\"hub/asr/disable\": function asrDisable() {\n\t\t\tvar me = this;\n\n\t\t\tif (me.state() === UIStates.BROKEN) {\n\t\t\t\tme.setFailedTimes(null, true);\n\t\t\t}\n\n\t\t\tme.GUID(null);\n\t\t\tclearTimeout(WARNING_TIMEOUT);\n\t\t\tme.state(UIStates.DISABLE);\n\t\t\tASRLogger.log(\"Force ASR disable\");\n\t\t},\n\n\t\t\"hub/asr/isEnabled\": function () {\n\t\t\treturn this.isASREnabled();\n\t\t},\n\n\t\t\"hub/asr/start/record\": function asrStartRecord(guid, cb, option) {\n\t\t\tthis.startRecord(guid, cb, option);\n\t\t},\n\n\t\t\"hub/asr/stop/record\": function asrStopRecord() {\n\t\t\tthis.stopRecord();\n\t\t},\n\t\t/*\n\t\t *  Add new hub for outside to change ASR state,\n\t\t *   only can change when ASR warning.\n\t\t */\n\t\t\"hub/asr/show/message\": function asrShowWarning(msgType) {\n\t\t\tvar me = this;\n\t\t\tif (me.state() !== UIStates.NORMAL) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.message(msgType);\n\t\t},\n\n\t\t\"hub/asr/startPlayback\": function asrStartPlayback() {\n\t\t\tvar state = this.state(),\n\t\t\t\tvalidStates = [UIStates.NORMAL, UIStates.COMMON, UIStates.HINT, UIStates.WARNING, UIStates.ERROR];\n\n\t\t\tif (this.isPlaying\n\t\t\t\t// || !this.GUID()\n\t\t\t\t|| validStates.indexOf(state) === -1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.state(UIStates.DISABLE);\n\t\t\tthis.isPlaying = true;\n\t\t\tthis.startPlayback();\n\t\t},\n\t\t\"hub/asr/stopPlayback\": function asrStopPlayback() {\n\t\t\t//When playing asr, record state should be diabled\n\t\t\tif (this.state() !== UIStates.DISABLE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPlaying = false;\n\t\t\tthis.state(UIStates.NORMAL);\n\t\t\tthis.stopPlayback();\n\t\t},\n\t\t\"hub:memory/start/load/activity\": function (activity) {\n\t\t\tif (!activity) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tSETTINGS.activityId = TypeIdParser.parseId(activity.id);\n\t\t},\n\t\t\"hub:memory/load/level\": function (levelInfo) {\n\t\t\tvar me = this;\n\n\t\t\tif (!levelInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.query(ASRTHRESHOLD_SETTING)\n\t\t\t\t.spread(function (configInfo) {\n\t\t\t\t\t//Notes : config value example {\"default\": 70, \"levelNo\": {\"1\" : 50, \"2\" : 50, \"3\" : 60}}\n\t\t\t\t\tvar config = JSON.parse(configInfo.value) || { \"default\": 70 },\n\t\t\t\t\t\tlevelNo = levelInfo.levelNo,\n\n\t\t\t\t\t\tCFG_TYPE = \"levelNo\",\n\t\t\t\t\t\tDEFAULT = \"default\";\n\n\t\t\t\t\tSETTINGS.asrThreshold = (config[CFG_TYPE] && config[CFG_TYPE][levelNo]) || config[DEFAULT];\n\t\t\t\t});\n\t\t},\n\t\t\"hub:memory/context\": function (context) {\n\t\t\tvar me = this,\n\t\t\t\tREG_PROTOCOL = /.*?(?=\\:\\/\\/)/i;\n\t\t\tSETTINGS.memberId = TypeIdParser.parseId(context.user.id);\n\t\t\tme.query(CCL_ASR_KEY)\n\t\t\t\t.spread(function (addr) {\n\t\t\t\t\tSETTINGS.asrServerAddress = addr && addr.value;\n\n\t\t\t\t\tme.defaultProtocol = SETTINGS.asrServerAddress.match(REG_PROTOCOL)[0];\n\t\t\t\t});\n\t\t},\n\n\t\t\"hub/asr/playback/status/changed\": function asrPlayBackComplete(playState) {\n\t\t\tswitch (playState) {\n\t\t\t\tcase \"START\":\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"COMPLETE\":\n\t\t\t\t\tthis.isPlaying = false;\n\t\t\t\t\tthis.state(UIStates.NORMAL);\n\t\t\t\t\tthis.publish(TOPIC_AUDIO_PLAY_COMPLETE, this.GUID());\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t\"hub/asr/set/guid\": function (guid) {\n\t\t\tvar me = this;\n\t\t\tme.GUID(guid);\n\t\t},\n\n\t\t\"hub/asr/set/callback\": function (cb, guid) {\n\t\t\tcallbacks[guid] = cb;\n\t\t},\n\n\t\t\"hub/asr/set/source\": function (option, guid) {\n\t\t\tsource[guid] = preProcess(option);\n\t\t},\n\n\t\t/**\n\t\t * Internal state machine\n\t\t * @param {String} newState to update\n\t\t * @param {Object} failedTimes for newState\n\t\t * @returns {String} current ASR state\n\t\t */\n\t\tstate: function (newState, failedTimes) {\n\t\t\tfailedTimes = failedTimes || 0;\n\t\t\tvar me = this,\n\t\t\t\targs = [].slice.call(arguments, 0),\n\t\t\t\tisPlaying = me.isPlaying,\n\t\t\t\tisCrashed = asrFailedTypes[ASRFailedType.CRASH] > 0,\n\t\t\t\tisNormal = failedTimes < ASRConfig.LIMIT_FAILED_TIMES;\n\n\t\t\tif (newState && newState !== currState) {\n\t\t\t\t/*\n\t\t\t\t Here is a hack for ASR failed 3 times,\n\t\t\t\t But if ASR encountered a crash error such as\n\t\t\t\t ASR Server down or Client Side ASR not installed.\n\t\t\t\t So only when non-crash error happened times is more than 3\n\t\t\t\t or ASR is not replay,then we tell student that you can\n\t\t\t\t switch to alternative mode. If we encounte a crash error,\n\t\t\t\t only tell student the ASR is down and shows skeleton.\n\t\t\t\t */\n\n\t\t\t\targs[0] = currState = (isCrashed || isNormal || isPlaying) ? newState : (newState = UIStates.BROKEN);\n\n\t\t\t\targs.unshift(TOPIC_ASR_UI);\n\t\t\t\tme.publish.apply(me, args);\n\n\t\t\t\t/*\n\t\t\t\t * Sometimes, ASR internal may be produce exceptions which cause\n\t\t\t\t * the Flash stop to go on the task, so here is a way to handle\n\t\t\t\t * this case.\n\t\t\t\t */\n\t\t\t\tif (newState === UIStates.PROCESSING) {\n\t\t\t\t\tme._processTimeout = setTimeout(function () {\n\t\t\t\t\t\tme.message(MSGType.TIMEOUT);\n\t\t\t\t\t\tme.trace(ASRTraceType.UI_TIMEOUT, \"UI processing timeout!\");\n\t\t\t\t\t\tme.GUID(null);\n\t\t\t\t\t}, 30000);\n\t\t\t\t} else {\n\t\t\t\t\tclearTimeout(me._processTimeout);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn currState;\n\t\t},\n\n\t\t/**\n\t\t * Show the message box, all message show be call in this way\n\t\t *\n\t\t */\n\t\tmessage: function (type) {\n\t\t\tvar me = this;\n\t\t\tvar UIType;\n\t\t\tvar failedTimes = me.setFailedTimes(ASRFailedType.MSG);\n\n\t\t\tclearTimeout(WARNING_TIMEOUT);\n\t\t\ttype = type.toUpperCase();\n\n\t\t\tif (failedTimes >= ASRConfig.LIMIT_FAILED_TIMES) {\n\t\t\t\ttype = MSGType.FALLBACK;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tWARNING_TIMEOUT = setTimeout(function () {\n\t\t\t\t\tvar state = me.state();\n\t\t\t\t\tif (state === UIStates.WARNING ||\n\t\t\t\t\t\tstate === UIStates.ERROR) {\n\t\t\t\t\t\tme.state(UIStates.NORMAL);\n\t\t\t\t\t}\n\t\t\t\t}, WARNING_TICK);\n\t\t\t}\n\n\t\t\tswitch (type) {\n\t\t\t\tcase MSGType.FALLBACK:\n\t\t\t\t\tUIType = UIStates.BROKEN;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.INCORRECT_ANSWER:\n\t\t\t\t\tmessagePublishProxy(me, \"hint\", ASRBlurbs.TOPIC_RETRY, ASRBlurbs.MSG_INCORRECT_ANSWER);\n\t\t\t\t\tUIType = UIStates.HINT;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.INCORRECT_PRONUN:\n\t\t\t\t\tmessagePublishProxy(me, \"hint\", ASRBlurbs.TOPIC_RETRY, ASRBlurbs.MSG_INCORRECT_PRONUN);\n\t\t\t\t\tUIType = UIStates.HINT;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.VOICE_TOO_SLOW:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_TOO_SLOWLY, ASRBlurbs.MSG_TRY_FASTER);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.VOICE_TOO_FAST:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_TOO_FAST, ASRBlurbs.MSG_TRY_SLOWLY);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.VOICE_TOO_HIGH:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_TOO_HIGH, ASRBlurbs.MSG_CHECK_MIC_HIGH);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.VOICE_TOO_LOW:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_TOO_LOW, ASRBlurbs.MSG_CHECK_MIC_LOW);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.NO_VOICE:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_MIC_NO_VOICE, ASRBlurbs.MSG_CHECK_NOT_MUTE);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.CAN_NOT_RECOGNIZE:\n\t\t\t\t\tmessagePublishProxy(me, \"warning\", ASRBlurbs.TOPIC_NOT_RECOGNIZE, ASRBlurbs.MSG_NOT_RECOGNIZE);\n\t\t\t\t\tUIType = UIStates.WARNING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.TIMEOUT:\n\t\t\t\t\tmessagePublishProxy(me, \"error\", ASRBlurbs.TOPIC_TECH_ERROR, ASRBlurbs.MSG_TIMEOUT);\n\t\t\t\t\tUIType = UIStates.ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.FLASH_ERROR:\n\t\t\t\t\tmessagePublishProxy(me, \"error\", ASRBlurbs.TOPIC_TECH_ERROR, ASRBlurbs.MSG_FLASH_ERROR);\n\t\t\t\t\tUIType = UIStates.ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\tcase MSGType.SERVER_ERROR:\n\t\t\t\tdefault:\n\t\t\t\t\tmessagePublishProxy(me, \"error\", ASRBlurbs.TOPIC_TECH_ERROR, ASRBlurbs.MSG_SERVER_ERROR);\n\t\t\t\t\tUIType = UIStates.ERROR;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (UIType === UIStates.WARNING || UIType === UIStates.HINT) {\n\t\t\t\t//show play back button\n\t\t\t\tme.publish(\"asr/ui/playback\", true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tme.publish(\"asr/ui/playback\", false);\n\t\t\t}\n\n\t\t\tme.state(UIType);\n\t\t},\n\n\t\t/**\n\t\t * Update or reset failed times for specific ASR state\n\t\t * @param {String} failedType to set\n\t\t * @param {Boolean} reset ASR failed times\n\t\t * @param {Int} step for add failed times\n\t\t * @returns {Int} all failed times\n\t\t */\n\t\tsetFailedTimes: function (failedType, reset, step) {\n\t\t\tvar i,\n\t\t\t\ttype;\n\t\t\tstep = step || 1;\n\n\t\t\tif (failedType) {\n\n\t\t\t\tasrFailedTypes[failedType] += reset ? 0 : step;\n\n\t\t\t} else if (reset) {\n\n\t\t\t\tfor (i in ASRFailedType) {\n\n\t\t\t\t\tif (_.has(ASRFailedType, i)) {\n\t\t\t\t\t\ttype = ASRFailedType[i];\n\t\t\t\t\t\tasrFailedTypes[type] = 0;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this.getFailedTimes();\n\t\t},\n\n\t\t/**\n\t\t * Get all types of ASR failed times\n\t\t * @return {Int} all failed times\n\t\t */\n\t\tgetFailedTimes: function () {\n\t\t\tvar i,\n\t\t\t\ttype,\n\t\t\t\tallFailedTimes = 0;\n\n\t\t\tfor (i in ASRFailedType) {\n\n\t\t\t\tif (_.has(ASRFailedType, i)) {\n\t\t\t\t\ttype = ASRFailedType[i];\n\t\t\t\t\tallFailedTimes += asrFailedTypes[type];\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn allFailedTimes;\n\t\t},\n\n\n\t\t/**\n\t\t * ASR session GUID setter\n\t\t * @param {String} id is session GUID string\n\t\t * @return {String} current session GUID\n\t\t */\n\t\tGUID: function (id) {\n\t\t\tif (!currGUID || (id !== undefined && currGUID !== id)) {\n\t\t\t\tcurrGUID = id;\n\t\t\t}\n\n\t\t\treturn currGUID;\n\t\t},\n\n\t\t/**\n\t\t * Recorder setting setter\n\t\t * @param {Object} config is all options of recoder settings\n\t\t * @return {String} current setting\n\t\t */\n\t\tsetting: function (config) {\n\t\t\tvar me = this;\n\t\t\tme._settings = me._settings || _.extend({}, SETTINGS);\n\n\t\t\treturn config ? _.extend(me._settings, config) : me._settings;\n\t\t},\n\n\t\t/**\n\t\t * Recorder callback getter\n\t\t * @param {String} guid is session GUID\n\t\t * @return {Function} callback by GUID\n\t\t */\n\t\tcallback: function (guid) {\n\t\t\treturn callbacks[guid || currGUID];\n\t\t},\n\n\t\t/**\n\t\t * Record complete handler\n\t\t * @param {Object} result recognize result from recoder\n\t\t * @return\n\t\t */\n\t\t\"recognizeComplete\": function (result) {\n\t\t\tif (!currGUID) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar me = this,\n\t\t\t\tjsonResult = [],\n\t\t\t\tjXML = xmlToJDom(result),\n\t\t\t\terrorCode = jXML.attr('error') || jXML.find('TPResult').attr('error'),\n\t\t\t\treason = jXML.attr('error') || jXML.find('TPResult').attr('reason') || \"\",\n\t\t\t\tthreshold = SETTINGS.asrThreshold,\n\t\t\t\tanswerIncorrect = 0,\n\t\t\t\tanswerCorrect = 100;\n\n\t\t\tif (errorCode) {\n\t\t\t\tASRLogger.log(\"Error:\" + errorCode + \" Reason: \" + reason);\n\t\t\t\tme.message(getMessageCode(errorCode));\n\t\t\t\tasrCallBackProxy(jsonResult, true);\n\n\t\t\t} else {\n\t\t\t\tjXML.find('Sentence').each(function () {\n\t\t\t\t\tvar jSentence = $(this),\n\t\t\t\t\t\tsentence = {\n\t\t\t\t\t\t\tsentence: jSentence.attr('trans'),\n\t\t\t\t\t\t\tindex: Number(jSentence.attr('id')),\n\t\t\t\t\t\t\tsimilarity: Number(jSentence.attr('score'))\n\t\t\t\t\t\t};\n\t\t\t\t\tsentence.words = [];\n\n\t\t\t\t\tjSentence.find('Word').each(function () {\n\t\t\t\t\t\tvar jWord = $(this);\n\t\t\t\t\t\tsentence.words.push({\n\t\t\t\t\t\t\tword: jWord.attr('trans'),\n\t\t\t\t\t\t\tsimilarity: Number(jWord.attr('score'))\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tjsonResult.push(sentence);\n\t\t\t\t});\n\n\t\t\t\tASRLogger.log(\"threshold:\" + threshold);\n\n\t\t\t\t_.each(jsonResult, function (sentence) {\n\t\t\t\t\t_.each(sentence.words, function (word) {\n\t\t\t\t\t\tword.score = (word.similarity < threshold) ? answerIncorrect : answerCorrect;\n\t\t\t\t\t});\n\t\t\t\t\tsentence.score = (sentence.similarity < threshold) ? answerIncorrect : answerCorrect;\n\n\t\t\t\t\tASRLogger.log(\"similarity:\" + JSON.stringify(sentence));\n\t\t\t\t});\n\n\t\t\t\tme.state(UIStates.NORMAL);\n\n\t\t\t\tasrCallBackProxy(jsonResult);\n\n\t\t\t\tme.trace(ASRTraceType.RECORDING_COMPLETE, \"RecognizeCompleted\");\n\t\t\t}\n\n\n\t\t},\n\n\t\t\"startRecord\": function (guid, cb, option) {\n\t\t\tvar me = this,\n\t\t\t\tsetting = me.setting();\n\t\t\tif (!this.isASREnabled()) {\n\t\t\t\tme.state(UIStates.DOWN, me.setFailedTimes(ASRFailedType.CRASH, false, ASRConfig.LIMIT_FAILED_TIMES));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tme.setting(option);\n\n\t\t\tme.state(UIStates.PREPARING);\n\t\t\tme.GUID(guid);\n\t\t\t//TODO: should pass GUID to server for every session\n\t\t\tcallbacks[currGUID] = callbacks[currGUID] || cb;\n\t\t\tsource[currGUID] = preProcess(option);\n\n\t\t\t//Not block UI thread\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (me.state() === UIStates.RECORDING) {\n\t\t\t\t\tme.stopRecord();\n\t\t\t\t} else {\n\t\t\t\t\tme._startTime = (new Date).getTime();\n\t\t\t\t\tme.trace(ASRTraceType.START, \"Start\");\n\t\t\t\t}\n\n\t\t\t\tme.trace(ASRTraceType.SEND_GRAMMAR_XML, \"Send ASR grammar xml text\");\n\n\t\t\t\tvar recorder = me.recorderService && me.recorderService.getRecorder();\n\t\t\t\tif (recorder && recorder.startClientRecording) {\n\t\t\t\t\trecorder.startClientRecording(\n\t\t\t\t\t\tguid,\n\t\t\t\t\t\tconfig.asrEvalzipBaseUrl + config.asrEvalzipPathPrefix,\n\t\t\t\t\t\tsetting.pronsXML,\n\t\t\t\t\t\t\"ASR.asrHubProxy\",\n\t\t\t\t\t\tsetting.memberId,\n\t\t\t\t\t\tsetting.activityId,\n\t\t\t\t\t\tsetting.disableScoreRecording);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tme.state(UIStates.NORMAL);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t\"stopRecord\": function () {\n\t\t\tthis.state(UIStates.PROCESSING);\n\t\t\t//stop curr recording instance\n\t\t\tthis.isASREnabled() && this.recorderService.getRecorder().stopClientRecording();\n\t\t},\n\n\t\t\"startPlayback\": function () {\n\t\t\tthis.isASREnabled() && this.recorderService.getRecorder().startClientPlayback(\n\t\t\t\t\"ASR.playStatusCallback\"\n\t\t\t);\n\t\t},\n\n\t\t\"stopPlayback\": function () {\n\t\t\tthis.isASREnabled() && this.recorderService.getRecorder().stopClientPlayback();\n\t\t},\n\n\t\t\"isASREnabled\": function () {\n\t\t\tvar recorder = this.recorderService && this.recorderService.getRecorder();\n\t\t\tvar enabled = Boolean(recorder)\n\t\t\t\t&& (recorder['stopClientPlayback'] !== null);\n\t\t\tASRLogger.log(\"Check ASR: \" + enabled);\n\t\t\treturn enabled;\n\t\t},\n\n\t\t\"reset\": function () {\n\t\t\tvar me = this;\n\n\t\t\tclearTimeout(WARNING_TIMEOUT);\n\t\t\tme.GUID(null);\n\t\t\tme.isPlaying = false;\n\t\t\tme._reseted = true;\n\t\t\tme._settings = null;\n\n\t\t\tif (me.state() === UIStates.RECORDING) {\n\t\t\t\tme.stopRecord();\n\t\t\t}\n\n\t\t\tclearInterval(this._asrInterval);\n\t\t\tthis.setFailedTimes(ASRFailedType.EVA, true);\n\t\t},\n\n\t\t/*\n\t\t * Here success means flash can connect to server successfully.\n\t\t */\n\t\t\"hub/asr/record/success\": function (args) {\n\t\t\tvar currGUID = this.GUID(),\n\t\t\t\tme = this,\n\t\t\t\tstatus = args[0];\n\n\t\t\tif (!currGUID || !args) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearInterval(this._asrInterval);\n\t\t\tASRLogger.log(\"recorder response status, state is: \" + args[0] + \", message is: \" + args[1]);\n\n\t\t\t/*\n\t\t\t args=[statusCode,audio_id,audioBuffer16]\n\t\t\t */\n\t\t\tswitch (status) {\n\t\t\t\tcase FlashStates.START:\n\t\t\t\t\tme.trace(ASRTraceType.READY_FOR_RECORD, me._startTime ? ((new Date).getTime() - me._startTime) : 0);\n\t\t\t\t\tdelete me._startTime;\n\t\t\t\t\tme.state(UIStates.RECORDING);\n\t\t\t\t\tme._asrInterval = setInterval(function () {\n\t\t\t\t\t\tvar recorder = me.recorderService && me.recorderService.getRecorder();\n\t\t\t\t\t\tif (!recorder || !recorder.getMicActivity) {\n\t\t\t\t\t\t\tclearInterval(me._asrInterval);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar _micLevel = recorder.getMicActivity();\n\t\t\t\t\t\tme.publish(TOPIC_ASR_UI_RECORDING, _micLevel);\n\t\t\t\t\t}, 100);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.COMPLETE:\n\n\t\t\t\t\tme.publish(TOPIC_ASR_RECORDING_STOP);\n\t\t\t\t\tme.state(UIStates.PROCESSING);\n\t\t\t\t\tme.trace(ASRTraceType.COMPLETE, \"Complete\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.FEEDBACK:\n\t\t\t\t\tme.onRecordFeedback.apply(me, args);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.FAILED:\n\t\t\t\t\t// For any asr server errors\n\t\t\t\t\tme.onRecordFailed.apply(me, args);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.ERROR:\n\t\t\t\t\t// For any flash client errors\n\t\t\t\t\tme.message(MSGType.FLASH_ERROR);\n\t\t\t\t\tme.trace(ASRTraceType.FLASH_ERROR, (args[1] || \"Unknown Flash Error!\"));\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.NOMIC:\n\t\t\t\t\tme.state(UIStates.NORMAL);\n\n\t\t\t\t\ttechcheckRequest.call(me);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.UNMUTED:\n\t\t\t\t\tme.state(UIStates.NORMAL);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FlashStates.MUTED:\n\t\t\t\t\tme.state(UIStates.NORMAL);\n\t\t\t\t\ttechcheckRequest.call(me);\n\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t/*\n\t\t * @param {Object} info {\n\t\t audioSize: 13480,\n\t\t encodeTime: 568,\n\t\t result: \"<TPResult version=\"1.0\"><Sentence id=\"3\" trans=\"TN score=\"34.487766\"></Word></Sentence></TPResult>\",\n\t\t totalTime: 915,\n\t\t audioDuration: 1.0681179138321995\n\t\t }\n\t\t */\n\t\t\"onRecordFeedback\": function (status, info) {\n\t\t\tvar me = this,\n\t\t\t\tsets = me.setting(),\n\t\t\t\tcb = me.callback();\n\n\t\t\ttrackProxy.call(me, info);\n\n\t\t\t// For activities with pronsXML, which means this is not a speaking challenge\n\t\t\tif (sets.pronsXML && info) {\n\t\t\t\tme.recognizeComplete(info.result);\n\t\t\t}\n\t\t\t// Speaking challenge only\n\t\t\telse {\n\t\t\t\tif (cb) {\n\t\t\t\t\tcb();\n\t\t\t\t}\n\t\t\t\tme.state(UIStates.NORMAL);\n\t\t\t}\n\t\t},\n\n\t\t\"onRecordFailed\": function () {\n\t\t\tvar me = this;\n\n\t\t\tme.publish(TOPIC_ASR_CONN_FAILD);\n\n\t\t\tif (me.state() === UIStates.PROCESSING) {\n\t\t\t\tme.message(MSGType.FLASH_ERROR);\n\t\t\t}\n\n\t\t\tme.trace(ASRTraceType.SERVER_UNAVALIABLE, \"ASR Server Unavaliable\");\n\t\t},\n\n\t\t\"trace\": function (evtType, evtDesc) {\n\t\t\tthis.traceInstance.log(this.GUID(), evtType, evtDesc);\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-recorder-service-html5',[\n\t'require',\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/service',\n\t'./asr-states',\n\t'asr-core'\n], function (\n\trequire,\n\t$,\n\twhen,\n\tService,\n\tFlashStates,\n\thtml5AsrRecorder\n) {\n\tvar RECORDER = '_recorder';\n\n\tvar TOPIC_ASR_SUCCESS = \"asr/record/success\";\n\tvar TOPIC_ASR_PLAYBACK_STATUS_CHANGED = \"asr/playback/status/changed\";\n\n\tfunction publishAsrRecordEvent() {\n\t\tvar me = this;\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\tme.publish(TOPIC_ASR_SUCCESS, args);\n\t}\n\n\tfunction record(\n\t\tguid,\n\t\thost,\n\t\tcontextXml,\n\t\tignoredCallback,\n\t\tstudentId,\n\t\tactivityId,\n\t\tdisableScoreRecording,\n\t\taudioElement\n\t) {\n\t\tvar me = this;\n\n\t\treturn html5AsrRecorder.startClientRecording({\n\t\t\tbasename: guid,\n\t\t\tfiles: [\n\t\t\t\t{\n\t\t\t\t\tfilename: guid + '.context',\n\t\t\t\t\tcontent: contextXml\n\t\t\t\t}\n\t\t\t],\n\t\t\tonlyPlayback: Boolean(disableScoreRecording),\n\t\t\taudioElement: audioElement\n\t\t}).then(function (startResult) {\n\t\t\tpublishAsrRecordEvent.call(me, FlashStates.START, guid);\n\t\t\treturn startResult.resultPromise.then(function (result) {\n\t\t\t\tpublishAsrRecordEvent.call(me, FlashStates.COMPLETE, guid);\n\n\t\t\t\tif (disableScoreRecording) {\n\t\t\t\t\tpublishAsrRecordEvent.call(me, FlashStates.FEEDBACK, null);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar endRecordingTimestamp = Date.now();\n\t\t\t\tvar encodeTime = 0;\n\t\t\t\tif (result.timers) {\n\t\t\t\t\tendRecordingTimestamp = result.timers.endRecording || endRecordingTimestamp;\n\t\t\t\t\tencodeTime = (result.timers.zip || endRecordingTimestamp) - endRecordingTimestamp;\n\t\t\t\t}\n\n\t\t\t\tvar url = host\n\t\t\t\t\t+ \"/evalzip.ashx\"\n\t\t\t\t\t+ \"?guid=\" + guid\n\t\t\t\t\t+ \"&student_id=\" + studentId\n\t\t\t\t\t+ \"&activity_id=\" + activityId;\n\t\t\t\tme.publish('ajax', {\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\turl: url,\n\t\t\t\t\tcontentType: 'application/zip',\n\t\t\t\t\tdata: result.zip,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tdataType: 'text'\n\t\t\t\t})\n\t\t\t\t\t.then(function (responseArray) {\n\t\t\t\t\t\tvar totalTime = Date.now() - endRecordingTimestamp;\n\t\t\t\t\t\tpublishAsrRecordEvent.call(me, FlashStates.FEEDBACK, {\n\t\t\t\t\t\t\tresult: responseArray[0],\n\t\t\t\t\t\t\ttotalTime: totalTime,\n\t\t\t\t\t\t\tencodeTime: encodeTime,\n\t\t\t\t\t\t\taudioDuration: result.duration,\n\t\t\t\t\t\t\taudioSize: result.zip.size\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function (jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\tpublishAsrRecordEvent.call(me, FlashStates.FAILED, errorThrown);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}, function (error) {\n\t\t\tpublishAsrRecordEvent.call(me, FlashStates.ERROR, error);\n\t\t});\n\t}\n\n\tfunction initServerHtml5Asr() {\n\t\tvar me = this;\n\t\tvar recorder = $.extend({}, html5AsrRecorder);\n\t\trecorder.startClientRecording = function (\n\t\t\tguid,\n\t\t\thost,\n\t\t\tcontextXml,\n\t\t\tignoredCallback,\n\t\t\tstudentId,\n\t\t\tactivityId,\n\t\t\tdisableScoreRecording\n\t\t) {\n\t\t\trecord.call(me,\n\t\t\t\tguid,\n\t\t\t\thost,\n\t\t\t\tcontextXml,\n\t\t\t\tignoredCallback,\n\t\t\t\tstudentId,\n\t\t\t\tactivityId,\n\t\t\t\tdisableScoreRecording,\n\t\t\t\tnull // audio element\n\t\t\t);\n\t\t};\n\t\trecorder.testClientRecording = function (\n\t\t\tguid,\n\t\t\thost,\n\t\t\tcontextXml,\n\t\t\tignoredCallback,\n\t\t\tstudentId,\n\t\t\tactivityId,\n\t\t\tdisableScoreRecording,\n\t\t\taudioUrl\n\t\t) {\n\t\t\tvar audioElement = document.createElement('audio');\n\t\t\taudioElement.controls = false;\n\t\t\taudioElement.preload = 'auto';\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.addEventListener('ended', function () {\n\t\t\t\tdocument.body.removeChild(audioElement);\n\t\t\t});\n\t\t\taudioElement.addEventListener('error', function (error) {\n\t\t\t\tdocument.body.removeChild(audioElement);\n\t\t\t\tpublishAsrRecordEvent.call(me, FlashStates.ERROR, error);\n\t\t\t});\n\t\t\taudioElement.addEventListener('canplaythrough', function onCanPlayThrough() {\n\t\t\t\taudioElement.removeEventListener('canplaythrough', onCanPlayThrough);\n\t\t\t\taudioElement.pause();\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\taudioElement.currentTime = 0;\n\t\t\t\t\trecord.call(me,\n\t\t\t\t\t\tguid,\n\t\t\t\t\t\thost,\n\t\t\t\t\t\tcontextXml,\n\t\t\t\t\t\tignoredCallback,\n\t\t\t\t\t\tstudentId,\n\t\t\t\t\t\tactivityId,\n\t\t\t\t\t\tdisableScoreRecording,\n\t\t\t\t\t\taudioElement\n\t\t\t\t\t);\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t\taudioElement.src = audioUrl;\n\t\t\tdocument.body.appendChild(audioElement);\n\t\t\taudioElement.play(); // start loading\n\t\t};\n\t\trecorder.startClientPlayback = function () {\n\t\t\tme.publish(TOPIC_ASR_PLAYBACK_STATUS_CHANGED, 'START');\n\t\t\thtml5AsrRecorder.startClientPlayback()\n\t\t\t\t.then(function () {\n\t\t\t\t\tme.publish(TOPIC_ASR_PLAYBACK_STATUS_CHANGED, 'COMPLETE');\n\t\t\t\t});\n\t\t};\n\t\tthis[RECORDER] = recorder;\n\t}\n\n\n\treturn Service.extend({\n\t\t'sig/start': function () {\n\t\t\treturn initServerHtml5Asr.call(this);\n\t\t},\n\t\tgetRecorder: function () {\n\t\t\treturn this[RECORDER];\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/util/ccl-cache-server',[], function () {\n\treturn location.protocol === 'http:'\n\t\t? \"ccl!'configuration.servers.cache'\"\n\t\t: \"ccl!'configuration.servers.cachesecure'\";\n});\n",
    "define('school-ui-activity/shared/asr/asr-recorder-service-flash',[\n\t'require',\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/service',\n\t'school-ui-shared/utils/browser-check',\n\t'school-ui-activity/util/ccl-cache-server',\n\t'./asr-logger'\n], function (\n\trequire,\n\t$,\n\twhen,\n\tService,\n\tbrowserCheck,\n\tCCL_CACHE_SERVER,\n\tASRLogger\n) {\n\tvar CONTAINER = '_asrFlashContainer';\n\tvar RECORDER = '_recorder';\n\n\tvar FLASH_CONTAINER_ID = 'ets-asr-recorder';\n\tvar CLS_RECORDER = 'asr-recorder';\n\tvar SEL_RECORDER = '#asr-recorder';\n\n\tvar FLASH_HIDDEN_WIDTH = \"500\", FLASH_HIDDEN_HEIGHT = \"500\";\n\n\tvar CCL_ASR_NON_STREAMING_FLASH_RELATIVE_PATH = 'ccl!\"school.serverasr.nonstreaming.flash.relativepath\"';\n\n\tvar\tTOPIC_ASR_SUCCESS = \"asr/record/success\";\n\tvar\tTOPIC_ASR_FAIL = \"asr/record/failed\";\n\tvar\tTOPIC_ASR_PLAYBACK_STATUS_CHANGED = \"asr/playback/status/changed\";\n\n\tfunction getCacheServer() {\n\t\tvar me = this;\n\t\treturn me.query(CCL_CACHE_SERVER).spread(function (cclCacheServer) {\n\t\t\treturn cclCacheServer && cclCacheServer.value || '';\n\t\t});\n\t}\n\n\tfunction getFlashRelativePath() {\n\t\tvar me = this;\n\t\treturn me.query(CCL_ASR_NON_STREAMING_FLASH_RELATIVE_PATH)\n\t\t\t.spread(function (flashRelativePathCcl) {\n\t\t\t\treturn flashRelativePathCcl && flashRelativePathCcl.value;\n\t\t\t});\n\t}\n\n\tfunction requireSwfObject() {\n\t\treturn when.promise(function (resolve) {\n\t\t\trequire(['swfobject'], resolve);\n\t\t});\n\t}\n\n\tfunction initServerFlashAsr($container) {\n\t\tvar me = this;\n\n\t\tvar ASR = window.ASR = window.ASR || {};\n\n\t\t/**\n\t\t * ASR recording proxy hub used to handle events callback from flash\n\t\t */\n\t\tASR.asrHubProxy = function () {\n\t\t\tvar args = [].slice.call(arguments, 0);\n\t\t\tif (args.length) {\n\t\t\t\t// TODO: this hub name is confusing, as it really\n\t\t\t\t// meant to hanle a \"recording status\" notification (failure, error, etc),\n\t\t\t\t// instead of saying the recording is *really* success\n\t\t\t\tme.publish(TOPIC_ASR_SUCCESS, args);\n\t\t\t} else {\n\t\t\t\tme.publish(TOPIC_ASR_FAIL);\n\t\t\t}\n\t\t};\n\n\t\t/*\n\t\t * New method for new Server ASR recording flow, in the new flow there have a client mode,\n\t\t * that means when ASR playback don't need send request.\n\t\t *  @param {String} status is ASR player internal status\n\t\t */\n\t\tASR.playStatusCallback = function (status) {\n\t\t\tme.publish(TOPIC_ASR_PLAYBACK_STATUS_CHANGED, status);\n\t\t};\n\n\t\treturn when.all([\n\t\t\tgetCacheServer.call(me),\n\t\t\tgetFlashRelativePath.call(me),\n\t\t\trequireSwfObject()\n\t\t]).spread(function (cacheServer, flashRelativePath, swfobject) {\n\t\t\t$container.append($('<div></div>', { id: FLASH_CONTAINER_ID }));\n\n\t\t\tvar initFunctionName = 'asrRecorderInit';\n\t\t\tvar promise = when.promise(function(resolve){\n\t\t\t\twindow[initFunctionName] = resolve;\n\t\t\t});\n\n\t\t\tvar swfversionstr = \"10.0.0\",\n\t\t\t\txiswfurlstr = \"playerproductinstall.swf\",\n\t\t\t\tflashvars = {\n\t\t\t\t\tinit: initFunctionName\n\t\t\t\t},\n\t\t\t\tparams = {},\n\t\t\t\tattributes = {};\n\n\t\t\tvar flashUrl = cacheServer + flashRelativePath;\n\t\t\t/**\n\t\t\t *  In IE, we have a known SPC-2568, if flash file is cached,\n\t\t\t *  then the recorder re-init will always failed.\n\t\t\t */\n\t\t\tif (browserCheck.browser === 'msie') {\n\t\t\t\tflashUrl += '?' + (+new Date);\n\t\t\t}\n\n\t\t\t//create flash for record\n\t\t\t//for version detection, set to min. required flash player version, or 0 (or 0.0.0), for no version detection.\n\t\t\tparams.quality = \"high\";\n\t\t\tparams.bgcolor = \"#ffffff\";\n\t\t\tparams.allowscriptaccess = \"always\";\n\t\t\tparams.allowfullscreen = \"true\";\n\t\t\tparams.allowDomain = \"true\";\n\t\t\tparams.wmode = \"transparent\";\n\t\t\tattributes.id = CLS_RECORDER;\n\t\t\tattributes.name = CLS_RECORDER;\n\t\t\tattributes.align = \"middle\";\n\t\t\tswfobject.embedSWF(\n\t\t\t\tflashUrl,\n\t\t\t\tFLASH_CONTAINER_ID,\n\t\t\t\tFLASH_HIDDEN_WIDTH, FLASH_HIDDEN_HEIGHT,\n\t\t\t\tswfversionstr,\n\t\t\t\txiswfurlstr,\n\t\t\t\tflashvars,\n\t\t\t\tparams,\n\t\t\t\tattributes,\n\t\t\t\tfunction flashCb(event) {\n\t\t\t\t\tme[RECORDER] = event.ref;\n\t\t\t\t});\n\t\t\t//javascript enabled so display the flashcontent div in case it is not replaced with a swf object. -->\n\t\t\tswfobject.createCSS(SEL_RECORDER, \"display:block;text-align:left;\");\n\t\t\t//end flash for record\n\n\t\t\treturn promise;\n\t\t})\n\t\t\t.otherwise(function (e) {\n\t\t\t\tASRLogger.log(\"Server ASR Exception:\" + (e && e.stack) || e);\n\t\t\t\tthrow e;\n\t\t\t});\n\t}\n\n\treturn Service.extend({\n\t\t'sig/start': function () {\n\t\t\treturn initServerFlashAsr.call(this, this[CONTAINER]);\n\t\t},\n\t\tsetContainer: function (container) {\n\t\t\tthis[CONTAINER] = container;\n\t\t},\n\t\tgetRecorder: function() {\n\t\t\treturn this[RECORDER];\n\t\t},\n\t\t\"hub/asr/flash/init/append-to\": function ($container) {\n\t\t\tvar me = this;\n\t\t\tif ($container) {\n\t\t\t\tme[CONTAINER].find(SEL_RECORDER).remove();\n\t\t\t\t$container.append('<div id=\"ets-asr-recorder\"></div>');\n\t\t\t\tinitServerFlashAsr.call(me, $container);\n\t\t\t}\n\t\t}\n\t});\n});\n\n",
    "define('school-ui-activity/shared/asr/asr-init',[\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'./asr-service',\n\t'./asr-recorder-service-html5',\n\t'./asr-recorder-service-flash',\n\t'asr-core'\n], function ASRInitModule(\n\t$,\n\twhen,\n\tWidget,\n\tASRService,\n\tHtml5RecorderService,\n\tFlashRecorderService,\n\thtml5AsrRecorder\n) {\n\t\"use strict\";\n\n\tvar $ELEMENT = \"$element\";\n\n\tvar TOPIC_ASR_INITED = \"asr/inited\";\n\n\treturn Widget.extend({\n\t\t\"sig/start\": function () {\n\t\t\tvar me = this;\n\t\t\tvar recorderService;\n\t\t\tif (html5AsrRecorder.isAvailable()) {\n\t\t\t\trecorderService = Html5RecorderService.create();\n\t\t\t} else {\n\t\t\t\trecorderService = FlashRecorderService.create();\n\t\t\t\trecorderService.setContainer(me[$ELEMENT])\n\t\t\t}\n\t\t\trecorderService.start()\n\t\t\t\t.then(function () {\n\t\t\t\t\treturn me.publish(TOPIC_ASR_INITED, recorderService);\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar asrService = ASRService.create();\n\t\t\t\t\treturn asrService.start();\n\t\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/asr/asr-ui.html',[],function() { return function template(data) { var o = \"\";\n    var outBlurb = function(id,en){\n        var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\n        return res;\n    };\no += \"\\n<div class=\\\"ets-act-asr ets-disabled\\\" data-at-id=\\\"btn-asr-record\\\">\\n\\t<div class=\\\"ets-act-playback\\\"></div>\\n\\t<div class=\\\"ets-act-asr-button\\\" data-action=\\\"record\\\"><div class=\\\"ets-act-asr-loading\\\"></div></div>\\n\\t<div class=\\\"ets-act-asr-pop ets-tip\\\" data-at-id=\\\"pnl-message-asr-tip\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<span data-at-id=\\\"lbl-asr-tip-topic\\\" \" + outBlurb(\"512394\", \"Click to record your answer\")+ \"></span>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-message\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<span \" + outBlurb(\"467533\", \"Wait. Connecting...\")+ \"></span>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-volume\\\" data-at-id=\\\"pnl-message-asr-volume\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<span data-at-id=\\\"lbl-asr-volume-topic\\\" \" + outBlurb(\"512393\", \"Click to stop recording\")+ \"></span>\\n\\t\\t\\t<div class=\\\"ets-act-asr-indicator\\\"><span></span></div>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-warning-pop ets-warning\\\" data-at-id=\\\"pnl-message-asr-warning\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<h4 data-at-id=\\\"lbl-asr-warning-topic\\\"></h4>\\n\\t\\t\\t<p data-at-id=\\\"lbl-asr-warning-content\\\"></p>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-error-pop ets-error\\\" data-at-id=\\\"pnl-message-asr-error\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<h4 data-at-id=\\\"lbl-asr-error-topic\\\"></h4>\\n\\t\\t\\t<p data-at-id=\\\"lbl-asr-error-content\\\"></p>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-hint-pop ets-hint\\\" data-at-id=\\\"pnl-message-asr-hint\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<h4 data-at-id=\\\"lbl-asr-hint-topic\\\"></h4>\\n\\t\\t\\t<p data-at-id=\\\"lbl-asr-hint-content\\\"></p>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-hint-pop ets-broken\\\" data-at-id=\\\"pnl-message-asr-switch-typing\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<h4 data-at-id=\\\"lbl-asr-switch-topic\\\"><span \" + outBlurb(\"626862\", \"Sorry, it seems that we have trouble recognizing your voice\")+ \"></span></h4>\\n\\t\\t\\t<p data-at-id=\\\"lbl-asr-switch-content\\\" \" + outBlurb(\"626864\", \"Do you want to try this activity in non-speaking mode instead?\")+ \" ></p>\\n\\t\\t\\t<div class=\\\"ets-btn ets-btn-blue ets-btn-shadowed\\\" data-action=\\\"switch\\\" data-at-id=\\\"btn-switch-typing-yes\\\">\\n\\t\\t\\t\\t<span \" + outBlurb(\"506853\", \"Yes\")+ \" ></span>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"ets-btn ets-btn-blue ets-btn-shadowed\\\" data-action=\\\"cancel\\\" data-at-id=\\\"btn-switch-typing-no\\\">\\n\\t\\t\\t\\t<span \" + outBlurb(\"506854\", \"No\")+ \" ></span>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-asr-pop ets-error-pop ets-down\\\" data-at-id=\\\"pnl-message-asr-down\\\">\\n\\t\\t<div class=\\\"ets-hd\\\"></div>\\n\\t\\t<div class=\\\"ets-bd\\\">\\n\\t\\t\\t<h4><span \" + outBlurb(\"467530\", \"Speech recognition error\")+ \"></span></h4>\\n\\t\\t\\t<p>The speech recognition is not working now.</p>\\n\\t\\t\\t<div class=\\\"ets-btn-small ets-btn-blue ets-btn-shadowed\\\" data-action=\\\"down\\\">\\n\\t\\t\\t\\t<span \" + outBlurb(\"150652\", \"OK\")+ \"></span>\\n\\t\\t\\t</div>&nbsp;\\n\\t\\t</div>\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "/**\n *   ASR Widget\n */\ndefine('school-ui-activity/shared/asr/asr-ui',[\n\t'jquery',\n\t'jquery.ui',\n\t'troopjs-ef/component/widget',\n\t'underscore',\n\t'template!./asr-ui.html',\n\t'./asr-ui-states',\n\t'./asr-blurbs',\n\t'./asr-config',\n\t'./asr-service',\n\t'./guid',\n\t'school-ui-shared/utils/browser-check'\n], function ASRUI(\n\t$,\n\t$UI,\n\tWidget,\n\t_,\n\ttASR,\n\tUIStates,\n\tASRBlurbs,\n\tASRConfig,\n\tASRService,\n\tguid,\n\tbrowserCheck\n) {\n\t\"use strict\";\n\n\tvar undef;\n\tvar $ELEMENT = \"$element\";\n\n\tvar CLS_ASR_DISABLE = \"ets-disabled\",\n\t\tCLS_ASR_RECODING = \"ets-recording \",\n\t\tCLS_ASR_PREPARING = \"ets-preparing \",\n\t\tCLS_ASR_PROCESSING = \"ets-processing \",\n\t\tCLS_ASR_DOWN = \"ets-down\",\n\t\tCLS_ASR_WARNING = \"ets-warning\",\n\t\tCLS_ASR_ERROR = \"ets-error\",\n\t\tCLS_ASR_HINT = \"ets-hint\",\n\t\tCLS_ASR_BROKEN = \"ets-broken\",\n\t\tCLS_ASR = \"ets-act-asr\",\n\t\tCLS_TIP = \"ets-tip\",\n\t\tCLS_PLAYBACK_OPEN = \"ets-act-open\",\n\n\t\tASR_FALLBACK_TYPE = \"asrFallbackType\",\n\t\tASR_FALLBACK_CB = \"asrFallbackCb\",\n\t\tASR_FAIL_CB = \"asrFailCb\",\n\t\tASR_RESET_FAILED_TIMES = \"needResetASRFailedTimes\",\n\t\tASR_ENABLE_TIP = \"asrEnableTip\",\n\n\t\tID = \"_id\",\n\n\t\tSEL_ASR = \".ets-act-asr\",\n\t\tSEL_ASR_BUTTON = \".ets-act-asr-button\",\n\t\tSEL_ASR_WARN_TITLE = \".ets-warning .ets-bd > h4\",\n\t\tSEL_ASR_WARN_MSG = \".ets-warning .ets-bd > p\",\n\t\tSEL_ASR_ERROR_TITLE = \".ets-error .ets-bd > h4\",\n\t\tSEL_ASR_ERROR_MSG = \".ets-error .ets-bd > p\",\n\t\tSEL_ASR_HINT_TITLE = \".ets-hint .ets-bd > h4\",\n\t\tSEL_ASR_HINT_MSG = \".ets-hint .ets-bd > p\",\n\t\tSEL_INDICATOR = \".ets-act-asr-indicator span\",\n\t\tSEL_ASR_DOWN_CONTENT = \".ets-down .ets-bd > p\",\n\t\tSEL_ASR_BROKEN_CONTENT = \".ets-broken .ets-bd > p\",\n\t\tSEL_ASR_PARPARE_MSG = \".ets-act-asr-pop.ets-message\",\n\t\tSEL_PLAYBACK = \".ets-act-playback\",\n\n\n\t\tTOPIC_ASR_DEBUGGERTOOL = \"asr/debuggerTool\",\n\t\tTOPIC_ASR_UI = \"asr/ui/states/changed\",\n\t\tTOPIC_CONTAINER_NEXT_ACT = \"activity-container/nextActivity\",\n\t\tTOPIC_ASR_ENABLE = \"asr/enable\",\n\t\tTOPIC_ASR_START_RECORD = \"asr/start/record\",\n\t\tTOPIC_ASR_STOP_RECORD = \"asr/stop/record\",\n\t\tTOPIC_ASR_PLAYBACK = \"asr/ui/playback\",\n\t\tTOPIC_ASR_INIT_APPENDTO = \"asr/flash/init/append-to\";\n\n\n\tvar ENUM_ASR_FALLBACK_TYPE = {\n\t\tTYPING: \"TYPING\",\n\t\tSELECT: \"SELECT\",\n\t\tNEXT: \"NEXT\"\n\t};\n\n\tvar SETTING = {\n\t\tasrFallbackType: ENUM_ASR_FALLBACK_TYPE.NEXT,\n\t\tasrFallbackCb: $.noop,\n\t\tasrFailCb: $.noop,\n\t\tneedResetASRFailedTimes: false,\n\t\tasrEnableTip: false\n\t};\n\n\tvar HANDLERS = {\n\t\tstate: function (state) {\n\t\t\tif (state && this._state !== state) {\n\t\t\t\tthis._state = state;\n\t\t\t\tthis.updateUI(state);\n\t\t\t}\n\t\t\treturn this._state;\n\t\t},\n\t\toption: function (option) {\n\t\t\tif (!this._option || (option && this._option[ID] !== option[ID])) {\n\t\t\t\tthis._option = option;\n\t\t\t}\n\t\t\treturn this._option || { prons: \"\" };\n\t\t},\n\t\t\"setting\": function (config) {\n\t\t\tvar me = this;\n\t\t\tme._setting = me._setting || _.extend({}, SETTING);\n\n\t\t\treturn config ? _.extend(me._setting, config) : me._setting;\n\t\t},\n\t\ttoggleCls: function (cls) {\n\t\t\tvar me = this;\n\n\t\t\tif (!me._$asr) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar newCls = cls ? (CLS_ASR + \" \" + cls) : CLS_ASR;\n\n\t\t\tme._$asr.attr(\"class\", newCls);\n\t\t},\n\t\tupdateUI: function (state) {\n\t\t\tvar me = this,\n\t\t\t\tsetting = me.setting(),\n\t\t\t\tFALLBACK_TYPE = setting[ASR_FALLBACK_TYPE].toUpperCase();\n\t\t\tstate = state || me.state();\n\n\t\t\tswitch (state) {\n\t\t\t\tcase UIStates.BROKEN:\n\t\t\t\t\t// case 1, fail case over 3 times\n\t\t\t\t\tswitch (FALLBACK_TYPE) {\n\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.NEXT:\n\t\t\t\t\t\t\tthis._$brokenContent.text(ASRBlurbs.ASRAlterSkipMsg);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.TYPING:\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.SELECT:\n\t\t\t\t\t\t\tthis._$brokenContent.text(ASRBlurbs.ASRAlterMsg);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.toggleCls(CLS_ASR_BROKEN);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.DISABLE:\n\t\t\t\t\tme.toggleCls(CLS_ASR_DISABLE, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.DOWN:\n\t\t\t\t\t// case 1, sudden stop record when ui is processing\n\t\t\t\t\t// case 2, asr is not enabled(asr funtion not found) when start record\n\t\t\t\t\tswitch (FALLBACK_TYPE) {\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.NEXT:\n\t\t\t\t\t\t\tme._$fallBackContent.text(ASRBlurbs.ASRSwitchNext);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.TYPING:\n\t\t\t\t\t\t\tme._$fallBackContent.text(ASRBlurbs.ASRSwitchTyping);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.SELECT:\n\t\t\t\t\t\t\tme._$fallBackContent.text(ASRBlurbs.ASRSwitchSelecting);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.toggleCls(CLS_ASR_DOWN);\n\t\t\t\t\tif (setting[ASR_FAIL_CB]) {\n\t\t\t\t\t\tsetting[ASR_FAIL_CB]();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.NORMAL:\n\t\t\t\t\tme.toggleCls(setting[ASR_ENABLE_TIP] ? CLS_TIP : \"\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.PREPARING:\n\t\t\t\t\tme.toggleCls(CLS_ASR_PREPARING);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.PROCESSING:\n\t\t\t\t\tme.toggleCls(CLS_ASR_PROCESSING);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.RECORDING:\n\t\t\t\t\tme.toggleCls(CLS_ASR_RECODING);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.WARNING:\n\t\t\t\t\tme.toggleCls(CLS_ASR_WARNING);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.ERROR:\n\t\t\t\t\tme.toggleCls(CLS_ASR_ERROR);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.HINT:\n\t\t\t\t\tme.toggleCls(CLS_ASR_HINT);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\n\tfunction initASREL() {\n\t\tvar me = this;\n\t\tif (!me[$ELEMENT]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!me._$asr || !me._$asr.length) {\n\t\t\tme._$asr = me[$ELEMENT].find(SEL_ASR);\n\t\t\tme._$fallBackContent = me._$asr.find(SEL_ASR_DOWN_CONTENT);\n\t\t\tme._$brokenContent = me._$asr.find(SEL_ASR_BROKEN_CONTENT);\n\n\t\t\tme._$asr.find(SEL_ASR_PARPARE_MSG).hide();\n\t\t}\n\n\t\treturn me._$asr;\n\t}\n\n\tfunction resetFailedTimes() {\n\t\tthis.publish(\"asr/reset/failed/times\");\n\t}\n\n\tfunction createPlayback(guid) {\n\t\tvar me = this;\n\t\tvar $playback_audio = $(SEL_PLAYBACK);\n\t\tvar HUB_ASR_STOP_PLAYBACK = \"asr/stopPlayback\";\n\t\tvar HUB_ASR_PLAYBACK = \"asr/startPlayback\";\n\t\tvar WIDGET_PATH_AUDIO_SHELL = \"school-ui-activity/shared/audio/audio-shell\";\n\n\t\t$playback_audio\n\t\t\t.unweave()\n\t\t\t.then(function () {\n\t\t\t\treturn $playback_audio\n\t\t\t\t\t.data(\"option\", {\n\t\t\t\t\t\t\"_playHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"_pauseHandler\": function () {\n\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"guid\": guid\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"data-weave\", WIDGET_PATH_AUDIO_SHELL + \"(option)\")\n\t\t\t\t\t.weave();\n\t\t\t});\n\t}\n\n\tfunction createDebugPanel() {\n\t\t$(\".ets-asr-debug\").remove();\n\n\t\t$(\"<div></div>\").addClass(\"ets-asr-debug\")\n\t\t\t.attr(\"data-weave\", \"school-ui-activity/shared/asr/asr-debug/main\")\n\t\t\t.appendTo(\"body\")\n\t\t\t.weave();\n\t}\n\n\treturn Widget.extend(function () {\n\t\tvar me = this;\n\n\t\tme.html(tASR)\n\t\t\t.then(function () {\n\t\t\t\tvar $el = me[$ELEMENT];\n\t\t\t\tif (!$el) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme._$indicator = $el.find(SEL_INDICATOR);\n\n\t\t\t\tif (ASRConfig.DEBUG_ASR_ENABLED) {\n\t\t\t\t\tcreateDebugPanel.call(me);\n\t\t\t\t}\n\t\t\t});\n\t}, {\n\t\t\"sig/start\": function() {\n\t\t\treturn ASRBlurbs.loadedPromise;\n\t\t},\n\n\t\t\"sig/stop\": function () {\n\t\t\tthis.publish(\"asr/reset\");\n\t\t},\n\n\t\t\"hub/asr/ui/setting\": function (cb, option, config) {\n\t\t\tvar me = this,\n\t\t\t\tsetting;\n\n\t\t\tme.option(option);\n\n\t\t\tif (cb && typeof cb === \"function\") {\n\t\t\t\tme._asrCB = (function () {\n\t\t\t\t\tvar asr_cb = cb || function () {};\n\n\t\t\t\t\tif (option[\"playback\"] != false) {\n\t\t\t\t\t\tcreatePlayback.call(me, me._guid);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn function (result) {\n\t\t\t\t\t\t/*Add ASR Info for ASR_Scoring:\n\t\t\t\t\t\t * >. Current recording items '_id'\n\t\t\t\t\t\t */\n\t\t\t\t\t\tif (result && result[0]) {\n\t\t\t\t\t\t\tresult[0][ID] = me.option()[ID];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tasr_cb(result, me._guid);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\n\t\t\tif (config) {\n\t\t\t\tsetting = me.setting(config);\n\t\t\t}\n\n\t\t\tif (setting[ASR_RESET_FAILED_TIMES]) {\n\t\t\t\tresetFailedTimes.call(me);\n\t\t\t}\n\n\t\t\tme.updateUI();\n\n\t\t\tme.publish(TOPIC_ASR_DEBUGGERTOOL, me._asrCB, me.option());\n\t\t},\n\n\t\t\"hub:memory/asr/service/started\": function () {\n\t\t\tvar me = this;\n\n\t\t\tinitASREL.call(this);\n\n\t\t\tme.state(UIStates.NORMAL);\n\t\t\tme.publish(TOPIC_ASR_ENABLE);\n\n\t\t\t// we need to append the asr flash under the button for preventing power saved\n\t\t\tif (browserCheck.browser === \"safari\" &&\n\t\t\t\tparseFloat(browserCheck.version, 10) >= 7) {\n\t\t\t\tme.publish(TOPIC_ASR_INIT_APPENDTO, me[$ELEMENT].find(SEL_ASR_BUTTON));\n\t\t\t}\n\t\t},\n\n\n\t\t\"hub/asr/ui/states/changed\": function (state, failedTimes) {\n\n\t\t\tif (failedTimes !== undefined) {\n\t\t\t\tthis._failedTimes = failedTimes;\n\t\t\t}\n\n\t\t\tthis.state(state);\n\t\t},\n\n\t\t\"hub/asr/ui/warning\": function (title, msg) {\n\t\t\tvar me = this;\n\t\t\tme._$asr\n\t\t\t\t.addClass(CLS_ASR_WARNING)\n\t\t\t\t.find(SEL_ASR_WARN_TITLE)\n\t\t\t\t.text(title || \"\")\n\t\t\t\t.end()\n\t\t\t\t.find(SEL_ASR_WARN_MSG)\n\t\t\t\t.text(msg || \"\");\n\t\t\tme.updateUI();\n\n\t\t},\n\t\t\"hub/asr/ui/error\": function (title, msg) {\n\t\t\tthis._$asr\n\t\t\t\t.addClass(CLS_ASR_ERROR)\n\t\t\t\t.find(SEL_ASR_ERROR_TITLE)\n\t\t\t\t.text(title || \"\")\n\t\t\t\t.end()\n\t\t\t\t.find(SEL_ASR_ERROR_MSG)\n\t\t\t\t.text(msg || \"\");\n\t\t},\n\t\t\"hub/asr/ui/hint\": function (title, msg) {\n\t\t\tthis._$asr\n\t\t\t\t.addClass(CLS_ASR_HINT)\n\t\t\t\t.find(SEL_ASR_HINT_TITLE)\n\t\t\t\t.text(title || \"\")\n\t\t\t\t.end()\n\t\t\t\t.find(SEL_ASR_HINT_MSG)\n\t\t\t\t.text(msg || \"\");\n\t\t},\n\n\t\t\"hub/asr/ui/recording\": function (micLevel) {\n\t\t\tvar me = this;\n\n\t\t\tif (!me._$indicator) {\n\t\t\t\tme._$indicator = me[$ELEMENT].find(SEL_INDICATOR);\n\t\t\t}\n\t\t\tme._$indicator.css(\"width\", micLevel + \"%\");\n\t\t},\n\n\t\t\"hub/asr/ui/playback\": function (toggle) {\n\t\t\tvar me = this,\n\t\t\t\toption = me.option();\n\n\t\t\tif (option[\"playback\"] == false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar $playback = me[$ELEMENT].find(SEL_PLAYBACK);\n\n\t\t\tif (toggle === undef) {\n\t\t\t\t$playback.toggleClass(CLS_PLAYBACK_OPEN);\n\t\t\t}\n\t\t\telse if (toggle === true) {\n\t\t\t\t$playback.addClass(CLS_PLAYBACK_OPEN);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$playback.removeClass(CLS_PLAYBACK_OPEN);\n\t\t\t}\n\t\t},\n\n\t\t'dom:[data-action=\"record\"]/click': function () {\n\t\t\tvar me = this,\n\t\t\t\tinValidState = [UIStates.PROCESSING, UIStates.PREPARING, UIStates.DISABLE],\n\t\t\t\tisASRDown = (me.state() === UIStates.DOWN) && me._failedTimes > ASRConfig.LIMIT_FAILED_TIMES - 1;\n\n\t\t\tif (_.indexOf(inValidState, me.state()) !== -1 || isASRDown) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (me.state()) {\n\t\t\t\tcase UIStates.WARNING:\n\t\t\t\tcase UIStates.HINT:\n\t\t\t\tcase UIStates.ERROR:\n\t\t\t\t\tme.toggleCls();\n\t\t\t\tcase UIStates.COMMON:\n\t\t\t\tcase UIStates.DOWN:\n\t\t\t\tcase UIStates.STOP_REPLAY:\n\t\t\t\tcase UIStates.NORMAL:\n\t\t\t\t\tme._guid = guid();\n\t\t\t\t\t//>>excludeStart(\"release\", pragmas.release);\n\t\t\t\t\tif (window.debugAsr) {\n\t\t\t\t\t\tme.option({\n\t\t\t\t\t\t\t\"Title\": \"pig\",\n\t\t\t\t\t\t\t\"pronsXML\": '<?xml version=\"1.0\"?><TPContext version=\"1.1\"><Sentences><Sentence AVG=\"87.555490868151\" DEV=\"18.831834969547\" id=\"1\" display_trans=\"pig\" trans=\"LTIKN \"><Word id=\"1\" trans=\"LTIKN\" display_trans=\"PIG\" weight=\"1\"/></Sentence></Sentences><NewWords><NewWord id=\"1\" trans=\"LTIKN\" prons=\"P IH G\"/></NewWords><Dictionary><![CDATA[LTIKN  P IH G]]></Dictionary></TPContext>',\n\t\t\t\t\t\t\t\"_id\": -1\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme._asrCB = function () {\n\t\t\t\t\t\t\tvar $debug_audio = $(\".ets-act-asr-fn-audio\");\n\t\t\t\t\t\t\tvar HUB_ASR_STOP_PLAYBACK = \"asr/stopPlayback\";\n\t\t\t\t\t\t\tvar HUB_ASR_PLAYBACK = \"asr/startPlayback\";\n\t\t\t\t\t\t\tvar WIDGET_PATH_AUDIO_SHELL = \"school-ui-activity/shared/audio/audio-shell\";\n\n\t\t\t\t\t\t\t$debug_audio\n\t\t\t\t\t\t\t\t.unweave()\n\t\t\t\t\t\t\t\t.data(\"option\", {\n\t\t\t\t\t\t\t\t\t\"_playHandler\": function () {\n\t\t\t\t\t\t\t\t\t\tme.publish(HUB_ASR_PLAYBACK);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\"_pauseHandler\": function () {\n\t\t\t\t\t\t\t\t\t\tme.publish(HUB_ASR_STOP_PLAYBACK);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\"guid\": me._guid\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.attr(\"data-weave\", WIDGET_PATH_AUDIO_SHELL + \"(option)\")\n\t\t\t\t\t\t\t\t.weave();\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t//>>excludeEnd(\"release\");\n\t\t\t\t\tme.publish(TOPIC_ASR_START_RECORD, me._guid, me._asrCB, me.option());\n\t\t\t\t\tme.publish(TOPIC_ASR_PLAYBACK, false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase UIStates.RECORDING:\n\t\t\t\t\tme.publish(TOPIC_ASR_STOP_RECORD, me._guid);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault :\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t'dom:[data-action=\"down\"]/click': function () {\n\t\t\tvar me = this,\n\t\t\t\tsetting = this.setting();\n\n\t\t\tme.toggleCls(CLS_ASR_DISABLE);\n\t\t\tme[$ELEMENT]\n\t\t\t\t.effect(\n\t\t\t\t\t'fade',\n\t\t\t\t\t500,\n\t\t\t\t\tfunction () {\n\t\t\t\t\t\tif (setting[ASR_FALLBACK_CB]) {\n\t\t\t\t\t\t\tsetting[ASR_FALLBACK_CB]();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t).remove();\n\t\t},\n\n\t\t'dom:[data-action=\"switch\"]/click': function () {\n\t\t\tvar me = this,\n\t\t\t\tsetting = me.setting(),\n\t\t\t\tFALLBACK_TYPE = setting[ASR_FALLBACK_TYPE].toUpperCase();\n\n\t\t\tswitch (FALLBACK_TYPE) {\n\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.NEXT:\n\t\t\t\t\tme.publish(TOPIC_CONTAINER_NEXT_ACT);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.TYPING:\n\t\t\t\tcase ENUM_ASR_FALLBACK_TYPE.SELECT:\n\t\t\t\t\tme[$ELEMENT].find('[data-action=\"down\"]').click();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t'dom:[data-action=\"cancel\"]/click': function () {\n\t\t\tvar me = this;\n\t\t\tme.state(UIStates.NORMAL);\n\t\t\tme.publish(TOPIC_ASR_UI, UIStates.NORMAL);\n\t\t\tresetFailedTimes.call(me);\n\t\t}\n\t}, HANDLERS);\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/audio/audio-shell.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-ap-shell\\\">\\n    <div class=\\\"ets-ap ets-ap-small\\\">\\n        <button data-action=\\\"play\\\"></button>\\n    </div>\\n</div>  \"; return o; }; });\n",
    "define('school-ui-activity/shared/audio/audio-shell',[\n\t'jquery',\n\t'troopjs-ef/component/widget',\n\t'template!./audio-shell.html'\n], function ActivityBaseModule($, Widget, tAudioShell) {\n\t\"use strict\";\n\n\tvar SEL_AP_SHELL = \".ets-ap-shell\",\n\t\tSEL_AP = \".ets-ap\",\n\t\tCLS_DISABLED = \"ets-disabled\",\n\t\tCLS_PAUSE = \"ets-pause\",\n\t\tHANDLER_PLAY = \"_playHandler\",\n\t\tHANDLER_PAUSE = \"_pauseHandler\";\n\n\tvar ENUM_STATES = {\n\t\tNORMAL: \"NORMAL\",\n\t\tPLAYING: \"PLAYING\"\n\t};\n\n\tfunction updateCls(needPauseCls) {\n\t\tif (!this.$apShell) {\n\t\t\tthis.$apShell = this.$element.find(SEL_AP_SHELL);\n\t\t}\n\t\tif (!needPauseCls) {\n\t\t\tthis.$apShell.removeClass(CLS_PAUSE);\n\t\t} else {\n\t\t\tthis.$apShell.addClass(CLS_PAUSE);\n\t\t}\n\t}\n\n\treturn Widget.extend(function (el, module, setting) {\n\t\tif (setting) {\n\t\t\tthis[HANDLER_PLAY] = setting[HANDLER_PLAY];\n\t\t\tthis[HANDLER_PAUSE] = setting[HANDLER_PAUSE];\n\t\t\tthis._guid = setting.guid;\n\t\t} else {\n\t\t\tthis[HANDLER_PLAY] = this[HANDLER_PAUSE] = $.noop;\n\t\t}\n\t}, {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\t\t\treturn me.html(tAudioShell);\n\t\t},\n\t\tstate: function (s) {\n\t\t\tif (s && this._state != s) {\n\t\t\t\tthis._state = s;\n\t\t\t}\n\t\t\treturn this._state || ENUM_STATES.NORMAL;\n\t\t},\n\t\t'dom:button/click': function ($e) {\n\t\t\tvar $target = $($e.currentTarget);\n\t\t\t// If audio is disabled, then don't play audio just return\n\t\t\tif ($target.closest(SEL_AP).hasClass(CLS_DISABLED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (this.state()) {\n\t\t\t\tcase ENUM_STATES.NORMAL:\n\t\t\t\t\tthis[HANDLER_PLAY]();\n\t\t\t\t\tthis.state(ENUM_STATES.PLAYING);\n\t\t\t\t\tupdateCls.call(this, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ENUM_STATES.PLAYING:\n\t\t\t\t\tthis[HANDLER_PAUSE]();\n\t\t\t\t\tthis.state(ENUM_STATES.NORMAL);\n\t\t\t\t\tupdateCls.call(this);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t\"hub/audio/shell/play/complete\": function (/*guid*/) {\n\t\t\tvar me = this;\n\t\t\t// if(guid !== this._guid) return;\n\t\t\tme.state(ENUM_STATES.NORMAL);\n\n\t\t\t// Becasue sometimes the callback will get immediately, so this can be let javascript delay run in queue\n\t\t\tsetTimeout(function () {\n\t\t\t\tupdateCls.call(me);\n\t\t\t}, 0);\n\t\t},\n\t\t'hub/asr/start/record': function () {\n\t\t\tvar me = this;\n\t\t\tme.$element.find(SEL_AP).addClass(CLS_DISABLED);\n\t\t},\n\t\t'hub/asr/recording/stopped': function () {\n\t\t\tvar me = this;\n\t\t\tme.$element.find(SEL_AP).removeClass(CLS_DISABLED);\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/automation-test/automation-test.html',[],function() { return function template(data) { var o = \"<input type=\\\"hidden\\\" data-at-id=\\\"assets\\\" />\"; return o; }; });\n",
    "define('school-ui-activity/shared/automation-test/main',[\n\t'json2',\n\t\"troopjs-ef/component/widget\",\n\t\"template!./automation-test.html\"\n], function (JSON, Widget, tAt) {\n\n\treturn Widget.extend(function ($element, name, assets) {\n\t\tvar assetsString = \"{}\";\n\t\tswitch (typeof assets) {\n\t\t\tcase \"string\":\n\t\t\t\tassetsString = assets;\n\t\t\t\tbreak;\n\t\t\tcase \"object\":\n\t\t\t\tassetsString = JSON.stringify(assets);\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.html(tAt);\n\t\t$element.find(\"[data-at-id=assets]\").val(assetsString);\n\t});\n\n});\n",
    "define('school-ui-activity/shared/checkbox/main',[\n\t'jquery',\n\t'when',\n\t'troopjs-ef/component/widget'\n], function ActivityBaseModule($, when, Widget) {\n\t\"use strict\";\n\n\tvar $ELEMENT = '$element';\n\n\tvar WRAPPER = \"<span class='ets-checkbox'></span>\";\n\n\tvar SEL_CHECKBOX = '.ets-checkbox';\n\tvar SEL_INPUT = 'input[type=\"checkbox\"]';\n\tvar CLS_CHECKED = 'ets-checkbox-checked';\n\n\tfunction toggleChecked() {\n\t\tvar me = this;\n\n\t\tif (me.$input.prop('checked')) {\n\t\t\tme.$wrapper.addClass(CLS_CHECKED);\n\t\t} else {\n\t\t\tme.$wrapper.removeClass(CLS_CHECKED);\n\t\t}\n\n\t}\n\n\tfunction render() {\n\t\tvar me = this;\n\n\t\tif (!me[$ELEMENT].find(SEL_INPUT).length) {\n\t\t\treturn when.reject(new Error(\"No found checkbox element\"));\n\t\t}\n\n\t\tme[$ELEMENT].find(SEL_INPUT).wrap();\n\t\tme.$input = me[$ELEMENT].find(SEL_INPUT);\n\n\t\tme.$input.wrap(WRAPPER);\n\n\t\tme.$wrapper = me[$ELEMENT].find(SEL_CHECKBOX);\n\n\t\treturn when.resolve();\n\t}\n\n\treturn Widget.extend({\n\t\t'sig/initialize': function () {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/start': function () {\n\t\t\tvar me = this;\n\t\t\ttoggleChecked.call(me);\n\t\t},\n\t\t'dom/mouseenter': function () {\n\t\t\tvar me = this;\n\t\t\tme.$wrapper.addClass('ets-checkbox-hover');\n\t\t},\n\t\t'dom/mouseleave': function () {\n\t\t\tvar me = this;\n\t\t\tme.$wrapper.removeClass('ets-checkbox-hover');\n\t\t},\n\t\t'dom/click': function () {\n\t\t\tvar me = this;\n\t\t\tme.$input.prop('checked', !me.$input.prop('checked'));\n\t\t\ttoggleChecked.call(me);\n\t\t}\n\t});\n});\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-ep-bd\\\" data-at-id=\\\"pnl-epaper-container\\\">\\n\\t<div class=\\\"ets-act-ep-main\\\">\\n\\t\\t<div class=\\\"ets-act-ep-content-wrap\\\">\\n\\t\\t\\t<div class=\\\"ets-act-ep-content ets-hidden\\\">\\n\\t\\t\\t\\t<!--put epaper content here-->\\n\\t\\t\\t\\t\" + data + \"\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-ep-handler\\\" data-at-id=\\\"btn-epaper-toggle\\\">\\n\\t\\t\\t<i class=\\\"ets-act-ep-arr\\\"></i>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-ep-bd-shadow\\\"></div>\\n</div>\"; return o; }; });\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/epaper/epaper-fixed.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-act-ep-bd ets-act-ep-fixed\\\" data-at-id=\\\"pnl-epaper-container\\\">\\n    <div class=\\\"ets-act-ep-main\\\">\\n        <div class=\\\"ets-act-ep-content-wrap\\\">\\n            <div class=\\\"ets-act-ep-content ets-hidden\\\">\\n                <!--put epaper content here-->\\n                \" + data + \"\\n            </div>\\n        </div>\\n    </div>\\n</div>\"; return o; }; });\n",
    "/*\n * Flow to add epaper:\n 1. build a container with class named \"ets-act-epaper\"\n 2. set epaper content\n */\ndefine('school-ui-activity/shared/epaper/main',[\n\t'jquery',\n\t'jquery.mousewheel',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t'school-ui-shared/utils/browser-check',\n\t'template!./epaper.html',\n\t'template!./epaper-fixed.html',\n\t'jquery.jscrollpane'\n], function ($, $mouseWheel, when, Widget, browserCheck, tEpaper, tEpaperFixed) {\n\t\"use strict\";\n\n\tvar IS_IE78 = browserCheck.browser === \"msie\" && parseInt(browserCheck.version, 10) <= 8;\n\tvar $el = \"$element\",\n\n\t\tPROP_ANIMATING_TOGGLE = \"_animatingToggle\",\n\n\t\tSEL_EPAPER_CONTENT = \".ets-act-ep-content\",\n\t\tSEL_EPAPER_BD = \".ets-act-ep-bd\",\n\n\t\tCLS_EXPENDED = \"ets-expanded\",\n\t\tCLS_HIDDEN = \"ets-hidden\",\n\n\t\tAUTO_EXPAND_DELAY = 600,\n\t\tANIMATE_DURATION = 400,\n\t\tREG_IMAGE_URL = /(?:(src\\s*=\\s*[\\|'|\"]*)(.*?\\.(jpg|png)))/g,\n\t\tREG_LOOK_BEHIND = /src\\s*[=|'|\"]+|url\\s*\\(['|\"]*/g,\n\n\t\tIMG_PAP = \"imgPap\",\n\t\tHTML_PAP = \"htmlPap\",\n\t\t$epBody,\n\n\t\tdefaults = {\n\t\t\texpandWidth: 652,\n\t\t\tautoExpand: true\n\t\t},\n\n\t\tDEFAULT_CONTENT = \"Failed loading content. Please try again later.\",\n\n\t\tTOPIC_EPAPER_EXPAND = \"activity/epaper/expanding\",\n\t\tTOPIC_EPAPER_FOLD = \"activity/epaper/folding\";\n\n\tfunction toggleExpandContent() {\n\t\tvar me = this;\n\t\tif (me[PROP_ANIMATING_TOGGLE]) return;\n\n\t\tvar expWid = this._settings.expandWidth,\n\t\t\toperator = this.expanded ? '-=' : '+=',\n\t\t\ttoggleOperate = this.expanded ? \"removeClass\" : \"addClass\";\n\n\t\tpublishProxy.call(this, this.expanded);\n\n\t\tme[PROP_ANIMATING_TOGGLE] = true;\n\t\twhen\n\t\t\t.promise(function (resolve, reject) {\n\t\t\t\t$epBody.animate({\n\t\t\t\t\t\"width\": operator + expWid\n\t\t\t\t}, ANIMATE_DURATION).promise().then(resolve, reject);\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\tme[PROP_ANIMATING_TOGGLE] = false;\n\t\t\t\t$(this)[toggleOperate](CLS_EXPENDED);\n\t\t\t\tme.expanded = !me.expanded;\n\n\t\t\t\tif (!me.expanded) {\n\t\t\t\t\tme.publish('epaper/collapse');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tfunction publishProxy(isExpand) {\n\t\tthis.publish(isExpand ? TOPIC_EPAPER_FOLD : TOPIC_EPAPER_EXPAND);\n\t}\n\n\tfunction loadImg(src) {\n\t\treturn when.promise(function (resolve) {\n\t\t\tvar cachedImg = new Image();\n\t\t\tcachedImg.onload = function () {\n\t\t\t\tresolve({\n\t\t\t\t\twidth: cachedImg.width,\n\t\t\t\t\theight: cachedImg.height\n\t\t\t\t});\n\t\t\t};\n\t\t\tcachedImg.onerror = function () {\n\t\t\t\tresolve({\n\t\t\t\t\twidth: null,\n\t\t\t\t\theight: null\n\t\t\t\t});\n\t\t\t};\n\t\t\tcachedImg.src = src;\n\t\t});\n\t}\n\n\tfunction wrapImg(src) {\n\t\treturn '<img src=\"' + src + ' \" alt=\"\" />';\n\t}\n\n\tfunction render(content) {\n\t\tvar me = this,\n\t\t\t$ele = me[$el],\n\t\t\ttemplate = me._refereces._epaperType === \"fixed\" ? tEpaperFixed : tEpaper;\n\n\t\tcontent = content || DEFAULT_CONTENT;\n\n\t\tthis.expanded = false;\n\n\t\t// Cause JavaScript not consist 'look behind', like (?<:XX)SS\n\t\t//  To reach the same goal, here used two regexp\n\t\tvar imgsUrlArr = (content.match(REG_IMAGE_URL) || []).map(function (src) {\n\t\t\treturn src.replace(REG_LOOK_BEHIND, \"\");\n\t\t});\n\n\t\treturn this.html(template, content)\n\t\t\t.then(function () {\n\t\t\t\t$epBody = $ele.find(SEL_EPAPER_BD);\n\t\t\t\tvar imgPromises = imgsUrlArr.map(function (src) {\n\t\t\t\t\tsrc = src.replace(/'/g, '%27').replace(/\"/g, '%34');\n\n\t\t\t\t\t// Fix <=IE8 cached image can't fire onload event properly\n\t\t\t\t\tif (IS_IE78) {\n\t\t\t\t\t\tsrc = src + \"?_\" + (new Date).getTime();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn loadImg(src)\n\t\t\t\t\t\t.then(function (size) {\n\t\t\t\t\t\t\t$ele.find('img[src=\"' + src + '\"]').attr({\n\t\t\t\t\t\t\t\theight: size.height || \"auto\",\n\t\t\t\t\t\t\t\twidth: size.width || \"auto\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (me._settings.autoExpand && template === tEpaper) {\n\t\t\t\t\tme._timeout = setTimeout(function () {\n\t\t\t\t\t\ttoggleExpandContent.call(me);\n\t\t\t\t\t}, AUTO_EXPAND_DELAY);\n\t\t\t\t}\n\n\t\t\t\treturn when.all(imgPromises);\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\t$ele.find(SEL_EPAPER_CONTENT)\n\t\t\t\t\t.jScrollPane()\n\t\t\t\t\t.find(\"img\")\n\t\t\t\t\t.removeAttr(\"height width\")\n\t\t\t\t\t.end()\n\t\t\t\t\t.removeClass(CLS_HIDDEN);\n\t\t\t});\n\t}\n\n\tfunction checkAndReadyEpaper() {\n\t\tvar me = this,\n\t\t\tref = me._refereces;\n\n\t\tvar content = (ref[HTML_PAP] && ref[HTML_PAP].content)\n\t\t\t? ref[HTML_PAP].content\n\t\t\t: ref[IMG_PAP] && ref[IMG_PAP].url && wrapImg(ref[IMG_PAP].url);\n\n\t\t//Resolve epaper render defer object\n\t\tme.renderDfd.resolve(content);\n\t}\n\n\treturn Widget.extend(function (el, module, refereces, settings) {\n\t\tif (!refereces) {\n\t\t\tthrow \"You must supply epaper content!\";\n\t\t}\n\t\tvar me = this;\n\n\t\tme._refereces = refereces;\n\t\tme._settings = $.extend(true, defaults, settings);\n\n\t\tme[PROP_ANIMATING_TOGGLE] = false;\n\n\t\tthis.renderDfd = when.defer();\n\t\tthis.renderDfd.promise.then(function (content) {\n\t\t\trender.call(me, content);\n\t\t});\n\t}, {\n\t\t\"hub:memory/course-property/load/courseTypeCode\": function updateCourseCodeType() {\n\t\t\tcheckAndReadyEpaper.call(this);\n\t\t},\n\t\t\"sig/start\": function epaperStart() {\n\t\t\tvar me = this;\n\t\t\tcheckAndReadyEpaper.call(me);\n\t\t},\n\t\t\"sig/stop\": function epaperStop() {\n\t\t\tclearTimeout(this._timeout);\n\t\t\t//Stop the currently-running animation on the matched elements.\n\t\t\t/*\n\t\t\t *\t.stop( [clearQueue ] [, jumpToEnd ] )\n\t\t\t */\n\t\t\t$epBody && $epBody.stop(true, true);\n\t\t},\n\t\t\"dom:.ets-act-ep-handler/touchstart\": function handlerClick($event) {\n\t\t\t$event.preventDefault();\n\t\t\ttoggleExpandContent.call(this, true);\n\t\t},\n\t\t\"dom:.ets-act-ep-handler/click\": function handlerClick($event) {\n\t\t\t$event.preventDefault();\n\t\t\ttoggleExpandContent.call(this, true);\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/question-number/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-wgt-qs\\\">\\n    <p class=\\\"ets-wgt-qs-desc\\\" data-weave='troopjs-ef/blurb/widget' data-blurb-id='467836' data-text-en='question'></p>\\n    <ul class=\\\"ets-wgt-qs-index\\\">\\n        <li class=\\\"ets-wgt-qs-index-left\\\">\\n            <ul><li class=\\\"ets-wgt-qs-num\\\">\" +data._preIndex.charAt(0)+ \"</li>\\n            \";if(data._curIndex.charAt(0) != data._preIndex.charAt(0)){o += \"\\n                <li class=\\\"ets-wgt-qs-num ets-wgt-qs-num-cur\\\">\" +data._curIndex.charAt(0)+ \"</li>\\n            \";}o += \"\\n            </ul>\\n        </li>\\n        <li class=\\\"ets-wgt-qs-index-right\\\">\\n            <ul><li class=\\\"ets-wgt-qs-num\\\">\" +data._preIndex.charAt(1)+ \"</li>\\n            \";if(data._curIndex.charAt(1) != data._preIndex.charAt(1)){o += \"\\n                <li class=\\\"ets-wgt-qs-num ets-wgt-qs-num-cur\\\">\" +data._curIndex.charAt(1)+ \"</li>\\n            \";}o += \"\\n            </ul>\\n        </li>\\n    </ul>\\n    <span class=\\\"ets-wgt-qs-split\\\"></span>\\n    <ul class=\\\"ets-wgt-qs-total\\\">\\n        <li class=\\\"ets-wgt-qs-num\\\">\" +data._total.charAt(0)+ \"</li>\\n        <li class=\\\"ets-wgt-qs-num\\\">\" +data._total.charAt(1)+ \"</li>\\n    </ul>\\n</div>\"; return o; }; });\n",
    "define('school-ui-activity/shared/question-number/main',[\n\t'jquery',\n\t'troopjs-ef/component/widget',\n\t\"template!./main.html\"\n], function mpaMain($, Widget, tQn) {\n    \"use strict\";\n    var SEL_MAIN = '.ets-wgt-qs',\n        SEL_LEFT_NUM = '.ets-wgt-qs-index-left',\n        SEL_RIGHT_NUM = '.ets-wgt-qs-index-right',\n        STR_MASK = '0';\n\n\tfunction render() {\n        var me = this,\n            $ROOT = me.$element;\n        $ROOT.find(SEL_MAIN).hide();\n\t\treturn me\n\t\t\t.html(tQn, me._json)\n\t\t\t.tap(onRendered.bind(me));\n    }\n    function hideQuestionNumber() {\n        var me = this,\n            $ROOT = me.$element;\n        if($ROOT == null || $ROOT.length === 0){\n            return;\n        }\n        $ROOT.find(SEL_MAIN).stop().delay(800).fadeOut();\n    }\n    function onRendered() {\n        var me = this,\n            $ROOT = me.$element;\n        $ROOT.stop().fadeIn(500,function () {\n\t\t\tvar rightNumbers = $ROOT.find(SEL_RIGHT_NUM).find('li');\n                if (rightNumbers.length > 1) {\n                    rightNumbers.eq(0).delay(100).animate({\n                        marginTop : -rightNumbers.eq(0).height()\n                    }, function () {\n                        var leftNumbers = $ROOT.find(SEL_LEFT_NUM).find('li');\n                        if (leftNumbers.length > 1) {\n                            leftNumbers.eq(0).delay(100).animate({\n                                marginTop : -leftNumbers.eq(0).height()\n                            }, function () {\n                                hideQuestionNumber.call(me);\n                            });\n                        } else {\n                            hideQuestionNumber.call(me);\n                        }\n                    });\n                }\n        });\n\t}\n    return Widget.extend({\n\t\t\"sig/render\": function onRender() {\n\t\t\treturn render.call(this);\n        },\n\t\t'hub/activity/step/render': function onQuestionNumberLoad(currentIndex, total) {\n            if(!(total > 1)){\n                return;\n            }\n            currentIndex++;\n            var me = this;\n            me._json = me._json || {};\n            var data = me._json;\n            data._total = total;\n            data._total = data._total < 10 ? (data._total = STR_MASK + data._total):(data._total = data._total.toString());\n            data._preIndex = currentIndex - 1;\n            data._preIndex < 10 ? (data._preIndex = STR_MASK + data._preIndex) : (data._preIndex = data._preIndex.toString());\n            currentIndex < 10 ? (data._curIndex = STR_MASK + currentIndex) : (data._curIndex = currentIndex.toString());\n\t\t\treturn me.signal('render');\n        }\n    });\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/rolling-number/rolling-number.html',[],function() { return function template(data) { var o = \"<ul class=\\\"ets-ar-tp\\\">\\r\\n\\t<li class=\\\"ets-ar-tp-left\\\">\\r\\n\\t\\t<ul><li class=\\\"ets-ar-num ets-ar-num-left\\\" data=\\\"0\\\" data-at-id=\\\"lbl-remaining-left\\\">0</li></ul>\\r\\n\\t</li>\\r\\n\\t<li class=\\\"ets-ar-tp-right\\\">\\r\\n\\t\\t<ul><li class=\\\"ets-ar-num ets-ar-num-right\\\" data=\\\"0\\\" data-at-id=\\\"lbl-remaining-right\\\">0</li></ul>\\r\\n\\t</li>\\r\\n</ul>\\r\\n<span class=\\\"ets-ar-title\\\" data-weave=\\\"troopjs-ef/blurb/widget\\\" data-blurb-id=\\\"464921\\\" data-text-en=\\\"Answers Remaining\\\"></span>\"; return o; }; });\n",
    "define('school-ui-activity/shared/rolling-number/main',[\n\t'jquery',\n\t'poly',\n\t'when',\n\t'troopjs-ef/component/widget',\n\t\"template!./rolling-number.html\"\n], function ActivityBaseModule($, poly, when, Widget, tTemplate) {\n\t\"use strict\";\n\n\t// declaire variables\n\tvar defaults = {\n\t\tlength: 2,\n\t\tstep: 1,\n\t\tmax: 99,\n\t\tmin: 0,\n\t\ttype: \"gray\", // \"gray\" | \"white\"\n\t\taction: \"set\"\n\t};\n\n\tvar CLS_AR_NUM = \"ets-ar-num\",\n\t\tCLS_AR_NUM_LEFT = \"ets-ar-num-left\",\n\t\tCLS_AR_NUM_RIGHT = \"ets-ar-num-right\";\n\n\tvar SEL_AR_NUM_LEFT = \".\" + CLS_AR_NUM_LEFT,\n\t\tSEL_AR_NUM_RIGHT = \".\" + CLS_AR_NUM_RIGHT,\n\t\tSEL_AR_TIP_LEFT_UI = \".ets-ar-tp-left ul\",\n\t\tSEL_AR_TIP_RIGHT_UI = \".ets-ar-tp-right ul\";\n\n\t//init rolling for set action\n\tfunction initRolling() {\n\t\tvar targetNum = this._targetNumber,\n\t\t\tme = this,\n\t\t\t$el = me.$element;\n\t\t//todo: need refactor to more generic\n\t\t$el.find(SEL_AR_TIP_LEFT_UI).html('<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_LEFT + '\" data=\"' + Math.floor(targetNum / 10) + '\">' + Math.floor(targetNum / 10) + '</li>');\n\t\t$el.find(SEL_AR_TIP_RIGHT_UI).html('<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_RIGHT + '\" data=\"' + targetNum % 10 + '\">' + targetNum % 10 + '</li>');\n\n\t\t$el.find(SEL_AR_NUM_LEFT).attr(\"data-at-id\", \"lbl-remaining-left\");\n\t\t$el.find(SEL_AR_NUM_RIGHT).attr(\"data-at-id\", \"lbl-remaining-right\");\n\t}\n\n\t//update rolling for sub,add,reset\n\tfunction updateRolling() {\n\t\tvar currNum = this._currentNum,\n\t\t\tstep = this._step,\n\t\t\ttargetNum = this._targetNumber,\n\t\t\tcurrNumLeft = Math.floor(currNum / 10),\n\t\t\ttargetNumLeft = Math.floor(targetNum / 10),\n\t\t\ttargetNumRight = targetNum % 10,\n\t\t\tiNumRight = 0,\n\t\t\tnumListLeft = '',\n\t\t\tnumListRight = '',\n\t\t\tactValue = 0,\n\t\t\taniLeftValue = 0,\n\t\t\taniRightValue = 0,\n\t\t\tduration = 150,\n\t\t\tme = this,\n\t\t\t$el = me.$element;\n\n\t\tif (currNum < this._settings.min) return;\n\n\t\tvar i, j;\n\t\tif (targetNum >= currNum) {\n\t\t\tactValue = -24;\n\t\t\tif (targetNumLeft !== currNumLeft) {\n\t\t\t\tfor (j = targetNumLeft; j > currNumLeft; j--) {\n\t\t\t\t\tnumListLeft += '<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_LEFT + '\" data=\"' + j + '\">' + j + '</li>';\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i = targetNum; i > currNum; i--) {\n\t\t\t\tiNumRight = i % 10;\n\t\t\t\tnumListRight += '<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_RIGHT + '\" data=\"' + iNumRight + '\">' + iNumRight + '</li>';\n\t\t\t}\n\t\t\tif (numListLeft !== \"\") {\n\t\t\t\t$(numListLeft).insertBefore(SEL_AR_NUM_LEFT);\n\t\t\t\t$el.find(SEL_AR_TIP_LEFT_UI).css('margin-top', actValue * (targetNumLeft - currNumLeft) + 'px');\n\t\t\t}\n\t\t\t$(numListRight).insertBefore(SEL_AR_NUM_RIGHT);\n\t\t\t$el.find(SEL_AR_TIP_RIGHT_UI).css('margin-top', actValue * step + 'px');\n\t\t\taniRightValue = aniLeftValue = '0px';\n\t\t} else {\n\t\t\tactValue = 24;\n\n\t\t\tif (targetNumLeft !== currNumLeft) {\n\t\t\t\tfor (j = currNumLeft - 1; j >= targetNumLeft; j--) {\n\t\t\t\t\tnumListLeft += '<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_LEFT + '\" data=\"' + j + '\">' + j + '</li>';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = currNum - 1; i >= targetNum; i--) {\n\t\t\t\tiNumRight = i % 10;\n\t\t\t\tnumListRight += '<li class=\"' + CLS_AR_NUM + ' ' + CLS_AR_NUM_RIGHT + '\" data=\"' + iNumRight + '\">' + iNumRight + '</li>';\n\t\t\t}\n\t\t\tif (numListLeft !== \"\") {\n\t\t\t\t$(numListLeft).insertAfter(SEL_AR_NUM_LEFT);\n\t\t\t}\n\t\t\t$(numListRight).insertAfter(SEL_AR_NUM_RIGHT);\n\t\t\taniLeftValue = -(currNumLeft - targetNumLeft) * actValue + 'px';\n\t\t\taniRightValue = -step * actValue + 'px';\n\t\t}\n\n\t\t$el.find(SEL_AR_NUM_LEFT).attr(\"data-at-id\", \"lbl-remaining-left\");\n\t\t$el.find(SEL_AR_NUM_RIGHT).attr(\"data-at-id\", \"lbl-remaining-right\");\n\n\t\t//left num and right num animation\n\t\tvar numLSwitch = function () {\n\t\t\tif (!numListLeft) {\n\t\t\t\treturn when.resolve();\n\t\t\t}\n\n\t\t\tvar $elToRemove = $el.find(SEL_AR_NUM_LEFT).not($el.find(SEL_AR_NUM_LEFT + \"[data='\" + targetNumLeft + \"']\").first());\n\t\t\treturn when.promise(function (resolve) {\n\t\t\t\t$el.find(SEL_AR_TIP_LEFT_UI).animate({\n\t\t\t\t\t'margin-top': aniLeftValue\n\t\t\t\t}, duration, function () {\n\t\t\t\t\t$elToRemove.remove();\n\t\t\t\t\t$elToRemove = null;\n\t\t\t\t\t$el.find(SEL_AR_TIP_LEFT_UI).css('margin-left', '0px');\n\t\t\t\t\t$el.find(SEL_AR_TIP_LEFT_UI).css('margin-top', '0px');\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\tvar numRSwitch = function () {\n\t\t\tvar $elToRemove = $el.find(SEL_AR_NUM_RIGHT).not($el.find(SEL_AR_NUM_RIGHT + \"[data='\" + targetNumRight + \"']\").first());\n\t\t\treturn when.promise(function (resolve) {\n\t\t\t\t$el.find(SEL_AR_TIP_RIGHT_UI).animate({\n\t\t\t\t\t'margin-top': aniRightValue\n\t\t\t\t}, duration, function () {\n\t\t\t\t\t$elToRemove.remove();\n\t\t\t\t\t$elToRemove = null;\n\t\t\t\t\t$el.find(SEL_AR_TIP_RIGHT_UI).css('margin-top', '0px');\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\treturn when.all([numLSwitch(), numRSwitch()]);\n\t}\n\n\treturn Widget.extend(function (el, module, settings) {\n\t\tthis._settings = $.extend({}, defaults, settings);\n\t\tthis._targetNumber = this._settings.min;\n\t\tthis._step = this._settings.step;\n\t\tthis._currentNum = this._targetNumber;\n\t\tthis._settings.type === \"white\" && el.addClass(\"ets-ar-white\");\n\n\t}, {\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this;\n\t\t\treturn me.html(tTemplate, me._settings)\n\t\t\t\t.tap(initRolling.bind(this));\n\t\t},\n\t\t\"dom/rolling-number/switch-answers-num\": function ($event, options) {\n\t\t\tvar promise = null;\n\t\t\tvar sets = this._settings;\n\t\t\tvar action = options.action;\n\t\t\tvar step = options.step;\n\t\t\tthis._step = step;\n\n\t\t\t// 1. do operation based on 'key', sub,add,set,reset\n\t\t\tswitch (action.toLowerCase()) {\n\t\t\t\tcase \"add\":\n\t\t\t\t\tif (this._targetNumber + step <= sets.max) {\n\t\t\t\t\t\tthis._targetNumber += step;\n\t\t\t\t\t\tpromise = updateRolling.call(this);\n\t\t\t\t\t\tthis._currentNum = this._targetNumber;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"sub\":\n\t\t\t\t\tif (this._targetNumber - step >= sets.min) {\n\t\t\t\t\t\tthis._targetNumber -= step;\n\t\t\t\t\t\tpromise = updateRolling.call(this);\n\t\t\t\t\t\tthis._currentNum = this._targetNumber;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"set\":\n\t\t\t\t\tif (step >= sets.min && step <= sets.max) {\n\t\t\t\t\t\tthis._targetNumber = step;\n\t\t\t\t\t\tpromise = updateRolling.call(this);\n\t\t\t\t\t\tthis._currentNum = this._targetNumber;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"reset\":\n\t\t\t\t\tthis._targetNumber += step;\n\t\t\t\t\tthis._currentNum = this._targetNumber;\n\t\t\t\t\tinitRolling.call(this);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn promise || when.resolve();\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/summary/summary.html',[],function() { return function template(data) { var o = \"\";\n\tvar blurb = function(id,en){\n\t    var res = \"data-weave='troopjs-ef/blurb/widget' data-blurb-id='\"+id+\"' data-text-en='\"+en+\"'\";\n\t    return res;\n\t};\no += \"\\n<div class=\\\"ets-act-summary\\\">\\n\\t<div class=\\\"ets-act-summary-main ets-cf\\\">\\n\\t\\t<div class=\\\"ets-act-summary-main-correct\\\">\\n\\t\\t\\t<div class=\\\"ets-act-summary-num-correct\\\">\" +data.correctNum+ \"</div>\\n\\t\\t\\t<br>\\n\\t\\t\\t<h4 class=\\\"ets-correct\\\"><span \" +blurb(480845,\"correct answers\")+ \"></span></h4>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"ets-act-summary-main-skipped\\\">\\n\\t\\t\\t<div class=\\\"ets-act-summary-num-skipped\\\">\" +data.skippedNum+ \"</div>\\n\\t\\t\\t<br>\\n\\t\\t\\t<h4 class=\\\"ets-skipped\\\"><span \" +blurb(480846,\"skipped answers\")+ \"></span></h4>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"ets-act-summary-result\\\" >\\n\\t\\t\";if (data.passed) {o += \"\\n\\t\\t<h2><span \" +blurb(480844,\"Result\")+ \"></span>: <span class=\\\"ets-pass\\\" data-at-id='lbl-result-state-message' \" +blurb(461315,\"Passed\")+ \"></span></h2>\\n\\t\\t\";} else {o += \"\\n\\t\\t<h2><span \" +blurb(480844,\"Result\")+ \"></span>: <span class=\\\"ets-fail\\\" data-at-id='lbl-result-state-message' \" +blurb(461316,\"Not passed\")+ \"></span></h2>\\n\\t\\t<p><span data-at-id='lbl-result-need-passed-message' \" +blurb(465093,\"you need\")+ \" data-values='{\\\"number\\\":\" + data.passNum+ \"}' ></span></p>\\n\\t\\t\";}o += \"\\n\\t</div>\\n</div>\"; return o; }; });\n",
    "// # Activity summary\n\ndefine('school-ui-activity/shared/summary/main',['jquery', 'compose', 'underscore',\n    'troopjs-ef/component/widget',\n    'template!./summary.html'\n], function summaryModule($, Compose, _, Widget, tTemplate) {\n    \"use strict\";\n\n    function Ctor(el, module, settings){\n        this._content = settings;\n    }\n\n    function render(){\n        var me = this;\n\n        if (!me.$element){\n            return;\n        }\n\n        return me.html(tTemplate, me._content);\n    }\n\n    var methods = {\n        \"sig/start\": function onStart() {\n            return render.call(this);\n        }\n    };\n\n    return Widget.extend(Ctor, methods);\n});\n",
    "/**\n * value change event for input or textarea,still has bug on IE9, can't detect delete with contextmenu immediately\n */\ndefine('school-ui-activity/shared/textchange/main',[\n\t'jquery',\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/utils/browser-check\"\n], function ($, Widget, browserCheck) {\n\t\"use strict\";\n\n\tvar IS_IE = browserCheck.browser === \"msie\";\n\tvar BROWSER_VERSION = parseInt(browserCheck.version, 10);\n\n\tvar EVT_TXTCHANGE = (function () {\n\t\t\tif (!IS_IE) {\n\t\t\t\treturn \"input\";\n\t\t\t} else {\n\t\t\t\tif (BROWSER_VERSION < 9) {\n\t\t\t\t\treturn \"propertychange keyup\";\n\t\t\t\t} else if (BROWSER_VERSION === 9) {\n\t\t\t\t\t/**\n\t\t\t\t\t * for ie9, propertychange and input exist bugs.\n\t\t\t\t\t * propertychange can only work with attachEvent\n\t\t\t\t\t * input can't detect value change set by js\n\t\t\t\t\t * propertychange and input can't detect:\n\t\t\t\t\t * 1.backspace with keyboard    : use keydown and keyCode to detect\n\t\t\t\t\t * 2.delete with keyboard       : use keydown and keyCode to detect\n\t\t\t\t\t * 3.delete with contextmenu    : disable contextmenu on input element\n\t\t\t\t\t * 4.cut                        : use cut to detect\n\t\t\t\t\t * 5.ctrl+Z/ctrl+Y              : use keydown and keyCode to detect\n\t\t\t\t\t * 6.drag out                   : use change to detect\n\t\t\t\t\t * 7.will trigger many times with multiple lines' paste : can't resolve\n\t\t\t\t\t */\n\t\t\t\t\treturn \"keydown cut change\";\n\t\t\t\t} else {\n\t\t\t\t\treturn \"input propertychange\";\n\t\t\t\t}\n\t\t\t}\n\t\t})(),\n\t\tEVT_CUSTOMER_TEXT_CHANGE = 'EFTextChange',\n\t\tUNDEFINED;\n\n\t/**\n\t * Check event whether need to trigger textchange event\n\t */\n\tfunction filterEvent(e) {\n\t\tvar orge = e.originalEvent;\n\t\tif (orge === UNDEFINED) {\n\t\t\treturn;\n\t\t}\n\t\tif (IS_IE && BROWSER_VERSION === 9) {\n\t\t\t/** For keydown event, only need to trigger value change when:\n\t\t\t * DELETE/BACKSPACE\n\t\t\t * CTRL+Z/CTRL+Y\n\t\t\t **/\n\t\t\tif (orge.type === 'keydown'\n\t\t\t\t&& !(orge.keyCode == 0x2E || orge.keyCode == 0x8)\n\t\t\t\t&& !(orge.ctrlKey && (orge.keyCode == 90 || orge.keyCode == 89))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//Filter not value attribute change of propertychange\n\t\tif (orge.propertyName && orge.propertyName != 'value') {\n\t\t\treturn;\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction triggerChangeEvent($DOM) {\n\t\t//Use setTimeout to get real value, some events like paste|cut|ctrl+z|ctrl+y,can't get real value immediately\n\t\tsetTimeout(function () {\n\t\t\t$DOM.trigger(EVT_CUSTOMER_TEXT_CHANGE);\n\t\t}, 0);\n\t}\n\n\treturn Widget.extend({\n\t\t\"sig/initialize\": function onStart() {\n\t\t\tvar me = this,\n\t\t\t\t$ROOT = me.$element,\n\t\t\t\tdomEle = $ROOT.get(0);\n\t\t\tif (IS_IE && BROWSER_VERSION === 9) {\n\t\t\t\tdomEle.attachEvent && domEle.attachEvent(\"oncontextmenu\", function () {\n\t\t\t\t\treturn false;\n\t\t\t\t}) && domEle.attachEvent(\"onpropertychange\", function (e) {\n\t\t\t\t\tfilterEvent($.Event(e)) && triggerChangeEvent($ROOT);\n\t\t\t\t});\n\t\t\t}\n\t\t\t$ROOT.bind(EVT_TXTCHANGE, function (e) {\n\t\t\t\tfilterEvent(e) && triggerChangeEvent($ROOT);\n\t\t\t});\n\t\t}\n\t});\n});\n\n",
    "\ndefine('troopjs-requirejs/template!school-ui-activity/shared/tooltip/main.html',[],function() { return function template(data) { var o = \"<div class=\\\"ets-tooltip-content\\\">\\n</div>\\n<div class=\\\"ets-tooltip-footer\\\"></div>\"; return o; }; });\n",
    "define('school-ui-activity/shared/tooltip/main',[\n\t'jquery',\n\t'troopjs-ef/component/widget',\n\t\"school-ui-shared/utils/browser-check\",\n\t'template!./main.html'\n], function Tooltip($, Widget, browserCheck, tTemplate) {\n\t'use strict';\n\n\tvar $ELEMENT = '$element';\n\n\tvar SEL_CONTENT = '.ets-tooltip-content';\n\n\tvar CLS_IE8 = 'ets-tooltip-ie8';\n\n\tfunction render() {\n\t\tvar me = this;\n\t\treturn me.html(tTemplate)\n\t\t\t.then(function () {\n\t\t\t\tif (me._content.length) {\n\t\t\t\t\tme[$ELEMENT].find(SEL_CONTENT).prepend($(me._content));\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tfunction onRender() {\n\t\tvar me = this;\n\n\t\tif (browserCheck.browser === \"msie\") {\n\t\t\tif (parseInt(browserCheck.version, 10) <= 8) {\n\t\t\t\tme[$ELEMENT].addClass(CLS_IE8);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Widget.extend(function Ctor() {\n\t\tvar me = this;\n\t\tme._content = $.trim(me[$ELEMENT].html());\n\t}, {\n\t\t'sig/initialize': function onInitialize() {\n\t\t\treturn render.call(this);\n\t\t},\n\t\t'sig/start': function onStart() {\n\t\t\tonRender.call(this);\n\t\t}\n\t});\n});\n\n"
  ]
}