/*! campus-studyplan-ui - v2018.17.1-1 - 2018-05-09 03:58:05
* Copyright (c) 2018 DLA_HAO Team; Licensed  */
define("campus-studyplan-ui/service/load",["troopjs-ef/component/service"],function(e){"use strict";return e.extend({displayName:"campus-studyplan-ui/service/load","hub/school/interface/studyplan/cp20-container-widget":function(){var e=this;return e.query("ocb_context!curent",'member_site_setting!"school;student.evc.version"').spread(function(e,t){if(e&&e.enable){var n=!t||!t.value||parseFloat(t.value)<2;return n?["campus-studyplan-ui/widget/pl-legacy/cp20"]:["campus-studyplan-ui/widget/pl/cp20"]}})},"hub/school/interface/studyplan/cp20-locked-widget":function(){var e=this;return e.query("ocb_context!curent").spread(function(e){return e&&e.enable?["campus-studyplan-ui/widget/pl-locked/main"]:void 0})},"hub/school/interface/studyplan/pl-container-widget":function(){var e=this;return e.query("ocb_context!curent",'member_site_setting!"school;student.evc.version"').spread(function(e,t){if(e&&e.enable){var n=!t||!t.value||parseFloat(t.value)<2;return n?["campus-studyplan-ui/widget/pl-legacy/pl"]:["campus-studyplan-ui/widget/pl/pl"]}})}})}),define("requirejs-text/text",["module"],function(e){"use strict";var t,n,a,s,i,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,p=c&&(location.port||void 0),m={},v=e.config&&e.config()||{};return t={version:"2.0.9",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(a){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,a,s=!1,i=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==i&&(!o||i>1)?(t=e.substring(0,i),n=e.substring(i+1,e.length)):t=e,a=n||t,i=a.indexOf("!"),-1!==i&&(s="strip"===a.substring(i+1),a=a.substring(0,i),n?n=a:t=a),{moduleName:t,ext:n,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,a,s){var i,o,r,l=t.xdRegExp.exec(e);return l?(i=l[2],o=l[3],o=o.split(":"),r=o[1],o=o[0],!(i&&i!==n||o&&o.toLowerCase()!==a.toLowerCase()||(r||o)&&r!==s)):!0},finishLoad:function(e,n,a,s){a=n?t.strip(a):a,v.isBuild&&(m[e]=a),s(a)},load:function(e,n,a,s){if(s.isBuild&&!s.inlineText)return void a();v.isBuild=s.isBuild;var i=t.parseName(e),o=i.moduleName+(i.ext?"."+i.ext:""),r=n.toUrl(o),l=v.useXhr||t.useXhr;!c||l(r,d,u,p)?t.get(r,function(n){t.finishLoad(e,i.strip,n,a)},function(e){a.error&&a.error(e)}):n([o],function(e){t.finishLoad(i.moduleName+"."+i.ext,i.strip,e,a)})},write:function(e,n,a,s){if(m.hasOwnProperty(n)){var i=t.jsEscape(m[n]);a.asModule(e+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,n,a,s,i){var o=t.parseName(n),r=o.ext?"."+o.ext:"",l=o.moduleName+r,c=a.toUrl(o.moduleName+r)+".js";t.load(l,a,function(n){var a=function(e){return s(c,e)};a.asModule=function(e,t){return s.asModule(e,c,t)},t.write(e,l,a,i)},i)}},"node"===v.env||!v.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,a){try{var s=n.readFileSync(e,"utf8");0===s.indexOf("\ufeff")&&(s=s.substring(1)),t(s)}catch(i){a(i)}}):"xhr"===v.env||!v.env&&t.createXhr()?t.get=function(e,n,a,s){var i,o=t.createXhr();if(o.open("GET",e,!0),s)for(i in s)s.hasOwnProperty(i)&&o.setRequestHeader(i.toLowerCase(),s[i]);v.onXhr&&v.onXhr(o,e),o.onreadystatechange=function(t){var s,i;4===o.readyState&&(s=o.status,s>399&&600>s?(i=new Error(e+" HTTP status: "+s),i.xhr=o,a(i)):n(o.responseText),v.onXhrComplete&&v.onXhrComplete(o,e))},o.send(null)}:"rhino"===v.env||!v.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,a,s="utf-8",i=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),s)),l="";try{for(n=new java.lang.StringBuffer,a=r.readLine(),a&&a.length()&&65279===a.charAt(0)&&(a=a.substring(1)),null!==a&&n.append(a);null!==(a=r.readLine());)n.append(o),n.append(a);l=String(n.toString())}finally{r.close()}t(l)}:("xpconnect"===v.env||!v.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(a=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),i="@mozilla.org/windows-registry-key;1"in a,t.get=function(e,t){var n,o,r,l={};i&&(e=e.replace(/\//g,"\\")),r=new FileUtils.File(e);try{n=a["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(r,1,0,!1),o=a["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),o.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),l),o.close(),n.close(),t(l.value)}catch(c){throw new Error((r&&r.path||"")+": "+c)}}),t}),define("troopjs-requirejs/shadow",["text"],function(e){"use strict";function t(e,t){for(var n,a=/([^=&]+)=([^&]+)/g,i=[],o=[];t&&(n=a.exec(t));)n[1]===s?e+=";\nreturn "+n[2]+";\n":(i.push("'"+n[2]+"'"),o.push(n[1]));return"define([ "+i.join(", ")+" ], function ("+o.join(", ")+") {\n"+e+"});"}function n(e,t){var n,a,s;for(e=e.split("."),t=t.split("."),a=Math.min(e.length,t.length),s=0;a>s;s++)if(n=parseInt(e[s])-parseInt(t[s]),0!==n)return n;return e.length-t.length}var a,s="exports",i=".js",o=/(.+?)#(.+)$/,r=/^empty:/,l=require.version,c={};return{load:function(s,d,u,p){var m,v,b,f;(m=o.exec(s))&&(s=m[1],v=m[2]),f=d.toUrl(s+i),r.test(f)?u(a):e.get(f,function(e){b=t(e,v),p.isBuild&&(c[s]=b),u.fromText(s,b),n(l,"2.1.0")<0&&d([s],u)})},write:function(t,n,a){var s,i;(s=o.exec(n))&&(n=s[1]),n in c&&(i=e.jsEscape(c[n]),a.asModule(t+"!"+n,i))}}}),define("campus-studyplan-ui/utils/fancybox",["lodash","shadow!jquery.fancybox#$=jquery&jQuery=jquery&exports=jQuery"],function(e,t){"use strict";var n={wrapCSS:"csu-fancybox",helpers:{overlay:{closeClick:!1,css:{backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVQYGe3KMREAAAjDQMC/TmyEq4NOTM2Q6RvYMhrtDwYeQfQD9/w1y0kAAAAASUVORK5CYII=)"}}}};return{open:function(a){t.fancybox.open(e.assign(n,a))},close:function(){t.fancybox.close()}}}),define("campus-studyplan-ui/utils/language-code",{ar:"ar",ch:"zh-tw",cs:"zh-cn",en:"en",es:"es",fr:"fr",ge:"de",hk:"zh-tw","in":"id",it:"it",ja:"ja",ko:"ko",pt:"pt",ru:"ru",sp:"es",th:"th",tr:"tr"}),define("campus-studyplan-ui/utils/member-site-setting",["troopjs-ef/component/widget","lodash"],function(e,t){"use strict";var n={FirstTimeStudyPlanPL:{siteArea:"evc",keyCode:"FirstTimeStudyPlanPL"},FirstTimeStudyPlanCP20:{siteArea:"evc",keyCode:"FirstTimeStudyPlanCP20"},UnlockedPLs:{siteArea:"OCB",keyCode:"UnlockedPLs"}};return e.extend(function(e,t,n){},{getMemberSiteSetting:function(e){var t=this,a="member_site_setting!"+n[e].siteArea+";"+n[e].keyCode;return t.query(a).spread(function(e){return e})},saveMemberSiteSetting:function(e,t){var a=this;return a.publish("school/member_site_setting/Save",{siteArea:n[e].siteArea,keyCode:n[e].keyCode,keyValue:t})}})}),define("campus-studyplan-ui/utils/time-format",{START_TIME:"dddd DD MMMM, HH:mm",CANCEL_TIME:"HH:mm, dddd MMMM Do"}),define("campus-studyplan-ui/utils/momentize",["moment","./language-code","./time-format"],function(e,t,n){"use strict";return function(a,s,i){var o;return o="object"==typeof a?e().year(a.year).month(a.month-1).date(a.day).hour(a.hour).minute(a.minute).second(a.second):e(a),s&&o.lang(t[s]),i?o.format(n[i]||i):o}}),define("campus-studyplan-ui/utils/vml",[],function(){return document.namespaces&&!document.namespaces.vml&&document.namespaces.add("vml","urn:schemas-microsoft-com:vml")}),define("campus-studyplan-ui/utils/widgetCreator",["jquery","lodash"],function(e,t){"use strict";function n(e,n,a){var s;return t.isEmpty(n)?a:(s="data"+t.size(e.data()),e.data(s,n),a+"("+s+")")}return function(a){var s=e("<div>"),i=t.mapKeys(a,t.partial(n,s));return s.attr("data-weave",t.keys(i).join(" "))}}),define("campus-studyplan-ui/widget/blurb",["troopjs-ef/blurb/widget"],function(e){"use strict";return e.extend({text:e.prototype.html})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/attended/main.html",[],function(){return function(e){var t='<div class="csu-pl-attended">\n	<div class="csu-pl-container">\n		<div class="csu-pl-lead csu-pl-lead-with-time text-center">\n			<div>\n				<span class="glyphicon glyphicon-passed"></span>\n			</div><!--\n			--><div>\n				<div class="h4" data-blurb-id="676306" data-weave="troopjs-ef/blurb/widget"></div>\n				<div class="csu-pl-class-time">'+e.startTime+'</div>\n			</div>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n							</h4>\n							<div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="csu-pl-status-info-title h4 csu-pl-status-info-title-highlight" data-blurb-id="675996" data-weave="troopjs-ef/blurb/widget"></p>\n						<div>\n							<a class="btn btn-primary btn-feedback-details" data-blurb-id="675997" data-weave="troopjs-ef/blurb/widget"></a>\n						</div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl-legacy/attended/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash","client-tracking"],function(e,t,n,a,s){"use strict";function i(e,t){return o[e]+t}var o={cp20:"/school/progressreport#teacher-feedback?fb_id=CP20_",pl:"/school/progressreport#teacher-feedback?fb_id=PL_"};return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.bookedClass&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.bookedClass.customizedStartTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))},"dom:.btn-feedback-details/click":function(){var e=this;s.useraction({"action.viewFeedBack":1}),window.open(i(e.options.topic.classType,e.options.feedback.feedbackId))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/main.html",[],function(){return function(e){var t='<div class="campus-studyplan-ui">\n	<div class="csu-notification" data-weave="school-ui-studyplan/widget/gl-pl/announcement/'+e.topic.classType+'"></div>\n	<div data-weave="campus-studyplan-ui/widget/pl-legacy/'+e.statusCode+"/main(options) campus-studyplan-ui/widget/tracking\" data-options='"+JSON.stringify(e).replace(/\'/g,"&#39;")+"'></div>\n</div>";return t}}),define("campus-studyplan-ui/widget/pl-legacy/base",["troopjs-ef/component/widget","template!./main.html","school-ui-studyplan/module","jquery","lodash","when","../../utils/member-site-setting","client-tracking","../../utils/vml"],function(e,t,n,a,s,i,o,r){"use strict";function l(e,t,n){return e=(e||"").replace(/{unitId}/i,t),n&&(e=e.replace(/{classId}/i,n)),e}function c(e,t,n,a){var s=m[t];return e?{booking:l(e[s.BOOKING],n),entering:l(e[s.ENTERING],n,a)}:void 0}function d(e,t){var n=e&&e.split(",");return s.contains(n,t+"")}function u(e){var t=n.config().cacheServer;return e?t+"/_imgs/evc/pl/topic/238x238/"+e:t+"/_imgs/evc/pl/pl_default_100x100.png"}var p={UNLOCKED:"UnlockedPLs"},m={pl:{BOOKING:"SPPL40BookingV2",ENTERING:"SPPL40Entering"},cp20:{BOOKING:"CP20BookingV2",ENTERING:"CP20Entering"}},v={WELCOME:"welcome",UNLOCKED:"unlocked",NEVER_TAKE:"nevertake",NO_COUPON_LEFT:"nocouponleft"};return e.extend(function(e,t,n){var a=this;a.deferredFeature=i.defer()},{"sig/start":function(){r.pagename("One-Click PL")},"hub:memory/load/unit":function(e){var n,a=this,i="cp20"===a.options.classType;e&&e.legacyUnitId&&a.query(a.options.serviceAPI+e.legacyUnitId,"evc_url_resource!current",a.deferredFeature.promise,i?a.getMemberSiteSetting(p.UNLOCKED):void 0,"campus_mypage_isf2fstudent!current").spread(function(i,o,r,l,p){var m=i&&i.bookedClass&&i.bookedClass.classId;i&&i.topic&&(n=s.clone(i,!0),n.statusCode=n.statusCode.toLowerCase(),n.feature=r,n.evcUrls=c(o&&o.studyPlanUrls,a.options.classType,e.legacyUnitId,m),n.topic={courseUnitId:e.legacyUnitId,title:i.topic.topicBlurbId||i.topic.topicBlurb,description:i.topic.descBlurbId||i.topic.descriptionBlurb,image:u(i.topic.imageUrl||i.topic.topicImageUrl),classType:a.options.classType},n.pastClass&&(n.bookedClass=n.pastClass),s.assign(n.bookedClass,{durationForStudent:a.options.durationMinutes}),n.statusCode===v.NEVER_TAKE?(n.feature&&n.feature.couponLeft<1&&(n.statusCode=v.NO_COUPON_LEFT),!l||d(l.value,n.topic.courseUnitId)||p.isF2fStudent||(n.statusCode=v.UNLOCKED)):n.statusCode===v.WELCOME&&(n.statusCode=v.NEVER_TAKE),a.html(t(n)))})}},o)}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/class-entrance/main.html",[],function(){return function(e){function t(){return e.disabled?"btn-disabled":"btn-primary"}var n="";return n+='\n\n<button type="button" class="btn btn-entrance '+t()+'" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675337">Enter class</button>'}}),define("campus-studyplan-ui/widget/pl-legacy/booked/class-status",{NOT_YET:"notyet",IN_COUNTDOWN:"incountdown",OPEN_SOON:"opensoon",STARTED:"started"}),define("campus-studyplan-ui/widget/pl-legacy/booked/class-entrance/main",["troopjs-ef/component/widget","template!./main.html","../class-status"],function(e,t,n){"use strict";function a(e){return e.replace("?","?showcontentonly=y&").replace("{source}",window.encodeURIComponent(window.location.href))}return e.extend(function(e,t,n){var a=this;a.url=n},{"sig/start":function(){},"hub/campus/studyplan/pl/status":function(e){var a=this;switch(e){case n.OPEN_SOON:a.html(t({disabled:!0}));break;case n.STARTED:a.html(t({disabled:!1}))}},"dom:.btn-primary.btn-entrance/click":function(){var e=this;window.open(a(e.url),"_self")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/class-status/main.html",[],function(){return function(e){var t='<p data-blurb-id="'+e.blurbId+'" data-weave="troopjs-ef/blurb/widget" class="csu-pl-status-info-title h4 '+e.className+'"></p>';return t}}),define("campus-studyplan-ui/widget/pl-legacy/booked/class-status/main",["troopjs-ef/component/widget","template!./main.html","../class-status"],function(e,t,n){"use strict";function a(e){switch(e){case n.STARTED:return 674823;case n.OPEN_SOON:return 674824;default:return 674825}}function s(e){switch(e){case n.STARTED:case n.OPEN_SOON:return"csu-pl-status-info-title-highlight";default:return""}}return e.extend(function(e,t,n){},{"sig/start":function(){},"hub/campus/studyplan/pl/status":function(e){var n=this;n.html(t({blurbId:a(e),className:s(e)}))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/countdown/main.html",[],function(){return function(e){var t="<div>\n	<div>%H<span>|</span></div>\n	<div>hour</div>\n</div><!--\n--><div>\n	<div>%M<span>|</span></div>\n	<div>min</div>\n</div><!--\n--><div>\n	<div>%S</div>\n	<div>sec</div>\n</div>";return t}}),define("campus-studyplan-ui/widget/pl-legacy/booked/countdown/main",["troopjs-ef/component/widget","template!./main.html","../class-status","jquery","moment","jquery.countdown"],function(e,t,n,a,s){"use strict";function i(e){return e>30*l?n.NOT_YET:1>e?n.STARTED:10*l>e?n.OPEN_SOON:n.IN_COUNTDOWN}var o=24,r=60,l=60,c=t();return e.extend(function(e,t,n){var a=this;a.service=n},{"sig/start":function(){var e=this;e.checkClassStatus().then(function(t){e.updateStatus(t),e.render()})},checkClassStatus:function(){var e,t=this,n=0;return t.query(t.service).spread(function(a){return e=a&&(a.countdown||a.countDown),e&&(n=e.secondsLeftForStart,t.finalDate=s().add(n,"seconds").format("YYYY/MM/DD HH:mm:ss")),i(n)})},updateStatus:function(e){var t=this;t.currentStatus=e,t.publish("campus/studyplan/pl/status",t.currentStatus)},render:function(){var e=this;e.currentStatus===n.STARTED?e.$element.remove():e.countdown()},countdown:function(){var e=this;e.$element.countdown(e.finalDate).on("update.countdown",function(t){var a=((t.offset.totalDays*o+t.offset.hours)*r+t.offset.minutes)*l+t.offset.seconds,s=i(a),d=s!==e.currentStatus,u=s===n.IN_COUNTDOWN||s===n.OPEN_SOON;d&&s!==n.STARTED&&e.updateStatus(s),u&&e.$element.html(t.strftime(c))}).on("finish.countdown",function(){e.checkClassStatus().then(function(t){e.updateStatus(t),e.render()})})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/main.html",[],function(){return function(e){var t='<div class="csu-pl-booked">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span class="glyphicon glyphicon-booked"></span>\n			<span data-blurb-id="568587" data-weave="troopjs-ef/blurb/widget">Class Booked</span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<div class="media-body-inner-wrapper">\n								<h4 class="media-heading text-uppercase">\n									<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n								</h4>\n								<div class="csu-pl-class-time">'+e.startTime+'</div>\n								<div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass).replace(/\'/g,"&#39;")+'\'></div>\n								<ul class="csu-pl-booked-links clearfix">\n									<li>\n										<a class="csu-pl-link csu-pl-link-cancel" data-weave="troopjs-ef/blurb/widget" data-blurb-id="568585" data-toggle="tooltip" data-placement="bottom" title="'+e.notice+'">Cancel you booking</a>\n									</li>\n									';return e.calendarReminderEnabled&&(t+='\n										<li>\n											<a class="csu-pl-link csu-pl-link-reminder" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675993">SAVE TO CALENDAR</a>\n										</li>\n									'),t+='\n								</ul>\n							</div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<div data-weave="campus-studyplan-ui/widget/pl-legacy/booked/countdown/main('+e.id+')" class="csu-pl-booked-countdown"></div>\n						<div data-weave="campus-studyplan-ui/widget/pl-legacy/booked/class-status/main"></div>\n						<div data-weave="campus-studyplan-ui/widget/pl-legacy/booked/class-entrance/main(url)" data-url="'+e.evcUrls.entering+'"></div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n		<div class="row">\n			<div class="col-xs-6 col-xs-offset-3">\n				<div class="csu-pl-sms-reminder" data-weave="campus-studyplan-ui/widget/pl-legacy/booked/sms-reminder/main('+e.id+')"></div>\n			</div>\n		</div>\n		<div class="cpbc-inner-wrapper">\n			<div class="h4 csu-pl-lead text-center">\n				<span class="glyphicon glyphicon-booked"></span>\n				<span data-blurb-id="568587" data-weave="troopjs-ef/blurb/widget">Class Booked</span>\n			</div>\n			<div class="csu-pl-class-panel">\n				<div class="csu-pl-class-media media clearfix">\n					<div class="pull-left">\n						<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n					</div>\n					<div class="media-body">\n						<h4 class="media-heading text-uppercase">\n							<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n						</h4>\n						<div class="csu-pl-class-time">'+e.startTime+'</div>\n						<div class="csu-pl-booked-reminder">\n							<div data-weave="troopjs-ef/blurb/widget" data-blurb-id="674463">Are you sure you want to cancel the class?</div>\n						</div>\n						<div class="csu-pl-booked-buttons">\n							<button type="button" class="btn btn-primary btn-pl-keep" data-weave="troopjs-ef/blurb/widget" data-blurb-id="674464">No, keep the class</button><!--\n							--><button type="button" class="btn btn-default btn-pl-cancel" data-weave="troopjs-ef/blurb/widget" data-blurb-id="674465">Yes, cancel the class</button>\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl-legacy/booked/main",["troopjs-ef/component/widget","template!./main.html","lodash","when","../../../utils/momentize","troopjs-ef/command/service","troopjs-data/cache/component","./class-status","../../../utils/widgetCreator","../../../utils/fancybox","client-tracking","moment"],function(e,t,n,a,s,i,o,r,l,c,d,u){"use strict";function p(e,t){var a=e.slice(0);return n.remove(a,function(e){return e===t+""}),a}var m,v={SUBBED_OUT_MESSAGE:{SITEAREA:"OCB",KEYCODE:"PLTeacherCancellationMessages"}},b="/school/evc/pl/outlook?class_id=",f="csu-pl-booked-cancellation",h="bookingCancelledBy_",g=window.localStorage,w=a.defer(),y=a.defer();return e.extend(function(e,t,n){var a=this;a.options=n,m||(m=new i("plbooking/cancel",new o),m.configure({url:"/services/school/command/plbooking/cancel",contentType:"application/json; charset=UTF-8",type:"post"}),m.start())},{"sig/start":function(){var e,a,i,o,r=this;r.query(w.promise,y.promise,"blurb!639584","member_site_setting!"+v.SUBBED_OUT_MESSAGE.SITEAREA+";"+v.SUBBED_OUT_MESSAGE.KEYCODE,'ccl!"School.EVC.Reminder.Switch"').spread(function(l,c,d,u,p){c&&c.member_id&&(r.member_id=c.member_id),e=l.languagecode.value.toLowerCase(),a=s(r.options.bookedClass.customizedStartTime,e,"START_TIME"),i=s(r.options.bookedClass.suggestedCancelTime,e,"CANCEL_TIME"),o=d.translation.replace("%%Canceltime%%",i).replace("%%timezone%%",r.options.bookedClass.timezoneId),r.html(t(n.assign({startTime:a,notice:o,calendarReminderEnabled:p&&"true"===p.value},r.options))).then(function(){r.$element.find(".csu-pl-link-cancel").tooltip(),r.$content=r.$element.find(".csu-pl-booked"),r.isSubbedOut=-1===r.options.bookedClass.teacherId,r.isSubbedOut&&(r.readMessages=u&&u.value?u.value.split(","):[],r.messageIsRead=n.contains(r.readMessages,r.options.bookedClass.classId+""),r.messageIsRead||r.showTeacherCancellationMessage())})})},"hub:memory/common_context":function(e){w.resolve(e&&e.values)},"hub:memory/context":function(e){y.resolve(e&&e.user)},"hub/campus/studyplan/pl/status":function(e){var t=this;e===r.STARTED&&t.$element.find(".csu-pl-booked-links").remove()},"dom:.csu-pl-link-cancel/click":function(){var e=this;e.toggleCancellation()},"dom:.csu-pl-link-reminder/click":function(){var e=this;window.open(b+e.options.bookedClass.classId,"_self")},"dom:.btn-pl-keep/click":function(){var e=this;e.toggleCancellation()},"dom:.btn-pl-cancel/click":function(){var e=this;d.useraction({"action.cancelClass":1}),e.$element.trigger("task",e.publish("plbooking/cancel",{class_id:e.options.bookedClass.classId}).spread(function(t){t[0].isSuccess&&(e.isSubbedOut&&e.messageIsRead&&e.saveSetting(p(e.readMessages,e.options.bookedClass.classId)),e.publish("studyplan/sequence/update"),e.publish("studyplan/sequence-container/reload"),g.setItem(h+e.options.topic.courseUnitId+e.member_id,"1#"+u().utc().format("YYYY-MM-DD HH:mm:ss")))}))},showTeacherCancellationMessage:function(){var e=this,t=l({"campus-studyplan-ui/widget/shared/alert/main":{title:677631,content:677503,action:677505}});t.weave().then(function(){c.open({content:t,afterClose:function(){e.saveSetting(e.readMessages.concat(e.options.bookedClass.classId))}})})},saveSetting:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:v.SUBBED_OUT_MESSAGE.SITEAREA,keyCode:v.SUBBED_OUT_MESSAGE.KEYCODE,keyValue:e.join(",")}).then(function(){t.readMessages=e})},toggleCancellation:function(){var e=this;e.$content.toggleClass(f)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/sms-reminder/main.html",[],function(){return function(e){var t='<form class="cpsr-input-form">\n	<p class="cpsr-notice">\n		<span data-blurb-id="677499" data-weave="troopjs-ef/blurb/widget" data-values=\'{ "hours": '+e.sendMsgXHoursBeforeClass+'}\'></span> <a data-blurb-id="132214" data-weave="troopjs-ef/blurb/widget" class="cpsr-privacy-policy" href=""></a>\n	</p>\n	<div>\n		<p class="cpsr-lead" data-blurb-id="677501" data-weave="troopjs-ef/blurb/widget"></p>\n		<div class="clearfix">\n			<div class="cpsr-mobile-number">\n				<input class="cpsr-mobile-number-input" style="padding-left: '+(e.phoneNumberCountryCode.length+2)/2+'em;" type="text" id="phoneNumber" name="phoneNumber">\n				<span class="cpsr-country-code">+'+e.phoneNumberCountryCode+'</span>\n			</div>\n			<div class="cpsr-request-reminder">\n				<button class="btn-link btn-link-request" type="submit"><span data-blurb-id="677502" data-weave="troopjs-ef/blurb/widget"></span> <span class="glyphicon glyphicon-arrow-primary"></span></button>\n			</div>\n		</div>\n	</div>\n</form>';return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/sms-reminder/filled-out.html",[],function(){return function(e){function t(){return e.hasSubscribed?"checked":""}var n="";return n+='\n<div class="cpsr-subscribe">\n	<div class="cpsr-subscribe-inner-wrapper">\n		<input class="cpsr-subscribe-checkbox"  type="checkbox" id="subscribe" '+t()+'>\n	</div>\n	<div class="cpsr-subscribe-inner-wrapper">\n		<label class="cpsr-subscribe-label" data-blurb-id="680354" data-weave="troopjs-ef/blurb/widget" data-values=\'{ "telephone": "+'+e.phoneNumber+"\" }'></label>\n	</div>\n</div>"}}),define("campus-studyplan-ui/widget/pl-legacy/booked/sms-reminder/main",["troopjs-ef/component/widget","template!./main.html","template!./filled-out.html","troopjs-ef/command/service","troopjs-data/cache/component","lodash","jquery","jquery.validate"],function(e,t,n,a,s,i,o){"use strict";function r(e){var t=i.pluck(e,"name"),n=i.pluck(e,"value");return i.zipObject(t,n)}var l,c=18e3;return e.extend(function(e,t,n){var i=this;i.serivce=n,l||(l=new a("sms_reminder/UpdateSetting",new s),l.configure({url:"/services/api/campuscore/command/sms_reminder/UpdateSetting",contentType:"application/json; charset=UTF-8",type:"post"}),l.start())},{"sig/start":function(){var e=this;e.query("sms_reminder!current",e.serivce).spread(function(t,n){e.reminder=t&&t.studentInfo;var a=n&&(n.countdown||n.countDown);e.secondsLeftForStart=a.secondsLeftForStart,e.render()})},"dom/submit":function(e){var t=this,n=r(o(e.target).serializeArray());e.preventDefault(),i.assign(n,{phoneNumber:t.reminder.phoneNumberCountryCode+n.phoneNumber,subscribe:!0}),t.publish("sms_reminder/UpdateSetting",n).spread(function(e){e&&e[0]&&e[0].isSuccess&&(i.assign(t.reminder,{phoneNumber:n.phoneNumber,hasSubscribed:!0}),t.render())})},"dom:.cpsr-privacy-policy/click":function(e){e.preventDefault(),window.open("/partner/corp/privacy.aspx","help","width=640,height=600,resizable,scrollbars")},"dom:.cpsr-subscribe-checkbox/change":function(e){var t=this,n=o(e.target).prop("checked");t.publish("sms_reminder/UpdateSetting",{subscribe:n}).spread(function(e){e&&e[0]&&e[0].isSuccess&&(i.assign(t.reminder,{hasSubscribed:n}),t.render())})},render:function(){var e,a=this;return a.secondsLeftForStart<c?void 0:a.reminder&&a.reminder.enableSmsReminder?a.reminder.phoneNumber?a.html(n(a.reminder)):a.query("blurb!680352","blurb!680353").spread(function(n,s){return a.html(t(a.reminder)).then(function(){e=new RegExp(a.reminder.phoneNumberValidationRegex),o.validator.addMethod("campusSmsNumber",function(t,n){return this.optional(n)||e.test(t)},"Invalid phone number"),a.$element.find(".cpsr-input-form").validate({rules:{phoneNumber:{required:!0,campusSmsNumber:!0}},messages:{phoneNumber:{required:s&&s.translation,campusSmsNumber:n&&n.translation}}})})}):void 0}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/booked/techcheck/main.html",[],function(){return function(e){var t='<p class="csu-pl-status-info-description" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.notice+'"></p>\n<button type="button" class="btn btn-primary btn-tech-check" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675336">Complete tech check</button>';return t}}),define("campus-studyplan-ui/widget/pl-legacy/booked/techcheck/main",["troopjs-ef/component/widget","troopjs-core/pubsub/hub","template!./main.html","school-ui-studyplan/utils/client-storage","../class-status","when","client-tracking"],function(e,t,n,a,s,i,o){"use strict";function r(e){switch(e){case s.NOT_YET:return 675334;case s.STARTED:return 675335;default:return 675333}}function l(e){d.resolve(e)}var c="passed",d=i.defer();return e.extend(function(e,t,n){},{"sig/start":function(){t.on("plugins/tech-check/enable",t,l),t.reemit("plugins/tech-check/enable",!0,t,l),t.off("plugins/tech-check/enable",t,l)},"hub/campus/studyplan/pl/status":function(e){var t=this,n=a.getSessionStorage("techcheck_state")===c;t.classStatus=e,d.promise.then(function(e){!e||n?t.publish("campus/studyplan/techcheck/passed",t.classStatus):t.render()})},"dom:.btn-tech-check/click":function(){var e,t=this;o.useraction({"action.techCheck":1}),t.query('ccl!"evc.classroom.host"').spread(function(n){e=n&&n.value,e&&t.publish("tech-check/request",[{id:"flash-install"},{id:"flash-setting",reload:!1},{id:"chrome-auth"},{id:"check-audio"}],{flashPath:window.location.protocol+"//"+e+"/techcheck{version,-}/default/techcheck-{version}.swf"}).then(function(e){a.setSessionStorage("techcheck_state",c),a.setSessionStorage("legacy_techcheck_state",!0),t.$element.html(""),t.publish("campus/studyplan/techcheck/passed",t.classStatus)})})},render:function(){var e=this;e.html(n({notice:r(e.classStatus)}))}})}),define("campus-studyplan-ui/widget/pl-legacy/cp20",["./base"],function(e){"use strict";return e.extend(function(e,t,n){var a=this;a.options={serviceAPI:"checkpointstate!cp20;",durationMinutes:20,classType:"cp20"},a.deferredFeature.resolve()},{"sig/start":function(){}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/dropout/main.html",[],function(){return function(e){var t='<div class="csu-pl-dropout">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span class="glyphicon glyphicon-alert"></span>\n			<span data-blurb-id="675998" data-weave="troopjs-ef/blurb/widget"></span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n							</h4>\n							<div class="csu-pl-class-time">'+e.startTime+'</div>\n							 <div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="h4 csu-pl-status-info-title" data-blurb-id="675999" data-weave="troopjs-ef/blurb/widget"></p>\n						<p class="csu-pl-status-info-description">\n							<span data-blurb-id="676422" data-weave="campus-studyplan-ui/widget/blurb"></span><br/><strong data-blurb-id="676000" data-weave="campus-studyplan-ui/widget/blurb"></strong>\n						</p>\n						<div>\n							<a class="btn-link" href="/customerservice/contactus/inschool" target="_blank" data-blurb-id="676423" data-weave="troopjs-ef/blurb/widget"></a>\n						</div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';
return t}}),define("campus-studyplan-ui/widget/pl-legacy/dropout/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash"],function(e,t,n,a){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.bookedClass&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.bookedClass.customizedStartTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/no-recommendation.html",[],function(){return function(e){function t(){return e.evcUrls.booking.replace("{source}",window.encodeURIComponent(window.location.href)||"").replace("{token}",e.studyplanItemToken||"").replace("{partner}",e.classRecommendation.classPartnerCode||"").replace("{tid}","")}var n="";return n+='\n<div class="csu-pl-msg-with-topic">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="text-center">\n			<p class="csu-pl-msg-lead" data-blurb-id="681900" data-weave="troopjs-ef/blurb/widget">Unfortunately we were not able to recommend you a teacher within the next 7 days. Please visit the booking calendar to view further options.</p>\n			<a class="btn btn-primary btn-calendar" href="'+t()+'" data-blurb-id="681901" data-weave="troopjs-ef/blurb/widget">Go to calendar</a>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/main",["troopjs-ef/component/widget","template!./no-recommendation.html","when","lodash","jquery","../../../utils/widgetCreator","../../../utils/fancybox","moment"],function(e,t,n,a,s,i,o,r){"use strict";function l(){var e=n.defer();return s.get("/school/evc/pl/gettimezonelist",function(t){t&&t.TimeZone&&e.resolve(t.TimeZone)}),e.promise}function c(e){var t=u.exec(e.DisplayName);return{id:e.Id,offset:e.Offset,displayOffset:t&&t[0]}}var d="Id",u=/UTC([+-]\d{2}:\d{2}){0,1}/,p="bookingCancelledBy_",m="1900-01-01 00:00:00",v=window.localStorage,b=n.defer();return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.getTimezone().then(function(t){e.render(t)})},"hub:memory/load/studyplan_item":function(e){var t=this;t.studyplanItem=e,t.studyplanItemToken=t.studyplanItem&&t.studyplanItem.progress&&t.studyplanItem.progress.properties&&t.studyplanItem.progress.properties.token||""},"hub:memory/context":function(e){b.resolve(e&&e.user)},"dom/timezoneChange":function(e,t){var n=this;n.render(t)},getTimezone:function(){var e,t,s,i=this,o=n.defer();return i.query("member_site_setting!EVC;TimeZone",l()).spread(function(n,r){return r&&r.length&&(i.timezoneList=a.map(a.sortBy(r,d),c),n&&n.value?(s=a.find(i.timezoneList,{id:n.value}),o.resolve(s)):(e=new Date,t=-1*e.getTimezoneOffset(),s=a.find(i.timezoneList,{offset:t}),i.saveTimezone(s.id).then(function(){o.resolve(s)}))),o.promise})},saveTimezone:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:"EVC",keyCode:"TimeZone",keyValue:e})},render:function(e){var n,s,o=this;e&&(o.currentTimezone=e,o.query("ocb_recommendclass!'"+o.options.topic.classType+";"+o.currentTimezone.id+"'",b.promise).spread(function(e,r){o.publish("ocb/recommendation/change",e&&e.classRecommendation),r&&r.member_id&&(o.member_id=r.member_id),e&&e.classRecommendation&&e.classRecommendation.classes&&e.classRecommendation.classes.length?(n=a.assign(o.options,{studyplanItem:o.studyplanItem,studyplanItemToken:o.studyplanItemToken,classRecommendation:e.classRecommendation,currentTimezone:o.currentTimezone,timezoneList:o.timezoneList}),s=i({"campus-studyplan-ui/widget/pl-legacy/nevertake/recommendation/main":n}),s.weave(),o.html(s)):(n=a.assign(o.options,{studyplanItemToken:o.studyplanItemToken,classRecommendation:e.classRecommendation}),o.html(t(n)));var l=v.getItem(p+o.options.topic.courseUnitId+o.member_id),c=null===l?m:l.split("#")[1],d="ocb_cancellation!'"+o.options.topic.courseUnitId+";"+c+"'";o.query(d).spread(function(e){e.hasCancelledLastBooking&&o.showTeacherCancellationMessage()})}))},showTeacherCancellationMessage:function(){var e=this,t=i({"campus-studyplan-ui/widget/shared/alert/main":{title:682008,content:682009,action:677505}});t.weave().then(function(){o.open({content:t,afterClose:function(){v.setItem(p+e.options.topic.courseUnitId+e.member_id,"0#"+r().utc().format("YYYY-MM-DD HH:mm:ss"))}})})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/recommendation/main.html",[],function(){return function(e){var t='<div class="csu-pl-nevertake">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="csu-pl-nevertake-booking">\n			<p class="csu-pl-nevertake-lead" data-blurb-id="673774" data-weave="troopjs-ef/blurb/widget">Recommended class for you</p>\n			<form class="csu-pl-nevertake-form tabulation">\n				<div class="row">\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-teacher" data-weave="campus-studyplan-ui/widget/pl-legacy/nevertake/teacher/main"></div>\n					</div>\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-timeslot" data-weave="campus-studyplan-ui/widget/pl-legacy/nevertake/timeslot/main(options, context)" data-options=\''+JSON.stringify(e.classRecommendation)+"' data-context='"+JSON.stringify(e.context)+'\'></div>\n						<div class="csu-pl-nevertake-timezone" data-weave="campus-studyplan-ui/widget/pl-legacy/nevertake/timezone/main(options, list)" data-options=\''+JSON.stringify(e.currentTimezone)+"' data-list='"+JSON.stringify(e.timezoneList)+'\'></div>\n					</div>\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-button">\n							';return"true"===e.videoEnabled&&(t+='\n								<div class="cpn-button-video-lesson">\n									<input type="checkbox" id="videoLesson" /><label for="videoLesson" data-blurb-id="673775" data-weave="troopjs-ef/blurb/widget">Make it a video lesson</label>\n								</div>\n							'),t+="\n                            ",e.PLRecordFeature>0&&(t+='\n								<div class="cpn-button-video-lesson gud">\n                                    <input type="hidden" value="'+(2==e.PLRecordFeature?"true":"false")+'" name="NeedRecord" />\n                                    <input type="checkbox" id="NeedRecordBox" '+(2==e.PLRecordFeature?"checked":"")+' /><label for="NeedRecordBox" data-blurb-id="708472" data-weave="troopjs-ef/blurb/widget">Send me class video</label>\n                                    <span class="tooltip-info" data-toggle="tooltip" data-placement="right">i</span>\n                                    <span class="hide" data-blurb-id="708473" data-weave="campus-studyplan-ui/widget/blurb" ></span>\n								</div>\n							'),t+='\n							<div>\n								<button type="submit" class="btn btn-primary"><span data-blurb-id="568596" data-weave="troopjs-ef/blurb/widget">Book this class</span></button>\n								<p class="csu-pl-nevertake-tnc" data-blurb-id="673780" data-weave="campus-studyplan-ui/widget/blurb" data-values=\'{"termsAndConditions": "<a class=\\"csu-pl-link csu-pl-link-tnc\\">'+e.termsAndConditions+"</a>\"}'>By clicking the button above, you agree to the Terms And Conditions of the Private Lesson services.</p>\n							</div>\n						</div>\n					</div>\n				</div>\n				",t+="cp20"===e.studyplanItem.typeCode?'\n					<input type="hidden" name="BookingToken" value="'+e.studyplanItemToken+'" />\n					<input type="hidden" name="SubserviceType" value="'+e.studyplanItem.typeCode.toUpperCase()+'" />\n					<input type="hidden" name="ClassTypeCode" value="'+e.studyplanItem.typeCode.toUpperCase()+'" />\n					<input type="hidden" name="Flow" value="" />\n				':'\n					<input type="hidden" name="BookingToken" value="" />\n					<input type="hidden" name="SubserviceType" value="" />\n					<input type="hidden" name="ClassTypeCode" value="" />					\n					<input type="hidden" name="Flow" value="UnitAligned" />\n				',t+='\n				<input type="hidden" name="Token" value="'+e.bookingToken.token+'" />\n				<input type="hidden" name="TokenTime" value="'+e.bookingToken.tokenTime+'" />\n				<input type="hidden" name="SchoolVersion" value="'+e.studentCourse.schoolVersion+'" />\n				<input type="hidden" name="Course_id" value="'+e.studentCourse.course_id+'" />\n				<input type="hidden" name="CourseUnit_id" value="'+e.studentCourse.courseUnit_id+'" />\n				<input type="hidden" name="StudentCourse_id" value="'+e.studentCourse.studentCourse_id+'" />\n				<input type="hidden" name="Member_id" value="'+e.user.member_id+'" />\n				<input type="hidden" name="MarketCode" value="'+e.context.countrycode.value+'" />\n				<input type="hidden" name="IsVideo" value="false" />\n				<input type="hidden" name="Gender" value="" />\n			</form>\n\n			<!-- links -->\n			<div class="row">\n				<div class="col-xs-4 text-center">\n					<a class="btn-link csu-pl-link btn-link-change-teacher"><span data-blurb-id="673776" data-weave="troopjs-ef/blurb/widget"></span><span class="glyphicon glyphicon-arrow"></span></a>\n				</div>\n				<div class="col-xs-4 text-center">\n					<a class="btn-link csu-pl-link btn-link-change-time"><span data-blurb-id="673777" data-weave="troopjs-ef/blurb/widget"></span><span class="glyphicon glyphicon-arrow"></span></a>\n				</div>\n				<div class="col-xs-4">\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/recommendation/main",["troopjs-ef/component/widget","template!./main.html","lodash","jquery","../../../../utils/widgetCreator","../../../../utils/fancybox","when","client-tracking"],function(e,t,n,a,s,i,o,r){"use strict";function l(e){var t=/[\?|&]id=(\S+)$/.exec(e&&e.communityPageUrl);return t&&t[1]}function c(e,t,n,a){return e.replace("{source}",window.encodeURIComponent(window.location.href)||"").replace("{token}",t||"").replace("{partner}",n||"").replace("{tid}",a||"")}function d(e){var t;return t=e.enablePLRecord?e.defaultPLRecordOption?b.CHECKED:b.UNCHECKED:b.DISABLED}var u=o.defer(),p=o.defer(),m="bookingCancelledBy_",v=window.localStorage,b={DISABLED:0,UNCHECKED:1,CHECKED:2};return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.query('ccl!"School.PrivateLesson.isVideoEnable"',"blurb!673781",u.promise,p.promise,"evc_studentcourse!"+e.options.topic.courseUnitId,"bookingtoken!current","evcmember!current").spread(function(s,i,o,r,l,c,u){r&&r.member_id&&(e.member_id=r.member_id),e.html(t,n.assign({videoEnabled:s&&s.value,termsAndConditions:i&&i.translation,context:o||{},user:r||{},studentCourse:l||{},bookingToken:c&&c.lessonBookingSecurityParams||{},PLRecordFeature:d(u)},e.options)).then(function(){e.$timeslot=e.$element.find(".csu-pl-nevertake-timeslot"),e.$videoLesson=e.$element.find("input[name=IsVideo]"),e.$element.find('[data-toggle="tooltip"]').each(function(){var e=a(this);e.tooltip({title:e.nextAll(".hide").text()})})})})},"dom:form.csu-pl-nevertake-form/submit":function(e){e.preventDefault();var t,n=this,l=a(e.target),c=l.find("input[name=StartTime]"),d=l.find("input[name=StartTime]:checked"),u=c.index(d)+1,p=o.defer();r.useraction({"action.booking":1,"action.recommendTimeSlot":1,"action.recommendTimeSlotChoice":"Choice"+u,"action.hasProfilePicture":n.selectedTeacher.isDefaultAvatar?"No":"Yes","action.videoLessonClick":n.isVideoClass?"Yes":"No"}),n.$element.trigger("task",p.promise),a.ajax({method:"POST",url:"/school/evc/pl/book",data:l.serialize(),success:function(e){e.IsSuccess?(n.publish("studyplan/sequence/update"),n.publish("studyplan/sequence-container/reload"),n.publish("ocb/recommendation/track",{status:"Success",statusExtension:e.Class_id,isVideoClass:n.isVideoClass}),v.removeItem(m+n.options.topic.courseUnitId+n.member_id)):(t=s({"campus-studyplan-ui/widget/shared/alert/main":{glyphicon:!0,title:674436,content:674437,action:674438}}),t.weave().then(function(){i.open({content:t,afterClose:function(){n.$timeslot.trigger("render")}})}),n.publish("ocb/recommendation/track",{status:"Fail",statusExtension:e.StatusCode,isVideoClass:n.isVideoClass})),p.resolve()}})},"dom:#videoLesson/change":function(e){var t=this;t.isVideoClass=e.target.checked,t.$videoLesson.val(t.isVideoClass)},"dom:#NeedRecordBox/click":function(e){var t=e.target.form.elements.NeedRecord;t.value=e.target.checked?"true":"false"},"dom:.csu-pl-link-tnc/click":function(e){var t=this,n=s({"campus-studyplan-ui/widget/pl-legacy/nevertake/tscs/main":{classType:t.options.topic.classType}});n.weave().then(function(){i.open({content:n})})},"hub:memory/common_context":function(e){u.resolve(e&&e.values)},"hub:memory/context":function(e){p.resolve(e&&e.user)},"hub/ocb/selectedClass/change":function(e){var t=this;t.selectedTeacher=e},"dom:.btn-link-change-teacher/click":function(){var e=this;r.useraction({"action.changeTeacher":1}),e.publish("ocb/recommendation/track",{status:"Goto",statusExtension:"ChangeTeacher",isVideoClass:!1});var t=c(e.options.evcUrls.booking,e.options.studyplanItemToken,e.options.classRecommendation.classPartnerCode);window.open(t,"_self")},"dom:.btn-link-change-time/click":function(){var e=this;r.useraction({"action.viewOtherTime":1}),e.publish("ocb/recommendation/track",{status:"Goto",statusExtension:"ChangeTime",isVideoClass:!1});var t=c(e.options.evcUrls.booking,e.options.studyplanItemToken,e.options.classRecommendation.classPartnerCode,l(e.selectedTeacher));window.open(t,"_self")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/teacher/main.html",[],function(){return function(e){function t(){var t="";return e.accent||e.bilingual||(t="cpn-teacher-name-standalone"),t}function n(){for(var e=arguments,t="",n=0;n<e.length;n++)t+=e[n].substring(0,1);return t.toUpperCase()}var a="";return a+='\n<div class="cpn-title text-center"><span class="glyphicon glyphicon-teacher-large"></span><span data-blurb-id="673778" data-weave="troopjs-ef/blurb/widget">Teacher</span></div>\n<div class="cpn-teacher-profile text-center">\n	<div class="cpn-teacher-avatar">\n			<!--[if lte IE 8]>\n				<vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n					',a+=e.isDefaultAvatar?'\n						<vml:fill color="#c3c3c3">\n							<em>'+n(e.firstName,e.lastName)+"</em>\n						</vml:fill>\n					":'\n						<vml:fill type="frame" src="'+e.avatarUrl+'"/>\n					',a+='\n				</vml:oval>\n			<![endif]-->\n			<span class="csu-pl-teacher-avatar hide-in-ie8">\n				',a+=e.isDefaultAvatar?"\n					<em>"+n(e.firstName,e.lastName)+"</em>\n				":'\n					<img src="'+e.avatarUrl+'" alt="'+e.nickName+'">\n				',a+='\n			</span>\n		</span>\n	</div>\n	<div class="cpn-teacher-name '+t()+'">\n		',a+=e.nickName?"\n			"+e.nickName+"\n		":"\n			"+e.firstName+" "+e.lastName+"\n		",a+='\n	</div>\n	<ul class="cpn-teacher-language text-center"><!--\n		',e.accent&&(a+='\n			--><li class="cpn-teacher-accent">\n				<div class="cpn-teacher-text">\n					<span class="glyphicon glyphicon-accent"></span><span>'+e.accent+"</span>\n				</div>\n			</li><!--\n		"),a+="\n		",e.bilingual&&(a+='\n			--><li class="cpn-teacher-bilingual">\n				<div class="cpn-teacher-text">\n					<span class="glyphicon glyphicon-bilingual"></span><span>'+e.bilingual+"</span>\n				</div>\n			</li><!--\n		"),a+='\n		-->\n	</ul>\n</div>\n<input type="hidden" name="Teacher_id" value="'+e.memberId+'"/ >'}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/teacher/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){"use strict";return e.extend(function(e,t,n){},{"sig/start":function(){},"hub/ocb/selectedClass/change":function(e){var t=this;e.memberId!==t.memberId&&t.render(e)},render:function(e){var n=this;n.memberId=e.memberId,n.html(t,e)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/timeslot/main.html",[],function(){return function(e){function t(e){return e?"":"checked"}var n="";n+='\n\n<div class="text-center">\n	<div class="cpn-title"><span class="glyphicon glyphicon-timeslot"></span><span data-blurb-id="673779" data-weave="troopjs-ef/blurb/widget">Time</span></div>\n	<ul class="cpn-timeslot-list text-left">\n		';for(var a=0;a<e.classes.length;a++)n+='\n			<li data-teacher-member-id="'+e.classes[a].teacherMemberId+'" data-end-time="'+e.classes[a].endTimeEst+'" data-language-code="'+e.classes[a].languageCode+'">\n				<input type="radio" name="StartTime" id="timeslot'+e.classes[a].classId+'" value="'+e.classes[a].startTimeEst+'" '+t(a)+' /><label for="timeslot'+e.classes[a].classId+'">'+e.classes[a].formattedTime+"</label>\n			</li>\n		";return n+='\n		<input type="hidden" name="EndTime" value="'+e.classes[0].endTimeEst+'" />\n		<input type="hidden" name="LanguageCode" value="'+e.classes[0].languageCode+'" />\n	</ul>\n</div>\n<input type="hidden" name="PartnerCode" value="'+e.classPartnerCode+'" />'}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/timeslot/main",["troopjs-ef/component/widget","template!./main.html","lodash","jquery","when","../../../../utils/momentize","client-tracking"],function(e,t,n,a,s,i,o){"use strict";function r(e){return function(t){var n=t.startTime.substring(0,19);return t.formattedTime=i(n,e,"START_TIME"),t}}return e.extend(function(e,t,n,a){var s=this;s.options=n,s.context=a},{"sig/start":function(){var e=this;e.render()},"dom/render":function(){var e=this;e.render()},'dom:input[name="StartTime"]/change':function(e){var t=this,s=a(e.currentTarget).parent();o.useraction({"action.changeBookingTime":1}),s.siblings().find("input[checked]").removeAttr("checked"),s.find("input").attr("checked","checked"),t.$endTime.val(s.data("endTime")),t.$languageCode.val(s.data("languageCode")),t.publish("ocb/selectedClass/change",n.find(t.teachers,{memberId:s.data("teacherMemberId")}))},render:function(){var e=this,a=e.context&&e.context.languagecode.value.toLowerCase();e.teachers=e.options.teachers,e.html(t,{classes:n.map(e.options.classes,r(a)),classPartnerCode:e.options.classPartnerCode}).then(function(){e.$endTime=e.$element.find("input[name=EndTime]"),e.$languageCode=e.$element.find("input[name=LanguageCode]"),e.publish("ocb/selectedClass/change",n.find(e.teachers,{memberId:e.options.classes[0].teacherMemberId}))})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/timezone/main.html",[],function(){return function(e){var t='<div class="cpn-timezone-readonly text-center">\n	<div>'+e.id+'</div>\n	<div class="cpn-timezone-button-wrapper">\n		('+e.displayOffset+')\n		<a class="csu-pl-link cpn-timezone-button-change" data-blurb-id="676700" data-weave="troopjs-ef/blurb/widget">change</a>\n	</div>\n</div>';return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/timezone/editable.html",[],function(){return function(e){function t(t){return t===e.current.id?"selected":""}var n="";n+='\n<div class="cpn-timezone-editable text-center">\n	<select class="cpn-timezone-select">\n		';for(var a=0;a<e.list.length;a++)n+="\n			<option "+t(e.list[a].id)+' value="'+e.list[a].id+'">('+e.list[a].displayOffset+") "+e.list[a].id+"</option>\n		";return n+="\n	</select>\n</div>"}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/timezone/main",["troopjs-ef/component/widget","template!./main.html","template!./editable.html","when","jquery","lodash"],function(e,t,n,a,s,i){"use strict";return e.extend(function(e,t,n,a){var s=this;s.options=n,s.list=a},{"sig/start":function(){var e=this;e.render().then(function(){s("body").click(function(t){e.cancel(s(t.target))})})},"dom:.cpn-timezone-button-change/click":function(){var e=this;e.edit()},"dom:.cpn-timezone-select/change":function(e){var t=this,n=t.list[e.currentTarget.selectedIndex];t.save(n.id).then(function(){t.$element.trigger("timezoneChange",n)})},render:function(){var e=this;return e.hide(e.$editableView),e.html(t(e.options)).then(function(){e.editable=!1,e.$readonlyView&&e.$readonlyView.remove(),e.$readonlyView=e.$element.find(".cpn-timezone-readonly")})},edit:function(){var e=this;e.hide(e.$readonlyView),e.$editableView?(e.$element.html(e.$editableView),e.editable=!0):e.html(n({list:e.list,current:e.options})).then(function(){e.editable=!0,e.$editableView=e.$element.find(".cpn-timezone-editable")})},cancel:function(e){var t=this;!t.editable||e.hasClass("cpn-timezone-button-change")||e.hasClass("cpn-timezone-select")||e.parents(".cpn-timezone-select").length||(t.hide(t.$editableView),t.$element.html(t.$readonlyView))},save:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:"EVC",keyCode:"TimeZone",keyValue:e})},hide:function(e){var t=this;e&&t.$element.after(e)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nevertake/tscs/main.html",[],function(){return function(e){var t='<div class="campus-studyplan-ui">\n	<div class = "csu-pl-nevertake-tscs">\n		<p class = "csu-pl-nevertake-tscs-title" data-weave = "troopjs-ef/blurb/widget" data-blurb-id = "676103"></p>\n		<p class = "csu-pl-nevertake-tscs-des" data-weave = "troopjs-ef/blurb/widget" data-blurb-id = "676112"></p>\n		<div class = "csu-pl-nevertake-tscs-content" data-weave = "campus-studyplan-ui/widget/blurb" data-blurb-id = "'+e.blurbID+'"></div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl-legacy/nevertake/tscs/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this,n="708943";return e.html(t,{blurbID:n})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/nocouponleft/main.html",[],function(){return function(e){function t(e){return e.replace(/upurl=\S*&?/,"upurl="+window.encodeURIComponent(window.location.href))}var n="";return n+='\n<div class="csu-pl-nocouponleft csu-pl-msg-with-topic">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="text-center">\n			<p class="csu-pl-msg-lead" data-blurb-id="675885" data-weave="troopjs-ef/blurb/widget">You don\'t have any private classes left right now.</p>\n			',e.feature.canBuyMore&&(n+='\n				<a class="btn btn-primary" href="'+t(e.feature.buyUrl)+'" data-blurb-id="675886" data-weave="troopjs-ef/blurb/widget">Buy more classes</a>\n			'),n+="\n		</div>\n	</div>\n</div>"}}),define("campus-studyplan-ui/widget/pl-legacy/nocouponleft/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.html(t(e.options))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/pending/main.html",[],function(){return function(e){var t='<div class="csu-pl-pending">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span data-blurb-id="675994" data-weave="troopjs-ef/blurb/widget"></span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n							</h4>\n							<div class="csu-pl-class-time">'+e.startTime+'</div>\n							 <div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="h4 csu-pl-status-info-title csu-pl-status-info-title-fullsize" data-blurb-id="675995" data-weave="troopjs-ef/blurb/widget"></p>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl-legacy/pending/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash"],function(e,t,n,a){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.bookedClass&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.bookedClass.customizedStartTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))}})}),define("campus-studyplan-ui/widget/pl-legacy/pl",["./base","lodash"],function(e,t){"use strict";return e.extend(function(e,n,a){var s=this;s.options={serviceAPI:"plclass!",durationMinutes:40,classType:"pl"},s.query("evcmember!current").spread(function(e){s.deferredFeature.resolve(t.find(e&&e.features,{featureType:s.options.classType.toUpperCase()}))})},{"sig/start":function(){}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/unlocked/main.html",[],function(){return function(e){function t(){return"cp20"===e.topic.classType?675991:678952}var n="";return n+='\n<div class = "csu-pl-unlocked csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="h4 csu-pl-lead text-center">\n            <span class="glyphicon glyphicon-unlock"></span>\n            <span class="csu-pl-unlocked-status" data-weave="troopjs-ef/blurb/widget" data-blurb-id="677341"></span>\n        </div>\n        <div class="csu-pl-msg-details media">\n            <div class="pull-left text-center">\n                <div class="csu-pl-teacher-avatar-wrapper">\n                    <!--[if lte IE 8]>\n                        <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                            <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                        </vml:oval>\n                    <![endif]-->\n                    <span class="csu-pl-teacher-avatar hide-in-ie8">\n                        <img src="'+e.recommendedTeacher.avatar+'">\n                    </span>\n                </div>\n                <div>\n                    <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                </div>\n                <div class="csu-pl-teacher-name">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                </div>\n            </div>\n            <div class="media-body">\n                <p class="h4" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675884"></p>\n                <p data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="'+t()+'" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                </p>\n            </div>\n        </div>\n        <div class="text-center">\n            <button type="button" class="btn btn-primary btn-start-booking">\n                <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677342"></span>\n            </button>\n        </div>\n    </div>\n</div>'}}),define("campus-studyplan-ui/widget/pl-legacy/unlocked/main",["troopjs-ef/component/widget","template!./main.html","school-ui-studyplan/module","when","lodash","../../../utils/member-site-setting"],function(e,t,n,a,s,i){"use strict";function o(e,t){var n=",",a=e&&e.split(n)||[];return s.contains(a,t+"")||a.push(t),a.join(n)}var r=a.defer();return e.extend(function(e,a,s){var i=this;i.options=s,i.queries=[r.promise],i.template=t,i.cacheServer=n.config().cacheServer},{"sig/start":function(){var e=this;return e.query(e.queries).spread(function(){e.render.apply(e,arguments)})},"dom:.btn-start-booking/click":function(){var e=this;e.unlock()},"hub:memory/context":function(e){r.resolve({user:e&&e.user})},render:function(){var e=this,t={recommendedTeacher:{avatar:e.cacheServer+"/juno/18/80/21/v/188021/teacher.jpg",name:677343},feature:e.options.feature,topic:e.options.topic};return s.forEach(arguments,function(e){s.assign(t,e)}),e.html(e.template(t))},unlock:function(){var e,t=this,n="UnlockedPLs";t.getMemberSiteSetting(n).then(function(a){e=o(a&&a.value,t.options.topic.courseUnitId),t.saveMemberSiteSetting(n,e).then(function(){t.publish("studyplan/sequence-container/reload")})})}},i)}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/welcome/main.html",[],function(){return function(e){var t='<div class = "csu-pl-welcome csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="h4 csu-pl-lead text-center">\n            <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="679461"></span>\n        </div>\n        <div class="csu-pl-msg-details-wrapper clearfix">\n            <div class="csu-pl-msg-details media pull-left">\n                <div class="pull-left text-center">\n                    <div class="csu-pl-teacher-avatar-wrapper">\n                        <!--[if lte IE 8]>\n                            <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                                <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                            </vml:oval>\n                        <![endif]-->\n                        <span class="csu-pl-teacher-avatar hide-in-ie8">\n                            <img src="'+e.recommendedTeacher.avatar+'">\n                        </span>\n                    </div>\n                    <div>\n                        <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                    </div>\n                    <div class="csu-pl-teacher-name">\n                        <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                    </div>\n                </div>\n                <div class="media-body">\n                    <p class="h4" data-weave="troopjs-ef/blurb/widget" data-blurb-id="679462"></p>\n                    <p data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="675883" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                    </p>\n                </div>\n            </div>\n            <div class="pull-right">\n                <a class="csu-pl-tutorial-video">\n                    <img src="'+e.video.post+'">\n                </a>\n                <div data-weave="school-ui-studyplan/widget/gl-pl/popupvideo/main" data-video-url="'+e.video.url+'"></div>\n            </div>\n        </div>\n        <div class="text-center">\n            <button type="button" class="btn btn-primary btn-start-booking">\n                <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677342"></span>\n            </button>\n        </div>\n    </div>\n</div>';
return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-legacy/welcome/no-coupon-left.html",[],function(){return function(e){function t(e){return e.replace(/upurl=\S*&?/,"upurl="+window.encodeURIComponent(window.location.href))}var n="";return n+='\n<div class = "csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="row">\n            <div class="col-xs-4 col-xs-offset-4">\n                <div class="h4 csu-pl-lead text-center">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="675885"></span>\n                </div>\n            </div>\n        </div>\n        <div class="csu-pl-msg-details media">\n            <div class="pull-left text-center">\n                <div class="csu-pl-teacher-avatar-wrapper">\n                    <!--[if lte IE 8]>\n                        <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                            <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                        </vml:oval>\n                    <![endif]-->\n                    <span class="csu-pl-teacher-avatar hide-in-ie8">\n                        <img src="'+e.recommendedTeacher.avatar+'">\n                    </span>\n                </div>\n                <div>\n                    <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                </div>\n                <div class="csu-pl-teacher-name">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                </div>\n            </div>\n            <div class="media-body">\n                <p data-weave="troopjs-ef/blurb/widget" data-blurb-id="677495" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                <p>\n                    <span data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="679490" data-values=\'{"title": "<strong>'+e.translation.title+'</strong>"}\'></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.topic.description+'"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677496"></span>\n                </p>\n            </div>\n        </div>\n		',e.feature.canBuyMore&&(n+='\n			<div class="text-center">\n				<a class="btn btn-primary btn-buy-coupon" href="'+t(e.feature.buyUrl)+'" data-blurb-id="675886" data-weave="troopjs-ef/blurb/widget">Buy more classes</a>\n			</div>\n		'),n+="\n    </div>\n</div>"}}),define("campus-studyplan-ui/widget/pl-legacy/welcome/main",["campus-studyplan-ui/widget/pl-legacy/unlocked/main","template!./main.html","template!./no-coupon-left.html"],function(e,t,n){"use strict";return e.extend(function(e,a,s){var i=this;i.options.feature&&i.options.feature.couponLeft<1?(i.template=n,i.queries.push(i.query("blurb!"+i.options.topic.title).spread(function(e){return{translation:{title:e&&e.translation}}}))):(i.template=t,i.queries.push(i.query("media!167835").spread(function(e){return{video:{url:e&&e.url,post:i.cacheServer+"/_imgs/evc/pl/studyplan/video.jpg"}}})))},{"dom:.btn-start-booking/click":function(e){var t=this,n="cp20"===t.options.topic.classType;e.stopImmediatePropagation(),n?(t.saveMemberSiteSetting("FirstTimeStudyPlanCP20",!0),t.unlock()):t.saveMemberSiteSetting("FirstTimeStudyPlanPL",!0).then(function(){t.publish("studyplan/sequence-container/reload")})},"dom:.csu-pl-tutorial-video/click":function(){var e=this;e.publish("studyplan/evc/welcome-video/show")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl-locked/main.html",[],function(){return function(e){var t='<div class="campus-studyplan-ui">\n	<div class="csu-notification" data-weave="school-ui-studyplan/widget/gl-pl/announcement/cp20"></div>\n	<div class="csu-pl-locked">\n		<div class="csu-pl-container">\n			<h4 class="csu-pl-lead text-center">\n				<span class="glyphicon glyphicon-lock-slim"></span><span data-blurb-id="675987" data-weave="troopjs-ef/blurb/widget"></span>\n			</h4>\n			<div class="csu-pl-locked-message">\n				<p data-blurb-id="675988" data-weave="troopjs-ef/blurb/widget"></p>\n			</div>\n			<div class="text-center">\n				<button type="button" data-blurb-id="675989" data-weave="troopjs-ef/blurb/widget" class="btn btn-primary btn-next-lesson"></button>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl-locked/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){"use strict";return e.extend(function(e,t,n){},{"sig/start":function(){var e=this;e.html(t())},"dom:.btn-next-lesson/click":function(){var e=this;e.publish("studyplan/sequence/navigate/suggest-item")}})}),define("campus-studyplan-ui/widget/pl/GLPLStatus",{NEVERTAKE:"nevertake",BOOKED:"booked",DROPOUT:"dropout",PENDING:"pending",ATTENDED:"attended"}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/attended/main.html",[],function(){return function(e){var t='<div class="csu-pl-attended">\n	<div class="csu-pl-container">\n		<div class="csu-pl-lead csu-pl-lead-with-time text-center">\n			<div>\n				<span class="glyphicon glyphicon-passed"></span>\n			</div><!--\n			--><div>\n				<div class="h4" data-blurb-id="676306" data-weave="troopjs-ef/blurb/widget"></div>\n				<div class="csu-pl-class-time">'+e.startTime+'</div>\n			</div>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n							</h4>\n							<div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="csu-pl-status-info-title h4 csu-pl-status-info-title-highlight" data-blurb-id="675996" data-weave="troopjs-ef/blurb/widget"></p>\n						<div>\n							<a class="btn btn-primary btn-feedback-details" data-blurb-id="675997" data-weave="troopjs-ef/blurb/widget"></a>\n						</div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl/attended/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash","client-tracking"],function(e,t,n,a,s){"use strict";function i(e,t){return o[e]+t}var o={cp20:"/school/progressreport#teacher-feedback?fb_id=CP20_",pl:"/school/progressreport#teacher-feedback?fb_id=PL_"};return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.bookedClass&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.bookedClass.customizedStartTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))},"dom:.btn-feedback-details/click":function(){var e=this;s.useraction({"action.viewFeedBack":1}),window.open(i(e.options.topic.classType,e.options.feedback.feedbackId))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/main.html",[],function(){return function(e){var t='<div class="campus-studyplan-ui">\n	<div class="csu-notification" data-weave="school-ui-studyplan/widget/gl-pl/announcement/'+e.topic.classType+'"></div>\n	<div data-weave="campus-studyplan-ui/widget/pl/'+e.statusCode+"/main(options) campus-studyplan-ui/widget/tracking\" data-options='"+JSON.stringify(e).replace(/\'/g,"&#39;")+"'></div>\n</div>";return t}}),define("campus-studyplan-ui/widget/pl/base",["troopjs-ef/component/widget","template!./main.html","school-ui-studyplan/module","jquery","lodash","when","../../utils/member-site-setting","client-tracking","./GLPLStatus","../../utils/vml"],function(e,t,n,a,s,i,o,r,l){"use strict";function c(e,t,n){return e=(e||"").replace(/{unitId}/i,t),n&&(e=e.replace(/{classId}/i,n)),e}function d(e,t,n,a){var s=b[t];return e?{booking:c(e[s.BOOKING],n),entering:c(e[s.ENTERING],n,a)}:void 0}function u(e,t){var n=e&&e.split(",");return s.contains(n,t+"")}function p(e){var t=n.config().cacheServer;return e?t+"/_imgs/evc/pl/topic/238x238/"+e:t+"/_imgs/evc/pl/pl_default_100x100.png"}function m(e){return e?new Date>=new Date(e):void 0}var v={UNLOCKED:"UnlockedPLs"},b={pl:{BOOKING:"SPPL40BookingV2",ENTERING:"SPPL40Entering"},cp20:{BOOKING:"CP20BookingV2",ENTERING:"CP20Entering"}},f={WELCOME:"welcome",UNLOCKED:"unlocked",NEVER_TAKE:"nevertake",NO_COUPON_LEFT:"nocouponleft"};return e.extend(function(e,t,n){var a=this;a.deferredFeature=i.defer()},{"sig/start":function(){r.pagename("One-Click PL")},"hub:memory/load/unit":function(e){var n,a=this,i="cp20"===a.options.classType,o="studyplan_evc_class!"+e.templateUnitId+";"+a.options.classType;a.query(o).spread(function(e){var t={};switch("string"==typeof e.state&&(t.statusCode=e.state.toLowerCase(),t.classType=e.classType),t.statusCode){case l.BOOKED:return a.query(o+".classDetail,.classDetail.teacher").spread(function(e){return t.classDetails=e&&e.classDetail,t.classDetails&&m(t.classDetails.easternEndTime)&&(t.statusCode=l.PENDING),t});case l.PENDING:case l.ATTENDED:return a.query(o+".classDetail,.classDetail.teacher").spread(function(e){return t.classDetails=e&&e.classDetail,t});default:if(e.topic)return a.query(o+".topic,.classDetail").spread(function(e){return t.classDetails=s.assign({},e.topic,e.classDetail),t})}}).then(function(o){return a.query("evc_url_resource!current",a.deferredFeature.promise,i?a.getMemberSiteSetting(v.UNLOCKED):void 0,"campus_mypage_isf2fstudent!current").spread(function(i,r,l,c,m){o&&o.classDetails&&(n=s.clone(o,!0),n.statusCode=n.statusCode.toLowerCase(),n.feature=r,n.evcUrls=d(i&&i.studyPlanUrls,a.options.classType,e.legacyUnitId),n.topic={courseUnitId:e.legacyUnitId,title:o.classDetails.topic.topic,description:o.classDetails.topic.description,image:p(o.classDetails.topic.imageUrl||o.classDetails.topic.topicImageUrl),classType:a.options.classType},n.classDetails&&(n.bookedClass=n.classDetails),s.assign(n.bookedClass,{durationForStudent:a.options.durationMinutes}),n.statusCode===f.NEVER_TAKE?(n.feature&&n.feature.couponLeft<1&&(n.statusCode=f.NO_COUPON_LEFT),!c||u(c.value,n.topic.courseUnitId)||m.isF2fStudent||(n.statusCode=f.UNLOCKED)):n.statusCode===f.WELCOME&&(n.statusCode=f.NEVER_TAKE),a.html(t(n)))})})}},o)}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/class-entrance/main.html",[],function(){return function(e){function t(){return e.disabled?"btn-disabled":"btn-primary"}var n="";return n+='\n\n<button type="button" class="btn btn-entrance '+t()+'" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675337">Enter class</button>'}}),define("campus-studyplan-ui/widget/pl/booked/class-status",{NOT_YET:"notyet",IN_COUNTDOWN:"incountdown",OPEN_SOON:"opensoon",STARTED:"started"}),define("campus-studyplan-ui/widget/pl/booked/class-entrance/main",["troopjs-ef/component/widget","template!./main.html","../class-status"],function(e,t,n){"use strict";function a(e){return e.replace("?","?showcontentonly=y&").replace("{source}",window.encodeURIComponent(window.location.href))}return e.extend(function(e,t,n){var a=this;a.url=n},{"sig/start":function(){},"hub/campus/studyplan/pl/status":function(e){var a=this;switch(e){case n.OPEN_SOON:a.html(t({disabled:!0}));break;case n.STARTED:a.html(t({disabled:!1}))}},"dom:.btn-primary.btn-entrance/click":function(){var e=this;window.open(a(e.url),"_self")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/class-status/main.html",[],function(){return function(e){var t='<p data-blurb-id="'+e.blurbId+'" data-weave="troopjs-ef/blurb/widget" class="csu-pl-status-info-title h4 '+e.className+'"></p>';return t}}),define("campus-studyplan-ui/widget/pl/booked/class-status/main",["troopjs-ef/component/widget","template!./main.html","../class-status"],function(e,t,n){"use strict";function a(e){switch(e){case n.STARTED:return 674823;case n.OPEN_SOON:return 674824;default:return 674825}}function s(e){switch(e){case n.STARTED:case n.OPEN_SOON:return"csu-pl-status-info-title-highlight";default:return""}}return e.extend(function(e,t,n){},{"sig/start":function(){},"hub/campus/studyplan/pl/status":function(e){var n=this;n.html(t({blurbId:a(e),className:s(e)}))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/countdown/main.html",[],function(){return function(e){var t="<div>\n	<div>%H<span>|</span></div>\n	<div>hour</div>\n</div><!--\n--><div>\n	<div>%M<span>|</span></div>\n	<div>min</div>\n</div><!--\n--><div>\n	<div>%S</div>\n	<div>sec</div>\n</div>";return t}}),define("campus-studyplan-ui/widget/pl/booked/countdown/main",["troopjs-ef/component/widget","template!./main.html","../class-status","jquery","moment","jquery.countdown"],function(e,t,n,a,s){"use strict";function i(e){return e>30*l?n.NOT_YET:1>e?n.STARTED:10*l>e?n.OPEN_SOON:n.IN_COUNTDOWN}var o=24,r=60,l=60,c=t();return e.extend(function(e,t,n){var a=this;a.service=n},{"sig/start":function(){var e=this;e.checkClassStatus().then(function(t){e.updateStatus(t),e.render()})},checkClassStatus:function(){var e,t=this,n=0;return t.query(t.service).spread(function(a){return e=a&&(a.countdown||a.countDown),e&&(n=e.secondsLeftForStart,t.finalDate=s().add(n,"seconds").format("YYYY/MM/DD HH:mm:ss")),i(n)})},updateStatus:function(e){var t=this;t.currentStatus=e,t.publish("campus/studyplan/pl/status",t.currentStatus)},render:function(){var e=this;e.currentStatus===n.STARTED?e.$element.remove():e.countdown()},countdown:function(){var e=this;e.$element.countdown(e.finalDate).on("update.countdown",function(t){var a=((t.offset.totalDays*o+t.offset.hours)*r+t.offset.minutes)*l+t.offset.seconds,s=i(a),d=s!==e.currentStatus,u=s===n.IN_COUNTDOWN||s===n.OPEN_SOON;d&&s!==n.STARTED&&e.updateStatus(s),u&&e.$element.html(t.strftime(c))}).on("finish.countdown",function(){e.checkClassStatus().then(function(t){e.updateStatus(t),e.render()})})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/main.html",[],function(){return function(e){var t='<div class="csu-pl-booked">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span class="glyphicon glyphicon-booked"></span>\n			<span data-blurb-id="568587" data-weave="troopjs-ef/blurb/widget">Class Booked</span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<div class="media-body-inner-wrapper">\n								<h4 class="media-heading text-uppercase">\n									<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n								</h4>\n								<div class="csu-pl-class-time">'+e.startTime+'</div>\n								<div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass).replace(/\'/g,"&#39;")+'\'></div>\n								<ul class="csu-pl-booked-links clearfix">\n									<li>\n										<a class="csu-pl-link csu-pl-link-cancel" data-weave="troopjs-ef/blurb/widget" data-blurb-id="568585" data-toggle="tooltip" data-placement="bottom" title="'+e.notice+'">Cancel you booking</a>\n									</li>\n									';return e.calendarReminderEnabled&&(t+='\n										<li>\n											<a class="csu-pl-link csu-pl-link-reminder" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675993">SAVE TO CALENDAR</a>\n										</li>\n									'),t+='\n								</ul>\n							</div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<div data-weave="campus-studyplan-ui/widget/pl/booked/countdown/main('+e.id+')" class="csu-pl-booked-countdown"></div>\n						<div data-weave="campus-studyplan-ui/widget/pl/booked/class-status/main"></div>\n						<div data-weave="campus-studyplan-ui/widget/pl/booked/class-entrance/main(url)" data-url="'+e.evcUrls.entering+'"></div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n		<div class="row">\n			<div class="col-xs-6 col-xs-offset-3">\n				<div class="csu-pl-sms-reminder" data-weave="campus-studyplan-ui/widget/pl/booked/sms-reminder/main('+e.id+')"></div>\n			</div>\n		</div>\n		<div class="cpbc-inner-wrapper">\n			<div class="h4 csu-pl-lead text-center">\n				<span class="glyphicon glyphicon-booked"></span>\n				<span data-blurb-id="568587" data-weave="troopjs-ef/blurb/widget">Class Booked</span>\n			</div>\n			<div class="csu-pl-class-panel">\n				<div class="csu-pl-class-media media clearfix">\n					<div class="pull-left">\n						<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n					</div>\n					<div class="media-body">\n						<h4 class="media-heading text-uppercase">\n							<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n						</h4>\n						<div class="csu-pl-class-time">'+e.startTime+'</div>\n						<div class="csu-pl-booked-reminder">\n							<div data-weave="troopjs-ef/blurb/widget" data-blurb-id="674463">Are you sure you want to cancel the class?</div>\n						</div>\n						<div class="csu-pl-booked-buttons">\n							<button type="button" class="btn btn-primary btn-pl-keep" data-weave="troopjs-ef/blurb/widget" data-blurb-id="674464">No, keep the class</button><!--\n							--><button type="button" class="btn btn-default btn-pl-cancel" data-weave="troopjs-ef/blurb/widget" data-blurb-id="674465">Yes, cancel the class</button>\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl/booked/main",["troopjs-ef/component/widget","template!./main.html","lodash","when","../../../utils/momentize","troopjs-ef/command/service","troopjs-data/cache/component","./class-status","../../../utils/widgetCreator","../../../utils/fancybox","client-tracking","moment"],function(e,t,n,a,s,i,o,r,l,c,d,u){"use strict";function p(e,t){var a=e.slice(0);return n.remove(a,function(e){return e===t+""}),a}var m,v={SUBBED_OUT_MESSAGE:{SITEAREA:"OCB",KEYCODE:"PLTeacherCancellationMessages"}},b="/school/evc/pl/outlook?class_id=",f="csu-pl-booked-cancellation",h="bookingCancelledBy_",g=window.localStorage,w=a.defer(),y=a.defer();return e.extend(function(e,t,n){var a=this;a.options=n,m||(m=new i("plbooking/cancel",new o),m.configure({url:"/services/school/command/plbooking/cancel",contentType:"application/json; charset=UTF-8",type:"post"}),m.start())},{"sig/start":function(){var e,a,i,o,r=this;r.query(w.promise,y.promise,"blurb!639584","member_site_setting!"+v.SUBBED_OUT_MESSAGE.SITEAREA+";"+v.SUBBED_OUT_MESSAGE.KEYCODE,'ccl!"School.EVC.Reminder.Switch"').spread(function(l,c,d,u,p){c&&c.member_id&&(r.member_id=c.member_id),e=l.languagecode.value.toLowerCase(),a=s(r.options.bookedClass.customizedStartTime,e,"START_TIME"),i=s(r.options.bookedClass.suggestedCancelTime,e,"CANCEL_TIME"),o=d.translation.replace("%%Canceltime%%",i).replace("%%timezone%%",r.options.bookedClass.timezoneId),r.html(t(n.assign({startTime:a,notice:o,calendarReminderEnabled:p&&"true"===p.value},r.options))).then(function(){r.$element.find(".csu-pl-link-cancel").tooltip(),r.$content=r.$element.find(".csu-pl-booked"),r.isSubbedOut=-1===r.options.bookedClass.teacherId,r.isSubbedOut&&(r.readMessages=u&&u.value?u.value.split(","):[],r.messageIsRead=n.contains(r.readMessages,r.options.bookedClass.classId+""),r.messageIsRead||r.showTeacherCancellationMessage())})})},"hub:memory/common_context":function(e){w.resolve(e&&e.values)},"hub:memory/context":function(e){y.resolve(e&&e.user)},"hub/campus/studyplan/pl/status":function(e){var t=this;e===r.STARTED&&t.$element.find(".csu-pl-booked-links").remove()},"dom:.csu-pl-link-cancel/click":function(){var e=this;e.toggleCancellation()},"dom:.csu-pl-link-reminder/click":function(){var e=this;window.open(b+e.options.bookedClass.classId,"_self")},"dom:.btn-pl-keep/click":function(){var e=this;e.toggleCancellation()},"dom:.btn-pl-cancel/click":function(){var e=this;d.useraction({"action.cancelClass":1}),e.$element.trigger("task",e.publish("plbooking/cancel",{class_id:e.options.bookedClass.classId}).spread(function(t){t[0].isSuccess&&(e.isSubbedOut&&e.messageIsRead&&e.saveSetting(p(e.readMessages,e.options.bookedClass.classId)),e.publish("studyplan/sequence/update"),e.publish("studyplan/sequence-container/reload"),g.setItem(h+e.options.topic.courseUnitId+e.member_id,"1#"+u().utc().format("YYYY-MM-DD HH:mm:ss")))}))},showTeacherCancellationMessage:function(){var e=this,t=l({"campus-studyplan-ui/widget/shared/alert/main":{title:677631,content:677503,action:677505}});t.weave().then(function(){c.open({content:t,afterClose:function(){e.saveSetting(e.readMessages.concat(e.options.bookedClass.classId))}})})},saveSetting:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:v.SUBBED_OUT_MESSAGE.SITEAREA,keyCode:v.SUBBED_OUT_MESSAGE.KEYCODE,keyValue:e.join(",")}).then(function(){t.readMessages=e})},toggleCancellation:function(){var e=this;e.$content.toggleClass(f)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/sms-reminder/main.html",[],function(){return function(e){var t='<form class="cpsr-input-form">\n	<p class="cpsr-notice">\n		<span data-blurb-id="677499" data-weave="troopjs-ef/blurb/widget" data-values=\'{ "hours": '+e.sendMsgXHoursBeforeClass+'}\'></span> <a data-blurb-id="132214" data-weave="troopjs-ef/blurb/widget" class="cpsr-privacy-policy" href=""></a>\n	</p>\n	<div>\n		<p class="cpsr-lead" data-blurb-id="677501" data-weave="troopjs-ef/blurb/widget"></p>\n		<div class="clearfix">\n			<div class="cpsr-mobile-number">\n				<input class="cpsr-mobile-number-input" style="padding-left: '+(e.phoneNumberCountryCode.length+2)/2+'em;" type="text" id="phoneNumber" name="phoneNumber">\n				<span class="cpsr-country-code">+'+e.phoneNumberCountryCode+'</span>\n			</div>\n			<div class="cpsr-request-reminder">\n				<button class="btn-link btn-link-request" type="submit"><span data-blurb-id="677502" data-weave="troopjs-ef/blurb/widget"></span> <span class="glyphicon glyphicon-arrow-primary"></span></button>\n			</div>\n		</div>\n	</div>\n</form>';return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/sms-reminder/filled-out.html",[],function(){return function(e){function t(){return e.hasSubscribed?"checked":""}var n="";return n+='\n<div class="cpsr-subscribe">\n	<div class="cpsr-subscribe-inner-wrapper">\n		<input class="cpsr-subscribe-checkbox"  type="checkbox" id="subscribe" '+t()+'>\n	</div>\n	<div class="cpsr-subscribe-inner-wrapper">\n		<label class="cpsr-subscribe-label" data-blurb-id="680354" data-weave="troopjs-ef/blurb/widget" data-values=\'{ "telephone": "+'+e.phoneNumber+"\" }'></label>\n	</div>\n</div>"}}),define("campus-studyplan-ui/widget/pl/booked/sms-reminder/main",["troopjs-ef/component/widget","template!./main.html","template!./filled-out.html","troopjs-ef/command/service","troopjs-data/cache/component","lodash","jquery","jquery.validate"],function(e,t,n,a,s,i,o){"use strict";function r(e){var t=i.pluck(e,"name"),n=i.pluck(e,"value");return i.zipObject(t,n)}var l,c=18e3;return e.extend(function(e,t,n){var i=this;i.serivce=n,l||(l=new a("sms_reminder/UpdateSetting",new s),l.configure({url:"/services/api/campuscore/command/sms_reminder/UpdateSetting",contentType:"application/json; charset=UTF-8",type:"post"}),l.start())},{"sig/start":function(){var e=this;e.query("sms_reminder!current",e.serivce).spread(function(t,n){e.reminder=t&&t.studentInfo;var a=n&&(n.countdown||n.countDown);e.secondsLeftForStart=a.secondsLeftForStart,e.render()})},"dom/submit":function(e){var t=this,n=r(o(e.target).serializeArray());e.preventDefault(),i.assign(n,{phoneNumber:t.reminder.phoneNumberCountryCode+n.phoneNumber,subscribe:!0}),t.publish("sms_reminder/UpdateSetting",n).spread(function(e){e&&e[0]&&e[0].isSuccess&&(i.assign(t.reminder,{phoneNumber:n.phoneNumber,hasSubscribed:!0}),t.render())})},"dom:.cpsr-privacy-policy/click":function(e){e.preventDefault(),window.open("/partner/corp/privacy.aspx","help","width=640,height=600,resizable,scrollbars")},"dom:.cpsr-subscribe-checkbox/change":function(e){var t=this,n=o(e.target).prop("checked");t.publish("sms_reminder/UpdateSetting",{subscribe:n}).spread(function(e){e&&e[0]&&e[0].isSuccess&&(i.assign(t.reminder,{hasSubscribed:n}),t.render())})},render:function(){var e,a=this;return a.secondsLeftForStart<c?void 0:a.reminder&&a.reminder.enableSmsReminder?a.reminder.phoneNumber?a.html(n(a.reminder)):a.query("blurb!680352","blurb!680353").spread(function(n,s){return a.html(t(a.reminder)).then(function(){e=new RegExp(a.reminder.phoneNumberValidationRegex),o.validator.addMethod("campusSmsNumber",function(t,n){return this.optional(n)||e.test(t)},"Invalid phone number"),a.$element.find(".cpsr-input-form").validate({rules:{phoneNumber:{required:!0,campusSmsNumber:!0}},messages:{phoneNumber:{required:s&&s.translation,campusSmsNumber:n&&n.translation}}})})}):void 0}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/booked/techcheck/main.html",[],function(){return function(e){var t='<p class="csu-pl-status-info-description" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.notice+'"></p>\n<button type="button" class="btn btn-primary btn-tech-check" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675336">Complete tech check</button>';return t}}),define("campus-studyplan-ui/widget/pl/booked/techcheck/main",["troopjs-ef/component/widget","troopjs-core/pubsub/hub","template!./main.html","school-ui-studyplan/utils/client-storage","../class-status","when","client-tracking"],function(e,t,n,a,s,i,o){"use strict";function r(e){switch(e){case s.NOT_YET:return 675334;case s.STARTED:return 675335;default:return 675333}}function l(e){d.resolve(e)}var c="passed",d=i.defer();return e.extend(function(e,t,n){},{"sig/start":function(){t.on("plugins/tech-check/enable",t,l),t.reemit("plugins/tech-check/enable",!0,t,l),t.off("plugins/tech-check/enable",t,l)},"hub/campus/studyplan/pl/status":function(e){var t=this,n=a.getSessionStorage("techcheck_state")===c;t.classStatus=e,d.promise.then(function(e){!e||n?t.publish("campus/studyplan/techcheck/passed",t.classStatus):t.render()})},"dom:.btn-tech-check/click":function(){var e,t=this;o.useraction({"action.techCheck":1}),t.query('ccl!"evc.classroom.host"').spread(function(n){e=n&&n.value,e&&t.publish("tech-check/request",[{id:"flash-install"},{id:"flash-setting",reload:!1},{id:"chrome-auth"},{id:"check-audio"}],{flashPath:window.location.protocol+"//"+e+"/techcheck{version,-}/default/techcheck-{version}.swf"}).then(function(e){a.setSessionStorage("techcheck_state",c),a.setSessionStorage("legacy_techcheck_state",!0),t.$element.html(""),t.publish("campus/studyplan/techcheck/passed",t.classStatus)})})},render:function(){var e=this;e.html(n({notice:r(e.classStatus)}))}})}),define("campus-studyplan-ui/widget/pl/cp20",["./base"],function(e){"use strict";return e.extend(function(e,t,n){var a=this;a.options={durationMinutes:20,classType:"cp20"},a.deferredFeature.resolve()},{"sig/start":function(){}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/dropout/main.html",[],function(){return function(e){var t='<div class="csu-pl-dropout">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span class="glyphicon glyphicon-alert"></span>\n			<span data-blurb-id="675998" data-weave="troopjs-ef/blurb/widget"></span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span>'+e.topic.title+'</span>\n							</h4>\n							<div class="csu-pl-class-time">'+e.startTime+'</div>\n							 <div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="h4 csu-pl-status-info-title" data-blurb-id="675999" data-weave="troopjs-ef/blurb/widget"></p>\n						<p class="csu-pl-status-info-description">\n							<span data-blurb-id="676422" data-weave="campus-studyplan-ui/widget/blurb"></span><br/><strong data-blurb-id="676000" data-weave="campus-studyplan-ui/widget/blurb"></strong>\n						</p>\n						<div>\n							<a class="btn-link" href="/customerservice/contactus/inschool" target="_blank" data-blurb-id="676423" data-weave="troopjs-ef/blurb/widget"></a>\n						</div>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl/dropout/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash"],function(e,t,n,a){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.classDetails&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.classDetails.startTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/no-recommendation.html",[],function(){return function(e){function t(){return e.evcUrls.booking.replace("{source}",window.encodeURIComponent(window.location.href)||"").replace("{token}",e.studyplanItemToken||"").replace("{partner}",e.classRecommendation.classPartnerCode||"").replace("{tid}","")}var n="";return n+='\n<div class="csu-pl-msg-with-topic">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="text-center">\n			<p class="csu-pl-msg-lead" data-blurb-id="681900" data-weave="troopjs-ef/blurb/widget">Unfortunately we were not able to recommend you a teacher within the next 7 days. Please visit the booking calendar to view further options.</p>\n			<a class="btn btn-primary btn-calendar" href="'+t()+'" data-blurb-id="681901" data-weave="troopjs-ef/blurb/widget">Go to calendar</a>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl/nevertake/main",["troopjs-ef/component/widget","template!./no-recommendation.html","when","lodash","jquery","../../../utils/widgetCreator","../../../utils/fancybox","moment"],function(e,t,n,a,s,i,o,r){"use strict";function l(){var e=n.defer();return s.get("/school/evc/pl/gettimezonelist",function(t){t&&t.TimeZone&&e.resolve(t.TimeZone)}),e.promise;
}function c(e){var t=u.exec(e.DisplayName);return{id:e.Id,offset:e.Offset,displayOffset:t&&t[0]}}var d="Id",u=/UTC([+-]\d{2}:\d{2}){0,1}/,p="bookingCancelledBy_",m="1900-01-01 00:00:00",v=window.localStorage,b=n.defer();return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.getTimezone().then(function(t){e.render(t)})},"hub:memory/load/studyplan_item":function(e){var t=this;t.studyplanItem=e,t.studyplanItemToken=t.studyplanItem&&t.studyplanItem.progress&&t.studyplanItem.progress.properties&&t.studyplanItem.progress.properties.token||""},"hub:memory/context":function(e){b.resolve(e&&e.user)},"dom/timezoneChange":function(e,t){var n=this;n.render(t)},getTimezone:function(){var e,t,s,i=this,o=n.defer();return i.query("member_site_setting!EVC;TimeZone",l()).spread(function(n,r){return r&&r.length&&(i.timezoneList=a.map(a.sortBy(r,d),c),n&&n.value?(s=a.find(i.timezoneList,{id:n.value}),o.resolve(s)):(e=new Date,t=-1*e.getTimezoneOffset(),s=a.find(i.timezoneList,{offset:t}),i.saveTimezone(s.id).then(function(){o.resolve(s)}))),o.promise})},saveTimezone:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:"EVC",keyCode:"TimeZone",keyValue:e})},render:function(e){var n,s,o=this;e&&(o.currentTimezone=e,o.query("ocb_recommendclass!'"+o.options.topic.classType+";"+o.currentTimezone.id+"'",b.promise).spread(function(e,r){o.publish("ocb/recommendation/change",e&&e.classRecommendation),r&&r.member_id&&(o.member_id=r.member_id),e&&e.classRecommendation&&e.classRecommendation.classes&&e.classRecommendation.classes.length?(n=a.assign(o.options,{studyplanItem:o.studyplanItem,studyplanItemToken:o.studyplanItemToken,classRecommendation:e.classRecommendation,currentTimezone:o.currentTimezone,timezoneList:o.timezoneList}),s=i({"campus-studyplan-ui/widget/pl/nevertake/recommendation/main":n}),s.weave(),o.html(s)):(n=a.assign(o.options,{studyplanItemToken:o.studyplanItemToken,classRecommendation:e.classRecommendation}),o.html(t(n)));var l=v.getItem(p+o.options.topic.courseUnitId+o.member_id),c=null===l?m:l.split("#")[1],d="ocb_cancellation!'"+o.options.topic.courseUnitId+";"+c+"'";o.query(d).spread(function(e){e.hasCancelledLastBooking&&o.showTeacherCancellationMessage()})}))},showTeacherCancellationMessage:function(){var e=this,t=i({"campus-studyplan-ui/widget/shared/alert/main":{title:682008,content:682009,action:677505}});t.weave().then(function(){o.open({content:t,afterClose:function(){v.setItem(p+e.options.topic.courseUnitId+e.member_id,"0#"+r().utc().format("YYYY-MM-DD HH:mm:ss"))}})})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/recommendation/main.html",[],function(){return function(e){var t='<div class="csu-pl-nevertake">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="csu-pl-nevertake-booking">\n			<p class="csu-pl-nevertake-lead" data-blurb-id="673774" data-weave="troopjs-ef/blurb/widget">Recommended class for you</p>\n			<form class="csu-pl-nevertake-form tabulation">\n				<div class="row">\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-teacher" data-weave="campus-studyplan-ui/widget/pl/nevertake/teacher/main"></div>\n					</div>\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-timeslot" data-weave="campus-studyplan-ui/widget/pl/nevertake/timeslot/main(options, context)" data-options=\''+JSON.stringify(e.classRecommendation)+"' data-context='"+JSON.stringify(e.context)+'\'></div>\n						<div class="csu-pl-nevertake-timezone" data-weave="campus-studyplan-ui/widget/pl/nevertake/timezone/main(options, list)" data-options=\''+JSON.stringify(e.currentTimezone)+"' data-list='"+JSON.stringify(e.timezoneList)+'\'></div>\n					</div>\n					<div class="col-xs-4">\n						<div class="csu-pl-nevertake-button">\n							';return"true"===e.videoEnabled&&(t+='\n								<div class="cpn-button-video-lesson">\n									<input type="checkbox" id="videoLesson" /><label for="videoLesson" data-blurb-id="673775" data-weave="troopjs-ef/blurb/widget">Make it a video lesson</label>\n								</div>\n							'),t+="\n                            ",e.PLRecordFeature>0&&(t+='\n								<div class="cpn-button-video-lesson gud">\n                                    <input type="hidden" value="'+(2==e.PLRecordFeature?"true":"false")+'" name="NeedRecord" />\n                                    <input type="checkbox" id="NeedRecordBox" '+(2==e.PLRecordFeature?"checked":"")+' /><label for="NeedRecordBox" data-blurb-id="708472" data-weave="troopjs-ef/blurb/widget">Send me class video</label>\n                                    <span class="tooltip-info" data-toggle="tooltip" data-placement="right">i</span>\n                                    <span class="hide" data-blurb-id="708473" data-weave="campus-studyplan-ui/widget/blurb" ></span>\n								</div>\n							'),t+='\n							<div>\n								<button type="submit" class="btn btn-primary"><span data-blurb-id="568596" data-weave="troopjs-ef/blurb/widget">Book this class</span></button>\n								<p class="csu-pl-nevertake-tnc" data-blurb-id="673780" data-weave="campus-studyplan-ui/widget/blurb" data-values=\'{"termsAndConditions": "<a class=\\"csu-pl-link csu-pl-link-tnc\\">'+e.termsAndConditions+"</a>\"}'>By clicking the button above, you agree to the Terms And Conditions of the Private Lesson services.</p>\n							</div>\n						</div>\n					</div>\n				</div>\n				",t+="cp20"===e.studyplanItem.typeCode?'\n					<input type="hidden" name="BookingToken" value="'+e.studyplanItemToken+'" />\n					<input type="hidden" name="SubserviceType" value="'+e.studyplanItem.typeCode.toUpperCase()+'" />\n					<input type="hidden" name="ClassTypeCode" value="'+e.studyplanItem.typeCode.toUpperCase()+'" />\n					<input type="hidden" name="Flow" value="" />\n				':'\n					<input type="hidden" name="BookingToken" value="" />\n					<input type="hidden" name="SubserviceType" value="" />\n					<input type="hidden" name="ClassTypeCode" value="" />					\n					<input type="hidden" name="Flow" value="UnitAligned" />\n				',t+='\n				<input type="hidden" name="Token" value="'+e.bookingToken.token+'" />\n				<input type="hidden" name="TokenTime" value="'+e.bookingToken.tokenTime+'" />\n				<input type="hidden" name="SchoolVersion" value="'+e.studentCourse.schoolVersion+'" />\n				<input type="hidden" name="Course_id" value="'+e.studentCourse.course_id+'" />\n				<input type="hidden" name="CourseUnit_id" value="'+e.studentCourse.courseUnit_id+'" />\n				<input type="hidden" name="StudentCourse_id" value="'+e.studentCourse.studentCourse_id+'" />\n				<input type="hidden" name="Member_id" value="'+e.user.member_id+'" />\n				<input type="hidden" name="MarketCode" value="'+e.context.countrycode.value+'" />\n				<input type="hidden" name="IsVideo" value="false" />\n				<input type="hidden" name="Gender" value="" />\n			</form>\n\n			<!-- links -->\n			<div class="row">\n				<div class="col-xs-4 text-center">\n					<a class="btn-link csu-pl-link btn-link-change-teacher"><span data-blurb-id="673776" data-weave="troopjs-ef/blurb/widget"></span><span class="glyphicon glyphicon-arrow"></span></a>\n				</div>\n				<div class="col-xs-4 text-center">\n					<a class="btn-link csu-pl-link btn-link-change-time"><span data-blurb-id="673777" data-weave="troopjs-ef/blurb/widget"></span><span class="glyphicon glyphicon-arrow"></span></a>\n				</div>\n				<div class="col-xs-4">\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/pl/nevertake/recommendation/main",["troopjs-ef/component/widget","template!./main.html","lodash","jquery","../../../../utils/widgetCreator","../../../../utils/fancybox","when","client-tracking"],function(e,t,n,a,s,i,o,r){"use strict";function l(e){var t=/[\?|&]id=(\S+)$/.exec(e&&e.communityPageUrl);return t&&t[1]}function c(e,t,n,a){return e.replace("{source}",window.encodeURIComponent(window.location.href)||"").replace("{token}",t||"").replace("{partner}",n||"").replace("{tid}",a||"")}function d(e){var t;return t=e.enablePLRecord?e.defaultPLRecordOption?b.CHECKED:b.UNCHECKED:b.DISABLED}var u=o.defer(),p=o.defer(),m="bookingCancelledBy_",v=window.localStorage,b={DISABLED:0,UNCHECKED:1,CHECKED:2};return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.query('ccl!"School.PrivateLesson.isVideoEnable"',"blurb!673781",u.promise,p.promise,"evc_studentcourse!"+e.options.topic.courseUnitId,"bookingtoken!current","evcmember!current").spread(function(s,i,o,r,l,c,u){r&&r.member_id&&(e.member_id=r.member_id),e.html(t,n.assign({videoEnabled:s&&s.value,termsAndConditions:i&&i.translation,context:o||{},user:r||{},studentCourse:l||{},bookingToken:c&&c.lessonBookingSecurityParams||{},PLRecordFeature:d(u)},e.options)).then(function(){e.$timeslot=e.$element.find(".csu-pl-nevertake-timeslot"),e.$videoLesson=e.$element.find("input[name=IsVideo]"),e.$element.find('[data-toggle="tooltip"]').each(function(){var e=a(this);e.tooltip({title:e.nextAll(".hide").text()})})})})},"dom:form.csu-pl-nevertake-form/submit":function(e){e.preventDefault();var t,n=this,l=a(e.target),c=l.find("input[name=StartTime]"),d=l.find("input[name=StartTime]:checked"),u=c.index(d)+1,p=o.defer();r.useraction({"action.booking":1,"action.recommendTimeSlot":1,"action.recommendTimeSlotChoice":"Choice"+u,"action.hasProfilePicture":n.selectedTeacher.isDefaultAvatar?"No":"Yes","action.videoLessonClick":n.isVideoClass?"Yes":"No"}),n.$element.trigger("task",p.promise),a.ajax({method:"POST",url:"/school/evc/pl/book",data:l.serialize(),success:function(e){e.IsSuccess?(n.publish("studyplan/sequence/update"),n.publish("studyplan/sequence-container/reload"),n.publish("ocb/recommendation/track",{status:"Success",statusExtension:e.Class_id,isVideoClass:n.isVideoClass}),v.removeItem(m+n.options.topic.courseUnitId+n.member_id)):(t=s({"campus-studyplan-ui/widget/shared/alert/main":{glyphicon:!0,title:674436,content:674437,action:674438}}),t.weave().then(function(){i.open({content:t,afterClose:function(){n.$timeslot.trigger("render")}})}),n.publish("ocb/recommendation/track",{status:"Fail",statusExtension:e.StatusCode,isVideoClass:n.isVideoClass})),p.resolve()}})},"dom:#videoLesson/change":function(e){var t=this;t.isVideoClass=e.target.checked,t.$videoLesson.val(t.isVideoClass)},"dom:#NeedRecordBox/click":function(e){var t=e.target.form.elements.NeedRecord;t.value=e.target.checked?"true":"false"},"dom:.csu-pl-link-tnc/click":function(e){var t=this,n=s({"campus-studyplan-ui/widget/pl/nevertake/tscs/main":{classType:t.options.topic.classType}});n.weave().then(function(){i.open({content:n})})},"hub:memory/common_context":function(e){u.resolve(e&&e.values)},"hub:memory/context":function(e){p.resolve(e&&e.user)},"hub/ocb/selectedClass/change":function(e){var t=this;t.selectedTeacher=e},"dom:.btn-link-change-teacher/click":function(){var e=this;r.useraction({"action.changeTeacher":1}),e.publish("ocb/recommendation/track",{status:"Goto",statusExtension:"ChangeTeacher",isVideoClass:!1});var t=c(e.options.evcUrls.booking,e.options.studyplanItemToken,e.options.classRecommendation.classPartnerCode);window.open(t,"_self")},"dom:.btn-link-change-time/click":function(){var e=this;r.useraction({"action.viewOtherTime":1}),e.publish("ocb/recommendation/track",{status:"Goto",statusExtension:"ChangeTime",isVideoClass:!1});var t=c(e.options.evcUrls.booking,e.options.studyplanItemToken,e.options.classRecommendation.classPartnerCode,l(e.selectedTeacher));window.open(t,"_self")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/teacher/main.html",[],function(){return function(e){function t(){var t="";return e.accent||e.bilingual||(t="cpn-teacher-name-standalone"),t}function n(){for(var e=arguments,t="",n=0;n<e.length;n++)t+=e[n].substring(0,1);return t.toUpperCase()}var a="";return a+='\n<div class="cpn-title text-center"><span class="glyphicon glyphicon-teacher-large"></span><span data-blurb-id="673778" data-weave="troopjs-ef/blurb/widget">Teacher</span></div>\n<div class="cpn-teacher-profile text-center">\n	<div class="cpn-teacher-avatar">\n			<!--[if lte IE 8]>\n				<vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n					',a+=e.isDefaultAvatar?'\n						<vml:fill color="#c3c3c3">\n							<em>'+n(e.firstName,e.lastName)+"</em>\n						</vml:fill>\n					":'\n						<vml:fill type="frame" src="'+e.avatarUrl+'"/>\n					',a+='\n				</vml:oval>\n			<![endif]-->\n			<span class="csu-pl-teacher-avatar hide-in-ie8">\n				',a+=e.isDefaultAvatar?"\n					<em>"+n(e.firstName,e.lastName)+"</em>\n				":'\n					<img src="'+e.avatarUrl+'" alt="'+e.nickName+'">\n				',a+='\n			</span>\n		</span>\n	</div>\n	<div class="cpn-teacher-name '+t()+'">\n		',a+=e.nickName?"\n			"+e.nickName+"\n		":"\n			"+e.firstName+" "+e.lastName+"\n		",a+='\n	</div>\n	<ul class="cpn-teacher-language text-center"><!--\n		',e.accent&&(a+='\n			--><li class="cpn-teacher-accent">\n				<div class="cpn-teacher-text">\n					<span class="glyphicon glyphicon-accent"></span><span>'+e.accent+"</span>\n				</div>\n			</li><!--\n		"),a+="\n		",e.bilingual&&(a+='\n			--><li class="cpn-teacher-bilingual">\n				<div class="cpn-teacher-text">\n					<span class="glyphicon glyphicon-bilingual"></span><span>'+e.bilingual+"</span>\n				</div>\n			</li><!--\n		"),a+='\n		-->\n	</ul>\n</div>\n<input type="hidden" name="Teacher_id" value="'+e.memberId+'"/ >'}}),define("campus-studyplan-ui/widget/pl/nevertake/teacher/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){"use strict";return e.extend(function(e,t,n){},{"sig/start":function(){},"hub/ocb/selectedClass/change":function(e){var t=this;e.memberId!==t.memberId&&t.render(e)},render:function(e){var n=this;n.memberId=e.memberId,n.html(t,e)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/timeslot/main.html",[],function(){return function(e){function t(e){return e?"":"checked"}var n="";n+='\n\n<div class="text-center">\n	<div class="cpn-title"><span class="glyphicon glyphicon-timeslot"></span><span data-blurb-id="673779" data-weave="troopjs-ef/blurb/widget">Time</span></div>\n	<ul class="cpn-timeslot-list text-left">\n		';for(var a=0;a<e.classes.length;a++)n+='\n			<li data-teacher-member-id="'+e.classes[a].teacherMemberId+'" data-end-time="'+e.classes[a].endTimeEst+'" data-language-code="'+e.classes[a].languageCode+'">\n				<input type="radio" name="StartTime" id="timeslot'+e.classes[a].classId+'" value="'+e.classes[a].startTimeEst+'" '+t(a)+' /><label for="timeslot'+e.classes[a].classId+'">'+e.classes[a].formattedTime+"</label>\n			</li>\n		";return n+='\n		<input type="hidden" name="EndTime" value="'+e.classes[0].endTimeEst+'" />\n		<input type="hidden" name="LanguageCode" value="'+e.classes[0].languageCode+'" />\n	</ul>\n</div>\n<input type="hidden" name="PartnerCode" value="'+e.classPartnerCode+'" />'}}),define("campus-studyplan-ui/widget/pl/nevertake/timeslot/main",["troopjs-ef/component/widget","template!./main.html","lodash","jquery","when","../../../../utils/momentize","client-tracking"],function(e,t,n,a,s,i,o){"use strict";function r(e){return function(t){var n=t.startTime.substring(0,19);return t.formattedTime=i(n,e,"START_TIME"),t}}return e.extend(function(e,t,n,a){var s=this;s.options=n,s.context=a},{"sig/start":function(){var e=this;e.render()},"dom/render":function(){var e=this;e.render()},'dom:input[name="StartTime"]/change':function(e){var t=this,s=a(e.currentTarget).parent();o.useraction({"action.changeBookingTime":1}),s.siblings().find("input[checked]").removeAttr("checked"),s.find("input").attr("checked","checked"),t.$endTime.val(s.data("endTime")),t.$languageCode.val(s.data("languageCode")),t.publish("ocb/selectedClass/change",n.find(t.teachers,{memberId:s.data("teacherMemberId")}))},render:function(){var e=this,a=e.context&&e.context.languagecode.value.toLowerCase();e.teachers=e.options.teachers,e.html(t,{classes:n.map(e.options.classes,r(a)),classPartnerCode:e.options.classPartnerCode}).then(function(){e.$endTime=e.$element.find("input[name=EndTime]"),e.$languageCode=e.$element.find("input[name=LanguageCode]"),e.publish("ocb/selectedClass/change",n.find(e.teachers,{memberId:e.options.classes[0].teacherMemberId}))})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/timezone/main.html",[],function(){return function(e){var t='<div class="cpn-timezone-readonly text-center">\n	<div>'+e.id+'</div>\n	<div class="cpn-timezone-button-wrapper">\n		('+e.displayOffset+')\n		<a class="csu-pl-link cpn-timezone-button-change" data-blurb-id="676700" data-weave="troopjs-ef/blurb/widget">change</a>\n	</div>\n</div>';return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/timezone/editable.html",[],function(){return function(e){function t(t){return t===e.current.id?"selected":""}var n="";n+='\n<div class="cpn-timezone-editable text-center">\n	<select class="cpn-timezone-select">\n		';for(var a=0;a<e.list.length;a++)n+="\n			<option "+t(e.list[a].id)+' value="'+e.list[a].id+'">('+e.list[a].displayOffset+") "+e.list[a].id+"</option>\n		";return n+="\n	</select>\n</div>"}}),define("campus-studyplan-ui/widget/pl/nevertake/timezone/main",["troopjs-ef/component/widget","template!./main.html","template!./editable.html","when","jquery","lodash"],function(e,t,n,a,s,i){"use strict";return e.extend(function(e,t,n,a){var s=this;s.options=n,s.list=a},{"sig/start":function(){var e=this;e.render().then(function(){s("body").click(function(t){e.cancel(s(t.target))})})},"dom:.cpn-timezone-button-change/click":function(){var e=this;e.edit()},"dom:.cpn-timezone-select/change":function(e){var t=this,n=t.list[e.currentTarget.selectedIndex];t.save(n.id).then(function(){t.$element.trigger("timezoneChange",n)})},render:function(){var e=this;return e.hide(e.$editableView),e.html(t(e.options)).then(function(){e.editable=!1,e.$readonlyView&&e.$readonlyView.remove(),e.$readonlyView=e.$element.find(".cpn-timezone-readonly")})},edit:function(){var e=this;e.hide(e.$readonlyView),e.$editableView?(e.$element.html(e.$editableView),e.editable=!0):e.html(n({list:e.list,current:e.options})).then(function(){e.editable=!0,e.$editableView=e.$element.find(".cpn-timezone-editable")})},cancel:function(e){var t=this;!t.editable||e.hasClass("cpn-timezone-button-change")||e.hasClass("cpn-timezone-select")||e.parents(".cpn-timezone-select").length||(t.hide(t.$editableView),t.$element.html(t.$readonlyView))},save:function(e){var t=this;return t.publish("school/member_site_setting/Save",{siteArea:"EVC",keyCode:"TimeZone",keyValue:e})},hide:function(e){var t=this;e&&t.$element.after(e)}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nevertake/tscs/main.html",[],function(){return function(e){var t='<div class="campus-studyplan-ui">\n	<div class = "csu-pl-nevertake-tscs">\n		<p class = "csu-pl-nevertake-tscs-title" data-weave = "troopjs-ef/blurb/widget" data-blurb-id = "676103"></p>\n		<p class = "csu-pl-nevertake-tscs-des" data-weave = "troopjs-ef/blurb/widget" data-blurb-id = "676112"></p>\n		<div class = "csu-pl-nevertake-tscs-content" data-weave = "campus-studyplan-ui/widget/blurb" data-blurb-id = "'+e.blurbID+'"></div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl/nevertake/tscs/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this,n="708943";return e.html(t,{blurbID:n})}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/nocouponleft/main.html",[],function(){return function(e){function t(e){return e.replace(/upurl=\S*&?/,"upurl="+window.encodeURIComponent(window.location.href))}var n="";return n+='\n<div class="csu-pl-nocouponleft csu-pl-msg-with-topic">\n	<div class="csu-pl-container">\n		<div class="csu-pl-topic">\n			<div class="media">\n				<div class="pull-left">\n					<img class="media-object" src="'+e.topic.image+'" alt="">\n				</div>\n				<div class="media-body">\n					<h4 class="media-heading text-uppercase">\n						<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n					</h4>\n					<p data-blurb-id="'+e.topic.description+'" data-weave="troopjs-ef/blurb/widget"></p>\n					<p data-blurb-id="673773" data-weave="troopjs-ef/blurb/widget"></p>\n				</div>\n			</div>\n		</div>\n		<div class="text-center">\n			<p class="csu-pl-msg-lead" data-blurb-id="675885" data-weave="troopjs-ef/blurb/widget">You don\'t have any private classes left right now.</p>\n			',e.feature.canBuyMore&&(n+='\n				<a class="btn btn-primary" href="'+t(e.feature.buyUrl)+'" data-blurb-id="675886" data-weave="troopjs-ef/blurb/widget">Buy more classes</a>\n			'),n+="\n		</div>\n	</div>\n</div>"}}),define("campus-studyplan-ui/widget/pl/nocouponleft/main",["troopjs-ef/component/widget","template!./main.html"],function(e,t){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;e.html(t(e.options))}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/pending/main.html",[],function(){return function(e){var t='<div class="csu-pl-pending">\n	<div class="csu-pl-container">\n		<div class="h4 csu-pl-lead text-center">\n			<span data-blurb-id="675994" data-weave="troopjs-ef/blurb/widget"></span>\n		</div>\n		<div class="csu-pl-class-panel tabulation">\n			<div class="row">\n				<div>\n					<div class="csu-pl-class-media media">\n						<div class="pull-left">\n							<img class="csu-pl-class-topic-image" src="'+e.topic.image+'" alt="">\n						</div>\n						<div class="media-body">\n							<h4 class="media-heading text-uppercase">\n								<span data-blurb-id="674720" data-weave="troopjs-ef/blurb/widget"></span>: <span data-blurb-id="'+e.topic.title+'" data-weave="troopjs-ef/blurb/widget"></span>\n							</h4>\n							<div class="csu-pl-class-time">'+e.startTime+'</div>\n							 <div class="csu-pl-profile" data-weave="campus-studyplan-ui/widget/shared/pl-profile/main(options)" data-options=\''+JSON.stringify(e.bookedClass)+'\'></div>\n						</div>\n					</div>\n				</div>\n				<div class="csu-pl-status-info">\n					<div>\n						<p class="h4 csu-pl-status-info-title csu-pl-status-info-title-fullsize" data-blurb-id="675995" data-weave="troopjs-ef/blurb/widget"></p>\n					</div><span>&nbsp;</span><!-- for vertical alignment -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>';return t}}),define("campus-studyplan-ui/widget/pl/pending/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/momentize","lodash"],function(e,t,n,a){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){},"hub:memory/common_context":function(e){var s,i=this,o="";e&&e.values&&i.options.bookedClass&&(s=e.values.languagecode.value.toLowerCase(),o=n(i.options.bookedClass.customizedStartTime,s,"START_TIME")),i.html(t(a.assign({startTime:o},i.options)))}})}),define("campus-studyplan-ui/widget/pl/pl",["./base","lodash"],function(e,t){"use strict";return e.extend(function(e,n,a){var s=this;s.options={durationMinutes:40,classType:"pl"},s.query("evcmember!current").spread(function(e){s.deferredFeature.resolve(t.find(e&&e.features,{featureType:s.options.classType.toUpperCase()}))})},{"sig/start":function(){}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/unlocked/main.html",[],function(){return function(e){function t(){return"cp20"===e.topic.classType?675991:678952}var n="";return n+='\n<div class = "csu-pl-unlocked csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="h4 csu-pl-lead text-center">\n            <span class="glyphicon glyphicon-unlock"></span>\n            <span class="csu-pl-unlocked-status" data-weave="troopjs-ef/blurb/widget" data-blurb-id="677341"></span>\n        </div>\n        <div class="csu-pl-msg-details media">\n            <div class="pull-left text-center">\n                <div class="csu-pl-teacher-avatar-wrapper">\n                    <!--[if lte IE 8]>\n                        <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                            <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                        </vml:oval>\n                    <![endif]-->\n                    <span class="csu-pl-teacher-avatar hide-in-ie8">\n                        <img src="'+e.recommendedTeacher.avatar+'">\n                    </span>\n                </div>\n                <div>\n                    <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                </div>\n                <div class="csu-pl-teacher-name">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                </div>\n            </div>\n            <div class="media-body">\n                <p class="h4" data-weave="troopjs-ef/blurb/widget" data-blurb-id="675884"></p>\n                <p data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="'+t()+'" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                </p>\n            </div>\n        </div>\n        <div class="text-center">\n            <button type="button" class="btn btn-primary btn-start-booking">\n                <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677342"></span>\n            </button>\n        </div>\n    </div>\n</div>'}}),define("campus-studyplan-ui/widget/pl/unlocked/main",["troopjs-ef/component/widget","template!./main.html","school-ui-studyplan/module","when","lodash","../../../utils/member-site-setting"],function(e,t,n,a,s,i){"use strict";function o(e,t){var n=",",a=e&&e.split(n)||[];return s.contains(a,t+"")||a.push(t),a.join(n)}var r=a.defer();return e.extend(function(e,a,s){var i=this;i.options=s,i.queries=[r.promise],i.template=t,i.cacheServer=n.config().cacheServer},{"sig/start":function(){var e=this;return e.query(e.queries).spread(function(){e.render.apply(e,arguments)})},"dom:.btn-start-booking/click":function(){var e=this;e.unlock()},"hub:memory/context":function(e){r.resolve({user:e&&e.user})},render:function(){var e=this,t={recommendedTeacher:{avatar:e.cacheServer+"/juno/18/80/21/v/188021/teacher.jpg",name:677343},feature:e.options.feature,topic:e.options.topic};return s.forEach(arguments,function(e){s.assign(t,e)}),e.html(e.template(t))},unlock:function(){var e,t=this,n="UnlockedPLs";t.getMemberSiteSetting(n).then(function(a){e=o(a&&a.value,t.options.topic.courseUnitId),t.saveMemberSiteSetting(n,e).then(function(){t.publish("studyplan/sequence-container/reload")})})}},i)}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/welcome/main.html",[],function(){return function(e){var t='<div class = "csu-pl-welcome csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="h4 csu-pl-lead text-center">\n            <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="679461"></span>\n        </div>\n        <div class="csu-pl-msg-details-wrapper clearfix">\n            <div class="csu-pl-msg-details media pull-left">\n                <div class="pull-left text-center">\n                    <div class="csu-pl-teacher-avatar-wrapper">\n                        <!--[if lte IE 8]>\n                            <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                                <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                            </vml:oval>\n                        <![endif]-->\n                        <span class="csu-pl-teacher-avatar hide-in-ie8">\n                            <img src="'+e.recommendedTeacher.avatar+'">\n                        </span>\n                    </div>\n                    <div>\n                        <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                    </div>\n                    <div class="csu-pl-teacher-name">\n                        <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                    </div>\n                </div>\n                <div class="media-body">\n                    <p class="h4" data-weave="troopjs-ef/blurb/widget" data-blurb-id="679462"></p>\n                    <p data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="675883" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                    </p>\n                </div>\n            </div>\n            <div class="pull-right">\n                <a class="csu-pl-tutorial-video">\n                    <img src="'+e.video.post+'">\n                </a>\n                <div data-weave="school-ui-studyplan/widget/gl-pl/popupvideo/main" data-video-url="'+e.video.url+'"></div>\n            </div>\n        </div>\n        <div class="text-center">\n            <button type="button" class="btn btn-primary btn-start-booking">\n                <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677342"></span>\n            </button>\n        </div>\n    </div>\n</div>';return t}}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/pl/welcome/no-coupon-left.html",[],function(){return function(e){function t(e){return e.replace(/upurl=\S*&?/,"upurl="+window.encodeURIComponent(window.location.href))}var n="";return n+='\n<div class = "csu-pl-msg">\n    <div class="csu-pl-container">\n        <div class="row">\n            <div class="col-xs-4 col-xs-offset-4">\n                <div class="h4 csu-pl-lead text-center">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="675885"></span>\n                </div>\n            </div>\n        </div>\n        <div class="csu-pl-msg-details media">\n            <div class="pull-left text-center">\n                <div class="csu-pl-teacher-avatar-wrapper">\n                    <!--[if lte IE 8]>\n                        <vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n                            <vml:fill type="frame" src="'+e.recommendedTeacher.avatar+'"/>\n                        </vml:oval>\n                    <![endif]-->\n                    <span class="csu-pl-teacher-avatar hide-in-ie8">\n                        <img src="'+e.recommendedTeacher.avatar+'">\n                    </span>\n                </div>\n                <div>\n                    <span class="glyphicon glyphicon-teacher"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="673778"></span>\n                </div>\n                <div class="csu-pl-teacher-name">\n                    <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.recommendedTeacher.name+'"></span>\n                </div>\n            </div>\n            <div class="media-body">\n                <p data-weave="troopjs-ef/blurb/widget" data-blurb-id="677495" data-values=\'{"name": "'+e.user.firstName+'"}\'>\n                <p>\n                    <span data-weave="campus-studyplan-ui/widget/blurb" data-blurb-id="679490" data-values=\'{"title": "<strong>'+e.translation.title+'</strong>"}\'></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.topic.description+'"></span> <span data-weave="troopjs-ef/blurb/widget" data-blurb-id="677496"></span>\n                </p>\n            </div>\n        </div>\n		',
e.feature.canBuyMore&&(n+='\n			<div class="text-center">\n				<a class="btn btn-primary btn-buy-coupon" href="'+t(e.feature.buyUrl)+'" data-blurb-id="675886" data-weave="troopjs-ef/blurb/widget">Buy more classes</a>\n			</div>\n		'),n+="\n    </div>\n</div>"}}),define("campus-studyplan-ui/widget/pl/welcome/main",["campus-studyplan-ui/widget/pl/unlocked/main","template!./main.html","template!./no-coupon-left.html"],function(e,t,n){"use strict";return e.extend(function(e,a,s){var i=this;i.options.feature&&i.options.feature.couponLeft<1?(i.template=n,i.queries.push(i.query("blurb!"+i.options.topic.title).spread(function(e){return{translation:{title:e&&e.translation}}}))):(i.template=t,i.queries.push(i.query("media!167835").spread(function(e){return{video:{url:e&&e.url,post:i.cacheServer+"/_imgs/evc/pl/studyplan/video.jpg"}}})))},{"dom:.btn-start-booking/click":function(e){var t=this,n="cp20"===t.options.topic.classType;e.stopImmediatePropagation(),n?(t.saveMemberSiteSetting("FirstTimeStudyPlanCP20",!0),t.unlock()):t.saveMemberSiteSetting("FirstTimeStudyPlanPL",!0).then(function(){t.publish("studyplan/sequence-container/reload")})},"dom:.csu-pl-tutorial-video/click":function(){var e=this;e.publish("studyplan/evc/welcome-video/show")}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/shared/alert/main.html",[],function(){return function(e){var t='<div class="gud">\n	<div class="campus-studyplan-ui">\n		<div class="csu-fancybox-small csu-fancybox-alert">\n			<div class="csu-fancybox-alert-header clearfix">\n				';return e.glyphicon&&(t+='\n					<div class="csu-fancybox-alert-icon">\n						<span class="glyphicon glyphicon-error"></span>\n					</div>\n				'),t+='\n				<div class="csu-fancybox-alert-title">\n					<span class="" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.title+'"></span>\n				</div>\n			</div>\n			<div class="csu-fancybox-alert-content">\n				<p data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.content+'"></p>\n			</div>\n			<div class="text-center">\n				<a class="btn-link" data-weave="troopjs-ef/blurb/widget" data-blurb-id="'+e.action+'"></a>\n			</div>\n		</div>\n	</div>\n</div>'}}),define("campus-studyplan-ui/widget/shared/alert/main",["troopjs-ef/component/widget","template!./main.html","../../../utils/fancybox"],function(e,t,n){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this;return e.html(t(e.options))},"dom:.btn-link/click":function(){n.close()}})}),define("troopjs-requirejs/template!campus-studyplan-ui/widget/shared/pl-profile/main.html",[],function(){return function(e){function t(){for(var e=arguments,t="",n=0;n<e.length;n++)t+=e[n].substring(0,1);return t.toUpperCase()}var n="";return n+='\n<!--[if lte IE 8]>\n	<vml:oval class="csu-pl-teacher-avatar" style="height: 81px; width: 81px; background: transparent;" stroked="false">\n		',e.teacherprofile?(n+="\n			",n+=e.teacherprofile.isDefaultImage?'\n				<vml:fill color="#c3c3c3">\n					<em>'+t(e.teacherprofile.firstName,e.teacherprofile.lastName)+"</em>\n				</vml:fill>\n			":'\n				<vml:fill type="frame" src="'+e.teacherprofile.imageUrl+'"/>\n			',n+="\n		"):n+='\n			<vml:fill color="#c3c3c3">\n				<em>?</em>\n			</vml:fill>\n		',n+='\n	</vml:oval>\n<![endif]-->\n<span class="csu-pl-teacher-avatar hide-in-ie8">\n	',e.teacherprofile?(n+="\n		",n+=e.teacherprofile.isDefaultImage?"\n			<em>"+t(e.teacherprofile.firstName,e.teacherprofile.lastName)+"</em>\n		":'\n			<img src="'+e.teacherprofile.imageUrl+'" alt="'+e.teacherprofile.displayName+'">\n		',n+="\n	"):n+="\n		<em>?</em>\n	",n+='\n</span><!--\n--><ul>\n	<li>\n		<span class="glyphicon glyphicon-teacher"></span><!--\n		',n+=e.teacherprofile?"\n			--><span>"+e.teacherprofile.displayName+"</span>\n		":'\n			--><span data-blurb-id="677504" data-weave="troopjs-ef/blurb/widget"></span>\n		',n+="\n	</li>\n	",e.isBilingual&&(n+='\n		<li>\n			<span class="glyphicon glyphicon-bilingual"></span><span data-blurb-id="673783" data-weave="troopjs-ef/blurb/widget">Bilingual</span>\n		</li>\n	'),n+='\n	<li>\n		<span class="csu-pl-profile-duration">'+e.durationForStudent+'</span><span data-blurb-id="673782" data-weave="troopjs-ef/blurb/widget">Minutes</span>\n	</li>\n	',e.isVideo&&(n+='\n		<li>\n			<span class="glyphicon glyphicon-video-lesson"></span><span data-blurb-id="673784" data-weave="troopjs-ef/blurb/widget">Video lesson</span>\n		</li>\n	'),n+="\n</ul>"}}),define("campus-studyplan-ui/widget/shared/pl-profile/main",["troopjs-ef/component/widget","template!./main.html","lodash","when"],function(e,t,n,a){"use strict";return e.extend(function(e,t,n){var a=this;a.options=n},{"sig/start":function(){var e=this,s=a.defer();if(e.options&&(e.options.teacherId||e.options.teacherMember_id)){var i=e.options.teacherId||e.options.teacherMember_id;i>0?e.query("teacherprofile!"+i).spread(function(e){s.resolve(e)}):s.resolve(),s.promise.then(function(a){e.html(t(n.assign({teacherprofile:a},e.options)))})}}})}),define("campus-studyplan-ui/widget/tracking",["troopjs-ef/component/widget","troopjs-ef/command/service","troopjs-data/cache/component","lodash","jquery"],function(e,t,n,a,s){"use strict";var i;return e.extend(function(e,a,s){i||(i=new t("campuscore/ocb_tracking/update",new n),i.configure({url:"/services/api/proxy/commandproxy/campuscore/ocb_tracking/update",contentType:"application/json; charset=UTF-8",type:"post"}),i.start())},{"hub/ocb/recommendation/change":function(e){var t=this;t.id=e&&e.id},"hub/ocb/recommendation/track":function(e){var t=this;t.track(e)},track:function(e){var t=this;t.id&&e&&t.publish("campuscore/ocb_tracking/update",a.assign({id:t.id},e))}})}),define(["campus-studyplan-ui/service/load"],function(e){return e});
